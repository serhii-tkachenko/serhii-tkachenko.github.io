"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[8331],{29905:(e,t,n)=>{function i(e){switch(e){case"amex":case"american_express":return"american-express";case"diners":case"diners_club":return"diners-club";default:return e}}n.d(t,{A:()=>i})},31448:(e,t,n)=>{n.d(t,{A:()=>i});const i=(0,n(12077).Mz)((({data:e})=>{const t=e.getCart();return t&&t.lineItems}),(e=>(t,n)=>!!e&&function({lineItems:e,instrument:t,paymentMethod:n}){const{isVaultingCardNumberValidationAvailable:i=!0}=(null==n?void 0:n.initializationData)||{};return!(0===e.physicalItems.length||!i||t.trustedShippingAddress)}({lineItems:e,instrument:t,paymentMethod:n})))},31698:(e,t,n)=>{n.d(t,{A:()=>m});var i=n(31635),a=n(44218),s=n(69440),r=n(70355),d=n(65685),o=n(94611),l=n(11474),u=n(40646),c=n(91182);const m=e=>{const{description:t,isInitializing:n=!1,initializePayment:m,method:h,onUnhandledError:y=s.noop,deinitializePayment:p}=e,[g,I]=(0,r.useState)(!1),[b,E]=(0,r.useState)(),C=function(e){const t=(0,a.B4)(((e=[])=>e.filter(d.A))),n=(0,a.B4)(((e=[])=>e.filter((({trustedShippingAddress:e})=>e)))),{checkoutService:i,checkoutState:s,isUsingMultiShipping:r=!1,method:l}=e,{data:{getCart:u,getConfig:c,getCustomer:m,getInstruments:h,isPaymentDataRequired:y,isPaymentDataSubmitted:p},statuses:{isLoadingInstruments:g}}=s,I=u(),b=c(),E=m();if(!b||!I||!E)throw new Error("Unable to get checkout");const C=t(h(l)),f=n(C);return{instruments:f,isNewAddress:0===f.length&&C.length>0,isInstrumentFeatureAvailable:!p(l.id,l.gateway)&&(0,o.A)({config:b,customer:E,isUsingMultiShipping:r,paymentMethod:l}),isLoadingInstruments:g(),isPaymentDataRequired:y(),loadInstruments:i.loadInstruments}}(e),{isLoadingInstruments:f,instruments:v,isNewAddress:S,isInstrumentFeatureAvailable:k,loadInstruments:w}=C,A=(0,r.useCallback)((()=>{if(!g&&v.length)return(0,s.find)(v,{defaultInstrument:!0})||v[0]}),[g,v]),_=(0,r.useCallback)((()=>{I(!0),E(void 0)}),[]),N=(0,r.useCallback)((e=>{I(!1),E((0,s.find)(v,{bigpayToken:e}))}),[v]);(0,r.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield m({gatewayId:h.gateway,methodId:h.id}),k&&(yield w())}catch(e){y(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield p({gatewayId:h.gateway,methodId:h.id})}catch(e){y(e)}}))})),[]);const x=b||A(),D=n||f,z=k&&(v.length>0||S);return t||k?r.createElement(c.A,{hideContentWhenLoading:!0,isLoading:D},r.createElement("div",{className:"paymentMethod paymentMethod--hosted"},t,z&&r.createElement(l.A,{instruments:v,onSelectInstrument:N,onUseNewInstrument:_,selectedInstrument:x}),k&&r.createElement(u.A,{instrumentId:x&&x.bigpayToken,instruments:v,isAccountInstrument:!0}))):null}},48407:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(12077);const a=["bluesnapdirect"];const s=(0,i.Mz)((({data:e})=>{const t=e.getCart();return t&&t.lineItems}),(e=>(t,n)=>!!e&&function({instrument:e,lineItems:t,paymentMethod:n}){const{config:{isVaultingCvvEnabled:i,cardCode:s},initializationData:r}=n,{isVaultingCardCodeValidationAvailable:d=!0}=r||{};return!(a.includes(e.provider)||!d||!(t.digitalItems.length>0||t.giftCertificates.length>0)&&(e.trustedShippingAddress?!i:!i&&!s))}({instrument:t,lineItems:e,paymentMethod:n})))},56928:(e,t,n)=>{n.d(t,{BoltClientPaymentMethod:()=>d,BoltEmbeddedPaymentMethod:()=>b,BoltPaymentMethod:()=>E});var i=n(31635),a=n(91124),s=n(70355),r=n(31698);const d=e=>{var{checkoutService:t,checkoutState:n,method:d}=e,o=(0,i.__rest)(e,["checkoutService","checkoutState","method"]);const l=(0,s.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{integrations:[a.nz],bolt:{useBigCommerceCheckout:!0}}))),[t]);return s.createElement(r.A,Object.assign({checkoutService:t,checkoutState:n,deinitializePayment:t.deinitializePayment,initializePayment:l,method:d},o))};var o=n(89799),l=n(48407),u=n(31448),c=n(48447),m=n(49655),h=n(22292);const y={privacyPolicyUrl:"https://www.bolt.com/privacy/",termsUrl:"https://www.bolt.com/end-user-terms/"},p=[{id:"payment.bolt_benefit_1"},{id:"payment.bolt_benefit_2"},{id:"payment.bolt_benefit_3"}],g=()=>{const e=s.createElement(s.Fragment,null,s.createElement(c.A,{data:y,id:"payment.bolt_checkbox_agreement"}),s.createElement("ul",null,p.map((({id:e},t)=>s.createElement("li",{key:t},s.createElement(m.A,{id:e}))))));return s.createElement(h.A,{additionalClassName:"form-checkbox form-field--createAccount",labelContent:e,name:"shouldCreateAccount"})},I=({containerId:e,showCreateAccountCheckbox:t})=>s.createElement("div",{className:"form-ccFields"},s.createElement("div",{className:"form-field form-field--bolt-embed",id:e}),t?s.createElement(g,null):null),b=e=>{var{checkoutService:t,checkoutState:n,method:r,paymentForm:d}=e,c=(0,i.__rest)(e,["checkoutService","checkoutState","method","paymentForm"]);const[m,h]=(0,s.useState)(!1),y="bolt-embedded",{hidePaymentSubmitButton:p,disableSubmit:g,setFieldValue:b,setSubmit:E,setValidationSchema:C}=d,f=(0,s.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{integrations:[a.nz],bolt:{containerId:y,useBigCommerceCheckout:!0,onPaymentSelect:e=>{h(!e),e&&b("shouldCreateAccount",!1)}}}))),[t,y,b]),v=(0,s.useCallback)((e=>t.initializeCustomer(Object.assign(Object.assign({},e),{integrations:[a.z2]}))),[t]),S=(0,s.useCallback)((()=>s.createElement(I,{containerId:y,showCreateAccountCheckbox:m})),[y,m]),{getInstruments:k,isPaymentDataRequired:w}=n.data,{isInitializingPayment:A,isLoadingInstruments:_}=n.statuses,N=k(r)||[],x=n.data.getCustomer(),D=null==x?void 0:x.isGuest,z=!D&&Boolean(r.config.isVaultingEnabled);return s.createElement(o.A,Object.assign({containerId:"boltEmbeddedOneClick",deinitializePayment:t.deinitializePayment,disableSubmit:g,hidePaymentSubmitButton:p,initializeCustomer:v,initializePayment:f,instruments:N,isInitializing:A(),isInstrumentCardCodeRequired:(0,l.A)(n),isInstrumentCardNumberRequired:(0,u.A)(n),isInstrumentFeatureAvailable:z,isLoadingInstruments:_(),isPaymentDataRequired:w(),isSignedIn:!D,loadInstruments:t.loadInstruments,method:r,renderCustomPaymentForm:S,setFieldValue:b,setSubmit:E,setValidationSchema:C,shouldRenderCustomInstrument:!0,signOut:t.signOutCustomer},c))};const E=(0,n(19285).A)((e=>{var t,{checkoutService:n,checkoutState:a,method:r,paymentForm:o}=e,l=(0,i.__rest)(e,["checkoutService","checkoutState","method","paymentForm"]);return(null===(t=r.initializationData)||void 0===t?void 0:t.embeddedOneClickEnabled)?s.createElement(b,Object.assign({checkoutService:n,checkoutState:a,method:r,paymentForm:o},l)):s.createElement(d,Object.assign({checkoutService:n,checkoutState:a,method:r,paymentForm:o},l))}),[{id:"bolt"}])},62677:(e,t,n)=>{n.d(t,{A:()=>w});var i=n(70355),a=n(49655),s=n(24750),r=n(40052),d=n(35393),o=n(97834),l=n(22437),u=n(3375),c=n.n(u),m=n(52921),h=n.n(m),y=n(69440),p=n(86516),g=n(47237),I=n(29905);const b=({className:e,instrument:t,testId:n,shouldHideExpiryDate:s=!1,onClick:r})=>{var d;const o=(0,I.A)(t.brand),u=h().getTypeInfo(o),m=!(0,l.expirationDate)({month:t.expiryMonth,year:t.expiryYear}).isValid;return i.createElement("button",{className:e,"data-test":n,onClick:r,type:"button"},i.createElement("div",{className:c()("instrumentSelect-details",{"instrumentSelect-details--expired":m})},i.createElement(p.A,{cardType:o}),i.createElement("div",{className:"instrumentSelect-card","data-test":`${null!=n?n:""}-last4`},u?i.createElement(a.A,{data:{cardTitle:null!==(d=u.niceType)&&void 0!==d?d:"",endingIn:t.last4},id:"payment.instrument_ending_in_text"}):i.createElement(a.A,{data:{endingIn:t.last4},id:"payment.instrument_default_ending_in_text"})),!s&&i.createElement("div",{className:c()("instrumentSelect-expiry",{"instrumentSelect-expiry--expired":m}),"data-test":`${n||""}-expiry`},m?i.createElement(a.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expired_text"}):i.createElement(a.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expires_text"}))))},E=({instrument:e,shouldHideExpiryDate:t=!1,onClick:n=y.noop})=>{const a=(0,i.useCallback)((()=>{n(e.bigpayToken)}),[n,e]);return i.createElement(b,{instrument:e,onClick:a,shouldHideExpiryDate:t,testId:"instrument-select-option"})},C=({className:e,testId:t,onClick:n=y.noop})=>i.createElement("button",{className:e,"data-test":t,onClick:n,type:"button"},i.createElement("div",{className:"instrumentSelect-details instrumentSelect-details--addNew"},i.createElement(p.A,null),i.createElement("div",{className:"instrumentSelect-card"},i.createElement(a.A,{id:"payment.instrument_add_card_action"})))),f=({instruments:e,selectedInstrumentId:t,shouldHideExpiryDate:n=!1,onSelectInstrument:a,onUseNewInstrument:s})=>i.createElement("ul",{className:"instrumentSelect-dropdownMenu instrumentSelect-dropdownMenuNext dropdown-menu","data-test":"instrument-select-menu"},e.map((e=>i.createElement("li",{className:c()("instrumentSelect-option dropdown-menu-item",{"instrumentSelect-option--selected":e.bigpayToken===t}),key:e.bigpayToken},i.createElement(E,{instrument:e,onClick:a,shouldHideExpiryDate:n,testId:"instrument-select-option"})))),i.createElement("li",{className:"instrumentSelect-option instrumentSelect-option--addNew dropdown-menu-item"},i.createElement(C,{onClick:s,testId:"instrument-select-option-use-new"}))),v=({instrument:e,shouldHideExpiryDate:t=!1,testId:n,onClick:a})=>e?i.createElement(b,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",instrument:e,onClick:a,shouldHideExpiryDate:t,testId:n}):i.createElement(C,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",testId:n}),S=({field:e,form:t,instruments:n,onSelectInstrument:a,onUseNewInstrument:s,selectedInstrumentId:r,shouldHideExpiryDate:d=!1})=>{const o=(0,i.useRef)(r),l=(0,i.useCallback)(((n="")=>{t.setFieldValue(e.name,n)}),[t,e.name]);(0,i.useEffect)((()=>(setTimeout((()=>l(r))),()=>{""===e.value&&void 0!==r&&l()})),[]),(0,i.useEffect)((()=>{o.current!==r&&setTimeout((()=>l(r))),o.current=r}),[r,l]);const u=(0,y.find)(n,{bigpayToken:r});return i.createElement("div",{className:"instrumentSelect"},i.createElement(g.A,{dropdown:i.createElement(f,{instruments:n,onSelectInstrument:a,onUseNewInstrument:s,selectedInstrumentId:r,shouldHideExpiryDate:d})},i.createElement(v,{instrument:u,shouldHideExpiryDate:d,testId:"instrument-select"}),i.createElement("input",Object.assign({type:"hidden"},e))))};var k=n(3701);const w=(0,i.memo)((({instruments:e,onDeleteInstrument:t,onSelectInstrument:n,onUseNewInstrument:l,selectedInstrumentId:u,shouldHideExpiryDate:c=!1,validateInstrument:m=null})=>{const h=(0,i.useCallback)((t=>i.createElement(S,Object.assign({},t,{instruments:e,onSelectInstrument:n,onUseNewInstrument:l,selectedInstrumentId:u,shouldHideExpiryDate:c}))),[e,n,l,u,c]),y=(0,i.useCallback)((n=>i.createElement(k.A,Object.assign({instruments:e,onDeleteInstrument:t},n))),[e,t]);return i.createElement(s.A,{additionalClassName:"instrumentFieldset",legend:i.createElement(r.A,{hidden:!0},i.createElement(a.A,{id:"payment.instrument_text"}))},i.createElement(d.A,{modal:y},(({onClick:e})=>i.createElement("button",{className:"instrumentModal-trigger",onClick:e,type:"button"},i.createElement(a.A,{id:"payment.instrument_manage_button"})))),i.createElement(o.A,{name:"instrumentId",render:h}),i.createElement("div",{style:{display:u?void 0:"none"}},m))}))},89799:(e,t,n)=>{n.d(t,{A:()=>E});var i=n(31635),a=n(69440),s=n(70355),r=n(52137),d=n(43125),o=n(11474),l=n(62677),u=n(40646),c=n(91182),m=n(3375),h=n.n(m),y=n(72769),p=n(49655);const g=({buttonId:e,shouldShowEditButton:t})=>{if(t){const t=s.createElement(p.A,{id:"remote.select_different_card_action"});return s.createElement("p",null,s.createElement("button",{className:h()("stepHeader","widget-link-amazonpay"),id:e,onClick:(0,y.A)(),type:"button"},t))}return null},I=({shouldShowDescriptor:e,paymentDescriptor:t})=>e&&t?s.createElement("div",{className:"payment-descriptor"},t):null,b=({additionalContainerClassName:e,containerId:t,hideContentWhenSignedOut:n,hideWidget:i,isSignInRequired:a,isSignedIn:r,method:d,renderCustomPaymentForm:o,shouldRenderCustomInstrument:l,shouldShowCreditCardFieldset:u})=>s.createElement("div",{className:h()("widget",`widget--${d.id}`,"payment-widget",l?"":e),id:t,style:{display:n&&a&&!r||!u||i?"none":void 0},tabIndex:-1},l&&o&&o()),E=({instruments:e,hideWidget:t=!1,isInitializing:n=!1,isAccountInstrument:m,isInstrumentFeatureAvailable:h,isLoadingInstruments:y,shouldHideInstrumentExpiryDate:p=!1,shouldShow:E=!0,hideVerificationFields:C,method:f,storedCardValidationSchema:v,isPaymentDataRequired:S,setValidationSchema:k,loadInstruments:w,onUnhandledError:A=a.noop,deinitializeCustomer:_,deinitializePayment:N,setSubmit:x,initializeCustomer:D,initializePayment:z,signInCustomer:P,isSignedIn:F,isSignInRequired:M,isInstrumentCardNumberRequired:R,validateInstrument:T,containerId:O,hideContentWhenSignedOut:V=!1,renderCustomPaymentForm:U,additionalContainerClassName:H,shouldRenderCustomInstrument:B=!1,paymentDescriptor:j,shouldShowDescriptor:q,shouldShowEditButton:L,buttonId:W,setFieldValue:$})=>{const[Y,G]=(0,s.useState)(!1),[J,K]=(0,s.useState)(void 0),Q=(0,s.useRef)(e);(0,s.useEffect)((()=>{Q.current=e}),[e]);const X=(0,s.useCallback)((()=>{if(Y)return;const e=Q.current.find((e=>e.defaultInstrument))||Q.current[0];return e?e.bigpayToken:void 0}),[Y]),Z=(0,s.useCallback)((()=>{const e=J||X();return(0,a.find)(Q.current,{bigpayToken:e})}),[J,X]),ee=(0,s.useCallback)((()=>{if(!S)return null;const e=Z();return h&&e&&v||null}),[Z,h,S,v]),te=(0,s.useCallback)(((e,t)=>!e&&(0,r.T)(t)?t:void 0),[]),ne=(0,s.useCallback)((t=>{if(0===e.length)return G(!0),K(void 0),void $("instrumentId","");if(J===t){const e=X();K(e),$("instrumentId",e)}}),[e,J,X]),ie=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){G(!0),K(void 0),N&&(yield N({gatewayId:f.gateway,methodId:f.id})),z&&(yield z({gatewayId:f.gateway,methodId:f.id}))}))),[f,N,z]),ae=(0,s.useCallback)((e=>{G(!1),K(e)}),[]),se=(0,s.useCallback)((()=>{const t=J||X(),n=(0,a.find)(e,{bigpayToken:t});if(n){(0,d.A)(n);const e=R(n,f);if(C)return;if(T)return T(e,n)}}),[J,X,e,f,C,T]),re=()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){const e=Q.current;if(!S)return void x(f,null);if(M&&!F)return x(f,P||null),D?D({methodId:f.id}):void 0;let t;if(x(f,null),!Y){const n=J||X(),i=e.find((e=>e.bigpayToken===n))||e[0];i&&(0,d.a)(i)&&(t=i)}return z?z({gatewayId:f.gateway,methodId:f.id},t):void 0})),de=J||X(),oe=de&&e.find((e=>e.bigpayToken===de))||e[0],le=e.filter((e=>!(0,r.T)(e))),ue=e.filter((e=>(0,r.T)(e))),ce=h&&e.length>0,me=!ce||Y,he=(n||y)&&!t,ye=oe?te(Y,oe):void 0,pe=e[0]&&(0,r.T)(e[0]);(0,s.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){k(f,ee());try{h&&(yield null==w?void 0:w()),yield re()}catch(e){e instanceof Error&&A(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){k(f,null),x(f,null);try{N&&(yield N({gatewayId:f.gateway,methodId:f.id})),_&&(yield _({methodId:f.id}))}catch(e){e instanceof Error&&A(e)}}))})),[]);const ge=(0,s.useRef)(!0),Ie=(0,s.useRef)(e.length),be=(0,s.useRef)(S),Ee=(0,s.useRef)(J);return(0,s.useEffect)((()=>{if(ge.current)return void(ge.current=!1);k(f,ee());(Ee.current!==J||Number(Ie.current)>0&&0===e.length||be.current!==S)&&(Ee.current=J,Ie.current=e.length,be.current=S,(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{N&&(yield N({gatewayId:f.gateway,methodId:f.id})),yield re()}catch(e){e instanceof Error&&A(e)}})))}),[J,e,S]),E?s.createElement(c.A,{hideContentWhenLoading:!0,isLoading:he},s.createElement("div",{className:"paymentMethod--hosted"},pe&&ce&&s.createElement(o.A,{instruments:ue,onSelectInstrument:ae,onUseNewInstrument:ie,selectedInstrument:ye}),!pe&&ce&&s.createElement(l.A,{instruments:le,onDeleteInstrument:ne,onSelectInstrument:ae,onUseNewInstrument:ie,selectedInstrumentId:de,shouldHideExpiryDate:p,validateInstrument:se()}),s.createElement(I,{paymentDescriptor:j,shouldShowDescriptor:q}),s.createElement(b,{additionalContainerClassName:H,containerId:O,hideContentWhenSignedOut:V,hideWidget:t,isSignInRequired:M,isSignedIn:F,method:f,renderCustomPaymentForm:U,shouldRenderCustomInstrument:B,shouldShowCreditCardFieldset:me}),h&&s.createElement(u.A,{instrumentId:de,instruments:e,isAccountInstrument:Boolean(m||pe)}),s.createElement(g,{buttonId:W,shouldShowEditButton:L}))):s.createElement("div",{style:{display:"none"}})}},94611:(e,t,n)=>{function i({config:e,customer:t,isUsingMultiShipping:n,paymentMethod:i}){return!(!e.checkoutSettings.isCardVaultingEnabled||!i.config.isVaultingEnabled||t.isGuest||n)}n.d(t,{A:()=>i})}}]);
//# sourceMappingURL=bolt-payment-method-4dfd26e4.js.map