"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[920],{31698:(e,t,i)=>{i.d(t,{A:()=>m});var n=i(31635),r=i(44218),a=i(69440),o=i(70355),s=i(65685),d=i(94611),c=i(11474),u=i(40646),l=i(91182);const m=e=>{const{description:t,isInitializing:i=!1,initializePayment:m,method:h,onUnhandledError:p=a.noop,deinitializePayment:y}=e,[g,b]=(0,o.useState)(!1),[f,v]=(0,o.useState)(),I=function(e){const t=(0,r.B4)(((e=[])=>e.filter(s.A))),i=(0,r.B4)(((e=[])=>e.filter((({trustedShippingAddress:e})=>e)))),{checkoutService:n,checkoutState:a,isUsingMultiShipping:o=!1,method:c}=e,{data:{getCart:u,getConfig:l,getCustomer:m,getInstruments:h,isPaymentDataRequired:p,isPaymentDataSubmitted:y},statuses:{isLoadingInstruments:g}}=a,b=u(),f=l(),v=m();if(!f||!b||!v)throw new Error("Unable to get checkout");const I=t(h(c)),w=i(I);return{instruments:w,isNewAddress:0===w.length&&I.length>0,isInstrumentFeatureAvailable:!y(c.id,c.gateway)&&(0,d.A)({config:f,customer:v,isUsingMultiShipping:o,paymentMethod:c}),isLoadingInstruments:g(),isPaymentDataRequired:p(),loadInstruments:n.loadInstruments}}(e),{isLoadingInstruments:w,instruments:S,isNewAddress:_,isInstrumentFeatureAvailable:z,loadInstruments:P}=I,k=(0,o.useCallback)((()=>{if(!g&&S.length)return(0,a.find)(S,{defaultInstrument:!0})||S[0]}),[g,S]),E=(0,o.useCallback)((()=>{b(!0),v(void 0)}),[]),F=(0,o.useCallback)((e=>{b(!1),v((0,a.find)(S,{bigpayToken:e}))}),[S]);(0,o.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield m({gatewayId:h.gateway,methodId:h.id}),z&&(yield P())}catch(e){p(e)}})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield y({gatewayId:h.gateway,methodId:h.id})}catch(e){p(e)}}))})),[]);const O=f||k(),N=i||w,C=z&&(S.length>0||_);return t||z?o.createElement(l.A,{hideContentWhenLoading:!0,isLoading:N},o.createElement("div",{className:"paymentMethod paymentMethod--hosted"},t,C&&o.createElement(c.A,{instruments:S,onSelectInstrument:F,onUseNewInstrument:E,selectedInstrument:O}),z&&o.createElement(u.A,{instrumentId:O&&O.bigpayToken,instruments:S,isAccountInstrument:!0}))):null}},41256:(e,t,i)=>{i.d(t,{BarclaycardPaymentMethod:()=>s});var n=i(31635),r=i(94365),a=i(70355),o=i(31698);const s=(0,i(19285).A)((e=>{var{checkoutService:t,checkoutState:i,method:s,paymentForm:d}=e,c=(0,n.__rest)(e,["checkoutService","checkoutState","method","paymentForm"]);const u=(0,a.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{integrations:[r.p]}))),[t]);return a.createElement(o.A,Object.assign({},c,{checkoutService:t,checkoutState:i,deinitializePayment:t.deinitializePayment,initializePayment:u,method:s,paymentForm:d}))}),[{gateway:"barclaycard"}])},94365:(e,t,i)=>{i.d(t,{p:()=>p});var n,r,a=i(58002);class o extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class s extends o{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class d extends o{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}class c extends s{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}(r=n||(n={}))[r.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",r[r.CustomerNotInitialized=1]="CustomerNotInitialized",r[r.PaymentNotInitialized=2]="PaymentNotInitialized",r[r.ShippingNotInitialized=3]="ShippingNotInitialized",r[r.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized";class u extends o{constructor(e){super(function(e){switch(e){case n.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case n.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case n.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case n.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}var l=function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{d(n.next(e))}catch(e){a(e)}}function s(e){try{d(n.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}d((n=n.apply(e,t||[])).next())}))},m=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};class h{constructor(e){this._paymentIntegrationService=e}execute(e,t){var i,n;return this._isHostedPaymentFormEnabled(null===(i=e.payment)||void 0===i?void 0:i.methodId,null===(n=e.payment)||void 0===n?void 0:n.gatewayId)&&this._shouldRenderHostedForm?this._executeWithHostedForm(e,t):this._executeWithoutHostedForm(e,t)}initialize(e){if(!this._isHostedPaymentFormEnabled(null==e?void 0:e.methodId,null==e?void 0:e.gatewayId)||!this._isHostedFieldAvailable(e))return this._shouldRenderHostedForm=!1,Promise.resolve();const t=e&&e.creditCard&&e.creditCard.form,i=this._paymentIntegrationService.getState(),{paymentSettings:{bigpayBaseUrl:n=""}={}}=i.getStoreConfigOrThrow();if(!t)throw new s;const r=this._paymentIntegrationService.createHostedForm(n,t);return r.attach().then((()=>(this._shouldRenderHostedForm=!0,this._hostedForm=r,Promise.resolve())))}deinitialize(){return this._hostedForm&&this._hostedForm.detach(),Promise.resolve()}finalize(){return Promise.reject(new d)}_executeWithoutHostedForm(e,t){return l(this,void 0,void 0,(function*(){const{payment:i}=e,n=m(e,["payment"]),r=i&&i.paymentData;if(!i||!r)throw new c(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(n,t),yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},i),{paymentData:r}))}))}_executeWithHostedForm(e,t){return l(this,void 0,void 0,(function*(){const{payment:i}=e,r=m(e,["payment"]),a=this._hostedForm;if(!a)throw new u(n.PaymentNotInitialized);if(!i||!i.methodId)throw new c(["payment.methodId"]);yield this._paymentIntegrationService.submitOrder(r,t),yield a.validate().then((()=>a.submit(i)))}))}_isHostedPaymentFormEnabled(e,t){return!!e&&!0===this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t).config.isHostedFormEnabled}_isHostedFieldAvailable(e){return!(0,a.values)(e&&e.creditCard&&e.creditCard.form.fields).every(a.isNil)}}const p=(y=e=>new h(e),g=[{default:!0}],Object.assign(y,{resolveIds:g}));var y,g},94611:(e,t,i)=>{function n({config:e,customer:t,isUsingMultiShipping:i,paymentMethod:n}){return!(!e.checkoutSettings.isCardVaultingEnabled||!n.config.isVaultingEnabled||t.isGuest||i)}i.d(t,{A:()=>n})}}]);
//# sourceMappingURL=barclaycard-payment-method-79729eb3.js.map