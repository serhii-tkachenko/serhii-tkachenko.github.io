"use strict";var checkout;(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[251],{372:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(31635),r=n(3375),o=n.n(r),a=n(70355);const s=e=>{var{children:t,className:n,hidden:r,testId:s,isFloatingLabelEnabled:d,additionalClassName:c}=e,l=(0,i.__rest)(e,["children","className","hidden","testId","isFloatingLabelEnabled","additionalClassName"]);return a.createElement("label",Object.assign({},l,{className:o()({"floating-label":d},n||"form-label",{"is-srOnly":r},"optimizedCheckout-form-label",c),"data-test":s}),t)}},2156:(e,t,n)=>{n.d(t,{A:()=>d,l:()=>i});var i,r=n(31635),o=n(3375),a=n.n(o),s=n(70355);function d(e){return(0,s.memo)((t=>{var{additionalClassName:n,size:o,testId:d}=t,c=(0,r.__rest)(t,["additionalClassName","size","testId"]);return s.createElement("div",{className:a()("icon",n,o===i.Small?"icon--small":null,o===i.Large?"icon--large":null,o===i.Medium?"icon--medium":null),"data-test":d},s.createElement(e,Object.assign({},c)))}))}!function(e){e.Regular="regular",e.Small="small",e.Medium="medium",e.Large="large"}(i||(i={}))},2398:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(29561);const r=(0,n(19445).A)(i.A,{displayNamePrefix:"WithAnalytics"})},4209:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(69440);function r(e){return!!e.length&&(0,i.every)(e,(e=>{var t;return e.selectedShippingOption&&e.selectedShippingOption.id||"custom"===(null===(t=e.selectedShippingOption)||void 0===t?void 0:t.type)}))}},4266:()=>{},4853:(e,t,n)=>{n.d(t,{A:()=>i});class i extends Error{constructor({data:e={},message:t="",title:n="",name:r=""}){super(),"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,i):this.stack=(new Error).stack,this.data=e,this.message=t,this.name=r,this.title=n,this.type="custom"}setDefaultValues({name:e,defaultError:t,defaultTitle:n}){this.name=this.name||e,this.message=this.message||t,this.title=this.title||n}}},4899:(e,t,n)=>{n.d(t,{A:()=>c});var i=n(31635),r=n(44218),o=n(69462),a=n(69440),s=n(70355),d=n(9343);const c=(0,s.memo)((e=>{var{className:t,testId:n}=e,c=(0,i.__rest)(e,["className","testId"]);const l=(0,s.useRef)({containerRef:(0,s.createRef)()}),u=()=>{var e,t;const{current:n}=l.current.containerRef;if(!n)return;const i=n.querySelector([".form-field--error input",".form-field--error textarea",".form-field--error select"].join(", "));if(i){i.focus({preventScroll:!0});try{null===(e=i.offsetParent)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}catch(e){null===(t=i.offsetParent)||void 0===t||t.scrollIntoView()}}},h=(0,s.useCallback)((0,r.B4)((e=>()=>{e(!0),setTimeout((()=>u()))})),[u]),m=(0,s.useCallback)((0,r.B4)((({setSubmitted:e})=>s.createElement("div",{ref:l.current.containerRef},s.createElement(o.lV,Object.assign({},c,{className:t,"data-test":n,noValidate:!0,onSubmitCapture:h(e)}))))),[t,h,n,...(0,a.values)(c)]);return s.createElement(d.Op,null,m)}))},4907:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(69440),r=n(14580);function o(e){let t;return t=e&&(0,r.A)()?`/checkout/order-confirmation/${e.toString()}`:`${window.location.pathname.replace(/\/$/,"")}/order-confirmation`,window.location.replace(t),new Promise(i.noop)}},6663:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(69440);function r(e){const t=[];return(0,i.forIn)(e,((e,n)=>{let r;if((0,i.isDate)(e)){const t=(0,i.padStart)((e.getMonth()+1).toString(),2,"0"),n=(0,i.padStart)(e.getDate().toString(),2,"0");r=`${e.getFullYear()}-${t}-${n}`}else r=e;t.push({fieldId:n,fieldValue:r})})),t}},7944:(e,t,n)=>{var i;n.d(t,{f:()=>i}),function(e){e.Info="info",e.Warning="warning",e.Error="error",e.Debug="debug"}(i||(i={}))},8284:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(70355);const r=(0,n(45080).A)((()=>i.createElement("svg",{"aria-labelledby":"iconCardBoltTitle","data-test":"bolt-icon",height:"12",role:"img",viewBox:"0 0 12 12",width:"12",xmlns:"http://www.w3.org/2000/svg"},i.createElement("title",{id:"iconCardBoltTitle"},"Bolt"),i.createElement("path",{d:"M0 7.502h7.5v4.5L12 4.502H4.5V0z",fill:"#FFFFFF",id:"mark"}))))},8542:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355);class r extends i.Component{constructor(){super(...arguments),this.state={}}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e){const{filter:t=()=>!0,logger:n}=this.props;if(!t(e))throw e;n&&n.log(e,{errorCode:"ErrorBoundary"})}render(){const{children:e,fallback:t,filter:n=()=>!0}=this.props,{error:i}=this.state;return i&&n(i)?t||null:e}}const o=r},9343:(e,t,n)=>{n.d(t,{Ay:()=>s,Op:()=>a});var i=n(69440),r=n(70355);const o=(0,r.createContext)({isSubmitted:!1,setSubmitted:i.noop}),a=(0,r.memo)((({children:e,initialIsSubmitted:t=!1})=>{const[n,a]=(0,r.useState)(t),s=(0,r.useMemo)((()=>({isSubmitted:n,setSubmitted:a})),[n]);return r.createElement(o.Provider,{value:s},(0,i.isFunction)(e)?e({isSubmitted:n,setSubmitted:a}):e)})),s=o},9597:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(69440);function r(e,t){return(0,i.reduce)(e,((e,t)=>e+t.lineItemIds.length),0)<t.physicalItems.filter((e=>!e.addedByPromotion)).length}},10063:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_e});var i=n(98227),r=n(70355),o=n(38003),a=n.n(o),s=n(53156),d=n(54298),c=n(8542),l=n(84087),u=n(94027),h=n(23013),m=n(86620),p=(n(4266),n(22460)),y=n(50981),g=n(51077);class v{constructor(e=(0,g.createRequestSender)()){this.requestSender=e}create(e){return this.requestSender.put("/internalapi/v1/checkout/customer",{body:e}).then((e=>e.body.data.customer))}}var f=n(39009),b=n(39981),S=n(64022),C=n(87980),w=n(4853),_=n(85021);class I extends w.A{constructor(e,t){super({name:"ACCOUNT_CREATION_REQUIREMENTS_ERROR",message:t,title:(0,l.A)().translate("customer.create_account_requirements_error_heading"),data:e}),(0,_.h)(this,I.prototype)}}class P extends w.A{constructor(e){super({name:"ACCOUNT_CREATION_FAILED",message:(0,l.A)().translate("customer.create_account_error"),data:e}),(0,_.h)(this,P.prototype)}}var E=n(57398),O=n(60045);function A(e){return!(0,E.A)(e)&&!(0,O.A)(e)}const k=function(e){const t=(e.payments||[]).find(A);return t&&t.detail.instructions||""};var T=n(3375),N=n.n(T),M=n(99418),x=n(31689),D=n(23847),z=n(55020),F=n(69462),B=n(94202),R=n(49655),L=n(68512),j=n(46487),U=n(60833),V=n(43586),q=n(4899),H=n(54454),G=n(22375);const $=(0,r.memo)((({minLength:e})=>{const t=(0,r.useCallback)((({field:e})=>r.createElement(H.A,Object.assign({},e,{id:e.name,type:"password"}))),[]),n=(0,r.useCallback)((({field:e})=>r.createElement(H.A,Object.assign({},e,{id:e.name,type:"password"}))),[]),i=(0,r.useMemo)((()=>r.createElement(r.Fragment,null,r.createElement(R.A,{id:"customer.password_label"})," ",r.createElement("small",null,`${e}-`,r.createElement(R.A,{id:"customer.password_minimum_character_label"})))),[e]),o=(0,r.useMemo)((()=>r.createElement(R.A,{id:"customer.password_confirmation_label"})),[]);return r.createElement(r.Fragment,null,r.createElement(G.A,{input:t,labelContent:i,name:"password"}),r.createElement(G.A,{input:n,labelContent:o,name:"confirmPassword"}))})),W=(0,L.A)((0,F.bk)({mapPropsToValues:()=>({password:"",confirmPassword:""}),handleSubmit:(e,{props:{onSignUp:t}})=>{t(e)},validationSchema:({language:e,passwordRequirements:{description:t,numeric:n,alpha:i,minLength:r}})=>(0,B.Ik)({password:(0,B.Yj)().required(t||e.translate("customer.password_required_error")).matches(n,t||e.translate("customer.password_number_required_error")).matches(i,t||e.translate("customer.password_letter_required_error")).min(r,t||e.translate("customer.password_under_minimum_length_error")).max(100,e.translate("customer.password_over_maximum_length_error")),confirmPassword:(0,B.Yj)().required(e.translate("customer.password_confirmation_required_error")).oneOf([(0,B.KR)("password")],e.translate("customer.password_confirmation_error"))})})((0,r.memo)((({isSigningUp:e,customerCanBeCreated:t,passwordRequirements:{minLength:n}})=>r.createElement(U.A,{legend:r.createElement(V.A,null,r.createElement(R.A,{id:t?"customer.create_account_text":"customer.set_password_text"}))},!t&&r.createElement("p",null,r.createElement(R.A,{id:"customer.account_created_text"})),r.createElement(q.A,{className:"guest-signup form"},r.createElement($,{minLength:n}),r.createElement("div",{className:"form-actions"},r.createElement(j.Ay,{id:"createAccountButton",isLoading:e,type:"submit",variant:j.Ak.Primary},r.createElement(R.A,{id:t?"customer.create_account_action":"customer.set_password_action"})))))))));var Y=n(11889);const K=()=>r.createElement(Y.A,{type:Y.v.Success},r.createElement("strong",null,r.createElement(R.A,{id:"customer.set_password_success"}))),Q=()=>r.createElement(Y.A,{type:Y.v.Success},r.createElement("strong",null,r.createElement(R.A,{id:"customer.create_account_success"}))),J=({children:e})=>r.createElement("section",{className:"orderConfirmation-section"},e);var Z=n(48447);const X=({mandateText:e,providerId:t,methodId:n})=>Object.keys(e).length?r.createElement("ul",{"data-test":"order-confirmation-mandate-text-list"},Object.entries(e).map(((e,i)=>r.createElement("li",{"data-test":`order-confirmation-mandate-text-list-item-${i}`,key:i},r.createElement(R.A,{id:`order_confirmation.mandate.${t}.${n}.${e[0]}`}),":",r.createElement("b",null,` ${e[1]}`))))):null,ee=({paymentsWithMandates:e})=>r.createElement(r.Fragment,null,e.map((e=>{var t,n,i;return(null===(t=null==e?void 0:e.mandate)||void 0===t?void 0:t.url)?r.createElement("a",{"data-test":"order-confirmation-mandate-link-text",href:e.mandate.url,key:`${e.providerId}-${e.methodId}-mandate`,rel:"noopener noreferrer",target:"_blank"},r.createElement(R.A,{id:`order_confirmation.mandate.${e.providerId}.${e.methodId}`})):(null===(n=null==e?void 0:e.mandate)||void 0===n?void 0:n.id)?r.createElement("p",{"data-test":"order-confirmation-mandate-id-text",key:`${e.providerId}-${e.methodId}-mandate`},r.createElement(R.A,{data:{mandate:e.mandate.id},id:`order_confirmation.mandate.${e.providerId}.${e.methodId}`})):(null===(i=null==e?void 0:e.mandate)||void 0===i?void 0:i.mandateText)&&e.methodId?r.createElement(X,{key:"mandateTextList",mandateText:e.mandate.mandateText,methodId:e.methodId,providerId:e.providerId}):void 0}))),te=e=>!!e.methodId&&"mandate"in e&&!!e.mandate,ne=({config:e,orderNumber:t,orderStatus:n,supportEmail:i,supportPhoneNumber:o})=>{switch(n){case"MANUAL_VERIFICATION_REQUIRED":case"AWAITING_PAYMENT":return r.createElement(Z.A,{id:"order_confirmation.order_pending_review_text"});case"PENDING":return r.createElement(Z.A,{data:{orderNumber:t,supportEmail:i},id:"order_confirmation.order_pending_status_text"});case"INCOMPLETE":return e.checkoutSettings.features["CHECKOUT-6891.update_incomplete_order_wording_on_order_confirmation_page"]?r.createElement(Z.A,{data:{orderNumber:t,supportEmail:i},id:"order_confirmation.order_pending_status_text"}):r.createElement(Z.A,{data:{orderNumber:t,supportEmail:i},id:"order_confirmation.order_incomplete_status_text"});default:return r.createElement(Z.A,{data:{orderNumber:t,supportEmail:i,supportPhoneNumber:o},id:o?"order_confirmation.order_with_support_number_text":"order_confirmation.order_without_support_number_text"})}},ie=(0,r.memo)((({config:e,order:t,supportEmail:n,supportPhoneNumber:i})=>{var o;const a=(null===(o=t.payments)||void 0===o?void 0:o.filter(te))||[];return r.createElement(J,null,t.orderId&&r.createElement("p",{"data-test":"order-confirmation-order-number-text"},r.createElement(Z.A,{data:{orderNumber:t.orderId},id:"order_confirmation.order_number_text"})),r.createElement("p",{"data-test":"order-confirmation-order-status-text"},r.createElement(ne,{config:e,orderNumber:t.orderId,orderStatus:t.status,supportEmail:n,supportPhoneNumber:i})),r.createElement(ee,{paymentsWithMandates:a}),t.hasDigitalItems&&r.createElement("p",{"data-test":"order-confirmation-digital-items-text"},r.createElement(Z.A,{id:t.isDownloadable?"order_confirmation.order_with_downloadable_digital_items_text":"order_confirmation.order_without_downloadable_digital_items_text"})))})),re=({children:e,testId:t})=>r.createElement("h1",{className:"optimizedCheckout-headingPrimary","data-test":t},e),oe=(0,r.memo)((({name:e})=>r.createElement(re,{testId:"order-confirmation-heading"},e&&r.createElement(R.A,{data:{name:e},id:"order_confirmation.thank_you_customer_heading"}),!e&&r.createElement(R.A,{id:"order_confirmation.thank_you_heading"})))),ae=({siteLink:e})=>r.createElement("div",{className:"continueButtonContainer"},r.createElement("form",{action:e,method:"get",target:"_top"},r.createElement(j.Ay,{type:"submit",variant:j.Ak.Secondary},r.createElement(R.A,{id:"order_confirmation.continue_shopping"}))));var se=n(57345),de=n(99838),ce=n(26946),le=n(41408);function ue(e){return e.filter(E.A).map((({amount:e,detail:t})=>({code:t.code,remaining:t.remaining,used:e,balance:e+t.remaining,purchaseDate:""})))}function he(e){return(e||[]).filter(O.A).reduce(((e,t)=>e+t.amount),0)}function me({baseAmount:e,discountAmount:t,isTaxIncluded:n,shippingCostBeforeDiscount:i,payments:r,handlingCostTotal:o,giftWrappingCostTotal:a,coupons:s,taxes:d,fees:c,consignments:l},u){const h=u&&l.shipping.length>0?function(e,t){return t.reduce(((e,t)=>e-function(e){return e.discounts.filter((e=>!e.code)).reduce(((e,t)=>e+t.amount),0)}(t)),e)}(i,l.shipping):i;return{subtotalAmount:e,shippingAmount:h,shippingAmountBeforeDiscount:u?i:void 0,giftWrappingAmount:a,discountAmount:t,storeCreditAmount:he(r),handlingAmount:o,coupons:s,giftCertificates:r&&ue(r),taxes:d,isTaxIncluded:n,fees:c}}var pe=n(69440),ye=n(72769);const ge=(0,n(45080).A)((()=>r.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},r.createElement("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"})))),ve=(0,r.memo)((({className:e})=>{const t=(0,r.useCallback)((0,pe.throttle)((()=>{window.print()}),500),[]);return"function"!=typeof window.print?null:r.createElement("a",{className:e||"cart-header-link",href:"#",id:"cart-print-link",onClick:(0,ye.A)(t)},r.createElement(ge,null)," ",r.createElement(R.A,{id:"cart.print_action"}))})),fe=(0,r.lazy)((()=>(0,ce.A)((()=>Promise.all([n.e(1123),n.e(5134)]).then(n.bind(n,58512)))))),be=(0,r.lazy)((()=>(0,ce.A)((()=>Promise.all([n.e(1123),n.e(8720)]).then(n.bind(n,4822)))))),Se=({currency:e,isShippingDiscountDisplayEnabled:t,order:n,shopperCurrency:i})=>r.createElement(le.A,null,(o=>o?r.createElement(se.A,{loadingSkeleton:r.createElement(r.Fragment,null)},r.createElement(be,Object.assign({},me(n,t),{headerLink:r.createElement(ve,{className:"modal-header-link cart-modal-link"}),lineItems:n.lineItems,shopperCurrency:i,storeCurrency:e,total:n.orderAmount}))):r.createElement(se.A,{loadingSkeleton:r.createElement(de.W,null)},r.createElement("aside",{className:"layout-cart"},r.createElement(fe,Object.assign({headerLink:r.createElement(ve,null)},me(n,t),{lineItems:n.lineItems,shopperCurrency:i,storeCurrency:e,total:n.orderAmount})))))),Ce=({config:e,currency:t,customerCanBeCreated:n,error:i,hasSignedUp:o,isShippingDiscountDisplayEnabled:a,isSigningUp:s,onErrorModalClose:d,onSignUp:c,order:l,paymentInstructions:u,shopperConfig:h,shopperCurrency:m,shouldShowPasswordForm:p,siteLink:y,supportEmail:g,supportPhoneNumber:v})=>r.createElement("div",{className:N()("layout optimizedCheckout-contentPrimary",{"is-embedded":(0,z.A)()})},r.createElement("div",{className:"layout-main"},r.createElement("div",{className:"orderConfirmation"},r.createElement(oe,{name:l.billingAddress.firstName}),r.createElement(ie,{config:e,order:l,supportEmail:g,supportPhoneNumber:v}),u&&r.createElement(J,null,r.createElement("div",{dangerouslySetInnerHTML:{__html:M.A.sanitize(u)},"data-test":"payment-instructions"})),p&&!o&&r.createElement(W,{customerCanBeCreated:n,isSigningUp:s,onSignUp:c,passwordRequirements:(0,D.m)(h)}),o&&((null==l?void 0:l.customerId)?r.createElement(K,null):r.createElement(Q,null)),r.createElement(ae,{siteLink:y}))),r.createElement(Se,{currency:t,isShippingDiscountDisplayEnabled:a,order:l,shopperCurrency:m}),r.createElement(x.A,{error:i,onClose:d,shouldShowErrorCode:!1})),we=({containerId:e,createAccount:t,createEmbeddedMessenger:n,embeddedStylesheet:i,orderId:o,errorLogger:a})=>{const[s,d]=(0,r.useState)(),[c,l]=(0,r.useState)(),[u,h]=(0,r.useState)(),m=(0,r.useRef)(),{checkoutState:{data:{getOrder:p,getConfig:y},statuses:{isLoadingOrder:g}},checkoutService:{loadOrder:v}}=(0,b.Q)(),{analyticsTracker:w}=(0,f.A)(),_=y(),E=p(),O=e=>{d(e),a.log(e),m.current&&m.current.postError(e)};if((0,r.useEffect)((()=>{v(o).then((({data:t})=>{const{links:{siteLink:r=""}={}}=t.getConfig()||{},o=n({parentOrigin:r});m.current=o,o.receiveStyles((e=>i.append(e))),o.postFrameLoaded({contentId:e}),w.orderPurchased()})).catch(O)}),[]),!E||!_||g())return r.createElement(S.A,null);const A=k(E),{checkoutSettings:T,currency:N,shopperConfig:M,shopperCurrency:x,storeProfile:{orderEmail:D,storePhoneNumber:z},links:{siteLink:F}}=_,B=E.customerCanBeCreated,R=!E.customerId,L=(0,C.A)(T,"PROJECT-6643.enable_shipping_discounts_in_orders");return r.createElement(Ce,{config:_,currency:N,customerCanBeCreated:R,error:s,hasSignedUp:c,isShippingDiscountDisplayEnabled:L,isSigningUp:u,onErrorModalClose:()=>{d(void 0)},onSignUp:({password:e,confirmPassword:n})=>{const i=_&&_.shopperConfig,r=i&&i.passwordRequirements&&i.passwordRequirements.error||"";h(!0),t({password:e,confirmPassword:n}).then((()=>{l(!0),h(!1)})).catch((e=>{d(e.status<500?new I(e,r):new P(e)),l(!1),h(!1)}))},order:E,paymentInstructions:A,shopperConfig:M,shopperCurrency:x,shouldShowPasswordForm:B,siteLink:F,supportEmail:D,supportPhoneNumber:z})},_e=({containerId:e,orderId:t,publicPath:n,sentryConfig:o,sentrySampleRate:g})=>{const f=(0,r.useMemo)((()=>new v),[]),b=(0,r.useMemo)((()=>(0,p.A)({sentry:o},{errorTypes:["UnrecoverableError"],publicPath:n,sampleRate:g||.1})),[]),S=(0,r.useMemo)((()=>(0,i.O0)({locale:(0,l.A)().getLocale(),shouldWarnMutation:!1,errorLogger:b})),[]),C=(0,r.useMemo)((()=>(0,y.A)()),[]);(0,r.useEffect)((()=>{a().setAppElement(`#${e}`)}),[]);const w=(0,r.useCallback)((({password:e,confirmPassword:n})=>f.create({orderId:t,newsletter:!1,password:e,confirmPassword:n})),[f,t]);return r.createElement(c.A,{logger:b},r.createElement(u.A,{checkoutService:S},r.createElement(h.A,{checkoutService:S},r.createElement(s.A,{checkoutService:S},r.createElement(d.v,{checkoutService:S,errorLogger:(0,p.A)()},r.createElement(m.N,null,r.createElement(we,{containerId:e,createAccount:w,createEmbeddedMessenger:i.ge,embeddedStylesheet:C,errorLogger:b,orderId:t})))))))}},10156:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(31635),r=n(3375),o=n.n(r),a=n(70355),s=n(12056);const d=(0,a.forwardRef)(((e,t)=>{var{additionalClassName:n,isFloatingLabelEnabled:r,appearFocused:d,type:c="text",themeV2:l=!1}=e,u=(0,i.__rest)(e,["additionalClassName","isFloatingLabelEnabled","appearFocused","type","themeV2"]);return a.createElement(s.A,Object.assign({},u,{className:o()("form-input","optimizedCheckout-form-input",{"form-input--focus":d},{"optimizedCheckout-form-input--focus":d},n,{"floating-form-field-input":l&&r},{"body-regular":l&&!r}),isFloatingLabelEnabled:r,ref:t,type:c}))}))},10685:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(44218),r=n(94202),o=n(33740);const a=(0,i.Bj)((function({formFields:e,translate:t=()=>{}}){return(0,r.Ik)({customFields:(0,r.Ik)(e.filter((({custom:e})=>!!e)).reduce(((e,{name:n,label:i,required:a,fieldType:s,type:d,min:c,max:l})=>{let u,h;if("date"===d?e[n]=(0,r.p6)().nullable(!0).transform(((e,t)=>""===t?null:e)):"integer"===d?(e[n]=(0,r.ai)().transform((e=>isNaN(e)?void 0:e)),u="number"==typeof l?l:void 0,h="number"==typeof c?c:void 0):s===o.A.CHECKBOX?e[n]=(0,r.YO)():e[n]=(0,r.Yj)(),void 0!==u&&(e[n]=e[n].max(u,t("max",{label:i,name:n,max:u+1}))),void 0!==h&&(e[n]=e[n].min(h,t("min",{label:i,name:n,min:h-1}))),a){const r=t("required",{name:n,label:i});e[n]=s===o.A.CHECKBOX?e[n].min(1,r):e[n].required(r)}return e}),{})).nullable(!0)})}))},11100:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(81655);let r;function o(){return r=window.matchMedia(`(max-width: ${i.P}px)`),r.matches}},11889:(e,t,n)=>{n.d(t,{v:()=>l,A:()=>u});var i=n(3375),r=n.n(i),o=n(70355),a=n(16599),s=n(45080);const d=(0,s.A)((()=>o.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},o.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})))),c=(0,s.A)((()=>o.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},o.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}))));var l;!function(e){e.Error="error",e.Info="info",e.Success="success",e.Warning="warning"}(l||(l={}));const u=({additionalClassName:e,children:t,icon:n,testId:i,type:s})=>{const u=(0,o.useId)();return o.createElement("div",{"aria-describedby":u,className:r()("alertBox",e,{"alertBox--info":s===l.Info||!s},{"alertBox--error":s===l.Error},{"alertBox--success":s===l.Success},{"alertBox--warning":s===l.Warning}),"data-test":i},o.createElement("div",{className:"alertBox-column alertBox-icon"},n||function(e){switch(e){case l.Error:case l.Warning:return o.createElement(a.A,null);case l.Success:return o.createElement(d,null);case l.Info:default:return o.createElement(c,null)}}(s)),o.createElement("div",{"aria-live":s===l.Error?"assertive":"polite",className:"alertBox-column alertBox-message",id:u,role:s===l.Error?"alert":"status"},t))}},11982:(e,t,n)=>{n.d(t,{Bs:()=>it,HE:()=>at,Kv:()=>Ve,Qp:()=>ct,Rk:()=>be,bg:()=>ue,gi:()=>Ge,oL:()=>Je,uq:()=>se,xU:()=>pe,yU:()=>et});var i,r,o=n(58636),a=n(91195),s=n(38589),d=n(58002),c={};function l(e,t){return Object.assign(e,{resolveIds:t})}c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);class u extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class h extends u{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}(r=i||(i={}))[r.MissingBillingAddress=0]="MissingBillingAddress",r[r.MissingCart=1]="MissingCart",r[r.MissingCheckout=2]="MissingCheckout",r[r.MissingConsignments=3]="MissingConsignments",r[r.MissingCustomer=4]="MissingCustomer",r[r.MissingCheckoutConfig=5]="MissingCheckoutConfig",r[r.MissingOrder=6]="MissingOrder",r[r.MissingOrderConfig=7]="MissingOrderConfig",r[r.MissingOrderId=8]="MissingOrderId",r[r.MissingPayment=9]="MissingPayment",r[r.MissingPaymentId=10]="MissingPaymentId",r[r.MissingPaymentInstrument=11]="MissingPaymentInstrument",r[r.MissingPaymentMethod=12]="MissingPaymentMethod",r[r.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",r[r.MissingPaymentStatus=14]="MissingPaymentStatus",r[r.MissingPaymentToken=15]="MissingPaymentToken",r[r.MissingShippingAddress=16]="MissingShippingAddress";class m extends u{constructor(e){super(function(e){switch(e){case i.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case i.MissingCart:return"Unable to proceed because cart data is unavailable.";case i.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case i.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case i.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case i.MissingCheckoutConfig:case i.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case i.MissingOrder:return"Unable to proceed because order data is unavailable.";case i.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case i.MissingPayment:return"Unable to proceed because payment data is unavailable.";case i.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case i.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case i.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}class p extends u{constructor(e){super(e||"An unexpected error has occurred during buy now cart creation process. Please try again later."),this.name="BuyNowCartCreationError",this.type="buy_now_cart_creation_error"}}const y={body:{},headers:{},status:0};class g extends u{constructor(e,{message:t,errors:n}={}){const{body:i,headers:r,status:o}=e||y;super(t||"An unexpected error has occurred."),this.name="RequestError",this.type="request",this.body=i,this.headers=r,this.status=o,this.errors=n||[]}}var v,f,b,S,C,w,_,I;!function(e){e.BuyNow="BUY_NOW"}(v||(v={})),function(e){e.Possible="POSSIBLE",e.No="NO",e.Unknown="UNKNOWN",e.Yes="YES"}(f||(f={})),function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(b||(b={})),function(e){e.paypal="paypal",e.checkout="checkout",e.buynow="buynow",e.pay="pay",e.installment="installment"}(S||(S={})),function(e){e.gold="gold",e.blue="blue",e.silver="silver",e.black="black",e.white="white"}(C||(C={})),function(e){e.pill="pill",e.rect="rect"}(w||(w={})),function(e){e.OXXO="oxxo"}(_||(_={})),function(e){e.Approved="APPROVED",e.Created="CREATED",e.PayerActionRequired="PAYER_ACTION_REQUIRED",e.PollingStop="POLLING_STOP",e.PollingError="POLLING_ERROR"}(I||(I={}));var P=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class E{constructor(e,t,n,i){this.formPoster=e,this.paymentIntegrationService=t,this.paypalCommerceRequestSender=n,this.paypalCommerceScriptLoader=i}loadPayPalSdk(e,t,n,i){return P(this,void 0,void 0,(function*(){const r=this.paymentIntegrationService.getState(),o=t||r.getCartOrThrow().currency.code,a=r.getPaymentMethodOrThrow(e);return this.paypalSdk=yield this.paypalCommerceScriptLoader.getPayPalSDK(a,o,n,i),this.paypalSdk}))}getPayPalSdkOrThrow(){if(!this.paypalSdk)throw new h;return this.paypalSdk}createBuyNowCartOrThrow(e){return P(this,void 0,void 0,(function*(){const t=e.getBuyNowCartRequestBody();if(!t)throw new m(i.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(t)}catch(e){throw new p}}))}createOrder(e,t){return P(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getCartOrThrow().id,{orderId:i}=yield this.paypalCommerceRequestSender.createOrder(e,Object.assign({cartId:n},t));return i}))}createOrderCardFields(e,t){return P(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getCartOrThrow().id,{orderId:i,setupToken:r}=yield this.paypalCommerceRequestSender.createOrder(e,Object.assign({cartId:n},t));return Object.assign({orderId:i},r?{setupToken:r}:{})}))}updateOrder(){return P(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getConsignmentsOrThrow()[0];try{yield this.paypalCommerceRequestSender.updateOrder({availableShippingOptions:n.availableShippingOptions,cartId:t.id,selectedShippingOption:n.selectedShippingOption})}catch(e){throw new g}}))}getOrderStatus(e,t){return P(this,void 0,void 0,(function*(){try{const{status:n}=yield this.paypalCommerceRequestSender.getOrderStatus(e,t);return n}catch(e){throw new g}}))}tokenizePayment(e,t){const n=this.paymentIntegrationService.getState().getCartOrThrow();if(!t)throw new m(i.MissingOrderId);return this.formPoster.postForm("/checkout.php",Object.assign({payment_type:"paypal",action:"set_external_checkout",provider:e,order_id:t},n.source===v.BuyNow&&{cart_id:n.id}))}submitPayment(e,t,n){return P(this,void 0,void 0,(function*(){const i={formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:null,method_id:e,paypal_account:{order_id:t}}};yield this.paymentIntegrationService.submitPayment(Object.assign({methodId:e,paymentData:i},n?{gatewayId:n}:{}))}))}getShippingOptionOrThrow(e){const t=this.paymentIntegrationService.getState().getConsignmentsOrThrow()[0],n=t.availableShippingOptions||[],i=n.find((e=>e.isRecommended)),r=(e?n.find((t=>t.id===e)):n.find((e=>{var n;return e.id===(null===(n=t.selectedShippingOption)||void 0===n?void 0:n.id)})))||i||n[0];if(!r)throw new Error("Your order can't be shipped to this address");return r}getAddress(e){return{firstName:(null==e?void 0:e.firstName)||"",lastName:(null==e?void 0:e.lastName)||"",email:(null==e?void 0:e.email)||"",phone:(null==e?void 0:e.phone)||"",company:"",address1:(null==e?void 0:e.address1)||"",address2:(null==e?void 0:e.address2)||"",city:(null==e?void 0:e.city)||"",countryCode:(null==e?void 0:e.countryCode)||"",postalCode:(null==e?void 0:e.postalCode)||"",stateOrProvince:"",stateOrProvinceCode:(null==e?void 0:e.stateOrProvinceCode)||"",customFields:[]}}getBillingAddressFromOrderDetails({payer:e}){var t,n;return this.getAddress({firstName:e.name.given_name,lastName:e.name.surname,email:e.email_address,address1:e.address.address_line_1,address2:e.address.address_line_2,city:e.address.admin_area_2,countryCode:e.address.country_code,postalCode:e.address.postal_code,stateOrProvinceCode:e.address.admin_area_1,phone:null===(n=null===(t=e.phone)||void 0===t?void 0:t.phone_number)||void 0===n?void 0:n.national_number})}getShippingAddressFromOrderDetails(e){const{payer:t,purchase_units:n}=e,{address:i,name:{full_name:r}}=n[0].shipping,[o,...a]=r.split(" ");return this.getAddress({firstName:o,lastName:a.join(" "),email:t.email_address,address1:i.address_line_1,address2:i.address_line_2,city:i.admin_area_2,countryCode:i.country_code,postalCode:i.postal_code,stateOrProvinceCode:i.admin_area_1})}getValidButtonStyle(e){const{color:t,height:n,label:i,shape:r}=e||{},o={color:t&&C[t]?t:void 0,height:this.getValidHeight(n),label:i&&S[i]?i:void 0,shape:r&&w[r]?r:void 0};return(0,d.omitBy)(o,d.isNil)}getValidHeight(e){return e&&"number"==typeof e?e>55?55:e<25?25:e:40}removeElement(e){const t=e&&document.getElementById(e);t&&(t.style.display="none")}}const O="This API endpoint is for internal use only and may change in the future";var A;!function(e){e.Json="application/json",e.JsonV1="application/vnd.bc.v1+json"}(A||(A={}));const k=A,T={"X-Checkout-SDK-Version":"1.808.0"};var N=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class M{constructor(e){this.requestSender=e}createOrder(e,t){return N(this,void 0,void 0,(function*(){const n=`/api/storefront/payment/${e}`,i=t,r=Object.assign({"X-API-INTERNAL":O,"Content-Type":k.Json},T);return(yield this.requestSender.post(n,{headers:r,body:i})).body}))}updateOrder(e){return N(this,void 0,void 0,(function*(){const t=e,n=Object.assign({"X-API-INTERNAL":O,"Content-Type":k.Json},T);return(yield this.requestSender.put("/api/storefront/initialization/paypalcommerce",{headers:n,body:t})).body}))}getOrderStatus(e="paypalcommerce",t){return N(this,void 0,void 0,(function*(){const n=`/api/storefront/initialization/${e}`,i=Object.assign({"X-API-INTERNAL":O,"Content-Type":k.Json},T);return(yield this.requestSender.get(n,Object.assign({headers:i},t))).body}))}}var x=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class D{constructor(e){this.scriptLoader=e,this.window=window}getPayPalSDK(e,t,n,i){return x(this,void 0,void 0,(function*(){const r=this.getPayPalSdkScriptConfigOrThrow(e,t,n);return this.loadPayPalSDK(r,i)}))}loadPayPalSDK(e,t=!1){return x(this,void 0,void 0,(function*(){if(!this.window.paypal||t){const t=this.transformConfig(e.options),n=this.transformConfig(e.attributes),i=`https://www.paypal.com/sdk/js?${new URLSearchParams(t).toString()}`;yield this.scriptLoader.loadScript(i,{async:!0,attributes:n})}if(!this.window.paypal)throw new h;return this.window.paypal}))}getPayPalSdkScriptConfigOrThrow(e,t,n=!0){const{id:r,clientToken:o,initializationData:a}=e;if(!(null==a?void 0:a.clientId))throw new m(i.MissingPaymentMethod);const{intent:s,clientId:d,merchantId:c,buyerCountry:l,attributionId:u,isVenmoEnabled:h,isHostedCheckoutEnabled:p,isPayPalCreditAvailable:y,isDeveloperModeApplicable:g,availableAlternativePaymentMethods:v=[],enabledAlternativePaymentMethods:f=[],isGooglePayEnabled:b}=a,S=p||n,C="paypalcommercecreditcards"===r,w=C?["card"]:[],_=y?["credit","paylater"]:[],I=n||!S,P=h?["venmo"]:[],E=I?f:[],O=b?["googlepay"]:[],A=n?["card-fields"]:[],k=[...C?[]:["card"],...y?[]:["credit","paylater"],...h?[]:["venmo"],...I?v.filter((e=>!f.includes(e))):v],T=[...w,..._,...P,...E];return{options:Object.assign({"client-id":d,"merchant-id":c,"enable-funding":T.length>0?T:void 0,"disable-funding":k.length>0?k:void 0,commit:S,components:["buttons","hosted-fields","payment-fields","legal",...O,...A],currency:t,intent:s},g&&{"buyer-country":l}),attributes:{"data-partner-attribution-id":u,"data-client-token":o}}}transformConfig(e){let t={};return Object.keys(e).forEach((n=>{const i=e[n];null==i||""===i||Array.isArray(i)&&0===i.length||(t=Object.assign(Object.assign({},t),{[n]:Array.isArray(i)?i.join(","):i}))})),t}}const z=e=>{const{getHost:t}=e.getState();return new E((0,o.createFormPoster)(),e,new M((0,a.createRequestSender)({host:t()})),new D((0,s.vQ)()))};class F extends u{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}var B=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class R{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t}initialize(e){var t;return B(this,void 0,void 0,(function*(){const{paypalcommerce:n,containerId:i,methodId:r}=e,o=Boolean(null==n?void 0:n.buyNowInitializeOptions);if(!r)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new F('Unable to initialize payment because "options.containerId" argument is not provided.');if(!n)throw new F('Unable to initialize payment because "options.paypalcommerce" argument is not provided.');if(o&&!n.currencyCode)throw new F('Unable to initialize payment because "options.paypalcommerce.currencyCode" argument is not provided.');if(o&&"function"!=typeof(null===(t=n.buyNowInitializeOptions)||void 0===t?void 0:t.getBuyNowCartRequestBody))throw new F('Unable to initialize payment because "options.paypalcommerce.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');o||(yield this.paymentIntegrationService.loadDefaultCheckout());const a=o?n.currencyCode:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.paypalCommerceIntegrationService.loadPayPalSdk(r,a,!1),this.renderButton(i,r,n,o)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n,i){var r,o;const{buyNowInitializeOptions:a,style:s,onComplete:d,onEligibilityFailure:c}=n,l=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),u=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{isHostedCheckoutEnabled:h,isAppSwitchEnabled:m}=u.initializationData||{},p=Object.assign(Object.assign({},!i&&this.isPaypalCommerceAppSwitchEnabled(t)&&{appSwitchWhenAvailable:!0}),{createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommerce"),onApprove:({orderID:e})=>this.paypalCommerceIntegrationService.tokenizePayment(t,e)}),y={onClick:()=>this.handleClick(a),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},g=Object.assign(Object.assign({},!m&&{onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e)}),{onApprove:(e,n)=>this.onHostedCheckoutApprove(e,n,t,d)}),v=Object.assign(Object.assign(Object.assign({fundingSource:l.FUNDING.PAYPAL,style:this.paypalCommerceIntegrationService.getValidButtonStyle(s)},p),a&&y),h&&g),f=l.Buttons(v);f.isEligible()?(null===(r=f.hasReturned)||void 0===r?void 0:r.call(f))&&this.isPaypalCommerceAppSwitchEnabled(t)?null===(o=f.resume)||void 0===o||o.call(f):f.render(`#${e}`):c&&"function"==typeof c?c():this.paypalCommerceIntegrationService.removeElement(e)}handleClick(e){return B(this,void 0,void 0,(function*(){if(e){const t=yield this.paypalCommerceIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}onHostedCheckoutApprove(e,t,n,r){return B(this,void 0,void 0,(function*(){if(!e.orderID)throw new m(i.MissingOrderId);const o=this.paymentIntegrationService.getState().getCartOrThrow(),a=yield t.order.get();try{const t=this.paypalCommerceIntegrationService.getBillingAddressFromOrderDetails(a);if(yield this.paymentIntegrationService.updateBillingAddress(t),o.lineItems.physicalItems.length>0){const e=this.paypalCommerceIntegrationService.getShippingAddressFromOrderDetails(a);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.paypalCommerceIntegrationService.updateOrder()}return yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.paypalCommerceIntegrationService.submitPayment(n,e.orderID),r&&"function"==typeof r&&r(),!0}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingAddressChange(e){return B(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.paypalCommerceIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingOptionsChange(e){return B(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}isPaypalCommerceAppSwitchEnabled(e){var t;return(null===(t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e).initializationData)||void 0===t?void 0:t.isAppSwitchEnabled)||!1}}l((e=>new R(e,z(e))),[{id:"paypalcommerce"}]);var L=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class j{constructor(e){this.scriptLoader=e,this.window=window}getPayPalFastlaneSdk(e,t,n){return L(this,void 0,void 0,(function*(){if(!this.window.paypalFastlaneSdk){const i=this.getPayPalFastlaneSdkConfiguration(e,t,n);if(yield this.loadPayPalSdk(i),!this.window.paypalFastlaneSdk)throw new h}return this.window.paypalFastlaneSdk}))}getPayPalGooglePaySdk(e,t,n,i){return L(this,void 0,void 0,(function*(){if(!this.window.paypalGooglePay||i){const i=this.getPayPalGooglePaySdkScriptConfigOrThrow(e,t,n);yield this.loadPayPalSdk(i)}if(!this.window.paypalGooglePay)throw new h;return this.window.paypalGooglePay}))}getPayPalApmsSdk(e,t){return L(this,void 0,void 0,(function*(){if(!this.window.paypalApms){const n=this.getPayPalApmSdkConfiguration(e,t);if(yield this.loadPayPalSdk(n),!this.window.paypalApms)throw new h}return this.window.paypalApms}))}getPayPalMessages(e,t){return L(this,void 0,void 0,(function*(){if(!this.window.paypalMessages){const n=this.getPayPalSdkMessagesConfiguration(e,t);yield this.loadPayPalSdk(n)}if(!this.window.paypalMessages)throw new h;return this.window.paypalMessages}))}loadPayPalSdk({options:e,attributes:t}){return L(this,void 0,void 0,(function*(){const n=this.transformConfig(e),i=this.transformConfig(t),r=`https://www.paypal.com/sdk/js?${new URLSearchParams(n).toString()}`;yield this.scriptLoader.loadScript(r,{async:!0,attributes:i})}))}getPayPalFastlaneSdkConfiguration(e,t,n){const{clientToken:r,initializationData:o}=e;if(!o||!o.clientId)throw new m(i.MissingPaymentMethod);const{intent:a,clientId:s,merchantId:d,attributionId:c}=o;return{options:{"client-id":s,"merchant-id":d,commit:!0,components:["fastlane","buttons","payment-fields","hosted-fields","three-domain-secure"],currency:t,intent:a},attributes:{"data-client-metadata-id":n.replace(/-/g,""),"data-namespace":"paypalFastlaneSdk","data-partner-attribution-id":c,"data-sdk-client-token":r}}}getPayPalGooglePaySdkScriptConfigOrThrow(e,t,n=!0){const{clientToken:r,initializationData:o}=e;if(!o||!o.clientId)throw new m(i.MissingPaymentMethod);const{intent:a,clientId:s,merchantId:d,buyerCountry:c,attributionId:l,isHostedCheckoutEnabled:u,isDeveloperModeApplicable:h}=o,p=u||n;return{options:Object.assign({"client-id":s,"merchant-id":d,commit:p,components:["googlepay"],currency:t,intent:a},h&&{"buyer-country":c}),attributes:{"data-partner-attribution-id":l,"data-client-token":r,"data-namespace":"paypalGooglePay"}}}getPayPalApmSdkConfiguration(e,t){const{initializationData:n}=e;if(!n||!n.clientId)throw new m(i.MissingPaymentMethod);const{intent:r,clientId:o,merchantId:a,buyerCountry:s,attributionId:d,isDeveloperModeApplicable:c,availableAlternativePaymentMethods:l=[],enabledAlternativePaymentMethods:u=[]}=n,h=u,p=l.filter((e=>!u.includes(e)));return{options:Object.assign({"client-id":o,"merchant-id":a,"enable-funding":h.length>0?h:void 0,"disable-funding":p.length>0?p:void 0,commit:!0,components:["buttons","payment-fields"],currency:t,intent:r},c&&{"buyer-country":s}),attributes:{"data-partner-attribution-id":d,"data-namespace":"paypalApms"}}}getPayPalSdkMessagesConfiguration(e,t){const{initializationData:n}=e;if(!n||!n.clientId)throw new m(i.MissingPaymentMethod);const{clientId:r,merchantId:o,attributionId:a,isDeveloperModeApplicable:s,buyerCountry:d}=n;return{options:Object.assign({"client-id":r,"merchant-id":o,components:["messages"],currency:t},s&&{"buyer-country":d}),attributes:{"data-namespace":"paypalMessages","data-partner-attribution-id":a}}}transformConfig(e){let t={};return Object.keys(e).forEach((n=>{const i=e[n];null==i||""===i||Array.isArray(i)&&0===i.length||(t=Object.assign(Object.assign({},t),{[n]:Array.isArray(i)?i.join(","):i}))})),t}}function U(){return new j((0,s.Hb)())}const V=function({styles:e}){const t={};return e.color&&(t.color=e.color),e.layout&&(t.layout=e.layout),(e["logo-type"]||e["logo-position"])&&(t.logo={},e["logo-type"]&&(t.logo.type=e["logo-type"]),e["logo-position"]&&(t.logo.position=e["logo-position"])),e.ratio&&(t.ratio=e.ratio),(e["text-color"]||e["text-size"])&&(t.text={},e["text-color"]&&(t.text.color=e["text-color"]),e["text-size"]&&(t.text.size=+e["text-size"])),t};var q=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class H{constructor(e,t,n){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.paypalCommerceSdk=n}initialize(e){var t;return q(this,void 0,void 0,(function*(){const{paypalcommercecredit:n,containerId:i,methodId:r}=e,{buyNowInitializeOptions:o,currencyCode:a,messagingContainerId:s}=n||{},d=!!o;if(!r)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new F('Unable to initialize payment because "options.containerId" argument is not provided.');if(!n)throw new F('Unable to initialize payment because "options.paypalcommercecredit" argument is not provided.');if(d&&!a)throw new F('Unable to initialize payment because "options.paypalcommercecredit.currencyCode" argument is not provided.');if(d&&"function"!=typeof(null==o?void 0:o.getBuyNowCartRequestBody))throw new F('Unable to initialize payment because "options.paypalcommercecredit.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');d||(yield this.paymentIntegrationService.loadDefaultCheckout());const c=this.paymentIntegrationService.getState(),l=d?a:c.getCartOrThrow().currency.code;yield this.paypalCommerceIntegrationService.loadPayPalSdk(r,l,!1),this.renderButton(i,r,n);const u=c.getStoreConfigOrThrow().checkoutSettings.features;if(null!==(t=u["PAYPAL-5557.Hide_ppc_banner_implementation"])&&void 0!==t&&t)return;const h=s&&document.getElementById(s);if(l&&h){const e=c.getPaymentMethodOrThrow(r),{paypalBNPLConfiguration:t=[]}=e.initializationData||{},n=t&&t.find((({id:e})=>"cart"===e));if(!(null==n?void 0:n.status))return;h.removeAttribute("data-pp-style-logo-type"),h.removeAttribute("data-pp-style-logo-position"),h.removeAttribute("data-pp-style-text-color"),h.removeAttribute("data-pp-style-text-size");const i=yield this.paypalCommerceSdk.getPayPalMessages(e,l);this.renderMessages(i,s,n)}}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onComplete:o,onEligibilityFailure:a}=n,s=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),d=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{isHostedCheckoutEnabled:c,isAppSwitchEnabled:l}=d.initializationData||{},u={createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercecredit"),onApprove:({orderID:e})=>this.paypalCommerceIntegrationService.tokenizePayment(t,e)},h={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},m=Object.assign(Object.assign({},!l&&{onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e)}),{onApprove:(e,n)=>this.onHostedCheckoutApprove(e,n,t,o)}),p=[s.FUNDING.PAYLATER,s.FUNDING.CREDIT];let y=!1;p.forEach((t=>{if(!y){const n=Object.assign(Object.assign(Object.assign({fundingSource:t,style:this.paypalCommerceIntegrationService.getValidButtonStyle(r)},u),i&&h),c&&m),o=s.Buttons(n);o.isEligible()?(o.render(`#${e}`),y=!0):a&&"function"==typeof a&&a()}})),y||this.paypalCommerceIntegrationService.removeElement(e)}handleClick(e){return q(this,void 0,void 0,(function*(){if(e){const t=yield this.paypalCommerceIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}onHostedCheckoutApprove(e,t,n,r){return q(this,void 0,void 0,(function*(){if(!e.orderID)throw new m(i.MissingOrderId);const o=this.paymentIntegrationService.getState().getCartOrThrow(),a=yield t.order.get();try{const t=this.paypalCommerceIntegrationService.getBillingAddressFromOrderDetails(a);if(yield this.paymentIntegrationService.updateBillingAddress(t),o.lineItems.physicalItems.length>0){const e=this.paypalCommerceIntegrationService.getShippingAddressFromOrderDetails(a);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.paypalCommerceIntegrationService.updateOrder()}return yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.paypalCommerceIntegrationService.submitPayment(n,e.orderID),r&&"function"==typeof r&&r(),!0}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingAddressChange(e){return q(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.paypalCommerceIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingOptionsChange(e){return q(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"cart",style:V(n)};e.Messages(i).render(`#${t}`)}}l((e=>new H(e,z(e),U())),[{id:"paypalcommercecredit"}]);var G=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ${constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t}initialize(e){return G(this,void 0,void 0,(function*(){const{paypalcommercevenmo:t,containerId:n,methodId:i}=e,{buyNowInitializeOptions:r,currencyCode:o}=t||{},a=!!r;if(!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new F('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.paypalcommercevenmo" argument is not provided.');if(a&&!o)throw new F('Unable to initialize payment because "options.paypalcommercevenmo.currencyCode" argument is not provided.');if(a&&"function"!=typeof(null==r?void 0:r.getBuyNowCartRequestBody))throw new F('Unable to initialize payment because "options.paypalcommercevenmo.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');a||(yield this.paymentIntegrationService.loadDefaultCheckout());const s=a?o:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.paypalCommerceIntegrationService.loadPayPalSdk(i,s,!1),this.renderButton(n,i,t)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onEligibilityFailure:o}=n,a=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),s=a.FUNDING.VENMO,d={createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercevenmo"),onApprove:({orderID:e})=>this.paypalCommerceIntegrationService.tokenizePayment(t,e)},c={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},l=Object.assign(Object.assign({fundingSource:s,style:this.getValidVenmoButtonStyles(r)},d),i&&c),u=a.Buttons(l);u.isEligible()?u.render(`#${e}`):o&&"function"==typeof o?o():this.paypalCommerceIntegrationService.removeElement(e)}getValidVenmoButtonStyles(e){const t=this.paypalCommerceIntegrationService.getValidButtonStyle(e);return t.color===C.gold?Object.assign(Object.assign({},t),{color:void 0}):t}handleClick(e){return G(this,void 0,void 0,(function*(){if(e){const t=yield this.paypalCommerceIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}}l((e=>new $(e,z(e))),[{id:"paypalcommercevenmo"}]);var W=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Y{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t}initialize(e){return W(this,void 0,void 0,(function*(){const{paypalcommercealternativemethods:t,containerId:n,methodId:i}=e,{apm:r,buyNowInitializeOptions:o,currencyCode:a}=t||{},s=!!o;if(!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new F('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.paypalcommercealternativemethods" argument is not provided.');if(!r)throw new F('Unable to initialize payment because "options.paypalcommercealternativemethods.apm" argument is not provided.');if(s&&!a)throw new F('Unable to initialize payment because "options.paypalcommercealternativemethods.currencyCode" argument is not provided.');if(s&&"function"!=typeof(null==o?void 0:o.getBuyNowCartRequestBody))throw new F('Unable to initialize payment because "options.paypalcommercealternativemethods.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');s||(yield this.paymentIntegrationService.loadDefaultCheckout());const d=s?a:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.paypalCommerceIntegrationService.loadPayPalSdk(i,d,!1),this.renderButton(n,i,t)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{apm:i,buyNowInitializeOptions:r,style:o,onEligibilityFailure:a}=n,s=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow();if(!Object.values(s.FUNDING).includes(i))throw new F('Unable to initialize PayPal button because "options.paypalcommercealternativemethods.apm" argument is not valid funding source.');const d={createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercealternativemethod"),onApprove:({orderID:e})=>this.paypalCommerceIntegrationService.tokenizePayment(t,e)},c={onClick:()=>this.handleClick(r),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},l=Object.assign(Object.assign({fundingSource:i,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o)},d),r&&c),u=s.Buttons(l);u.isEligible()?u.render(`#${e}`):a&&"function"==typeof a?a():this.paypalCommerceIntegrationService.removeElement(e)}handleClick(e){return W(this,void 0,void 0,(function*(){if(e){const t=yield this.paypalCommerceIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}}l((e=>new Y(e,z(e))),[{id:"paypalcommercealternativemethods"}]);const K={size:70,color:"#d9d9d9",backgroundColor:"#ffffff"},Q="embedded-checkout-loading-indicator-rotation";class J{constructor(e){this.styles=Object.assign(Object.assign({},K),e&&e.styles),this.containerStyles=Object.assign({},e&&e.containerStyles),this.defineAnimation(),this.container=this.buildContainer(),this.indicator=this.buildIndicator(),this.container.appendChild(this.indicator)}show(e){if(e){const t=document.getElementById(e);if(!t)throw new Error("Unable to attach the loading indicator because the parent ID is not valid.");t.appendChild(this.container)}this.container.style.visibility="visible",this.container.style.opacity="1"}hide(){const e=()=>{this.container.style.visibility="hidden",this.container.removeEventListener("transitionend",e)};this.container.addEventListener("transitionend",e),this.container.style.opacity="0"}buildContainer(){const e=document.createElement("div");return e.style.display="block",e.style.bottom="0",e.style.left="0",e.style.height="100%",e.style.width="100%",e.style.position="absolute",e.style.right="0",e.style.top="0",e.style.transition="all 250ms ease-out",e.style.opacity="0",this.setStyleAttribute(e,this.containerStyles),e}buildIndicator(){const e=document.createElement("div");return e.style.display="block",e.style.width=`${this.styles.size}px`,e.style.height=`${this.styles.size}px`,e.style.borderRadius=`${this.styles.size}px`,e.style.border="solid 1px",e.style.borderColor=`${this.styles.backgroundColor} ${this.styles.backgroundColor} ${this.styles.color} ${this.styles.color}`,e.style.margin="0 auto",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="50%",e.style.transform="translateY(-50%) rotate(0deg)",e.style.transformStyle="preserve-3d",e.style.animation=`${Q} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`,e}setStyleAttribute(e,t){Object.keys(t).forEach((n=>{e.style.setProperty(n,t[n])}))}defineAnimation(){var e;if(document.getElementById(Q))return;const t=document.createElement("style");t.id=Q,null===(e=document.head)||void 0===e||e.appendChild(t),t.sheet instanceof CSSStyleSheet&&t.sheet.insertRule(`\n                @keyframes ${Q} {\n                    0% { transform: translateY(-50%) rotate(0deg); }\n                    100% { transform: translateY(-50%) rotate(360deg); }\n                }\n            `,0)}}const Z={"background-color":"rgba(0, 0, 0, 0.4)","z-index":"1000"};class X extends F{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}class ee extends g{constructor(e){super(e,{message:"There is a problem processing your payment. Please try again later."}),this.name="PaymentMethodInvalidError",this.type="payment_method_invalid"}}class te extends u{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}function ne(e){return!("object"!=typeof e||null===e||void 0!==e.shouldSaveInstrument&&"boolean"!=typeof e.shouldSaveInstrument||void 0!==e.shouldSetAsDefaultInstrument&&"boolean"!=typeof e.shouldSetAsDefaultInstrument)}function ie(e){return Boolean(e.instrumentId)}function re(e){return"object"==typeof e&&null!==e&&"bigpayToken"in e&&"defaultInstrument"in e&&"provider"in e&&"trustedShippingAddress"in e&&"method"in e&&"type"in e}var oe=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ae{constructor(e,t,n,i){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.paypalCommerceSdk=n,this.loadingIndicator=i}initialize(e){var t;return oe(this,void 0,void 0,(function*(){const{methodId:n,paypalcommerce:i}=e||{};if(this.paypalcommerce=i,!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new F('Unable to initialize payment because "options.paypalcommerce" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(n),{container:a,bannerContainerId:s}=i,{orderId:d,paypalBNPLConfiguration:c=[],isPayPalCreditAvailable:l}=o.initializationData||{};if(void 0!==s){if(!document.getElementById(s))return void console.error("Unable to create banner without valid banner container ID.");const e=null==c?void 0:c.find((({id:e})=>"checkout"===e));if(l||!(null==e?void 0:e.status))return;const t=yield this.paypalCommerceSdk.getPayPalMessages(o,r.getCartOrThrow().currency.code);return t&&"function"==typeof(null==t?void 0:t.Messages)?this.renderMessages(t,s,e):void console.error("[BC PayPalCommerce PayLater]: banner could not be rendered, due to issues with loading PayPal SDK")}d?this.orderId=null===(t=o.initializationData)||void 0===t?void 0:t.orderId:(this.loadingIndicatorContainer=null==a?void 0:a.split("#")[1],yield this.paypalCommerceIntegrationService.loadPayPalSdk(n),i.onInit&&"function"==typeof i.onInit&&i.onInit((()=>this.renderButton(n,i))),(void 0===i.shouldRenderPayPalButtonOnInitialization||i.shouldRenderPayPalButtonOnInitialization)&&this.renderButton(n,i))}))}execute(e,t){var n,i;return oe(this,void 0,void 0,(function*(){const{payment:r}=e,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{onError:a}=this.paypalcommerce||{},s=this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,d=s&&s["PAYPAL-3438.handling_instrument_declined_error_ppc"];if(!r)throw new X(["payment"]);const{methodId:c,paymentData:l}=r;if(this.isPayPalVaultedInstrumentPaymentData(l)&&!this.orderId&&(this.orderId=yield this.createOrder()),!this.orderId)throw new ee;const u=this.isPayPalVaultedInstrumentPaymentData(l)?this.prepareVaultedInstrumentPaymentPayload(c,this.orderId,l):this.preparePaymentPayload(c,this.orderId,l);try{yield this.paymentIntegrationService.submitOrder(o,t),yield this.paymentIntegrationService.submitPayment(u)}catch(e){if(function(e){var t;return(e=>"object"==typeof e&&null!==e&&"body"in e)(e)&&"offsite_redirect"===(null===(t=e.body.additional_action_required)||void 0===t?void 0:t.type)}(e)){const t=null===(i=null===(n=e.body.additional_action_required)||void 0===n?void 0:n.data)||void 0===i?void 0:i.redirect_url;return new Promise((()=>window.location.replace(t)))}return this.isProviderError(e)&&d&&(yield this.paypalCommerceIntegrationService.loadPayPalSdk(r.methodId),yield new Promise(((e,t)=>{var n;this.paypalcommerce&&(null===(n=this.paypalButton)||void 0===n||n.close(),this.renderButton(r.methodId,this.paypalcommerce),this.handleError(new Error("INSTRUMENT_DECLINED"),a)),t()}))),this.handleError(e,a),Promise.reject()}}))}finalize(){return Promise.reject(new te)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}prepareVaultedInstrumentPaymentPayload(e,t,n){const{instrumentId:i,shouldSetAsDefaultInstrument:r}=n,o=!this.isTrustedVaultingFlow(n);return o?{methodId:e,paymentData:{shouldSaveInstrument:o,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t}}}}:{methodId:e,paymentData:{instrumentId:i,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t},bigpay_token:{token:i}}}}}preparePaymentPayload(e,t,n){const{shouldSaveInstrument:i=!1,shouldSetAsDefaultInstrument:r=!1}=ne(n)?n:{};return{methodId:e,paymentData:{shouldSaveInstrument:i,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t}}}}}renderButton(e,t){const n=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t;if(!a)throw new F('Unable to initialize payment because "container" argument is not provided.');const u={fundingSource:n.FUNDING.PAYPAL,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o),createOrder:()=>this.createOrder(),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onError:e=>this.handleError(e,s),onCancel:()=>this.toggleLoadingIndicator(!1)};this.paypalButton=n.Buttons(u),this.paypalButton.isEligible()&&(d&&"function"==typeof d&&d(),this.paypalButton.render(a))}handleClick(e,t){return oe(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;return null==t?void 0:t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,null==t||t()}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}createOrder(){return oe(this,void 0,void 0,(function*(){const e=this.getFieldsValues();return this.paypalCommerceIntegrationService.createOrder("paypalcommercecheckout",{shouldSaveInstrument:(null==e?void 0:e.shouldSaveInstrument)||!1})}))}getFieldsValues(){const{getFieldsValues:e}=this.paypalcommerce||{};return"function"==typeof e?e():void 0}isTrustedVaultingFlow(e){if(e&&ie(e)){const t=this.paymentIntegrationService.getState().getInstruments(),n=null==t?void 0:t.find((t=>re(t)&&t.bigpayToken===e.instrumentId));return!(re(n)&&!n.trustedShippingAddress)}return!1}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}isPayPalVaultedInstrumentPaymentData(e){return!!e&&ie(e)&&ne(e)}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"payment",style:V(n)};e.Messages(i).render(`#${t}`)}isProviderError(e){var t,n,i;return!!function(e){return"object"==typeof e&&null!==e&&"errors"in e}(e)&&"INSTRUMENT_DECLINED"===(null===(i=null===(n=((null===(t=null==e?void 0:e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error)))||[])[0])||void 0===n?void 0:n.provider_error)||void 0===i?void 0:i.code)}}const se=l((e=>new ae(e,z(e),new j((0,s.vQ)()),new J({containerStyles:Z}))),[{id:"paypalcommerce"}]);class de extends u{constructor(e){super(e||"Not implemented."),this.name="NotImplementedError",this.type="not_implemented"}}var ce=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class le{constructor(e,t,n,i){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.loadingIndicator=n,this.paypalCommerceSdk=i}initialize(e){return ce(this,void 0,void 0,(function*(){const{methodId:t,paypalcommerce:n,paypalcommercecredit:i}=e||{},r=i||n;if(!t)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new F('Unable to initialize payment because "options.paypalcommerce" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(t);const o=this.paymentIntegrationService.getState(),a=o.getPaymentMethodOrThrow(t),{paypalBNPLConfiguration:s=[],orderId:d}=a.initializationData||{},{bannerContainerId:c,container:l}=r;if(void 0!==c){if(!document.getElementById(c))return void console.error("Unable to create banner without valid banner container ID.");const e=s&&s.find((({id:e})=>"checkout"===e));if(!(null==e?void 0:e.status))return;const t=yield this.paypalCommerceSdk.getPayPalMessages(a,o.getCartOrThrow().currency.code);return this.renderMessages(t,c,e)}d?this.orderId=d:(yield this.paypalCommerceIntegrationService.loadPayPalSdk(t),this.loadingIndicatorContainer=null==l?void 0:l.split("#")[1],this.renderButton(t,r))}))}execute(e,t){return ce(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new X(["payment"]);if(!this.orderId)throw new ee;yield this.paymentIntegrationService.submitOrder(i,t),yield this.paypalCommerceIntegrationService.submitPayment(n.methodId,this.orderId)}))}finalize(){return Promise.reject(new te)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}renderButton(e,t){if(!(null==t?void 0:t.container))throw new F('Unable to initialize payment because "container" argument is not provided.');const n=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u=[n.FUNDING.PAYLATER,n.FUNDING.CREDIT];let h=!1;u.forEach((e=>{if(h)return;const t={fundingSource:e,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o),createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercecreditcheckout"),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onCancel:()=>this.toggleLoadingIndicator(!1),onError:e=>this.handleError(e,s)};if(this.paypalButton=n.Buttons(t),this.paypalButton.isEligible()||e!==n.FUNDING.PAYLATER){if(!this.paypalButton.isEligible()&&e===n.FUNDING.CREDIT)throw new de(`PayPal ${e} is not available for your region. Please use PayPal Checkout instead.`);d&&"function"==typeof d&&d(),this.paypalButton.render(a),h=!0}}))}handleClick(e,t){return ce(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;if(t&&"function"==typeof t)return t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,t&&"function"==typeof t&&t()}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"payment",style:V(n)};e.Messages(i).render(`#${t}`)}}const ue=l((e=>new le(e,z(e),new J({containerStyles:Z}),U())),[{id:"paypalcommercecredit"}]);var he=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class me{constructor(e,t,n){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.loadingIndicator=n}initialize(e){var t,n;return he(this,void 0,void 0,(function*(){const{methodId:i,paypalcommerce:r,paypalcommercevenmo:o}=e||{},a=o||r;if(!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!a)throw new F('Unable to initialize payment because "options.paypalcommercevenmo" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(i);const s=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i);(null===(t=s.initializationData)||void 0===t?void 0:t.orderId)?this.orderId=null===(n=s.initializationData)||void 0===n?void 0:n.orderId:(yield this.paypalCommerceIntegrationService.loadPayPalSdk(i),this.loadingIndicatorContainer=a.container.split("#")[1],this.renderButton(i,a))}))}execute(e,t){return he(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new X(["payment"]);if(!this.orderId)throw new ee;yield this.paymentIntegrationService.submitOrder(i,t),yield this.paypalCommerceIntegrationService.submitPayment(n.methodId,this.orderId)}))}finalize(){return Promise.reject(new te)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}renderButton(e,t){const n=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u={fundingSource:n.FUNDING.VENMO,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o),createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercevenmocheckout"),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onCancel:()=>this.toggleLoadingIndicator(!1),onError:e=>this.handleError(e,s)};if(this.paypalButton=n.Buttons(u),!this.paypalButton.isEligible())throw new de("PayPal Venmo is not available for your region. Please use PayPal Checkout instead.");d&&"function"==typeof d&&d(),this.paypalButton.render(a)}handleClick(e,t){return he(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;return t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,t(),this.toggleLoadingIndicator(!1)}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const pe=l((e=>new me(e,z(e),new J({styles:{backgroundColor:"black"}}))),[{id:"paypalcommercevenmo"}]);class ye extends g{constructor(e){super(e,{message:"The request has timed out or aborted."}),this.name="TimeoutError",this.type="timeout"}}function ge(e,t,n=!0){var i;return null!==(i=e[t])&&void 0!==i?i:n}var ve=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class fe{constructor(e,t,n,i,r=3e3,o=3e5){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.paypalCommerceSdk=n,this.loadingIndicator=i,this.pollingInterval=r,this.maxPollingIntervalTime=o,this.pollingTimer=0,this.stopPolling=d.noop,this.isPollingEnabled=!1}initialize(e){return ve(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,paypalcommerce:i,paypalcommercealternativemethods:r}=e,o=r||i;if(this.paypalcommercealternativemethods=r,!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!o)throw new F('Unable to initialize payment because "options.paypalcommercealternativemethods" argument is not provided.');const a=this.paymentIntegrationService.getState(),s=a.getPaymentMethodOrThrow(n,t),{orderId:d,shouldRenderFields:c}=s.initializationData||{},l=a.getStoreConfigOrThrow().checkoutSettings.features;this.isPollingEnabled=ge(l,"PAYPAL-5192.paypal_commerce_ideal_polling"),d?this.orderId=d:(this.paypalApms=yield this.paypalCommerceSdk.getPayPalApmsSdk(s,a.getCartOrThrow().currency.code),this.loadingIndicatorContainer=o.container.split("#")[1],this.renderButton(n,t,o),c&&this.renderFields(n,o))}))}execute(e,t){return ve(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new X(["payment"]);const{methodId:r,gatewayId:o}=n;if(!this.orderId)throw new ee;this.isPollingEnabled&&"ideal"===r&&(yield new Promise(((e,t)=>{this.initializePollingMechanism(r,e,t,o)}))),this.isNonInstantPaymentMethod(r)||(yield this.paymentIntegrationService.submitOrder(i,t)),yield this.paypalCommerceIntegrationService.submitPayment(r,this.orderId,o)}))}finalize(){return Promise.reject(new te)}deinitialize(){var e;return this.orderId=void 0,this.isPollingEnabled&&this.resetPollingMechanism(),null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}initializePollingMechanism(e,t,n,i){return ve(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.paypalCommerceIntegrationService.getOrderStatus(i),o=r===I.Approved,a=r===I.PollingError;if(o)return this.deinitializePollingMechanism(),t();if(a)return n();if(!o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,paypalcommercealternativemethods:this.paypalcommercealternativemethods}),this.handleError(new ye)}catch(e){n()}}))}deinitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deinitializePollingMechanism()}reinitializeStrategy(e){return ve(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}handleError(e){const{onError:t}=this.paypalcommercealternativemethods||{};this.isPollingEnabled&&this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}renderButton(e,t,n){const i=this.getPaypalAmpsSdkOrThrow(),r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t),{buttonStyle:o}=r.initializationData||{},{container:a,onError:s,onRenderButton:d,submitForm:c}=n,l={fundingSource:e,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o),onInit:(e,t)=>n.onInitButton(t),createOrder:()=>this.onCreateOrder(e,t,n),onApprove:e=>this.handleApprove(e,c),onCancel:()=>{this.toggleLoadingIndicator(!1),this.deinitializePollingMechanism()},onError:e=>{this.deinitializePollingMechanism(),this.handleFailure(e,s)},onClick:(e,t)=>ve(this,void 0,void 0,(function*(){return n.onValidate(t.resolve,t.reject)}))};this.paypalButton=i.Buttons(l),this.paypalButton.isEligible()&&(d&&"function"==typeof d&&d(),this.paypalButton.render(a))}onCreateOrder(e,t,n){return ve(this,void 0,void 0,(function*(){const{onValidate:i}=n;yield i((()=>(this.toggleLoadingIndicator(!0),()=>Promise.resolve())),d.noop);const r=yield this.paypalCommerceIntegrationService.createOrder("paypalcommercealternativemethodscheckout");if(this.isNonInstantPaymentMethod(e)){const n={useStoreCredit:!1},i={params:{methodId:e,gatewayId:t}};yield this.paymentIntegrationService.submitOrder(n,i),yield this.paypalCommerceIntegrationService.submitPayment(e,r,t)}return r}))}handleApprove({orderID:e},t){this.orderId=e,t()}handleFailure(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}renderFields(e,t){const n=this.getPaypalAmpsSdkOrThrow(),i=this.paymentIntegrationService.getState(),{firstName:r,lastName:o,email:a}=i.getBillingAddressOrThrow(),{apmFieldsContainer:s,apmFieldsStyles:d}=t;if(!s)throw new F('Unable to initialize payment because "options.paypalcommercealternativemethods" argument should contain "apmFieldsContainer".');const c=document.querySelector(s);c&&(c.innerHTML="");const l={fundingSource:e,style:d||{},fields:{name:{value:`${r} ${o}`},email:{value:a}}};n.PaymentFields(l).render(s)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}isNonInstantPaymentMethod(e){return e.toUpperCase()in _}getPaypalAmpsSdkOrThrow(){if(!this.paypalApms)throw new h;return this.paypalApms}}const be=l((e=>new fe(e,z(e),U(),new J({containerStyles:Z}))),[{gateway:"paypalcommercealternativemethods"}]);var Se,Ce,we,_e,Ie,Pe,Ee,Oe;!function(e){e.CVV="cvv",e.PAN="pan"}(Se||(Se={}));class Ae{static get(e){const t=`${encodeURIComponent(`${e}`)}=`,n=document.cookie;let i=null;const r=n.indexOf(t);if(r>-1){let e=n.indexOf(";",r);-1===e&&(e=n.length),i=decodeURIComponent(n.substring(r+t.length,e))}return i}static set(e,t,n={secure:!0}){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;const{expires:r,path:o,domain:a,secure:s}=n;if(r)i+=`; expires=${r.toUTCString()}`;else{const e=new Date,t=60;e.setTime(e.getTime()+60*t*1e3),i+=`; expires=${e.toUTCString()}`}o&&(i+=`; path=${o}`),a&&(i+=`; domain=${a}`),s&&(i+="; secure"),document.cookie=i}static remove(e,t){Ae.set(e,"",Object.assign({expires:new Date(0)},t))}}!function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(Ce||(Ce={})),function(e){e.Succeeded="succeeded",e.Cancelled="cancelled",e.Errored="errored"}(we||(we={})),function(e){e.Possible="POSSIBLE",e.No="NO",e.Unknown="UNKNOWN",e.Yes="YES"}(_e||(_e={})),function(e){e.paypal="paypal",e.checkout="checkout",e.buynow="buynow",e.pay="pay",e.installment="installment"}(Ie||(Ie={})),function(e){e.gold="gold",e.blue="blue",e.silver="silver",e.black="black",e.white="white"}(Pe||(Pe={})),function(e){e.pill="pill",e.rect="rect"}(Ee||(Ee={})),function(e){e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled",e.UNRECOGNIZED="unrecognized"}(Oe||(Oe={}));var ke,Te=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ne{constructor(){this.window=window}initializePayPalFastlane(e,t,n){return Te(this,void 0,void 0,(function*(){if(t&&(window.localStorage.setItem("fastlaneEnv","sandbox"),window.localStorage.setItem("axoEnv","sandbox")),!this.window.paypalFastlane){const t={root:{backgroundColorPrimary:"transparent"}};this.window.paypalFastlane=yield e.Fastlane({styles:n||t})}return this.window.paypalFastlane}))}getPayPalFastlaneOrThrow(){if(!this.window.paypalFastlane)throw new h;return this.window.paypalFastlane}lookupCustomerOrThrow(e){return Te(this,void 0,void 0,(function*(){return this.getPayPalFastlaneOrThrow().identity.lookupCustomerByEmail(e)}))}triggerAuthenticationFlowOrThrow(e){return Te(this,void 0,void 0,(function*(){return e?this.getPayPalFastlaneOrThrow().identity.triggerAuthenticationFlow(e):{}}))}updateStorageSessionId(e){const t=new Date;t.setDate(t.getDate()+14);const n={expires:t,secure:!0};Ae.set("bc-fastlane-sessionId",e,n)}removeStorageSessionId(){Ae.remove("bc-fastlane-sessionId")}getStorageSessionId(){return Ae.get("bc-fastlane-sessionId")||""}mapPayPalFastlaneProfileToBcCustomerData(e,t){var n,i,r;const{authenticationState:o,profileData:a}=t,s=null===(r=null===(i=null===(n=null==a?void 0:a.card)||void 0===n?void 0:n.paymentSource)||void 0===i?void 0:i.card)||void 0===r?void 0:r.billingAddress,d=null==a?void 0:a.shippingAddress,c=null==a?void 0:a.name,l=null==a?void 0:a.card,u=d?this.mapPayPalToBcAddress(d.address,d.name,d.phoneNumber):void 0,h=s&&c?this.mapPayPalToBcAddress(s,c,null==d?void 0:d.phoneNumber):void 0,m=l?this.mapPayPalToBcInstrument(e,l):[],p=this.filterAddresses([u,h]);return{authenticationState:o||Oe.UNRECOGNIZED,addresses:p,billingAddress:h,shippingAddress:u,instruments:m}}mapPayPalToBcInstrument(e,t){const{id:n,paymentSource:i}=t,{brand:r,expiry:o,lastDigits:a}=i.card,[s,d]=o.split("-");return[{bigpayToken:n,brand:r,defaultInstrument:!1,expiryMonth:d,expiryYear:s,iin:"",last4:a,method:e,provider:e,trustedShippingAddress:!1,untrustedShippingCardVerificationMode:Se.PAN,type:"card"}]}mapBcToPayPalAddress(e){return{company:(null==e?void 0:e.company)||"",addressLine1:(null==e?void 0:e.address1)||"",addressLine2:(null==e?void 0:e.address2)||"",adminArea1:(null==e?void 0:e.stateOrProvinceCode)||(null==e?void 0:e.stateOrProvince)||"",adminArea2:(null==e?void 0:e.city)||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCode:(null==e?void 0:e.countryCode)||""}}mapPayPalToBcAddress(e,t,n,i){const[r,o]=t.fullName.split(" "),a=(null==n?void 0:n.nationalNumber)||"",s=(null==n?void 0:n.countryCode)||"";return{id:Date.now(),type:"paypal-address",firstName:t.firstName||r||"",lastName:t.lastName||o||"",company:e.company||"",address1:e.addressLine1,address2:e.addressLine2||"",city:e.adminArea2,stateOrProvince:e.adminArea1,stateOrProvinceCode:e.adminArea1,country:e.countryCode||"",countryCode:e.countryCode||"",postalCode:e.postalCode,phone:s+a,customFields:i||[]}}filterAddresses(e){return e.reduce(((e,t)=>t?e.some((e=>this.isEqualAddresses(e,t)))?e:[...e,t]:e),[])}isEqualAddresses(e,t){return(0,d.isEqual)(this.normalizeAddress(e),this.normalizeAddress(t))}normalizeAddress(e){return(0,d.omit)(e,["id","phone"])}}function Me(){return new Ne}!function(e){e.CardCode="cardCode",e.CardCodeVerification="cardCodeVerification",e.CardExpiry="cardExpiry",e.CardName="cardName",e.CardNumber="cardNumber",e.CardNumberVerification="cardNumberVerification",e.CardExpiryVerification="cardExpiryVerification"}(ke||(ke={}));const xe=ke;function De(e){return xe.CardNumber in e&&xe.CardName in e&&xe.CardExpiry in e}function ze(e){return xe.CardNumberVerification in e&&xe.CardCodeVerification in e&&xe.CardExpiryVerification in e}class Fe extends u{constructor(e){super(e||"Unable to proceed because the client library of a payment method has thrown an unexpected error."),this.name="PaymentMethodFailedError",this.type="payment_method_client_invalid"}}var Be;!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(Be||(Be={}));class Re extends u{constructor(e){super(function(e){switch(e){case Be.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case Be.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case Be.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case Be.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}class Le extends u{constructor(e,t){super(t||"Unable to proceed because the payment form contains invalid data."),this.details=e,this.name="PaymentInvalidFormError",this.type="payment_invalid_form"}}var je=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ue{constructor(e,t,n,i){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.paypalCommerceSdk=n,this.paypalCommerceFastlaneUtils=i}initialize(e){return je(this,void 0,void 0,(function*(){const{methodId:t,paypalcommercecreditcards:n,paypalcommerce:i}=e,r=n||i,{form:o,onCreditCardFieldsRenderingError:a}=r||{};if(!t)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!o)throw new F('Unable to proceed because "options.paypalcommercecreditcards.form" argument is not provided.');this.hostedFormOptions=o,this.isCreditCardForm=De(o.fields),this.isCreditCardVaultedForm=ze(o.fields)&&!this.hasUndefinedValues(),yield this.paymentIntegrationService.loadPaymentMethod(t),yield this.paypalCommerceIntegrationService.loadPayPalSdk(t,void 0,!0,!0),(this.isCreditCardForm||this.isCreditCardVaultedForm)&&(yield this.initializeFields(o,a)),this.shouldInitializePayPalFastlane(t)&&(yield this.initializePayPalFastlaneOrThrow(t))}))}execute(e,t){return je(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{methodId:r,paymentData:o}=n||{};if(!n||!r)throw new X(["payment"]);if(this.executionPaymentData=o,this.isCreditCardForm||this.isCreditCardVaultedForm)yield this.validateHostedFormOrThrow(),yield this.submitHostedForm();else{const{orderId:e}=yield this.paypalCommerceIntegrationService.createOrderCardFields("paypalcommercecreditcardscheckout",this.getInstrumentParams());this.returnedOrderId=e}const a=this.preparePaymentPayload(r,o,this.returnedOrderId,this.returnedVaultedToken);yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment(a)}))}finalize(){return Promise.reject(new te)}deinitialize(){var e,t,n,i;return je(this,void 0,void 0,(function*(){return yield null===(e=this.cvvField)||void 0===e?void 0:e.close(),yield null===(t=this.expiryField)||void 0===t?void 0:t.close(),yield null===(n=this.numberField)||void 0===n?void 0:n.close(),yield null===(i=this.nameField)||void 0===i?void 0:i.close(),Promise.resolve()}))}preparePaymentPayload(e,t,n,i){const{shouldSaveInstrument:r=!1,shouldSetAsDefaultInstrument:o=!1}=ne(t)?t:{},a=t&&ie(t)?t.instrumentId:void 0,s=(0,d.omitBy)({verification_nonce:i,token:a},d.isNil);return{methodId:e,paymentData:{shouldSaveInstrument:r,shouldSetAsDefaultInstrument:o,instrumentId:a,formattedPayload:Object.assign(Object.assign({},i||a?{bigpay_token:s}:{}),n?{card_with_order:{order_id:n}}:{})}}}initializeFields(e,t){return je(this,void 0,void 0,(function*(){const{fields:n,styles:i}=e,r=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),o=this.getExecuteCallback(n),a=Object.assign({style:this.getInputStyles(i),onApprove:({orderID:e,vaultSetupToken:t,liabilityShift:n})=>{if(n===f.No||n===f.Unknown)throw new Error;return this.handleApprove({orderID:e,vaultSetupToken:t})},onError:()=>{throw new Fe},inputEvents:{onChange:t=>this.onChangeHandler(e,t),onFocus:t=>this.onFocusHandler(e,t),onBlur:t=>this.onBlurHandler(e,t),onInputSubmitRequest:t=>this.onInputSubmitRequest(e,t)}},o);if(this.cardFields=yield r.CardFields(a),!this.cardFields.isEligible())throw new Re(Be.PaymentNotInitialized);try{this.stylizeInputContainers(n),De(n)&&(yield this.renderFields(n)),ze(n)&&(yield this.renderVaultedFields(n))}catch(e){"function"==typeof t&&t(e)}}))}getExecuteCallback(e){return ze(e)?this.createVaultSetupTokenCallback():this.createOrderCallback()}createVaultSetupTokenCallback(){return{createVaultSetupToken:()=>je(this,void 0,void 0,(function*(){const{setupToken:e}=(yield this.paypalCommerceIntegrationService.createOrderCardFields("paypalcommercecreditcardscheckout",Object.assign(Object.assign({},this.getInstrumentParams()),{setupToken:!0})))||{};return e}))}}createOrderCallback(){return{createOrder:()=>je(this,void 0,void 0,(function*(){const{orderId:e}=(yield this.paypalCommerceIntegrationService.createOrderCardFields("paypalcommercecreditcardscheckout",this.getInstrumentParams()))||{};return e}))}}handleApprove({orderID:e,vaultSetupToken:t}){e&&(this.returnedOrderId=e),t&&(this.returnedVaultedToken=t)}renderFields(e){var t,n,i,r;return je(this,void 0,void 0,(function*(){const o=this.getCardFieldsOrThrow();(null===(t=e.cardCode)||void 0===t?void 0:t.containerId)&&(this.cvvField=o.CVVField({placeholder:""}),yield this.cvvField.render(`#${e.cardCode.containerId}`)),(null===(n=e.cardExpiry)||void 0===n?void 0:n.containerId)&&(this.expiryField=o.ExpiryField(),yield this.expiryField.render(`#${e.cardExpiry.containerId}`)),(null===(i=e.cardName)||void 0===i?void 0:i.containerId)&&(this.nameField=o.NameField({placeholder:""}),yield this.nameField.render(`#${e.cardName.containerId}`)),(null===(r=e.cardNumber)||void 0===r?void 0:r.containerId)&&(this.numberField=o.NumberField({placeholder:""}),yield this.numberField.render(`#${e.cardNumber.containerId}`))}))}renderVaultedFields(e){var t,n,i;return je(this,void 0,void 0,(function*(){const r=this.getCardFieldsOrThrow();(null===(t=e.cardCodeVerification)||void 0===t?void 0:t.containerId)&&(this.cvvField=r.CVVField({placeholder:""}),yield this.cvvField.render(`#${e.cardCodeVerification.containerId}`)),(null===(n=e.cardExpiryVerification)||void 0===n?void 0:n.containerId)&&(this.expiryField=r.ExpiryField(),yield this.expiryField.render(`#${e.cardExpiryVerification.containerId}`)),(null===(i=e.cardNumberVerification)||void 0===i?void 0:i.containerId)&&(this.numberField=r.NumberField({placeholder:""}),yield this.numberField.render(`#${e.cardNumberVerification.containerId}`))}))}getInstrumentParams(){if(!this.executionPaymentData)return{};if(ne(this.executionPaymentData)){const{shouldSaveInstrument:e,shouldSetAsDefaultInstrument:t}=this.executionPaymentData;return{shouldSaveInstrument:e,shouldSetAsDefaultInstrument:t}}if(ie(this.executionPaymentData)){const{instrumentId:e}=this.executionPaymentData;return{instrumentId:e}}return{}}getFieldTypeByEmittedField({emittedBy:e}){return{fieldType:this.mapFieldType(e)}}submitHostedForm(){return je(this,void 0,void 0,(function*(){const e=this.getCardFieldsOrThrow(),t=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),n={billingAddress:{company:t.company,addressLine1:t.address1,addressLine2:t.address2,adminArea1:t.stateOrProvinceCode,adminArea2:t.city,postalCode:t.postalCode,countryCode:t.countryCode}};try{this.isCreditCardVaultedForm?yield e.submit():yield e.submit(n)}catch(e){throw new Fe("Failed authentication. Please try to authorize again.")}}))}validateHostedFormOrThrow(){var e,t;return je(this,void 0,void 0,(function*(){const n=this.getCardFieldsOrThrow(),i=yield n.getState().then((e=>e)),r=this.getValidityData(i);if(!r.isValid)throw null===(t=null===(e=this.hostedFormOptions)||void 0===e?void 0:e.onValidate)||void 0===t||t.call(e,r),new Le(this.mapValidationErrors(r.errors))}))}getValidityData({fields:e}){const t=Object.assign({},e);delete t.cardNameField;const n=Object.keys(t);return{isValid:n.every((e=>{var n;return null===(n=t[e])||void 0===n?void 0:n.isValid})),errors:n.reduce(((e,n)=>{var i;const r=this.mapFieldType(n);return Object.assign(Object.assign({},e),{[r]:(null===(i=t[n])||void 0===i?void 0:i.isValid)?void 0:[this.getInvalidErrorByFieldType(r)]})}),{})}}getInvalidErrorByFieldType(e){switch(e){case xe.CardCode:case xe.CardCodeVerification:return{fieldType:e,message:"Invalid card code",type:"invalid_card_code"};case xe.CardNumber:case xe.CardNumberVerification:return{fieldType:e,message:"Invalid card number",type:"invalid_card_number"};case xe.CardExpiry:case xe.CardExpiryVerification:return{fieldType:e,message:"Invalid card expiry",type:"invalid_card_expiry"};default:return{fieldType:e,message:"Invalid field",type:"invalid"}}}mapValidationErrors(e={}){const t={};return Object.keys(e).forEach((n=>{var i,r;t[n]=[{message:(null===(r=null===(i=e[n])||void 0===i?void 0:i[0])||void 0===r?void 0:r.message)||"",type:n}]})),t}mapFieldType(e){switch(e){case"name":return xe.CardName;case"cardNumberField":case"number":return this.isCreditCardForm?xe.CardNumber:xe.CardNumberVerification;case"cardExpiryField":case"expiry":return this.isCreditCardForm?xe.CardExpiry:xe.CardExpiryVerification;case"cardCvvField":case"cvv":return this.isCreditCardForm?xe.CardCode:xe.CardCodeVerification;default:throw new Error("Unexpected field type")}}getCardFieldsOrThrow(){if(!this.cardFields)throw new Re(Be.PaymentNotInitialized);return this.cardFields}getInputStyles(e){var t,n,i;const r={"font-size":(null===(t=null==e?void 0:e.default)||void 0===t?void 0:t.fontSize)||"1rem","font-family":(null===(n=null==e?void 0:e.default)||void 0===n?void 0:n.fontFamily)||"Montserrat, Arial, Helvetica, sans-serif","font-weight":(null===(i=null==e?void 0:e.default)||void 0===i?void 0:i.fontWeight)||"400",outline:"none",padding:"9px 13px"},o=Object.assign(Object.assign({},r),{color:"#333333"});return{input:o,".invalid":Object.assign(Object.assign({},r),{color:"red"}),".valid":o,":focus":o}}stylizeInputContainers(e){Object.values(e||{}).forEach((e=>{const t=document.getElementById(`${(null==e?void 0:e.containerId)||""}`);t&&(t.style.padding="0px",t.style.boxShadow="none",t.style.border="none",t.style.background="transparent",t.style.marginBottom="10px",t.style.marginLeft="-5px")}))}hasUndefinedValues(){return!this.hostedFormOptions||Object.values(this.hostedFormOptions.fields).some((e=>void 0===e))}onChangeHandler(e,t){var n;null===(n=null==e?void 0:e.onValidate)||void 0===n||n.call(e,this.getValidityData(t))}onFocusHandler(e,t){var n;null===(n=null==e?void 0:e.onFocus)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}onBlurHandler(e,t){var n;null===(n=null==e?void 0:e.onBlur)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}onInputSubmitRequest(e,t){var n;null===(n=null==e?void 0:e.onEnter)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}shouldInitializePayPalFastlane(e){var t,n;const i=this.paymentIntegrationService.getState(),r=i.getPaymentMethodOrThrow(e),o=i.getPaymentProviderCustomer(),a=(s=o)&&("authenticationState"in s||"addresses"in s||"instruments"in s)?o:{};var s;return(null===(t=null==r?void 0:r.initializationData)||void 0===t?void 0:t.isAcceleratedCheckoutEnabled)&&(null===(n=null==r?void 0:r.initializationData)||void 0===n?void 0:n.isPayPalCommerceAnalyticsV2Enabled)&&!(null==a?void 0:a.authenticationState)}initializePayPalFastlaneOrThrow(e){return je(this,void 0,void 0,(function*(){try{const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getPaymentMethodOrThrow(e),{initializationData:r}=i;if(!(null==r?void 0:r.connectClientToken))return;const o=yield this.paypalCommerceSdk.getPayPalFastlaneSdk(i,n.currency.code,n.id);yield this.paypalCommerceFastlaneUtils.initializePayPalFastlane(o,!!(null==r?void 0:r.isDeveloperModeApplicable))}catch(e){}}))}}const Ve=l((e=>new Ue(e,z(e),U(),Me())),[{id:"paypalcommercecreditcards"}]);var qe=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class He{constructor(e,t,n,i=3e3,r=3e5){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.loadingIndicator=n,this.pollingInterval=i,this.maxPollingIntervalTime=r,this.pollingTimer=0,this.stopPolling=d.noop}initialize(e){return qe(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,paypalcommerceratepay:i}=e;if(!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!i)throw new F('Unable to initialize payment because "options.paypalcommerceratepay" argument is not provided.');const{legalTextContainer:r,container:o,loadingContainerId:a}=i;if(!o)throw new F('Unable to initialize payment because "options.container" argument is not provided.');if(!r)throw new F('Unable to initialize payment because "options.legalTextContainer" argument is not provided.');if(!a)throw new F('Unable to initialize payment because "options.loadingContainerId" argument is not provided.');this.loadingIndicatorContainer=a;const s=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n,t),{merchantId:d}=s.initializationData||{};if(!d)throw new F("Unable to initialize payment because merchantId argument is not provided.");this.paypalcommerceratepay=i,yield this.paypalCommerceIntegrationService.loadPayPalSdk(n),this.createFraudNetScript(d,n,t),this.loadFraudnetConfig(),this.renderLegalText(r,o)}))}execute(e,t){return qe(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{getFieldsValues:r}=this.paypalcommerceratepay||{};if(!n)throw new X(["payment"]);if(!r||"function"!=typeof r)throw new F('Unable to initialize payment because "options.getFieldsValues" argument is not provided.');this.toggleLoadingIndicator(!0);try{const e=yield this.paypalCommerceIntegrationService.createOrder("paypalcommercealternativemethodscheckout",{metadataId:this.guid}),{ratepayBirthDate:o,ratepayPhoneNumber:a,ratepayPhoneCountryCode:s}=r(),d={formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:null,method_id:n.methodId,rate_pay:{birth_date:this.normalizeDate(o),phone:{national_number:a,country_code:s.split("+")[1]}},paypal_account:{order_id:e}}};return yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment({methodId:n.methodId,paymentData:d}),yield new Promise(((e,t)=>{this.initializePollingMechanism(n.methodId,e,t,n.gatewayId)}))}catch(e){return this.handleError(e),new Promise(((e,t)=>t()))}}))}finalize(){return Promise.reject(new te)}deinitialize(){const{legalTextContainer:e}=this.paypalcommerceratepay||{},t=document.querySelectorAll('[data-id="fraudnetScript"]')[0],n=document.querySelectorAll('[data-id="fraudnetConfig"]')[0];if(this.deinitializePollingMechanism(),t.remove(),n.remove(),e){const t=document.getElementById(e);null==t||t.remove()}return Promise.resolve()}normalizeDate(e){const t=this.formatDate(e.getDate()),n=this.formatDate(e.getMonth()+1);return`${e.getFullYear()}-${n}-${t}`}formatDate(e){return`${e<10?0:""}${e}`}renderLegalText(e,t){const n=e,i=t.split("#")[1],r=document.getElementById(i),o=null==r?void 0:r.parentNode,a=document.createElement("div");a.style.marginBottom="20px",a.setAttribute("id",n),null==o||o.prepend(a);const s=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),d=s.Legal({fundingSource:s.Legal.FUNDING.PAY_UPON_INVOICE});if(!document.getElementById(n))throw new F('Unable to initialize payment because "legalTextContainerElement" argument is not found.');d.render(`#${n}`)}handleError(e){const{onError:t}=this.paypalcommerceratepay||{};this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}createFraudNetScript(e,t,n){const i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t,n),{testMode:r}=i.config,o=document.createElement("script");o.setAttribute("type","application/json"),o.setAttribute("fncls","fnparams-dede7cc5-15fd-4c75-a9f4-36c430ee3a99"),o.setAttribute("data-id","fraudnetScript"),this.guid=this.generateGUID();const a={f:this.guid,s:`${e}_checkout-page`,sandbox:r};o.innerHTML=JSON.stringify(a),document.body.appendChild(o)}generateGUID(){let e="";for(let t=0;t<32;t+=1)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())];return e}loadFraudnetConfig(){const e=document.createElement("script");e.setAttribute("data-id","fraudnetConfig"),e.src="https://c.paypal.com/da/r/fb.js",document.body.appendChild(e)}reinitializeStrategy(e){return qe(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}initializePollingMechanism(e,t,n,i){return qe(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.paypalCommerceIntegrationService.getOrderStatus("paypalcommercealternativemethods",{params:{useMetadata:!0}}),o=r===I.PollingStop,a=r===I.PollingError;if(o)return this.deinitializePollingMechanism(),t();if(a)return n();if(!o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,paypalcommerceratepay:this.paypalcommerceratepay}),this.handleError(new ye)}catch(e){this.handleError(e),n()}}))}deinitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deinitializePollingMechanism()}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const Ge=l((e=>new He(e,z(e),new J({containerStyles:Object.assign(Object.assign({},Z),{position:"fixed"})}))),[{gateway:"paypalcommercealternativemethods",id:"ratepay"}]);function $e(e){return"string"!=typeof e}function We(e,t){if(t||e)return function(e){var t,n;const i={},r=(0,d.omitBy)(e.root,$e),o=(0,d.omitBy)(e.input,$e),a=(0,d.omitBy)(e.toggle,$e),s=(0,d.omitBy)(null===(t=e.text)||void 0===t?void 0:t.body,$e),c=(0,d.omitBy)(null===(n=e.text)||void 0===n?void 0:n.caption,$e),l=e.branding;return Object.keys(r).length&&(i.root=r),Object.keys(o).length&&(i.input=o),Object.keys(a).length&&(i.toggle=a),Object.keys(s).length&&(i.text={},i.text.body=s),Object.keys(c).length&&(i.text=Object.assign({},i.text),i.text.caption=c),l&&(i.branding=l),i}(function(e,t){var n,i,r,o,a,s,d,c,l,u,h,m,p,y,g,v,f,b,S,C,w,_;return{root:{backgroundColorPrimary:(null==e?void 0:e.fastlaneRootSettingsBackgroundColor)||(null===(n=null==t?void 0:t.root)||void 0===n?void 0:n.backgroundColorPrimary),errorColor:(null==e?void 0:e.fastlaneRootSettingsErrorColor)||(null===(i=null==t?void 0:t.root)||void 0===i?void 0:i.errorColor),fontFamily:(null==e?void 0:e.fastlaneRootSettingsFontFamily)||(null===(r=null==t?void 0:t.root)||void 0===r?void 0:r.fontFamily),fontSizeBase:(null==e?void 0:e.fastlaneRootSettingsFontSize)||(null===(o=null==t?void 0:t.root)||void 0===o?void 0:o.fontSizeBase),padding:(null==e?void 0:e.fastlaneRootSettingsPadding)||(null===(a=null==t?void 0:t.root)||void 0===a?void 0:a.padding),primaryColor:(null==e?void 0:e.fastlaneRootSettingsPrimaryColor)||(null===(s=null==t?void 0:t.root)||void 0===s?void 0:s.primaryColor)},input:{borderRadius:(null==e?void 0:e.fastlaneInputSettingsBorderRadius)||(null===(d=null==t?void 0:t.input)||void 0===d?void 0:d.borderRadius),borderColor:(null==e?void 0:e.fastlaneInputSettingsBorderColor)||(null===(c=null==t?void 0:t.input)||void 0===c?void 0:c.borderColor),focusBorderColor:(null==e?void 0:e.fastlaneInputSettingsFocusBorderBase)||(null===(l=null==t?void 0:t.input)||void 0===l?void 0:l.focusBorderColor),backgroundColor:(null==e?void 0:e.fastlaneInputSettingsBackgroundColor)||(null===(u=null==t?void 0:t.input)||void 0===u?void 0:u.backgroundColor),borderWidth:(null==e?void 0:e.fastlaneInputSettingsBorderWidth)||(null===(h=null==t?void 0:t.input)||void 0===h?void 0:h.borderWidth),textColorBase:(null==e?void 0:e.fastlaneInputSettingsTextColorBase)||(null===(m=null==t?void 0:t.input)||void 0===m?void 0:m.textColorBase)},toggle:{colorPrimary:(null==e?void 0:e.fastlaneToggleSettingsColorPrimary)||(null===(p=null==t?void 0:t.toggle)||void 0===p?void 0:p.colorPrimary),colorSecondary:(null==e?void 0:e.fastlaneToggleSettingsColorSecondary)||(null===(y=null==t?void 0:t.toggle)||void 0===y?void 0:y.colorSecondary)},text:{body:{color:(null==e?void 0:e.fastlaneTextBodySettingsColor)||(null===(v=null===(g=null==t?void 0:t.text)||void 0===g?void 0:g.body)||void 0===v?void 0:v.color),fontSize:(null==e?void 0:e.fastlaneTextBodySettingsFontSize)||(null===(b=null===(f=null==t?void 0:t.text)||void 0===f?void 0:f.body)||void 0===b?void 0:b.fontSize)},caption:{color:(null==e?void 0:e.fastlaneTextCaptionSettingsColor)||(null===(C=null===(S=null==t?void 0:t.text)||void 0===S?void 0:S.caption)||void 0===C?void 0:C.color),fontSize:(null==e?void 0:e.fastlaneTextCaptionSettingsFontSize)||(null===(_=null===(w=null==t?void 0:t.text)||void 0===w?void 0:w.caption)||void 0===_?void 0:_.fontSize)}},branding:(null==e?void 0:e.fastlaneBrandingSettings)||(null==t?void 0:t.branding)}}(e,t))}function Ye(e){return!!e&&("authenticationState"in e||"addresses"in e||"instruments"in e)}var Ke=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Qe{constructor(e,t,n,i){this.paymentIntegrationService=e,this.paypalCommerceRequestSender=t,this.paypalCommerceSdk=n,this.paypalCommerceFastlaneUtils=i}initialize(e){var t,n;return Ke(this,void 0,void 0,(function*(){const{methodId:i,paypalcommercefastlane:r}=e;if(this.methodId=i,this.paypalcommercefastlane=r,!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new F('Unable to initialize payment because "options.paypalcommercefastlane" argument is not provided.');if(!r.onInit||"function"!=typeof r.onInit)throw new F('Unable to initialize payment because "options.paypalcommercefastlane.onInit" argument is not provided or it is not a function.');if(!r.onChange||"function"!=typeof r.onChange)throw new F('Unable to initialize payment because "options.paypalcommercefastlane.onChange" argument is not provided or it is not a function.');yield this.paymentIntegrationService.loadPaymentMethod(i);const o=this.paymentIntegrationService.getState(),a=o.getCartOrThrow(),s=o.getPaymentMethodOrThrow(i),{isDeveloperModeApplicable:d,isFastlaneStylingEnabled:c}=s.initializationData||{};this.threeDSVerificationMethod=null===(t=s.initializationData)||void 0===t?void 0:t.threeDSVerificationMethod,this.paypalFastlaneSdk=yield this.paypalCommerceSdk.getPayPalFastlaneSdk(s,a.currency.code,a.id);const l=We(c?null===(n=null==s?void 0:s.initializationData)||void 0===n?void 0:n.fastlaneStyles:{},null==r?void 0:r.styles);yield this.paypalCommerceFastlaneUtils.initializePayPalFastlane(this.paypalFastlaneSdk,!!d,l),this.shouldRunAuthenticationFlow()&&(yield this.runPayPalAuthenticationFlowOrThrow(i)),yield this.initializePayPalPaymentComponent(),r.onInit((e=>this.renderPayPalPaymentComponent(e))),r.onChange((()=>this.handlePayPalStoredInstrumentChange(i)))}))}execute(e,t){return Ke(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new X(["payment"]);const{paymentData:r,methodId:o}=n,a=r&&ie(r);try{yield this.paymentIntegrationService.submitOrder(i,t);const e=a?yield this.prepareVaultedInstrumentPaymentPayload(o,r):yield this.preparePaymentPayload(o,r);yield this.paymentIntegrationService.submitPayment(e),this.paypalCommerceFastlaneUtils.removeStorageSessionId()}catch(e){if(function(e){return"object"==typeof e&&null!==e&&"message"in e&&"response"in e&&"body"in e.response&&"name"in e.response.body}(e)&&"INVALID_REQUEST"===e.response.body.name){const e={translationKey:"payment.errors.invalid_request_error"};return this.handleError(e),Promise.reject()}if(e instanceof Error&&"FastlaneError"!==e.name)throw e;return Promise.reject()}}))}finalize(){return Promise.reject(new te)}deinitialize(){return Ke(this,void 0,void 0,(function*(){return Promise.resolve()}))}shouldRunAuthenticationFlow(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getCustomerOrThrow(),i=e.getPaymentProviderCustomer(),r=Ye(i)?i:{},o=this.paypalCommerceFastlaneUtils.getStorageSessionId();return!(!n.isGuest||(null==r?void 0:r.authenticationState)===Oe.CANCELED||(null==r?void 0:r.authenticationState)||o!==t.id)}runPayPalAuthenticationFlowOrThrow(e){return Ke(this,void 0,void 0,(function*(){try{const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getCustomer(),r=t.getBillingAddress(),o=(null==i?void 0:i.email)||(null==r?void 0:r.email)||"",{customerContextId:a}=yield this.paypalCommerceFastlaneUtils.lookupCustomerOrThrow(o),s=yield this.paypalCommerceFastlaneUtils.triggerAuthenticationFlowOrThrow(a),{authenticationState:d,addresses:c,instruments:l}=this.paypalCommerceFastlaneUtils.mapPayPalFastlaneProfileToBcCustomerData(e,s);yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:d,addresses:c,instruments:l}),s.authenticationState===Oe.CANCELED?this.paypalCommerceFastlaneUtils.removeStorageSessionId():this.paypalCommerceFastlaneUtils.updateStorageSessionId(n.id)}catch(e){}}))}initializePayPalPaymentComponent(){return Ke(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),t=e.phone,n=`${e.firstName} ${e.lastName}`.trim(),i=this.paypalCommerceFastlaneUtils.getPayPalFastlaneOrThrow(),r={fields:Object.assign({cardholderName:{prefill:n,enabled:!0}},t&&{phoneNumber:{prefill:t}})};this.paypalComponentMethods=yield i.FastlaneCardComponent(r)}))}renderPayPalPaymentComponent(e){const t=this.getPayPalComponentMethodsOrThrow();if(!e)throw new F('Unable to render card component because "container" argument is not provided.');t.render(e)}getPayPalComponentMethodsOrThrow(){if(!this.paypalComponentMethods)throw new h;return this.paypalComponentMethods}prepareVaultedInstrumentPaymentPayload(e,t){return Ke(this,void 0,void 0,(function*(){const{instrumentId:n}=t,i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),r=this.isPaypalCommerceFastlaneThreeDSAvailable()&&i.config.is3dsEnabled;r||(yield this.createOrder(n));const o=r?yield this.get3DSNonce(n):n;return{methodId:e,paymentData:{formattedPayload:{paypal_fastlane_token:{order_id:this.orderId,token:o}}}}}))}preparePaymentPayload(e,t){return Ke(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getBillingAddressOrThrow(),r=n.getPaymentMethodOrThrow(e),o=`${i.firstName} ${i.lastName}`.trim(),{getPaymentToken:a}=this.getPayPalComponentMethodsOrThrow(),{id:s}=yield a({name:{fullName:o},billingAddress:this.paypalCommerceFastlaneUtils.mapBcToPayPalAddress(i)}),d=this.isPaypalCommerceFastlaneThreeDSAvailable()&&r.config.is3dsEnabled;d||(yield this.createOrder(s));const c=d?yield this.get3DSNonce(s):s,{shouldSaveInstrument:l=!1,shouldSetAsDefaultInstrument:u=!1}=ne(t)?t:{};return{methodId:e,paymentData:Object.assign(Object.assign({},t),{shouldSaveInstrument:l,shouldSetAsDefaultInstrument:u,formattedPayload:{paypal_fastlane_token:{order_id:this.orderId,token:c}}})}}))}createOrder(e){return Ke(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getCartOrThrow().id;if(this.methodId){const{orderId:n}=yield this.paypalCommerceRequestSender.createOrder(this.methodId,{cartId:t,fastlaneToken:e});this.orderId=n}}))}get3DSNonce(e){var t;return Ke(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getCartOrThrow(),r=n.getOrderOrThrow(),o=n.getStoreConfigOrThrow().links.checkoutLink,a=null===(t=this.paypalFastlaneSdk)||void 0===t?void 0:t.ThreeDomainSecureClient;if(!a)throw new h;const s={amount:r.orderAmount.toFixed(2),currency:i.currency.code,nonce:e,threeDSRequested:"SCA_ALWAYS"===this.threeDSVerificationMethod,transactionContext:{experience_context:{locale:"en-US",return_url:o,cancel_url:o}}};if(yield a.isEligible(s)){const{liabilityShift:e,authenticationState:t,nonce:n}=yield a.show();if(e===f.No||e===f.Unknown||t===we.Errored||t===we.Cancelled)throw new ee;if(t===we.Succeeded)return yield this.createOrder(n),n}return e}))}handlePayPalStoredInstrumentChange(e){return Ke(this,void 0,void 0,(function*(){const t=this.paypalCommerceFastlaneUtils.getPayPalFastlaneOrThrow(),{selectionChanged:n,selectedCard:i}=yield t.profile.showCardSelector();if(n){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomer(),n=Ye(t)?t:{},r=this.paypalCommerceFastlaneUtils.mapPayPalToBcInstrument(e,i)[0];return yield this.paymentIntegrationService.updatePaymentProviderCustomer(Object.assign(Object.assign({},n),{instruments:[r]})),r}}))}isPaypalCommerceFastlaneThreeDSAvailable(){return ge(this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,"PROJECT-7080.paypalcommerce_fastlane_three_ds")}handleError(e){var t;(null===(t=this.paypalcommercefastlane)||void 0===t?void 0:t.onError)&&"function"==typeof this.paypalcommercefastlane.onError&&this.paypalcommercefastlane.onError(e)}}const Je=l((e=>{const{getHost:t}=e.getState();return new Qe(e,new M((0,a.createRequestSender)({host:t()})),U(),Me())}),[{id:"paypalcommerceacceleratedcheckout"}]);var Ze=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Xe{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.onError=d.noop}initialize(e){return Ze(this,void 0,void 0,(function*(){const{paypalcommerce:t,methodId:n}=e;if(!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.paypalcommerce" argument is not provided.');if(!t.container)throw new F('Unable to initialize payment because "options.paypalcommerce.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new F('Unable to initialize payment because "options.paypalcommerce.onClick" argument is not a function.');this.onError=t.onError||d.noop,this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.paypalCommerceIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC PayPal]: PayPal Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return Ze(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}))}signOut(e){return Ze(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){var n,i;const{container:r,onClick:o,onComplete:a}=t,s=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),d=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{isHostedCheckoutEnabled:c,paymentButtonStyles:l,isAppSwitchEnabled:u}=d.initializationData||{},{checkoutTopButtonStyles:h}=l||{},m=Object.assign(Object.assign(Object.assign({},this.isPaypalCommerceAppSwitchEnabled(e)&&{appSwitchWhenAvailable:!0}),{createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommerce"),onApprove:({orderID:t})=>this.paypalCommerceIntegrationService.tokenizePayment(e,t)}),o&&{onClick:()=>o()}),p=Object.assign(Object.assign({},!u&&{onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e)}),{onApprove:(t,n)=>this.onHostedCheckoutApprove(t,n,e,a)}),y=Object.assign(Object.assign({fundingSource:s.FUNDING.PAYPAL,style:this.paypalCommerceIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},h),{height:36}))},m),c&&p),g=s.Buttons(y);g.isEligible()?(null===(n=g.hasReturned)||void 0===n?void 0:n.call(g))&&this.isPaypalCommerceAppSwitchEnabled(e)?null===(i=g.resume)||void 0===i||i.call(g):g.render(`#${r}`):this.paypalCommerceIntegrationService.removeElement(r)}onHostedCheckoutApprove(e,t,n,r){return Ze(this,void 0,void 0,(function*(){if(!e.orderID)throw new m(i.MissingOrderId);const o=this.paymentIntegrationService.getState().getCartOrThrow(),a=yield t.order.get();try{const t=this.paypalCommerceIntegrationService.getBillingAddressFromOrderDetails(a);if(yield this.paymentIntegrationService.updateBillingAddress(t),o.lineItems.physicalItems.length>0){const e=this.paypalCommerceIntegrationService.getShippingAddressFromOrderDetails(a);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.paypalCommerceIntegrationService.updateOrder()}yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.paypalCommerceIntegrationService.submitPayment(n,e.orderID),r&&"function"==typeof r&&r()}catch(e){this.handleError(e)}}))}onShippingAddressChange(e){return Ze(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.paypalCommerceIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}onShippingOptionsChange(e){return Ze(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}isPaypalCommerceAppSwitchEnabled(e){var t;return(null===(t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e).initializationData)||void 0===t?void 0:t.isAppSwitchEnabled)||!1}}const et=l((e=>new Xe(e,z(e))),[{id:"paypalcommerce"}]);var tt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class nt{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.onError=d.noop}initialize(e){return tt(this,void 0,void 0,(function*(){const{paypalcommercecredit:t,methodId:n}=e;if(!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.paypalcommercecredit" argument is not provided.');if(!t.container)throw new F('Unable to initialize payment because "options.paypalcommercecredit.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new F('Unable to initialize payment because "options.paypalcommercecredit.onClick" argument is not a function.');this.onError=t.onError||d.noop,this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.paypalCommerceIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC PayPal]: PayPal Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return tt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return tt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onComplete:i,onClick:r}=t,o=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{isHostedCheckoutEnabled:s,paymentButtonStyles:d,isAppSwitchEnabled:c}=a.initializationData||{},{checkoutTopButtonStyles:l}=d||{},u=Object.assign({createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercecredit"),onApprove:({orderID:t})=>this.paypalCommerceIntegrationService.tokenizePayment(e,t)},r&&{onClick:()=>r()}),h=Object.assign(Object.assign({},!c&&{onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e)}),{onApprove:(t,n)=>this.onHostedCheckoutApprove(t,n,e,i)}),m=[o.FUNDING.PAYLATER,o.FUNDING.CREDIT];let p=!1;m.forEach((e=>{if(!p){const t=Object.assign(Object.assign({fundingSource:e,style:this.paypalCommerceIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},l),{height:36}))},u),s&&h),i=o.Buttons(t);i.isEligible()&&(i.render(`#${n}`),p=!0)}})),p||this.paypalCommerceIntegrationService.removeElement(n)}onHostedCheckoutApprove(e,t,n,r){return tt(this,void 0,void 0,(function*(){if(!e.orderID)throw new m(i.MissingOrderId);const o=this.paymentIntegrationService.getState().getCartOrThrow(),a=yield t.order.get();try{const t=this.paypalCommerceIntegrationService.getBillingAddressFromOrderDetails(a);if(yield this.paymentIntegrationService.updateBillingAddress(t),o.lineItems.physicalItems.length>0){const e=this.paypalCommerceIntegrationService.getShippingAddressFromOrderDetails(a);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.paypalCommerceIntegrationService.updateOrder()}yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.paypalCommerceIntegrationService.submitPayment(n,e.orderID),r&&"function"==typeof r&&r()}catch(e){this.handleError(e)}}))}onShippingAddressChange(e){return tt(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.paypalCommerceIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}onShippingOptionsChange(e){return tt(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}}const it=l((e=>new nt(e,z(e))),[{id:"paypalcommercecredit"}]);var rt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ot{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t}initialize(e){return rt(this,void 0,void 0,(function*(){const{paypalcommercevenmo:t,methodId:n}=e;if(!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.paypalcommercevenmo" argument is not provided.');if(!t.container)throw new F('Unable to initialize payment because "options.paypalcommercevenmo.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new F('Unable to initialize payment because "options.paypalcommercevenmo.onClick" argument is not a function.');this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.paypalCommerceIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC PayPal]: PayPal Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return rt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return rt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onClick:i}=t,r=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:a}=o.initializationData||{},{checkoutTopButtonStyles:s}=a||{},d=Object.assign({fundingSource:r.FUNDING.VENMO,style:this.paypalCommerceIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},s),{height:36})),createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercevenmo"),onApprove:({orderID:t})=>this.paypalCommerceIntegrationService.tokenizePayment(e,t)},i&&{onClick:()=>i()}),c=r.Buttons(d);c.isEligible()?c.render(`#${n}`):this.paypalCommerceIntegrationService.removeElement(n)}}const at=l((e=>new ot(e,z(e))),[{id:"paypalcommercevenmo"}]);var st=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class dt{constructor(e,t,n){this.paymentIntegrationService=e,this.paypalCommerceSdk=t,this.paypalCommerceFastlaneUtils=n}initialize(e){var t;return st(this,void 0,void 0,(function*(){const{methodId:n,paypalcommercefastlane:i}=e;if(!n)throw new F('Unable to proceed because "methodId" argument is not provided.');try{yield this.paymentIntegrationService.loadPaymentMethod(n);const e=this.paymentIntegrationService.getState(),r=e.getCartOrThrow(),o=e.getPaymentMethodOrThrow(n),a=!!(null===(t=o.initializationData)||void 0===t?void 0:t.isDeveloperModeApplicable),s=yield this.paypalCommerceSdk.getPayPalFastlaneSdk(o,r.currency.code,r.id);yield this.paypalCommerceFastlaneUtils.initializePayPalFastlane(s,a,this.getFastlaneStyles(n,i))}catch(e){}return Promise.resolve()}))}deinitialize(){return st(this,void 0,void 0,(function*(){return Promise.resolve()}))}signIn(e,t){return st(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return st(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){return st(this,void 0,void 0,(function*(){const{checkoutPaymentMethodExecuted:t,continueWithCheckoutCallback:n,methodId:i}=e||{};if(!i)throw new F('Unable to proceed because "methodId" argument is not provided.');if("function"!=typeof n)throw new F('Unable to proceed because "continueWithCheckoutCallback" argument is not provided and it must be a function.');if(this.paymentIntegrationService.getState().getCustomerOrThrow().isGuest){t&&"function"==typeof t&&t();try{yield this.runPayPalAuthenticationFlowOrThrow(i)}catch(e){}}n()}))}runPayPalAuthenticationFlowOrThrow(e){return st(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow().id,i=t.getCustomer(),r=t.getBillingAddress(),o=(null==i?void 0:i.email)||(null==r?void 0:r.email)||"",{customerContextId:a}=yield this.paypalCommerceFastlaneUtils.lookupCustomerOrThrow(o),s=yield this.paypalCommerceFastlaneUtils.triggerAuthenticationFlowOrThrow(a),d=s.authenticationState===Oe.CANCELED;yield this.updateCustomerDataState(e,s),d?this.paypalCommerceFastlaneUtils.removeStorageSessionId():this.paypalCommerceFastlaneUtils.updateStorageSessionId(n)}))}updateCustomerDataState(e,t){var n;return st(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState().getCartOrThrow(),{authenticationState:r,addresses:o,billingAddress:a,shippingAddress:s,instruments:d}=this.paypalCommerceFastlaneUtils.mapPayPalFastlaneProfileToBcCustomerData(e,t);if(yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:r,addresses:o,instruments:d}),a&&(yield this.paymentIntegrationService.updateBillingAddress(a)),s&&i.lineItems.physicalItems.length>0){const t=yield this.paymentIntegrationService.updateShippingAddress(s),i=t.getPaymentMethodOrThrow(e),{isFastlaneShippingOptionAutoSelectEnabled:r}=i.initializationData||{},o=t.getConsignments()||[],a=(null===(n=o[0])||void 0===n?void 0:n.availableShippingOptions)||[],d=a[0],c=a.find((e=>e.isRecommended));if((c||d)&&r){const e=(null==c?void 0:c.id)||d.id;yield this.paymentIntegrationService.selectShippingOption(e)}}}))}getFastlaneStyles(e,t){const n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{fastlaneStyles:i,isFastlaneStylingEnabled:r}=n.initializationData||{};return We(r?i:{},null==t?void 0:t.styles)}}const ct=l((e=>new dt(e,U(),Me())),[{id:"paypalcommerceacceleratedcheckout"},{id:"paypalcommercecreditcards"}])},12056:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(31635),r=n(3375),o=n.n(r),a=n(69440),s=n(70355);const d=(0,s.forwardRef)(((e,t)=>{var{className:n,testId:r,placeholder:d,name:c,isFloatingLabelEnabled:l}=e,u=(0,i.__rest)(e,["className","testId","placeholder","name","isFloatingLabelEnabled"]);return s.createElement("input",Object.assign({},u,{className:o()(n,{"floating-input":l&&!(0,a.includes)(["orderComment","redeemableCode"],c)}),name:c,"data-test":r,placeholder:l?" ":d,ref:t}))}))},12402:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(98610);function r(e){if(e)return e===i.A.PaypalCommerce||e===i.A.PaypalCommerceCreditCards?i.A.PayPalCommerceAcceleratedCheckout:e===i.A.Braintree?i.A.BraintreeAcceleratedCheckout:e}},13061:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(3375),r=n.n(i),o=n(70355),a=n(69022),s=n(16919),d=n(72769),c=n(49655),l=n(45707);const u=(0,o.memo)((({description:e})=>o.createElement("div",{className:"shippingOption-additionalDescription--container"},o.createElement(l.A,{openByDefault:e.length<45},(({isOpen:t,toggle:n})=>o.createElement(o.Fragment,null,o.createElement("span",{className:"shippingOption-additionalDescription "+(t?"shippingOption-additionalDescription--expanded":"shippingOption-additionalDescription--collapsed")},e),!t&&o.createElement("a",{className:"shippingOption-readMore",onClick:(0,d.A)(n)},o.createElement(c.A,{id:"common.show_more"})))))))),h=({displayAdditionalInformation:e=!0,method:t,shippingCostAfterDiscount:n})=>{const{themeV2:i}=(0,a.w)();return o.createElement("div",{className:"shippingOption shippingOption--alt","data-test":"static-shipping-option"},t.imageUrl&&o.createElement("span",{className:"shippingOption-figure"},o.createElement("img",{alt:t.description,className:"shippingOption-img",src:t.imageUrl})),o.createElement("span",{className:r()("shippingOption-desc",{"body-medium":i})},t.description,t.transitTime&&o.createElement("span",{className:"shippingOption-transitTime"},t.transitTime),t.additionalDescription&&e&&o.createElement(u,{description:t.additionalDescription})),o.createElement("span",{className:r()("shippingOption-price",{"body-medium":i})},void 0!==n&&n!==t.cost?o.createElement(o.Fragment,null,o.createElement("span",{className:"shippingOption-price-before-discount"},o.createElement(s.A,{amount:t.cost})),o.createElement(s.A,{amount:n})):o.createElement(s.A,{amount:t.cost})))}},14580:(e,t,n)=>{function i(e){const t=window.location.pathname.split("/").pop(),n=new URLSearchParams(window.location.search);return"BUY_NOW"===(null==e?void 0:e.source)||"buy"===n.get("action")||!("checkout"===t||"embedded-checkout"===t)}n.d(t,{A:()=>i})},14900:(e,t,n)=>{n.d(t,{BA:()=>Je,Dw:()=>ct,EF:()=>Te,Gd:()=>De,MF:()=>at,On:()=>Ge,Wu:()=>it,Y9:()=>se,ae:()=>et,g3:()=>Ee,v1:()=>Ye});var i,r,o=n(58636),a=n(91195),s=n(38589),d=n(58002),c={};function l(e,t){return Object.assign(e,{resolveIds:t})}c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);class u extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class h extends u{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}(r=i||(i={}))[r.MissingBillingAddress=0]="MissingBillingAddress",r[r.MissingCart=1]="MissingCart",r[r.MissingCheckout=2]="MissingCheckout",r[r.MissingConsignments=3]="MissingConsignments",r[r.MissingCustomer=4]="MissingCustomer",r[r.MissingCheckoutConfig=5]="MissingCheckoutConfig",r[r.MissingOrder=6]="MissingOrder",r[r.MissingOrderConfig=7]="MissingOrderConfig",r[r.MissingOrderId=8]="MissingOrderId",r[r.MissingPayment=9]="MissingPayment",r[r.MissingPaymentId=10]="MissingPaymentId",r[r.MissingPaymentInstrument=11]="MissingPaymentInstrument",r[r.MissingPaymentMethod=12]="MissingPaymentMethod",r[r.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",r[r.MissingPaymentStatus=14]="MissingPaymentStatus",r[r.MissingPaymentToken=15]="MissingPaymentToken",r[r.MissingShippingAddress=16]="MissingShippingAddress";class m extends u{constructor(e){super(function(e){switch(e){case i.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case i.MissingCart:return"Unable to proceed because cart data is unavailable.";case i.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case i.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case i.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case i.MissingCheckoutConfig:case i.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case i.MissingOrder:return"Unable to proceed because order data is unavailable.";case i.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case i.MissingPayment:return"Unable to proceed because payment data is unavailable.";case i.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case i.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case i.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}class p extends u{constructor(e){super(e||"An unexpected error has occurred during buy now cart creation process. Please try again later."),this.name="BuyNowCartCreationError",this.type="buy_now_cart_creation_error"}}const y={body:{},headers:{},status:0};class g extends u{constructor(e,{message:t,errors:n}={}){const{body:i,headers:r,status:o}=e||y;super(t||"An unexpected error has occurred."),this.name="RequestError",this.type="request",this.body=i,this.headers=r,this.status=o,this.errors=n||[]}}var v,f,b,S,C,w,_,I;!function(e){e.BuyNow="BUY_NOW"}(v||(v={})),function(e){e.Possible="POSSIBLE",e.No="NO",e.Unknown="UNKNOWN",e.Yes="YES"}(f||(f={})),function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(b||(b={})),function(e){e.paypal="paypal",e.checkout="checkout",e.buynow="buynow",e.pay="pay",e.installment="installment"}(S||(S={})),function(e){e.gold="gold",e.blue="blue",e.silver="silver",e.black="black",e.white="white"}(C||(C={})),function(e){e.pill="pill",e.rect="rect"}(w||(w={})),function(e){e.OXXO="oxxo"}(_||(_={})),function(e){e.Approved="APPROVED",e.Created="CREATED",e.PayerActionRequired="PAYER_ACTION_REQUIRED",e.PollingStop="POLLING_STOP",e.PollingError="POLLING_ERROR"}(I||(I={}));var P=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class E{constructor(e,t,n,i){this.formPoster=e,this.paymentIntegrationService=t,this.bigCommercePaymentsRequestSender=n,this.bigCommercePaymentsScriptLoader=i}loadPayPalSdk(e,t,n,i){return P(this,void 0,void 0,(function*(){const r=this.paymentIntegrationService.getState(),o=t||r.getCartOrThrow().currency.code,a=r.getPaymentMethodOrThrow(e);return this.paypalSdk=yield this.bigCommercePaymentsScriptLoader.getPayPalSDK(a,o,n,i),this.paypalSdk}))}getPayPalSdkOrThrow(){if(!this.paypalSdk)throw new h;return this.paypalSdk}createBuyNowCartOrThrow(e){return P(this,void 0,void 0,(function*(){const t=e.getBuyNowCartRequestBody();if(!t)throw new m(i.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(t)}catch(e){throw new p}}))}createOrder(e,t){return P(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getCartOrThrow().id,{orderId:i}=yield this.bigCommercePaymentsRequestSender.createOrder(e,Object.assign({cartId:n},t));return i}))}createOrderCardFields(e,t){return P(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getCartOrThrow().id,{orderId:i,setupToken:r}=yield this.bigCommercePaymentsRequestSender.createOrder(e,Object.assign({cartId:n},t));return Object.assign({orderId:i},r?{setupToken:r}:{})}))}updateOrder(){return P(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getConsignmentsOrThrow()[0];try{yield this.bigCommercePaymentsRequestSender.updateOrder({availableShippingOptions:n.availableShippingOptions,cartId:t.id,selectedShippingOption:n.selectedShippingOption})}catch(e){throw new g}}))}getOrderStatus(e,t){return P(this,void 0,void 0,(function*(){try{const{status:n}=yield this.bigCommercePaymentsRequestSender.getOrderStatus(e,t);return n}catch(e){throw new g}}))}tokenizePayment(e,t){const n=this.paymentIntegrationService.getState().getCartOrThrow();if(!t)throw new m(i.MissingOrderId);return this.formPoster.postForm("/checkout.php",Object.assign({payment_type:"paypal",action:"set_external_checkout",provider:e,order_id:t},n.source===v.BuyNow&&{cart_id:n.id}))}submitPayment(e,t,n){return P(this,void 0,void 0,(function*(){const i={formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:null,method_id:e,paypal_account:{order_id:t}}};yield this.paymentIntegrationService.submitPayment(Object.assign({methodId:e,paymentData:i},n?{gatewayId:n}:{}))}))}getShippingOptionOrThrow(e){const t=this.paymentIntegrationService.getState().getConsignmentsOrThrow()[0],n=t.availableShippingOptions||[],i=n.find((e=>e.isRecommended)),r=(e?n.find((t=>t.id===e)):n.find((e=>{var n;return e.id===(null===(n=t.selectedShippingOption)||void 0===n?void 0:n.id)})))||i||n[0];if(!r)throw new Error("Your order can't be shipped to this address");return r}getAddress(e){return{firstName:(null==e?void 0:e.firstName)||"",lastName:(null==e?void 0:e.lastName)||"",email:(null==e?void 0:e.email)||"",phone:(null==e?void 0:e.phone)||"",company:"",address1:(null==e?void 0:e.address1)||"",address2:(null==e?void 0:e.address2)||"",city:(null==e?void 0:e.city)||"",countryCode:(null==e?void 0:e.countryCode)||"",postalCode:(null==e?void 0:e.postalCode)||"",stateOrProvince:"",stateOrProvinceCode:(null==e?void 0:e.stateOrProvinceCode)||"",customFields:[]}}getBillingAddressFromOrderDetails({payer:e}){var t,n;return this.getAddress({firstName:e.name.given_name,lastName:e.name.surname,email:e.email_address,address1:e.address.address_line_1,address2:e.address.address_line_2,city:e.address.admin_area_2,countryCode:e.address.country_code,postalCode:e.address.postal_code,stateOrProvinceCode:e.address.admin_area_1,phone:null===(n=null===(t=e.phone)||void 0===t?void 0:t.phone_number)||void 0===n?void 0:n.national_number})}getShippingAddressFromOrderDetails(e){const{payer:t,purchase_units:n}=e,{address:i,name:{full_name:r}}=n[0].shipping,[o,...a]=r.split(" ");return this.getAddress({firstName:o,lastName:a.join(" "),email:t.email_address,address1:i.address_line_1,address2:i.address_line_2,city:i.admin_area_2,countryCode:i.country_code,postalCode:i.postal_code,stateOrProvinceCode:i.admin_area_1})}getValidButtonStyle(e){const{color:t,height:n,label:i,shape:r}=e||{},o={color:t&&C[t]?t:void 0,height:this.getValidHeight(n),label:i&&S[i]?i:void 0,shape:r&&w[r]?r:void 0};return(0,d.omitBy)(o,d.isNil)}getValidHeight(e){return e&&"number"==typeof e?e>55?55:e<25?25:e:40}removeElement(e){const t=e&&document.getElementById(e);t&&(t.style.display="none")}}const O="This API endpoint is for internal use only and may change in the future";var A;!function(e){e.Json="application/json",e.JsonV1="application/vnd.bc.v1+json"}(A||(A={}));const k=A,T={"X-Checkout-SDK-Version":"1.808.0"};var N=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class M{constructor(e){this.requestSender=e}createOrder(e,t){return N(this,void 0,void 0,(function*(){const n=`/api/storefront/payment/${e}`,i=t,r=Object.assign({"X-API-INTERNAL":O,"Content-Type":k.Json},T);return(yield this.requestSender.post(n,{headers:r,body:i})).body}))}updateOrder(e){return N(this,void 0,void 0,(function*(){const t=e,n=Object.assign({"X-API-INTERNAL":O,"Content-Type":k.Json},T);return(yield this.requestSender.put("/api/storefront/initialization/bigcommerce_payments",{headers:n,body:t})).body}))}getOrderStatus(e="bigcommerce_payments",t){return N(this,void 0,void 0,(function*(){const n=`/api/storefront/initialization/${e}`,i=Object.assign({"X-API-INTERNAL":O,"Content-Type":k.Json},T);return(yield this.requestSender.get(n,Object.assign({headers:i},t))).body}))}}var x=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class D{constructor(e){this.scriptLoader=e,this.window=window}getPayPalSDK(e,t,n,i){return x(this,void 0,void 0,(function*(){const r=this.getPayPalSdkScriptConfigOrThrow(e,t,n);return this.loadPayPalSDK(r,i)}))}loadPayPalSDK(e,t=!1){return x(this,void 0,void 0,(function*(){if(!this.window.paypal||t){const t=this.transformConfig(e.options),n=this.transformConfig(e.attributes),i=`https://www.paypal.com/sdk/js?${new URLSearchParams(t).toString()}`;yield this.scriptLoader.loadScript(i,{async:!0,attributes:n})}if(!this.window.paypal)throw new h;return this.window.paypal}))}getPayPalSdkScriptConfigOrThrow(e,t,n=!0){const{id:r,clientToken:o,initializationData:a}=e;if(!(null==a?void 0:a.clientId))throw new m(i.MissingPaymentMethod);const{intent:s,clientId:d,merchantId:c,buyerCountry:l,attributionId:u,isVenmoEnabled:h,isHostedCheckoutEnabled:p,isPayPalCreditAvailable:y,isDeveloperModeApplicable:g,availableAlternativePaymentMethods:v=[],enabledAlternativePaymentMethods:f=[],isGooglePayEnabled:b}=a,S=p||n,C="bigcommerce_payments_creditcards"===r,w=C?["card"]:[],_=C?[]:["card"],I=y?["credit","paylater"]:[],P=y?[]:["credit","paylater"],E=n||!S,O=h?["venmo"]:[],A=h?[]:["venmo"],k=E?f:[],T=E?v.filter((e=>!f.includes(e))):v,N=b?["googlepay"]:[],M=n?["card-fields"]:[],x=this.filterFundingOptions([..._,...P,...A,...T]),D=this.filterFundingOptions([...w,...I,...O,...k]);return{options:Object.assign({"client-id":d,"merchant-id":c,"enable-funding":D.length>0?D:void 0,"disable-funding":x.length>0?x:void 0,commit:S,components:["buttons","hosted-fields","payment-fields","legal",...N,...M],currency:t,intent:s},g&&{"buyer-country":l}),attributes:{"data-partner-attribution-id":u,"data-client-token":o}}}filterFundingOptions(e){const t=["klarna"];return e?e.filter((e=>!t.includes(e))):[]}transformConfig(e){let t={};return Object.keys(e).forEach((n=>{const i=e[n];null==i||""===i||Array.isArray(i)&&0===i.length||(t=Object.assign(Object.assign({},t),{[n]:Array.isArray(i)?i.join(","):i}))})),t}}const z=e=>{const{getHost:t}=e.getState();return new E((0,o.createFormPoster)(),e,new M((0,a.createRequestSender)({host:t()})),new D((0,s.vQ)()))};class F extends u{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}var B=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class R{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t}initialize(e){var t;return B(this,void 0,void 0,(function*(){const{bigcommerce_payments:n,containerId:i,methodId:r}=e,o=Boolean(null==n?void 0:n.buyNowInitializeOptions);if(!r)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new F('Unable to initialize payment because "options.containerId" argument is not provided.');if(!n)throw new F('Unable to initialize payment because "options.bigcommerce_payments" argument is not provided.');if(o&&!n.currencyCode)throw new F('Unable to initialize payment because "options.bigcommerce_payments.currencyCode" argument is not provided.');if(o&&"function"!=typeof(null===(t=n.buyNowInitializeOptions)||void 0===t?void 0:t.getBuyNowCartRequestBody))throw new F('Unable to initialize payment because "options.bigcommerce_payments.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');o||(yield this.paymentIntegrationService.loadDefaultCheckout());const a=o?n.currencyCode:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(r,a,!1),this.renderButton(i,r,n)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onComplete:o,onEligibilityFailure:a}=n,s=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),d=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{isHostedCheckoutEnabled:c}=d.initializationData||{},l={createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments"),onApprove:({orderID:e})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(t,e)},u={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},h={onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e),onApprove:(e,n)=>this.onHostedCheckoutApprove(e,n,t,o)},m=Object.assign(Object.assign(Object.assign({fundingSource:s.FUNDING.PAYPAL,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(r)},l),i&&u),c&&h),p=s.Buttons(m);p.isEligible()?p.render(`#${e}`):a&&"function"==typeof a?a():this.bigCommercePaymentsIntegrationService.removeElement(e)}handleClick(e){return B(this,void 0,void 0,(function*(){if(e){const t=yield this.bigCommercePaymentsIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}onHostedCheckoutApprove(e,t,n,r){return B(this,void 0,void 0,(function*(){if(!e.orderID)throw new m(i.MissingOrderId);const o=this.paymentIntegrationService.getState().getCartOrThrow(),a=yield t.order.get();try{const t=this.bigCommercePaymentsIntegrationService.getBillingAddressFromOrderDetails(a);if(yield this.paymentIntegrationService.updateBillingAddress(t),o.lineItems.physicalItems.length>0){const e=this.bigCommercePaymentsIntegrationService.getShippingAddressFromOrderDetails(a);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.bigCommercePaymentsIntegrationService.updateOrder()}return yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.bigCommercePaymentsIntegrationService.submitPayment(n,e.orderID),r&&"function"==typeof r&&r(),!0}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingAddressChange(e){return B(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingOptionsChange(e){return B(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}}l((e=>new R(e,z(e))),[{id:"bigcommerce_payments"}]);var L=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class j{constructor(e){this.scriptLoader=e,this.window=window}getPayPalFastlaneSdk(e,t,n){return L(this,void 0,void 0,(function*(){if(!this.window.paypalFastlaneSdk){const i=this.getPayPalFastlaneSdkConfiguration(e,t,n);if(yield this.loadPayPalSdk(i),!this.window.paypalFastlaneSdk)throw new h}return this.window.paypalFastlaneSdk}))}getPayPalGooglePaySdk(e,t,n,i){return L(this,void 0,void 0,(function*(){if(!this.window.paypalGooglePay||i){const i=this.getPayPalGooglePaySdkScriptConfigOrThrow(e,t,n);yield this.loadPayPalSdk(i)}if(!this.window.paypalGooglePay)throw new h;return this.window.paypalGooglePay}))}getPayPalApmsSdk(e,t){return L(this,void 0,void 0,(function*(){if(!this.window.paypalApms){const n=this.getPayPalApmSdkConfiguration(e,t);if(yield this.loadPayPalSdk(n),!this.window.paypalApms)throw new h}return this.window.paypalApms}))}getPayPalMessages(e,t){return L(this,void 0,void 0,(function*(){if(!this.window.paypalMessages){const n=this.getPayPalSdkMessagesConfiguration(e,t);yield this.loadPayPalSdk(n)}if(!this.window.paypalMessages)throw new h;return this.window.paypalMessages}))}loadPayPalSdk({options:e,attributes:t}){return L(this,void 0,void 0,(function*(){const n=this.transformConfig(e),i=this.transformConfig(t),r=`https://www.paypal.com/sdk/js?${new URLSearchParams(n).toString()}`;yield this.scriptLoader.loadScript(r,{async:!0,attributes:i})}))}getPayPalFastlaneSdkConfiguration(e,t,n){const{clientToken:r,initializationData:o}=e;if(!o||!o.clientId)throw new m(i.MissingPaymentMethod);const{intent:a,clientId:s,merchantId:d,attributionId:c}=o;return{options:{"client-id":s,"merchant-id":d,commit:!0,components:["fastlane","three-domain-secure"],currency:t,intent:a},attributes:{"data-client-metadata-id":n.replace(/-/g,""),"data-namespace":"paypalFastlaneSdk","data-partner-attribution-id":c,"data-sdk-client-token":r}}}getPayPalGooglePaySdkScriptConfigOrThrow(e,t,n=!0){const{clientToken:r,initializationData:o}=e;if(!o||!o.clientId)throw new m(i.MissingPaymentMethod);const{intent:a,clientId:s,merchantId:d,buyerCountry:c,attributionId:l,isHostedCheckoutEnabled:u,isDeveloperModeApplicable:h}=o,p=u||n;return{options:Object.assign({"client-id":s,"merchant-id":d,commit:p,components:["googlepay"],currency:t,intent:a},h&&{"buyer-country":c}),attributes:{"data-partner-attribution-id":l,"data-client-token":r,"data-namespace":"paypalGooglePay"}}}getPayPalApmSdkConfiguration(e,t){const{initializationData:n}=e;if(!n||!n.clientId)throw new m(i.MissingPaymentMethod);const{intent:r,clientId:o,merchantId:a,buyerCountry:s,attributionId:d,isDeveloperModeApplicable:c,availableAlternativePaymentMethods:l=[],enabledAlternativePaymentMethods:u=[]}=n,h=this.filterFundingOptions(u),p=this.filterFundingOptions(l.filter((e=>!u.includes(e))));return{options:Object.assign({"client-id":o,"merchant-id":a,"enable-funding":h.length>0?h:void 0,"disable-funding":p.length>0?p:void 0,commit:!0,components:["buttons","payment-fields"],currency:t,intent:r},c&&{"buyer-country":s}),attributes:{"data-partner-attribution-id":d,"data-namespace":"paypalApms"}}}getPayPalSdkMessagesConfiguration(e,t){const{initializationData:n}=e;if(!n||!n.clientId)throw new m(i.MissingPaymentMethod);const{clientId:r,merchantId:o,attributionId:a,isDeveloperModeApplicable:s,buyerCountry:d}=n;return{options:Object.assign({"client-id":r,"merchant-id":o,components:["messages"],currency:t},s&&{"buyer-country":d}),attributes:{"data-namespace":"paypalMessages","data-partner-attribution-id":a}}}filterFundingOptions(e){const t=["klarna"];return e?e.filter((e=>!t.includes(e))):[]}transformConfig(e){let t={};return Object.keys(e).forEach((n=>{const i=e[n];null==i||""===i||Array.isArray(i)&&0===i.length||(t=Object.assign(Object.assign({},t),{[n]:Array.isArray(i)?i.join(","):i}))})),t}}function U(){return new j((0,s.Hb)())}const V=function({styles:e}){const t={};return e.color&&(t.color=e.color),e.layout&&(t.layout=e.layout),(e["logo-type"]||e["logo-position"])&&(t.logo={},e["logo-type"]&&(t.logo.type=e["logo-type"]),e["logo-position"]&&(t.logo.position=e["logo-position"])),e.ratio&&(t.ratio=e.ratio),(e["text-color"]||e["text-size"])&&(t.text={},e["text-color"]&&(t.text.color=e["text-color"]),e["text-size"]&&(t.text.size=+e["text-size"])),t};var q=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class H{constructor(e,t,n){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.payPalSdkHelper=n}initialize(e){return q(this,void 0,void 0,(function*(){const{bigcommerce_payments_paylater:t,containerId:n,methodId:i}=e,{buyNowInitializeOptions:r,currencyCode:o,messagingContainerId:a}=t||{},s=!!r;if(!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new F('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.bigcommerce_payments_paylater" argument is not provided.');if(s&&!o)throw new F('Unable to initialize payment because "options.bigcommerce_payments_paylater.currencyCode" argument is not provided.');if(s&&"function"!=typeof(null==r?void 0:r.getBuyNowCartRequestBody))throw new F('Unable to initialize payment because "options.bigcommerce_payments_paylater.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');s||(yield this.paymentIntegrationService.loadDefaultCheckout());const d=this.paymentIntegrationService.getState(),c=s?o:d.getCartOrThrow().currency.code;yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i,c,!1),this.renderButton(n,i,t);const l=a&&document.getElementById(a);if(c&&l){const e=d.getPaymentMethodOrThrow(i),{paypalBNPLConfiguration:t=[]}=e.initializationData||{},n=t&&t.find((({id:e})=>"cart"===e));if(!(null==n?void 0:n.status))return;l.removeAttribute("data-pp-style-logo-type"),l.removeAttribute("data-pp-style-logo-position"),l.removeAttribute("data-pp-style-text-color"),l.removeAttribute("data-pp-style-text-size");const r=yield this.payPalSdkHelper.getPayPalMessages(e,c);this.renderMessages(r,a,n)}}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onComplete:o,onEligibilityFailure:a}=n,s=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),d=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{isHostedCheckoutEnabled:c}=d.initializationData||{},l={createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_paylater"),onApprove:({orderID:e})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(t,e)},u={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},h={onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e),onApprove:(e,n)=>this.onHostedCheckoutApprove(e,n,t,o)},m=[s.FUNDING.PAYLATER,s.FUNDING.CREDIT];let p=!1;m.forEach((t=>{if(!p){const n=Object.assign(Object.assign(Object.assign({fundingSource:t,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(r)},l),i&&u),c&&h),o=s.Buttons(n);o.isEligible()?(o.render(`#${e}`),p=!0):a&&"function"==typeof a&&a()}})),p||this.bigCommercePaymentsIntegrationService.removeElement(e)}handleClick(e){return q(this,void 0,void 0,(function*(){if(e){const t=yield this.bigCommercePaymentsIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}onHostedCheckoutApprove(e,t,n,r){return q(this,void 0,void 0,(function*(){if(!e.orderID)throw new m(i.MissingOrderId);const o=this.paymentIntegrationService.getState().getCartOrThrow(),a=yield t.order.get();try{const t=this.bigCommercePaymentsIntegrationService.getBillingAddressFromOrderDetails(a);if(yield this.paymentIntegrationService.updateBillingAddress(t),o.lineItems.physicalItems.length>0){const e=this.bigCommercePaymentsIntegrationService.getShippingAddressFromOrderDetails(a);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.bigCommercePaymentsIntegrationService.updateOrder()}return yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.bigCommercePaymentsIntegrationService.submitPayment(n,e.orderID),r&&"function"==typeof r&&r(),!0}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingAddressChange(e){return q(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingOptionsChange(e){return q(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"cart",style:V(n)};e.Messages(i).render(`#${t}`)}}l((e=>new H(e,z(e),U())),[{id:"bigcommerce_payments_paylater"}]);var G=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ${constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t}initialize(e){return G(this,void 0,void 0,(function*(){const{bigcommerce_payments_apms:t,containerId:n,methodId:i}=e,{apm:r,buyNowInitializeOptions:o,currencyCode:a}=t||{},s=!!o;if(!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new F('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.bigcommerce_payments_apms" argument is not provided.');if(!r)throw new F('Unable to initialize payment because "options.bigcommerce_payments_apms.apm" argument is not provided.');if(s&&!a)throw new F('Unable to initialize payment because "options.bigcommerce_payments_apms.currencyCode" argument is not provided.');if(s&&"function"!=typeof(null==o?void 0:o.getBuyNowCartRequestBody))throw new F('Unable to initialize payment because "options.bigcommerce_payments_apms.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');s||(yield this.paymentIntegrationService.loadDefaultCheckout());const d=s?a:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i,d,!1),this.renderButton(n,i,t)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{apm:i,buyNowInitializeOptions:r,style:o,onEligibilityFailure:a}=n,s=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow();if(!Object.values(s.FUNDING).includes(i))throw new F('Unable to initialize PayPal button because "options.bigcommerce_payments_apms.apm" argument is not valid funding source.');const d={createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_apms"),onApprove:({orderID:e})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(t,e)},c={onClick:()=>this.handleClick(r),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},l=Object.assign(Object.assign({fundingSource:i,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o)},d),r&&c),u=s.Buttons(l);u.isEligible()?u.render(`#${e}`):a&&"function"==typeof a?a():this.bigCommercePaymentsIntegrationService.removeElement(e)}handleClick(e){return G(this,void 0,void 0,(function*(){if(e){const t=yield this.bigCommercePaymentsIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}}l((e=>new $(e,z(e))),[{id:"bigcommerce_payments_apms"}]);var W=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Y{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t}initialize(e){return W(this,void 0,void 0,(function*(){const{bigcommerce_payments_venmo:t,containerId:n,methodId:i}=e,{buyNowInitializeOptions:r,currencyCode:o}=t||{},a=!!r;if(!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new F('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.bigcommerce_payments_venmo" argument is not provided.');if(a&&!o)throw new F('Unable to initialize payment because "options.bigcommerce_payments_venmo.currencyCode" argument is not provided.');if(a&&"function"!=typeof(null==r?void 0:r.getBuyNowCartRequestBody))throw new F('Unable to initialize payment because "options.bigcommerce_payments_venmo.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');a||(yield this.paymentIntegrationService.loadDefaultCheckout());const s=a?o:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i,s,!1),this.renderButton(n,i,t)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onEligibilityFailure:o}=n,a=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),s=a.FUNDING.VENMO,d={createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_venmo"),onApprove:({orderID:e})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(t,e)},c={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},l=Object.assign(Object.assign({fundingSource:s,style:this.getValidVenmoButtonStyles(r)},d),i&&c),u=a.Buttons(l);u.isEligible()?u.render(`#${e}`):o&&"function"==typeof o?o():this.bigCommercePaymentsIntegrationService.removeElement(e)}getValidVenmoButtonStyles(e){const t=this.bigCommercePaymentsIntegrationService.getValidButtonStyle(e);return t.color===C.gold?Object.assign(Object.assign({},t),{color:void 0}):t}handleClick(e){return W(this,void 0,void 0,(function*(){if(e){const t=yield this.bigCommercePaymentsIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}}l((e=>new Y(e,z(e))),[{id:"bigcommerce_payments_venmo"}]);const K={size:70,color:"#d9d9d9",backgroundColor:"#ffffff"},Q="embedded-checkout-loading-indicator-rotation";class J{constructor(e){this.styles=Object.assign(Object.assign({},K),e&&e.styles),this.containerStyles=Object.assign({},e&&e.containerStyles),this.defineAnimation(),this.container=this.buildContainer(),this.indicator=this.buildIndicator(),this.container.appendChild(this.indicator)}show(e){if(e){const t=document.getElementById(e);if(!t)throw new Error("Unable to attach the loading indicator because the parent ID is not valid.");t.appendChild(this.container)}this.container.style.visibility="visible",this.container.style.opacity="1"}hide(){const e=()=>{this.container.style.visibility="hidden",this.container.removeEventListener("transitionend",e)};this.container.addEventListener("transitionend",e),this.container.style.opacity="0"}buildContainer(){const e=document.createElement("div");return e.style.display="block",e.style.bottom="0",e.style.left="0",e.style.height="100%",e.style.width="100%",e.style.position="absolute",e.style.right="0",e.style.top="0",e.style.transition="all 250ms ease-out",e.style.opacity="0",this.setStyleAttribute(e,this.containerStyles),e}buildIndicator(){const e=document.createElement("div");return e.style.display="block",e.style.width=`${this.styles.size}px`,e.style.height=`${this.styles.size}px`,e.style.borderRadius=`${this.styles.size}px`,e.style.border="solid 1px",e.style.borderColor=`${this.styles.backgroundColor} ${this.styles.backgroundColor} ${this.styles.color} ${this.styles.color}`,e.style.margin="0 auto",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="50%",e.style.transform="translateY(-50%) rotate(0deg)",e.style.transformStyle="preserve-3d",e.style.animation=`${Q} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`,e}setStyleAttribute(e,t){Object.keys(t).forEach((n=>{e.style.setProperty(n,t[n])}))}defineAnimation(){var e;if(document.getElementById(Q))return;const t=document.createElement("style");t.id=Q,null===(e=document.head)||void 0===e||e.appendChild(t),t.sheet instanceof CSSStyleSheet&&t.sheet.insertRule(`\n                @keyframes ${Q} {\n                    0% { transform: translateY(-50%) rotate(0deg); }\n                    100% { transform: translateY(-50%) rotate(360deg); }\n                }\n            `,0)}}const Z={"background-color":"rgba(0, 0, 0, 0.4)","z-index":"1000"};class X extends F{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}class ee extends g{constructor(e){super(e,{message:"There is a problem processing your payment. Please try again later."}),this.name="PaymentMethodInvalidError",this.type="payment_method_invalid"}}class te extends u{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}function ne(e){return!("object"!=typeof e||null===e||void 0!==e.shouldSaveInstrument&&"boolean"!=typeof e.shouldSaveInstrument||void 0!==e.shouldSetAsDefaultInstrument&&"boolean"!=typeof e.shouldSetAsDefaultInstrument)}function ie(e){return Boolean(e.instrumentId)}function re(e){return"object"==typeof e&&null!==e&&"bigpayToken"in e&&"defaultInstrument"in e&&"provider"in e&&"trustedShippingAddress"in e&&"method"in e&&"type"in e}var oe=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ae{constructor(e,t,n){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.loadingIndicator=n}initialize(e){var t,n;return oe(this,void 0,void 0,(function*(){const{methodId:i,bigcommerce_payments:r}=e||{};if(this.bigcommerce_payments=r,!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new F('Unable to initialize payment because "options.bigcommerce_payments" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(i);const o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i);this.loadingIndicatorContainer=r.container.split("#")[1],(null===(t=o.initializationData)||void 0===t?void 0:t.orderId)?this.orderId=null===(n=o.initializationData)||void 0===n?void 0:n.orderId:(yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i),r.onInit&&"function"==typeof r.onInit&&r.onInit((()=>this.renderButton(i,r))),(void 0===r.shouldRenderPayPalButtonOnInitialization||r.shouldRenderPayPalButtonOnInitialization)&&this.renderButton(i,r))}))}execute(e,t){return oe(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{onError:r}=this.bigcommerce_payments||{},o=this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,a=o&&o["PAYPAL-3438.handling_instrument_declined_error_ppc"];if(!n)throw new X(["payment"]);const{methodId:s,paymentData:d}=n;if(this.isPayPalVaultedInstrumentPaymentData(d)&&!this.orderId&&(this.orderId=yield this.createOrder()),!this.orderId)throw new ee;const c=this.isPayPalVaultedInstrumentPaymentData(d)?this.prepareVaultedInstrumentPaymentPayload(s,this.orderId,d):this.preparePaymentPayload(s,this.orderId,d);try{yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment(c)}catch(e){return this.isProviderError(e)&&a&&(yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n.methodId),yield new Promise(((e,t)=>{var i;this.bigcommerce_payments&&(null===(i=this.paypalButton)||void 0===i||i.close(),this.renderButton(n.methodId,this.bigcommerce_payments),this.handleError(new Error("INSTRUMENT_DECLINED"),r)),t()}))),this.handleError(e,r),Promise.reject()}}))}finalize(){return Promise.reject(new te)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}prepareVaultedInstrumentPaymentPayload(e,t,n){const{instrumentId:i,shouldSetAsDefaultInstrument:r}=n,o=!this.isTrustedVaultingFlow(n);return o?{methodId:e,paymentData:{shouldSaveInstrument:o,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t}}}}:{methodId:e,paymentData:{instrumentId:i,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t},bigpay_token:{token:i}}}}}preparePaymentPayload(e,t,n){const{shouldSaveInstrument:i=!1,shouldSetAsDefaultInstrument:r=!1}=ne(n)?n:{};return{methodId:e,paymentData:{shouldSaveInstrument:i,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t}}}}}renderButton(e,t){const n=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u={fundingSource:n.FUNDING.PAYPAL,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o),createOrder:()=>this.createOrder(),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onError:e=>this.handleError(e,s),onCancel:()=>this.toggleLoadingIndicator(!1)};this.paypalButton=n.Buttons(u),this.paypalButton.isEligible()&&(d&&"function"==typeof d&&d(),this.paypalButton.render(a))}handleClick(e,t){return oe(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;yield t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,t()}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}createOrder(){return oe(this,void 0,void 0,(function*(){const e=this.getFieldsValues();return this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_paymentscheckout",{shouldSaveInstrument:(null==e?void 0:e.shouldSaveInstrument)||!1})}))}getFieldsValues(){const{getFieldsValues:e}=this.bigcommerce_payments||{};return"function"==typeof e?e():void 0}isTrustedVaultingFlow(e){if(e&&ie(e)){const t=this.paymentIntegrationService.getState().getInstruments(),n=null==t?void 0:t.find((t=>re(t)&&t.bigpayToken===e.instrumentId));return!(re(n)&&!n.trustedShippingAddress)}return!1}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}isPayPalVaultedInstrumentPaymentData(e){return!!e&&ie(e)&&ne(e)}isProviderError(e){var t,n,i;return!!function(e){return"object"==typeof e&&null!==e&&"errors"in e}(e)&&"INSTRUMENT_DECLINED"===(null===(i=null===(n=((null===(t=null==e?void 0:e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error)))||[])[0])||void 0===n?void 0:n.provider_error)||void 0===i?void 0:i.code)}}const se=l((e=>new ae(e,z(e),new J({containerStyles:Z}))),[{id:"bigcommerce_payments"}]);var de,ce,le,ue,he,me,pe,ye;!function(e){e.CVV="cvv",e.PAN="pan"}(de||(de={}));class ge{static get(e){const t=`${encodeURIComponent(`${e}`)}=`,n=document.cookie;let i=null;const r=n.indexOf(t);if(r>-1){let e=n.indexOf(";",r);-1===e&&(e=n.length),i=decodeURIComponent(n.substring(r+t.length,e))}return i}static set(e,t,n={secure:!0}){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;const{expires:r,path:o,domain:a,secure:s}=n;if(r)i+=`; expires=${r.toUTCString()}`;else{const e=new Date,t=60;e.setTime(e.getTime()+60*t*1e3),i+=`; expires=${e.toUTCString()}`}o&&(i+=`; path=${o}`),a&&(i+=`; domain=${a}`),s&&(i+="; secure"),document.cookie=i}static remove(e,t){ge.set(e,"",Object.assign({expires:new Date(0)},t))}}!function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(ce||(ce={})),function(e){e.Possible="POSSIBLE",e.No="NO",e.Unknown="UNKNOWN",e.Yes="YES"}(le||(le={})),function(e){e.Succeeded="succeeded",e.Cancelled="cancelled",e.Errored="errored"}(ue||(ue={})),function(e){e.paypal="paypal",e.checkout="checkout",e.buynow="buynow",e.pay="pay",e.installment="installment"}(he||(he={})),function(e){e.gold="gold",e.blue="blue",e.silver="silver",e.black="black",e.white="white"}(me||(me={})),function(e){e.pill="pill",e.rect="rect"}(pe||(pe={})),function(e){e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled",e.UNRECOGNIZED="unrecognized"}(ye||(ye={}));var ve=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class fe{constructor(){this.window=window}initializePayPalFastlane(e,t,n){return ve(this,void 0,void 0,(function*(){if(t&&(window.localStorage.setItem("fastlaneEnv","sandbox"),window.localStorage.setItem("axoEnv","sandbox")),!this.window.paypalFastlane){const t={root:{backgroundColorPrimary:"transparent"}};this.window.paypalFastlane=yield e.Fastlane({styles:n||t})}return this.window.paypalFastlane}))}getPayPalFastlaneOrThrow(){if(!this.window.paypalFastlane)throw new h;return this.window.paypalFastlane}lookupCustomerOrThrow(e){return ve(this,void 0,void 0,(function*(){return this.getPayPalFastlaneOrThrow().identity.lookupCustomerByEmail(e)}))}triggerAuthenticationFlowOrThrow(e){return ve(this,void 0,void 0,(function*(){return e?this.getPayPalFastlaneOrThrow().identity.triggerAuthenticationFlow(e):{}}))}updateStorageSessionId(e){const t=new Date;t.setDate(t.getDate()+14);const n={expires:t,secure:!0};ge.set("bc-fastlane-sessionId",e,n)}removeStorageSessionId(){ge.remove("bc-fastlane-sessionId")}getStorageSessionId(){return ge.get("bc-fastlane-sessionId")||""}mapPayPalFastlaneProfileToBcCustomerData(e,t){var n,i,r;const{authenticationState:o,profileData:a}=t,s=null===(r=null===(i=null===(n=null==a?void 0:a.card)||void 0===n?void 0:n.paymentSource)||void 0===i?void 0:i.card)||void 0===r?void 0:r.billingAddress,d=null==a?void 0:a.shippingAddress,c=null==a?void 0:a.name,l=null==a?void 0:a.card,u=d?this.mapPayPalToBcAddress(d.address,d.name,d.phoneNumber):void 0,h=s&&c?this.mapPayPalToBcAddress(s,c,null==d?void 0:d.phoneNumber):void 0,m=l?this.mapPayPalToBcInstrument(e,l):[],p=this.filterAddresses([u,h]);return{authenticationState:o||ye.UNRECOGNIZED,addresses:p,billingAddress:h,shippingAddress:u,instruments:m}}mapPayPalToBcInstrument(e,t){const{id:n,paymentSource:i}=t,{brand:r,expiry:o,lastDigits:a}=i.card,[s,d]=o.split("-");return[{bigpayToken:n,brand:r,defaultInstrument:!1,expiryMonth:d,expiryYear:s,iin:"",last4:a,method:e,provider:e,trustedShippingAddress:!1,untrustedShippingCardVerificationMode:de.PAN,type:"card"}]}mapBcToPayPalAddress(e){return{company:(null==e?void 0:e.company)||"",addressLine1:(null==e?void 0:e.address1)||"",addressLine2:(null==e?void 0:e.address2)||"",adminArea1:(null==e?void 0:e.stateOrProvinceCode)||(null==e?void 0:e.stateOrProvince)||"",adminArea2:(null==e?void 0:e.city)||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCode:(null==e?void 0:e.countryCode)||""}}mapPayPalToBcAddress(e,t,n,i){const[r,o]=t.fullName.split(" "),a=(null==n?void 0:n.nationalNumber)||"",s=(null==n?void 0:n.countryCode)||"";return{id:Date.now(),type:"paypal-address",firstName:t.firstName||r||"",lastName:t.lastName||o||"",company:e.company||"",address1:e.addressLine1,address2:e.addressLine2||"",city:e.adminArea2,stateOrProvince:e.adminArea1,stateOrProvinceCode:e.adminArea1,country:e.countryCode||"",countryCode:e.countryCode||"",postalCode:e.postalCode,phone:s+a,customFields:i||[]}}filterAddresses(e){return e.reduce(((e,t)=>t?e.some((e=>this.isEqualAddresses(e,t)))?e:[...e,t]:e),[])}isEqualAddresses(e,t){return(0,d.isEqual)(this.normalizeAddress(e),this.normalizeAddress(t))}normalizeAddress(e){return(0,d.omit)(e,["id","phone"])}}function be(){return new fe}function Se(e){return"string"!=typeof e}function Ce(e,t){if(t||e)return function(e){var t,n;const i={},r=(0,d.omitBy)(e.root,Se),o=(0,d.omitBy)(e.input,Se),a=(0,d.omitBy)(e.toggle,Se),s=(0,d.omitBy)(null===(t=e.text)||void 0===t?void 0:t.body,Se),c=(0,d.omitBy)(null===(n=e.text)||void 0===n?void 0:n.caption,Se),l=e.branding;return Object.keys(r).length&&(i.root=r),Object.keys(o).length&&(i.input=o),Object.keys(a).length&&(i.toggle=a),Object.keys(s).length&&(i.text={},i.text.body=s),Object.keys(c).length&&(i.text=Object.assign({},i.text),i.text.caption=c),l&&(i.branding=l),i}(function(e,t){var n,i,r,o,a,s,d,c,l,u,h,m,p,y,g,v,f,b,S,C,w,_;return{root:{backgroundColorPrimary:(null==e?void 0:e.fastlaneRootSettingsBackgroundColor)||(null===(n=null==t?void 0:t.root)||void 0===n?void 0:n.backgroundColorPrimary),errorColor:(null==e?void 0:e.fastlaneRootSettingsErrorColor)||(null===(i=null==t?void 0:t.root)||void 0===i?void 0:i.errorColor),fontFamily:(null==e?void 0:e.fastlaneRootSettingsFontFamily)||(null===(r=null==t?void 0:t.root)||void 0===r?void 0:r.fontFamily),fontSizeBase:(null==e?void 0:e.fastlaneRootSettingsFontSize)||(null===(o=null==t?void 0:t.root)||void 0===o?void 0:o.fontSizeBase),padding:(null==e?void 0:e.fastlaneRootSettingsPadding)||(null===(a=null==t?void 0:t.root)||void 0===a?void 0:a.padding),primaryColor:(null==e?void 0:e.fastlaneRootSettingsPrimaryColor)||(null===(s=null==t?void 0:t.root)||void 0===s?void 0:s.primaryColor)},input:{borderRadius:(null==e?void 0:e.fastlaneInputSettingsBorderRadius)||(null===(d=null==t?void 0:t.input)||void 0===d?void 0:d.borderRadius),borderColor:(null==e?void 0:e.fastlaneInputSettingsBorderColor)||(null===(c=null==t?void 0:t.input)||void 0===c?void 0:c.borderColor),focusBorderColor:(null==e?void 0:e.fastlaneInputSettingsFocusBorderBase)||(null===(l=null==t?void 0:t.input)||void 0===l?void 0:l.focusBorderColor),backgroundColor:(null==e?void 0:e.fastlaneInputSettingsBackgroundColor)||(null===(u=null==t?void 0:t.input)||void 0===u?void 0:u.backgroundColor),borderWidth:(null==e?void 0:e.fastlaneInputSettingsBorderWidth)||(null===(h=null==t?void 0:t.input)||void 0===h?void 0:h.borderWidth),textColorBase:(null==e?void 0:e.fastlaneInputSettingsTextColorBase)||(null===(m=null==t?void 0:t.input)||void 0===m?void 0:m.textColorBase)},toggle:{colorPrimary:(null==e?void 0:e.fastlaneToggleSettingsColorPrimary)||(null===(p=null==t?void 0:t.toggle)||void 0===p?void 0:p.colorPrimary),colorSecondary:(null==e?void 0:e.fastlaneToggleSettingsColorSecondary)||(null===(y=null==t?void 0:t.toggle)||void 0===y?void 0:y.colorSecondary)},text:{body:{color:(null==e?void 0:e.fastlaneTextBodySettingsColor)||(null===(v=null===(g=null==t?void 0:t.text)||void 0===g?void 0:g.body)||void 0===v?void 0:v.color),fontSize:(null==e?void 0:e.fastlaneTextBodySettingsFontSize)||(null===(b=null===(f=null==t?void 0:t.text)||void 0===f?void 0:f.body)||void 0===b?void 0:b.fontSize)},caption:{color:(null==e?void 0:e.fastlaneTextCaptionSettingsColor)||(null===(C=null===(S=null==t?void 0:t.text)||void 0===S?void 0:S.caption)||void 0===C?void 0:C.color),fontSize:(null==e?void 0:e.fastlaneTextCaptionSettingsFontSize)||(null===(_=null===(w=null==t?void 0:t.text)||void 0===w?void 0:w.caption)||void 0===_?void 0:_.fontSize)}},branding:(null==e?void 0:e.fastlaneBrandingSettings)||(null==t?void 0:t.branding)}}(e,t))}function we(e){return!!e&&("authenticationState"in e||"addresses"in e||"instruments"in e)}function _e(e,t,n=!0){var i;return null!==(i=e[t])&&void 0!==i?i:n}var Ie=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Pe{constructor(e,t,n,i){this.paymentIntegrationService=e,this.bigCommercePaymentsRequestSender=t,this.bigCommercePaymentsSdk=n,this.bigCommercePaymentsFastlaneUtils=i}initialize(e){var t,n;return Ie(this,void 0,void 0,(function*(){const{methodId:i,bigcommerce_payments_fastlane:r}=e;if(!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(this.methodId=i,!r)throw new F('Unable to initialize payment because "options.bigcommerce_payments_fastlane" argument is not provided.');if(this.bigcommerce_payments_fastlane=r,!r.onInit||"function"!=typeof r.onInit)throw new F('Unable to initialize payment because "options.bigcommerce_payments_fastlane.onInit" argument is not provided or it is not a function.');if(!r.onChange||"function"!=typeof r.onChange)throw new F('Unable to initialize payment because "options.bigcommerce_payments_fastlane.onChange" argument is not provided or it is not a function.');yield this.paymentIntegrationService.loadPaymentMethod(i);const o=this.paymentIntegrationService.getState(),a=o.getCartOrThrow(),s=o.getPaymentMethodOrThrow(i),{isDeveloperModeApplicable:d,isFastlaneStylingEnabled:c}=s.initializationData||{};this.threeDSVerificationMethod=null===(t=s.initializationData)||void 0===t?void 0:t.threeDSVerificationMethod,this.paypalFastlaneSdk=yield this.bigCommercePaymentsSdk.getPayPalFastlaneSdk(s,a.currency.code,a.id);const l=Ce(c?null===(n=null==s?void 0:s.initializationData)||void 0===n?void 0:n.fastlaneStyles:{},null==r?void 0:r.styles);yield this.bigCommercePaymentsFastlaneUtils.initializePayPalFastlane(this.paypalFastlaneSdk,!!d,l),this.shouldRunAuthenticationFlow()&&(yield this.runPayPalAuthenticationFlowOrThrow(i)),yield this.initializePayPalPaymentComponent(),r.onInit((e=>this.renderPayPalPaymentComponent(e))),r.onChange((()=>this.handlePayPalStoredInstrumentChange(i)))}))}execute(e,t){return Ie(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new X(["payment"]);const{paymentData:r,methodId:o}=n,a=r&&ie(r);try{yield this.paymentIntegrationService.submitOrder(i,t);const e=a?yield this.prepareVaultedInstrumentPaymentPayload(o,r):yield this.preparePaymentPayload(o,r);yield this.paymentIntegrationService.submitPayment(e),this.bigCommercePaymentsFastlaneUtils.removeStorageSessionId()}catch(e){if(function(e){return"object"==typeof e&&null!==e&&"message"in e&&"response"in e&&"name"in e.response}(e)&&"INVALID_REQUEST"===e.response.name){const e={translationKey:"payment.errors.invalid_request_error"};return this.handleError(e),Promise.reject()}if(e instanceof Error&&"FastlaneError"!==e.name)throw e;return Promise.reject()}}))}finalize(){return Promise.reject(new te)}deinitialize(){return Ie(this,void 0,void 0,(function*(){return Promise.resolve()}))}shouldRunAuthenticationFlow(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getCustomerOrThrow(),i=e.getPaymentProviderCustomer(),r=we(i)?i:{},o=this.bigCommercePaymentsFastlaneUtils.getStorageSessionId();return!(!n.isGuest||(null==r?void 0:r.authenticationState)===ye.CANCELED||(null==r?void 0:r.authenticationState)||o!==t.id)}runPayPalAuthenticationFlowOrThrow(e){return Ie(this,void 0,void 0,(function*(){try{const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getCustomer(),r=t.getBillingAddress(),o=(null==i?void 0:i.email)||(null==r?void 0:r.email)||"",{customerContextId:a}=yield this.bigCommercePaymentsFastlaneUtils.lookupCustomerOrThrow(o),s=yield this.bigCommercePaymentsFastlaneUtils.triggerAuthenticationFlowOrThrow(a),{authenticationState:d,addresses:c,instruments:l}=this.bigCommercePaymentsFastlaneUtils.mapPayPalFastlaneProfileToBcCustomerData(e,s);yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:d,addresses:c,instruments:l}),s.authenticationState===ye.CANCELED?this.bigCommercePaymentsFastlaneUtils.removeStorageSessionId():this.bigCommercePaymentsFastlaneUtils.updateStorageSessionId(n.id)}catch(e){}}))}initializePayPalPaymentComponent(){return Ie(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),t=e.phone,n=`${e.firstName} ${e.lastName}`.trim(),i=this.bigCommercePaymentsFastlaneUtils.getPayPalFastlaneOrThrow(),r={fields:Object.assign({cardholderName:{prefill:n,enabled:!0}},t&&{phoneNumber:{prefill:t}})};this.paypalComponentMethods=yield i.FastlaneCardComponent(r)}))}renderPayPalPaymentComponent(e){const t=this.getPayPalComponentMethodsOrThrow();if(!e)throw new F('Unable to render card component because "container" argument is not provided.');t.render(e)}getPayPalComponentMethodsOrThrow(){if(!this.paypalComponentMethods)throw new h;return this.paypalComponentMethods}prepareVaultedInstrumentPaymentPayload(e,t){return Ie(this,void 0,void 0,(function*(){const{instrumentId:n}=t,i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),r=this.isBigcommercePaymentsFastlaneThreeDSAvailable()&&i.config.is3dsEnabled;r||(yield this.createOrder(n));const o=r?yield this.get3DSNonce(n):n;return{methodId:e,paymentData:{formattedPayload:{paypal_fastlane_token:{order_id:this.orderId,token:o}}}}}))}preparePaymentPayload(e,t){return Ie(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getBillingAddressOrThrow(),r=n.getPaymentMethodOrThrow(e),o=`${i.firstName} ${i.lastName}`.trim(),{getPaymentToken:a}=this.getPayPalComponentMethodsOrThrow(),{id:s}=yield a({name:{fullName:o},billingAddress:this.bigCommercePaymentsFastlaneUtils.mapBcToPayPalAddress(i)}),d=this.isBigcommercePaymentsFastlaneThreeDSAvailable()&&r.config.is3dsEnabled;d||(yield this.createOrder(s));const{shouldSaveInstrument:c=!1,shouldSetAsDefaultInstrument:l=!1}=ne(t)?t:{},u=d?yield this.get3DSNonce(s):s;return{methodId:e,paymentData:Object.assign(Object.assign({},t),{shouldSaveInstrument:c,shouldSetAsDefaultInstrument:l,formattedPayload:{paypal_fastlane_token:{order_id:this.orderId,token:u}}})}}))}createOrder(e){return Ie(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getCartOrThrow().id;if(this.methodId){const{orderId:n}=yield this.bigCommercePaymentsRequestSender.createOrder(this.methodId,{cartId:t,fastlaneToken:e});this.orderId=n}}))}get3DSNonce(e){var t;return Ie(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getCartOrThrow(),r=n.getOrderOrThrow(),o=n.getStoreConfigOrThrow().links.checkoutLink,a=null===(t=this.paypalFastlaneSdk)||void 0===t?void 0:t.ThreeDomainSecureClient;if(!a)throw new h;const s={amount:r.orderAmount.toFixed(2),currency:i.currency.code,nonce:e,threeDSRequested:"SCA_ALWAYS"===this.threeDSVerificationMethod,transactionContext:{experience_context:{locale:"en-US",return_url:o,cancel_url:o}}};if(yield a.isEligible(s)){const{liabilityShift:t,authenticationState:n,nonce:i}=yield a.show();if(t===f.No||t===f.Unknown)throw new ee;if(yield this.createOrder(e),n===ue.Succeeded)return i;if(n===ue.Errored)throw new ee;if(n===ue.Cancelled)throw console.error("3DS check was canceled"),new ee}return e}))}handlePayPalStoredInstrumentChange(e){return Ie(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsFastlaneUtils.getPayPalFastlaneOrThrow(),{selectionChanged:n,selectedCard:i}=yield t.profile.showCardSelector();if(n){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomer(),n=we(t)?t:{},r=this.bigCommercePaymentsFastlaneUtils.mapPayPalToBcInstrument(e,i)[0];return yield this.paymentIntegrationService.updatePaymentProviderCustomer(Object.assign(Object.assign({},n),{instruments:[r]})),r}}))}isBigcommercePaymentsFastlaneThreeDSAvailable(){return _e(this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,"PROJECT-7080.bcp_fastlane_three_ds")}handleError(e){var t;(null===(t=this.bigcommerce_payments_fastlane)||void 0===t?void 0:t.onError)&&"function"==typeof this.bigcommerce_payments_fastlane.onError&&this.bigcommerce_payments_fastlane.onError(e)}}const Ee=l((e=>{const{getHost:t}=e.getState();return new Pe(e,new M((0,a.createRequestSender)({host:t()})),U(),be())}),[{id:"bigcommerce_payments_fastlane"}]);class Oe extends u{constructor(e){super(e||"Not implemented."),this.name="NotImplementedError",this.type="not_implemented"}}var Ae=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ke{constructor(e,t,n,i){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.loadingIndicator=n,this.paypalSdkHelper=i}initialize(e){return Ae(this,void 0,void 0,(function*(){const{methodId:t,bigcommerce_payments_paylater:n}=e||{};if(!t)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new F('Unable to initialize payment because "options.bigcommerce_payments_paylater" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(t);const i=this.paymentIntegrationService.getState(),r=i.getPaymentMethodOrThrow(t),{paypalBNPLConfiguration:o=[],orderId:a}=r.initializationData||{},{bannerContainerId:s,container:d}=n;if(void 0!==s){if(!document.getElementById(s))return void console.error("Unable to create banner without valid banner container ID.");const e=o&&o.find((({id:e})=>"checkout"===e));if(!(null==e?void 0:e.status))return;const t=yield this.paypalSdkHelper.getPayPalMessages(r,i.getCartOrThrow().currency.code);return this.renderMessages(t,s,e)}a?this.orderId=a:(yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(t),this.loadingIndicatorContainer=null==d?void 0:d.split("#")[1],this.renderButton(t,n))}))}execute(e,t){return Ae(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new X(["payment"]);if(!this.orderId)throw new ee;yield this.paymentIntegrationService.submitOrder(i,t),yield this.bigCommercePaymentsIntegrationService.submitPayment(n.methodId,this.orderId)}))}finalize(){return Promise.reject(new te)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.bigCommercePaymentsButtons)||void 0===e||e.close(),Promise.resolve()}renderButton(e,t){if(!(null==t?void 0:t.container))throw new F('Unable to initialize payment because "container" argument is not provided.');const n=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u=[n.FUNDING.PAYLATER,n.FUNDING.CREDIT];let h=!1;u.forEach((e=>{if(h)return;const t={fundingSource:e,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o),createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_paylater"),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onCancel:()=>this.toggleLoadingIndicator(!1),onError:e=>this.handleError(e,s)};if(this.bigCommercePaymentsButtons=n.Buttons(t),this.bigCommercePaymentsButtons.isEligible()||e!==n.FUNDING.PAYLATER){if(!this.bigCommercePaymentsButtons.isEligible()&&e===n.FUNDING.CREDIT)throw new Oe(`BigCommercePayments ${e} is not available for your region. Please use BigCommercePayments Checkout instead.`);d&&"function"==typeof d&&d(),this.bigCommercePaymentsButtons.render(a),h=!0}}))}handleClick(e,t){return Ae(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;t&&"function"==typeof t&&(yield t((()=>(this.toggleLoadingIndicator(!0),n())),i))}))}handleApprove({orderID:e},t){this.orderId=e,t&&"function"==typeof t&&t()}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"payment",style:V(n)};e.Messages(i).render(`#${t}`)}}const Te=l((e=>new ke(e,z(e),new J({containerStyles:Z}),U())),[{id:"bigcommerce_payments_paylater"}]);class Ne extends g{constructor(e){super(e,{message:"The request has timed out or aborted."}),this.name="TimeoutError",this.type="timeout"}}var Me=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class xe{constructor(e,t,n,i=3e3,r=3e5){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.loadingIndicator=n,this.pollingInterval=i,this.maxPollingIntervalTime=r,this.pollingTimer=0,this.stopPolling=d.noop}initialize(e){return Me(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,bigcommerce_payments_ratepay:i}=e;if(!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!i)throw new F('Unable to initialize payment because "options.bigcommerce_payments_ratepay" argument is not provided.');const{legalTextContainer:r,container:o,loadingContainerId:a}=i;if(!o)throw new F('Unable to initialize payment because "options.container" argument is not provided.');if(!r)throw new F('Unable to initialize payment because "options.legalTextContainer" argument is not provided.');if(!a)throw new F('Unable to initialize payment because "options.loadingContainerId" argument is not provided.');this.loadingIndicatorContainer=a;const s=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n,t),{merchantId:d}=s.initializationData||{};if(!d)throw new F("Unable to initialize payment because merchantId argument is not provided.");this.bigcommerce_payments_ratepay=i,yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n),this.createFraudNetScript(d,n,t),this.loadFraudnetConfig(),this.renderLegalText(r,o)}))}execute(e,t){return Me(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{getFieldsValues:r}=this.bigcommerce_payments_ratepay||{};if(!n)throw new X(["payment"]);if(!r||"function"!=typeof r)throw new F('Unable to initialize payment because "options.getFieldsValues" argument is not provided.');this.toggleLoadingIndicator(!0);try{const e=yield this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_apmscheckout",{metadataId:this.guid}),{ratepayBirthDate:o,ratepayPhoneNumber:a,ratepayPhoneCountryCode:s}=r(),d={formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:null,method_id:n.methodId,rate_pay:{birth_date:this.normalizeDate(o),phone:{national_number:a,country_code:s.split("+")[1]}},paypal_account:{order_id:e}}};return yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment({methodId:n.methodId,paymentData:d}),yield new Promise(((e,t)=>{this.initializePollingMechanism(n.methodId,e,t,n.gatewayId)}))}catch(e){return this.handleError(e),new Promise(((e,t)=>t()))}}))}finalize(){return Promise.reject(new te)}deinitialize(){const{legalTextContainer:e}=this.bigcommerce_payments_ratepay||{},t=document.querySelectorAll('[data-id="fraudnetScript"]')[0],n=document.querySelectorAll('[data-id="fraudnetConfig"]')[0];if(this.deinitializePollingMechanism(),t.remove(),n.remove(),e){const t=document.getElementById(e);null==t||t.remove()}return Promise.resolve()}normalizeDate(e){const t=this.formatDate(e.getDate()),n=this.formatDate(e.getMonth()+1);return`${e.getFullYear()}-${n}-${t}`}formatDate(e){return`${e<10?0:""}${e}`}renderLegalText(e,t){const n=e,i=t.split("#")[1],r=document.getElementById(i),o=null==r?void 0:r.parentNode,a=document.createElement("div");a.style.marginBottom="20px",a.setAttribute("id",n),null==o||o.prepend(a);const s=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),d=s.Legal({fundingSource:s.Legal.FUNDING.PAY_UPON_INVOICE});if(!document.getElementById(n))throw new F('Unable to initialize payment because "legalTextContainerElement" argument is not found.');d.render(`#${n}`)}handleError(e){const{onError:t}=this.bigcommerce_payments_ratepay||{};this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}createFraudNetScript(e,t,n){const i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t,n),{testMode:r}=i.config,o=document.createElement("script");o.setAttribute("type","application/json"),o.setAttribute("fncls","fnparams-dede7cc5-15fd-4c75-a9f4-36c430ee3a99"),o.setAttribute("data-id","fraudnetScript"),this.guid=this.generateGUID();const a={f:this.guid,s:`${e}_checkout-page`,sandbox:r};o.innerHTML=JSON.stringify(a),document.body.appendChild(o)}generateGUID(){let e="";for(let t=0;t<32;t+=1)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())];return e}loadFraudnetConfig(){const e=document.createElement("script");e.setAttribute("data-id","fraudnetConfig"),e.src="https://c.paypal.com/da/r/fb.js",document.body.appendChild(e)}reinitializeStrategy(e){return Me(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}initializePollingMechanism(e,t,n,i){return Me(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.bigCommercePaymentsIntegrationService.getOrderStatus("bigcommerce_payments_apms",{params:{useMetadata:!0}}),o=r===I.PollingStop,a=r===I.PollingError;if(o)return this.deinitializePollingMechanism(),t();if(a)return n();if(!o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,bigcommerce_payments_ratepay:this.bigcommerce_payments_ratepay}),this.handleError(new Ne)}catch(e){this.handleError(e),n()}}))}deinitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deinitializePollingMechanism()}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const De=l((e=>new xe(e,z(e),new J({containerStyles:Object.assign(Object.assign({},Z),{position:"fixed"})}))),[{gateway:"bigcommerce_payments_apms",id:"ratepay"}]);var ze;!function(e){e.CardCode="cardCode",e.CardCodeVerification="cardCodeVerification",e.CardExpiry="cardExpiry",e.CardName="cardName",e.CardNumber="cardNumber",e.CardNumberVerification="cardNumberVerification",e.CardExpiryVerification="cardExpiryVerification"}(ze||(ze={}));const Fe=ze;function Be(e){return Fe.CardNumber in e&&Fe.CardName in e&&Fe.CardExpiry in e}function Re(e){return Fe.CardNumberVerification in e&&Fe.CardCodeVerification in e&&Fe.CardExpiryVerification in e}class Le extends u{constructor(e){super(e||"Unable to proceed because the client library of a payment method has thrown an unexpected error."),this.name="PaymentMethodFailedError",this.type="payment_method_client_invalid"}}var je;!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(je||(je={}));class Ue extends u{constructor(e){super(function(e){switch(e){case je.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case je.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case je.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case je.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}class Ve extends u{constructor(e,t){super(t||"Unable to proceed because the payment form contains invalid data."),this.details=e,this.name="PaymentInvalidFormError",this.type="payment_invalid_form"}}var qe=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class He{constructor(e,t,n,i){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.bigCommercePaymentsSdk=n,this.bigCommercePaymentsFastlaneUtils=i}initialize(e){return qe(this,void 0,void 0,(function*(){const{methodId:t,bigcommerce_payments_creditcards:n}=e,i=n,{form:r,onCreditCardFieldsRenderingError:o}=i||{};if(!t)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new F('Unable to proceed because "options.bigcommerce_payments_creditcards.form" argument is not provided.');this.hostedFormOptions=r,this.isCreditCardForm=Be(r.fields),this.isCreditCardVaultedForm=Re(r.fields)&&!this.hasUndefinedValues(),yield this.paymentIntegrationService.loadPaymentMethod(t),yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(t,void 0,!0,!0),(this.isCreditCardForm||this.isCreditCardVaultedForm)&&(yield this.initializeFields(r,o)),this.shouldInitializePayPalFastlane(t)&&(yield this.initializePayPalFastlaneOrThrow(t))}))}execute(e,t){return qe(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{methodId:r,paymentData:o}=n||{};if(!n||!r)throw new X(["payment"]);if(this.executionPaymentData=o,this.isCreditCardForm||this.isCreditCardVaultedForm)yield this.validateHostedFormOrThrow(),yield this.submitHostedForm();else{const{orderId:e}=yield this.bigCommercePaymentsIntegrationService.createOrderCardFields("bigcommerce_payments_creditcardscheckout",this.getInstrumentParams());this.returnedOrderId=e}const a=this.preparePaymentPayload(r,o,this.returnedOrderId,this.returnedVaultedToken);yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment(a)}))}finalize(){return Promise.reject(new te)}deinitialize(){var e,t,n,i;return qe(this,void 0,void 0,(function*(){return yield null===(e=this.cvvField)||void 0===e?void 0:e.close(),yield null===(t=this.expiryField)||void 0===t?void 0:t.close(),yield null===(n=this.numberField)||void 0===n?void 0:n.close(),yield null===(i=this.nameField)||void 0===i?void 0:i.close(),Promise.resolve()}))}preparePaymentPayload(e,t,n,i){const{shouldSaveInstrument:r=!1,shouldSetAsDefaultInstrument:o=!1}=ne(t)?t:{},a=t&&ie(t)?t.instrumentId:void 0,s=(0,d.omitBy)({verification_nonce:i,token:a},d.isNil);return{methodId:e,paymentData:{shouldSaveInstrument:r,shouldSetAsDefaultInstrument:o,instrumentId:a,formattedPayload:Object.assign(Object.assign({},i||a?{bigpay_token:s}:{}),n?{card_with_order:{order_id:n}}:{})}}}initializeFields(e,t){return qe(this,void 0,void 0,(function*(){const{fields:n,styles:i}=e,r=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),o=this.getExecuteCallback(n),a=Object.assign({style:this.getInputStyles(i),onApprove:({orderID:e,vaultSetupToken:t,liabilityShift:n})=>{if(n===f.No||n===f.Unknown)throw new Error;return this.handleApprove({orderID:e,vaultSetupToken:t})},onError:()=>{throw new Le},inputEvents:{onChange:t=>this.onChangeHandler(e,t),onFocus:t=>this.onFocusHandler(e,t),onBlur:t=>this.onBlurHandler(e,t),onInputSubmitRequest:t=>this.onInputSubmitRequest(e,t)}},o);if(this.cardFields=yield r.CardFields(a),!this.cardFields.isEligible())throw new Ue(je.PaymentNotInitialized);try{this.stylizeInputContainers(n),Be(n)&&(yield this.renderFields(n)),Re(n)&&(yield this.renderVaultedFields(n))}catch(e){"function"==typeof t&&t(e)}}))}getExecuteCallback(e){return Re(e)?this.createVaultSetupTokenCallback():this.createOrderCallback()}createVaultSetupTokenCallback(){return{createVaultSetupToken:()=>qe(this,void 0,void 0,(function*(){const{setupToken:e}=(yield this.bigCommercePaymentsIntegrationService.createOrderCardFields("bigcommerce_payments_creditcardscheckout",Object.assign(Object.assign({},this.getInstrumentParams()),{setupToken:!0})))||{};return e}))}}createOrderCallback(){return{createOrder:()=>qe(this,void 0,void 0,(function*(){const{orderId:e}=(yield this.bigCommercePaymentsIntegrationService.createOrderCardFields("bigcommerce_payments_creditcardscheckout",this.getInstrumentParams()))||{};return e}))}}handleApprove({orderID:e,vaultSetupToken:t}){e&&(this.returnedOrderId=e),t&&(this.returnedVaultedToken=t)}renderFields(e){var t,n,i,r;return qe(this,void 0,void 0,(function*(){const o=this.getCardFieldsOrThrow();(null===(t=e.cardCode)||void 0===t?void 0:t.containerId)&&(this.cvvField=o.CVVField({placeholder:""}),yield this.cvvField.render(`#${e.cardCode.containerId}`)),(null===(n=e.cardExpiry)||void 0===n?void 0:n.containerId)&&(this.expiryField=o.ExpiryField(),yield this.expiryField.render(`#${e.cardExpiry.containerId}`)),(null===(i=e.cardName)||void 0===i?void 0:i.containerId)&&(this.nameField=o.NameField({placeholder:""}),yield this.nameField.render(`#${e.cardName.containerId}`)),(null===(r=e.cardNumber)||void 0===r?void 0:r.containerId)&&(this.numberField=o.NumberField({placeholder:""}),yield this.numberField.render(`#${e.cardNumber.containerId}`))}))}renderVaultedFields(e){var t,n,i;return qe(this,void 0,void 0,(function*(){const r=this.getCardFieldsOrThrow();(null===(t=e.cardCodeVerification)||void 0===t?void 0:t.containerId)&&(this.cvvField=r.CVVField({placeholder:""}),yield this.cvvField.render(`#${e.cardCodeVerification.containerId}`)),(null===(n=e.cardExpiryVerification)||void 0===n?void 0:n.containerId)&&(this.expiryField=r.ExpiryField(),yield this.expiryField.render(`#${e.cardExpiryVerification.containerId}`)),(null===(i=e.cardNumberVerification)||void 0===i?void 0:i.containerId)&&(this.numberField=r.NumberField({placeholder:""}),yield this.numberField.render(`#${e.cardNumberVerification.containerId}`))}))}getInstrumentParams(){if(!this.executionPaymentData)return{};if(ne(this.executionPaymentData)){const{shouldSaveInstrument:e,shouldSetAsDefaultInstrument:t}=this.executionPaymentData;return{shouldSaveInstrument:e,shouldSetAsDefaultInstrument:t}}if(ie(this.executionPaymentData)){const{instrumentId:e}=this.executionPaymentData;return{instrumentId:e}}return{}}getFieldTypeByEmittedField({emittedBy:e}){return{fieldType:this.mapFieldType(e)}}submitHostedForm(){return qe(this,void 0,void 0,(function*(){const e=this.getCardFieldsOrThrow(),t=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),n={billingAddress:{company:t.company,addressLine1:t.address1,addressLine2:t.address2,adminArea1:t.stateOrProvinceCode,adminArea2:t.city,postalCode:t.postalCode,countryCode:t.countryCode}};try{this.isCreditCardVaultedForm?yield e.submit():yield e.submit(n)}catch(e){throw new Le("Failed authentication. Please try to authorize again.")}}))}validateHostedFormOrThrow(){var e,t;return qe(this,void 0,void 0,(function*(){const n=this.getCardFieldsOrThrow(),i=yield n.getState().then((e=>e)),r=this.getValidityData(i);if(!r.isValid)throw null===(t=null===(e=this.hostedFormOptions)||void 0===e?void 0:e.onValidate)||void 0===t||t.call(e,r),new Ve(this.mapValidationErrors(r.errors))}))}getValidityData({fields:e}){const t=Object.assign({},e);delete t.cardNameField;const n=Object.keys(t);return{isValid:n.every((e=>{var n;return null===(n=t[e])||void 0===n?void 0:n.isValid})),errors:n.reduce(((e,n)=>{var i;const r=this.mapFieldType(n);return Object.assign(Object.assign({},e),{[r]:(null===(i=t[n])||void 0===i?void 0:i.isValid)?void 0:[this.getInvalidErrorByFieldType(r)]})}),{})}}getInvalidErrorByFieldType(e){switch(e){case Fe.CardCode:case Fe.CardCodeVerification:return{fieldType:e,message:"Invalid card code",type:"invalid_card_code"};case Fe.CardNumber:case Fe.CardNumberVerification:return{fieldType:e,message:"Invalid card number",type:"invalid_card_number"};case Fe.CardExpiry:case Fe.CardExpiryVerification:return{fieldType:e,message:"Invalid card expiry",type:"invalid_card_expiry"};default:return{fieldType:e,message:"Invalid field",type:"invalid"}}}mapValidationErrors(e={}){const t={};return Object.keys(e).forEach((n=>{var i,r;t[n]=[{message:(null===(r=null===(i=e[n])||void 0===i?void 0:i[0])||void 0===r?void 0:r.message)||"",type:n}]})),t}mapFieldType(e){switch(e){case"name":return Fe.CardName;case"cardNumberField":case"number":return this.isCreditCardForm?Fe.CardNumber:Fe.CardNumberVerification;case"cardExpiryField":case"expiry":return this.isCreditCardForm?Fe.CardExpiry:Fe.CardExpiryVerification;case"cardCvvField":case"cvv":return this.isCreditCardForm?Fe.CardCode:Fe.CardCodeVerification;default:throw new Error("Unexpected field type")}}getCardFieldsOrThrow(){if(!this.cardFields)throw new Ue(je.PaymentNotInitialized);return this.cardFields}getInputStyles(e){var t,n,i;const r={"font-size":(null===(t=null==e?void 0:e.default)||void 0===t?void 0:t.fontSize)||"1rem","font-family":(null===(n=null==e?void 0:e.default)||void 0===n?void 0:n.fontFamily)||"Montserrat, Arial, Helvetica, sans-serif","font-weight":(null===(i=null==e?void 0:e.default)||void 0===i?void 0:i.fontWeight)||"400",outline:"none",padding:"9px 13px"},o=Object.assign(Object.assign({},r),{color:"#333333"});return{input:o,".invalid":Object.assign(Object.assign({},r),{color:"red"}),".valid":o,":focus":o}}stylizeInputContainers(e){Object.values(e||{}).forEach((e=>{const t=document.getElementById(`${(null==e?void 0:e.containerId)||""}`);t&&(t.style.padding="0px",t.style.boxShadow="none",t.style.border="none",t.style.background="transparent",t.style.marginBottom="10px",t.style.marginLeft="-5px")}))}hasUndefinedValues(){return!this.hostedFormOptions||Object.values(this.hostedFormOptions.fields).some((e=>void 0===e))}onChangeHandler(e,t){var n;null===(n=null==e?void 0:e.onValidate)||void 0===n||n.call(e,this.getValidityData(t))}onFocusHandler(e,t){var n;null===(n=null==e?void 0:e.onFocus)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}onBlurHandler(e,t){var n;null===(n=null==e?void 0:e.onBlur)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}onInputSubmitRequest(e,t){var n;null===(n=null==e?void 0:e.onEnter)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}shouldInitializePayPalFastlane(e){var t,n;const i=this.paymentIntegrationService.getState(),r=i.getPaymentMethodOrThrow(e),o=i.getPaymentProviderCustomer(),a=(s=o)&&("authenticationState"in s||"addresses"in s||"instruments"in s)?o:{};var s;return(null===(t=null==r?void 0:r.initializationData)||void 0===t?void 0:t.isAcceleratedCheckoutEnabled)&&(null===(n=null==r?void 0:r.initializationData)||void 0===n?void 0:n.isBigCommercePaymentsAnalyticsV2Enabled)&&!(null==a?void 0:a.authenticationState)}initializePayPalFastlaneOrThrow(e){return qe(this,void 0,void 0,(function*(){try{const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getPaymentMethodOrThrow(e),{initializationData:r}=i;if(!(null==r?void 0:r.connectClientToken))return;const o=yield this.bigCommercePaymentsSdk.getPayPalFastlaneSdk(i,n.currency.code,n.id);yield this.bigCommercePaymentsFastlaneUtils.initializePayPalFastlane(o,!!(null==r?void 0:r.isDeveloperModeApplicable))}catch(e){}}))}}const Ge=l((e=>new He(e,z(e),U(),be())),[{id:"bigcommerce_payments_creditcards"}]);var $e=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class We{constructor(e,t,n,i,r=3e3,o=3e5){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.bigCommercePaymentsSdkHelper=n,this.loadingIndicator=i,this.pollingInterval=r,this.maxPollingIntervalTime=o,this.pollingTimer=0,this.stopPolling=d.noop,this.isPollingEnabled=!1}initialize(e){return $e(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,bigcommerce_payments_apms:i}=e;if(this.bigCommercePaymentsAlternativeMethods=i,!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!i)throw new F('Unable to initialize payment because "options.bigcommerce_payments_apms" argument is not provided.');const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(n,t),{orderId:a,shouldRenderFields:s}=o.initializationData||{},d=r.getStoreConfigOrThrow().checkoutSettings.features;this.isPollingEnabled=_e(d,"PAYPAL-5624.bcp_ideal_polling"),a?this.orderId=a:(this.paypalApms=yield this.bigCommercePaymentsSdkHelper.getPayPalApmsSdk(o,r.getCartOrThrow().currency.code),this.loadingIndicatorContainer=i.container.split("#")[1],this.renderButton(n,t,i),s&&this.renderFields(n,i))}))}execute(e,t){return $e(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new X(["payment"]);const{methodId:r,gatewayId:o}=n;if(!this.orderId)throw new ee;this.isPollingEnabled&&"ideal"===r&&(yield new Promise(((e,t)=>{this.initializePollingMechanism(r,e,t,o)}))),this.isNonInstantPaymentMethod(r)||(yield this.paymentIntegrationService.submitOrder(i,t)),yield this.bigCommercePaymentsIntegrationService.submitPayment(r,this.orderId,o)}))}finalize(){return Promise.reject(new te)}deinitialize(){var e;return this.orderId=void 0,this.isPollingEnabled&&this.resetPollingMechanism(),null===(e=this.bigCommercePaymentsButton)||void 0===e||e.close(),Promise.resolve()}initializePollingMechanism(e,t,n,i){return $e(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.bigCommercePaymentsIntegrationService.getOrderStatus(i),o=r===I.Approved,a=r===I.PollingError;if(o)return this.deInitializePollingMechanism(),t();if(a)return n();if(!o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,bigCommercePaymentsAlternativeMethods:this.bigCommercePaymentsAlternativeMethods}),this.handleError(new Ne)}catch(e){n()}}))}deInitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deInitializePollingMechanism()}reinitializeStrategy(e){return $e(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}handleError(e){const{onError:t}=this.bigCommercePaymentsAlternativeMethods||{};this.isPollingEnabled&&this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}renderButton(e,t,n){const i=this.getPaypalAmpsSdkOrThrow(),r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t),{buttonStyle:o}=r.initializationData||{},{container:a,onError:s,onRenderButton:d,submitForm:c}=n,l={fundingSource:e,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o),onInit:(e,t)=>n.onInitButton(t),createOrder:()=>this.onCreateOrder(e,t,n),onApprove:e=>this.handleApprove(e,c),onCancel:()=>{this.toggleLoadingIndicator(!1),this.deInitializePollingMechanism()},onError:e=>{this.deInitializePollingMechanism(),this.handleFailure(e,s)},onClick:(e,t)=>$e(this,void 0,void 0,(function*(){return n.onValidate(t.resolve,t.reject)}))};this.bigCommercePaymentsButton=i.Buttons(l),this.bigCommercePaymentsButton.isEligible()&&(d&&"function"==typeof d&&d(),this.bigCommercePaymentsButton.render(a))}onCreateOrder(e,t,n){return $e(this,void 0,void 0,(function*(){const{onValidate:i}=n;yield i((()=>(this.toggleLoadingIndicator(!0),()=>Promise.resolve())),d.noop);const r=yield this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_apms");if(this.isNonInstantPaymentMethod(e)){const n={useStoreCredit:!1},i={params:{methodId:e,gatewayId:t}};yield this.paymentIntegrationService.submitOrder(n,i),yield this.bigCommercePaymentsIntegrationService.submitPayment(e,r,t)}return r}))}handleApprove({orderID:e},t){this.orderId=e,t()}handleFailure(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}renderFields(e,t){const n=this.getPaypalAmpsSdkOrThrow(),i=this.paymentIntegrationService.getState(),{firstName:r,lastName:o,email:a}=i.getBillingAddressOrThrow(),{apmFieldsContainer:s,apmFieldsStyles:d}=t;if(!s)throw new F('Unable to initialize payment because "options.bigcommerce_payments_apms" argument should contain "apmFieldsContainer".');const c=document.querySelector(s);c&&(c.innerHTML="");const l={fundingSource:e,style:d||{},fields:{name:{value:`${r} ${o}`},email:{value:a}}};n.PaymentFields(l).render(s)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}isNonInstantPaymentMethod(e){return e.toUpperCase()in _}getPaypalAmpsSdkOrThrow(){if(!this.paypalApms)throw new h;return this.paypalApms}}const Ye=l((e=>new We(e,z(e),U(),new J({containerStyles:Z}))),[{gateway:"bigcommerce_payments_apms"}]);var Ke=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Qe{constructor(e,t,n){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.loadingIndicator=n}initialize(e){var t,n;return Ke(this,void 0,void 0,(function*(){const{methodId:i,bigcommerce_payments_venmo:r}=e||{};if(!i)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new F('Unable to initialize payment because "options.bigcommerce_payments_venmo" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(i);const o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i);(null===(t=o.initializationData)||void 0===t?void 0:t.orderId)?this.orderId=null===(n=o.initializationData)||void 0===n?void 0:n.orderId:(yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i),this.loadingIndicatorContainer=r.container.split("#")[1],this.renderButton(i,r))}))}execute(e,t){return Ke(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new X(["payment"]);if(!this.orderId)throw new ee;yield this.paymentIntegrationService.submitOrder(i,t),yield this.bigCommercePaymentsIntegrationService.submitPayment(n.methodId,this.orderId)}))}finalize(){return Promise.reject(new te)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}renderButton(e,t){const n=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u={fundingSource:n.FUNDING.VENMO,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o),createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_venmo_checkout"),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onCancel:()=>this.toggleLoadingIndicator(!1),onError:e=>this.handleError(e,s)};if(this.paypalButton=n.Buttons(u),!this.paypalButton.isEligible())throw new Oe("Venmo is not available for your region. Please another payment method instead.");d&&"function"==typeof d&&d(),this.paypalButton.render(a)}handleClick(e,t){return Ke(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;yield t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,t(),this.toggleLoadingIndicator(!1)}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const Je=l((e=>new Qe(e,z(e),new J({styles:{backgroundColor:"black"}}))),[{id:"bigcommerce_payments_venmo"}]);var Ze=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Xe{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.onError=d.noop}initialize(e){return Ze(this,void 0,void 0,(function*(){const{bigcommerce_payments:t,methodId:n}=e;if(!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.bigcommerce_payments" argument is not provided.');if(!t.container)throw new F('Unable to initialize payment because "options.bigcommerce_payments.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new F('Unable to initialize payment because "options.bigcommerce_payments.onClick" argument is not a function.');this.onError=t.onError||d.noop,this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC PayPal]: PayPal Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return Ze(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}))}signOut(e){return Ze(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onClick:i,onComplete:r}=t,o=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{isHostedCheckoutEnabled:s,paymentButtonStyles:d}=a.initializationData||{},{checkoutTopButtonStyles:c}=d||{},l=Object.assign({createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments"),onApprove:({orderID:t})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(e,t)},i&&{onClick:()=>i()}),u={onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e),onApprove:(t,n)=>this.onHostedCheckoutApprove(t,n,e,r)},h=Object.assign(Object.assign({fundingSource:o.FUNDING.PAYPAL,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},c),{height:36}))},l),s&&u),m=o.Buttons(h);m.isEligible()?m.render(`#${n}`):this.bigCommercePaymentsIntegrationService.removeElement(n)}onHostedCheckoutApprove(e,t,n,r){return Ze(this,void 0,void 0,(function*(){if(!e.orderID)throw new m(i.MissingOrderId);const o=this.paymentIntegrationService.getState().getCartOrThrow(),a=yield t.order.get();try{const t=this.bigCommercePaymentsIntegrationService.getBillingAddressFromOrderDetails(a);if(yield this.paymentIntegrationService.updateBillingAddress(t),o.lineItems.physicalItems.length>0){const e=this.bigCommercePaymentsIntegrationService.getShippingAddressFromOrderDetails(a);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.bigCommercePaymentsIntegrationService.updateOrder()}yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.bigCommercePaymentsIntegrationService.submitPayment(n,e.orderID),r&&"function"==typeof r&&r()}catch(e){this.handleError(e)}}))}onShippingAddressChange(e){return Ze(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}onShippingOptionsChange(e){return Ze(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}}const et=l((e=>new Xe(e,z(e))),[{id:"bigcommerce_payments"}]);var tt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class nt{constructor(e,t,n){this.paymentIntegrationService=e,this.bigCommercePaymentsSdk=t,this.bigCommercePaymentsFastlaneUtils=n}initialize(e){var t;return tt(this,void 0,void 0,(function*(){const{methodId:n,bigcommerce_payments_fastlane:i}=e;if(!n)throw new F('Unable to proceed because "methodId" argument is not provided.');try{yield this.paymentIntegrationService.loadPaymentMethod(n);const e=this.paymentIntegrationService.getState(),r=e.getCartOrThrow(),o=e.getPaymentMethodOrThrow(n),a=!!(null===(t=o.initializationData)||void 0===t?void 0:t.isDeveloperModeApplicable),s=yield this.bigCommercePaymentsSdk.getPayPalFastlaneSdk(o,r.currency.code,r.id);yield this.bigCommercePaymentsFastlaneUtils.initializePayPalFastlane(s,a,this.getFastlaneStyles(n,i))}catch(e){}return Promise.resolve()}))}deinitialize(){return tt(this,void 0,void 0,(function*(){return Promise.resolve()}))}signIn(e,t){return tt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return tt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){return tt(this,void 0,void 0,(function*(){const{checkoutPaymentMethodExecuted:t,continueWithCheckoutCallback:n,methodId:i}=e||{};if(!i)throw new F('Unable to proceed because "methodId" argument is not provided.');if("function"!=typeof n)throw new F('Unable to proceed because "continueWithCheckoutCallback" argument is not provided and it must be a function.');if(this.paymentIntegrationService.getState().getCustomerOrThrow().isGuest){t&&"function"==typeof t&&t();try{yield this.runPayPalAuthenticationFlowOrThrow(i)}catch(e){}}n()}))}runPayPalAuthenticationFlowOrThrow(e){return tt(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow().id,i=t.getCustomer(),r=t.getBillingAddress(),o=(null==i?void 0:i.email)||(null==r?void 0:r.email)||"",{customerContextId:a}=yield this.bigCommercePaymentsFastlaneUtils.lookupCustomerOrThrow(o),s=yield this.bigCommercePaymentsFastlaneUtils.triggerAuthenticationFlowOrThrow(a),d=s.authenticationState===ye.CANCELED;yield this.updateCustomerDataState(e,s),d?this.bigCommercePaymentsFastlaneUtils.removeStorageSessionId():this.bigCommercePaymentsFastlaneUtils.updateStorageSessionId(n)}))}updateCustomerDataState(e,t){var n;return tt(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState().getCartOrThrow(),{authenticationState:r,addresses:o,billingAddress:a,shippingAddress:s,instruments:d}=this.bigCommercePaymentsFastlaneUtils.mapPayPalFastlaneProfileToBcCustomerData(e,t);if(yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:r,addresses:o,instruments:d}),a&&(yield this.paymentIntegrationService.updateBillingAddress(a)),s&&i.lineItems.physicalItems.length>0){const t=yield this.paymentIntegrationService.updateShippingAddress(s),i=t.getPaymentMethodOrThrow(e),{isFastlaneShippingOptionAutoSelectEnabled:r}=i.initializationData||{},o=t.getConsignments()||[],a=(null===(n=o[0])||void 0===n?void 0:n.availableShippingOptions)||[],d=a[0],c=a.find((e=>e.isRecommended));if((c||d)&&r){const e=(null==c?void 0:c.id)||d.id;yield this.paymentIntegrationService.selectShippingOption(e)}}}))}getFastlaneStyles(e,t){const n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{fastlaneStyles:i,isFastlaneStylingEnabled:r}=n.initializationData||{};return Ce(r?i:{},null==t?void 0:t.styles)}}const it=l((e=>new nt(e,U(),be())),[{id:"bigcommerce_payments_fastlane"},{id:"bigcommerce_payments_creditcards"}]);var rt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ot{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.onError=d.noop}initialize(e){return rt(this,void 0,void 0,(function*(){const{bigcommerce_payments_paylater:t,methodId:n}=e;if(!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.bigcommerce_payments_paylater" argument is not provided.');if(!t.container)throw new F('Unable to initialize payment because "options.bigcommerce_payments_paylater.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new F('Unable to initialize payment because "options.bigcommerce_payments_paylater.onClick" argument is not a function.');this.onError=t.onError||d.noop,this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC BigCommercePayments PayLater]: button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return rt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return rt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onComplete:i,onClick:r}=t,o=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{isHostedCheckoutEnabled:s,paymentButtonStyles:d}=a.initializationData||{},{checkoutTopButtonStyles:c}=d||{},l=Object.assign({createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_paylater"),onApprove:({orderID:t})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(e,t)},r&&{onClick:()=>r()}),u={onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e),onApprove:(t,n)=>this.onHostedCheckoutApprove(t,n,e,i)},h=[o.FUNDING.PAYLATER,o.FUNDING.CREDIT];let m=!1;h.forEach((e=>{if(!m){const t=Object.assign(Object.assign({fundingSource:e,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},c),{height:36}))},l),s&&u),i=o.Buttons(t);i.isEligible()&&(i.render(`#${n}`),m=!0)}})),m||this.bigCommercePaymentsIntegrationService.removeElement(n)}onHostedCheckoutApprove(e,t,n,r){return rt(this,void 0,void 0,(function*(){if(!e.orderID)throw new m(i.MissingOrderId);const o=this.paymentIntegrationService.getState().getCartOrThrow(),a=yield t.order.get();try{const t=this.bigCommercePaymentsIntegrationService.getBillingAddressFromOrderDetails(a);if(yield this.paymentIntegrationService.updateBillingAddress(t),o.lineItems.physicalItems.length>0){const e=this.bigCommercePaymentsIntegrationService.getShippingAddressFromOrderDetails(a);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.bigCommercePaymentsIntegrationService.updateOrder()}yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.bigCommercePaymentsIntegrationService.submitPayment(n,e.orderID),r&&"function"==typeof r&&r()}catch(e){this.handleError(e)}}))}onShippingAddressChange(e){return rt(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}onShippingOptionsChange(e){return rt(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}}const at=l((e=>new ot(e,z(e))),[{id:"bigcommerce_payments_paylater"}]);var st=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class dt{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t}initialize(e){return st(this,void 0,void 0,(function*(){const{bigcommerce_payments_venmo:t,methodId:n}=e;if(!n)throw new F('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new F('Unable to initialize payment because "options.bigcommerce_payments_venmo" argument is not provided.');if(!t.container)throw new F('Unable to initialize payment because "options.bigcommerce_payments_venmo.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new F('Unable to initialize payment because "options.bigcommerce_payments_venmo.onClick" argument is not a function.');this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC Payments Venmo]: Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return st(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return st(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onClick:i}=t,r=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:a}=o.initializationData||{},{checkoutTopButtonStyles:s}=a||{},d=Object.assign({fundingSource:r.FUNDING.VENMO,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},s),{height:36})),createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_venmo"),onApprove:({orderID:t})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(e,t)},i&&{onClick:()=>i()}),c=r.Buttons(d);c.isEligible()?c.render(`#${n}`):this.bigCommercePaymentsIntegrationService.removeElement(n)}}const ct=l((e=>new dt(e,z(e))),[{id:"bigcommerce_payments_venmo"}])},16599:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(70355);const r=(0,n(45080).A)((()=>i.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},i.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}))))},16919:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(70355);const r=(0,n(21575).A)((({amount:e,currency:t})=>i.createElement(i.Fragment,null,t.toCustomerCurrency(e))))},17080:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(3375),r=n.n(i),o=n(70355),a=n(24736);const s=({additionalClassName:e,children:t,isLoading:n=!0,rows:i=3})=>{const s=[];for(let e=0;e<i;e+=1)s.push(o.createElement("div",{key:`checklist-skeleton-item${e}`}));const d=o.createElement("div",{className:r()(e,"checklist-skeleton")},s);return o.createElement(a.O,{children:t,isLoading:n,skeleton:d})}},17850:()=>{},17851:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(69440);function r(e,t){return(0,i.compact)((0,i.map)(t.lineItemIds,(t=>(0,i.find)(e.lineItems.physicalItems,(e=>e.id===t&&(0,i.isNil)(e.parentId))))))}},17986:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355),r=n(24736);const o=({children:e,isLoading:t,renderWhileLoading:n})=>{const o=i.createElement(i.Fragment,null,i.createElement("div",{className:"address-form-skeleton"},i.createElement("div",{className:"label"})),i.createElement("div",{className:"address-form-skeleton"},i.createElement("div",{className:"name"}),i.createElement("div",{className:"name"})),i.createElement("div",{className:"address-form-skeleton"},i.createElement("div",{className:"address"})));return i.createElement(r.O,{children:e,isLoading:t,renderWhileLoading:n,skeleton:o})}},18336:(e,t,n)=>{n.d(t,{A:()=>f});var i=n(31635),r=n(3375),o=n.n(r),a=n(69440),s=n(70355),d=n(19445),c=n(76049);const l=(0,d.A)(c.A,{displayNamePrefix:"withDate",pickProps:(e,t)=>"date"===t&&!!e});const u=(0,n(2156).A)((()=>s.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}))));var h=n(62752),m=n(25656);const p=(0,s.forwardRef)(((e,t)=>{var{additionalClassName:n,testId:r,className:a,isFloatingLabelEnabled:d}=e,c=(0,i.__rest)(e,["additionalClassName","testId","className","isFloatingLabelEnabled"]);return s.createElement("textarea",Object.assign({},c,{className:a||o()({"floating-textarea":d},"form-input","optimizedCheckout-form-input",n),"data-test":r,ref:t}))}));var y=n(10156),g=n(33740);const v=(0,s.lazy)((()=>n.e(8519).then(n.t.bind(n,4699,23)))),f=(0,s.memo)(l((e=>{var{fieldType:t,id:n,name:r,onChange:d=a.noop,options:c,placeholder:l,value:f,isFloatingLabelEnabled:b,themeV2:S=!1,date:C,inputDateFormat:w}=e,_=(0,i.__rest)(e,["fieldType","id","name","onChange","options","placeholder","value","isFloatingLabelEnabled","themeV2","date","inputDateFormat"]);const I=w||C.inputFormat||"",P=(0,s.useCallback)(((e,t)=>d(Object.assign(Object.assign({},t),{target:{name:r,value:e}}))),[d,r]);switch(t){case g.A.DROPDOWM:return s.createElement(s.Fragment,null,s.createElement("div",{className:o()({"dropdown-chevron":!b},{"floating-select-chevron":b})},s.createElement(u,null)),s.createElement("select",Object.assign({},_,{className:o()({"floating-select":b},"form-select optimizedCheckout-form-select",{"floating-form-field-input":S}),"data-test":`${n}-select`,id:n,name:r,onChange:d,value:null!=f?f:""}),!!l&&s.createElement("option",{value:""},l),c&&c.map((({label:e,value:t})=>s.createElement("option",{key:t,value:t},e)))));case g.A.RADIO:return c&&c.length?s.createElement(s.Fragment,null,c.map((({label:e,value:t})=>s.createElement(m.A,Object.assign({},_,{checked:t===f,id:`${n}-${t}`,key:t,label:e,name:r,onChange:d,testId:`${n}-${t}-radio`,themeV2:S,value:t}))))):null;case g.A.CHECKBOX:return c&&c.length?s.createElement(s.Fragment,null,c.map((({label:e,value:t})=>s.createElement(h.A,Object.assign({},_,{checked:!!Array.isArray(f)&&f.includes(t),id:`${n}-${t}`,key:t,label:e,name:r,onChange:d,testId:`${n}-${t}-checkbox`,themeV2:S,value:t}))))):null;case g.A.DATE:return s.createElement(s.Suspense,null,s.createElement(v,Object.assign({},_,{autoComplete:"off",calendarClassName:"optimizedCheckout-contentPrimary",className:o()("form-input optimizedCheckout-form-input",{"floating-input":b,"floating-form-field-input":S}),dateFormat:I,maxDate:_.max?new Date(`${_.max}T00:00:00Z`):void 0,minDate:_.min?new Date(`${_.min}T00:00:00Z`):void 0,name:r,onChange:P,placeholderText:I.toUpperCase(),popperClassName:"optimizedCheckout-contentPrimary",selected:(0,a.isDate)(f)?f:void 0})));case g.A.MULTILINE:return s.createElement(p,Object.assign({},_,{id:n,isFloatingLabelEnabled:b,name:r,onChange:d,testId:`${n}-text`,themeV2:S,type:t,value:f}));default:return s.createElement(y.A,Object.assign({},_,{id:n,isFloatingLabelEnabled:b,name:r,onChange:d,placeholder:l,testId:`${n}-${t===g.A.PASSWORD?"password":"text"}`,themeV2:S,type:t,value:f}))}})))},19445:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(69440),r=n(70355);function o(e,t){return n=>{const{displayNamePrefix:o="",pickProps:a=()=>!0}=t||{},s=(0,r.memo)((e=>r.createElement(n,Object.assign({},e)))),d=t=>{const n=(0,r.useContext)(e),o=(0,i.pickBy)(n,((e,t)=>a(e,t)));if((0,i.isEmpty)(o))return null;const d=Object.assign(Object.assign({},o),t);return r.createElement(s,Object.assign({},d))};return o&&(d.displayName=`${o}(${n.displayName||n.name})`),d}}},21575:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(19445),r=n(76049);const o=(0,i.A)(r.A,{displayNamePrefix:"WithCurrency",pickProps:(e,t)=>"currency"===t&&!!e})},21685:(e,t,n)=>{function i(e){const t=e;return void 0!==t.title&&void 0!==t.data&&void 0!==t.type}n.d(t,{A:()=>i})},22011:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(33740);function r(e,t){const n=Object.assign({},e.reduce(((e,{name:n,custom:i,fieldType:r,default:a})=>{var s,d;if(i){e.customFields||(e.customFields={});const i=t&&t.customFields&&t.customFields.find((({fieldId:e})=>e===n)),s=i&&i.fieldValue;return e.customFields[n]=o(r,s,a),e}if("customFields"!==(d=n)&&"shouldSaveAddress"!==d){const i=t&&t[n];e[n]=(null===(s=o(r,i,a))||void 0===s?void 0:s.toString())||""}return e}),{}));return n.shouldSaveAddress=!t||void 0===t.shouldSaveAddress||t.shouldSaveAddress,void 0===n.stateOrProvince&&(n.stateOrProvince=""),void 0===n.stateOrProvinceCode&&(n.stateOrProvinceCode=""),n}function o(e,t,n){if(null==t)return function(e,t){if(t&&e===i.A.DATE)return new Date(t);if(e===i.A.CHECKBOX)return[];return t||""}(e,n);if(e!==i.A.DATE||"string"!=typeof t)return t;if(t){const[e,n,i]=t.split("-");return new Date(Number(e),Number(n)-1,Number(i))}}},22375:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(69440),r=n(70355),o=n(29853),a=n(47671),s=n(28407);const d=(0,r.memo)((({additionalClassName:e,labelContent:t,label:n,onChange:d,footer:c,input:l,name:u,id:h,isFloatingLabelEnabled:m,themeV2:p=!1})=>{const y=(0,r.useCallback)((e=>r.createElement(r.Fragment,null,m&&l(e),n&&("function"==typeof n?n(u):n),t&&!n&&r.createElement(s.A,{additionalClassName:p?"floating-form-field-label":"",htmlFor:u,id:`${null!=h?h:u}-label`,isFloatingLabelEnabled:m},t),!m&&l(e),r.createElement(a.A,{errorId:`${null!=h?h:u}-field-error-message`,name:u,testId:`${(0,i.kebabCase)(u)}-field-error-message`}),c)),[n,t,h,l,u,c,m]);return r.createElement(o.A,{additionalClassName:e,name:u,onChange:d,render:y})}))},22460:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(7944);class r{constructor(e){const{console:t=console}=e||{};this.console=t}log(e,t,n=i.f.Error,r){switch(n){case i.f.Error:return this.console.error(e,t,r);case i.f.Info:return this.console.info(e,t,r);case i.f.Warning:return this.console.warn(e,t,r);default:return this.console.log(e,t,r)}}}var o=n(31635),a=n(80315),s=n(51492);class d{log(){}}const c="app://";var l;!function(e){e.DEBUG="debug",e.ERROR="error",e.INFO="info",e.WARNING="warning"}(l||(l={}));class u{constructor(e,t){this.handleBeforeSend=(e,t)=>{var n,i;return e.exception?this.shouldReportExceptions(null!==(n=e.exception.values)&&void 0!==n?n:[],null!==(i=null==t?void 0:t.originalException)&&void 0!==i?i:null)?e:null:e},this.handleRewriteFrame=e=>{if(this.publicPath&&e.filename){const t=e.filename.replace(new RegExp(`^${this.publicPath}/?`),"");t!==e.filename&&(e.filename=`${c}/${t}`)}return e};const{consoleLogger:n=new d,publicPath:i="",sampleRate:r=.1}=t||{};this.consoleLogger=n,this.publicPath=i,this.dsn=e.dsn||"",window.sentryOnLoad=()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){Sentry.init(Object.assign({sampleRate:r,beforeSend:this.handleBeforeSend.bind(this),denyUrls:[...e.denyUrls||[],"polyfill~checkout"],integrations:[Sentry.globalHandlersIntegration({onerror:!1,onunhandledrejection:!0})]},e));const t=yield Sentry.lazyLoadIntegration("rewriteFramesIntegration");Sentry.addIntegration(t({iteratee:this.handleRewriteFrame.bind(this)}))}))}log(e,t,n=i.f.Error,r){this.consoleLogger.log(e,t,n),this.loadSentry().then((()=>{const{errorCode:i=(0,s.A)(e)}=t||{};Sentry.captureException(e,{tags:{errorCode:i},level:this.mapToSentryLevel(n),extra:r,fingerprint:["{{ default }}"]})}))}loadSentry(){var e,t;if(this.loaderPromise)return this.loaderPromise;const n=null!==(t=null===(e=/https:\/\/(.+)@.+\//.exec(this.dsn))||void 0===e?void 0:e[1])&&void 0!==t?t:"";return this.loaderPromise=(0,a.vQ)().loadScript(`https://js.sentry-cdn.com/${n}.min.js`,{attributes:{crossorigin:"anonymous"},async:!1}),this.loaderPromise}mapToSentryLevel(e){switch(e){case i.f.Info:return l.INFO;case i.f.Warning:return l.WARNING;case i.f.Debug:return l.DEBUG;case i.f.Error:default:return l.ERROR}}shouldReportExceptions(e,t){return!!(e.length&&t instanceof Error)&&e.every((e=>{var t,n;return!!(null===(n=null===(t=e.stacktrace)||void 0===t?void 0:t.frames)||void 0===n?void 0:n.length)&&e.stacktrace.frames.every((e=>{var t,n;return(null===(t=e.filename)||void 0===t?void 0:t.startsWith(c))||(null===(n=e.filename)||void 0===n?void 0:n.startsWith(this.publicPath))}))}))}}function h(e,t){return e&&e.sentry?new u(e.sentry,Object.assign(Object.assign({},t),{consoleLogger:new r(t)})):new r(t)}},23013:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355),r=n(39981);const o=({checkoutService:e,children:t})=>{const[n,o]=(0,i.useState)((()=>e.getState())),a=(0,i.useRef)(),s=(0,i.useMemo)((()=>({checkoutService:e,checkoutState:n})),[e,n]);return(0,i.useEffect)((()=>(a.current=e.subscribe((e=>o(e))),()=>{a.current&&(a.current(),a.current=void 0)})),[e]),i.createElement(r.A.Provider,{value:s},t)}},23847:(e,t,n)=>{function i(e){const{passwordRequirements:{minlength:t,error:n,alpha:i,numeric:o}}=e;return r({minlength:t,description:n,alpha:i,numeric:o})}function r({minlength:e,description:t,alpha:n,numeric:i}){const r=new RegExp("/","g");return{minLength:e,description:t,alpha:new RegExp(n.replace(r,"")),numeric:new RegExp(i.replace(r,""))}}n.d(t,{A:()=>r,m:()=>i})},24736:(e,t,n)=>{n.d(t,{O:()=>r});var i=n(70355);const r=({children:e,isLoading:t=!0,renderWhileLoading:n=!1,skeleton:r})=>{const o=n||!t;return i.createElement(i.Fragment,null,t&&r,Boolean(e)&&o&&i.createElement("div",{className:"loading-skeleton",style:t?{position:"absolute",left:"0%",top:"-300%"}:void 0},e))}},25119:(e,t,n)=>{n.d(t,{G4:()=>yt,UD:()=>_e,ep:()=>ft,hT:()=>wt,hu:()=>ht,q1:()=>Ze,v8:()=>Ne,zw:()=>Ve});var i=n(58636),r=n(38589),o=n(58002),a=n(7894),s=n(91195),d={};function c(e,t,n=!0){var i;return null!==(i=e[t])&&void 0!==i?i:n}d.d=(e,t)=>{for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const l="3.128.0",u="3.123.2",h="3.106.0";class m{constructor(e){this.paymentIntegrationService=e,this.braintreeWindow=window}getSDKVersion(){const e=this.paymentIntegrationService.getState().getStoreConfig(),t=(null==e?void 0:e.checkoutSettings.features)||{};return this.getPreloadedSDKVersion()||(c(t,"PAYPAL-5809.braintree_hosted_fields_fix_version")?l:c(t,"PAYPAL-5636.update_braintree_sdk_version")?u:h)}getPreloadedSDKVersion(){const e=this.braintreeWindow.braintree;if(e){const t=(0,o.find)(Object.values(e),(e=>!!e.VERSION));return null==t?void 0:t.VERSION}}}class p extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class y extends p{constructor(e){super(e||"Unsupported browser error"),this.name="UnsupportedBrowserError",this.type="unsupported_browser"}}class g extends p{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class v extends g{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}class f extends p{constructor(e,t){super(t||"Unable to proceed because the payment form contains invalid data."),this.details=e,this.name="PaymentInvalidFormError",this.type="payment_invalid_form"}}var b,S;(S=b||(b={}))[S.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",S[S.CustomerNotInitialized=1]="CustomerNotInitialized",S[S.PaymentNotInitialized=2]="PaymentNotInitialized",S[S.ShippingNotInitialized=3]="ShippingNotInitialized",S[S.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized";class C extends p{constructor(e){super(function(e){switch(e){case b.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case b.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case b.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case b.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}class w extends p{constructor(e){super(e||"Payment process was cancelled."),this.name="PaymentMethodCancelledError",this.type="payment_cancelled"}}class _{constructor(e){const t=new Promise(((e,t)=>{this.cancel=t}));this.promise=Promise.race([e,t])}}const I=["buttons","messages"];var P,E,O,A,k,T,N,M,x;function D(e){return Boolean("object"==typeof e&&null!==e&&("type"in e||"message"in e||"code"in e))}!function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(P||(P={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.RESPONSIVE="responsive"}(E||(E={})),function(e){e.GOLD="gold",e.BLUE="blue",e.SIlVER="silver",e.BLACK="black",e.WHITE="white"}(O||(O={})),function(e){e.CHECKOUT="checkout",e.PAY="pay",e.BUYNOW="buynow",e.PAYPAL="paypal",e.CREDIT="credit"}(A||(A={})),function(e){e.PILL="pill",e.RECT="rect"}(k||(k={})),function(e){e.CART="cart",e.HOME="homepage",e.PAYMENT="payment",e.PRODUCT="product"}(T||(T={})),function(e){e.Sandbox="sandbox",e.Production="production"}(N||(N={})),function(e){e.Client="client",e.DataCollector="dataCollector",e.Fastlane="fastlane",e.GooglePayment="googlePayment",e.HostedFields="hostedFields",e.LocalPayment="localPayment",e.Paypal="paypal",e.PaypalCheckout="paypalCheckout",e.ThreeDSecure="threeDSecure",e.UsBankAccount="usBankAccount",e.Venmo="venmo",e.VisaCheckout="visaCheckout"}(M||(M={})),function(e){e.CardCode="cardCode",e.CardCodeVerification="cardCodeVerification",e.CardExpiry="cardExpiry",e.CardName="cardName",e.CardNumber="cardNumber",e.CardNumberVerification="cardNumberVerification"}(x||(x={}));var z=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class F{constructor(e,t,n){this.braintreeScriptLoader=e,this.braintreeHostWindow=t,this.overlay=n,this.dataCollectors={}}initialize(e,t){this.clientToken=e,this.threeDSecureOptions=t}getBraintreeFastlane(e,t,n){return z(this,void 0,void 0,(function*(){if(t&&(window.localStorage.setItem("axoEnv","sandbox"),window.localStorage.setItem("fastlaneEnv","sandbox")),!this.braintreeHostWindow.braintreeFastlane){const t=this.getClientTokenOrThrow(),i=yield this.getClient(),r=yield this.getSessionId(e),o=yield this.braintreeScriptLoader.loadFastlane(),a={root:{backgroundColorPrimary:"transparent"}};this.braintreeHostWindow.braintreeFastlane=yield o.create({authorization:t,client:i,deviceData:r,styles:n||a})}return this.braintreeHostWindow.braintreeFastlane}))}getClient(){return z(this,void 0,void 0,(function*(){if(!this.client){const e=this.getClientTokenOrThrow(),t=yield this.braintreeScriptLoader.loadClient();this.client=t.create({authorization:e})}return this.client}))}getPaypal(){return this.braintreePaypal||(this.braintreePaypal=Promise.all([this.getClient(),this.braintreeScriptLoader.loadPaypal()]).then((([e,t])=>t.create({client:e})))),this.braintreePaypal}paypal(e){var{shouldSaveInstrument:t}=e,n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["shouldSaveInstrument"]);const i=(0,a.Jt)();return this.getPaypal().then((e=>{var r;return i&&(null===(r=this.overlay)||void 0===r||r.show({onClick:()=>e.focusWindow()})),e.tokenize(Object.assign({enableShippingAddress:!0,flow:t?"vault":"checkout",useraction:"commit"},n))})).then((e=>{var t;return null===(t=this.overlay)||void 0===t||t.remove(),e})).catch((e=>{var t;throw null===(t=this.overlay)||void 0===t||t.remove(),e}))}getPaypalCheckout(e,t,n){return z(this,void 0,void 0,(function*(){const i=yield this.getClient(),r=yield this.braintreeScriptLoader.loadPaypalCheckout(),o={client:i};return this.paypalCheckout=yield r.create(o,((i,r)=>{var o;if(i)return n(i);const a=Object.assign(Object.assign({currency:e.currency},e.isCreditEnabled&&{"enable-funding":"paylater"}),{components:I.toString(),intent:e.intent,commit:null===(o=e.commit)||void 0===o||o});this.braintreeHostWindow.paypal?t(r):r.loadPayPalSDK(a,(()=>t(r)))})),this.paypalCheckout}))}getDataCollector(e){return z(this,void 0,void 0,(function*(){const t=(null==e?void 0:e.paypal)?"paypal":"default";let n=this.dataCollectors[t];if(!n){try{const t=yield this.getClient(),i=yield this.braintreeScriptLoader.loadDataCollector(),r=Object.assign({client:t,kount:!0},e);n=yield i.create(r)}catch(e){if(!D(e)||"DATA_COLLECTOR_KOUNT_NOT_ENABLED"!==e.code)throw e;n={deviceData:void 0,teardown:()=>Promise.resolve()}}this.dataCollectors[t]=n}return n}))}getBraintreeEnv(e=!1){return e?N.Sandbox:N.Production}mapToBraintreeShippingAddressOverride(e){return{recipientName:`${e.firstName} ${e.lastName}`,line1:e.address1,line2:e.address2,city:e.city,state:e.stateOrProvinceCode,postalCode:e.postalCode,countryCode:e.countryCode,phone:e.phone}}mapToLegacyShippingAddress(e){const{email:t,phone:n,shippingAddress:i}=e,r=(null==i?void 0:i.recipientName)||"",[o,a]=r.split(" ");return{email:t,first_name:o||"",last_name:a||"",phone_number:n,address_line_1:null==i?void 0:i.line1,address_line_2:null==i?void 0:i.line2,city:null==i?void 0:i.city,state:null==i?void 0:i.state,country_code:null==i?void 0:i.countryCode,postal_code:null==i?void 0:i.postalCode}}mapToLegacyBillingAddress(e){const{billingAddress:t,email:n,firstName:i,lastName:r,phone:o,shippingAddress:a}=e,s=t||a;return{email:n,first_name:i,last_name:r,phone_number:o,address_line_1:null==s?void 0:s.line1,address_line_2:null==s?void 0:s.line2,city:null==s?void 0:s.city,state:null==s?void 0:s.state,country_code:null==s?void 0:s.countryCode,postal_code:null==s?void 0:s.postalCode}}removeElement(e){const t=e&&document.getElementById(e);t&&t.remove()}getSessionId(e){return z(this,void 0,void 0,(function*(){const{deviceData:t}=yield this.getDataCollector({riskCorrelationId:e});return t}))}teardown(){return z(this,void 0,void 0,(function*(){yield this.teardownModule(this.dataCollectors.default),yield this.teardownModule(this.dataCollectors.paypal),this.dataCollectors={},yield this.teardownModule(this.paypalCheckout),this.paypalCheckout=void 0}))}get3DS(){return z(this,void 0,void 0,(function*(){return this.threeDS||(this.threeDS=Promise.all([this.getClient(),this.braintreeScriptLoader.load3DS()]).then((([e,t])=>t.create({client:e,version:2})))),this.threeDS}))}getVenmoCheckout(e){return z(this,void 0,void 0,(function*(){if(!this.venmoCheckout){const t=yield this.getClient(),n=yield this.braintreeScriptLoader.loadVenmoCheckout(),i=Object.assign({client:t,allowDesktop:!0,paymentMethodUsage:"multi_use"},e||{});this.venmoCheckout=yield new Promise(((e,t)=>{n.create(i,((n,i)=>n?t(n):i.isBrowserSupported()?void e(i):t(new y)))}))}return this.venmoCheckout}))}verifyCard(e,t,n){return z(this,void 0,void 0,(function*(){const i=yield this.tokenizeCard(e,t);return this.challenge3DSVerification(i,n)}))}tokenizeCard(e,t){return z(this,void 0,void 0,(function*(){const{paymentData:n}=e;if(!function(e){if("object"!=typeof e||null===e)return!1;const t=e;return"object"==typeof t.ccExpiry&&null!==t.ccExpiry&&"string"==typeof t.ccNumber&&"string"==typeof t.ccName}(n))throw new v(["payment.paymentData"]);const i=this.getErrorsRequiredFields(n);if(!(0,o.isEmpty)(i))throw new f(i);const r=this.mapToCreditCard(n,t),a=yield this.getClient(),{creditCards:s}=yield a.request(r);return{nonce:s[0].nonce,bin:s[0].details.bin}}))}challenge3DSVerification(e,t){return z(this,void 0,void 0,(function*(){const n=yield this.get3DS();return this.present3DSChallenge(n,t,e)}))}teardownModule(e){return e?e.teardown():Promise.resolve()}getClientTokenOrThrow(){if(!this.clientToken)throw new C(b.PaymentNotInitialized);return this.clientToken}getErrorsRequiredFields(e){const{ccNumber:t,ccExpiry:n}=e,i={};return t||(i.ccNumber=[{message:"Credit card number is required",type:"required"}]),n||(i.ccExpiry=[{message:"Expiration date is required",type:"required"}]),i}mapToCreditCard(e,t){return{data:{creditCard:{cardholderName:e.ccName,number:e.ccNumber,cvv:e.ccCvv,expirationDate:`${e.ccExpiry.month}/${e.ccExpiry.year}`,options:{validate:!1},billingAddress:t&&{countryCodeAlpha2:t.countryCode,locality:t.city,countryName:t.country,postalCode:t.postalCode,streetAddress:t.address2?`${t.address1} ${t.address2}`:t.address1}}},endpoint:"payment_methods/credit_cards",method:"post"}}present3DSChallenge(e,t,n){const{nonce:i,bin:r}=n;if(!this.threeDSecureOptions||!i)throw new C(b.PaymentNotInitialized);const{addFrame:o,removeFrame:a,challengeRequested:s=!0,additionalInformation:d}=this.threeDSecureOptions,c=()=>z(this,void 0,void 0,(function*(){const t=yield e.cancelVerifyCard();return u.cancel(new w),t})),l=t.toFixed(2),u=new _(e.verifyCard({addFrame:(e,t)=>{o&&o(e,t,c)},amount:Number(l),bin:r,challengeRequested:s,nonce:i,removeFrame:a,onLookupComplete:(e,t)=>{t()},collectDeviceData:!0,additionalInformation:d}));return u.promise}}class B extends p{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}const R={[h]:{[M.Client]:"sha384-26BXDNnJI23JYRyFBj4xe4sVNrUSSiSSu11kxVXNM/vEPONm4LuL00w6ZaTgQewt",[M.PaypalCheckout]:"sha384-B+vzbZwnQtzWBthpkT4TXKUibO65tyeK7eCxSvpblgprTep2+IAXB2Cxxjrn710O",[M.Paypal]:"sha384-uyAGL1/3+XJAHnGoNy4eCoXdzJ4f7Ilzp+6w9PNnEjs6DCCz9WMyJjMN1gzc78U+",[M.LocalPayment]:"sha384-LIvOEMkIVEwVuYBdVOQc1AC5YbGGlwyfUheS0ACK218D2STuVYQlZ4FyEPowAEfT",[M.DataCollector]:"sha384-1bo9JDz+Kscthc085cCKWur8CLwUoBpoNyxsDi7932mCl0zFq3A5mv+FQLw9GHpV",[M.UsBankAccount]:"sha384-xmHBVaU+w74V+OebD3AaPONFxHUGMf+QRs8G/JxVPXNNP7MDa2jL0ICWHIe2tTfJ",[M.GooglePayment]:"sha384-WKDJl8mqoP82qZpMGH6AbZxnvXnSW8ILV4M64CyMLiugGMwu7LyP89wjCkHqsiBe",[M.ThreeDSecure]:"sha384-VQUlpGHzsGvs5XeiGFip7EXRsvoHWEXDVmgCacfbyieZI9mdBOqq3NSoyo28OCOB",[M.VisaCheckout]:"sha384-yx7mADfzTN0T43Q6rlH49LIg1EJ0iUZgBp/EczX9LXsUGkySgxrD+nWHQRBkyfoT",[M.Venmo]:"sha384-QX4rPjoj1ZDhuG0aSyKs56lEKDqTMTcjYxUHY1SzO5VZDsqIE2NTkqot7KNSCyov",[M.HostedFields]:"sha384-VvYBACfSu0Cr/J32uKmxG7AXcNOJE1AzIIL3kbikyS7YKp5fz5Is+NzNP/lyauNy",[M.Fastlane]:"sha384-9oGsZMRZwpGtDEDYa/dFt76dECqj1xAni9gIKgc3KfMIiRnR73nEeeUDLiBzxhFa"},[u]:{[M.Client]:"sha384-o+nbQGcwNNxIBeXeu3+XmbSq+Cg8R3EN3N0l5hXCgMMU2RGY0t1z0LroSEIAbfAO",[M.PaypalCheckout]:"sha384-WrfbWPBS4mH86GAoycPSgiH8hQ8KH7A67C93Hjhunv/xhNk2YpBn3wbFA4Fhg9U/",[M.Paypal]:"sha384-VF389nvvrRUgDsTXMxTYORDtVegB9IQa3Cxr//DyJnLYnz8/X8VCzEvck2c+Megt",[M.LocalPayment]:"sha384-tZKx2rEQbfmZpoPSY5VPmJEhaq4X75dLvwHMs3VE9U+C8lPyw+hWTIL1+GPvWCIH",[M.DataCollector]:"sha384-E6k3wOpP7syCDDwaRDLF06942Y00NkbwJvWi2OQXwwKzGwG5fd3E7RFUvCCecfvO",[M.UsBankAccount]:"sha384-258FON8LZGG0W9Qaz4Jij83pZHu30YnKjJA7gNulLBh6CclkucgF+tHDQuYFRYfW",[M.GooglePayment]:"sha384-taJ2p/0+n0VH328POAoBiuEbL3tnHUTE9S42hK1V+Txs3X+QYjZOyKW35JgHRFfO",[M.ThreeDSecure]:"sha384-+NSZH4Zj3sO5bdWvPKhU5N16QDxeueTVTnUVeleeESkhLSaz4Ob1hh/5myecc9Ym",[M.VisaCheckout]:"sha384-66DiBjghxk1OmBj8aksN8gbQ+CwoQcx1vPfiXUN08g1iQVM+BwewF0p7toM3i7SS",[M.Venmo]:"sha384-B5UwY42kE4RoLoWbQ7YpqosUlUad2/DlGWiw0HhoZbSPk30CQAaSA10ohyLDTkDU",[M.HostedFields]:"sha384-Aw9EesSaUeWxe36PqEHiOyOyOq8M6CIb1gw7/yHNVPRzGtFXXcd2OQ8qXrIlOj2P",[M.Fastlane]:"sha384-rhBL1hpZ71JqG+2TsT0Dih47mbjx8cjJCpeZjk9tw3df1gFMKfCTmMyZunhr7H4Y"},[l]:{[M.Client]:"sha384-0WNxksIpRP+fYZiIdr12g6DBUQfLDzYCQJZtR/C8KkcwSGhPHfcFp3tTaGcMyFTq",[M.PaypalCheckout]:"sha384-lWM1jk4BOxoDNV6Kop7tVNvQgINlmEVz0c/OwM+HNHK3QC8xqwd54Ovrt2QRDTjh",[M.Paypal]:"sha384-fXUmVxC2EMZBDXZ7eTHSTL/LFBrHej/MSXT/vTBXvra4lzgLNGvREAp+x0GYObuH",[M.LocalPayment]:"sha384-pha1xGuGSkmZH5x9aqHvRaO4xLea7rmQ/79PFj9zxNzxuFcOWZg7gOP7FibygOEC",[M.DataCollector]:"sha384-Q6PI2F9eekWbAxhroybl+aEcvqhdowN/EQlGwBUyJOzPFn9982u9xl6SU6XfGKzc",[M.UsBankAccount]:"sha384-W3RLQSKJL1tQ3+Y7mP6tmkamtZ8bV4Yw/XxL9Jj5JtXHraD8loMF8hAIG5m2zK7F",[M.GooglePayment]:"sha384-TITQMsFWA3elDNGP2mWz2oKBo4qjt+TlqzovcaPoeBiAh/wPBi6nae50ADdgU1/i",[M.ThreeDSecure]:"sha384-YiycYN89ZlL/Evcaq4y1ajW1mhd7JYfZBDuOwHtIn4/Jnm20GL+/XCM+zYAwWD8D",[M.VisaCheckout]:"sha384-/OdaTv9qrkKzjObtUe6yzfDhHozFW/+uXlrSl736sOZRJpjGQETvpYXqMFFg69xv",[M.Venmo]:"sha384-dA+ojdW9vbJS4JavcXyOs9d5uZHJg5dNtYupoPSH2zsXIiYDVS5amLb/u8qmQ6oz",[M.HostedFields]:"sha384-31ZkS58+iaWsW06ftW52zzVZFp43WPd7pNYRiddYynSNg6Oh7WGbSFGorAUH6T1z",[M.Fastlane]:"sha384-jlbrwNvL3HvLAUCtLSmrnQ2GH1udCUrRS/bVmReAS5fuIVvcW8Pko/Gkg82tlgtr"}};var L,j=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class U{constructor(e,t,n){this.scriptLoader=e,this.braintreeHostWindow=t,this.braintreeSDKVersionManager=n}loadClient(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.Client,"client.min.js")}))}loadFastlane(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.Fastlane,"fastlane.min.js")}))}loadPaypalCheckout(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.PaypalCheckout,"paypal-checkout.min.js")}))}loadPaypal(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.Paypal,"paypal.min.js")}))}loadLocalPayment(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.LocalPayment,"local-payment.min.js")}))}loadDataCollector(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.DataCollector,"data-collector.min.js")}))}loadUsBankAccount(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.UsBankAccount,"us-bank-account.min.js")}))}loadGooglePayment(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.GooglePayment,"google-payment.min.js")}))}load3DS(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.ThreeDSecure,"three-d-secure.min.js")}))}loadVisaCheckout(){return this.loadBraintreeModuleOrThrow(M.VisaCheckout,"visa-checkout.min.js")}loadVenmoCheckout(){return this.loadBraintreeModuleOrThrow(M.Venmo,"venmo.min.js")}loadHostedFields(){return j(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(M.HostedFields,"hosted-fields.min.js")}))}loadVisaCheckoutSdk(e){return j(this,void 0,void 0,(function*(){if(this.braintreeHostWindow.V)return this.braintreeHostWindow.V;const t=e?"sha384-0eu1s1GtqzXlL9DtLgmwzC5WWlEH/ADRM0n38cVQkvtT+W/gey96rcb1LwuUOPDm":"sha384-1f1csvP3ZFxg4dILH1GaY4LHlZ0oX7Rk83rxmLlwbnIi4TM0NYzXoev1VoEiVDS6";return this.scriptLoader.loadScript(`//${e?"sandbox-":""}assets.secure.checkout.visa.com/checkout-widget/resources/js/integration/v1/sdk.js`,{async:!0,attributes:{integrity:t,crossorigin:"anonymous"}}).then((()=>{if(!this.braintreeHostWindow.V)throw new B;return this.braintreeHostWindow.V}))}))}loadBraintreeModuleOrThrow(e,t){return j(this,void 0,void 0,(function*(){let n=this.getBraintreeModule(e);if(n)return n;const i=this.braintreeSDKVersionManager.getSDKVersion(),r=`//js.braintreegateway.com/web/${i}/js/${t}`,o=i in R?this.getIntegrityValuesByModuleName(e,i):void 0;if(yield this.scriptLoader.loadScript(r,o?{async:!0,attributes:{integrity:o,crossorigin:"anonymous"}}:void 0),n=this.getBraintreeModule(e),!n)throw new B;return n}))}getBraintreeModule(e){var t;return null===(t=this.braintreeHostWindow.braintree)||void 0===t?void 0:t[e]}getIntegrityValuesByModuleName(e,t){const n=R[t][e];if(!n)throw new Error("Unexpected fileName value");return n}}function V(e,t){return Object.assign(e,{resolveIds:t})}!function(e){e[e.MissingBillingAddress=0]="MissingBillingAddress",e[e.MissingCart=1]="MissingCart",e[e.MissingCheckout=2]="MissingCheckout",e[e.MissingConsignments=3]="MissingConsignments",e[e.MissingCustomer=4]="MissingCustomer",e[e.MissingCheckoutConfig=5]="MissingCheckoutConfig",e[e.MissingOrder=6]="MissingOrder",e[e.MissingOrderConfig=7]="MissingOrderConfig",e[e.MissingOrderId=8]="MissingOrderId",e[e.MissingPayment=9]="MissingPayment",e[e.MissingPaymentId=10]="MissingPaymentId",e[e.MissingPaymentInstrument=11]="MissingPaymentInstrument",e[e.MissingPaymentMethod=12]="MissingPaymentMethod",e[e.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",e[e.MissingPaymentStatus=14]="MissingPaymentStatus",e[e.MissingPaymentToken=15]="MissingPaymentToken",e[e.MissingShippingAddress=16]="MissingShippingAddress"}(L||(L={}));class q extends p{constructor(e){super(function(e){switch(e){case L.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case L.MissingCart:return"Unable to proceed because cart data is unavailable.";case L.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case L.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case L.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case L.MissingCheckoutConfig:case L.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case L.MissingOrder:return"Unable to proceed because order data is unavailable.";case L.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case L.MissingPayment:return"Unable to proceed because payment data is unavailable.";case L.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case L.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case L.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}class H extends p{constructor(e){super(e||"An unexpected error has occurred during buy now cart creation process. Please try again later."),this.name="BuyNowCartCreationError",this.type="buy_now_cart_creation_error"}}function G(e){const{color:t,fundingicons:n,height:i=40,layout:r,shape:a,size:s,tagline:d}=e||{},c={color:t,fundingicons:n,height:$(i),layout:r,shape:a||"rect",size:s,tagline:d};return(0,o.omitBy)(c,o.isNil)}function $(e){const t=Number(e);return!t||Number.isNaN(t)?40:t>55?55:t<25?25:t}function W(e){return{recipientName:`${e.firstName} ${e.lastName}`,line1:e.address1,line2:e.address2,city:e.city,state:e.stateOrProvinceCode,postalCode:e.postalCode,countryCode:e.countryCode,phone:e.phone}}var Y=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class K{constructor(e,t,n,i){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeIntegrationService=n,this.braintreeHostWindow=i}initialize(e){return Y(this,void 0,void 0,(function*(){const{braintreepaypal:t,containerId:n,methodId:i}=e;if(!i)throw new g('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new g('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new g('Unable to initialize payment because "options.braintreepaypal" argument is not provided.');let r,o=this.paymentIntegrationService.getState();if(t.buyNowInitializeOptions){if(!t.currencyCode)throw new g('Unable to initialize payment because "options.braintreepaypalcredit.currencyCode" argument is not provided.');r=t.currencyCode}else yield this.paymentIntegrationService.loadDefaultCheckout(),o=this.paymentIntegrationService.getState(),r=o.getCartOrThrow().currency.code;const a=o.getPaymentMethodOrThrow(i),{clientToken:s,config:d,initializationData:c}=a;if(!s||!c)throw new q(L.MissingPaymentMethod);const l={currency:r,intent:c.intent,isCreditEnabled:c.isCreditEnabled};this.braintreeIntegrationService.initialize(s),yield this.braintreeIntegrationService.getPaypalCheckout(l,(e=>{this.renderPayPalButton(e,t,n,i,!!d.testMode)}),(e=>this.handleError(e,n,t.onError)))}))}deinitialize(){return Y(this,void 0,void 0,(function*(){yield this.braintreeIntegrationService.teardown()}))}renderPayPalButton(e,t,n,i,r){const{style:o,shouldProcessPayment:a,onAuthorizeError:s,onEligibilityFailure:d}=t,{paypal:c}=this.braintreeHostWindow;if(c){const l=c.Buttons({env:r?"sandbox":"production",fundingSource:c.FUNDING.PAYPAL,style:G(o),createOrder:()=>this.setupPayment(e,t,i),onApprove:t=>this.tokenizePayment(t,e,i,a,s)});l.isEligible()?l.render(`#${n}`):d&&"function"==typeof d&&d()}else this.braintreeIntegrationService.removeElement(n)}setupPayment(e,t,n){var i;return Y(this,void 0,void 0,(function*(){const{onPaymentError:r,shippingAddress:o,buyNowInitializeOptions:a}=t;try{const r="function"==typeof(null==a?void 0:a.getBuyNowCartRequestBody)?yield this.createBuyNowCart(a.getBuyNowCartRequestBody()):void 0;this.buyNowCartId=null==r?void 0:r.id;const s=this.paymentIntegrationService.getState(),d=s.getCustomer(),c=s.getPaymentMethodOrThrow(n),l=r?r.cartAmount:s.getCartOrThrow().cartAmount,u=r?t.currencyCode:s.getCartOrThrow().currency.code,h=o||(null==d?void 0:d.addresses[0]),m=h?W(h):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:m,amount:l,currency:u,offerCredit:!1,intent:null===(i=c.initializationData)||void 0===i?void 0:i.intent})}catch(e){throw r&&(D(e)||e instanceof p)&&r(e),e}}))}tokenizePayment(e,t,n,i,r){return Y(this,void 0,void 0,(function*(){try{const{deviceData:r}=yield this.braintreeIntegrationService.getDataCollector({paypal:!0}),o=yield t.tokenizePayment(e),{details:a,nonce:s}=o,d=this.braintreeIntegrationService.mapToLegacyBillingAddress(a),c=this.braintreeIntegrationService.mapToLegacyShippingAddress(a);return this.formPoster.postForm("/checkout.php",Object.assign({payment_type:"paypal",provider:n,action:i?"process_payment":"set_external_checkout",nonce:s,device_data:r,billing_address:JSON.stringify(d),shipping_address:JSON.stringify(c)},this.buyNowCartId&&{cart_id:this.buyNowCartId})),o}catch(e){throw r&&(D(e)||e instanceof p)&&r(e),e}}))}createBuyNowCart(e){return Y(this,void 0,void 0,(function*(){if(!e)throw new q(L.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(e)}catch(e){throw new H}}))}handleError(e,t,n){if(this.braintreeIntegrationService.removeElement(t),!n||!D(e))throw e;n(e)}}V((e=>{const t=window,n=new m(e),o=new F(new U((0,r.vQ)(),t,n),t);return new K(e,(0,i.createFormPoster)(),o,t)}),[{id:"braintreepaypal"}]);class Q{constructor(e){this.paymentIntegrationService=e,this.braintreeHostWindow=window}render(e,t,n){const i=t&&document.getElementById(t);if(this.braintreeHostWindow.paypal&&i){const r=this.paymentIntegrationService.getState(),o=r.getCartOrThrow(),a=r.getBillingAddressOrThrow(),s=r.getPaymentMethodOrThrow(e);if(!s.initializationData)return;const{paypalBNPLConfiguration:d=[]}=s.initializationData,c=n===T.PAYMENT?"checkout":n,l=d&&d.find((({id:e})=>e===c));if(!l||!l.status)return;n===T.CART&&(i.removeAttribute("data-pp-style-logo-type"),i.removeAttribute("data-pp-style-logo-position"),i.removeAttribute("data-pp-style-text-color"),i.removeAttribute("data-pp-style-text-size")),this.braintreeHostWindow.paypal.Messages({amount:o.cartAmount,buyerCountry:a.countryCode,placement:n,style:this.getPaypalMessagesStylesFromBNPLConfig(l)}).render(`#${t}`)}}getPaypalMessagesStylesFromBNPLConfig({styles:e}){const t={};return e.color&&(t.color=e.color),e.layout&&(t.layout=e.layout),(e["logo-type"]||e["logo-position"])&&(t.logo={},e["logo-type"]&&(t.logo.type=e["logo-type"]),e["logo-position"]&&(t.logo.position=e["logo-position"])),e.ratio&&(t.ratio=e.ratio),(e["text-color"]||e["text-size"])&&(t.text={},e["text-color"]&&(t.text.color=e["text-color"]),e["text-size"]&&(t.text.size=+e["text-size"])),t}}var J=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Z{constructor(e,t,n,i,r){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeIntegrationService=n,this.braintreeMessages=i,this.braintreeHostWindow=r}initialize(e){var t,n;return J(this,void 0,void 0,(function*(){const{braintreepaypalcredit:i,containerId:r,methodId:o}=e;if(!o)throw new g('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new g('Unable to initialize payment because "options.containerId" argument is not provided.');if(!i)throw new g('Unable to initialize payment because "options.braintreepaypalcredit" argument is not provided.');let a,s=this.paymentIntegrationService.getState();if(i.buyNowInitializeOptions){if(!i.currencyCode)throw new g('Unable to initialize payment because "options.braintreepaypalcredit.currencyCode" argument is not provided.');a=i.currencyCode}else yield this.paymentIntegrationService.loadDefaultCheckout(),s=this.paymentIntegrationService.getState(),a=s.getCartOrThrow().currency.code;const d=s.getPaymentMethodOrThrow(o),{clientToken:l,config:u,initializationData:h}=d;if(!l||!h)throw new q(L.MissingPaymentMethod);const m={currency:a,intent:h.intent,isCreditEnabled:h.isCreditEnabled},p=c(null!==(n=null===(t=s.getStoreConfig())||void 0===t?void 0:t.checkoutSettings.features)&&void 0!==n?n:{},"PAYPAL-5663.hide_braintree_card_banner_implementation_in_checkout_sdk");this.braintreeIntegrationService.initialize(l),yield this.braintreeIntegrationService.getPaypalCheckout(m,(e=>{!p&&i.messagingContainerId&&this.renderPayPalMessages(o,i.messagingContainerId),this.renderPayPalButton(e,i,r,o,!!u.testMode)}),(e=>this.handleError(e,r,i.onError)))}))}deinitialize(){return J(this,void 0,void 0,(function*(){yield this.braintreeIntegrationService.teardown()}))}renderPayPalMessages(e,t){this.braintreeMessages.render(e,t,T.CART)}renderPayPalButton(e,t,n,i,r){const{style:o,shouldProcessPayment:a,onAuthorizeError:s,onEligibilityFailure:d}=t,{paypal:c}=this.braintreeHostWindow;let l=!1;c&&[c.FUNDING.PAYLATER,c.FUNDING.CREDIT].forEach((u=>{const h=u===c.FUNDING.CREDIT?Object.assign({label:A.CREDIT},G(o)):G(o);if(!l){const o=c.Buttons({env:r?"sandbox":"production",fundingSource:u,style:h,createOrder:()=>this.setupPayment(e,t,i),onApprove:t=>this.tokenizePayment(t,e,i,a,s)});o.isEligible()?(o.render(`#${n}`),l=!0):c.FUNDING.CREDIT&&d&&"function"==typeof d&&d()}})),c&&l||this.braintreeIntegrationService.removeElement(n)}setupPayment(e,t,n){var i;return J(this,void 0,void 0,(function*(){const{onPaymentError:r,shippingAddress:o,buyNowInitializeOptions:a}=t;try{const r="function"==typeof(null==a?void 0:a.getBuyNowCartRequestBody)?yield this.createBuyNowCart(a.getBuyNowCartRequestBody()):void 0;this.buyNowCartId=null==r?void 0:r.id;const s=this.paymentIntegrationService.getState(),d=s.getCustomer(),c=s.getPaymentMethodOrThrow(n),l=r?r.cartAmount:s.getCartOrThrow().cartAmount,u=r?t.currencyCode:s.getCartOrThrow().currency.code,h=o||(null==d?void 0:d.addresses[0]),m=h?W(h):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:m,amount:l,currency:u,offerCredit:!0,intent:null===(i=c.initializationData)||void 0===i?void 0:i.intent})}catch(e){throw r&&(D(e)||e instanceof p)&&r(e),e}}))}tokenizePayment(e,t,n,i,r){return J(this,void 0,void 0,(function*(){try{const{deviceData:r}=yield this.braintreeIntegrationService.getDataCollector({paypal:!0}),o=yield t.tokenizePayment(e),{details:a,nonce:s}=o,d=this.braintreeIntegrationService.mapToLegacyBillingAddress(a),c=this.braintreeIntegrationService.mapToLegacyShippingAddress(a);return this.formPoster.postForm("/checkout.php",Object.assign({payment_type:"paypal",provider:n,action:i?"process_payment":"set_external_checkout",nonce:s,device_data:r,billing_address:JSON.stringify(d),shipping_address:JSON.stringify(c)},this.buyNowCartId&&{cart_id:this.buyNowCartId})),o}catch(e){throw r&&(D(e)||e instanceof p)&&r(e),e}}))}createBuyNowCart(e){return J(this,void 0,void 0,(function*(){if(!e)throw new q(L.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(e)}catch(e){throw new H}}))}handleError(e,t,n){if(this.braintreeIntegrationService.removeElement(t),!n||!D(e))throw e;n(e)}}V((e=>{const t=window,n=new m(e),o=new F(new U((0,r.vQ)(),t,n),t),a=new Q(e);return new Z(e,(0,i.createFormPoster)(),o,a,t)}),[{id:"braintreepaypalcredit"}]);var X,ee,te,ne,ie,re,oe;!function(e){e.ESTIMATED="ESTIMATED",e.FINAL="FINAL",e.NOT_CURRENTLY_KNOWN="NOT_CURRENTLY_KNOWN"}(X||(X={})),function(e){e.Completed="COMPLETED",e.Pending="PENDING",e.Failed="FAILED"}(ee||(ee={})),function(e){e.TRUSTLY="trustly"}(te||(te={})),function(e){e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="cancelled",e.UNRECOGNIZED="unrecognized"}(ne||(ne={})),function(e){e.Customer="CUSTOMER",e.Merchant="MERCHANT",e.Network="NETWORK",e.Internal="INTERNAL",e.Unknown="UNKNOWN"}(ie||(ie={})),function(e){e.KountNotEnabled="DATA_COLLECTOR_KOUNT_NOT_ENABLED"}(re||(re={})),function(e){e.Visa="visa",e.Mastercard="mastercard",e.AmericanExpress="american-express",e.DinersClub="diners-club",e.Discover="discover",e.Jcb="jcb",e.UnionPay="union-pay",e.Maestro="maestro",e.Elo="elo",e.Mir="mir",e.Hiper="hiper",e.Hipercard="hipercard"}(oe||(oe={}));var ae=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class se{constructor(e){this.braintreeScriptLoader=e}initialize(e){this.setClientToken(e)}deinitialize(){return ae(this,void 0,void 0,(function*(){yield this.teardownModule(this.dataCollector),this.dataCollector=void 0}))}getClient(){return ae(this,void 0,void 0,(function*(){if(!this.client){const e=this.getClientTokenOrThrow(),t=yield this.braintreeScriptLoader.loadClient();this.client=yield t.create({authorization:e})}return this.client}))}getDataCollectorOrThrow(e){return ae(this,void 0,void 0,(function*(){const t={deviceData:void 0,teardown:()=>Promise.resolve()};if(!this.dataCollector)try{const t=yield this.getClient(),n=yield this.braintreeScriptLoader.loadDataCollector(),i=Object.assign({client:t,kount:!0},e);this.dataCollector=yield n.create(i)}catch(e){if(D(e)&&e.code===re.KountNotEnabled)return t;throw e}return this.dataCollector}))}getBraintreeGooglePayment(){return ae(this,void 0,void 0,(function*(){if(!this.googlePayment){const[e,t]=yield Promise.all([this.getClient(),this.braintreeScriptLoader.loadGooglePayment()]);this.googlePayment=yield t.create({client:e})}return this.googlePayment}))}getBraintreeThreeDS(){return ae(this,void 0,void 0,(function*(){if(!this.threeDS){const[e,t]=yield Promise.all([this.getClient(),this.braintreeScriptLoader.load3DS()]);this.threeDS=yield t.create({client:e,version:2})}return this.threeDS}))}getBraintreeLocalPayment(e){return ae(this,void 0,void 0,(function*(){if(!this.braintreeLocalPayment){const[t,n]=yield Promise.all([this.getClient(),this.braintreeScriptLoader.loadLocalPayment()]);this.braintreeLocalPayment=yield new Promise(((i,r)=>{n.create({client:t,merchantAccountId:e},((e,t)=>{e&&r(e),i(t)}))}))}return this.braintreeLocalPayment}))}getUsBankAccount(){return ae(this,void 0,void 0,(function*(){if(!this.usBankAccount){const e=yield this.getClient(),t=yield this.braintreeScriptLoader.loadUsBankAccount();this.usBankAccount=yield t.create({client:e})}return this.usBankAccount}))}getBraintreeVisaCheckout(){return this.visaCheckout||(this.visaCheckout=Promise.all([this.getClient(),this.braintreeScriptLoader.loadVisaCheckout()]).then((([e,t])=>t.create({client:e})))),this.visaCheckout}getVisaCheckoutSdk(e){return ae(this,void 0,void 0,(function*(){return this.visaCheckoutSDK||(this.visaCheckoutSDK=yield this.braintreeScriptLoader.loadVisaCheckoutSdk(e)),this.visaCheckoutSDK}))}getVenmoCheckoutOrThrow(){return ae(this,void 0,void 0,(function*(){if(!this.braintreeVenmo){const e=yield this.getClient(),t=yield this.braintreeScriptLoader.loadVenmoCheckout(),n={client:e,allowDesktop:!0,paymentMethodUsage:"multi_use"},i=yield t.create(n);if(!i.isBrowserSupported())throw new y;this.braintreeVenmo=i}return this.braintreeVenmo}))}setClientToken(e){this.clientToken=e}getClientTokenOrThrow(){if(!this.clientToken)throw new C(b.PaymentNotInitialized);return this.clientToken}teardownModule(e){return e?e.teardown():Promise.resolve()}}var de=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ce{constructor(e,t,n){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeSdk=n}initialize(e){return de(this,void 0,void 0,(function*(){const{containerId:t,methodId:n}=e;if(!n)throw new g('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new g('Unable to initialize payment because "options.containerId" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const i=this.paymentIntegrationService.getState(),{clientToken:r,initializationData:o,config:a}=i.getPaymentMethodOrThrow(n);if(!r||!o)throw new q(L.MissingPaymentMethod);this.braintreeSdk.initialize(r);const s=yield this.braintreeSdk.getBraintreeVisaCheckout(),{currency:{code:d},cartAmount:c}=i.getCartOrThrow(),l=yield this.braintreeSdk.getVisaCheckoutSdk(a.testMode),u=s.createInitOptions({paymentRequest:{currencyCode:d,subtotal:String(c)},settings:{shipping:{collectShipping:!0}}});this.createSignInButton(t),yield l.init(u),l.on("payment.success",(e=>de(this,void 0,void 0,(function*(){yield this.paymentSuccess(s,e)}))))}))}deinitialize(){return Promise.resolve()}paymentSuccess(e,t){return de(this,void 0,void 0,(function*(){return Promise.all([e.tokenize(t),this.braintreeSdk.getDataCollectorOrThrow()]).then((([e,t])=>{const n=this.paymentIntegrationService.getState(),i=n.getShippingAddress(),r=n.getBillingAddress(),{shippingAddress:o=this.toVisaCheckoutAddress(i),billingAddress:a=this.toVisaCheckoutAddress(r)}=e;return this.postForm(Object.assign(Object.assign({},e),{shippingAddress:o,billingAddress:a}),t)}))}))}postForm(e,t){const{userData:n,billingAddress:i,shippingAddress:r,details:o}=e,{userEmail:a}=n,{deviceData:s}=t;return this.formPoster.postForm("/checkout.php",{payment_type:e.type,nonce:e.nonce,provider:"braintreevisacheckout",action:"set_external_checkout",device_data:s,card_information:JSON.stringify({type:o.cardType,number:o.lastTwo}),billing_address:JSON.stringify(this.getAddress(a,i)),shipping_address:JSON.stringify(this.getAddress(a,r))})}toVisaCheckoutAddress(e){return e?{firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phone,streetAddress:e.address1,extendedAddress:e.address2,locality:e.city,region:e.stateOrProvinceCode,countryCode:e.countryCode,postalCode:e.postalCode}:{}}getAddress(e,t={}){return{email:e,first_name:t.firstName,last_name:t.lastName,phone_number:t.phoneNumber,address_line_1:t.streetAddress,address_line_2:t.extendedAddress,city:t.locality,state:t.region,country_code:t.countryCode,postal_code:t.postalCode}}createSignInButton(e){const t=document.querySelector(`#${e}`);if(!t)throw new Error("Need a container to place the button");return this.insertVisaCheckoutButton(t)}insertVisaCheckoutButton(e){const t=document.createElement("div");return t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-end",t.innerHTML='\n            <img\n                alt="Visa Checkout"\n                class="v-button"\n                role="button"\n                src="https://secure.checkout.visa.com/wallet-services-web/xo/button.png?acceptCanadianVisaDebit=false&cobrand=true&height=34&width=178"\n                />\n            <a class="v-learn v-learn-default" style="text-align: right; display: block; font-size: 10px; color: #003366;" href="#" data-locale="en_US">Tell Me More</a>',e.appendChild(t),t}}V((e=>{const t=window,n=new m(e),o=new se(new U((0,r.vQ)(),t,n));return new ce(e,(0,i.createFormPoster)(),o)}),[{id:"braintreevisacheckout"}]);function le(e){const{billingAddress:t,email:n,firstName:i,lastName:r,phone:o,shippingAddress:a}=e,s=t||a;return{email:n,first_name:i,last_name:r,phone_number:o,address_line_1:null==s?void 0:s.line1,address_line_2:null==s?void 0:s.line2,city:null==s?void 0:s.city,state:null==s?void 0:s.state,country_code:null==s?void 0:s.countryCode,postal_code:null==s?void 0:s.postalCode}}function ue(e){const{email:t,phone:n,shippingAddress:i}=e,r=(null==i?void 0:i.recipientName)||"",[o,a]=r.split(" ");return{email:t,first_name:o||"",last_name:a||"",phone_number:n,address_line_1:null==i?void 0:i.line1,address_line_2:null==i?void 0:i.line2,city:null==i?void 0:i.city,state:null==i?void 0:i.state,country_code:null==i?void 0:i.countryCode,postal_code:null==i?void 0:i.postalCode}}function he(e){return"object"==typeof e&&null!==e&&"name"in e&&"BraintreeError"===e.name}var me=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};const pe=e=>{const{color:t,height:n}=e;return{backgroundColor:(i=t||"",i===O.WHITE?"#FFFFFF":"#3D95CE"),backgroundPosition:"50% 50%",backgroundSize:"80px auto",backgroundImage:`url("/app/assets/img/payment-providers/venmo-logo-${t===O.WHITE?O.BLUE:O.WHITE}.svg")`,backgroundRepeat:"no-repeat",borderRadius:"4px",cursor:"pointer",transition:"0.2s ease",minHeight:`${n||40}px`,minWidth:"150px",height:"100%",width:"100%",border:t===O.WHITE?"1px solid black":"none"};var i};class ye{constructor(e,t,n){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeSdk=n,this.onError=o.noop}initialize(e){return me(this,void 0,void 0,(function*(){const{braintreevenmo:t,containerId:n,methodId:i}=e;if(!i)throw new g('Unable to initialize payment because "options.methodId" argument is not provided.');const r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i),{clientToken:o,initializationData:a}=r,{paymentButtonStyles:s}=a,{cartButtonStyles:d}=s||{},c=(null==t?void 0:t.style)||d;if(!o||!a)throw new q(L.MissingPaymentMethod);if(!n)throw new g('Unable to initialize payment because "options.containerId" argument is not provided.');yield this.paymentIntegrationService.loadDefaultCheckout(),this.onError=(null==t?void 0:t.onError)||this.handleError,this.braintreeSdk.initialize(o);try{const e=yield this.braintreeSdk.getVenmoCheckoutOrThrow();this.renderVenmoButton(e,n,null==t?void 0:t.buyNowInitializeOptions,c)}catch(e){(he(e)||function(e){return e instanceof y}(e))&&this.handleInitializationVenmoError(e,n)}}))}deinitialize(){return me(this,void 0,void 0,(function*(){return yield this.braintreeSdk.deinitialize(),Promise.resolve()}))}handleError(e){throw new Error(e.message)}createBuyNowCart(e){return me(this,void 0,void 0,(function*(){if("function"==typeof(null==e?void 0:e.getBuyNowCartRequestBody)){const t=null==e?void 0:e.getBuyNowCartRequestBody();if(!t)throw new q(L.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(t)}catch(e){throw new H}}}))}handleInitializationVenmoError(e,t){return this.removeVenmoContainer(t),this.onError(e)}removeVenmoContainer(e){const t=document.getElementById(e);t&&t.remove()}renderVenmoButton(e,t,n,i){const r=document.getElementById(t),{color:o}=i||{};if(!r)throw new g("Unable to create wallet button without valid container ID.");r.setAttribute("aria-label","Venmo"),Object.assign(r.style,pe(i||{})),r.addEventListener("click",(()=>me(this,void 0,void 0,(function*(){r.setAttribute("disabled","true");const t=yield this.createBuyNowCart(n);e.tokenize&&e.tokenize(((e,n)=>me(this,void 0,void 0,(function*(){r.removeAttribute("disabled"),e&&this.onError(e),yield this.handlePostForm(n,null==t?void 0:t.id)}))))})))),o===O.BLUE&&(r.addEventListener("mouseenter",(()=>{r.style.backgroundColor="#0a7fc2"})),r.addEventListener("mouseleave",(()=>{r.style.backgroundColor=pe(i||{}).backgroundColor})))}handlePostForm(e,t){return me(this,void 0,void 0,(function*(){const{deviceData:n}=yield this.braintreeSdk.getDataCollectorOrThrow(),{nonce:i,details:r}=e;this.formPoster.postForm("/checkout.php",Object.assign({nonce:i,provider:"braintreevenmo",payment_type:"paypal",device_data:n,action:"set_external_checkout",billing_address:JSON.stringify(le(r)),shipping_address:JSON.stringify(ue(r))},t&&{cart_id:t}))}))}}V((e=>{const t=window,n=(0,r.vQ)(),o=new m(e),a=new U(n,t,o),s=new se(a);return new ye(e,(0,i.createFormPoster)(),s)}),[{id:"braintreevenmo"}]);function ge(e){return Boolean(e.instrumentId)}class ve extends p{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}function fe(e){return!("object"!=typeof e||null===e||void 0!==e.shouldSaveInstrument&&"boolean"!=typeof e.shouldSaveInstrument||void 0!==e.shouldSetAsDefaultInstrument&&"boolean"!=typeof e.shouldSetAsDefaultInstrument)}class be extends p{constructor(e){super(e||"Unable to proceed because the client library of a payment method has thrown an unexpected error."),this.name="PaymentMethodFailedError",this.type="payment_method_client_invalid"}}function Se(e){return!!e&&"accountNumber"in e&&"routingNumber"in e&&"ownershipType"in e&&"accountType"in e}var Ce=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class we{constructor(e,t){this.paymentIntegrationService=e,this.braintreeSdk=t}initialize(e){return Ce(this,void 0,void 0,(function*(){const{methodId:t,braintreeach:n}=e||{};if(!t)throw new g('Unable to initialize payment because "options.methodId" argument is not provided.');this.getMandateText=null==n?void 0:n.getMandateText,yield this.paymentIntegrationService.loadPaymentMethod(t);const i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{clientToken:r,initializationData:o}=i;if(!r||!o)throw new q(L.MissingPaymentMethod);this.braintreeSdk.initialize(r);try{this.usBankAccount=yield this.braintreeSdk.getUsBankAccount()}catch(e){this.handleBraintreeError(e)}}))}execute(e,t){return Ce(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new v(["payment"]);const r=ge(n.paymentData||{}),o=r?yield this.tokenizePaymentForVaultedInstrument(n):yield this.tokenizePayment(n),a=r?yield this.preparePaymentDataForVaultedInstrument(o,n):yield this.preparePaymentData(o,n);yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment(a)}))}finalize(){return Promise.reject(new ve)}deinitialize(){return Ce(this,void 0,void 0,(function*(){return yield this.braintreeSdk.deinitialize(),Promise.resolve()}))}tokenizePayment({paymentData:e}){return Ce(this,void 0,void 0,(function*(){const t=this.getUsBankAccountOrThrow();if(!Se(e))throw new v(["payment.paymentData"]);const n=ge(e)?"The data are used for stored instrument verification":"function"==typeof this.getMandateText&&this.getMandateText();if(!n)throw new g("Unable to proceed because getMandateText is not provided or returned undefined value.");try{const{nonce:i}=yield t.tokenize({bankDetails:this.getBankDetails(e),mandateText:n});return i}catch(e){this.handleBraintreeError(e)}}))}tokenizePaymentForVaultedInstrument(e){return Ce(this,void 0,void 0,(function*(){const{methodId:t,paymentData:n={}}=e,i=this.paymentIntegrationService.getState(),{config:r}=i.getPaymentMethodOrThrow(t);if(!r.isVaultingEnabled)throw new g("Vaulting is disabled but a vaulted instrument was being used for this transaction");return Se(n)?this.tokenizePayment(e):null}))}preparePaymentData(e,t){return Ce(this,void 0,void 0,(function*(){const{methodId:n,paymentData:i={}}=t;if(!Se(i))throw new v(["payment.paymentData"]);const{deviceData:r}=yield this.braintreeSdk.getDataCollectorOrThrow(),{shouldSaveInstrument:o,shouldSetAsDefaultInstrument:a,routingNumber:s,accountNumber:d}=i;return{methodId:n,paymentData:{deviceSessionId:r,shouldSetAsDefaultInstrument:a,shouldSaveInstrument:o,formattedPayload:{tokenized_bank_account:{issuer:s,masked_account_number:d.substr(-4),token:e}}}}}))}preparePaymentDataForVaultedInstrument(e,t){return Ce(this,void 0,void 0,(function*(){const{methodId:n,paymentData:i={}}=t;if(!ge(i)||!fe(i))throw new v(["payment.paymentData"]);const{deviceData:r}=yield this.braintreeSdk.getDataCollectorOrThrow(),{instrumentId:o,shouldSetAsDefaultInstrument:a}=i;return{methodId:n,paymentData:Object.assign({deviceSessionId:r,instrumentId:o,shouldSetAsDefaultInstrument:a},e&&{nonce:e})}}))}getBankDetails(e){const t=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),n=e.ownershipType.toLowerCase(),i=e.accountType.toLowerCase();return Object.assign(Object.assign({accountNumber:e.accountNumber,routingNumber:e.routingNumber,ownershipType:n},"personal"===n?{firstName:e.firstName,lastName:e.lastName}:{businessName:e.businessName}),{accountType:i,billingAddress:{streetAddress:t.address1,extendedAddress:t.address2,locality:t.city,region:t.stateOrProvinceCode,postalCode:t.postalCode}})}getUsBankAccountOrThrow(){if(!this.usBankAccount)throw new C(b.PaymentNotInitialized);return this.usBankAccount}handleBraintreeError(e){if(!D(e))throw e;throw new be(e.message)}}const _e=V((e=>new we(e,(e=>{const t=new m(e),n=new U((0,r.vQ)(),window,t);return new se(n)})(e))),[{id:"braintreeach"}]);class Ie{constructor(e){const{element:t,closeElement:n,mainElement:i}=this._createElements(e);this._element=t,this._closeElement=n,this._mainElement=i}show(e){this._mainElement.parentElement||(this._registerClick(e),document.body.appendChild(this._mainElement),setTimeout((()=>this._element.style.opacity="1")))}remove(){this._mainElement.parentElement&&(this._unregisterClick&&this._unregisterClick(),this._removeAfterTransition(),setTimeout((()=>this._element.style.opacity="0")))}_createElements(e){const t=document.createElement("div"),{background:n="rgba(0, 0, 0, 0.8)",id:i="checkoutOverlay",transitionDuration:r=400,hasCloseButton:o=!1,innerHtml:a=null}=e||{};let s,d,c,l,u=t;if(i&&(t.id=i),a){const e=document.createElement("div");l=`${i}--overlayText`,e.className=l,e.appendChild(a),t.appendChild(e)}return o&&(c=`${i}--close`,s=document.createElement("div"),s.className=c,d=`${i}--layout`,u=document.createElement("div"),u.className=d,u.appendChild(t),u.appendChild(s)),u.appendChild(function(e){const{id:t,background:n,transitionDuration:i,classLayout:r,classOverlayText:o,classClose:a}=e,s=document.createElement("style"),d=r?`, .${r}`:"";return s.id=`${t}--styles`,s.type="text/css",s.innerText=`\n        #${t}${d} {\n            display: block;\n            height: 100%;\n            width: 100%;\n            left: 0;\n            top: 0;\n            position: fixed;\n            z-index: 2147483647;\n        }\n        #${t} {\n            transition: opacity ${i}ms ease-out;\n            background: ${n};\n            opacity: 0;\n        }\n    `,o&&(s.innerText+=`\n             #${t} {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n             }\n             #${t} .${o} {\n                color: white;\n                max-width: 330px;\n                font-size: 1.2em;\n                text-align: center;\n             }\n        `),a&&(s.innerText+=`\n            #${t} {\n                opacity: 1;\n            }\n            .${r} .${a} {\n                position: fixed;\n                right: 16px;\n                top: 16px;\n                width: 16px;\n                height: 16px;\n                opacity: 0.6;\n                cursor: pointer;\n                z-index: 3147483647;\n            }\n            .${r} .${a}::after, .${r} .${a}::before {\n                position: absolute;\n                left: 8px;\n                content: '';\n                height: 16px;\n                width: 2px;\n                background-color: #fff;\n            }\n            .${r} .${a}::after {\n                transform: rotate(-45deg);\n            }\n            .${r} .${a}::before {\n                transform: rotate(45deg);\n            }\n        `),s}({id:i,background:n,transitionDuration:r,classLayout:d,classOverlayText:l,classClose:c})),{element:t,closeElement:s,mainElement:u}}_addEventListener(e,t){e&&t&&e.addEventListener("click",t)}_removeEventListener(e,t){e&&t&&e.removeEventListener("click",t)}_registerClick(e){if(this._unregisterClick&&this._unregisterClick(),e){const{onClick:t,onClickClose:n}=e;this._addEventListener(this._element,t),this._addEventListener(this._closeElement,n),this._unregisterClick=()=>{this._removeEventListener(this._element,t),this._removeEventListener(this._closeElement,n),this._unregisterClick=void 0}}}_removeAfterTransition(){const e=t=>{"opacity"===t.propertyName&&(this._mainElement.parentElement&&this._mainElement.remove(),this._element.removeEventListener("transitionend",e))};this._element.addEventListener("transitionend",e)}}const Pe={size:70,color:"#d9d9d9",backgroundColor:"#ffffff"},Ee="embedded-checkout-loading-indicator-rotation";class Oe{constructor(e){this.styles=Object.assign(Object.assign({},Pe),e&&e.styles),this.containerStyles=Object.assign({},e&&e.containerStyles),this.defineAnimation(),this.container=this.buildContainer(),this.indicator=this.buildIndicator(),this.container.appendChild(this.indicator)}show(e){if(e){const t=document.getElementById(e);if(!t)throw new Error("Unable to attach the loading indicator because the parent ID is not valid.");t.appendChild(this.container)}this.container.style.visibility="visible",this.container.style.opacity="1"}hide(){const e=()=>{this.container.style.visibility="hidden",this.container.removeEventListener("transitionend",e)};this.container.addEventListener("transitionend",e),this.container.style.opacity="0"}buildContainer(){const e=document.createElement("div");return e.style.display="block",e.style.bottom="0",e.style.left="0",e.style.height="100%",e.style.width="100%",e.style.position="absolute",e.style.right="0",e.style.top="0",e.style.transition="all 250ms ease-out",e.style.opacity="0",this.setStyleAttribute(e,this.containerStyles),e}buildIndicator(){const e=document.createElement("div");return e.style.display="block",e.style.width=`${this.styles.size}px`,e.style.height=`${this.styles.size}px`,e.style.borderRadius=`${this.styles.size}px`,e.style.border="solid 1px",e.style.borderColor=`${this.styles.backgroundColor} ${this.styles.backgroundColor} ${this.styles.color} ${this.styles.color}`,e.style.margin="0 auto",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="50%",e.style.transform="translateY(-50%) rotate(0deg)",e.style.transformStyle="preserve-3d",e.style.animation=`${Ee} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`,e}setStyleAttribute(e,t){Object.keys(t).forEach((n=>{e.style.setProperty(n,t[n])}))}defineAnimation(){var e;if(document.getElementById(Ee))return;const t=document.createElement("style");t.id=Ee,null===(e=document.head)||void 0===e||e.appendChild(t),t.sheet instanceof CSSStyleSheet&&t.sheet.insertRule(`\n                @keyframes ${Ee} {\n                    0% { transform: translateY(-50%) rotate(0deg); }\n                    100% { transform: translateY(-50%) rotate(360deg); }\n                }\n            `,0)}}const Ae={"background-color":"rgba(0, 0, 0, 0.4)","z-index":"1000"};var ke=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Te{constructor(e,t,n,i){this.paymentIntegrationService=e,this.braintreeIntegrationService=t,this.braintreeMessages=n,this.loadingIndicator=i,this.braintreeHostWindow=window}initialize(e){return ke(this,void 0,void 0,(function*(){const{braintree:t,methodId:n}=e;if(this.braintree=t,this.paymentMethod&&this.paymentMethod.nonce||(this.paymentMethod=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n)),this.paymentMethod.clientToken&&(null==t?void 0:t.bannerContainerId))return yield this.loadPaypal(),this.loadPaypalCheckoutInstance();if(this.paymentMethod.clientToken)return this.loadPaypal();const i=yield this.paymentIntegrationService.loadPaymentMethod(n);if(this.paymentMethod=i.getPaymentMethodOrThrow(n),null==t?void 0:t.bannerContainerId)return this.loadPaypalCheckoutInstance();if(!this.paymentMethod.clientToken)throw new q(L.MissingPaymentMethod);return this.loadPaypal()}))}execute(e,t){var n;return ke(this,void 0,void 0,(function*(){const{payment:i}=e,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{onError:o}=this.braintree||{},a=this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,s=a&&a["PAYPAL-3521.handling_declined_error_braintree"];if(!i)throw new v(["payment"]);try{const e=yield this.preparePaymentData(i,r.useStoreCredit);yield this.paymentIntegrationService.submitOrder(r,t),yield this.paymentIntegrationService.submitPayment(e)}catch(e){this.isProviderError(e)&&s&&(yield this.loadPaypal(),null===(n=this.paypalButtonRender)||void 0===n||n.close(),yield this.loadPaypalCheckoutInstance(),yield new Promise(((e,t)=>{o&&"function"==typeof o&&o(new Error("INSTRUMENT_DECLINED")),t()}))),this.handleError(e)}}))}finalize(){return Promise.reject(new ve)}deinitialize(){var e;return this.braintreeTokenizePayload=void 0,null===(e=this.paypalButtonRender)||void 0===e||e.close(),this.braintreeIntegrationService.teardown()}preparePaymentData(e,t){var n;return ke(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState(),r=i.getOutstandingBalance(t),o=i.getStoreConfig();if(!r)throw new q(L.MissingCheckout);if(!o)throw new q(L.MissingCheckoutConfig);if(!this.paymentMethod)throw new C(b.PaymentNotInitialized);const{currency:a,storeProfile:{storeLanguage:s}}=o,{nonce:d,config:{isVaultingEnabled:c}}=this.paymentMethod,{methodId:l,paymentData:u={}}=e,h=(null===(n=this.braintreeTokenizePayload)||void 0===n?void 0:n.nonce)||d;if(h){const t=yield this.paymentIntegrationService.loadPaymentMethod(l);return this.paymentMethod=t.getPaymentMethod(l),Object.assign(Object.assign({},e),{paymentData:this.formattedPayload(h)})}if(ge(u)||(m=u,Boolean(m.instrumentId)&&!Object.prototype.hasOwnProperty.call(m,"ccNumber")&&!Object.prototype.hasOwnProperty.call(m,"ccCvv"))){if(!c)throw new g("Vaulting is disabled but a vaulted instrument was being used for this transaction");return Promise.resolve(e)}var m;if(!fe(u))throw new q(L.MissingPayment);const{shouldSaveInstrument:p,shouldSetAsDefaultInstrument:y}=u;if(p&&!c)throw new g("Vaulting is disabled but shouldSaveInstrument is set to true");const v=i.getShippingAddress(),f=v?W(v):void 0;return Promise.all([this.braintreeIntegrationService.paypal({amount:r,locale:s,currency:a.code,offerCredit:"braintreepaypalcredit"===this.paymentMethod.id,shippingAddressOverride:f,shouldSaveInstrument:p||!1,shippingAddressEditable:!1}),this.braintreeIntegrationService.getSessionId()]).then((([{nonce:t,details:n}={},i])=>Object.assign(Object.assign({},e),{paymentData:this.formattedPayload(t,n&&n.email,i,p,y)})))}))}formattedPayload(e,t,n,i,r){return{formattedPayload:{vault_payment_instrument:i||null,set_as_default_stored_instrument:r||null,device_info:n||null,paypal_account:{token:e,email:t||null}}}}loadPaypalCheckoutInstance(){return ke(this,void 0,void 0,(function*(){const{clientToken:e,initializationData:t,id:n}=this.paymentMethod||{};if(!e)throw new q(L.MissingPaymentMethod);try{this.braintreeIntegrationService.initialize(e);const i={currency:this.paymentIntegrationService.getState().getCartOrThrow().currency.code,intent:null==t?void 0:t.intent,isCreditEnabled:null==t?void 0:t.isCreditEnabled},r="braintreepaypalcredit"===n||!(null==t?void 0:t.isCreditEnabled);yield this.braintreeIntegrationService.getPaypalCheckout(i,(e=>{var t;r&&n&&(null===(t=this.braintree)||void 0===t?void 0:t.bannerContainerId)&&this.renderPayPalMessages(n,this.braintree.bannerContainerId),this.renderPayPalButton(e)}),this.handleError)}catch(e){this.handleError(e)}}))}renderPayPalMessages(e,t){this.braintreeMessages.render(e,t,T.PAYMENT)}renderPayPalButton(e){const{onPaymentError:t,submitForm:n,onRenderButton:i,containerId:r,onError:o}=this.braintree||{};if(!r)return;if(!this.paymentMethod)throw new C(b.PaymentNotInitialized);this.loadingIndicatorContainer=r.split("#")[1];const{id:a,config:{testMode:s}}=this.paymentMethod,{paypal:d}=this.braintreeHostWindow,c=null==d?void 0:d.FUNDING.PAYPAL;d&&c?(this.paypalButtonRender=d.Buttons({env:s?"sandbox":"production",commit:!1,fundingSource:c,onClick:()=>{this.toggleLoadingIndicator(!0)},createOrder:()=>this.setupPayment(e,a,t),onApprove:t=>ke(this,void 0,void 0,(function*(){this.braintreeTokenizePayload=yield this.tokenizePaymentOrThrow(t,e),n&&"function"==typeof n&&n()})),onCancel:()=>{this.toggleLoadingIndicator(!1)},onError:e=>{this.toggleLoadingIndicator(!1),null==o||o(e)}}),i&&"function"==typeof i&&i(),this.paypalButtonRender.isEligible()&&this.paypalButtonRender.render(`${r}`)):this.removeElement(r.split("#")[1])}setupPayment(e,t,n){return ke(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState();try{const n=i.getCustomer(),r=i.getPaymentMethodOrThrow(t),o=i.getCheckoutOrThrow().outstandingBalance,a=i.getStoreConfigOrThrow().currency.code,s=i.getShippingAddress()||(null==n?void 0:n.addresses[0]),d=s?W(s):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:d,amount:o,currency:a,offerCredit:!1,intent:r.initializationData.intent})}catch(e){throw n&&(he(e)||e instanceof p)&&n(e),e}}))}tokenizePaymentOrThrow(e,t,n){return ke(this,void 0,void 0,(function*(){try{return yield t.tokenizePayment(e)}catch(e){throw n&&(he(e)||e instanceof p)&&n(e),e}}))}loadPaypal(){return ke(this,void 0,void 0,(function*(){const{clientToken:e,initializationData:t}=this.paymentMethod||{};if(!e||!t)throw new q(L.MissingPaymentMethod);try{this.braintreeIntegrationService.initialize(e),yield this.braintreeIntegrationService.getPaypal()}catch(e){this.handleError(e)}return Promise.resolve()}))}handleError(e){if(!he(e))throw e;if("PAYPAL_POPUP_CLOSED"===e.code)throw new w(e.message);throw new be(e.message)}isProviderError(e){var t,n,i;return!!function(e){return"object"==typeof e&&null!==e&&"errors"in e}(e)&&"2046"===(null===(i=null===(n=((null===(t=null==e?void 0:e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error)))||[])[0])||void 0===n?void 0:n.provider_error)||void 0===i?void 0:i.code)}removeElement(e){const t=e&&document.getElementById(e);t&&t.remove()}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const Ne=V((e=>{const t=window,n=new Ie,i=new m(e),o=new F(new U((0,r.vQ)(),t,i),t,n),a=new Q(e);return new Te(e,o,a,new Oe({containerStyles:Ae}))}),[{id:"braintreepaypal"},{id:"braintreepaypalcredit"}]);var Me;!function(e){e.Json="application/json",e.JsonV1="application/vnd.bc.v1+json"}(Me||(Me={}));const xe=Me,De={"X-Checkout-SDK-Version":"1.808.0"};class ze{constructor(e){this.requestSender=e}getOrderStatus(e="braintreelocalmethods",t){return n=this,r=function*(){const n=`/api/storefront/initialization/${e}`,i=Object.assign({"X-API-INTERNAL":"This API endpoint is for internal use only and may change in the future","Content-Type":xe.Json},De);return(yield this.requestSender.get(n,Object.assign({headers:i},t))).body},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}}const Fe={body:{},headers:{},status:0};class Be extends p{constructor(e,{message:t,errors:n}={}){const{body:i,headers:r,status:o}=e||Fe;super(t||"An unexpected error has occurred."),this.name="RequestError",this.type="request",this.body=i,this.headers=r,this.status=o,this.errors=n||[]}}class Re extends Be{constructor(e){super(e,{message:"There is a problem processing your payment. Please try again later."}),this.name="PaymentMethodInvalidError",this.type="payment_method_invalid"}}class Le extends Be{constructor(e){super(e,{message:"The request has timed out or aborted."}),this.name="TimeoutError",this.type="timeout"}}var je=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ue{constructor(e,t,n,i,r=3e3,a=3e5){this.paymentIntegrationService=e,this.braintreeSdk=t,this.braintreeRequestSender=n,this.loadingIndicator=i,this.pollingInterval=r,this.maxPollingIntervalTime=a,this.isLPMsUpdateExperimentEnabled=!1,this.pollingTimer=0,this.stopPolling=o.noop,this.isPollingEnabled=!1}initialize(e){return je(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,braintreelocalmethods:i}=e;if(this.gatewayId=t,!n)throw new g('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new g('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!i)throw new g('Unable to initialize payment because "options.braintreelocalmethods" argument is not provided.');this.braintreelocalmethods=i,this.loadingIndicatorContainer=i.container.split("#")[1],yield this.paymentIntegrationService.loadPaymentMethod(t);const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(t),{clientToken:a,config:s,initializationData:d}=o,l=r.getStoreConfigOrThrow().checkoutSettings.features;if(this.isPollingEnabled=c(l,"PAYPAL-5258.braintree_local_methods_polling"),this.isLPMsUpdateExperimentEnabled=c(l,"PAYPAL-4853.add_new_payment_flow_for_braintree_lpms"),!a||!d||!s.merchantId)throw new q(L.MissingPaymentMethod);try{this.braintreeSdk.initialize(a),this.isNonInstantPaymentMethod(n)||(this.braintreeLocalPayment=yield this.braintreeSdk.getBraintreeLocalPayment(s.merchantId))}catch(e){this.handleError(e)}}))}finalize(){return Promise.reject(new ve)}deinitialize(){return je(this,void 0,void 0,(function*(){return this.toggleLoadingIndicator(!1),Promise.resolve()}))}execute(e,t){return je(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new v(["payment"]);const{methodId:r}=n;this.toggleLoadingIndicator(!0),this.isNonInstantPaymentMethod(r)?yield this.executeWithNotInstantLPM(r):yield this.executeWithInstantLPM(r,i,t)}))}executeWithNotInstantLPM(e){return je(this,void 0,void 0,(function*(){try{const t=yield this.getLPMsBasicPaymentData();yield this.paymentIntegrationService.submitOrder(),yield this.paymentIntegrationService.submitPayment({methodId:e,paymentData:Object.assign(Object.assign({},t),{formattedPayload:{method:e}})})}catch(e){if(this.isBraintreeRedirectError(e)){const t=e.body.additional_action_required.data.redirect_url;return new Promise(((e,n)=>{window.location.replace(t),this.toggleLoadingIndicator(!1),n()}))}return this.handleError(e),Promise.reject(e)}}))}executeWithInstantLPM(e,t,n){return je(this,void 0,void 0,(function*(){if(!this.braintreeLocalPayment)throw new Re;yield new Promise(((i,r)=>{var o;null===(o=this.braintreeLocalPayment)||void 0===o||o.startPayment(this.getInstantLPMConfig(e,t,n),this.getInstantLPMCallback(i,r,e,t,n))}))}))}getLPMsBasicPaymentData(){return je(this,void 0,void 0,(function*(){const{deviceData:e}=yield this.braintreeSdk.getDataCollectorOrThrow();return{deviceSessionId:e}}))}getInstantLPMConfig(e,t,n){const i=this.paymentIntegrationService.getState(),r=i.getCartOrThrow(),o=i.getBillingAddressOrThrow(),{firstName:a,lastName:s,countryCode:d}=o,{currency:c,email:l,lineItems:u}=r,h=u.physicalItems.length>0,m=i.getCheckoutOrThrow().outstandingBalance,p=i.getStoreConfigOrThrow().links.checkoutLink;return{paymentType:e,amount:m,fallback:{url:p,buttonText:"Complete Payment"},currencyCode:c.code,shippingAddressRequired:h,email:l,givenName:a,surname:s,address:{countryCode:d},onPaymentStart:(i,r)=>je(this,void 0,void 0,(function*(){if(!this.isLPMsUpdateExperimentEnabled)return this.orderId=i.paymentId,void r();const o=yield this.getLPMsBasicPaymentData(),a=Object.assign(Object.assign({},o),{formattedPayload:{method:e,[`${e}_account`]:{order_id:i.paymentId}}});try{yield this.paymentIntegrationService.submitOrder(t,n),yield this.paymentIntegrationService.submitPayment({methodId:e,paymentData:a})}catch(t){if(this.isBraintreeOrderSavedResponse(t)&&t.body.additional_action_required.data.order_id_saved_successfully)return r(),this.isPollingEnabled?new Promise(((t,n)=>{this.initializePollingMechanism(e,t,n,this.gatewayId)})):void 0;throw t}}))}}getInstantLPMCallback(e,t,n,i,r){const o=this.paymentIntegrationService.getState().getCartOrThrow();return(a,s)=>je(this,void 0,void 0,(function*(){if(a)return"LOCAL_PAYMENT_WINDOW_CLOSED"===a.code?(this.toggleLoadingIndicator(!1),this.resetPollingMechanism(),t()):(this.isPollingEnabled&&this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t(new Re));const d=yield this.getLPMsBasicPaymentData(),c=Object.assign(Object.assign({},d),{formattedPayload:{method:n,[`${n}_account`]:Object.assign({email:o.email,token:s.nonce},this.isLPMsUpdateExperimentEnabled?{}:{order_id:this.orderId})}});try{return this.isLPMsUpdateExperimentEnabled||(yield this.paymentIntegrationService.submitOrder(i,r)),yield this.paymentIntegrationService.submitPayment({methodId:n,paymentData:c}),e(void 0)}catch(e){return this.handleError(e),t(e)}}))}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}handleError(e){const{onError:t}=this.braintreelocalmethods||{};this.isPollingEnabled&&this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}isNonInstantPaymentMethod(e){return e.toUpperCase()in te}isBraintreeRedirectError(e){var t;if("object"!=typeof e||null===e)return!1;const{body:n}=e;return!!n&&!!(null===(t=n.additional_action_required)||void 0===t?void 0:t.data.redirect_url)}isBraintreeOrderSavedResponse(e){var t;if("object"!=typeof e||null===e)return!1;const{body:n}=e;return!!n&&(null===(t=n.additional_action_required)||void 0===t?void 0:t.data.hasOwnProperty("order_id_saved_successfully"))}initializePollingMechanism(e,t,n,i){return je(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.braintreeRequestSender.getOrderStatus(i,{params:{useMetadata:!1}}),o=r.status===ee.Pending,a=r.status===ee.Completed,s=r.status===ee.Failed;if(a)return this.deinitializePollingMechanism(),t();if(s)return n();if(!a&&o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,braintreelocalmethods:this.braintreelocalmethods}),this.handleError(new Le)}catch(e){n()}}))}deinitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deinitializePollingMechanism()}reinitializeStrategy(e){return je(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}}const Ve=V((e=>{const t=window,n=new m(e),i=new se(new U((0,r.vQ)(),t,n)),o=(0,s.createRequestSender)(),a=new ze(o);return new Ue(e,i,a,new Oe({styles:{backgroundColor:"black"}}))}),[{gateway:"braintreelocalmethods"}]);function qe(e){return"string"!=typeof e}function He(e,t){if(t||e)return function(e){var t,n;const i={},r=(0,o.omitBy)(e.root,qe),a=(0,o.omitBy)(e.input,qe),s=(0,o.omitBy)(e.toggle,qe),d=(0,o.omitBy)(null===(t=e.text)||void 0===t?void 0:t.body,qe),c=(0,o.omitBy)(null===(n=e.text)||void 0===n?void 0:n.caption,qe),l=e.branding;return Object.keys(r).length&&(i.root=r),Object.keys(a).length&&(i.input=a),Object.keys(s).length&&(i.toggle=s),Object.keys(d).length&&(i.text={},i.text.body=d),Object.keys(c).length&&(i.text=Object.assign({},i.text),i.text.caption=c),l&&(i.branding=l),i}(function(e,t){var n,i,r,o,a,s,d,c,l,u,h,m,p,y,g,v,f,b,S,C,w,_;return{root:{backgroundColorPrimary:(null==e?void 0:e.fastlaneRootSettingsBackgroundColor)||(null===(n=null==t?void 0:t.root)||void 0===n?void 0:n.backgroundColorPrimary),errorColor:(null==e?void 0:e.fastlaneRootSettingsErrorColor)||(null===(i=null==t?void 0:t.root)||void 0===i?void 0:i.errorColor),fontFamily:(null==e?void 0:e.fastlaneRootSettingsFontFamily)||(null===(r=null==t?void 0:t.root)||void 0===r?void 0:r.fontFamily),fontSizeBase:(null==e?void 0:e.fastlaneRootSettingsFontSize)||(null===(o=null==t?void 0:t.root)||void 0===o?void 0:o.fontSizeBase),padding:(null==e?void 0:e.fastlaneRootSettingsPadding)||(null===(a=null==t?void 0:t.root)||void 0===a?void 0:a.padding),primaryColor:(null==e?void 0:e.fastlaneRootSettingsPrimaryColor)||(null===(s=null==t?void 0:t.root)||void 0===s?void 0:s.primaryColor)},input:{borderRadius:(null==e?void 0:e.fastlaneInputSettingsBorderRadius)||(null===(d=null==t?void 0:t.input)||void 0===d?void 0:d.borderRadius),borderColor:(null==e?void 0:e.fastlaneInputSettingsBorderColor)||(null===(c=null==t?void 0:t.input)||void 0===c?void 0:c.borderColor),focusBorderColor:(null==e?void 0:e.fastlaneInputSettingsFocusBorderBase)||(null===(l=null==t?void 0:t.input)||void 0===l?void 0:l.focusBorderColor),backgroundColor:(null==e?void 0:e.fastlaneInputSettingsBackgroundColor)||(null===(u=null==t?void 0:t.input)||void 0===u?void 0:u.backgroundColor),borderWidth:(null==e?void 0:e.fastlaneInputSettingsBorderWidth)||(null===(h=null==t?void 0:t.input)||void 0===h?void 0:h.borderWidth),textColorBase:(null==e?void 0:e.fastlaneInputSettingsTextColorBase)||(null===(m=null==t?void 0:t.input)||void 0===m?void 0:m.textColorBase)},toggle:{colorPrimary:(null==e?void 0:e.fastlaneToggleSettingsColorPrimary)||(null===(p=null==t?void 0:t.toggle)||void 0===p?void 0:p.colorPrimary),colorSecondary:(null==e?void 0:e.fastlaneToggleSettingsColorSecondary)||(null===(y=null==t?void 0:t.toggle)||void 0===y?void 0:y.colorSecondary)},text:{body:{color:(null==e?void 0:e.fastlaneTextBodySettingsColor)||(null===(v=null===(g=null==t?void 0:t.text)||void 0===g?void 0:g.body)||void 0===v?void 0:v.color),fontSize:(null==e?void 0:e.fastlaneTextBodySettingsFontSize)||(null===(b=null===(f=null==t?void 0:t.text)||void 0===f?void 0:f.body)||void 0===b?void 0:b.fontSize)},caption:{color:(null==e?void 0:e.fastlaneTextCaptionSettingsColor)||(null===(C=null===(S=null==t?void 0:t.text)||void 0===S?void 0:S.caption)||void 0===C?void 0:C.color),fontSize:(null==e?void 0:e.fastlaneTextCaptionSettingsFontSize)||(null===(_=null===(w=null==t?void 0:t.text)||void 0===w?void 0:w.caption)||void 0===_?void 0:_.fontSize)}},branding:(null==e?void 0:e.fastlaneBrandingSettings)||(null==t?void 0:t.branding)}}(e,t))}function Ge(e){return!!e&&("authenticationState"in e||"addresses"in e||"instruments"in e)}var $e,We=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ye{constructor(e,t,n){this.paymentIntegrationService=e,this.braintreeFastlaneUtils=t,this.braintreeSdk=n}initialize(e){var t;return We(this,void 0,void 0,(function*(){const{methodId:n,braintreefastlane:i}=e;if(!n)throw new g('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new g('Unable to initialize payment because "options.braintreefastlane" argument is not provided.');if(!i.onInit||"function"!=typeof i.onInit)throw new g('Unable to initialize payment because "options.braintreefastlane.onInit" argument is not provided or it is not a function.');if(!i.onChange||"function"!=typeof i.onChange)throw new g('Unable to initialize payment because "options.braintreefastlane.onChange" argument is not provided or it is not a function.');yield this.paymentIntegrationService.loadPaymentMethod(n);const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(n),{initializationData:a,clientToken:s}=o||{},{isFastlaneStylingEnabled:d}=a||{},l=c(r.getStoreConfigOrThrow().checkoutSettings.features,"PROJECT-7080.braintree_fastlane_three_ds");this.is3DSEnabled=o.config.is3dsEnabled,s&&l&&this.braintreeSdk.initialize(s);const u=He(d?null===(t=o.initializationData)||void 0===t?void 0:t.fastlaneStyles:void 0,i.styles);yield this.braintreeFastlaneUtils.initializeBraintreeFastlaneOrThrow(n,u),this.shouldRunAuthenticationFlow()&&(yield this.braintreeFastlaneUtils.runPayPalAuthenticationFlowOrThrow()),yield this.initializeCardComponent(),this.onError=i.onError,i.onInit((e=>this.renderBraintreeCardComponent(e))),i.onChange((()=>this.handleBraintreeStoredInstrumentChange(n)))}))}execute(e,t){return We(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new v(["payment"]);yield this.paymentIntegrationService.submitOrder(i,t);const r=yield this.preparePaymentPayload(n.methodId);yield this.paymentIntegrationService.submitPayment(r),this.braintreeFastlaneUtils.removeSessionIdFromCookies()}))}finalize(){return Promise.reject(new ve)}deinitialize(){return We(this,void 0,void 0,(function*(){return this.braintreeCardComponent=void 0,Promise.resolve()}))}initializeCardComponent(){return We(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState(),{phone:t,firstName:n,lastName:i}=e.getBillingAddressOrThrow(),r=`${n} ${i}`,o={styles:{},fields:Object.assign({cardholderName:{prefill:r,enabled:!0}},t&&{phoneNumber:{prefill:t}})},a=this.braintreeFastlaneUtils.getBraintreeFastlaneComponentOrThrow();this.braintreeCardComponent=yield a(o)}))}renderBraintreeCardComponent(e){const t=this.getBraintreeCardComponentOrThrow();if(!e)throw new g('Unable to initialize payment because "container" argument is not provided.');t.render(e)}preparePaymentPayload(e){var t,n;return We(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState(),r=i.getBillingAddressOrThrow(),o=`${r.firstName} ${r.lastName}`,a=this.getPayPalInstruments()[0],s=yield this.braintreeFastlaneUtils.getDeviceSessionId(),d=c(i.getStoreConfigOrThrow().checkoutSettings.features,"PROJECT-7080.braintree_fastlane_three_ds");if(a){const t=this.is3DSEnabled&&d?yield this.get3DS(a.bigpayToken,(null==a?void 0:a.iin)||""):void 0;return{methodId:e,paymentData:{deviceSessionId:s,formattedPayload:{paypal_fastlane_token:{token:t||a.bigpayToken}}}}}const{getPaymentToken:l}=this.getBraintreeCardComponentOrThrow(),u=yield l({name:{fullName:o},billingAddress:this.mapToPayPalAddress(r)}),h=(null===(n=null===(t=u.paymentSource.card)||void 0===t?void 0:t.binDetails)||void 0===n?void 0:n.bin)||"",m=this.is3DSEnabled&&d?yield this.get3DS(u.id,h):void 0;return{methodId:e,paymentData:{deviceSessionId:s,nonce:m||u.id}}}))}get3DS(e,t){return We(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=yield this.braintreeSdk.getBraintreeThreeDS(),r=n.getOrderOrThrow();return new Promise(((n,o)=>{i.verifyCard({amount:null==r?void 0:r.orderAmount,nonce:e,bin:t,onLookupComplete:(e,t)=>{i.on("customer-canceled",(()=>{"function"==typeof this.onError&&this.onError(new w),o(new w)})),t()}},((e,t)=>(e&&"THREEDS_VERIFY_CARD_CANCELED_BY_MERCHANT"===e.code&&("function"==typeof this.onError&&this.onError(new w),o(new w)),n(t.nonce))))}))}))}mapToPayPalAddress(e){return{streetAddress:(null==e?void 0:e.address1)||"",locality:(null==e?void 0:e.city)||"",region:(null==e?void 0:e.stateOrProvinceCode)||(null==e?void 0:e.stateOrProvince)||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCodeAlpha2:(null==e?void 0:e.countryCode)||""}}shouldRunAuthenticationFlow(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getCustomerOrThrow(),i=e.getPaymentProviderCustomer(),r=Ge(i)?i:{},o=this.braintreeFastlaneUtils.getSessionIdFromCookies();return!(!n.isGuest||(null==r?void 0:r.authenticationState)===ne.CANCELED||(null==r?void 0:r.authenticationState)||o!==t.id)}getBraintreeCardComponentOrThrow(){if(!this.braintreeCardComponent)throw new B;return this.braintreeCardComponent}getPayPalInstruments(){const e=this.paymentIntegrationService.getState().getPaymentProviderCustomerOrThrow();return(Ge(e)?e:{}).instruments||[]}handleBraintreeStoredInstrumentChange(e){return We(this,void 0,void 0,(function*(){const t=this.braintreeFastlaneUtils.getBraintreeFastlaneOrThrow(),{selectionChanged:n,selectedCard:i}=yield t.profile.showCardSelector();if(n){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomer(),n=Ge(t)?t:{},r=this.braintreeFastlaneUtils.mapPayPalToBcInstrument(e,[i]);if(r&&r.length>0)return yield this.paymentIntegrationService.updatePaymentProviderCustomer(Object.assign(Object.assign({},n),{instruments:[...r]})),r[0]}}))}}!function(e){e.CVV="cvv",e.PAN="pan"}($e||($e={}));class Ke{static get(e){const t=`${encodeURIComponent(`${e}`)}=`,n=document.cookie;let i=null;const r=n.indexOf(t);if(r>-1){let e=n.indexOf(";",r);-1===e&&(e=n.length),i=decodeURIComponent(n.substring(r+t.length,e))}return i}static set(e,t,n={secure:!0}){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;const{expires:r,path:o,domain:a,secure:s}=n;if(r)i+=`; expires=${r.toUTCString()}`;else{const e=new Date,t=60;e.setTime(e.getTime()+60*t*1e3),i+=`; expires=${e.toUTCString()}`}o&&(i+=`; path=${o}`),a&&(i+=`; domain=${a}`),s&&(i+="; secure"),document.cookie=i}static remove(e,t){Ke.set(e,"",Object.assign({expires:new Date(0)},t))}}var Qe=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Je{constructor(e,t){this.paymentIntegrationService=e,this.braintreeIntegrationService=t}getDeviceSessionId(){return Qe(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState().getCart();return this.braintreeIntegrationService.getSessionId(null==e?void 0:e.id)}))}initializeBraintreeFastlaneOrThrow(e,t){return Qe(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getCart(),{clientToken:r,config:o}=n.getPaymentMethodOrThrow(e);if(!r)throw new q(L.MissingPaymentMethod);this.methodId=e,this.braintreeIntegrationService.initialize(r),this.braintreeFastlane=yield this.braintreeIntegrationService.getBraintreeFastlane(null==i?void 0:i.id,o.testMode,t)}))}getBraintreeFastlaneOrThrow(){if(!this.braintreeFastlane)throw new B;return this.braintreeFastlane}getBraintreeFastlaneComponentOrThrow(){return this.getBraintreeFastlaneOrThrow().FastlaneCardComponent}runPayPalAuthenticationFlowOrThrow(e,t){var n;return Qe(this,void 0,void 0,(function*(){try{const i=this.getMethodIdOrThrow(),r=this.getBraintreeFastlaneOrThrow(),{lookupCustomerByEmail:o,triggerAuthenticationFlow:a}=r.identity,s=this.paymentIntegrationService.getState(),d=s.getCartOrThrow(),c=s.getCustomer(),l=s.getBillingAddress(),{isFastlaneShippingOptionAutoSelectEnabled:u}=s.getPaymentMethodOrThrow(i).initializationData||{},h=e||(null==c?void 0:c.email)||(null==l?void 0:l.email)||"",{customerContextId:m}=yield o(h);if(!m)return yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:ne.UNRECOGNIZED,addresses:[],instruments:[]}),void this.saveSessionIdToCookies(d.id);const{authenticationState:p,profileData:y}=yield a(m),g=(null===(n=null==y?void 0:y.shippingAddress)||void 0===n?void 0:n.phoneNumber)||"";if(p===ne.CANCELED)return yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:p,addresses:[],instruments:[]}),void this.removeSessionIdFromCookies();const v=this.mapPayPalToBcAddress([y.shippingAddress],[g])||[],f=this.getPayPalBillingAddresses(y),b=f?this.mapPayPalToBcAddress([f],[g]):[],S=y.card?this.mapPayPalToBcInstrument(i,[y.card]):[],C=this.mergeShippingAndBillingAddresses(v,b);if(this.saveSessionIdToCookies(d.id),yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:p,addresses:C,instruments:S}),b.length>0&&d.lineItems.physicalItems.length>0&&(yield this.paymentIntegrationService.updateBillingAddress(b[0])),b.length>0&&d.lineItems.digitalItems.length>0&&0===d.lineItems.physicalItems.length){const{firstName:e,lastName:t}=C[0],n=Object.assign(Object.assign({},b[0]),{firstName:e,lastName:t});yield this.paymentIntegrationService.updateBillingAddress(n)}v.length>0&&d.lineItems.physicalItems.length>0&&(yield this.paymentIntegrationService.updateShippingAddress(v[0]),t&&u&&(yield this.setShippingOption()))}catch(e){}}))}getSessionIdFromCookies(){return Ke.get("bc-fastlane-sessionId")||""}saveSessionIdToCookies(e){const t=new Date;t.setDate(t.getDate()+14),Ke.set("bc-fastlane-sessionId",e,{expires:t,secure:!0})}removeSessionIdFromCookies(){Ke.remove("bc-fastlane-sessionId")}mapPayPalToBcInstrument(e,t){if(t)return t.map((t=>{const{id:n,paymentSource:i}=t,{brand:r,expiry:o,lastDigits:a,binDetails:s}=i.card,[d,c]=o.split("-");return{bigpayToken:n,brand:r,defaultInstrument:!1,expiryMonth:c,expiryYear:d,iin:(null==s?void 0:s.bin)||"",last4:a,method:e,provider:e,trustedShippingAddress:!1,type:"card",untrustedShippingCardVerificationMode:$e.PAN}}))}mapPayPalToBcAddress(e,t){if(!e)return[];const n=this.paymentIntegrationService.getState().getCountries()||[],i=e=>{const t=n.find((t=>t.code===e));return(null==t?void 0:t.name)||""};return e.map((e=>({id:Date.now(),type:"paypal-address",firstName:e.firstName||"",lastName:e.lastName||"",company:e.company||"",address1:e.streetAddress,address2:e.extendedAddress||"",city:e.locality,stateOrProvince:e.region,stateOrProvinceCode:e.region,country:i(e.countryCodeAlpha2),countryCode:e.countryCodeAlpha2,postalCode:e.postalCode,phone:t&&t[0]||"",customFields:[]})))}getPayPalBillingAddresses(e){const{card:t,name:n}=e||{};if(!t)return;const{firstName:i,lastName:r}=t.paymentSource.card.billingAddress,{firstName:a,lastName:s}=n||{},{shippingAddress:d}=e||{},c=Object.assign(Object.assign({},t.paymentSource.card.billingAddress),{firstName:i||a,lastName:r||s});return d&&(0,o.isEqual)(this.normalizeAddress(c),this.normalizeAddress(d))?d:c}normalizeAddress(e){return(0,o.omit)(e,["id"])}mergeShippingAndBillingAddresses(e,t){const n=t.filter((t=>!e.some((e=>(0,o.isEqual)(this.normalizeAddress(e),this.normalizeAddress(t))))));return[...e,...n]}getMethodIdOrThrow(){if(!this.methodId)throw new g('Unable to proceed because "methodId" argument is not provided.');return this.methodId}setShippingOption(){var e;return Qe(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getConsignments()||[],n=(null===(e=t[0])||void 0===e?void 0:e.availableShippingOptions)||[],i=n.find((e=>e.isRecommended));if(i||n.length){const e=i||n[0];yield this.paymentIntegrationService.selectShippingOption(e.id)}}))}}const Ze=V((e=>{const t=window,n=new m(e),i=new F(new U((0,r.vQ)(),t,n),t),o=new Je(e,i),a=new U((0,r.vQ)(),t,n),s=new se(a);return new Ye(e,o,s)}),[{id:"braintreeacceleratedcheckout"}]);var Xe=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class et{constructor(e,t,n){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeSdk=n}initialize(e){return Xe(this,void 0,void 0,(function*(){const{braintreevisacheckout:t,methodId:n}=e;if(!t)throw new g('Unable to initialize payment because "options.braintreevisacheckout" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const i=this.paymentIntegrationService.getState();this.paymentMethod=i.getPaymentMethodOrThrow(n);const r=i.getCheckoutOrThrow(),a=i.getStoreConfigOrThrow(),{clientToken:s,config:d}=this.paymentMethod||{};if(!s)throw new q(L.MissingPaymentMethod);const{onError:c=o.noop,onPaymentSelect:l=o.noop}=t;this.braintreeSdk.initialize(s);const u=yield this.braintreeSdk.getBraintreeVisaCheckout(),h=yield this.braintreeSdk.getVisaCheckoutSdk(null==d?void 0:d.testMode),m=u.createInitOptions({settings:{locale:a.storeProfile.storeLanguage,shipping:{collectShipping:!1}},paymentRequest:{currencyCode:a.currency.code,subtotal:String(r.subtotal)}});yield h.init(m),h.on("payment.success",(e=>this.tokenizePayment(u,e).then((()=>Promise.all([this.paymentIntegrationService.loadCheckout(),this.paymentIntegrationService.loadPaymentMethod(n)]))).then((()=>l())).catch((e=>c(e))))),h.on("payment.error",((e,t)=>c(t)))}))}execute(e,t){var n,i;return Xe(this,void 0,void 0,(function*(){const{payment:r}=e,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!r)throw new g('Unable to submit payment because "payload.payment" argument is not provided.');if(!(null===(i=null===(n=this.paymentMethod)||void 0===n?void 0:n.initializationData)||void 0===i?void 0:i.nonce))throw new q(L.MissingPaymentMethod);const{nonce:a}=this.paymentMethod.initializationData;try{yield this.paymentIntegrationService.submitOrder(o,t),yield this.paymentIntegrationService.submitPayment(Object.assign(Object.assign({},r),{paymentData:{nonce:a}}))}catch(e){this.handleError(e)}}))}finalize(){return Promise.reject(new ve)}deinitialize(){return Xe(this,void 0,void 0,(function*(){yield this.braintreeSdk.deinitialize()}))}tokenizePayment(e,t){return Xe(this,void 0,void 0,(function*(){return Promise.all([e.tokenize(t),this.braintreeSdk.getDataCollectorOrThrow()]).then((([e,t])=>{const n=this.paymentIntegrationService.getState(),i=n.getShippingAddress(),r=n.getBillingAddress(),{shippingAddress:o=this.mapToVisaCheckoutAddress(i),billingAddress:a=this.mapToVisaCheckoutAddress(r)}=e;return this.postForm(Object.assign(Object.assign({},e),{shippingAddress:o,billingAddress:a}),t)}))}))}mapToVisaCheckoutAddress(e){return e?{firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phone,streetAddress:e.address1,extendedAddress:e.address2,locality:e.city,region:e.stateOrProvinceCode,countryCode:e.countryCode,postalCode:e.postalCode}:{}}postForm(e,t){const{userData:n,billingAddress:i,shippingAddress:r,details:o}=e,{userEmail:a}=n,{deviceData:s}=t;return this.formPoster.postForm("/checkout.php",{payment_type:e.type,nonce:e.nonce,provider:"braintreevisacheckout",action:"set_external_checkout",device_data:s,card_information:JSON.stringify({type:o.cardType,number:o.lastTwo}),billing_address:JSON.stringify(this.getAddress(a,i)),shipping_address:JSON.stringify(this.getAddress(a,r))})}getAddress(e,t={}){return{email:e,first_name:t.firstName,last_name:t.lastName,phone_number:t.phoneNumber,address_line_1:t.streetAddress,address_line_2:t.extendedAddress,city:t.locality,state:t.region,country_code:t.countryCode,postal_code:t.postalCode}}handleError(e){if(e instanceof Error&&"BraintreeError"===e.name)throw new be(e.message);throw e}}V((e=>{const t=window,n=new m(e),o=new se(new U((0,r.vQ)(),t,n));return new et(e,(0,i.createFormPoster)(),o)}),[{id:"braintreevisacheckout"}]);var tt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class nt{constructor(e,t){this.paymentIntegrationService=e,this.braintreeIntegrationService=t}initialize(e){return tt(this,void 0,void 0,(function*(){const{methodId:t}=e;yield this.paymentIntegrationService.loadPaymentMethod(t);const n=this.paymentIntegrationService.getState();this.venmoOptions=e.braintreevenmo;const i=n.getPaymentMethodOrThrow(t);yield this.initializeBraintreeVenmo(i)}))}execute(e){return tt(this,void 0,void 0,(function*(){const{payment:t}=e,n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!t)throw new v(["payment"]);try{const e=yield this.preparePaymentData(t);yield this.paymentIntegrationService.submitOrder(n),yield this.paymentIntegrationService.submitPayment(e)}catch(e){this.handleError(e)}}))}finalize(){return Promise.reject(new ve)}deinitialize(){return tt(this,void 0,void 0,(function*(){return yield this.braintreeIntegrationService.teardown(),Promise.resolve()}))}handleError(e){if(!D(e))throw e;if("PAYPAL_POPUP_CLOSED"===e.code)throw new w(e.message);throw new be(e.message)}initializeBraintreeVenmo(e){var t;return tt(this,void 0,void 0,(function*(){const{clientToken:n}=e;if(!n)throw new q(L.MissingPaymentMethod);const i=c(this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,"PAYPAL-5406.braintree_venmo_web_fallback_support");try{this.braintreeIntegrationService.initialize(n),this.braintreeVenmoCheckout=yield this.braintreeIntegrationService.getVenmoCheckout(Object.assign(Object.assign({},void 0!==(null===(t=this.venmoOptions)||void 0===t?void 0:t.allowDesktop)?{allowDesktop:this.venmoOptions.allowDesktop}:{}),i?{mobileWebFallBack:i}:{}))}catch(e){this.handleError(e)}}))}preparePaymentData(e){return tt(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),{nonce:n}=t.getPaymentMethodOrThrow(e.methodId);if(n)return Object.assign(Object.assign({},e),{paymentData:this.formattedPayload(n)});const i=yield this.braintreeVenmoTokenize(),r=yield this.braintreeIntegrationService.getSessionId();return Object.assign(Object.assign({},e),{paymentData:this.formattedPayload(i.nonce,i.details.email,r)})}))}formattedPayload(e,t,n){return{formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:n||null,paypal_account:{token:e,email:t||null}}}}braintreeVenmoTokenize(){return new Promise(((e,t)=>{var n;null===(n=this.braintreeVenmoCheckout)||void 0===n||n.tokenize(((n,i)=>{if(n)return t(n);e(i)}))}))}}V((e=>{const t=window,n=(0,r.vQ)(),i=new m(e),o=new U(n,t,i),a=new F(o,t);return new nt(e,a)}),[{id:"braintreevenmo"}]);var it=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class rt{constructor(e,t,n){this.paymentIntegrationService=e,this.braintreeIntegrationService=t,this.braintreeHostedForm=n}initialize(e){return it(this,void 0,void 0,(function*(){const{methodId:t,gatewayId:n,braintree:i}=e;yield this.paymentIntegrationService.loadPaymentMethod(t);const r=this.paymentIntegrationService.getState();this.paymentMethod=r.getPaymentMethodOrThrow(t);const{clientToken:o}=this.paymentMethod;if(!o)throw new q(L.MissingPaymentMethod);this.threeDSecure=null==i?void 0:i.threeDSecure;try{this.braintreeIntegrationService.initialize(o,this.threeDSecure),this.isHostedPaymentFormEnabled(t,n)&&(null==i?void 0:i.form)&&(yield this.braintreeHostedForm.initialize(i.form,i.unsupportedCardBrands,o),this.isHostedFormInitialized=this.braintreeHostedForm.isInitialized()),this.is3dsEnabled=this.paymentMethod.config.is3dsEnabled,this.deviceSessionId=yield this.braintreeIntegrationService.getSessionId(),this.shouldInitializeBraintreeFastlane()&&(yield this.initializeBraintreeFastlaneOrThrow(t))}catch(e){return this.handleError(e)}}))}execute(e){return it(this,void 0,void 0,(function*(){const{payment:t}=e,n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!t)throw new v(["payment"]);this.isHostedFormInitialized&&this.braintreeHostedForm.validate(),yield this.paymentIntegrationService.submitOrder(n);const i=this.paymentIntegrationService.getState(),r=i.getBillingAddressOrThrow(),o=i.getOrderOrThrow().orderAmount;try{const e=this.isHostedFormInitialized?yield this.prepareHostedPaymentData(t,r,o):yield this.preparePaymentData(t,r,o);yield this.paymentIntegrationService.submitPayment(Object.assign(Object.assign({},t),{paymentData:e}))}catch(e){return this.processAdditionalAction(e,t,o)}}))}finalize(){return Promise.reject(new ve)}deinitialize(){return it(this,void 0,void 0,(function*(){return this.isHostedFormInitialized=!1,yield Promise.all([this.braintreeIntegrationService.teardown(),this.braintreeHostedForm.deinitialize()]),Promise.resolve()}))}handleError(e){if(he(e))throw new be(e.message);throw e}preparePaymentData(e,t,n){return it(this,void 0,void 0,(function*(){const{paymentData:i}=e,r={deviceSessionId:this.deviceSessionId};if(this.isSubmittingWithStoredCard(e))return Object.assign(Object.assign({},r),i);const{shouldSaveInstrument:o=!1,shouldSetAsDefaultInstrument:a=!1}=fe(i)?i:{},{nonce:s}=this.shouldPerform3DSVerification(e)?yield this.braintreeIntegrationService.verifyCard(e,t,n):yield this.braintreeIntegrationService.tokenizeCard(e,t);return Object.assign(Object.assign({},r),{nonce:s,shouldSaveInstrument:o,shouldSetAsDefaultInstrument:a})}))}prepareHostedPaymentData(e,t,n){return it(this,void 0,void 0,(function*(){const{paymentData:i}=e,r={deviceSessionId:this.deviceSessionId};if(this.isSubmittingWithStoredCard(e)){const{nonce:e}=yield this.braintreeHostedForm.tokenizeForStoredCardVerification();return Object.assign(Object.assign(Object.assign({},r),i),{nonce:e})}const{shouldSaveInstrument:o=!1,shouldSetAsDefaultInstrument:a=!1}=fe(i)?i:{},{nonce:s}=this.shouldPerform3DSVerification(e)?yield this.verifyCardWithHostedForm(t,n):yield this.braintreeHostedForm.tokenize(t);return Object.assign(Object.assign({},r),{shouldSaveInstrument:o,shouldSetAsDefaultInstrument:a,nonce:s})}))}verifyCardWithHostedForm(e,t){return it(this,void 0,void 0,(function*(){const n=yield this.braintreeHostedForm.tokenize(e);return this.braintreeIntegrationService.challenge3DSVerification(n,t)}))}processAdditionalAction(e,t,n){return it(this,void 0,void 0,(function*(){if(!(e=>"object"==typeof e&&null!==e&&"body"in e)(e)||!(0,o.some)(e.body.errors,{code:"three_d_secure_required"}))return this.handleError(e);try{const{payer_auth_request:i}=function(e){return"object"==typeof e&&null!==e&&"name"in e&&"body"in e&&"status"in e.body&&"three_ds_result"in e.body&&"payer_auth_request"in e.body.three_ds_result&&"errors"in e.body}(e)&&e.body.three_ds_result||{},{paymentData:r}=t,o=this.paymentIntegrationService.getState();if(!r||!ge(r))throw new v(["instrumentId"]);const a=o.getCardInstrumentOrThrow(r.instrumentId),{nonce:s}=yield this.braintreeIntegrationService.challenge3DSVerification({nonce:i||"",bin:a.iin},n);yield this.paymentIntegrationService.submitPayment(Object.assign(Object.assign({},t),{paymentData:{deviceSessionId:this.deviceSessionId,nonce:s}}))}catch(e){return this.handleError(e)}}))}isHostedPaymentFormEnabled(e,t){return!!e&&!0===this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t).config.isHostedFormEnabled}isSubmittingWithStoredCard(e){return!(!e.paymentData||!ge(e.paymentData))}shouldPerform3DSVerification(e){return!(!this.is3dsEnabled||this.isSubmittingWithStoredCard(e))}shouldInitializeBraintreeFastlane(){var e;const t=this.paymentIntegrationService.getState().getPaymentProviderCustomerOrThrow(),n=Ge(t)?t:{};return(null===(e=this.paymentMethod)||void 0===e?void 0:e.initializationData.isAcceleratedCheckoutEnabled)&&!(null==n?void 0:n.authenticationState)}initializeBraintreeFastlaneOrThrow(e){return it(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getPaymentMethodOrThrow(e),{clientToken:r,config:o}=i;if(!r)throw new q(L.MissingPaymentMethod);this.braintreeIntegrationService.initialize(r,this.threeDSecure),yield this.braintreeIntegrationService.getBraintreeFastlane(n.id,o.testMode)}))}}function ot(e){return"cardNumber"in e}function at(e){if(!D(e))return!1;const{details:t}=e;return void 0===t||"object"==typeof t&&null!==t&&void 0===t.invalidFieldKeys||(n=t,Array.isArray(n)&&n.every((e=>"string"==typeof e)));var n}var st,dt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};!function(e){e[e.CreditCard=0]="CreditCard",e[e.StoredCardVerification=1]="StoredCardVerification"}(st||(st={}));class ct{constructor(e,t){this.braintreeScriptLoader=e,this.braintreeSDKVersionManager=t,this.isInitializedHostedForm=!1,this.handleBlur=e=>{var t,n;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onBlur)||void 0===n||n.call(t,{fieldType:this.mapFieldType(e.emittedBy),errors:this.mapErrors(e.fields)})},this.handleFocus=e=>{var t,n;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onFocus)||void 0===n||n.call(t,{fieldType:this.mapFieldType(e.emittedBy)})},this.handleCardTypeChange=e=>{var t,n;const i=1===e.cards.length?e.cards[0].type.replace(/^master-card$/,"mastercard"):void 0;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onCardTypeChange)||void 0===n||n.call(t,{cardType:i})},this.handleInputSubmitRequest=e=>{var t,n;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onEnter)||void 0===n||n.call(t,{fieldType:this.mapFieldType(e.emittedBy)})},this.handleValidityChange=e=>{var t,n;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onValidate)||void 0===n||n.call(t,{isValid:this.isValidForm(e),errors:this.mapValidationErrors(e.fields)})}}initialize(e,t,n){var i,r,a,s,d;return dt(this,void 0,void 0,(function*(){this.clientToken=n,this.formOptions=e,this.type=ot(e.fields)?st.CreditCard:st.StoredCardVerification;const c=this.mapFieldOptions(e.fields,t);(0,o.isEmpty)(c)?this.isInitializedHostedForm=!1:(this.cardFields=yield this.createHostedFields({fields:c,styles:e.styles&&this.mapStyleOptions(e.styles)}),null===(i=this.cardFields)||void 0===i||i.on("blur",this.handleBlur),null===(r=this.cardFields)||void 0===r||r.on("focus",this.handleFocus),null===(a=this.cardFields)||void 0===a||a.on("cardTypeChange",this.handleCardTypeChange),null===(s=this.cardFields)||void 0===s||s.on("validityChange",this.handleValidityChange),null===(d=this.cardFields)||void 0===d||d.on("inputSubmitRequest",this.handleInputSubmitRequest),this.isInitializedHostedForm=!0)}))}isInitialized(){return!!this.isInitializedHostedForm}deinitialize(){var e;return dt(this,void 0,void 0,(function*(){this.isInitializedHostedForm&&(this.isInitializedHostedForm=!1,yield null===(e=this.cardFields)||void 0===e?void 0:e.teardown())}))}validate(){if(!this.cardFields)throw new C(b.PaymentNotInitialized);const e=this.cardFields.getState();if(!this.isValidForm(e)){this.handleValidityChange(e);const t=this.mapValidationErrors(e.fields);throw new f(t)}}tokenize(e){var t,n,i,r,a;return dt(this,void 0,void 0,(function*(){if(!this.cardFields)throw new C(b.PaymentNotInitialized);try{const r=yield this.cardFields.tokenize((0,o.omitBy)({billingAddress:e&&this.mapBillingAddress(e)},o.isNil));return null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onValidate)||void 0===n||n.call(t,{isValid:!0,errors:{}}),{nonce:r.nonce,bin:null===(i=r.details)||void 0===i?void 0:i.bin}}catch(e){if(at(e)){const t=this.mapTokenizeError(e);if(t)throw null===(a=null===(r=this.formOptions)||void 0===r?void 0:r.onValidate)||void 0===a||a.call(r,{isValid:!1,errors:t}),new f(t)}throw e}}))}tokenizeForStoredCardVerification(){var e,t,n,i,r;return dt(this,void 0,void 0,(function*(){if(!this.cardFields)throw new C(b.PaymentNotInitialized);try{const i=yield this.cardFields.tokenize();return null===(t=null===(e=this.formOptions)||void 0===e?void 0:e.onValidate)||void 0===t||t.call(e,{isValid:!0,errors:{}}),{nonce:i.nonce,bin:null===(n=i.details)||void 0===n?void 0:n.bin}}catch(e){if(at(e)){const t=this.mapTokenizeError(e,!0);if(t)throw null===(r=null===(i=this.formOptions)||void 0===i?void 0:i.onValidate)||void 0===r||r.call(i,{isValid:!1,errors:t}),new f(t)}throw e}}))}createHostedFields(e){return dt(this,void 0,void 0,(function*(){const t=yield this.getClient(),n=yield this.braintreeScriptLoader.loadHostedFields(),i=this.braintreeSDKVersionManager.getSDKVersion()===l?Object.assign(Object.assign({},e),{preventCursorJumps:!0}):e;return n.create(Object.assign(Object.assign({},i),{client:t}))}))}getClient(){return dt(this,void 0,void 0,(function*(){if(!this.clientToken)throw new C(b.PaymentNotInitialized);if(!this.client){const e=yield this.braintreeScriptLoader.loadClient();this.client=e.create({authorization:this.clientToken})}return this.client}))}mapBillingAddress(e){return{countryName:e.country,postalCode:e.postalCode,streetAddress:e.address2?`${e.address1} ${e.address2}`:e.address1}}mapFieldOptions(e,t){if(ot(e)){const n={};return null==t||t.forEach((e=>{(e=>Object.values(oe).includes(e))(e)&&(n[e]=!1)})),(0,o.omitBy)({number:Object.assign({container:`#${e.cardNumber.containerId}`,placeholder:e.cardNumber.placeholder,internalLabel:e.cardNumber.accessibilityLabel},Object.keys(n).length>0?{supportedCardBrands:n}:{}),expirationDate:{container:`#${e.cardExpiry.containerId}`,placeholder:e.cardExpiry.placeholder,internalLabel:e.cardExpiry.accessibilityLabel},cvv:e.cardCode&&{container:`#${e.cardCode.containerId}`,placeholder:e.cardCode.placeholder,internalLabel:e.cardCode.accessibilityLabel},cardholderName:{container:`#${e.cardName.containerId}`,placeholder:e.cardName.placeholder,internalLabel:e.cardName.accessibilityLabel}},o.isNil)}return(0,o.omitBy)({number:e.cardNumberVerification&&{container:`#${e.cardNumberVerification.containerId}`,placeholder:e.cardNumberVerification.placeholder},cvv:e.cardCodeVerification&&{container:`#${e.cardCodeVerification.containerId}`,placeholder:e.cardCodeVerification.placeholder}},o.isNil)}mapStyleOptions(e){const t=(e={})=>(0,o.omitBy)({color:e.color,"font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight},o.isNil);return{input:t(e.default),".invalid":t(e.error),":focus":t(e.focus)}}mapFieldType(e){switch(e){case"number":return this.type===st.StoredCardVerification?x.CardNumberVerification:x.CardNumber;case"expirationDate":return x.CardExpiry;case"cvv":return this.type===st.StoredCardVerification?x.CardCodeVerification:x.CardCode;case"cardholderName":return x.CardName;default:throw new Error("Unexpected field type")}}mapErrors(e){const t={};if(e)for(const[n,i]of Object.entries(e))if(i&&this.isValidParam(n)){const{isValid:e,isEmpty:r,isPotentiallyValid:o}=i;t[n]={isValid:e,isEmpty:r,isPotentiallyValid:o}}return t}mapValidationErrors(e){return Object.keys(e).reduce(((t,n)=>{var i;return Object.assign(Object.assign({},t),{[this.mapFieldType(n)]:(null===(i=e[n])||void 0===i?void 0:i.isValid)?void 0:[this.createInvalidError(this.mapFieldType(n))]})}),{})}mapTokenizeError(e,t=!1){var n,i;if("HOSTED_FIELDS_FIELDS_EMPTY"===e.code){const e=[this.createRequiredError(this.mapFieldType("cvv"))];return t?{[this.mapFieldType("cvv")]:e}:{[this.mapFieldType("cvv")]:e,[this.mapFieldType("expirationDate")]:[this.createRequiredError(this.mapFieldType("expirationDate"))],[this.mapFieldType("number")]:[this.createRequiredError(this.mapFieldType("number"))],[this.mapFieldType("cardholderName")]:[this.createRequiredError(this.mapFieldType("cardholderName"))]}}return null===(i=null===(n=e.details)||void 0===n?void 0:n.invalidFieldKeys)||void 0===i?void 0:i.reduce(((e,t)=>{const n=this.mapFieldType(t);return Object.assign(Object.assign({},e),{[n]:[this.createInvalidError(n)]})}),{})}createRequiredError(e){var t;return{fieldType:e,message:null!==(t={[x.CardCode]:"CVV is required",[x.CardCodeVerification]:"CVV is required",[x.CardNumber]:"Credit card number is required",[x.CardNumberVerification]:"Credit card number is required",[x.CardExpiry]:"Expiration date is required",[x.CardName]:"Full name is required"}[e])&&void 0!==t?t:"Field is required",type:"required"}}createInvalidError(e){var t,n,i,r;const o={[x.CardCode]:{message:"Invalid card code",type:"invalid_card_code"},[x.CardCodeVerification]:{message:"Invalid card code",type:"invalid_card_code"},[x.CardNumber]:{message:"Invalid card number",type:"invalid_card_number"},[x.CardNumberVerification]:{message:"Invalid card number",type:"invalid_card_number"},[x.CardExpiry]:{message:"Invalid card expiry",type:"invalid_card_expiry"},[x.CardName]:{message:"Invalid card name",type:"invalid_card_name"}};return{fieldType:e,message:null!==(n=null===(t=o[e])||void 0===t?void 0:t.message)&&void 0!==n?n:"Invalid field",type:null!==(r=null===(i=o[e])||void 0===i?void 0:i.type)&&void 0!==r?r:"invalid"}}isValidForm(e){return Object.keys(e.fields).every((t=>{var n;return null===(n=e.fields[t])||void 0===n?void 0:n.isValid}))}isValidParam(e){return["number","cvv","expirationDate","postalCode","cardholderName","cardType"].includes(e)}}V((e=>{const t=window,n=new m(e),i=new U((0,r.vQ)(),t,n),o=new F(i,t),a=new ct(i,n);return new rt(e,o,a)}),[{id:"braintree"}]);var lt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ut{constructor(e,t,n,i){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeIntegrationService=n,this.braintreeHostWindow=i}initialize(e){return lt(this,void 0,void 0,(function*(){const{braintreepaypal:t,methodId:n}=e,{container:i,onError:r}=t||{};if(!n)throw new g('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new g('Unable to initialize payment because "options.braintreepaypal" argument is not provided.');if(!i)throw new g('Unable to initialize payment because "options.braintreepaypal.container" argument is not provided.');let o,a=this.paymentIntegrationService.getState();try{if(o=a.getPaymentMethodOrThrow(n),!o.clientToken)throw new q(L.MissingPaymentToken)}catch(e){a=yield this.paymentIntegrationService.loadPaymentMethod(n),o=a.getPaymentMethodOrThrow(n)}const{clientToken:s,config:d,initializationData:c}=o,{paymentButtonStyles:l}=c||{},{checkoutTopButtonStyles:u}=l||{};if(!s||!c)throw new q(L.MissingPaymentMethod);const h={currency:a.getCartOrThrow().currency.code,intent:c.intent,isCreditEnabled:c.isCreditEnabled,commit:!1};this.braintreeIntegrationService.initialize(s),yield this.braintreeIntegrationService.getPaypalCheckout(h,(e=>{this.renderPayPalButton(e,t,n,Boolean(d.testMode),u)}),(e=>this.handleError(e,i,r)))}))}deinitialize(){return lt(this,void 0,void 0,(function*(){yield this.braintreeIntegrationService.teardown()}))}signIn(e,t){return lt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return lt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderPayPalButton(e,t,n,i,r){const{container:a,onClick:s=o.noop}=t,{paypal:d}=this.braintreeHostWindow,c=null==d?void 0:d.FUNDING.PAYPAL;if(d&&c){const o=d.Buttons({env:this.braintreeIntegrationService.getBraintreeEnv(i),fundingSource:c,style:Object.assign(Object.assign({},r),{height:36}),createOrder:()=>this.setupPayment(e,t,n),onApprove:i=>this.tokenizePayment(i,e,n,t),onClick:s});o.isEligible()&&o.render(`#${a}`)}else this.braintreeIntegrationService.removeElement(a)}setupPayment(e,t,n){var i;return lt(this,void 0,void 0,(function*(){try{yield this.paymentIntegrationService.loadDefaultCheckout();const t=this.paymentIntegrationService.getState(),r=t.getCheckoutOrThrow().outstandingBalance,o=t.getCartOrThrow().currency.code,a=t.getCustomer(),s=t.getPaymentMethodOrThrow(n),d=null==a?void 0:a.addresses[0],c=d?this.braintreeIntegrationService.mapToBraintreeShippingAddressOverride(d):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:c,amount:r,currency:o,offerCredit:!1,intent:null===(i=s.initializationData)||void 0===i?void 0:i.intent})}catch(e){const{container:n,onError:i}=t;this.handleError(e,n,i)}}))}tokenizePayment(e,t,n,i){return lt(this,void 0,void 0,(function*(){try{const{deviceData:i}=yield this.braintreeIntegrationService.getDataCollector({paypal:!0}),r=yield t.tokenizePayment(e),{details:o,nonce:a}=r,s=this.braintreeIntegrationService.mapToLegacyBillingAddress(o),d=this.braintreeIntegrationService.mapToLegacyShippingAddress(o);return this.formPoster.postForm("/checkout.php",{payment_type:"paypal",provider:n,action:"set_external_checkout",nonce:a,device_data:i,billing_address:JSON.stringify(s),shipping_address:JSON.stringify(d)}),r}catch(e){const{container:t,onError:n}=i;this.handleError(e,t,n)}}))}handleError(e,t,n){if(this.braintreeIntegrationService.removeElement(t),!n||!D(e))throw e;n(e)}}const ht=V((e=>{const t=window,n=new m(e),o=new F(new U((0,r.vQ)(),t,n),t);return new ut(e,(0,i.createFormPoster)(),o,t)}),[{id:"braintreepaypal"}]);var mt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class pt{constructor(e,t,n,i){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeIntegrationService=n,this.braintreeHostWindow=i}initialize(e){return mt(this,void 0,void 0,(function*(){const{braintreepaypalcredit:t,methodId:n}=e,{container:i,onError:r}=t||{};if(!n)throw new g('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new g('Unable to initialize payment because "options.braintreepaypalcredit" argument is not provided.');if(!i)throw new g('Unable to initialize payment because "options.braintreepaypalcredit.container" argument is not provided.');let o,a=this.paymentIntegrationService.getState();try{o=a.getPaymentMethodOrThrow(n)}catch(e){a=yield this.paymentIntegrationService.loadPaymentMethod(n),o=a.getPaymentMethodOrThrow(n)}const{clientToken:s,config:d,initializationData:c}=o,{paymentButtonStyles:l}=c||{},{checkoutTopButtonStyles:u}=l||{};if(!s||!c)throw new q(L.MissingPaymentMethod);const h={currency:a.getCartOrThrow().currency.code,intent:c.intent,isCreditEnabled:c.isCreditEnabled,commit:!1};this.braintreeIntegrationService.initialize(s),yield this.braintreeIntegrationService.getPaypalCheckout(h,(e=>{this.renderPayPalButton(e,t,n,Boolean(d.testMode),Object.assign(Object.assign({},u),{height:36}))}),(e=>this.handleError(e,i,r)))}))}deinitialize(){return mt(this,void 0,void 0,(function*(){yield this.braintreeIntegrationService.teardown()}))}signIn(e,t){return mt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return mt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderPayPalButton(e,t,n,i,r){const{container:a,onClick:s=o.noop}=t,{paypal:d}=this.braintreeHostWindow;let c=!1;d&&[d.FUNDING.PAYLATER,d.FUNDING.CREDIT].forEach((o=>{if(!c){const l=d.Buttons({env:i?"sandbox":"production",fundingSource:o,style:r,createOrder:()=>this.setupPayment(e,t,n),onApprove:i=>this.tokenizePayment(i,e,n,t),onClick:s});l.isEligible()&&(l.render(`#${a}`),c=!0)}})),d&&c||this.braintreeIntegrationService.removeElement(a)}setupPayment(e,t,n){var i;return mt(this,void 0,void 0,(function*(){try{yield this.paymentIntegrationService.loadDefaultCheckout();const t=this.paymentIntegrationService.getState(),r=t.getCheckoutOrThrow().outstandingBalance,o=t.getCartOrThrow().currency.code,a=t.getCustomer(),s=t.getPaymentMethodOrThrow(n),d=null==a?void 0:a.addresses[0],c=d?this.braintreeIntegrationService.mapToBraintreeShippingAddressOverride(d):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:c,amount:r,currency:o,offerCredit:!0,intent:null===(i=s.initializationData)||void 0===i?void 0:i.intent})}catch(e){const{container:n,onError:i}=t;this.handleError(e,n,i)}}))}tokenizePayment(e,t,n,i){return mt(this,void 0,void 0,(function*(){try{const{deviceData:i}=yield this.braintreeIntegrationService.getDataCollector({paypal:!0}),r=yield t.tokenizePayment(e),{details:o,nonce:a}=r,s=this.braintreeIntegrationService.mapToLegacyBillingAddress(o),d=this.braintreeIntegrationService.mapToLegacyShippingAddress(o);return this.formPoster.postForm("/checkout.php",{payment_type:"paypal",provider:n,action:"set_external_checkout",nonce:a,device_data:i,billing_address:JSON.stringify(s),shipping_address:JSON.stringify(d)}),r}catch(e){const{container:t,onError:n}=i;this.handleError(e,t,n)}}))}handleError(e,t,n){if(this.braintreeIntegrationService.removeElement(t),!n||!D(e))throw e;n(e)}}const yt=V((e=>{const t=window,n=new m(e),o=new F(new U((0,r.vQ)(),t,n),t);return new pt(e,(0,i.createFormPoster)(),o,t)}),[{id:"braintreepaypalcredit"}]);var gt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class vt{constructor(e,t){this.paymentIntegrationService=e,this.braintreeFastlaneUtils=t,this.isAcceleratedCheckoutEnabled=!1}initialize({methodId:e,braintreefastlane:t}){var n;return gt(this,void 0,void 0,(function*(){if(!e)throw new g('Unable to proceed because "methodId" argument is not provided.');const i=yield this.getValidPaymentMethodOrThrow(e),{isAcceleratedCheckoutEnabled:r,isFastlaneStylingEnabled:o}=i.initializationData||{},a=o?null===(n=i.initializationData)||void 0===n?void 0:n.fastlaneStyles:void 0;this.isAcceleratedCheckoutEnabled=!!r;try{if(this.isAcceleratedCheckoutEnabled){const e=He(a,null==t?void 0:t.styles);yield this.braintreeFastlaneUtils.initializeBraintreeFastlaneOrThrow(i.id,e)}}catch(e){}return Promise.resolve()}))}deinitialize(){return gt(this,void 0,void 0,(function*(){return Promise.resolve()}))}signIn(e,t){return gt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return gt(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){return gt(this,void 0,void 0,(function*(){const{checkoutPaymentMethodExecuted:t,continueWithCheckoutCallback:n}=e||{};if("function"!=typeof n)throw new g('Unable to proceed because "continueWithCheckoutCallback" argument is not provided and it must be a function.');const i=this.paymentIntegrationService.getState().getCustomerOrThrow();if(this.isAcceleratedCheckoutEnabled&&i.isGuest){const e=yield this.shouldRunAuthenticationFlow();t&&"function"==typeof t&&t(),e&&(yield this.braintreeFastlaneUtils.runPayPalAuthenticationFlowOrThrow(void 0,!0))}n()}))}shouldRunAuthenticationFlow(){var e;return gt(this,void 0,void 0,(function*(){const t="braintreeacceleratedcheckout";try{yield this.paymentIntegrationService.loadPaymentMethod(t);const n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t);return(null===(e=n.initializationData)||void 0===e?void 0:e.shouldRunAcceleratedCheckout)||!1}catch(e){return!1}}))}getValidPaymentMethodOrThrow(e){return gt(this,void 0,void 0,(function*(){let t=e;try{yield this.paymentIntegrationService.loadPaymentMethod(t)}catch(n){t="braintree"===e?"braintreeacceleratedcheckout":"braintree",yield this.paymentIntegrationService.loadPaymentMethod(t)}return this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t)}))}}const ft=V((e=>{const t=window,n=new m(e),i=new F(new U((0,r.vQ)(),t,n),t),o=new Je(e,i);return new vt(e,o)}),[{id:"braintreeacceleratedcheckout"},{id:"braintree"}]);class bt extends p{constructor(e){super(e||"Not implemented."),this.name="NotImplementedError",this.type="not_implemented"}}var St=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ct{constructor(e,t,n){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeSdk=n,this.buttonClassName="visa-checkout-wrapper",this.onError=o.noop}initialize(e){return St(this,void 0,void 0,(function*(){const{braintreevisacheckout:t,methodId:n}=e;if(!n)throw new g('Unable to proceed because "methodId" argument is not provided.');if(!t)throw new g('Unable to proceed because "options.braintreevisacheckout" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const i=this.paymentIntegrationService.getState(),r=i.getCheckoutOrThrow(),{clientToken:a,config:s}=i.getPaymentMethodOrThrow(n),d=i.getStoreConfigOrThrow();if(!a)throw new q(L.MissingPaymentMethod);this.braintreeSdk.initialize(a);const c=yield this.braintreeSdk.getBraintreeVisaCheckout(),l=yield this.braintreeSdk.getVisaCheckoutSdk(s.testMode),{container:u,onError:h}=t;this.onError=h||o.noop;const m=c.createInitOptions({paymentRequest:{currencyCode:d.currency.code,subtotal:String(r.subtotal)},settings:{locale:d.storeProfile.storeLanguage,shipping:{collectShipping:!0}}}),p=this.createSignInButton(u,this.buttonClassName);yield l.init(m),l.on("payment.success",(e=>this.tokenizePayment(c,e).then((()=>this.paymentIntegrationService.loadCheckout())).catch((e=>this.handleError(e))))),l.on("payment.error",((e,t)=>this.handleError(t))),p.style.visibility="visible"}))}deinitialize(){return St(this,void 0,void 0,(function*(){yield this.braintreeSdk.deinitialize()}))}signIn(){throw new bt('In order to sign in via VisaCheckout, the shopper must click on "Visa Checkout" button.')}signOut(e){return St(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}tokenizePayment(e,t){return St(this,void 0,void 0,(function*(){return Promise.all([e.tokenize(t),this.braintreeSdk.getDataCollectorOrThrow()]).then((([e,t])=>{const n=this.paymentIntegrationService.getState(),i=n.getShippingAddress(),r=n.getBillingAddress(),{shippingAddress:o=this.mapToVisaCheckoutAddress(i),billingAddress:a=this.mapToVisaCheckoutAddress(r)}=e;return this.postForm(Object.assign(Object.assign({},e),{shippingAddress:o,billingAddress:a}),t)}))}))}postForm(e,t){const{userData:n,billingAddress:i,shippingAddress:r,details:o}=e,{userEmail:a}=n,{deviceData:s}=t;return this.formPoster.postForm("/checkout.php",{payment_type:e.type,nonce:e.nonce,provider:"braintreevisacheckout",action:"set_external_checkout",device_data:s,card_information:JSON.stringify({type:o.cardType,number:o.lastTwo}),billing_address:JSON.stringify(this.getAddress(a,i)),shipping_address:JSON.stringify(this.getAddress(a,r))})}mapToVisaCheckoutAddress(e){return e?{firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phone,streetAddress:e.address1,extendedAddress:e.address2,locality:e.city,region:e.stateOrProvinceCode,countryCode:e.countryCode,postalCode:e.postalCode}:{}}getAddress(e,t={}){return{email:e,first_name:t.firstName,last_name:t.lastName,phone_number:t.phoneNumber,address_line_1:t.streetAddress,address_line_2:t.extendedAddress,city:t.locality,state:t.region,country_code:t.countryCode,postal_code:t.postalCode}}createSignInButton(e,t){const n=document.querySelector(`#${e}`);if(!n)throw new Error("Unable to proceed because the provided container ID is not valid.");return this.insertVisaCheckoutButton(n,t)}insertVisaCheckoutButton(e,t){const n=document.createElement("div");return n.style.display="flex",n.style.flexDirection="column",n.style.visibility="hidden",n.style.width="max-content",n.className=t,n.innerHTML='\n            <img\n                alt="Visa Checkout"\n                class="v-button"\n                role="button"\n                src="https://secure.checkout.visa.com/wallet-services-web/xo/button.png?acceptCanadianVisaDebit=false&cobrand=true&height=34&width=178"\n                />\n            <a class="v-learn v-learn-default" style="text-align: right; display: block; font-size: 10px; color: #003366;" href="#" data-locale="en_US">Tell Me More</a>',e.appendChild(n),n}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}}const wt=V((e=>{const t=window,n=new m(e),o=new se(new U((0,r.vQ)(),t,n));return new Ct(e,(0,i.createFormPoster)(),o)}),[{id:"braintreevisacheckout"}])},25656:(e,t,n)=>{n.d(t,{A:()=>c});var i=n(31635),r=n(3375),o=n.n(r),a=n(70355),s=n(12056),d=n(372);const c=(0,a.forwardRef)(((e,t)=>{var{additionalClassName:n,label:r,value:c,checked:l,id:u,themeV2:h=!1}=e,m=(0,i.__rest)(e,["additionalClassName","label","value","checked","id","themeV2"]);return a.createElement(a.Fragment,null,a.createElement(s.A,Object.assign({},m,{checked:l,className:o()("form-radio","optimizedCheckout-form-radio",n),id:u,ref:t,type:"radio",value:c})),a.createElement(d.A,{additionalClassName:h?"body-regular":"",htmlFor:u},r))}))},26565:(e,t,n)=>{function i(e,t){return t.reduce(((e,t)=>e-function(e){return e.discounts.reduce(((e,t)=>"AUTOMATIC"===t.type?e+t.amount:e),0)}(t)),e)}n.d(t,{A:()=>i})},26946:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(31635);const r={count:5,interval:1e3};function o(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const{count:n,interval:i}=Object.assign(Object.assign({},r),t);try{return yield e()}catch(t){if(1===n)throw t;return yield new Promise((e=>setTimeout(e,i))),o(e,{interval:i,count:n-1})}}))}},28058:(e,t,n)=>{var i;n.d(t,{A:()=>r}),function(e){e.Adyen="adyen",e.AdyenV2="adyenv2",e.AdyenV2GooglePay="googlepayadyenv2",e.AdyenV3GooglePay="googlepayadyenv3",e.AdyenV3="adyenv3",e.Affirm="affirm",e.Afterpay="afterpay",e.AmazonPay="amazonpay",e.ApplePay="applepay",e.Barclaycard="barclaycard",e.BlueSnapV2="bluesnapv2",e.BlueSnapDirect="bluesnapdirect",e.Boleto="boleto",e.Bolt="bolt",e.Braintree="braintree",e.BraintreeAch="braintreeach",e.BraintreeVenmo="braintreevenmo",e.AuthorizeNetGooglePay="googlepayauthorizenet",e.BNZGooglePay="googlepaybnz",e.BraintreeAcceleratedCheckout="braintreeacceleratedcheckout",e.BraintreeGooglePay="googlepaybraintree",e.PayPalCommerceAcceleratedCheckout="paypalcommerceacceleratedcheckout",e.PayPalCommerceGooglePay="googlepaypaypalcommerce",e.BraintreeVisaCheckout="braintreevisacheckout",e.BraintreeLocalPaymentMethod="braintreelocalmethods",e.BraintreePaypalCredit="braintreepaypalcredit",e.CBAMPGS="cba_mpgs",e.Checkoutcom="checkoutcom",e.CheckoutcomGooglePay="googlepaycheckoutcom",e.Clearpay="clearpay",e.Converge="converge",e.CybersourceV2GooglePay="googlepaycybersourcev2",e.Fawry="fawry",e.Humm="humm",e.Ideal="ideal",e.Klarna="klarna",e.Laybuy="laybuy",e.Masterpass="masterpass",e.Mollie="mollie",e.Moneris="moneris",e.OrbitalGooglePay="googlepayorbital",e.Oxxo="oxxo",e.PaypalExpress="paypalexpress",e.PaypalPaymentsPro="paypal",e.PaypalCommerce="paypalcommerce",e.PaypalCommerceCredit="paypalcommercecredit",e.PaypalCommerceCreditCards="paypalcommercecreditcards",e.PaypalCommerceAlternativeMethod="paypalcommercealternativemethods",e.PaypalCommerceVenmo="paypalcommercevenmo",e.BigCommercePaymentsPayPal="bigcommerce_payments_paypal",e.BigCommercePaymentsPayLater="bigcommerce_payments_paylater",e.BigCommercePaymentsCreditCards="bigcommerce_payments_creditcards",e.BigCommercePaymentsAlternativeMethod="bigcommerce_payments_apms",e.BigCommercePaymentsVenmo="bigcommerce_payments_venmo",e.BigCommercePaymentsFastLane="bigcommerce_payments_fastlane",e.BigCommercePaymentsGooglePay="googlepay_bigcommerce_payments",e.Qpay="qpay",e.Quadpay="quadpay",e.Ratepay="ratepay",e.SagePay="sagepay",e.Sepa="sepa",e.Sezzle="sezzle",e.SquareV2="squarev2",e.StripeGooglePay="googlepaystripe",e.StripeUPEGooglePay="googlepaystripeupe",e.StripeOCSGooglePay="googlepaystripeocs",e.StripeV3="stripev3",e.StripeUPE="stripeupe",e.WorldpayAccess="worldpayaccess",e.WorldpayAccessGooglePay="googlepayworldpayaccess",e.Zip="zip",e.TdOnlineMartGooglePay="googlepaytdonlinemart"}(i||(i={}));const r=i},28407:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(31635),r=n(3375),o=n.n(r),a=n(70355);const s=e=>{var{children:t,className:n,hidden:r,testId:s,isFloatingLabelEnabled:d,additionalClassName:c}=e,l=(0,i.__rest)(e,["children","className","hidden","testId","isFloatingLabelEnabled","additionalClassName"]);return a.createElement("label",Object.assign({},l,{className:o()({"floating-label":d},n||"form-label",{"is-srOnly":r},"optimizedCheckout-form-label",c),"data-test":s}),t)}},29561:(e,t,n)=>{n.d(t,{A:()=>i});const i=(0,n(70355).createContext)(void 0)},29853:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(31635),r=n(69462),o=n(69440),a=n(70355),s=n(30540),d=n.n(s),c=n(93422);const l=(0,a.memo)((({additionalClassName:e,component:t,field:n,form:i,onChange:o,render:s,testId:d,meta:l})=>{const h=(0,a.useMemo)((()=>a.createElement(u,{component:t,field:n,form:i,meta:l,onChange:o,render:s})),[n,i,o,t,s]);return a.createElement(c.A,{additionalClassName:e,hasError:(0,r.O6)(i.errors,n.name),testId:d},h)}),((e,t)=>{var{form:n,field:r}=e,o=(0,i.__rest)(e,["form","field"]),a=t.form,s=t.field,c=(0,i.__rest)(t,["form","field"]);return d()(o,c)&&d()(n,a)&&d()(r,s)})),u=e=>{var{field:t,onChange:n=o.noop,component:r="input",render:s}=e,d=(0,i.__rest)(e,["field","onChange","component","render"]);const c=(0,a.useRef)(t.value);return(0,a.useEffect)((()=>{((0,o.isDate)(t.value)?t.value.getTime():t.value)!==((0,o.isDate)(c.current)?c.current.getTime():c.current)&&n(t.value),c.current=t.value}),[t.value,n]),s?s(Object.assign({field:t},d)):"string"==typeof r?(0,a.createElement)(r,t):(0,a.createElement)(r,Object.assign({field:t},d))},h=(0,a.memo)((e=>{var{additionalClassName:t,className:n,component:o,render:s,testId:d,onChange:c}=e,u=(0,i.__rest)(e,["additionalClassName","className","component","render","testId","onChange"]);const h=(0,a.useCallback)((e=>a.createElement(l,Object.assign({},e,{additionalClassName:t,className:n,component:o,onChange:c,render:s,testId:d}))),[t,n,o,s,d,c]);return a.createElement(r.D0,Object.assign({},u),h)}))},29923:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Wn});var i={};n.r(i),n.d(i,{AmazonPayV2Button:()=>le,BigCommercePaymentsButton:()=>ue,BigcommercePaymentsPayLaterButton:()=>he,CheckoutButton:()=>me,ComponentRegistry:()=>fe,GooglePayButton:()=>pe,PayPalCommerceButton:()=>ge,PayPalCommerceCreditButton:()=>ye,StripeLinkV2Button:()=>ve});var r=n(98227),o=n(70355),a=n(38003),s=n.n(a),d=n(53156),c=n(54298),l=n(8542),u=n(84087),h=n(94027),m=n(23013),p=n(86620),y=(n(4266),n(22460)),g=n(50981);class v{isSupported(){return!0}}var f=n(4853),b=n(85021);class S extends f.A{constructor(e){super({name:"EMBEDDED_CHECKOUT_UNSUPPORTED_ERROR",message:e}),(0,b.h)(this,S.prototype)}}class C{constructor(e,t){this.unsupportedMethods=e,this.langService=t}isSupported(...e){const t=e.filter((e=>this.unsupportedMethods.includes(e)));if(0===t.length)return!0;throw new S(this.langService.translate("embedded_checkout.unsupported_error",{methods:t.join(", ")}))}}var w=n(55020);const _=["afterpay","applepay","amazonpay","googlepay","klarna","masterpass"];var I=n(69022),P=n(64975),E=n(99838);const O=()=>o.createElement("div",{className:"layout optimizedCheckout-contentPrimary","data-test":"checkout-page-skeleton"},o.createElement("div",{className:"layout-main"},o.createElement("div",{className:"checkout-steps checkout-page-skeleton"},o.createElement("div",{className:"title--first"}),o.createElement("div",{className:"textbox"}),o.createElement("div",{className:"subscription"},o.createElement("div",{className:"checkbox"}),o.createElement("div",{className:"description"})),o.createElement("div",{className:"terms--1"}),o.createElement("div",{className:"terms--2"}),o.createElement("div",{className:"title"}),o.createElement("div",{className:"title"}),o.createElement("div",{className:"title"}))),o.createElement(E.W,null)),A=()=>o.createElement("div",{className:"layout optimizedCheckout-contentPrimary","data-test":"checkout-page-skeleton-mobile"},o.createElement("div",{className:"layout-main "},o.createElement("div",{className:"checkout-page-skeleton"},o.createElement("div",{className:"walletbutton--tagline"}),o.createElement("div",{className:"walletbutton"}),o.createElement("div",{className:"walletbutton--divider"}),o.createElement("div",{className:"mobile-title--first"}),o.createElement("div",{className:"textbox"}),o.createElement("div",{className:"textbox"}),o.createElement("div",{className:"terms--1"}),o.createElement("div",{className:"mobile-title--2"}),o.createElement("div",{className:"divider"}),o.createElement("div",{className:"mobile-title--3"}),o.createElement("div",{className:"divider"}),o.createElement("div",{className:"mobile-title--4"}),o.createElement("div",{className:"divider"}),o.createElement("div",{className:"divider"})),o.createElement("div",{className:"checkout-page-skeleton--cartdrawer"},o.createElement("div",{className:"product"},o.createElement("div",{className:"animated-grey-box figure"}),o.createElement("div",{className:"details"},o.createElement("div",{className:"animated-grey-box name"}),o.createElement("div",{className:"animated-grey-box description"}))),o.createElement("div",{className:"animated-grey-box more"})))),k=()=>(0,P.C3)()?o.createElement(A,null):o.createElement(O,null);var T=n(31635),N=n(3375),M=n.n(N),x=n(69440),D=n(68801),z=n(19445),F=n(90184);const B=(0,z.A)(F.F,{displayNamePrefix:"WithExtension"});var R=n(49655),L=n(68512),j=n(64022);const U=(0,o.memo)((({isLoading:e})=>e?o.createElement("div",{className:"loadingNotification"},o.createElement("div",{className:"loadingNotification-label optimizedCheckout-loadingToaster"},o.createElement("div",{className:"spinner"}),o.createElement("span",{"aria-live":"assertive",className:"label",role:"alert"},o.createElement(R.A,{id:"common.loading_text"})))):null));var V=n(57345),q=n(17986),H=n(17080),G=n(4907),$=n(2398),W=n(74302),Y=n(48447),K=n(91182);const Q=({waitInterval:e,loginUrl:t})=>{const[n,i]=(0,o.useState)(!0);return(0,o.useEffect)((()=>{const t=setTimeout((()=>{i(!1)}),e);return()=>{clearTimeout(t)}}),[e]),o.createElement(K.A,{hideContentWhenLoading:!0,isLoading:n},o.createElement(Y.A,{data:{url:t},id:"cart.empty_cart_message"}))};var J,Z=n(45293),X=n(89792),ee=n(21685),te=n(31689),ne=n(26946);!function(e){e.Guest="guest",e.Login="login",e.SuggestedLogin="suggested_login",e.EnforcedLogin="enforced_login",e.CancellableEnforcedLogin="cancellable_enforced_login",e.CreateAccount="create_account"}(J||(J={}));const ie=J;var re=n(76049),oe=n(24736);const ae=({buttonsCount:e,children:t,isLoading:n})=>{const i=o.createElement("div",{className:"checkoutRemote walletbuttons-skeleton"},Array(e).fill(0).map(((e,t)=>o.createElement("div",{key:`skeleton-container-${t}`}))));return o.createElement(oe.O,{children:t,isLoading:n,renderWhileLoading:!0,skeleton:i})},se=["amazonpay","applepay","chasepay","braintreevisacheckout","braintreepaypal","braintreepaypalcredit","masterpass","paypalcommerce","paypalcommercevenmo","paypalcommercecredit","googlepayadyenv2","googlepayadyenv3","googlepayauthorizenet","googlepaybnz","googlepaybraintree","googlepaycheckoutcom","googlepaycybersourcev2","googlepayorbital","googlepaystripe","googlepaystripeupe","googlepayworldpayaccess","googlepaypaypalcommerce","googlepaytdonlinemart","stripeocs","googlepaystripeocs"],de=e=>e.filter((e=>se.includes(e)));var ce=n(51541);const le=(0,o.lazy)((()=>Promise.all([n.e(2570),n.e(7933),n.e(1474),n.e(3380),n.e(3948)]).then(n.bind(n,38767)).then((e=>({default:e.AmazonPayV2Button}))))),ue=(0,o.lazy)((()=>Promise.all([n.e(2570),n.e(7933),n.e(1474),n.e(1142),n.e(7077),n.e(4136),n.e(1084),n.e(7316)]).then(n.bind(n,31084)).then((e=>({default:e.BigCommercePaymentsButton}))))),he=(0,o.lazy)((()=>Promise.all([n.e(2570),n.e(7933),n.e(1474),n.e(1142),n.e(7077),n.e(4136),n.e(1084),n.e(7316)]).then(n.bind(n,31084)).then((e=>({default:e.BigcommercePaymentsPayLaterButton}))))),me=(0,o.lazy)((()=>n.e(6696).then(n.bind(n,27508)).then((e=>({default:e.CheckoutButton}))))),pe=(0,o.lazy)((()=>Promise.all([n.e(2570),n.e(4576),n.e(4748)]).then(n.bind(n,4576)).then((e=>({default:e.GooglePayButton}))))),ye=(0,o.lazy)((()=>Promise.all([n.e(2570),n.e(7933),n.e(1474),n.e(1142),n.e(7077),n.e(4136),n.e(4159),n.e(2482)]).then(n.bind(n,26540)).then((e=>({default:e.PayPalCommerceCreditButton}))))),ge=(0,o.lazy)((()=>Promise.all([n.e(2570),n.e(7933),n.e(1474),n.e(1142),n.e(7077),n.e(4136),n.e(4159),n.e(2482)]).then(n.bind(n,26540)).then((e=>({default:e.PayPalCommerceButton}))))),ve=(0,o.lazy)((()=>Promise.all([n.e(2570),n.e(7933),n.e(1474),n.e(1142),n.e(9557),n.e(983)]).then(n.bind(n,29557)).then((e=>({default:e.StripeLinkV2Button}))))),fe={AmazonPayV2Button:[{id:"amazonpay"}],BigCommercePaymentsButton:[{id:"bigcommerce_payments"}],BigcommercePaymentsPayLaterButton:[{id:"bigcommerce_payments_paylater"}],GooglePayButton:[{id:"googlepayadyenv2"},{id:"googlepayadyenv3"},{id:"googlepayauthorizenet"},{id:"googlepaybnz"},{id:"googlepaybraintree"},{id:"googlepaypaypalcommerce"},{id:"googlepaycheckoutcom"},{id:"googlepaycybersourcev2"},{id:"googlepayorbital"},{id:"googlepaystripe"},{id:"googlepaystripeupe"},{id:"googlepayworldpayaccess"},{id:"googlepaytdonlinemart"},{id:"googlepaystripeocs"}],PayPalCommerceButton:[{id:"paypalcommerce"}],PayPalCommerceCreditButton:[{id:"paypalcommercecredit"}],StripeLinkV2Button:[{id:"stripeocs"}]};function be(e){const{ComponentRegistry:t}=i,n=(0,T.__rest)(i,["ComponentRegistry"]);return(0,ce.A)(e,n,t)}const Se=(0,o.lazy)((()=>Promise.all([n.e(6968),n.e(1244)]).then(n.bind(n,56773)))),Ce=["paypalcommerce","paypalcommercecredit","paypalcommercevenmo"];const we=(0,o.memo)((0,Z.A)((function({checkoutState:e,checkoutService:t}){var n;const{data:{getConfig:i,getCustomer:r,isPaymentDataRequired:o},statuses:{isInitializedCustomer:a},errors:{getInitializeCustomerError:s}}=e,d=i(),c=null!==(n=null==d?void 0:d.checkoutSettings.remoteCheckoutProviders)&&void 0!==n?n:[],l=de(c),u=r();if(!o())return null;if(!d||0===l.length||!(null==u?void 0:u.isGuest))return null;const h=l.filter((e=>Boolean(s(e))||a(e))).length!==l.length;return{checkoutService:t,checkoutState:e,availableMethodIds:l,isLoading:h}}))((({availableMethodIds:e,checkoutService:t,checkoutState:n,checkEmbeddedSupport:i,isLoading:r,isPaymentStepActive:a,onUnhandledError:s,onWalletButtonClick:d})=>{const{language:c}=(0,re.Y)(),{themeV2:l}=(0,I.w)();try{i(e)}catch(e){return null}return o.createElement("div",{className:"checkout-button-container",style:a?{position:"absolute",left:"0",top:"-100%"}:void 0},o.createElement("p",{className:M()({"sub-header":l})},o.createElement(R.A,{id:"remote.start_with_text"})),o.createElement("div",{className:"checkout-buttons-auto-layout"},o.createElement(ae,{buttonsCount:e.length,isLoading:r},o.createElement("div",{className:"checkoutRemote"},e.map((e=>{if(a&&(e=>Ce.includes(e))(e))return null;const i=be({id:e});return i?o.createElement(o.Suspense,{key:e},o.createElement(i,{checkoutService:t,checkoutState:n,containerId:`${e}CheckoutButton`,language:c,methodId:e,onUnhandledError:s,onWalletButtonClick:d})):o.createElement(o.Suspense,{key:e},o.createElement(Se,{deinitialize:t.deinitializeCustomer,initialize:t.initializeCustomer,isShowingWalletButtonsOnTop:!0,key:e,methodId:e,onClick:d,onError:s}))}))))),o.createElement("div",{className:"checkout-separator"},o.createElement("span",{className:M()({"sub-header":l})},o.createElement(R.A,{id:"remote.or_text"}))))})));var _e=n(39009),Ie=n(98610),Pe=n(91124);var Ee=n(46487),Oe=n(8284);const Ae=(0,o.memo)((({isExecutingPaymentMethodCheckout:e,methodId:t,deinitializeCustomer:n,executePaymentMethodCheckout:i,initializeCustomer:r,onUnhandledError:a=x.noop})=>{const[s,d]=(0,o.useState)(!1),{analyticsTracker:c}=(0,_e.A)();if((0,o.useEffect)((()=>{n({methodId:t});try{r({methodId:t,integrations:[Pe.z2],bolt:{onInit:(e,t)=>{d(e),t&&c.customerSuggestionInit({hasBoltAccount:e})}}})}catch(e){a(e)}return()=>{n({methodId:t})}}),[r,n,t,a]),!s)return null;return o.createElement("div",{className:"checkoutSuggestion",onClick:e=>{e.stopPropagation(),l&&l(e)}},o.createElement("p",{className:"checkoutSuggestion-message"},o.createElement(R.A,{data:{provider:"Bolt",providerFlow:"Bolt Checkout"},id:"customer.suggestion_text"})),o.createElement(Ee.Ay,{className:"checkoutSuggestion-button checkoutSuggestion-button--bolt","data-test":"suggestion-action-button",isLoading:e,onClick:()=>(0,T.__awaiter)(void 0,void 0,void 0,(function*(){yield i({methodId:t})}))},o.createElement(Oe.A,{additionalClassName:"checkoutSuggestion-button-icon--bolt"}),o.createElement(R.A,{data:{providerFlow:"Bolt Checkout"},id:"customer.suggestion_action"})));var l})),ke=(0,Z.A)((({checkoutService:e,checkoutState:t})=>{const{data:{getCheckout:n,getConfig:i},statuses:{isExecutingPaymentMethodCheckout:r}}=t,o=n(),a=i();return o&&a?{deinitializeCustomer:e.deinitializeCustomer,executePaymentMethodCheckout:e.executePaymentMethodCheckout,initializeCustomer:e.initializeCustomer,isExecutingPaymentMethodCheckout:r(),providerWithCustomCheckout:a.checkoutSettings.providerWithCustomCheckout||void 0}:null}))((0,o.memo)((e=>{var{providerWithCustomCheckout:t,executePaymentMethodCheckout:n}=e,i=(0,T.__rest)(e,["providerWithCustomCheckout","executePaymentMethodCheckout"]);const{analyticsTracker:r}=(0,_e.A)(),a=e=>(r.customerSuggestionExecute(),n(e));return t===Ie.A.Bolt?o.createElement(Ae,Object.assign({executePaymentMethodCheckout:a,methodId:t},i)):null}))),Te=["amazonpay"],Ne=e=>Te.includes(e);function Me(e,t,n){return!!Ne(n)||!e.isGuest&&(0,x.every)(t.payments,(e=>!se.includes(e.providerId)))}const xe=(0,Z.A)((function({checkoutService:e,checkoutState:t}){const{data:{getBillingAddress:n,getCheckout:i,getCustomer:r,getConfig:o},statuses:{isSigningOut:a}}=t,s=n(),d=i(),c=r(),l=o();if(!(s&&d&&c&&l))return null;const{checkoutSettings:u,links:{checkoutLink:h,logoutLink:m}}=l,p=d.payments&&1===d.payments.length?d.payments[0].providerId:"";return{email:s.email||c.email,methodId:p,isSignedIn:Me(c,d,p),isSigningOut:a(),logoutLink:m,checkoutLink:h,shouldRedirectToStorefrontForAuth:u.shouldRedirectToStorefrontForAuth,signOut:e.signOutCustomer}}))((({checkoutLink:e,email:t,methodId:n,isSignedIn:i,isSigningOut:r,logoutLink:a,shouldRedirectToStorefrontForAuth:s,onSignOut:d=x.noop,onSignOutError:c=x.noop,signOut:l})=>{const{themeV2:u}=(0,I.w)();return o.createElement("div",{className:"customerView","data-test":"checkout-customer-info"},o.createElement("div",{className:M()("customerView-body",{"body-regular":u}),"data-test":"customer-info"},t),o.createElement("div",{className:"customerView-actions"},i&&o.createElement(Ee.Ay,{className:u?"body-regular":"",isLoading:r,onClick:()=>(0,T.__awaiter)(void 0,void 0,void 0,(function*(){try{if(s)return void window.location.assign(`${a}?redirectTo=${e}`);Ne(n)?(yield l({methodId:n}),d({isCartEmpty:!1}),window.location.reload()):(yield l(),d({isCartEmpty:!1}))}catch(e){(0,X.A)(e)&&"checkout_not_available"===e.type?d({isCartEmpty:!0}):c(e)}})),size:Ee.Mp.Tiny,testId:"sign-out-link",variant:Ee.Ak.Secondary},o.createElement(R.A,{id:"customer.sign_out_action"}))))}));var De=n(14900),ze=n(25119),Fe=n(11982),Be=n(63054),Re=n(69462),Le=n(72769),je=n(41410),Ue=n(71161),Ve=n(11889),qe=n(4899),He=n(60833),Ge=n(44218),$e=n(94202),We=n(10685);const Ye=/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i;function Ke({language:e}){return(0,$e.Ik)({email:(0,$e.Yj)().max(256).matches(Ye,e.translate("customer.email_invalid_error")).required(e.translate("customer.email_required_error"))})}function Qe(e){return(t,{label:n,min:i,max:r})=>{if(e)return"required"===t?e.translate("customer.required_error",{label:n}):"max"===t&&r?e.translate("customer.max_error",{label:n,max:r}):"min"===t&&i?e.translate("customer.min_error",{label:n,min:i}):"invalid"===t?e.translate("customer.invalid_characters_error",{label:n}):void 0}}const Je=(0,Ge.Bj)((function({formFields:e,language:t,passwordRequirements:{description:n,numeric:i,alpha:r,minLength:o}}){return(0,$e.Ik)({firstName:(0,$e.Yj)().required(t.translate("address.first_name_required_error")),lastName:(0,$e.Yj)().required(t.translate("address.last_name_required_error")),password:(0,$e.Yj)().required(t.translate("customer.password_required_error")||n).matches(i,t.translate("customer.password_number_required_error")||n).matches(r,t.translate("customer.password_letter_required_error")||n).min(o,t.translate("customer.password_under_minimum_length_error")||n).max(100,t.translate("customer.password_over_maximum_length_error"))}).concat(Ke({language:t})).concat((0,We.A)({formFields:e,translate:Qe(t)}))}));var Ze=n(23847);function Xe(e,t){return e?["1"]:t?[]:["0"]}const et=(0,L.A)((0,Re.bk)({handleSubmit:(e,{props:{onSubmit:t=x.noop}})=>{t(e)},mapPropsToValues:({defaultShouldSubscribe:e,requiresMarketingConsent:t})=>({firstName:"",lastName:"",email:"",password:"",customFields:{},acceptsMarketingEmails:Xe(e,t)}),validationSchema:({language:e,formFields:t})=>{var n;const i=null===(n=t.find((({requirements:e})=>e)))||void 0===n?void 0:n.requirements;if(!i)throw new Error("Password requirements missing");return Je({language:e,formFields:t,passwordRequirements:(0,Ze.A)(i)})}})((({formFields:e,createAccountError:t,isCreatingAccount:n,isExecutingPaymentMethodCheckout:i,onCancel:r,isFloatingLabelEnabled:a,defaultShouldSubscribe:s})=>{const{themeV2:d}=(0,I.w)(),c=(0,o.useMemo)((()=>{if(t){if((0,Ue.A)(t)&&409===t.status){const e=t.message.split(":");return e.length>1?o.createElement(R.A,{data:{email:e[1].trim()},id:"customer.email_in_use_text"}):o.createElement(R.A,{id:"customer.unknown_email_in_use_text"})}return t.message}}),[t]),l=function(e,t){return e.map((e=>{if("acceptsMarketingEmails"===e.name){const{options:n}=e,i=((null==n?void 0:n.items)||[]).map((e=>({value:t?"1":e.value,label:e.label})));return Object.assign(Object.assign({},e),{options:{items:i}})}return e}))}(e,s);return o.createElement(qe.A,{className:"checkout-form",id:"checkout-customer-returning",testId:"checkout-customer-returning"},o.createElement(He.A,null,c&&o.createElement(Ve.A,{type:Ve.v.Error},c),o.createElement("div",{className:"create-account-form"},l.map((e=>o.createElement(je.A,{autocomplete:e.name,extraClass:`dynamic-form-field--${e.name}`,field:e,isFloatingLabelEnabled:a,key:e.id,parentFieldName:e.custom?"customFields":void 0,themeV2:d}))))),o.createElement("div",{className:"form-actions"},o.createElement(Ee.Ay,{className:d?"body-bold":"",disabled:n||i,id:"checkout-customer-create",isLoading:n||i,testId:"customer-continue-create",type:"submit",variant:Ee.Ak.Primary},o.createElement(R.A,{id:"customer.create_account_action"})),o.createElement("a",{className:M()("button optimizedCheckout-buttonSecondary",{"body-bold":d}),"data-test":"customer-cancel-button",href:"#",id:"checkout-customer-cancel",onClick:(0,Le.A)(r)},o.createElement(R.A,{id:"common.cancel_action"}))))})));var tt=n(77546);const nt=({data:e,id:t,onClick:n,testId:i})=>{const{language:r}=(0,re.Y)(),a=r.translate(t,e),s=(0,tt.A)(a);return s.length?o.createElement(o.Fragment,null,s[0],o.createElement("a",{"data-test":i,href:"#",onClick:(0,Le.A)(n)},s[1]),s[2]):o.createElement(o.Fragment,null,a)};var it=n(85814),rt=n(92909),ot=n(58330),at=n(54454),st=n(22375);const dt=(0,o.memo)((({onChange:e,isFloatingLabelEnabled:t})=>{const{themeV2:n}=(0,I.w)(),i=(0,o.useCallback)((e=>o.createElement(at.A,Object.assign({},e.field,{autoComplete:e.field.name,id:e.field.name,isFloatingLabelEnabled:t,themeV2:n,type:"email"}))),[t]),r=(0,o.useMemo)((()=>o.createElement(R.A,{id:"customer.email_label"})),[]);return o.createElement(st.A,{input:i,isFloatingLabelEnabled:t,labelContent:r,name:"email",onChange:e,themeV2:n})})),ct=(0,L.A)((0,Re.bk)({mapPropsToValues:({email:e=""})=>({email:e}),handleSubmit:(e,{props:{onSendLoginEmail:t=x.noop}})=>{t(e)},validationSchema:({language:e})=>Ke({language:e})})((0,o.memo)((({email:e,isOpen:t,isSendingEmail:n=!1,emailHasBeenRequested:i,onRequestClose:r=x.noop,sentEmailError:a,sentEmail:s,submitForm:d,isFloatingLabelEnabled:c,values:{email:l}})=>{const u=(0,o.useMemo)((()=>i?a?"common.error_heading":"login_email.sent_header":e?"login_email.header_with_email":"login_email.header"),[i,a,e]),h=(0,o.useMemo)((()=>o.createElement("div",{className:"modal-footer"},o.createElement(Ee.Ay,{onClick:r},o.createElement(R.A,{id:"common.ok_action"})))),[r]),m=(0,o.useMemo)((()=>a&&429===a.status?h:i&&!a?n?o.createElement(it.A,{isLoading:!0}):s&&"reset_password"===s.sent_email?h:o.createElement("p",null,o.createElement(nt,{id:"login_email.resend_link",onClick:d}),o.createElement(nt,{id:"login_email.use_password_link",onClick:r})):o.createElement("div",{className:"modal-footer"},o.createElement(Ee.Ay,{className:"optimizedCheckout-buttonSecondary",onClick:r,type:"button"},o.createElement(R.A,{id:"common.cancel_action"})),o.createElement(Ee.Ay,{isLoading:n,type:"submit",variant:Ee.Ak.Primary},o.createElement(R.A,{id:"login_email.send"})))),[a,i,h,d,n,r,s]),p=(0,o.useMemo)((()=>{if(!a)return null;const{status:e}=a;return o.createElement(Ve.A,{type:Ve.v.Error},429===e?o.createElement(R.A,{id:"login_email.error_temporary_disabled"}):o.createElement(R.A,{id:404===e?"login_email.error_not_found":"login_email.error_server"}))}),[a]),y=(0,o.useMemo)((()=>{if(a&&429===a.status)return null;if(i&&s&&!a){const{expiry:e,sent_email:t}=s;return o.createElement("p",null,o.createElement(Y.A,{data:{minutes:Math.round(e/60)},id:"sign_in"===t?"login_email.sent_text":"customer.reset_password_before_login_error"}))}return i&&!s?o.createElement(dt,{isFloatingLabelEnabled:c}):o.createElement(o.Fragment,null,o.createElement("p",null,o.createElement(R.A,{id:"login_email.text"})),o.createElement(dt,{isFloatingLabelEnabled:c}))}),[a,i,s,l]);return o.createElement(rt.A,{additionalBodyClassName:"modal--withText",additionalModalClassName:"modal--medium",header:o.createElement(ot.A,null,o.createElement(R.A,{id:u})),isOpen:t,onRequestClose:r,shouldShowCloseButton:!0},o.createElement(qe.A,null,o.createElement(it.A,{isLoading:n&&!e}),p,y,m))}))));var lt=n(77050),ut=n(28058),ht=n(39981),mt=n(82922),pt=n(12402);const yt=(0,o.lazy)((()=>Promise.all([n.e(6968),n.e(1244)]).then(n.bind(n,56773))));const gt=(0,o.memo)((0,Z.A)((function({checkoutState:e,checkoutService:t}){return{checkoutService:t,checkoutState:e}}))((({checkoutService:e,checkoutState:t,hideText:n=!1,isInitializing:i=!1,methodIds:r=[],checkEmbeddedSupport:a,deinitialize:s,initialize:d,onClick:c=x.noop,onError:l})=>{const{language:u}=(0,re.Y)(),h=de(r);if(0===h.length)return null;if(a)try{a(h)}catch(e){if(!(e instanceof Error&&l))throw e;return l(e),null}return o.createElement(o.Fragment,null,!i&&!n&&o.createElement("p",null,o.createElement(R.A,{id:"remote.continue_with_text"})),o.createElement("div",{className:"checkoutRemote"},h.map((n=>{const i=be({id:n});return i?o.createElement(V.A,{key:n},o.createElement(i,{checkoutService:e,checkoutState:t,containerId:`${n}CheckoutButton`,language:u,methodId:n,onUnhandledError:c,onWalletButtonClick:c})):o.createElement(V.A,{key:n},o.createElement(yt,{deinitialize:s,initialize:d,isShowingWalletButtonsOnTop:!1,key:n,methodId:n,onClick:c,onError:c}))}))))})));var vt=n(87647);function ft(e){return e.hasOwnProperty("paypalFastlane")||e.hasOwnProperty("braintreeFastlane")}const bt=()=>{var e,t;const{checkoutState:n}=(0,ht.Q)(),{getPaymentMethod:i,getConfig:r}=n.data,a=(null===(e=r())||void 0===e?void 0:e.checkoutSettings.providerWithCustomCheckout)||"",s=!!a&&(0,mt.A)(a)&&i(a),d=ft(window)&&!!s&&!!(null===(t=s.initializationData)||void 0===t?void 0:t.isFastlanePrivacySettingEnabled);return(0,o.useEffect)((()=>{if(d&&ft(window)){((0,vt.A)(a)?window.braintreeFastlane:window.paypalFastlane).FastlaneWatermarkComponent({includeAdditionalInfo:!0}).then((e=>{e.render("#paypalFastlaneWatermark")}))}}),[]),d?o.createElement("div",{className:"paypalFastlaneWatermark-container"},o.createElement("div",{"data-test":"paypalFastlaneWatermark",id:"paypalFastlaneWatermark"})):o.createElement(o.Fragment,null)};var St=n(37958);const Ct=({url:e,themeV2:t})=>o.createElement(St.A,{labelContent:o.createElement(Y.A,{data:{url:e},id:"privacy_policy.label"}),name:"privacyPolicy",testId:"privacy-policy-checkbox",themeV2:t}),wt=({url:e,themeV2:t})=>o.createElement(He.A,{additionalClassName:"checkout-privacy-policy"},o.createElement(Ct,{themeV2:t,url:e})),_t=({url:e,themeV2:t})=>o.createElement("p",{className:t?"body-regular":""},o.createElement(Y.A,{data:{url:e},id:"privacy_policy_auto_consent.label"})),It=(0,o.memo)((({url:e,isExpressPrivacyPolicy:t})=>{const{themeV2:n}=(0,I.w)();return t?o.createElement(_t,{themeV2:n,url:e}):o.createElement(wt,{themeV2:n,url:e})}));function Pt({isRequired:e,language:t}){const n={};return e&&(n.privacyPolicy=(0,$e.zM)().oneOf([!0],t.translate("privacy_policy.required_error"))),(0,$e.Ik)(n)}var Et=n(43586),Ot=n(29853),At=n(34953),kt=n(28407);const Tt=(0,o.memo)((({field:e,requiresMarketingConsent:t})=>{const{themeV2:n}=(0,I.w)();return o.createElement(o.Fragment,null,o.createElement(At.A,Object.assign({},e,{checked:e.value,className:"form-checkbox",id:e.name,testId:"should-subscribe-checkbox",type:"checkbox",value:String(e.value)})),o.createElement(kt.A,{additionalClassName:n?"body-regular":"",htmlFor:e.name},o.createElement(Y.A,{id:t?"customer.guest_marketing_consent":"customer.guest_subscribe_to_newsletter_text"})))}));class Nt{static setSubscribeStatus(e){sessionStorage.setItem(this.key,`${e}`)}static getSubscribeStatus(){return"true"===sessionStorage.getItem(this.key)}static removeSubscribeStatus(){sessionStorage.removeItem(this.key)}}function Mt(e,t){return!!Nt.getSubscribeStatus()||!e&&t}Nt.key="shouldSubscribe";const xt=(0,L.A)((0,Re.bk)({mapPropsToValues:({email:e="",defaultShouldSubscribe:t=!1,requiresMarketingConsent:n})=>({email:e,shouldSubscribe:Mt(n,t),privacyPolicy:!1}),handleSubmit:(e,{props:{onContinueAsGuest:t}})=>{t(e)},validationSchema:({language:e,privacyPolicyUrl:t,isExpressPrivacyPolicy:n})=>{const i=(0,$e.Yj)().email(e.translate("customer.email_invalid_error")).max(256).required(e.translate("customer.email_required_error")),r=(0,$e.Ik)({email:i});return t&&!n?r.concat(Pt({isRequired:!!t,language:e})):r}})((0,o.memo)((({canSubscribe:e,checkoutButtons:t,continueAsGuestButtonLabelId:n,defaultShouldSubscribe:i,isLoading:r,onChangeEmail:a,onShowLogin:s,privacyPolicyUrl:d,requiresMarketingConsent:c,isExpressPrivacyPolicy:l,isFloatingLabelEnabled:u,shouldShowEmailWatermark:h,setFieldValue:m})=>{const{checkoutState:{data:{getConfig:p}}}=(0,ht.Q)(),{themeV2:y}=(0,I.w)(),g=p(),v=(0,o.useCallback)((e=>o.createElement(Tt,Object.assign({},e,{requiresMarketingConsent:c}))),[c]);if((0,o.useEffect)((()=>{m("shouldSubscribe",Mt(c,i))}),[c,i]),!g)return null;const{checkoutSettings:{shouldRedirectToStorefrontForAuth:f},links:{checkoutLink:b,loginLink:S}}=g;return o.createElement(qe.A,{className:"checkout-form",id:"checkout-customer-guest",testId:"checkout-customer-guest"},o.createElement(He.A,{legend:o.createElement(Et.A,{hidden:!0},o.createElement(R.A,{id:"customer.guest_customer_text"}))},o.createElement("div",{className:"customerEmail-container"},o.createElement("div",{className:"customerEmail-body"},o.createElement(dt,{isFloatingLabelEnabled:u,onChange:a}),h&&o.createElement(bt,null),(e||c)&&o.createElement(Ot.A,{name:"shouldSubscribe",render:v})),o.createElement("div",{className:M()("form-actions customerEmail-action",{"customerEmail-floating--enabled":u})},o.createElement(Ee.Ay,{className:M()("customerEmail-button",{"body-bold":y}),id:"checkout-customer-continue",isLoading:r,testId:"customer-continue-as-guest-button",type:"submit",variant:Ee.Ak.Primary},o.createElement(R.A,{id:n})))),d&&o.createElement(It,{isExpressPrivacyPolicy:l,url:d}),!r&&o.createElement("p",{className:M()("customer-login-link",{"body-regular":y})},o.createElement(R.A,{id:"customer.login_text"})," ",o.createElement("a",{"data-test":"customer-continue-button",id:"checkout-customer-login",onClick:()=>{if(!f)return s();window.location.assign(`${S}?redirectTo=${b}`)},role:"button",tabIndex:0},o.createElement(R.A,{id:"customer.login_action"}))),t))}))));var Dt=n(59713);const zt=(0,L.A)((0,Re.bk)({mapPropsToValues:({email:e="",defaultShouldSubscribe:t=!1,requiresMarketingConsent:n})=>({email:e,shouldSubscribe:!n&&t,privacyPolicy:!1}),handleSubmit:(e,{setStatus:t})=>{t({valSuccess:!0,shouldSubscribe:e.shouldSubscribe})},validationSchema:({language:e,privacyPolicyUrl:t,isExpressPrivacyPolicy:n})=>t&&!n?Pt({isRequired:!!t,language:e}):(0,$e.Ik)({})})((0,o.memo)((({continueAsGuestButtonLabelId:e,isLoading:t,initialize:n,isExpressPrivacyPolicy:i,deinitialize:r,onChangeEmail:a,onShowLogin:s,onContinueAsGuest:d,canSubscribe:c,checkoutButtons:l,defaultShouldSubscribe:u,requiresMarketingConsent:h,privacyPolicyUrl:m,step:p,status:y,setFieldValue:g})=>{const[v,f]=(0,o.useState)(!0),[b,S]=(0,o.useState)(""),[C,w]=(0,o.useState)(!1),[_,I]=(0,o.useState)(!0),[P,E]=(0,o.useState)(!1),O=()=>{d({email:b,shouldSubscribe:!!(null==y?void 0:y.shouldSubscribe)})},A=(0,o.useCallback)(((e,t)=>{g("email",t),a(t),S(t),f(!t),w(e),e||E(!0)}),[f,a]);(0,o.useEffect)((()=>{(!p.isComplete||P)&&b&&C&&O()}),[b,C,P]),(0,o.useEffect)((()=>{(null==y?void 0:y.valSuccess)&&O()}),[null==y?void 0:y.valSuccess]);const k=(0,o.useCallback)((e=>{I(e)}),[]);(0,o.useEffect)((()=>(n({methodId:"stripeupe",integrations:[Be.Tv],stripeupe:{container:"stripeupeLink",onEmailChange:A,isLoading:k,getStyles:M,gatewayId:"stripeupe",methodId:"card"}}),()=>{r({methodId:"stripeupe"})})),[]),(0,o.useEffect)((()=>{g("shouldSubscribe",!h&&u)}),[h,u]);const T=(e,t)=>{const n=document.getElementById(e);if(n)return(0,Dt.A)(n,t)},N="stripe-card-component-field",M=(0,o.useCallback)((()=>{const e=T(`${N}--input`,["color","background-color","border-color","box-shadow"]),t=T(`${N}--label`,["color"]),n=T(`${N}--error`,["color"]);return t&&e&&n?{labelText:t.color,fieldText:e.color,fieldPlaceholderText:e.color,fieldErrorText:n.color,fieldBackground:e["background-color"],fieldInnerShadow:e["box-shadow"],fieldBorder:e["border-color"]}:void 0}),[]),x=(0,o.useCallback)((e=>o.createElement(Tt,Object.assign({},e,{requiresMarketingConsent:h}))),[h]),D=C&&!P?"customer.continue_as_stripe_customer_action":e;return o.createElement(o.Fragment,null,o.createElement(qe.A,{className:"checkout-form",id:"checkout-customer-guest",testId:"checkout-customer-guest"},o.createElement("div",{className:"checkout-form",style:{display:_?"none":void 0}},o.createElement(He.A,{legend:!C&&o.createElement(Et.A,{hidden:!0},o.createElement(R.A,{id:"customer.guest_customer_text"}))},o.createElement("div",{className:"customerEmail-container"},o.createElement("div",{className:"customerEmail-body"},o.createElement("div",{id:"stripeupeLink"}),o.createElement("br",null),(c||h)&&o.createElement(Ot.A,{name:"shouldSubscribe",render:x})),o.createElement("div",{className:"form-actions customerEmail-action"},(!C||C&&!P)&&o.createElement(Ee.Ay,{className:"stripeCustomerEmail-button",disabled:v,id:"stripe-checkout-customer-continue",isLoading:t,testId:"stripe-customer-continue-as-guest-button",type:"submit",variant:Ee.Ak.Primary},o.createElement(R.A,{id:D})))),m&&o.createElement(It,{isExpressPrivacyPolicy:i,url:m}),!t&&o.createElement("p",null,o.createElement(R.A,{id:"customer.login_text"})," ",o.createElement("a",{"data-test":"customer-continue-button",id:"checkout-customer-login",onClick:s,role:"button",tabIndex:0},o.createElement(R.A,{id:"customer.login_action"}))),!C&&l)),o.createElement("div",{className:"optimizedCheckout-form-input",id:`${N}--input`},o.createElement("div",{className:"form-field--error"},o.createElement("div",{className:"optimizedCheckout-form-label",id:`${N}--error`})),o.createElement("div",{className:"optimizedCheckout-form-label",id:`${N}--label`}))))}))));const Ft=({email:e,isFloatingLabelEnabled:t,isWalletButtonsOnTop:n,isSubscribed:i,step:r,checkEmbeddedSupport:a,handleChangeEmail:s,handleContinueAsGuest:d,handleShowLogin:c,onWalletButtonClick:l,onUnhandledError:u})=>{const{checkoutState:h,checkoutService:m}=(0,ht.Q)(),{data:{isPaymentDataRequired:p,getConfig:y,getCart:g},statuses:{isInitializingCustomer:v,isContinuingAsGuest:f,isExecutingPaymentMethodCheckout:b}}=h,{deinitializeCustomer:S,initializeCustomer:C}=m,w=y(),_=g(),I=f()||b();if(!w||!_)return null;const{checkoutSettings:{privacyPolicyUrl:P,requiresMarketingConsent:E,remoteCheckoutProviders:O,providerWithCustomCheckout:A,isExpressPrivacyPolicy:k},shopperConfig:{showNewsletterSignup:T}}=w,N=(0,pt.A)(A),M=n||!p()?null:o.createElement(gt,{checkEmbeddedSupport:a,deinitialize:S,initialize:C,isInitializing:v(),methodIds:O,onClick:l,onError:u});return function(e,t){return t===ut.A.StripeUPE&&(0,lt.A)(e)}(_,N)?o.createElement(zt,{canSubscribe:T,checkoutButtons:M,continueAsGuestButtonLabelId:"customer.continue",defaultShouldSubscribe:i,deinitialize:S,email:e,initialize:C,isExpressPrivacyPolicy:k,isLoading:f()||v()||b(),onChangeEmail:s,onContinueAsGuest:d,onShowLogin:c,privacyPolicyUrl:P,requiresMarketingConsent:E,step:r}):o.createElement(xt,{canSubscribe:T,checkoutButtons:M,continueAsGuestButtonLabelId:"customer.continue",defaultShouldSubscribe:i,email:e,isExpressPrivacyPolicy:k,isFloatingLabelEnabled:t,isLoading:I,onChangeEmail:s,onContinueAsGuest:d,onShowLogin:c,privacyPolicyUrl:P,requiresMarketingConsent:E,shouldShowEmailWatermark:(0,mt.A)(N)})};var Bt=n(45080);const Rt=(0,Bt.A)((()=>o.createElement("svg",{viewBox:"0 0 576 512",xmlns:"http://www.w3.org/2000/svg"},o.createElement("path",{d:"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"})))),Lt=(0,Bt.A)((()=>o.createElement("svg",{viewBox:"0 0 640 512",xmlns:"http://www.w3.org/2000/svg"},o.createElement("path",{d:"M634 471L36 3.51A16 16 0 0 0 13.51 6l-10 12.49A16 16 0 0 0 6 41l598 467.49a16 16 0 0 0 22.49-2.49l10-12.49A16 16 0 0 0 634 471zM296.79 146.47l134.79 105.38C429.36 191.91 380.48 144 320 144a112.26 112.26 0 0 0-23.21 2.47zm46.42 219.07L208.42 260.16C210.65 320.09 259.53 368 320 368a113 113 0 0 0 23.21-2.46zM320 112c98.65 0 189.09 55 237.93 144a285.53 285.53 0 0 1-44 60.2l37.74 29.5a333.7 333.7 0 0 0 52.9-75.11 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64c-36.7 0-71.71 7-104.63 18.81l46.41 36.29c18.94-4.3 38.34-7.1 58.22-7.1zm0 288c-98.65 0-189.08-55-237.93-144a285.47 285.47 0 0 1 44.05-60.19l-37.74-29.5a333.6 333.6 0 0 0-52.89 75.1 32.35 32.35 0 0 0 0 29.19C89.72 376.41 197.08 448 320 448c36.7 0 71.71-7.05 104.63-18.81l-46.41-36.28C359.28 397.2 339.89 400 320 400z"}))));var jt=n(45707);const Ut=(0,o.memo)((({isFloatingLabelEnabled:e=!1})=>{const{themeV2:t}=(0,I.w)(),n=(0,o.useCallback)((n=>o.createElement(jt.A,{openByDefault:!1},(({isOpen:i,toggle:r})=>o.createElement("div",{className:"form-field-password"},o.createElement(at.A,Object.assign({},n.field,{additionalClassName:"form-input--withIcon",id:n.field.name,isFloatingLabelEnabled:e,themeV2:t,type:i?"text":"password"})),e&&o.createElement(kt.A,{additionalClassName:t?"floating-form-field-label":"",htmlFor:n.field.name,id:`${n.field.name}-label`,isFloatingLabelEnabled:!0},o.createElement(R.A,{id:"customer.password_label"})),o.createElement("a",{className:"form-toggle-password form-input-icon",href:"#",onClick:r},i?o.createElement(Rt,null):o.createElement(Lt,null)))))),[e]),i=(0,o.useMemo)((()=>o.createElement(R.A,{id:"customer.password_label"})),[]);return o.createElement(st.A,{input:n,isFloatingLabelEnabled:e,labelContent:e?null:i,name:"password"})}));var Vt=n(63163);const qt=({isDisabled:e,isLoading:t})=>{const{themeV2:n}=(0,I.w)(),{checkoutState:{data:{getConfig:i}}}=(0,ht.Q)(),r=i();if(!r)return null;const{checkoutLink:a,loginLink:s}=r.links;return o.createElement(Vt.Ay,{className:n?"body-bold":"",disabled:e,id:"checkout-customer-continue",isLoading:t,onClick:()=>window.location.assign(`${s}?redirectTo=${a}`),testId:"customer-continue-button",variant:Vt.Ak.Primary},o.createElement(R.A,{id:"customer.sign_in_action"}))},Ht=(0,L.A)((0,Re.bk)({mapPropsToValues:({email:e=""})=>({email:e,password:""}),handleSubmit:(e,{props:{onSignIn:t}})=>{t(e)},validationSchema:({language:e})=>Ke({language:e}).concat((0,$e.Ik)({password:(0,$e.Yj)().required(e.translate("customer.password_required_error"))}))})((0,o.memo)((({continueAsGuestButtonLabelId:e,email:t,isEmbedded:n,language:i,signInError:r,onCancel:a=x.noop,onChangeEmail:s,onContinueAsGuest:d,onCreateAccount:c=x.noop,onSendLoginEmail:l=x.noop,isFloatingLabelEnabled:u,viewType:h=ie.Login})=>{const{themeV2:m}=(0,I.w)(),{checkoutState:p}=(0,ht.Q)(),{data:{getCart:y,getConfig:g},statuses:{isExecutingPaymentMethodCheckout:v,isSigningIn:f}}=p,b=y(),S=g();if(!b||!S)throw new Error("cart is not available");const{checkoutSettings:{isAccountCreationEnabled:C,isSignInEmailEnabled:w,guestCheckoutEnabled:_,shouldRedirectToStorefrontForAuth:P},links:{forgotPasswordLink:E}}=S,O="BUY_NOW"===b.source,A=(0,o.useCallback)((()=>t?o.createElement("p",{className:"optimizedCheckout-contentSecondary"},o.createElement(nt,{data:{email:t},id:"customer.guest_could_login_change_email",onClick:a,testId:"change-email"})):null),[t,a]);return o.createElement(qe.A,{className:"checkout-form",id:"checkout-customer-returning",testId:"checkout-customer-returning"},o.createElement(He.A,{legend:o.createElement(Et.A,{hidden:!0},o.createElement(R.A,{id:"customer.returning_customer_text"}))},r&&o.createElement(Ve.A,{testId:"customer-login-error-message",type:Ve.v.Error},function(e,t){switch(e.body&&e.body.type){case"throttled_login":return t("customer.sign_in_throttled_error");case"reset_password_before_login":return t("customer.reset_password_before_login_error");case"empty_cart":return t("cart.empty_cart_error_message");default:return t("customer.sign_in_error")}}(r,(e=>i.translate(e)))),h===ie.SuggestedLogin&&o.createElement(Ve.A,{type:Ve.v.Info},o.createElement(Y.A,{data:{email:t},id:"customer.guest_could_login"})),h===ie.CancellableEnforcedLogin&&o.createElement(Ve.A,{type:Ve.v.Info},o.createElement(Y.A,{data:{email:t},id:"customer.guest_must_login"})),h===ie.EnforcedLogin&&o.createElement(Ve.A,{type:Ve.v.Error},o.createElement(nt,{id:"customer.guest_temporary_disabled",onClick:c})),(h===ie.Login||h===ie.EnforcedLogin)&&o.createElement(dt,{isFloatingLabelEnabled:u,onChange:s}),!P&&o.createElement(Ut,{isFloatingLabelEnabled:u}),o.createElement("p",{className:M()("form-legend-container",{"body-cta":m})},o.createElement("span",null,w&&!n&&!O&&o.createElement(nt,{id:"login_email.link",onClick:l,testId:"customer-signin-link"}),!w&&!n&&!P&&o.createElement("a",{"data-test":"forgot-password-link",href:E,rel:"noopener noreferrer",target:"_blank"},o.createElement(R.A,{id:"customer.forgot_password_action"}))),h===ie.Login&&C&&o.createElement("span",null,o.createElement(nt,{id:"customer.create_account_to_continue_text",onClick:c}))),o.createElement("div",{className:"form-actions"},P?o.createElement(qt,{isDisabled:Boolean(f()||v()),isLoading:Boolean(f()||v())}):o.createElement(Ee.Ay,{className:m?"body-bold":"",disabled:f()||v(),id:"checkout-customer-continue",isLoading:f()||v(),testId:"customer-continue-button",type:"submit",variant:Ee.Ak.Primary},o.createElement(R.A,{id:"customer.sign_in_action"})),h===ie.SuggestedLogin&&o.createElement("a",{className:M()("button optimizedCheckout-buttonSecondary",{"body-bold":m}),"data-test":"customer-guest-continue",href:"#",id:"checkout-guest-continue",onClick:(0,Le.A)(d)},o.createElement(R.A,{id:e})),_&&h!==ie.EnforcedLogin&&h!==ie.SuggestedLogin&&o.createElement("a",{className:M()("button optimizedCheckout-buttonSecondary",{"body-bold":m}),"data-test":"customer-cancel-button",href:"#",id:"checkout-customer-cancel",onClick:(0,Le.A)(a)},o.createElement(R.A,{id:h===ie.CancellableEnforcedLogin?"login_email.use_another_email":"common.cancel_action"}))),h===ie.SuggestedLogin&&A()))}))));var Gt=n(6663);var $t=n(84559);const Wt=({viewType:e,step:t,isEmbedded:n,isSubscribed:i,isWalletButtonsOnTop:r,onChangeViewType:a=x.noop,onAccountCreated:s=x.noop,onContinueAsGuest:d=x.noop,onContinueAsGuestError:c=x.noop,onReady:l=x.noop,onSubscribeToNewsletter:u,onSignIn:h=x.noop,onSignInError:m=x.noop,onUnhandledError:p=x.noop,onWalletButtonClick:y=x.noop})=>{const[g,v]=(0,o.useState)({isEmailLoginFormOpen:!1,isReady:!1,hasRequestedLoginEmail:!1,draftEmail:void 0}),{analyticsTracker:f}=(0,_e.A)(),b=(()=>{const{checkoutState:e,checkoutService:t}=(0,ht.Q)(),{data:{getBillingAddress:n,getCustomerAccountFields:i,getCheckout:r,getCustomer:o,getCart:a,getSignInEmail:s,getConfig:d,isPaymentDataRequired:c},errors:{getSignInError:l,getSignInEmailError:u,getCreateCustomerAccountError:h},statuses:{isContinuingAsGuest:m,isExecutingPaymentMethodCheckout:p,isInitializingCustomer:y,isSigningIn:g,isSendingSignInEmail:v,isCreatingCustomerAccount:f}}=e,b=n(),S=r(),C=o(),w=a(),_=s(),I=d();if(!S||!I||!w)return{data:{},actions:{}};const{checkoutSettings:{privacyPolicyUrl:P,requiresMarketingConsent:E,isSignInEmailEnabled:O,isAccountCreationEnabled:A,isExpressPrivacyPolicy:k,shouldRedirectToStorefrontForAuth:T,remoteCheckoutProviders:N,providerWithCustomCheckout:M},shopperConfig:{showNewsletterSignup:x,defaultNewsletterSignup:D},links:{forgotPasswordLink:z}}=I,F=(0,pt.A)(M);return{data:{email:(null==b?void 0:b.email)||(null==C?void 0:C.email),firstName:null==C?void 0:C.firstName,hasBillingId:!!(null==b?void 0:b.id),isBuyNowCart:"BUY_NOW"===w.source,customerAccountFields:i(),canSubscribe:x,defaultShouldSubscribe:D,requiresMarketingConsent:E,isFloatingLabelEnabled:(0,$t.A)(I.checkoutSettings),forgotPasswordUrl:z,privacyPolicyUrl:P,isSignInEmailEnabled:O,isAccountCreationEnabled:A,isGuestEnabled:I.checkoutSettings.guestCheckoutEnabled,isExpressPrivacyPolicy:k,shouldRedirectToStorefrontForAuth:T,isContinuingAsGuest:m(),isExecutingPaymentMethodCheckout:p(),isInitializing:y(),isSigningIn:g(),isSendingSignInEmail:v(),isCreatingAccount:f(),signInError:l(),signInEmailError:u(),createAccountError:h(),signInEmail:_,checkoutButtonIds:N,providerWithCustomCheckout:F,isPaymentDataRequired:c(),shouldRenderStripeForm:F===Ie.A.StripeUPE&&(0,lt.A)(w)},actions:{clearError:t.clearError,createAccount:t.createCustomerAccount,continueAsGuest:t.continueAsGuest,sendLoginEmail:t.sendSignInEmail,deinitializeCustomer:t.deinitializeCustomer,executePaymentMethodCheckout:t.executePaymentMethodCheckout,initializeCustomer:t.initializeCustomer,signIn:t.signInCustomer}}})();(0,o.useEffect)((()=>{v((e=>Object.assign(Object.assign({},e),{draftEmail:b.data.email})))}),[b.data.email]),(0,o.useEffect)((()=>{(0,T.__awaiter)(void 0,void 0,void 0,(function*(){try{b.data.providerWithCustomCheckout&&b.data.providerWithCustomCheckout!==Ie.A.StripeUPE&&(yield b.actions.initializeCustomer({methodId:b.data.providerWithCustomCheckout,integrations:[De.Wu,ze.ep,Fe.Qp,Pe.z2,Be.Tv,Be.BK]}))}catch(e){p(e)}v((e=>Object.assign(Object.assign({},e),{isReady:!0}))),l()}))}),[]),(0,o.useEffect)((()=>()=>{(0,T.__awaiter)(void 0,void 0,void 0,(function*(){try{yield b.actions.deinitializeCustomer({methodId:b.data.providerWithCustomCheckout})}catch(e){p(e)}}))}),[b.actions.deinitializeCustomer,b.data.providerWithCustomCheckout,p]);const S=(0,o.useCallback)((e=>{v((t=>Object.assign(Object.assign({},t),{draftEmail:e}))),f.customerEmailEntry(e)}),[f]),C=(0,o.useCallback)((e=>(0,T.__awaiter)(void 0,void 0,void 0,(function*(){try{yield b.actions.signIn(e),h(),v((e=>Object.assign(Object.assign({},e),{draftEmail:void 0})))}catch(e){m(e)}}))),[b.actions.signIn,h,m]),w=(0,o.useCallback)((e=>(0,T.__awaiter)(void 0,void 0,void 0,(function*(){const t=e.email.trim(),n=!b.data.hasBillingId&&!b.data.defaultShouldSubscribe&&void 0;try{const{data:i}=yield b.actions.continueAsGuest({email:t,acceptsMarketingNewsletter:!(!b.data.canSubscribe||!e.shouldSubscribe)||n,acceptsAbandonedCartEmails:!!e.shouldSubscribe||n});u(e.shouldSubscribe),Nt.setSubscribeStatus(e.shouldSubscribe);const r=i.getCustomer(),o=i.getPaymentProviderCustomer();if(r&&r.shouldEncourageSignIn&&r.isGuest&&!(null==o?void 0:o.stripeLinkAuthenticationState))return a(ie.SuggestedLogin);yield _(),v((e=>Object.assign(Object.assign({},e),{draftEmail:void 0})))}catch(e){if(!(0,X.A)(e)||"update_subscriptions"!==e.type&&"payment_method_client_invalid"!==e.type||(v((e=>Object.assign(Object.assign({},e),{draftEmail:void 0}))),d()),(0,X.A)(e)&&"empty_cart"===e.type)return c(e);if((0,X.A)(e)&&429===e.status)return a(ie.EnforcedLogin);if((0,X.A)(e)&&403===e.status)return a(ie.CancellableEnforcedLogin);c(e)}}))),[b,u,a,d,c]),_=(0,o.useCallback)((()=>(0,T.__awaiter)(void 0,void 0,void 0,(function*(){b.data.providerWithCustomCheckout&&b.data.providerWithCustomCheckout!==Ie.A.StripeUPE?yield b.actions.executePaymentMethodCheckout({methodId:b.data.providerWithCustomCheckout,continueWithCheckoutCallback:d,checkoutPaymentMethodExecuted:e=>{f.customerPaymentMethodExecuted(e)}}):d()}))),[b.actions.executePaymentMethodCheckout,b.data.providerWithCustomCheckout,d,f]),I=(0,o.useCallback)((()=>{a(ie.Login)}),[a]),P=(0,o.useCallback)((e=>(0,T.__awaiter)(void 0,void 0,void 0,(function*(){yield b.actions.createAccount(function(e){var{acceptsMarketingEmails:t,customFields:n}=e,i=(0,T.__rest)(e,["acceptsMarketingEmails","customFields"]);return Object.assign(Object.assign({},i),{acceptsMarketingEmails:t&&t.length>0,customFields:(0,Gt.A)(n)})}(e)),s()}))),[b.actions.createAccount,s]),E=(0,o.useCallback)((()=>{b.data.createAccountError&&b.actions.clearError(b.data.createAccountError),a(ie.Login)}),[b.actions.clearError,b.data.createAccountError,a]),O=(0,o.useCallback)((()=>{b.data.signInError&&b.actions.clearError(b.data.signInError),a(ie.Guest)}),[b.actions.clearError,b.data.signInError,a]),A=(0,o.useCallback)((()=>{a(ie.CreateAccount)}),[a]),k=(0,o.useCallback)((e=>(0,T.__awaiter)(void 0,void 0,void 0,(function*(){try{yield b.actions.sendLoginEmail(e)}catch(e){}finally{v((e=>Object.assign(Object.assign({},e),{hasRequestedLoginEmail:!0})))}}))),[b.actions.sendLoginEmail]),N=(0,o.useCallback)((()=>(0,T.__awaiter)(void 0,void 0,void 0,(function*(){try{e!==ie.Login&&g.draftEmail&&(yield k({email:g.draftEmail}))}finally{v((e=>Object.assign(Object.assign({},e),{isEmailLoginFormOpen:!0})))}}))),[e,g.draftEmail,k]),M=(0,o.useCallback)((()=>{v((e=>Object.assign(Object.assign({},e),{isEmailLoginFormOpen:!1,hasRequestedLoginEmail:!1})))}),[]),D=e===ie.Guest,z=e===ie.CreateAccount,F=!D&&!z;return g.isReady?o.createElement(o.Fragment,null,g.isEmailLoginFormOpen&&o.createElement(ct,{email:g.draftEmail,emailHasBeenRequested:g.hasRequestedLoginEmail,isFloatingLabelEnabled:b.data.isFloatingLabelEnabled,isOpen:g.isEmailLoginFormOpen,isSendingEmail:b.data.isSendingSignInEmail,onRequestClose:M,onSendLoginEmail:k,sentEmail:b.data.signInEmail,sentEmailError:b.data.signInEmailError}),F&&o.createElement(Ht,{continueAsGuestButtonLabelId:"customer.continue_as_guest_action",email:g.draftEmail||b.data.email,isEmbedded:n,isFloatingLabelEnabled:b.data.isFloatingLabelEnabled,onCancel:O,onChangeEmail:S,onContinueAsGuest:_,onCreateAccount:A,onSendLoginEmail:N,onSignIn:C,signInError:b.data.signInError,viewType:e}),D&&o.createElement(Ft,{email:g.draftEmail||b.data.email,handleChangeEmail:S,handleContinueAsGuest:w,handleShowLogin:I,isFloatingLabelEnabled:b.data.isFloatingLabelEnabled,isSubscribed:i,isWalletButtonsOnTop:r,onUnhandledError:p,onWalletButtonClick:y,step:t}),z&&o.createElement(et,{createAccountError:b.data.createAccountError,defaultShouldSubscribe:b.data.defaultShouldSubscribe,formFields:b.data.customerAccountFields,isCreatingAccount:b.data.isCreatingAccount,isExecutingPaymentMethodCheckout:b.data.isExecutingPaymentMethodCheckout,isFloatingLabelEnabled:b.data.isFloatingLabelEnabled,onCancel:E,onSubmit:P,requiresMarketingConsent:b.data.requiresMarketingConsent})):null};var Yt=n(99418);const Kt=(0,Bt.A)((()=>o.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},o.createElement("path",{d:"M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"})))),Qt=(0,o.memo)((({message:e})=>o.createElement(Ve.A,{additionalClassName:"optimizedCheckout-discountBanner",icon:o.createElement(Kt,null),type:Ve.v.Info},o.createElement("span",{dangerouslySetInnerHTML:{__html:Yt.A.sanitize(e)},"data-test":"promotion-banner-message"})))),Jt=(0,o.memo)((({promotions:e})=>{const t=(e||[]).reduce(((e,t)=>[...e,...t.banners]),[]);return t.length?o.createElement("div",{className:"discountBanner"},o.createElement("ul",{className:"discountBannerList"},t.map(((e,t)=>o.createElement(Qt,{key:t,message:e.text}))))):null}));var Zt=n(4209),Xt=n(96097),en=n(38989),tn=n(47135),nn=n(35172),rn=n(75794),on=n(62562),an=n(26565),sn=n(13061),dn=n(53056);const cn=(0,o.memo)((({consignment:e,cart:t,compactView:n,isShippingDiscountDisplayEnabled:i})=>{const{paypalFastlaneAddresses:r}=(0,en.A)(),{shippingAddress:a,selectedShippingOption:s}=e,d=(0,tn.A)(a,r);return o.createElement("div",{className:"staticConsignment"},o.createElement(rn.A,{address:a,type:on.A.Shipping}),d&&o.createElement(nn.A,null),!n&&o.createElement(dn.A,{cart:t,consignment:e}),s&&o.createElement("div",null,o.createElement("div",{className:"shippingOption shippingOption--alt shippingOption--selected"},o.createElement(sn.A,{displayAdditionalInformation:!1,method:s,shippingCostAfterDiscount:i?(0,an.A)(s.cost,[e]):void 0}))))}));var ln=n(67313),un=n(81339),hn=n(17851),mn=n(79877);const pn=(0,o.memo)((({consignment:e,cart:t,consignmentNumber:n,isShippingDiscountDisplayEnabled:i})=>{const{checkoutState:{data:{getShippingCountries:r}}}=(0,ht.Q)(),{themeV2:a}=(0,I.w)(),{shippingAddress:s,selectedShippingOption:d}=e,c=(0,ln.A)(s,r()),{paypalFastlaneAddresses:l}=(0,en.A)(),u=(0,tn.A)(c,l),h=(0,hn.A)(t,e);return o.createElement("div",{className:"staticMultiConsignment"},o.createElement("h3",{className:M()("staticMultiConsignment-header",{"body-bold":a})},o.createElement(R.A,{data:{consignmentNumber:n},id:"shipping.multishipping_consignment_index_heading"})),o.createElement("div",{className:"checkout-address--static"},o.createElement("p",{className:M()("address-entry",{"sub-text":a})},o.createElement("span",{className:"first-name"},`${c.firstName} `),o.createElement("span",{className:"family-name"},c.lastName)),o.createElement("div",{className:"address-details"},o.createElement("p",{className:M()("street-address address-entry",{"sub-text":a})},o.createElement("span",{className:"address-line-1"},c.address1),c.address2&&o.createElement("span",{className:"address-line-2"},`, ${c.address2}`)),o.createElement("p",{className:M()("address-entry",{"sub-text":a})},c.city&&o.createElement("span",{className:"locality"},c.city),c.localizedProvince&&o.createElement("span",{className:"region"},`, ${c.localizedProvince}`),c.localizedCountry&&o.createElement("span",{className:"country-name"},`, ${c.localizedCountry}`),c.postalCode&&o.createElement("span",{className:"postal-code"},` ${c.postalCode}`)))),u&&o.createElement(nn.A,null),o.createElement("div",{className:"staticConsignment-items"},o.createElement("span",{className:a?"body-bold":""},o.createElement(R.A,{data:{count:(0,mn.A)(h)},id:"cart.item_count_text"})),o.createElement(un.A,{isMultiShippingSummary:!0,lineItems:h})),d&&o.createElement("div",null,o.createElement("div",{className:"shippingOption shippingOption--alt shippingOption--selected"},o.createElement(sn.A,{displayAdditionalInformation:!1,method:d,shippingCostAfterDiscount:i?(0,an.A)(d.cost,[e]):void 0}))))})),yn=(0,o.memo)((({isShippingDiscountDisplayEnabled:e,isMultiShippingMode:t,consignments:n,cart:i})=>t?o.createElement(o.Fragment,null,n.map(((t,n)=>o.createElement("div",{className:"staticMultiConsignmentContainer",key:t.id},o.createElement(pn,{cart:i,consignment:t,consignmentNumber:n+1,isShippingDiscountDisplayEnabled:e}))))):o.createElement(o.Fragment,null,n.map((t=>o.createElement("div",{className:"staticConsignmentContainer",key:t.id},o.createElement(cn,{cart:i,compactView:n.length<2,consignment:t,isShippingDiscountDisplayEnabled:e})))))));class gn extends f.A{constructor(){super({name:"SHIPPING_OPTION_EXPIRED",message:(0,u.A)().translate("shipping.shipping_option_expired_error"),title:(0,u.A)().translate("shipping.shipping_option_expired_heading")}),(0,b.h)(this,gn.prototype)}}var vn=n(41408),fn=n(63849),bn=n(11100);const Sn=(0,Bt.A)((()=>o.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},o.createElement("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})))),Cn=(0,o.memo)((({heading:e,isActive:t,isComplete:n,isEditable:i,onEdit:r,summary:a,type:s})=>{const{themeV2:d}=(0,I.w)();return o.createElement("div",{className:M()("stepHeader",{"is-readonly":!i,"is-clickable":i&&!t}),onClick:(0,Le.A)(i&&r?()=>r(s):x.noop)},o.createElement("div",{className:"stepHeader-figure stepHeader-column"},o.createElement(Sn,{additionalClassName:M()("stepHeader-counter","optimizedCheckout-step",{"stepHeader-counter--complete":n})}),o.createElement("h2",{className:M()("stepHeader-title optimizedCheckout-headingPrimary",{header:d&&(t||n)},{"header-secondary":d&&!t&&!n})},e)),d&&!t&&n&&o.createElement("div",{className:"stepHeader-body stepHeader-column optimizedCheckout-contentPrimary body-regular","data-test":"step-info"},a),!d&&o.createElement("div",{className:"stepHeader-body stepHeader-column optimizedCheckout-contentPrimary","data-test":"step-info"},!t&&n&&a),i&&!t&&o.createElement("div",{className:"stepHeader-actions stepHeader-column"},o.createElement(Ee.Ay,{"aria-expanded":t,className:M()({"body-regular":d}),size:Ee.Mp.Tiny,testId:"step-edit-button",variant:Ee.Ak.Secondary},o.createElement(R.A,{id:"common.edit_action"}))))})),wn=({children:e,heading:t,isActive:n,isBusy:i,isComplete:r,isEditable:a,onEdit:s,suggestion:d,summary:c,type:l,onExpanded:u=x.noop})=>{const[h,m]=(0,o.useState)(!0),p=(0,o.useRef)(null),y=(0,o.useRef)(null),g=(0,o.useRef)(),v=(0,o.useRef)(),f=()=>{let e=p.current;for(;e&&e.parentElement;){if(e.parentElement.classList.contains("checkout-step"))return e.parentElement;e=e.parentElement}return p.current?p.current:void 0},b=()=>{const e=(0,bn.A)()?0:(void 0!==v.current||(v.current=1e3*parseFloat(y.current?getComputedStyle(y.current).transitionDuration:"0s")),v.current);m(!1),g.current=window.setTimeout((()=>{const e=(()=>{const e=p.current;if(!e)return;return e.querySelector("input, select, textarea")||void 0})(),t=(()=>{const e=f();if(!e||window!==window.top)return;const t=r?0:window.innerHeight/5;return e.getBoundingClientRect().top+(window.scrollY||window.pageYOffset)-t})();e&&e.focus(),void 0===t||isNaN(t)||window.scrollTo(0,t),u(l),g.current=void 0}),e)},S=(e,t)=>{e.addEventListener("transitionend",(({target:n})=>{n===e&&t()}))},C=(0,o.useCallback)((()=>{n||m(!0)}),[n]);return(0,o.useEffect)((()=>()=>{g.current&&(window.clearTimeout(g.current),g.current=void 0)}),[]),(0,o.useEffect)((()=>{n&&b()}),[n]),o.createElement("li",{className:M()("checkout-step","optimizedCheckout-checkoutStep",{[`checkout-step--${l}`]:!!l}),ref:p},o.createElement("div",{className:"checkout-view-header"},o.createElement(Cn,{heading:t,isActive:n,isComplete:r,isEditable:a,onEdit:s,summary:c,type:l})),d&&h&&!n&&o.createElement("div",{className:"checkout-suggestion","data-test":"step-suggestion"},d),o.createElement(vn.A,null,(t=>o.createElement(fn.A,{addEndListener:S,classNames:"checkout-view-content",enter:!t,exit:!t,in:n,mountOnEnter:!0,onExited:C,timeout:{},unmountOnExit:!0},o.createElement("div",{"aria-busy":i,className:"checkout-view-content",ref:y},n?e:null)))))};var _n;!function(e){e.Billing="billing",e.Customer="customer",e.Payment="payment",e.Shipping="shipping"}(_n||(_n={}));const In=_n;var Pn=n(12077),En=n(79001),On=n(87980),An=n(33318),kn=n(9597);const Tn=(e,t)=>!!e&&(!!e.lineItems.physicalItems.some((e=>e.isShippingRequired))||!(!t||!e.lineItems.customItems)&&e.lineItems.customItems.length>0),Nn=(0,Pn.Mz)((({data:e})=>e.getCheckout()),(({data:e})=>e.getCustomer()),(({data:e})=>e.getBillingAddress()),(({data:e})=>e.getConfig()),(({data:e})=>e.getCart()),(({data:e})=>e.getPaymentProviderCustomer()),((e,t,n,i,r,o)=>{const a=!!(t&&t.email||n&&n.email),s=!(!e||!e.payments)&&e.payments.some((e=>se.includes(e.providerId))),d=!(!t||!t.isGuest),c=a||s,l=c&&!s&&d,u=((e,t,n,i,r)=>!e&&r===Ie.A.StripeUPE&&t&&n&&i)(s,a,d,!!r&&(0,lt.A)(r),null==i?void 0:i.checkoutSettings.providerWithCustomCheckout);return u?{type:In.Customer,isActive:!1,isComplete:void 0!==(null==o?void 0:o.stripeLinkAuthenticationState),isEditable:l,isRequired:!0}:{type:In.Customer,isActive:!1,isComplete:c,isEditable:l,isRequired:!0}})),Mn=(0,Pn.Mz)((({data:e})=>e.getCheckout()),(({data:e})=>e.getBillingAddress()),(({data:e})=>{const t=e.getBillingAddress();return t?e.getBillingAddressFields(t.countryCode):En.M}),(({data:e})=>e.getConfig()),((e,t,n,i)=>{const r=!!t&&(0,An.A)(t,n),o=!(!e||!e.payments)&&e.payments.some((e=>se.includes(e.providerId))),a=r||o;if(!(!e||!e.payments)&&e.payments.some((e=>"amazonpay"===e.providerId))){const e=n.filter((({custom:e})=>e)),i=e.length>0,r=!t||!i||(0,An.A)(t,e);return{type:In.Billing,isActive:!1,isComplete:r,isEditable:r&&i,isRequired:!0}}if((0,On.A)(null==i?void 0:i.checkoutSettings,"STRIPE-546.allow_billing_address_editing_for_all_Google_Pay_providers")&&!(!e||!e.payments)&&e.payments.some((e=>((null==e?void 0:e.providerId)||"").startsWith("googlepay"))))return{type:In.Billing,isActive:!1,isComplete:r,isEditable:r,isRequired:!0};return!(!e||!e.payments)&&e.payments.some((e=>["braintreepaypal","braintreepaypalcredit","braintreevenmo","paypalcommerce","paypalcommercecredit","paypalcommercevenmo"].includes(e.providerId)))?{type:In.Billing,isActive:!1,isComplete:r,isEditable:r,isRequired:!0}:{type:In.Billing,isActive:!1,isComplete:a,isEditable:a&&!o,isRequired:!0}})),xn=(0,Pn.Mz)((({data:e})=>e.getShippingAddress()),(({data:e})=>e.getConsignments()),(({data:e})=>e.getCart()),(({data:e})=>{const t=e.getShippingAddress();return t?e.getShippingAddressFields(t.countryCode):En.M}),(({data:e})=>e.getConfig()),((e,t,n,i,r)=>{const o=!!e&&(0,An.A)(e,i),a=!!t&&(0,Zt.A)(t),s=!n||!t||(0,kn.A)(t,n.lineItems),d=o&&a&&!s,c=Tn(n,r),l=(0,On.A)(null==r?void 0:r.checkoutSettings,"PROJECT-5015.manual_order.display_custom_shipping")&&a&&(null==t?void 0:t.some((({selectedShippingOption:e})=>"custom"===(null==e?void 0:e.type))));return{type:In.Shipping,isActive:!1,isComplete:d,isEditable:d&&c&&!l,isRequired:c}})),Dn=(0,Pn.Mz)((({data:e})=>e.getOrder()),(e=>{const t=!!e&&e.isComplete;return{type:In.Payment,isActive:!1,isComplete:t,isEditable:t,isRequired:!0}})),zn=(0,Pn.Mz)((({statuses:e})=>e.isSubmittingOrder()),(e=>e)),Fn=(0,Pn.Mz)(Nn,xn,Mn,Dn,zn,((e,t,n,i,r)=>{const o=r,a=(0,x.compact)([e,t,n,i]),s=a.find((e=>!e.isComplete&&e.isRequired))||a[a.length-1];return a.map(((e,t)=>{const n=a.slice(0,t).every((e=>e.isComplete||!e.isRequired));return Object.assign(Object.assign({},e),{isActive:s.type===e.type,isBusy:!1,isEditable:n&&e.isEditable&&!o})}))}));const Bn=(0,o.lazy)((()=>(0,ne.A)((()=>Promise.all([n.e(2570),n.e(2843),n.e(8964)]).then(n.bind(n,44713)))))),Rn=(0,o.lazy)((()=>(0,ne.A)((()=>Promise.all([n.e(1123),n.e(5933),n.e(2358)]).then(n.bind(n,53134)))))),Ln=(0,o.lazy)((()=>(0,ne.A)((()=>Promise.all([n.e(1123),n.e(5933),n.e(2824)]).then(n.bind(n,76089)))))),jn=(0,o.lazy)((()=>(0,ne.A)((()=>Promise.all([n.e(2570),n.e(8899)]).then(n.bind(n,72587)))))),Un=(0,o.lazy)((()=>(0,ne.A)((()=>Promise.all([n.e(2570),n.e(2843),n.e(2553)]).then(n.bind(n,90023))))));class Vn extends o.Component{constructor(){super(...arguments),this.state={isBillingSameAsShipping:!0,isCartEmpty:!1,isRedirecting:!1,isMultiShippingMode:!1,hasSelectedShippingOptions:!1,isSubscribed:!1,buttonConfigs:[]},this.handleToggleMultiShipping=()=>{const{isMultiShippingMode:e}=this.state;this.setState({isMultiShippingMode:!e})},this.navigateToNextIncompleteStep=e=>{const{steps:t,analyticsTracker:n}=this.props,i=(0,x.findIndex)(t,{isActive:!0}),r=i>=0&&t[i];if(!r)return;const o=t[Math.max(i-1,0)];o&&n.trackStepCompleted(o.type),this.navigateToStep(r.type,e)},this.navigateToOrderConfirmation=e=>{const{steps:t,analyticsTracker:n}=this.props;n.trackStepCompleted(t[t.length-1].type),this.embeddedMessenger&&this.embeddedMessenger.postComplete(),Nt.removeSubscribeStatus(),this.setState({isRedirecting:!0},(()=>{(0,G.A)(e)}))},this.checkEmbeddedSupport=e=>{const{embeddedSupport:t}=this.props;return t.isSupported(...e)},this.handleCartChangedError=()=>{this.navigateToStep(In.Shipping)},this.handleConsignmentsUpdated=({data:e})=>{const{hasSelectedShippingOptions:t,activeStepType:n,defaultStepType:i}=this.state,{steps:r}=this.props,o=(0,Zt.A)(e.getConsignments()||[]),a=!n&&(i===In.Payment||i===In.Billing),s=(0,x.findIndex)(r,{type:In.Shipping})<(0,x.findIndex)(r,{type:n})||a;t&&!o&&s&&(this.navigateToStep(In.Shipping),this.setState({error:new gn})),this.setState({hasSelectedShippingOptions:o})},this.handleCloseErrorModal=()=>{this.setState({error:void 0})},this.handleExpanded=e=>{const{analyticsTracker:t}=this.props;t.trackStepViewed(e)},this.handleUnhandledError=e=>{this.handleError(e),this.setState({error:e})},this.handleError=e=>{const{errorLogger:t}=this.props;(0,X.A)(e)&&"empty_cart"===e.type?this.setState({error:e}):(t.log(e),this.embeddedMessenger&&this.embeddedMessenger.postError(e))},this.handleEditStep=e=>{this.navigateToStep(e)},this.handleReady=()=>{this.navigateToNextIncompleteStep({isDefault:!0})},this.handleNewsletterSubscription=e=>{this.setState({isSubscribed:e})},this.handleSignOut=({isCartEmpty:e})=>{const{loginUrl:t,cartUrl:n,isPriceHiddenFromGuests:i,isGuestEnabled:r}=this.props;return i&&window.top?window.top.location.href=n:(this.embeddedMessenger&&this.embeddedMessenger.postSignedOut(),r&&this.setCustomerViewType(ie.Guest),e&&(this.setState({isCartEmpty:!0}),!(0,w.A)()&&window.top)?window.top.location.assign(t):void this.navigateToStep(In.Customer))},this.handleShippingNextStep=e=>{this.setState({isBillingSameAsShipping:e}),e?this.navigateToNextIncompleteStep():this.navigateToStep(In.Billing)},this.handleShippingSignIn=()=>{this.setCustomerViewType(ie.Login)},this.handleShippingCreateAccount=()=>{this.setCustomerViewType(ie.CreateAccount)},this.setCustomerViewType=e=>{const{createAccountUrl:t}=this.props;e===ie.CreateAccount&&(0,w.A)()?window.top&&window.top.location.replace(t):(this.navigateToStep(In.Customer),this.setState({customerViewType:e}))},this.handleBeforeExit=()=>{const{analyticsTracker:e}=this.props;e.exitCheckout()},this.handleWalletButtonClick=e=>{const{analyticsTracker:t}=this.props;t.walletButtonClick(e)},this.reloadWindow=()=>{this.setState({error:void 0}),window.location.reload()}}componentWillUnmount(){this.unsubscribeFromConsignments&&(this.unsubscribeFromConsignments(),this.unsubscribeFromConsignments=void 0),window.removeEventListener("beforeunload",this.handleBeforeExit),this.handleBeforeExit()}componentDidMount(){return(0,T.__awaiter)(this,void 0,void 0,(function*(){var e,t,n,i,r,o,a;const{analyticsTracker:s,containerId:d,createEmbeddedMessenger:c,data:l,embeddedStylesheet:u,extensionService:h,loadPaymentMethodByIds:m,subscribeToConsignments:p}=this.props;try{const y=(null===(t=null===(e=l.getConfig())||void 0===e?void 0:e.checkoutSettings)||void 0===t?void 0:t.remoteCheckoutProviders)||[],g=de(y);if(y.length>0){const e=yield m(g);this.setState({buttonConfigs:e.data.getPaymentMethods()||[]})}h.preloadExtensions();const{links:{siteLink:v=""}={}}=l.getConfig()||{},b=l.getFlashMessages("error")||[];if(b.length){const{language:e}=this.props;this.setState({error:new f.A({title:b[0].title||e.translate("common.error_heading"),message:b[0].message,data:{},name:"default"})})}const S=c({parentOrigin:v});this.unsubscribeFromConsignments=p(this.handleConsignmentsUpdated),this.embeddedMessenger=S,S.receiveStyles((e=>u.append(e))),S.postFrameLoaded({contentId:d}),S.postLoaded(),document.prerendering?document.addEventListener("prerenderingchange",(()=>{s.checkoutBegin()}),{once:!0}):s.checkoutBegin();const C=l.getConsignments(),w=l.getCart(),_=null===(n=l.getConfig())||void 0===n?void 0:n.checkoutSettings.hasMultiShippingEnabled,I=null===(r=null===(i=l.getConfig())||void 0===i?void 0:i.checkoutSettings.checkoutBillingSameAsShippingEnabled)||void 0===r||r,P=null!==(a=null===(o=l.getConfig())||void 0===o?void 0:o.shopperConfig.defaultNewsletterSignup)&&void 0!==a&&a,E=!!w&&!!C&&_&&(0,Xt.A)(C,w.lineItems);this.setState({isBillingSameAsShipping:I,isSubscribed:P}),E&&this.setState({isMultiShippingMode:E}),window.addEventListener("beforeunload",this.handleBeforeExit),this.handleReady()}catch(e){e instanceof Error&&this.handleUnhandledError(e)}}))}render(){const{error:e,isRedirecting:t}=this.state,{themeV2:n,language:i}=this.props;if(t)return o.createElement(j.A,null);let r=null;if(e)if((0,ee.A)(e))r=o.createElement(te.A,{error:e,onClose:this.handleCloseErrorModal,title:e.title});else{const{message:t,action:n}=function(e,t){return"empty_cart"===e.type?{message:t("cart.empty_cart_error_message"),action:"reload"}:{message:e.message,action:"default"}}(e,i.translate.bind(i));r=o.createElement(te.A,{error:e,message:t,onClose:"reload"===n?this.reloadWindow:this.handleCloseErrorModal})}return o.createElement("div",{className:M()("remove-checkout-step-numbers",{"is-embedded":(0,w.A)()},{themeV2:n}),"data-test":"checkout-page-container",id:"checkout-page-container"},o.createElement("div",{className:"layout optimizedCheckout-contentPrimary"},this.renderContent()),r)}renderContent(){var e;const{isPending:t,loginUrl:n,promotions:i=[],steps:r,isShowingWalletButtonsOnTop:a,extensionState:s}=this.props,{activeStepType:d,defaultStepType:c,isCartEmpty:l}=this.state;if(l)return o.createElement(Q,{loginUrl:n,waitInterval:3e3});const u=d?d===In.Payment:c===In.Payment;return o.createElement(o.Fragment,null,o.createElement("div",{className:"layout-main"},o.createElement(U,{isLoading:s.isShowingLoadingIndicator}),o.createElement(Jt,{promotions:i}),a&&(null===(e=this.state.buttonConfigs)||void 0===e?void 0:e.length)>0&&o.createElement(we,{checkEmbeddedSupport:this.checkEmbeddedSupport,isPaymentStepActive:u,onUnhandledError:this.handleUnhandledError,onWalletButtonClick:this.handleWalletButtonClick}),o.createElement("ol",{className:"checkout-steps"},r.filter((e=>e.isRequired)).map((e=>this.renderStep(Object.assign(Object.assign({},e),{isActive:d?d===e.type:c===e.type,isBusy:t})))))),this.renderCartSummary())}renderStep(e){switch(e.type){case In.Customer:return this.renderCustomerStep(e);case In.Shipping:return this.renderShippingStep(e);case In.Billing:return this.renderBillingStep(e);case In.Payment:return this.renderPaymentStep(e);default:return null}}renderCustomerStep(e){const{isGuestEnabled:t,isShowingWalletButtonsOnTop:n}=this.props,{customerViewType:i=(t?ie.Guest:ie.Login),isSubscribed:r}=this.state;return o.createElement(wn,Object.assign({},e,{heading:o.createElement(R.A,{id:"customer.customer_heading"}),key:e.type,onEdit:this.handleEditStep,onExpanded:this.handleExpanded,suggestion:o.createElement(ke,null),summary:o.createElement(xe,{onSignOut:this.handleSignOut,onSignOutError:this.handleError})}),o.createElement(Wt,{checkEmbeddedSupport:this.checkEmbeddedSupport,isEmbedded:(0,w.A)(),isSubscribed:r,isWalletButtonsOnTop:n,onAccountCreated:this.navigateToNextIncompleteStep,onChangeViewType:this.setCustomerViewType,onContinueAsGuest:this.navigateToNextIncompleteStep,onContinueAsGuestError:this.handleError,onReady:this.handleReady,onSignIn:this.navigateToNextIncompleteStep,onSignInError:this.handleError,onSubscribeToNewsletter:this.handleNewsletterSubscription,onUnhandledError:this.handleUnhandledError,onWalletButtonClick:this.handleWalletButtonClick,step:e,viewType:i}))}renderShippingStep(e){const{hasCartChanged:t,cart:n,consignments:i=[],isShippingDiscountDisplayEnabled:r}=this.props,{isBillingSameAsShipping:a,isMultiShippingMode:s}=this.state;if(!n)return;return o.createElement(wn,Object.assign({},e,{heading:o.createElement(R.A,{id:"shipping.shipping_heading"}),key:e.type,onEdit:this.handleEditStep,onExpanded:this.handleExpanded,summary:o.createElement(yn,{cart:n,consignments:i,isMultiShippingMode:s,isShippingDiscountDisplayEnabled:r})}),o.createElement(V.A,{loadingSkeleton:o.createElement(q.A,null)},o.createElement(Un,{cartHasChanged:t,isBillingSameAsShipping:a,isMultiShippingMode:s,navigateNextStep:this.handleShippingNextStep,onCreateAccount:this.handleShippingCreateAccount,onReady:this.handleReady,onSignIn:this.handleShippingSignIn,onToggleMultiShipping:this.handleToggleMultiShipping,onUnhandledError:this.handleUnhandledError,setIsMultishippingMode:e=>{this.setState({isMultiShippingMode:e})},step:e})))}renderBillingStep(e){const{billingAddress:t}=this.props;return o.createElement(wn,Object.assign({},e,{heading:o.createElement(R.A,{id:"billing.billing_heading"}),key:e.type,onEdit:this.handleEditStep,onExpanded:this.handleExpanded,summary:t&&o.createElement(W.A,{address:t})}),o.createElement(V.A,{loadingSkeleton:o.createElement(q.A,null)},o.createElement(Bn,{navigateNextStep:this.navigateToNextIncompleteStep,onReady:this.handleReady,onUnhandledError:this.handleUnhandledError})))}renderPaymentStep(e){const{consignments:t,cart:n,errorLogger:i}=this.props;return o.createElement(wn,Object.assign({},e,{heading:o.createElement(R.A,{id:"payment.payment_heading"}),key:e.type,onEdit:this.handleEditStep,onExpanded:this.handleExpanded}),o.createElement(V.A,{loadingSkeleton:o.createElement(H.A,null)},o.createElement(jn,{checkEmbeddedSupport:this.checkEmbeddedSupport,errorLogger:i,isEmbedded:(0,w.A)(),isUsingMultiShipping:!(!n||!t)&&(0,Xt.A)(t,n.lineItems),onCartChangedError:this.handleCartChangedError,onFinalize:this.navigateToOrderConfirmation,onReady:this.handleReady,onSubmit:this.navigateToOrderConfirmation,onSubmitError:this.handleError,onUnhandledError:this.handleUnhandledError})))}renderCartSummary(){const{isMultiShippingMode:e}=this.state;return o.createElement(vn.A,null,(t=>t?o.createElement(V.A,{loadingSkeleton:o.createElement(o.Fragment,null)},o.createElement(D.Y,{region:"summary.after"}),o.createElement(Ln,{isMultiShippingMode:e})):o.createElement(V.A,{loadingSkeleton:o.createElement(E.W,null)},o.createElement("aside",{className:"layout-cart"},o.createElement(Rn,{isMultiShippingMode:e}),o.createElement(D.Y,{region:"summary.after"})))))}navigateToStep(e,t){const{clearError:n,error:i,steps:r}=this.props,{activeStepType:o}=this.state,a=(0,x.find)(r,{type:e});a&&o!==a.type&&(t&&t.isDefault?this.setState({defaultStepType:a.type}):this.setState({activeStepType:a.type}),i&&n(i))}}const qn=B((0,$.A)((0,L.A)((0,Z.A)((function({checkoutService:e,checkoutState:t}){var n;const{data:i,errors:r,statuses:o}=t,{promotions:a=En.M}=i.getCheckout()||{},s=r.getSubmitOrderError(),{checkoutSettings:{guestCheckoutEnabled:d=!1,checkoutUserExperienceSettings:c={walletButtonsOnTop:!1,floatingLabelEnabled:!1}}={},links:{loginLink:l="",createAccountLink:u="",cartLink:h=""}={},displaySettings:{hidePriceFromGuests:m=!1}={}}=i.getConfig()||{},p=(0,Pn.Mz)((({checkoutService:{subscribe:e}})=>e),(e=>t=>e(t,(({data:{getConsignments:e}})=>e())))),y=Boolean(c.walletButtonsOnTop),g=(0,On.A)(null===(n=i.getConfig())||void 0===n?void 0:n.checkoutSettings,"PROJECT-6643.enable_shipping_discounts_in_orders");return{billingAddress:i.getBillingAddress(),cart:i.getCart(),clearError:e.clearError,data:i,consignments:i.getConsignments(),hasCartChanged:s&&"cart_changed"===s.type,isGuestEnabled:d,isLoadingCheckout:o.isLoadingCheckout(),isShippingDiscountDisplayEnabled:g,isPending:o.isPending(),isPriceHiddenFromGuests:m,isShowingWalletButtonsOnTop:y,loadCheckout:e.loadCheckout,loadPaymentMethodByIds:e.loadPaymentMethodByIds,loginUrl:l,cartUrl:h,createAccountUrl:u,promotions:a,subscribeToConsignments:p({checkoutService:e,checkoutState:t}),steps:Fn(t)}}))(Vn))));var Hn=n(60489);const Gn=(e,t)=>{const{checkoutService:n,checkoutState:{data:i}}=(0,ht.Q)(),[r,a]=(0,o.useState)(!i.getCheckout()),{extensionService:s}=(0,Hn.O)(),d=(...t)=>(0,T.__awaiter)(void 0,[...t],void 0,(function*(t=3){const i=(...r)=>(0,T.__awaiter)(void 0,[...r],void 0,(function*(r=1){try{yield(0,T.__awaiter)(void 0,void 0,void 0,(function*(){yield Promise.all([n.loadCheckout(e,{params:{include:["cart.lineItems.physicalItems.categoryNames","cart.lineItems.digitalItems.categoryNames"]}}),s.loadExtensions()])}))}catch(e){if(r>=t)throw new Error("Failed to load checkout after 3 attempts, please try again.");const n=1e3*Math.pow(r,2);yield new Promise((e=>setTimeout(e,n))),yield i(r+1)}}));yield i()})),c=e=>(0,T.__awaiter)(void 0,void 0,void 0,(function*(){var t;yield(null===(t=window.scheduler)||void 0===t?void 0:t.yield)?window.scheduler.yield():new Promise((e=>{setTimeout(e,0)})),yield n.hydrateInitialState(e),a(!1)}));return(0,o.useEffect)((()=>{r&&(t?c(t):d().then((()=>a(!1))).catch((e=>{throw e})))}),[]),{isLoadingCheckout:r}},$n=e=>{const{checkoutId:t,initialState:n}=e,{isLoadingCheckout:i}=Gn(t,n),{themeV2:r}=(0,I.w)();return i?o.createElement(k,null):o.createElement(qn,Object.assign({},e,{createEmbeddedMessenger:e.createEmbeddedMessenger,embeddedStylesheet:e.embeddedStylesheet,embeddedSupport:e.embeddedSupport,errorLogger:e.errorLogger,themeV2:r}))},Wn=e=>{const{containerId:t,sentryConfig:n,publicPath:i,sentrySampleRate:a}=e,f=(0,o.useMemo)((()=>(0,y.A)({sentry:n},{errorTypes:["UnrecoverableError"],publicPath:i,sampleRate:a||.1})),[]),b=(0,o.useMemo)((()=>(0,r.O0)({locale:(0,u.A)().getLocale(),shouldWarnMutation:!1,errorLogger:f})),[]),S=(0,o.useMemo)((()=>(0,g.A)()),[]),I=(0,o.useMemo)((()=>{return e=(0,u.A)(),(0,w.A)()?new C(_,e):new v;var e}),[]);return(0,o.useEffect)((()=>{s().setAppElement(`#${t}`)}),[]),o.createElement(l.A,{logger:f},o.createElement(h.A,{checkoutService:b},o.createElement(m.A,{checkoutService:b},o.createElement(d.A,{checkoutService:b},o.createElement(c.v,{checkoutService:b,errorLogger:(0,y.A)()},o.createElement(p.N,null,o.createElement($n,Object.assign({},e,{createEmbeddedMessenger:r.ge,embeddedStylesheet:S,embeddedSupport:I,errorLogger:f}))))))))}},29958:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(69462),r=n(70355),o=n(9343);const a=(0,r.memo)((({name:e,testId:t,errorId:n})=>{const a=(0,r.useCallback)((i=>r.createElement("ul",{className:"form-field-errors","data-test":t},r.createElement("li",{className:"form-field-error"},r.createElement("label",{"aria-live":"polite",className:"form-inlineMessage",htmlFor:e,id:n,role:"alert"},i)))),[n,e,t]);return r.createElement(o.Ay.Consumer,null,(({isSubmitted:t})=>t&&r.createElement(i.Kw,{name:e,render:a})))}))},30680:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(69440),r=n(70355),o=n(97834),a=n(29958),s=n(372);const d=(0,r.memo)((({additionalClassName:e,labelContent:t,label:n,onChange:d,footer:c,input:l,name:u,id:h,isFloatingLabelEnabled:m,themeV2:p=!1})=>{const y=(0,r.useCallback)((e=>r.createElement(r.Fragment,null,m&&l(e),void 0!==n&&("function"==typeof n?n(u):n),void 0!==t&&!n&&r.createElement(s.A,{additionalClassName:p?"floating-form-field-label":"",htmlFor:u,id:`${null!=h?h:u}-label`,isFloatingLabelEnabled:m},t),!m&&l(e),r.createElement(a.A,{errorId:`${null!=h?h:u}-field-error-message`,name:u,testId:`${(0,i.kebabCase)(u)}-field-error-message`}),c)),[m,l,n,u,t,p,h,c]);return r.createElement(o.A,{additionalClassName:e,name:u,onChange:d,render:y})}))},31689:(e,t,n)=>{n.d(t,{A:()=>g});var i=n(69440),r=n(70355),o=n(49655),a=n(48447),s=n(46487),d=n(16599),c=n(45080),l=n(58330),u=n(92909),h=n(51492);const m=(0,r.memo)((({code:e,label:t})=>r.createElement("div",{className:"errorCode"},r.createElement("span",{className:"errorCode-label"},null!=t?t:r.createElement(o.A,{id:"common.error_code"}))," ",r.createElement("span",{className:"errorCode-value"},e))));var p=n(21685);var y=n(71161);const g=({error:e,message:t=e&&e.message,onClose:n=i.noop,shouldShowErrorCode:g=!0,title:v=e&&(0,p.A)(e)&&e.title})=>{const f=t=>{e&&n(t.nativeEvent,{error:e})},b=()=>{var t;if(!e||!g)return;if((0,y.A)(e)&&(null===(t=e.headers)||void 0===t?void 0:t["x-request-id"]))return r.createElement(m,{code:e.headers["x-request-id"],label:r.createElement(o.A,{id:"common.request_id"})});const n=(0,h.A)(e);return n?r.createElement(m,{code:n}):void 0};return r.createElement(u.A,{additionalModalClassName:"modal--error",aria:{labelledby:"errorModalMessage"},footer:r.createElement(s.Ay,{onClick:f,size:s.Mp.Small},r.createElement(o.A,{id:"common.ok_action"})),header:r.createElement(l.A,null,r.createElement(d.A,{additionalClassName:"icon--error modal-header-icon",size:c.l.Small}),r.createElement("span",{"aria-live":"assertive",role:"alert"},v||r.createElement(o.A,{id:"common.error_heading"}))),isOpen:!!e,onRequestClose:f},r.createElement(r.Fragment,null,e&&function(e){return"type"in e&&"custom"===e.type&&"data"in e&&"object"==typeof e.data&&null!==e.data&&"shouldBeTranslatedAsHtml"in e.data&&"boolean"==typeof e.data.shouldBeTranslatedAsHtml}(e)&&r.createElement(a.A,{id:e.data.translationKey}),t&&r.createElement("p",{"aria-live":"assertive",id:"errorModalMessage",role:"alert"},t),r.createElement("div",{className:"optimizedCheckout-contentSecondary"},b())))}},33318:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(33515),r=n(22011);function o(e,t){return(0,i.A)({formFields:t}).isValidSync((0,r.A)(t,e))}},33515:(e,t,n)=>{n.d(t,{A:()=>l,X:()=>c});var i=n(69440),r=n(44218),o=n(94202),a=n(10685);const s=/^[^<>]*$/,d=(0,r.Bj)((function({formFields:e,translate:t=()=>{}}){return(0,o.Ik)(Object.assign({},e.filter((({custom:e})=>!e)).reduce(((e,{name:n,required:i,label:r,maxLength:a})=>(e[n]=(0,o.Yj)(),i&&(e[n]=e[n].trim().required(t("required",{label:r,name:n}))),"address1"!==n&&"address2"!==n||!a||(e[n]=e[n].max(a,t("max",{label:r,name:n,max:a}))),e[n]=e[n].matches(s,t("invalid",{name:n,label:r})),e)),{}))).concat((0,a.A)({formFields:e,translate:t}))}));function c(e){const t={countryCode:"address.country",firstName:"address.first_name",lastName:"address.last_name",company:"address.company_name",address1:"address.address_line_1",address2:"address.address_line_2",city:"address.city",stateOrProvince:"address.state",stateOrProvinceCode:"address.state",postalCode:"address.postal_code",phone:"address.phone_number"};return(n,{label:i,name:r,min:o,max:a})=>{if(e)return"required"===n?t[r]?e.translate(`${t[r]}_required_error`):e.translate("address.custom_required_error",{label:i}):"max"===n&&a?e.translate("address.custom_max_error",{label:i,max:a}):"min"===n&&o?e.translate("address.custom_min_error",{label:i,min:o}):"invalid"===n?e.translate("address.invalid_characters_error",{label:i}):void 0}}const l=(0,i.memoize)((function({formFields:e,language:t}){return d({formFields:e,translate:c(t)})}))},33740:(e,t,n)=>{var i;n.d(t,{A:()=>r}),function(e){e.TELEPHONE="tel",e.DROPDOWM="dropdown",e.NUMBER="number",e.PASSWORD="password",e.CHECKBOX="checkbox",e.MULTILINE="multiline",e.DATE="date",e.RADIO="radio",e.TEXT="text"}(i||(i={}));const r=i},34953:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(31635),r=n(3375),o=n.n(r),a=n(69440),s=n(70355);const d=(0,s.forwardRef)(((e,t)=>{var{className:n,testId:r,placeholder:d,name:c,isFloatingLabelEnabled:l}=e,u=(0,i.__rest)(e,["className","testId","placeholder","name","isFloatingLabelEnabled"]);return s.createElement("input",Object.assign({},u,{className:o()(n,{"floating-input":l&&!(0,a.includes)(["orderComment","redeemableCode"],c)}),name:c,"data-test":r,placeholder:l?" ":d,ref:t}))}))},35172:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355);const r=(0,n(2156).A)((()=>i.createElement("svg",{viewBox:"0 0 101 12",xmlns:"http://www.w3.org/2000/svg"},i.createElement("path",{d:"M.009 9.791 1.653.298C1.681.1 1.805 0 1.997 0H7.74c.22 0 .332.141.29.354l-.236 1.334c-.028.185-.152.298-.344.298H3.627l-.359 2.058h3.479c.22 0 .332.142.29.354l-.221 1.306C6.788 5.9 6.664 6 6.472 6H2.936l-.662 3.847c-.028.198-.152.298-.344.298H.298c-.22 0-.332-.142-.289-.354m6.78-1.49c0-1.844 1.905-2.468 3.906-2.71.234-.029.415-.041 1.298-.112a3.25 3.25 0 0 0 .04-.498c0-.653-.344-1.022-1.063-1.022-.622 0-1.035.269-1.23.796-.068.185-.18.27-.358.27H7.975c-.18 0-.304-.085-.304-.241 0-.044.014-.086.028-.128.441-1.334 1.67-2.186 3.507-2.186s2.843.71 2.843 2.428c0 .326-.04.739-.11 1.122l-.373 2.07c-.083.484-.207 1.22-.207 1.718 0 .256-.11.341-.318.341h-1.283c-.192 0-.304-.1-.304-.282 0-.17.04-.37.069-.554-.524.539-1.2.978-2.402.978-1.42 0-2.332-.725-2.332-1.986zm5.036-1.205.054-.256-.372.041c-.746.085-2.375.2-2.375 1.205 0 .525.372.78.966.78 1.103 0 1.504-.78 1.725-1.773zm2.446 1.36c-.04-.17-.07-.297-.07-.438 0-.242.124-.313.318-.313h1.588c.192 0 .29.1.332.298.152.554.607.795 1.284.795.773 0 1.186-.326 1.186-.751 0-.369-.415-.54-1.104-.752l-.813-.256c-1.173-.369-2.14-.795-2.14-2.115 0-1.603 1.475-2.483 3.423-2.483 1.519 0 2.762.412 3.12 1.986.015.07.029.141.029.226 0 .142-.124.198-.318.198h-1.504c-.18 0-.276-.085-.36-.27-.165-.37-.538-.596-1.13-.596-.691 0-1.036.27-1.036.653s.332.554 1.284.852l.539.17c1.243.398 2.278.866 2.278 2.059 0 1.732-1.519 2.639-3.59 2.639-1.602 0-2.996-.468-3.313-1.902h-.005zm7.786.455c0-.269.04-.483.083-.725l.676-3.888h-.745c-.22 0-.332-.141-.29-.354l.166-.951c.029-.185.152-.298.344-.298h.8l.29-1.717c.028-.198.152-.298.344-.298h1.519c.22 0 .332.142.29.354l-.29 1.661h.966c.22 0 .332.142.29.356l-.166.951c-.029.186-.152.298-.345.298h-1.02l-.442 2.54c-.083.483-.152.851-.152 1.149 0 .468.152.624.47.624.124 0 .235-.015.318-.015.22 0 .29.17.249.383l-.152.922c-.055.356-.263.412-.76.412-1.297 0-2.443-.071-2.443-1.405m3.995.88 1.63-9.493C27.71.1 27.834 0 28.026 0h1.519c.22 0 .332.141.29.354l-1.643 9.493c-.028.198-.152.298-.344.298h-1.505c-.221 0-.332-.141-.29-.354zm3.147-1.49c0-1.844 1.905-2.468 3.906-2.71.235-.029.415-.041 1.298-.112a3.25 3.25 0 0 0 .04-.498c0-.653-.344-1.022-1.063-1.022-.622 0-1.034.269-1.229.796-.069.185-.18.27-.359.27h-1.407c-.18 0-.304-.085-.304-.241 0-.044.015-.086.028-.128.442-1.334 1.67-2.186 3.508-2.186 1.837 0 2.843.71 2.843 2.428 0 .326-.04.739-.112 1.122l-.372 2.07c-.083.484-.207 1.22-.207 1.718 0 .256-.111.341-.318.341h-1.284c-.192 0-.303-.1-.303-.282 0-.17.04-.37.068-.554-.524.539-1.2.978-2.401.978-1.422 0-2.333-.725-2.333-1.986V8.3m4.914-1.205.055-.256-.373.041c-.745.085-2.375.2-2.375 1.205 0 .525.372.78.966.78 1.103 0 1.505-.78 1.725-1.773zm2.475 2.695 1.16-6.798c.028-.2.152-.298.344-.298h1.421c.22 0 .318.142.275.356l-.11.666c.357-.524 1.13-1.193 2.4-1.193 1.382 0 2.182.88 2.182 2.256 0 .269-.029.54-.083.866l-.731 4.2c-.028.198-.152.298-.344.298h-1.519c-.22 0-.332-.141-.29-.353l.566-3.25c.083-.482.11-.851.11-1.121 0-.766-.274-1.179-.95-1.179-.898 0-1.436.725-1.671 2.086l-.608 3.52c-.028.197-.152.297-.344.297h-1.519c-.22 0-.332-.141-.29-.353m8.063-2.824c0-2.384 1.588-4.456 4.35-4.456 2.14 0 3.45 1.22 3.45 3.42 0 .256-.014.483-.04.71-.028.2-.152.297-.344.297h-5.233c.028 1.051.496 1.689 1.56 1.689.538 0 .91-.198 1.214-.51a.47.47 0 0 1 .387-.186h1.67c.193 0 .305.057.305.2 0 .042-.015.1-.069.198-.705 1.25-1.836 2.071-3.671 2.071-2.098 0-3.576-1.178-3.576-3.434zm5.591-1.405c0-.908-.484-1.476-1.421-1.476-1.009 0-1.616.71-1.78 1.476h3.203zm34.293-.611-1.504 2.6-.764-2.579a.195.195 0 0 0-.185-.141h-1.355a.15.15 0 0 0-.14.195l1.367 4.343-1.236 2.046c-.06.099.009.227.123.227h1.462a.24.24 0 0 0 .206-.12l3.817-6.465a.148.148 0 0 0-.126-.225h-1.46a.23.23 0 0 0-.204.119zM62.935 12c-.135 0-.206-.063-.206-.168 0-.032.01-.074.03-.116l.66-1.613-1.947-5.21c-.03-.084-.052-.126-.052-.189 0-.105.083-.136.216-.136h.7c.135 0 .227.073.268.2l.937 2.816c.176.527.299.886.433 1.329h.02c.176-.517.268-.823.454-1.36l.957-2.785q.078-.202.278-.2h.629c.134 0 .227.041.227.147a.5.5 0 0 1-.052.169l-2.699 6.927c-.051.127-.134.19-.268.19h-.587zm-4.082-1.772c-.927 0-1.524-.422-1.833-.906v.537c0 .158-.083.243-.237.243h-.505c-.154 0-.237-.085-.237-.243V2.803c0-.158.083-.243.237-.243h.577c.154 0 .237.085.237.243v1.381c0 .38 0 .697-.01 1.086.308-.454.906-.875 1.761-.875 1.535 0 2.523 1.244 2.523 2.921s-1.03 2.911-2.513 2.911m-.205-.876c1.009 0 1.596-.801 1.596-2.025s-.597-2.035-1.606-2.035-1.606.855-1.606 2.035.597 2.025 1.617 2.025zm12.82-1.666c1.397 0 2.58-1.043 2.796-2.454.218-1.424-.87-2.666-2.408-2.67h-2.482a.2.2 0 0 0-.192.17l-1.107 7.19a.18.18 0 0 0 .178.212h1.315a.2.2 0 0 0 .191-.169l.326-2.111a.2.2 0 0 1 .19-.17h1.194zm1.1-2.52c-.082.527-.479.915-1.24.915h-.972l.294-1.916h.955c.788 0 1.044.475.962 1zm7.386-.336h-1.246a.2.2 0 0 0-.191.169l-.042.266s-.968-1.082-2.68-.352c-.982.42-1.455 1.287-1.656 1.918 0 0-.638 1.929.803 2.988 0 0 1.336 1.019 2.842-.063l-.026.17a.18.18 0 0 0 .178.211h1.246a.2.2 0 0 0 .191-.169l.76-4.924a.182.182 0 0 0-.178-.214zm-1.831 2.72c-.108.705-.675 1.225-1.4 1.225a1.3 1.3 0 0 1-.393-.058c-.537-.178-.844-.705-.757-1.28.108-.706.676-1.226 1.403-1.226q.216 0 .392.06c.54.178.843.707.755 1.28zm11.3.136c1.396 0 2.58-1.043 2.795-2.454.218-1.424-.87-2.666-2.408-2.67h-2.48a.2.2 0 0 0-.192.17l-1.107 7.19a.18.18 0 0 0 .178.212h1.315a.2.2 0 0 0 .191-.169l.326-2.111a.2.2 0 0 1 .19-.17h1.19v.002zm1.101-2.52c-.082.527-.478.915-1.239.915h-.972l.294-1.916h.955c.786 0 1.043.475.962 1zm7.387-.336h-1.246a.2.2 0 0 0-.191.169l-.042.266s-.968-1.082-2.68-.352c-.982.42-1.455 1.287-1.655 1.918 0 0-.639 1.929.803 2.988 0 0 1.337 1.019 2.842-.063l-.027.17a.18.18 0 0 0 .178.211h1.246a.2.2 0 0 0 .191-.169l.76-4.924a.183.183 0 0 0-.18-.214m-1.831 2.72c-.109.705-.674 1.225-1.4 1.225q-.216 0-.392-.058c-.537-.178-.845-.705-.757-1.28.108-.706.677-1.226 1.402-1.226q.216 0 .392.06c.537.178.843.707.756 1.28zm3.233-4.82L98.206 9.92a.18.18 0 0 0 .178.212h1.314a.2.2 0 0 0 .192-.169l1.107-7.19a.18.18 0 0 0-.178-.213h-1.315a.2.2 0 0 0-.191.17",fill:"#333333"})))),o=()=>i.createElement("div",{className:"powered-by-paypal-fastlane","data-test":"paypal-fastlane-icon"},i.createElement(r,null))},36536:(e,t,n)=>{n.d(t,{A:()=>c});var i=n(31635),r=n(3375),o=n.n(r),a=n(70355),s=n(34953),d=n(28407);const c=(0,a.forwardRef)(((e,t)=>{var{additionalClassName:n,label:r,id:c,testId:l,themeV2:u=!1}=e,h=(0,i.__rest)(e,["additionalClassName","label","id","testId","themeV2"]);return a.createElement(a.Fragment,null,a.createElement(s.A,Object.assign({},h,{className:o()("form-checkbox","optimizedCheckout-form-checkbox",n),id:c,ref:t,testId:l,type:"checkbox"})),a.createElement(d.A,{additionalClassName:u?"body-regular":"",htmlFor:c},r))}))},37958:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(69440),r=n(70355),o=n(29853),a=n(36536),s=n(47671);const d=(0,r.memo)((({additionalClassName:e,disabled:t=!1,labelContent:n,onChange:d,name:c,id:l,testId:u,themeV2:h=!1})=>{const m=(0,r.useCallback)((({field:e})=>r.createElement(r.Fragment,null,r.createElement(a.A,Object.assign({},e,{checked:!!e.value,disabled:t,id:l||e.name,label:n,testId:u,themeV2:h})),r.createElement(s.A,{errorId:`${null!=l?l:c}-field-error-message`,name:c,testId:`${(0,i.kebabCase)(c)}-field-error-message`}))),[t,l,n,c]);return r.createElement(o.A,{additionalClassName:e,name:c,onChange:d,render:m})}))},38989:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(39981),r=n(56943),o=n(82922);const a=()=>{var e;const{checkoutState:t}=(0,i.Q)(),{getConfig:n,getPaymentProviderCustomer:a}=t.data,s=(null===(e=n())||void 0===e?void 0:e.checkoutSettings.providerWithCustomCheckout)||"",d=(0,o.A)(s),c=a()||void 0,l=(0,r.A)(c)?c:{},u=l.authenticationState,h=l.addresses||[];return{isPayPalFastlaneEnabled:d,paypalFastlaneAddresses:h,shouldShowPayPalFastlaneLabel:h.length>0&&d,shouldShowPayPalFastlaneShippingForm:h.length>0&&u&&"CANCELED"!==u&&"unrecognized"!==u}}},39009:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355),r=n(29561);const o=()=>{const e=(0,i.useContext)(r.A);if(!e)throw new Error("useAnalytics must be used within an <AnalyticsProvider>");return(0,i.useMemo)((()=>({analyticsTracker:e.analyticsTracker})),[e])}},39981:(e,t,n)=>{n.d(t,{A:()=>a,Q:()=>o});var i=n(70355);const r=(0,i.createContext)(void 0);function o(){const e=(0,i.useContext)(r);if(!e)throw new Error("useCheckout must be used within a CheckoutContextProvider");return e}const a=r},41408:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(70355),r=n(22125);const o={print:"print",mobile:`screen and (max-width: ${n(81655).P}px)`},a=(0,i.memo)((({children:e})=>i.createElement(r.A,{queries:o},e))),s=(0,i.memo)((({children:e})=>i.createElement(a,null,(t=>e(t.mobile)))))},41410:(e,t,n)=>{n.d(t,{A:()=>f});var i=n(3375),r=n.n(i),o=n(69440),a=n(70355),s=n(49655),d=n(30680),c=n(372),l=n(69462),u=n(85216),h=n(29958),m=n(33740),p=n(18336);const y=(0,a.memo)((({testId:e,onSelectedAll:t,onSelectedNone:n,themeV2:i=!1})=>{const o=(0,a.useCallback)((e=>{e.preventDefault(),t()}),[t]),d=(0,a.useCallback)((e=>{e.preventDefault(),n()}),[n]);return a.createElement("ul",{className:r()("multiCheckbox--controls",{"body-regular":i})},a.createElement("li",{className:"multiCheckbox--control"},a.createElement(s.A,{id:"address.select"})),a.createElement("li",{className:"multiCheckbox--control"},a.createElement("a",{"data-test":`${e}Checkbox-all-button`,href:"#",onClick:o},a.createElement(s.A,{id:"address.select_all"}))),a.createElement("li",{className:"multiCheckbox--control"},a.createElement("a",{"data-test":`${e}Checkbox-none-button`,href:"#",onClick:d},a.createElement(s.A,{id:"address.select_none"}))))})),g=({form:{values:e,errors:t},id:n,label:i,name:r,onChange:s=o.noop,options:d,push:c,remove:g,themeV2:v})=>{const f=(0,a.useCallback)((()=>{const t=(0,l.O6)(e,r)||[];(0,o.difference)(d.map((({value:e})=>e)),t).forEach((e=>c(e))),s((0,l.O6)(e,r))}),[r,s,d,c,e]),b=(0,a.useCallback)((()=>{((0,l.O6)(e,r)||[]).forEach((()=>g(0))),s((0,l.O6)(e,r))}),[r,s,g,e]),S=(0,a.useCallback)((t=>{const n=(0,l.O6)(e,r)||[],{value:i,checked:o}=t.target;o?c(i):g(n.indexOf(i)),s((0,l.O6)(e,r))}),[r,s,c,g,e]);return a.createElement(u.A,{hasError:(0,l.O6)(t,r)&&(0,l.O6)(t,r).length},i,d.length>1&&a.createElement(y,{onSelectedAll:f,onSelectedNone:b,testId:n,themeV2:v}),a.createElement(p.A,{fieldType:m.A.CHECKBOX,id:n,name:r,onChange:S,options:d,themeV2:v,value:(0,l.O6)(e,r)||[]}),a.createElement(h.A,{errorId:`${null!=n?n:r}-field-error-message`,name:r,testId:`${(0,o.kebabCase)(r)}-field-error-message`}))},v=(0,a.memo)((({id:e,label:t,name:n,onChange:i,options:r,themeV2:s})=>{const d=(0,a.useCallback)((d=>a.createElement(g,Object.assign({id:e,label:t,name:n,onChange:i,options:r,themeV2:s},(0,o.pick)(d,["form","pop","push","remove"])))),[e,t,n,i,r,s]);return a.createElement(l.ED,{name:n,render:d})})),f=(0,a.memo)((({field:{fieldType:e,type:t,secret:n,name:i,label:l,required:u,options:h,max:y,min:g,maxLength:f},parentFieldName:b,onChange:S,placeholder:C,inputId:w,autocomplete:_,label:I,extraClass:P,isFloatingLabelEnabled:E,themeV2:O=!1})=>{const A=w||i,k=b?`${b}.${i}`:i,T=Boolean(E&&((0,o.includes)(["text","password","dropdown","date","multiline"],e)||!e)),N=(0,a.useMemo)((()=>{let e="";return O&&(e=T?"floating-form-field-label":"body-medium"),a.createElement(c.A,{additionalClassName:e,htmlFor:A,id:`${A}-label`,isFloatingLabelEnabled:T},I||l,!u&&a.createElement(a.Fragment,null," ",a.createElement("small",{className:"optimizedCheckout-contentSecondary"},a.createElement(s.A,{id:"common.optional_text"}))))}),[O,A,T,I,l,u]),M=(0,a.useMemo)((()=>"text"===e?"integer"===t?m.A.NUMBER:(0,o.includes)(i,"phone")||(0,o.includes)(i,"tel")?m.A.TELEPHONE:n?m.A.PASSWORD:m.A.TEXT:e),[e,t,n,i]),x=(0,a.useCallback)((({field:e})=>a.createElement(p.A,Object.assign({},e,{"aria-labelledby":`${A}-label ${A}-field-error-message`,autoComplete:_,fieldType:M,id:A,isFloatingLabelEnabled:T,max:y,maxLength:f||void 0,min:g,options:h&&h.items,placeholder:C||h&&h.helperLabel,rows:null==h?void 0:h.rows,themeV2:O}))),[A,_,M,T,y,f,g,h,C,O]);return a.createElement("div",{className:r()("dynamic-form-field",{"floating-form-field":T},P)},e===m.A.CHECKBOX?a.createElement(v,{id:A,label:N,name:k,onChange:S,options:h&&h.items||[],themeV2:O}):a.createElement(d.A,{id:A,input:x,isFloatingLabelEnabled:T,label:N,name:k,onChange:S}))}))},43586:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(31635),r=n(3375),o=n.n(r),a=n(70355);const s=e=>{var{children:t,className:n,hidden:r,testId:s,themeV2:d=!1}=e,c=(0,i.__rest)(e,["children","className","hidden","testId","themeV2"]);return a.createElement("legend",Object.assign({},c,{className:o()(n||"form-legend",{"is-srOnly":r},{"optimizedCheckout-headingSecondary":!r},{"sub-header":d&&!r}),"data-test":s}),t)}},45080:(e,t,n)=>{n.d(t,{A:()=>d,l:()=>i});var i,r=n(31635),o=n(3375),a=n.n(o),s=n(70355);function d(e){return(0,s.memo)((t=>{var{additionalClassName:n,size:o,testId:d}=t,c=(0,r.__rest)(t,["additionalClassName","size","testId"]);return s.createElement("div",{className:a()("icon",n,o===i.Small?"icon--small":null,o===i.Large?"icon--large":null,o===i.Medium?"icon--medium":null),"data-test":d},s.createElement(e,Object.assign({},c)))}))}!function(e){e.Regular="regular",e.Small="small",e.Medium="medium",e.Large="large"}(i||(i={}))},45293:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(70355);var r=n(39981);var o,a;const s=(o=r.A,a={displayNamePrefix:"WithCheckout"},e=>t=>{const n=(0,i.memo)((e=>i.createElement(t,Object.assign({},e)))),r=t=>{const r=(0,i.useContext)(o),a=(0,i.useMemo)((()=>function(e){return 0===e.length}(e)?e():e),[]),s=r?a(r,t):r;if(!s)return null;const d=Object.assign(Object.assign({},s),t);return i.createElement(n,Object.assign({},d))};return a&&a.displayNamePrefix&&t&&(r.displayName=`${a.displayNamePrefix}(${t.displayName||t.name})`),r})},45707:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(70355);const r=({openByDefault:e,children:t})=>{const[n,r]=(0,i.useState)(Boolean(e));return t({isOpen:n,toggle:e=>{e.preventDefault(),r(!n)}})}},46487:(e,t,n)=>{n.d(t,{Ak:()=>i,Ay:()=>l,Mp:()=>r});var i,r,o=n(31635),a=n(3375),s=n.n(a),d=n(70355);function c(e){const{className:t,isFullWidth:n,isLoading:o,size:a,variant:d}=e;return s()("button",t,{"button--primary":d===i.Primary},{"button--tertiary":d===i.Secondary},{"button--action":d===i.Action},{"button--small":a===r.Small},{"button--tiny":a===r.Tiny},{"button--large":a===r.Large},{"button--slab":n},{"optimizedCheckout-buttonPrimary":d===i.Primary||d===i.Action},{"optimizedCheckout-buttonSecondary":d===i.Secondary},{"is-loading":o})}!function(e){e.Primary="primary",e.Secondary="secondary",e.Action="action"}(i||(i={})),function(e){e.Small="small",e.Tiny="tiny",e.Large="large"}(r||(r={}));const l=e=>{var{children:t,className:n,disabled:i,isFullWidth:r,isLoading:a,size:s,testId:l,type:u,variant:h}=e,m=(0,o.__rest)(e,["children","className","disabled","isFullWidth","isLoading","size","testId","type","variant"]);return d.createElement("button",Object.assign({},m,{className:c({className:n,isFullWidth:r,isLoading:a,size:s,variant:h}),"data-test":l,disabled:i||a,type:u||"button"}),t)}},47135:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(69440);const r=e=>(0,i.omit)(e,["id","shouldSaveAddress","stateOrProvince","type","email","country","customFields"]),o=(e,t)=>!(!t||0===t.length)&&t.some((t=>((e,t)=>(0,i.isEqual)(r(e),r(t)))(e,t)))},47671:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(69462),r=n(70355),o=n(9343);function a(e,t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}const s=(0,r.memo)((({name:e,testId:t,errorId:n})=>{const s=(0,i.j7)(),d=a(null==s?void 0:s.errors,e)&&a(null==s?void 0:s.touched,e),c=(0,r.useCallback)((t=>r.createElement("label",{"aria-live":"polite",className:"form-inlineMessage",htmlFor:e,id:n,role:"alert"},t)),[n,e]);return r.createElement(o.Ay.Consumer,null,(({isSubmitted:o})=>r.createElement("ul",{className:"form-field-errors","data-test":t},r.createElement("li",{className:"form-field-error"},d&&o?r.createElement(i.Kw,{name:e,render:c}):r.createElement("span",{"aria-hidden":"true",className:"is-srOnly",id:n})))))}))},48447:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(99418),r=n(70355),o=n(76049);const a=({data:e,id:t})=>{const{language:n}=(0,o.Y)();return r.createElement("span",{dangerouslySetInnerHTML:{__html:i.A.sanitize(n.translate(t,e),{ADD_ATTR:["target"]})}})}},49655:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355),r=n(76049);const o=({data:e,id:t})=>{const{language:n}=(0,r.Y)();return i.createElement(i.Fragment,null,n.translate(t,e))}},50981:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(69440);function r(e,...t){const n=(0,i.assign)({},...t);return`${e} {${(0,i.map)((0,i.pickBy)(n,(e=>"string"==typeof e)),((e,t)=>`${(0,i.kebabCase)(t)}: ${e};`)).join(" ")}}`}class o{parse(e){const t=[];return e.body&&(t.push(r("body",e.body)),t.push(r(".optimizedCheckout-overlay",e.body))),e.text&&t.push(r(".optimizedCheckout-contentPrimary",e.text)),e.secondaryText&&t.push(r(".optimizedCheckout-contentSecondary",e.secondaryText)),e.heading&&t.push(r(".optimizedCheckout-headingPrimary",e.heading)),e.secondaryHeading&&t.push(r(".optimizedCheckout-headingSecondary",e.secondaryHeading)),e.link&&(t.push(r("a",e.link)),t.push(r("a:focus",e.link,e.link.focus)),t.push(r("a:hover",e.link,e.link.hover))),e.label&&(t.push(r(".optimizedCheckout-form-label",e.label)),t.push(r(".form-field--error .optimizedCheckout-form-label",e.label,e.label.error)),t.push(r(".form-field--error .form-inlineMessage",e.label,e.label.error))),e.button&&(t.push(r(".optimizedCheckout-buttonPrimary",e.button)),t.push(r(".optimizedCheckout-buttonPrimary:active",e.button,e.button.active)),t.push(r(".optimizedCheckout-buttonPrimary:focus",e.button,e.button.focus)),t.push(r(".optimizedCheckout-buttonPrimary:hover",e.button,e.button.hover)),t.push(r(".optimizedCheckout-buttonPrimary[disabled]",e.button,e.button.disabled)),t.push(r(".optimizedCheckout-buttonPrimary[disabled]:active",e.button,e.button.disabled)),t.push(r(".optimizedCheckout-buttonPrimary[disabled]:focus",e.button,e.button.disabled)),t.push(r(".optimizedCheckout-buttonPrimary[disabled]:hover",e.button,e.button.disabled)),t.push(r(".optimizedCheckout-buttonPrimary[disabled].is-active",e.button,e.button.disabled)),t.push(r(".optimizedCheckout-buttonPrimary[disabled].is-loading",e.button,e.button.disabled))),e.secondaryButton&&(t.push(r(".optimizedCheckout-buttonSecondary",e.secondaryButton)),t.push(r(".optimizedCheckout-buttonSecondary:active",e.secondaryButton,e.secondaryButton.active)),t.push(r(".optimizedCheckout-buttonSecondary:focus",e.secondaryButton,e.secondaryButton.focus)),t.push(r(".optimizedCheckout-buttonSecondary:hover",e.secondaryButton,e.secondaryButton.hover)),t.push(r(".optimizedCheckout-buttonSecondary[disabled]",e.secondaryButton,e.secondaryButton.disabled)),t.push(r(".optimizedCheckout-buttonSecondary[disabled]:active",e.secondaryButton,e.secondaryButton.disabled)),t.push(r(".optimizedCheckout-buttonSecondary[disabled]:focus",e.secondaryButton,e.secondaryButton.disabled)),t.push(r(".optimizedCheckout-buttonSecondary[disabled]:hover",e.secondaryButton,e.secondaryButton.disabled)),t.push(r(".optimizedCheckout-buttonSecondary[disabled].is-active",e.secondaryButton,e.secondaryButton.disabled)),t.push(r(".optimizedCheckout-buttonSecondary[disabled].is-loading",e.secondaryButton,e.secondaryButton.disabled))),e.input&&(t.push(r(".optimizedCheckout-form-input",e.input)),t.push(r(".optimizedCheckout-form-input:focus",e.input,e.input.focus)),t.push(r(".optimizedCheckout-form-input:hover",e.input,e.input.hover)),t.push(r(".optimizedCheckout-form-input::placeholder",e.input,e.input.placeholder)),t.push(r(".form-field--error .optimizedCheckout-form-input",e.input,e.input.error)),t.push(r(".form-field--error .optimizedCheckout-form-input:focus",e.input,e.input.error)),t.push(r(".form-field--error .optimizedCheckout-form-input:hover",e.input,e.input.error))),e.select&&(t.push(r(".optimizedCheckout-form-select",e.select)),t.push(r(".optimizedCheckout-form-select:focus",e.select,e.select.focus)),t.push(r(".optimizedCheckout-form-select:hover",e.select,e.select.hover)),t.push(r(".form-field--error .optimizedCheckout-form-select",e.select,e.select.error)),t.push(r(".form-field--error .optimizedCheckout-form-select:focus",e.select,e.select.error)),t.push(r(".form-field--error .optimizedCheckout-form-select:hover",e.select,e.select.error))),e.checkbox&&(t.push(r(".optimizedCheckout-form-checkbox",e.checkbox)),t.push(r(".optimizedCheckout-form-checkbox:focus",e.checkbox,e.checkbox.focus)),t.push(r(".optimizedCheckout-form-checkbox:hover",e.checkbox,e.checkbox.hover)),t.push(r(".form-field--error .optimizedCheckout-form-checkbox",e.checkbox,e.checkbox.error)),t.push(r(".form-field--error .optimizedCheckout-form-checkbox:focus",e.checkbox,e.checkbox.error)),t.push(r(".form-field--error .optimizedCheckout-form-checkbox:hover",e.checkbox,e.checkbox.error))),e.radio&&(t.push(r(".optimizedCheckout-form-radio",e.radio)),t.push(r(".optimizedCheckout-form-radio:focus",e.radio,e.radio.focus)),t.push(r(".optimizedCheckout-form-radio:hover",e.radio,e.radio.hover)),t.push(r(".form-field--error .optimizedCheckout-form-radio",e.radio,e.radio.error)),t.push(r(".form-field--error .optimizedCheckout-form-radio:focus",e.radio,e.radio.error)),t.push(r(".form-field--error .optimizedCheckout-form-radio:hover",e.radio,e.radio.error))),e.step&&(t.push(r(".optimizedCheckout-checkoutStep",e.step)),t.push(r(".optimizedCheckout-step",e.step.icon))),e.checklist&&(t.push(r(".optimizedCheckout-form-checklist",e.checklist)),t.push(r(".optimizedCheckout-form-checklist-item",e.checklist)),t.push(r(".optimizedCheckout-form-checklist-item:hover",e.checklist,e.checklist.hover)),t.push(r(".optimizedCheckout-form-checklist-item--selected",e.checklist,e.checklist.checked))),e.discountBanner&&t.push(r(".optimizedCheckout-discountBanner",e.discountBanner)),e.loadingBanner&&t.push(r(".optimizedCheckout-loadingToaster",e.loadingBanner)),e.orderSummary&&(t.push(r(".optimizedCheckout-orderSummary",e.orderSummary)),t.push(r(".optimizedCheckout-orderSummary-cartSection",e.orderSummary))),t}}class a{constructor(e){this._parser=e}append(e){return function(e){const t=document.createElement("style");if(document.head.appendChild(t),t.sheet instanceof CSSStyleSheet){const{sheet:n}=t;e.forEach(((e,t)=>{n.insertRule(e,t)}))}return t}(this._parser.parse(e))}}function s(){const e=new o;return new a(e)}},51492:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(37255),r=n.n(i);function o(e){try{return r()(e).toUpperCase()}catch(e){}}},51541:(e,t,n)=>{function i(e,t,n){var i,r;const o=[];for(const[t,i]of Object.entries(n))for(const n of i){const i={name:t,matches:0,default:!1};for(const[t,r]of Object.entries(n)){if(t in e&&e[t]!==r){i.matches=0;break}e[t]===r&&i.matches++,"default"===t&&!0===r&&(i.default=!0)}o.push(i)}const a=o.sort(((e,t)=>t.matches-e.matches)).find((e=>e.matches>0)),s=null!==(i=null==a?void 0:a.name)&&void 0!==i?i:null===(r=o.find((e=>e.default)))||void 0===r?void 0:r.name;if(s)return t[s]}n.d(t,{A:()=>i})},53056:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(70355),r=n(49655),o=n(17851),a=n(79877);const s=(0,i.memo)((({cart:e,consignment:t})=>{const n=(0,o.A)(e,t);return i.createElement("div",{className:"staticConsignment-items"},i.createElement("strong",null,i.createElement(r.A,{data:{count:(0,a.A)(n)},id:"cart.item_count_text"})),i.createElement("ul",null,n.map((e=>i.createElement("li",{key:e.id},`${e.quantity} x ${e.name}`)))))}))},53133:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(70355);const r=(0,n(45080).A)((()=>i.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},i.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}))))},53156:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(98227),r=n(70355),o=n(29561);function a(e,t=[]){let n;return()=>n||(n=e(...t),n)}const s=({checkoutService:e,children:t})=>{const n=(0,r.useMemo)((()=>a(i.PN,[e])),[e]),s=(0,r.useMemo)((()=>a(i.n7,[e.subscribe])),[e]),d=(0,r.useMemo)((()=>a(i.G8,[e])),[e]),c=(0,r.useMemo)((()=>a(i.Gl,[e])),[e]),l={checkoutBegin:()=>{n().trackCheckoutStarted(),s().checkoutBegin()},trackStepCompleted:e=>{n().trackStepCompleted(e),s().stepCompleted(e)},trackStepViewed:e=>{n().trackStepViewed(e)},orderPurchased:()=>{n().trackOrderComplete(),s().orderPurchased()},customerEmailEntry:e=>{s().customerEmailEntry(e)},customerSuggestionInit:e=>{s().customerSuggestionInit(e)},customerSuggestionExecute:()=>{s().customerSuggestionExecute()},customerPaymentMethodExecuted:e=>{s().customerPaymentMethodExecuted(e),d().customerPaymentMethodExecuted(),c().customerPaymentMethodExecuted()},showShippingMethods:()=>{s().showShippingMethods()},selectedPaymentMethod:(e,t)=>{s().selectedPaymentMethod(e),d().selectedPaymentMethod(t),c().selectedPaymentMethod(t)},clickPayButton:e=>{s().clickPayButton(e)},paymentRejected:()=>{s().paymentRejected()},paymentComplete:()=>{s().paymentComplete(),d().paymentComplete(),c().paymentComplete()},exitCheckout:()=>{s().exitCheckout()},walletButtonClick:e=>{d().walletButtonClick(e),c().walletButtonClick(e)}};return r.createElement(o.A.Provider,{value:{analyticsTracker:l}},t)}},54298:(e,t,n)=>{n.d(t,{M:()=>d,v:()=>b});var i={};n.r(i),n.d(i,{createReRenderShippingFormHandler:()=>y,createReRenderShippingStepHandler:()=>g,createReloadCheckoutHandler:()=>h,createSetIframeStyleHandler:()=>m,createShowLoadingIndicatorHandler:()=>p});var r={};n.r(r),n.d(r,{createGetConsignmentHandler:()=>v});var o=n(70355),a=n(90184);const s=(e,t)=>{switch(t.type){case d.SHOW_LOADING_INDICATOR:if("boolean"==typeof t.payload)return Object.assign(Object.assign({},e),{isShowingLoadingIndicator:t.payload});break;case d.RE_RENDER_SHIPPING_FORM:if("number"==typeof t.payload)return Object.assign(Object.assign({},e),{shippingFormRenderTimestamp:t.payload});break;default:return e}return e};var d,c=n(31635),l=n(7944),u=n(98227);function h({checkoutService:e}){return{commandType:u.Pi.ReloadCheckout,handler:()=>{var t;e.loadCheckout(null===(t=e.getState().data.getCheckout())||void 0===t?void 0:t.id,{params:{include:["consignments.availableShippingOptions"]}})}}}function m({extension:e}){return{commandType:u.Pi.SetIframeStyle,handler:t=>{const{style:n}=t.payload,i=document.querySelector(`div[data-extension-id="${e.id}"]`),r=null==i?void 0:i.querySelector("iframe");r&&Object.assign(r.style,n)}}}function p({dispatch:e}){return{commandType:u.Pi.ShowLoadingIndicator,handler:t=>{const{show:n}=t.payload;e({type:d.SHOW_LOADING_INDICATOR,payload:n})}}}function y({checkoutService:e,dispatch:t}){return{commandType:u.Pi.ReRenderShippingForm,handler:()=>(0,c.__awaiter)(this,void 0,void 0,(function*(){var n;yield e.loadCheckout(null===(n=e.getState().data.getCheckout())||void 0===n?void 0:n.id,{params:{include:["consignments.availableShippingOptions"]}}),t({type:d.RE_RENDER_SHIPPING_FORM,payload:Date.now()})}))}}function g({checkoutService:e,dispatch:t}){return{commandType:u.Pi.ReRenderShippingStep,handler:()=>(0,c.__awaiter)(this,void 0,void 0,(function*(){var n;yield e.loadCheckout(null===(n=e.getState().data.getCheckout())||void 0===n?void 0:n.id,{params:{include:["consignments.availableShippingOptions"]}}),t({type:d.RE_RENDER_SHIPPING_FORM,payload:Date.now()})}))}}function v({checkoutService:e,extension:t}){return{queryType:u.ow.GetConsignments,handler:n=>(0,c.__awaiter)(this,void 0,void 0,(function*(){var i,r;(null===(i=n.payload)||void 0===i?void 0:i.useCache)||(yield e.loadCheckout());const o=(null===(r=e.getState().data.getCheckout())||void 0===r?void 0:r.consignments)||[];e.postMessageToExtension(t.id,{type:"EXTENSION:GET_CONSIGNMENTS",payload:{consignments:o}})}))}}class f{constructor(e,t,n){this.checkoutService=e,this.dispatch=t,this.errorLogger=n,this.handlers={}}loadExtensions(){return(0,c.__awaiter)(this,void 0,void 0,(function*(){yield this.checkoutService.loadExtensions()}))}preloadExtensions(){var e,t;const n=this.checkoutService.getState(),i=n.data.getExtensions(),r=null===(e=n.data.getCart())||void 0===e?void 0:e.id,o=null===(t=n.data.getConfig())||void 0===t?void 0:t.links.siteLink;r&&o&&(null==i||i.forEach((e=>{const t=new URL(e.url);t.searchParams.set("extensionId",e.id),t.searchParams.set("cartId",r),t.searchParams.set("parentOrigin",o);const n=document.createElement("link");n.rel="preload",n.as="document",n.href=t.toString();document.head.appendChild(n)})))}renderExtension(e,t){return(0,c.__awaiter)(this,void 0,void 0,(function*(){const n=this.checkoutService.getState().data.getExtensionByRegion(t);if(n)try{yield this.checkoutService.renderExtension(e,t),this.registerHandlers(n)}catch(e){e instanceof Error&&this.errorLogger.log(e,{errorCode:"checkoutExtension"},l.f.Error,{extensionId:n.id,region:t})}}))}removeListeners(e){this.checkoutService.clearExtensionCache(e);const t=this.checkoutService.getState().data.getExtensionByRegion(e);if(!t)return;const n=this.handlers[t.id];if(n){for(const e of n)e();delete this.handlers[t.id]}}isRegionEnabled(e){const t=this.checkoutService.getState().data.getExtensionByRegion(e);return Boolean(t)}registerHandlers(e){const t={checkoutService:this.checkoutService,dispatch:this.dispatch,extension:e};this.handlers[e.id]||(this.handlers[e.id]=[]),Object.values(i).forEach((n=>{const i=n(t);this.isCommandHandler(i.commandType,i)&&this.handlers[e.id].push(this.checkoutService.handleExtensionCommand(e.id,i.commandType,i.handler))})),Object.values(r).forEach((n=>{const i=n(t);this.isQueryHandler(i.queryType,i)&&this.handlers[e.id].push(this.checkoutService.handleExtensionQuery(e.id,i.queryType,i.handler))}))}isCommandHandler(e,t){return t.commandType===e}isQueryHandler(e,t){return t.queryType===e}}!function(e){e[e.SHOW_LOADING_INDICATOR=0]="SHOW_LOADING_INDICATOR",e[e.RE_RENDER_SHIPPING_FORM=1]="RE_RENDER_SHIPPING_FORM"}(d||(d={}));const b=({checkoutService:e,children:t,errorLogger:n})=>{const[i,r]=(0,o.useReducer)(s,{isShowingLoadingIndicator:!1,shippingFormRenderTimestamp:void 0}),d={extensionService:new f(e,r,n),extensionState:i};return o.createElement(a.F.Provider,{value:d},t)}},54454:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(31635),r=n(3375),o=n.n(r),a=n(70355),s=n(34953);const d=(0,a.forwardRef)(((e,t)=>{var{additionalClassName:n,isFloatingLabelEnabled:r,appearFocused:d,type:c="text",themeV2:l=!1}=e,u=(0,i.__rest)(e,["additionalClassName","isFloatingLabelEnabled","appearFocused","type","themeV2"]);return a.createElement(s.A,Object.assign({},u,{className:o()("form-input","optimizedCheckout-form-input",{"form-input--focus":d},{"optimizedCheckout-form-input--focus":d},n,{"floating-form-field-input":l&&r},{"body-regular":l&&!r}),isFloatingLabelEnabled:r,ref:t,type:c}))}))},55020:(e,t,n)=>{function i(e=document.location.pathname){return"/embedded-checkout"===`/${e.split("/")[1]}`}n.d(t,{A:()=>i})},56943:(e,t,n)=>{function i(e){return!!e&&("authenticationState"in e||"addresses"in e||"instruments"in e)}n.d(t,{A:()=>i})},57345:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(70355),r=n(8542),o=n(49655),a=n(85814);const s=e=>"ChunkLoadError"===e.name,d=({loadingSkeleton:e,children:t})=>i.createElement(r.A,{fallback:i.createElement("div",{className:"lazyContainer-error"},i.createElement(o.A,{id:"common.unstable_network_error"})),filter:s},i.createElement(i.Suspense,{fallback:e||i.createElement(a.A,{isLoading:!0})},t))},57398:(e,t,n)=>{function i(e){return"giftcertificate"===e.providerId}n.d(t,{A:()=>i})},58330:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(3375),r=n.n(i),o=n(70355);const a=({children:e,additionalClassName:t})=>o.createElement("h2",{className:r()("modal-header-title optimizedCheckout-headingSecondary",t),"data-test":"modal-heading"},e)},59713:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(69440);function r(e,t,n){const r=window.getComputedStyle(e,n);return t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:r.getPropertyValue((0,i.kebabCase)(t))})),{})}},60045:(e,t,n)=>{function i(e){return"storecredit"===e.providerId}n.d(t,{A:()=>i})},60489:(e,t,n)=>{n.d(t,{O:()=>o});var i=n(70355),r=n(90184);const o=()=>{const e=(0,i.useContext)(r.F);if(!e)throw new Error("useExtensions must be used within an <ExtensionProvider>");return e}},60833:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(31635),r=n(3375),o=n.n(r),a=n(70355);const s=(0,a.forwardRef)(((e,t)=>{var{additionalClassName:n,children:r,className:s,legend:d,testId:c}=e,l=(0,i.__rest)(e,["additionalClassName","children","className","legend","testId"]);return a.createElement("fieldset",Object.assign({},l,{className:s||o()("form-fieldset",n),"data-test":c,ref:t}),d,a.createElement("div",{className:"form-body"},r))}))},62174:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(28058);const r=e=>e===i.A.BigCommercePaymentsCreditCards||e===i.A.BigCommercePaymentsFastLane},62562:(e,t,n)=>{var i;n.d(t,{A:()=>r}),function(e){e.Billing="billing",e.Shipping="shipping"}(i||(i={}));const r=i},62752:(e,t,n)=>{n.d(t,{A:()=>c});var i=n(31635),r=n(3375),o=n.n(r),a=n(70355),s=n(12056),d=n(372);const c=(0,a.forwardRef)(((e,t)=>{var{additionalClassName:n,label:r,id:c,themeV2:l}=e,u=(0,i.__rest)(e,["additionalClassName","label","id","themeV2"]);return a.createElement(a.Fragment,null,a.createElement(s.A,Object.assign({},u,{className:o()("form-checkbox","optimizedCheckout-form-checkbox",{"floating-form-field-input":l},n),id:c,ref:t,type:"checkbox"})),a.createElement(d.A,{htmlFor:c},r))}))},63054:(e,t,n)=>{n.d(t,{BK:()=>ye,Bf:()=>te,S1:()=>re,Tv:()=>ae,Us:()=>N});var i,r,o,a=n(38589),s=n(58002),d={};function c(e,t){return Object.assign(e,{resolveIds:t})}d.d=(e,t)=>{for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);class l extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class u extends l{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class h extends u{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}function m(e){return!("object"!=typeof e||null===e||void 0!==e.shouldSaveInstrument&&"boolean"!=typeof e.shouldSaveInstrument||void 0!==e.shouldSetAsDefaultInstrument&&"boolean"!=typeof e.shouldSetAsDefaultInstrument)}function p(e){return Boolean(e.instrumentId)}(o=i||(i={}))[o.MissingBillingAddress=0]="MissingBillingAddress",o[o.MissingCart=1]="MissingCart",o[o.MissingCheckout=2]="MissingCheckout",o[o.MissingConsignments=3]="MissingConsignments",o[o.MissingCustomer=4]="MissingCustomer",o[o.MissingCheckoutConfig=5]="MissingCheckoutConfig",o[o.MissingOrder=6]="MissingOrder",o[o.MissingOrderConfig=7]="MissingOrderConfig",o[o.MissingOrderId=8]="MissingOrderId",o[o.MissingPayment=9]="MissingPayment",o[o.MissingPaymentId=10]="MissingPaymentId",o[o.MissingPaymentInstrument=11]="MissingPaymentInstrument",o[o.MissingPaymentMethod=12]="MissingPaymentMethod",o[o.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",o[o.MissingPaymentStatus=14]="MissingPaymentStatus",o[o.MissingPaymentToken=15]="MissingPaymentToken",o[o.MissingShippingAddress=16]="MissingShippingAddress";class y extends l{constructor(e){super(function(e){switch(e){case i.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case i.MissingCart:return"Unable to proceed because cart data is unavailable.";case i.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case i.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case i.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case i.MissingCheckoutConfig:case i.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case i.MissingOrder:return"Unable to proceed because order data is unavailable.";case i.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case i.MissingPayment:return"Unable to proceed because payment data is unavailable.";case i.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case i.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case i.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}class g extends l{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(r||(r={}));class v extends l{constructor(e){super(function(e){switch(e){case r.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case r.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case r.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case r.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}const f=e=>"object"==typeof e&&null!==e&&"body"in e;class b extends l{constructor(e){super(e||"Payment process was cancelled."),this.name="PaymentMethodCancelledError",this.type="payment_cancelled"}}function S(e){return null!==e&&"object"==typeof e&&"cardNumberElementOptions"in e&&"cardCvcElementOptions"in e&&"cardExpiryElementOptions"in e&&void 0!==e.cardNumberElementOptions&&void 0!==e.cardCvcElementOptions&&void 0!==e.cardExpiryElementOptions}var C,w,_,I;!function(e){e.Solid="solid",e.Default="default"}(C||(C={})),function(e){e.Alipay="alipay",e.CardCvc="cardCvc",e.CardExpiry="cardExpiry",e.CardNumber="cardNumber",e.CreditCard="card",e.IDEAL="idealBank",e.Sepa="iban"}(w||(w={})),function(e){e.Alipay="alipay",e.CreditCard="card",e.IDEAL="ideal",e.Sepa="sepa_debit"}(_||(_={})),function(e){e.AuthFailure="auth_failure"}(I||(I={}));class P extends l{constructor(e){super(e===I.AuthFailure?"User did not authenticate":"There was an error while processing your payment. Please try again or contact us."),this.type="stripev3_error",this.subtype=e}}var E=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};const O=[w.Alipay,w.IDEAL];class A{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){return E(this,void 0,void 0,(function*(){const{stripev3:t,methodId:n,gatewayId:i}=e;if(!i)throw new u('Unable to initialize payment because "gatewayId" argument is not provided.');this.initializeOptions=t,this.isDeinitialize=!1;const r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n),{initializationData:{stripePublishableKey:o,stripeConnectedAccount:a,useIndividualCardFields:s,allowRedisplayForStoredInstruments:d}}=r;this._allowRedisplayForStoredInstruments=d;const c=this.getInitializeOptions().form;this.useIndividualCardFields=s,this.stripeV3Client=yield this.loadStripeJs(o,a),this.isCreditCard(n)&&this.shouldShowTSVHostedForm(n,i)&&c?this.hostedForm=yield this.mountCardVerificationFields(c):this.stripeElement=yield this.mountCardFields(n)}))}execute(e,t){var n,r;return E(this,void 0,void 0,(function*(){const{payment:o}=e,a=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);let d,c;if(!o||!o.paymentData)throw new h(["payment.paymentData"]);const{paymentData:l,gatewayId:u,methodId:g}=o,{shouldSaveInstrument:v,shouldSetAsDefaultInstrument:f}=m(l)?l:{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1},b=(0,s.includes)(O,g),{isStoreCreditApplied:S}=this.paymentIntegrationService.getState().getCheckoutOrThrow();S&&(yield this.paymentIntegrationService.applyStoreCredit(S));try{b&&(yield this.paymentIntegrationService.submitOrder(a,t)),u&&(yield this.paymentIntegrationService.loadPaymentMethod(u,{params:{method:g}}));const e=this.paymentIntegrationService.getState();if(p(l)){yield this.paymentIntegrationService.submitOrder(a,t);const{instrumentId:n}=l,r=e.getPaymentMethodOrThrow(o.methodId).clientToken;if(!r)throw new y(i.MissingPaymentMethod);return yield this.executeWithVaulted(o,n,f,r)}const s=e.getPaymentMethodOrThrow(g),h=yield this.confirmStripePayment(s),{clientToken:m,method:S}=s,{id:C}=null!==(r=null!==(n=h.paymentIntent)&&void 0!==n?n:h.paymentMethod)&&void 0!==r?r:{id:""};c=h.error,d={credit_card_token:{token:C},vault_payment_instrument:v,confirm:!1,set_as_default_stored_instrument:f},S===w.CreditCard&&(d.client_token=m),b||(yield this.paymentIntegrationService.submitOrder(a,t));const _=this.buildPaymentPayload(g,d,f);yield this.paymentIntegrationService.submitPayment(_)}catch(e){yield this.processAdditionalAction(this.handleEmptyPaymentIntentError(e,c),g,v,f)}}))}finalize(){return Promise.reject(new g)}deinitialize(){return this.hostedForm&&this.hostedForm.detach(),this.isDeinitialize=!0,this.unmountElement(),Promise.resolve()}buildPaymentPayload(e,t,n){return{methodId:e,paymentData:n?{formattedPayload:Object.assign(Object.assign({},t),{set_as_default_stored_instrument:n})}:{formattedPayload:t}}}isCancellationError(e){var t,n;return e&&-1!==(null===(n=null===(t=e.payment_intent.last_payment_error)||void 0===t?void 0:t.message)||void 0===n?void 0:n.indexOf("canceled"))}isAuthError(e){return"payment_intent_authentication_failure"===(null==e?void 0:e.code)}isCreditCard(e){return e===_.CreditCard}isHostedFieldAvailable(){var e;const t=this.getInitializeOptions(),n=(0,s.omitBy)(null===(e=t.form)||void 0===e?void 0:e.fields,s.isEmpty);return!(0,s.isEmpty)(n)}isHostedPaymentFormEnabled(e,t){const{getPaymentMethodOrThrow:n}=this.paymentIntegrationService.getState(),i=n(e,t);return Boolean(i.config.isHostedFormEnabled)}confirmStripePayment(e){return E(this,void 0,void 0,(function*(){const{clientToken:t,method:n,returnUrl:r}=e;if(!t)throw new y(i.MissingPaymentMethod);switch(n){case w.Alipay:return this.getStripeJs().confirmAlipayPayment(t,{return_url:r},{handleActions:!1});case w.IDEAL:{const e=this.mapStripePaymentData(_.IDEAL,r);return this.getStripeJs().confirmIdealPayment(t,e,{handleActions:!1})}case w.Sepa:{const e=this.mapStripePaymentData(_.Sepa);return this.getStripeJs().confirmSepaDebitPayment(t,e)}default:{const e=this.useIndividualCardFields?this.getStripeCardElements()[0]:this.getStripeElement(),t=this.mapStripeBillingDetails(this.paymentIntegrationService.getState().getBillingAddress(),this.paymentIntegrationService.getState().getCustomer()),n=this._allowRedisplayForStoredInstruments;return this.getStripeJs().createPaymentMethod(Object.assign({type:_.CreditCard,card:e,billing_details:t},n?{allow_redisplay:"always"}:{}))}}}))}executeWithVaulted(e,t,n,i){var r;return E(this,void 0,void 0,(function*(){const o={bigpay_token:{token:t},confirm:!0,client_token:i,set_as_default_stored_instrument:n};if(this.isHostedPaymentFormEnabled(e.methodId,e.gatewayId)&&this.hostedForm){const t=this.hostedForm;return e.paymentData&&p(e.paymentData)&&(e.paymentData=Object.assign(Object.assign({},e.paymentData),{instrumentId:JSON.stringify({token:(null===(r=e.paymentData)||void 0===r?void 0:r.instrumentId)||"",client_token:i})})),yield t.validate(),yield t.submit(e),this.paymentIntegrationService.loadCurrentOrder()}const a=this.buildPaymentPayload(e.methodId,o,n);return this.paymentIntegrationService.submitPayment(a)}))}getInitializeOptions(){if(!this.initializeOptions)throw new v(r.PaymentNotInitialized);return this.initializeOptions}getStripeCardElements(){if(!this.stripeCardElements)throw new v(r.PaymentNotInitialized);return this.stripeCardElements}getStripeElement(){if(!this.stripeElement)throw new v(r.PaymentNotInitialized);return this.stripeElement}getStripeJs(){if(!this.stripeV3Client)throw new v(r.PaymentNotInitialized);return this.stripeV3Client}handleEmptyPaymentIntentError(e,t){return f(e)&&(0,s.some)(e.body.errors,{code:"required_field"})&&t?new Error(t.message):e}loadStripeJs(e,t){return E(this,void 0,void 0,(function*(){return this.stripeV3Client?Promise.resolve(this.stripeV3Client):this.scriptLoader.load(e,t,this.paymentIntegrationService.getState().getLocale())}))}mapStripeAddress(e){if(e){const{city:t,countryCode:n,address1:i,address2:r,postalCode:o,stateOrProvinceCode:a}=e;return{city:t,country:n,line1:i,line2:r,postal_code:o,state:a}}return{line1:""}}mapStripeBillingDetails(e,t){const{firstName:n,lastName:i}=e||t||{firstName:"Guest",lastName:""},r=`${n} ${i}`.trim(),{options:o}=this.getInitializeOptions();if(this.useIndividualCardFields&&S(o)){const{zipCodeElementOptions:t}=o;if(t){const n=document.getElementById(t.containerId)?document.getElementById(t.containerId).value:"";n&&e&&(e=Object.assign(Object.assign({},e),{postalCode:n}))}}const a={address:this.mapStripeAddress(e)};if(t&&t.addresses[0]&&function(e){return"object"==typeof e&&null!==e&&"id"in e&&void 0!==e.id}(t.addresses[0])){const e=t.addresses[0],{email:n}=t,{phone:i}=e;return i?Object.assign(Object.assign({},a),{email:n,name:r,phone:i}):Object.assign(Object.assign({},a),{email:n,name:r})}if(e){const{email:t,phone:n}=e;return n?Object.assign(Object.assign({},a),{email:t,name:r,phone:n}):Object.assign(Object.assign({},a),{email:t,name:r})}return Object.assign(Object.assign({},a),{name:r})}mapStripePaymentData(e,t){const n=this.paymentIntegrationService.getState().getCustomer(),i=this.paymentIntegrationService.getState().getBillingAddress(),r={payment_method:{[e]:this.getStripeElement(),billing_details:this.mapStripeBillingDetails(i,n)}};return e===_.IDEAL?Object.assign(Object.assign({},r),{return_url:t}):r}mountCardFields(e){const{options:t,containerId:n}=this.getInitializeOptions();let i;return new Promise(((r,o)=>{switch(this.stripeElements||(this.stripeElements=this.getStripeJs().elements()),e){case w.CreditCard:if(this.useIndividualCardFields&&S(t)){const{cardNumberElementOptions:e,cardExpiryElementOptions:n,cardCvcElementOptions:r}=t,a=this.stripeElements.getElement(w.CardNumber)||this.stripeElements.create(w.CardNumber,e),s=this.stripeElements.getElement(w.CardExpiry)||this.stripeElements.create(w.CardExpiry,n),d=this.stripeElements.getElement(w.CardCvc)||this.stripeElements.create(w.CardCvc,r);this.stripeCardElements=[a,s,d],i=this.stripeCardElements[0];try{a.mount(`#${e.containerId}`),s.mount(`#${n.containerId}`),d.mount(`#${r.containerId}`)}catch(e){this.isDeinitialize||o(new u("Unable to mount Stripe component without valid container ID."))}}else{i=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{i.mount(`#${n}`)}catch(e){this.isDeinitialize||o(new u("Unable to mount Stripe component without valid container ID."))}}break;case w.IDEAL:case w.Sepa:i=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{i.mount(`#${n}`)}catch(e){this.isDeinitialize||o(new u("Unable to mount Stripe component without valid container ID."))}case w.Alipay:}r(i)}))}mountCardVerificationFields(e){return E(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getStoreConfig();if(!t)throw new y(i.MissingCheckoutConfig);const n=t.paymentSettings.bigpayBaseUrl,r=this.paymentIntegrationService.createHostedForm(n,e);return yield r.attach(),r}))}processAdditionalAction(e,t,n=!1,i=!1){return E(this,void 0,void 0,(function*(){if(!f(e))throw e;const r=(0,s.some)(e.body.errors,{code:"additional_action_required"}),o=(0,s.some)(e.body.errors,{code:"three_d_secure_required"});if(r){const t=e.body.additional_action_required;if(t&&"redirect_to_url"===t.type)return new Promise((()=>{t.data.redirect_url&&window.location.replace(t.data.redirect_url)}))}if(o){const r=e.body.three_ds_result.token,o=!1;let a,s=!1;try{a=yield this.getStripeJs().confirmCardPayment(r)}catch(e){s=!0}if(null==a?void 0:a.error){if(this.isCancellationError(a.error))throw new b;if(this.isAuthError(a.error))throw new P(I.AuthFailure);throw new Error(a.error.message)}const d={credit_card_token:{token:this.getPaymentToken(null==a?void 0:a.paymentIntent,r,s)},vault_payment_instrument:n,confirm:o},c=this.buildPaymentPayload(t,d,i);try{return yield this.paymentIntegrationService.submitPayment(c)}catch(e){throw this.handleEmptyPaymentIntentError(e,null==a?void 0:a.error)}}throw e}))}getPaymentToken(e,t,n){return!e||n?t:e.id}shouldShowTSVHostedForm(e,t){return this.isHostedFieldAvailable()&&this.isHostedPaymentFormEnabled(e,t)}unmountElement(){this.stripeElement&&(this.stripeElement.unmount(),this.stripeElement=void 0)}}class k extends l{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}class T{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}load(e,t,n){return this.scriptLoader.loadScript("https://js.stripe.com/v3/").then((()=>{if(!this.stripeWindow.Stripe)throw new k;return this.stripeWindow.Stripe(e,{stripeAccount:t,locale:n,betas:["payment_intent_beta_3","alipay_pm_beta_1"],apiVersion:"2020-03-02;alipay_beta=v1"})}))}}const N=c((e=>new A(e,new T((0,a.vQ)()))),[{gateway:"stripev3"}]);var M,x,D,z,F,B,R,L,j=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class U{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}getStripeClient(e,t,n){return j(this,void 0,void 0,(function*(){if(this.stripeWindow.bcStripeClient)return this.stripeWindow.bcStripeClient;const i=yield this.load(),{stripePublishableKey:r,stripeConnectedAccount:o}=e,a=i(r,Object.assign(Object.assign(Object.assign({},o?{stripeAccount:o}:{}),t?{betas:t}:{}),n?{apiVersion:n}:{}));return Object.assign(this.stripeWindow,{bcStripeClient:a}),a}))}getElements(e,t){return j(this,void 0,void 0,(function*(){let n=this.stripeWindow.bcStripeElements;return n?yield this.updateStripeElements(t):(n=e.elements(t),Object.assign(this.stripeWindow,{bcStripeElements:n})),n}))}updateStripeElements(e){return j(this,void 0,void 0,(function*(){const t=this.stripeWindow.bcStripeElements;t&&(t.update(e),yield t.fetchUpdates())}))}load(){return j(this,void 0,void 0,(function*(){if(!this.stripeWindow.Stripe&&(yield this.scriptLoader.loadScript("https://js.stripe.com/v3/"),!this.stripeWindow.Stripe))throw new k;return this.stripeWindow.Stripe}))}}class V extends l{constructor(e){super(e||"Unable to proceed because the client library of a payment method has thrown an unexpected error."),this.name="PaymentMethodFailedError",this.type="payment_method_client_invalid"}}!function(e){e.SHIPPING="shipping",e.BILLING="billing"}(M||(M={})),function(e){e.SPLIT="split",e.FULL="full",e.ORGANIZATION="organization"}(x||(x={})),function(e){e.CreditCard="card",e.Link="link",e.EPS="eps",e.GRABPAY="grabpay",e.BANCONTACT="bancontact",e.IDEAL="ideal",e.ALIPAY="alipay",e.KLARNA="klarna",e.OCS="optimized_checkout"}(D||(D={})),function(e){e.NEVER="never",e.AUTO="auto",e.ALWAYS="always",e.PAYMENT="payment",e.IF_REQUIRED="if_required"}(z||(z={})),function(e){e.PAYMENT="payment",e.AUTHENTICATION="linkAuthentication",e.SHIPPING="address",e.EXPRESS_CHECKOUT="expressCheckout"}(F||(F={})),function(e){e.REQUIRES_PAYMENT_METHOD="requires_payment_method",e.REQUIRES_CONFIRMATION="requires_confirmation",e.REQUIRES_ACTION="requires_action",e.PROCESSING="processing",e.SUCCEEDED="succeeded",e.CANCELED="canceled"}(B||(B={})),function(e){e.CLICK="click",e.CHANGE="change",e.READY="ready",e.SHIPPING_ADDRESS_CHANGE="shippingaddresschange",e.SHIPPING_RATE_CHANGE="shippingratechange",e.CONFIRM="confirm",e.CANCEL="cancel",e.LOADER_START="loaderstart"}(R||(R={})),function(e){e.ON_SESSION="on_session",e.OFF_SESSION="off_session"}(L||(L={}));var q=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class H{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t,this.isMounted=!1}deinitialize(){var e;null===(e=this.checkoutEventsUnsubscribe)||void 0===e||e.call(this),this.isMounted=!1}initCheckoutEventsSubscription(e,t,n,i){this.checkoutEventsUnsubscribe=this.paymentIntegrationService.subscribe((()=>q(this,void 0,void 0,(function*(){var r;const o=null==i?void 0:i.getElement(F.PAYMENT);if(o){try{yield this.updateStripePaymentIntent(e,t)}catch(e){return this.isMounted&&(o.unmount(),this.isMounted=!1),void(e instanceof Error&&(null===(r=n.onError)||void 0===r||r.call(n,e)))}this.isMounted||(yield null==i?void 0:i.fetchUpdates(),this.mountElement(o,n.containerId))}}))),(e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.outstandingBalance}),(e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.coupons}))}mountElement(e,t){document.getElementById(t)&&(e.mount(`#${t}`),this.isMounted=!0)}mapAppearanceVariables(e){return{colorPrimary:e.fieldInnerShadow,colorBackground:e.fieldBackground,colorText:e.labelText,colorDanger:e.fieldErrorText,colorTextSecondary:e.labelText,colorTextPlaceholder:e.fieldPlaceholderText,colorIcon:e.fieldPlaceholderText}}mapInputAppearanceRules(e){return{borderColor:e.fieldBorder,color:e.fieldText,boxShadow:e.fieldInnerShadow}}throwStripeError(e){if("object"==typeof(t=e)&&null!==t&&"type"in t&&(this.throwDisplayableStripeError(e),this.isCancellationError(e)))throw new b;var t;throw new V}throwDisplayableStripeError(e){if((0,s.includes)(["card_error","invalid_request_error","validation_error"],e.type))throw new Error(e.message)}isCancellationError(e){var t;const n=null===(t=null==e?void 0:e.payment_intent.last_payment_error)||void 0===t?void 0:t.message;return!!n&&-1!==n.indexOf("canceled")}throwPaymentConfirmationProceedMessage(){throw new V("We've received your order and are processing your payment. Once the payment is verified, your order will be completed. We will send you an email when it's completed. Please note, this process may take a few minutes depending on the processing times of your chosen method.")}isPaymentCompleted(e,t){return q(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getPaymentMethodOrThrow(e),{features:r}=n.getStoreConfigOrThrow().checkoutSettings;if(!i.clientToken||!t||!r["PI-626.Block_unnecessary_payment_confirmation_for_StripeUPE"])return!1;const{paymentIntent:o}=yield t.retrievePaymentIntent(i.clientToken);return(null==o?void 0:o.status)===B.SUCCEEDED}))}mapStripePaymentData(e,t,n=!1){const o=this.paymentIntegrationService.getState().getBillingAddress(),{firstName:a,lastName:s,email:d}=o||{},c=this._mapStripeAddress(o);if(!e)throw new v(r.PaymentNotInitialized);if(!(d&&c&&c.city&&c.country&&a&&s))throw new y(i.MissingBillingAddress);return{elements:e,redirect:z.IF_REQUIRED,confirmParams:Object.assign({payment_method_data:Object.assign(Object.assign({},n?{allow_redisplay:"always"}:{}),{billing_details:{email:d,address:c,name:`${a} ${s}`}})},t&&{return_url:t})}}isAdditionalActionError(e){return(0,s.some)(e,{code:"additional_action_required"})}isRedirectAction(e){const{type:t,data:{redirect_url:n}}=e;return"redirect_to_url"===t&&!!n}isOnPageAdditionalAction(e){const{type:t,data:{token:n}}=e;return"additional_action_requires_payment_method"===t&&!!n}updateStripePaymentIntent(e,t){return q(this,void 0,void 0,(function*(){const n=yield this.paymentIntegrationService.loadPaymentMethod(e,{params:{method:t}}),{clientToken:r}=n.getPaymentMethodOrThrow(t);if(!r)throw new y(i.MissingPaymentMethod);this.scriptLoader.updateStripeElements({clientSecret:r})}))}_mapStripeAddress(e){if(e){const{city:t,address1:n,address2:i,countryCode:r,postalCode:o,stateOrProvinceCode:a}=e;return Object.assign({city:t,country:r,postal_code:o,line1:n,line2:i},a?{state:a}:{})}throw new y(i.MissingBillingAddress)}}const G={body:{},headers:{},status:0};class $ extends l{constructor(e,{message:t,errors:n}={}){const{body:i,headers:r,status:o}=e||G;super(t||"An unexpected error has occurred."),this.name="RequestError",this.type="request",this.body=i,this.headers=r,this.status=o,this.errors=n||[]}}function W(e){return"object"==typeof e&&null!==e&&"initializationData"in e&&void 0!==e.initializationData&&null!==e.initializationData&&"object"==typeof e.initializationData&&"stripePublishableKey"in e.initializationData&&"stripeConnectedAccount"in e.initializationData&&"shopperLanguage"in e.initializationData&&void 0!==e.initializationData.stripePublishableKey&&void 0!==e.initializationData.stripeConnectedAccount&&void 0!==e.initializationData.shopperLanguage}const Y={ar:["ar"],bg:["bg"],cs:["cs"],da:["da"],de:["de"],el:["el"],en:["en","en-GB"],es:["es","es-419"],et:["et"],fi:["fi"],fil:["fil"],fr:["fr","fr-CA"],he:["he"],hr:["hr"],hu:["hu"],id:["id"],it:["it"],ja:["ja"],ko:["ko"],lt:["lt"],lv:["lv"],ms:["ms"],mt:["mt"],nb:["nb"],nl:["nl"],pl:["pl"],pt:["pt","pt-BR"],ro:["ro"],ru:["ru"],sk:["sk"],sl:["sl"],sv:["sv"],th:["th"],tr:["tr"],vi:["vi"],zh:["zh","zh-HK","zh-TW"]};function K(e){const[t,n]=e.replace(/_/g,"-").toLowerCase().split("-"),i=Y[t];if(!i)return"auto";const r=n?`${t}-${n.toUpperCase()}`:t;return i.indexOf(r)>-1?r:i[0]}function Q(e){return"stripeLinkAuthenticationState"in e}const J=["payment_element_beta_2","alipay_pm_beta_1","link_default_integration_beta_1","shipping_address_element_beta_1","address_element_beta_1"],Z="2020-03-02;alipay_beta=v1;link_beta=v1";var X=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ee{constructor(e,t,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=n}initialize(e){return X(this,void 0,void 0,(function*(){const{stripeupe:t,methodId:n,gatewayId:i}=e;if(!(null==t?void 0:t.containerId))throw new v(r.PaymentNotInitialized);if(!i)throw new u('Unable to initialize payment because "gatewayId" argument is not provided.');return this._loadStripeElement(t,i,n).catch((e=>{var n;return null===(n=t.onError)||void 0===n?void 0:n.call(t,e)})),this.stripeIntegrationService.initCheckoutEventsSubscription(i,n,t,this._stripeElements),Promise.resolve()}))}execute(e,t){return X(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n||!n.paymentData)throw new h(["payment.paymentData"]);if(!this._stripeUPEClient)throw new v(r.PaymentNotInitialized);const{paymentData:o,methodId:a,gatewayId:s}=n,{shouldSaveInstrument:d=!1,shouldSetAsDefaultInstrument:c=!1}=m(o)?o:{},l=this.paymentIntegrationService.getState(),{isStoreCreditApplied:u}=l.getCheckoutOrThrow(),y=l.getPaymentProviderCustomerOrThrow(),g=(Q(y)?y:{}).stripeLinkAuthenticationState;if(u&&(yield this.paymentIntegrationService.applyStoreCredit(u)),s){yield this.stripeIntegrationService.updateStripePaymentIntent(s,a);const{email:e}=l.getCustomerOrThrow();if(void 0!==g&&!e){const e=l.getBillingAddressOrThrow();yield this.paymentIntegrationService.updateBillingAddress(e)}}if(yield this.paymentIntegrationService.submitOrder(i,t),p(o)){const{instrumentId:e}=o;yield this._executeWithVaulted(n.methodId,e,c)}else yield this._executeWithStripeConfirmation(n.methodId,!g&&d,c)}))}finalize(){return Promise.reject(new g)}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(F.PAYMENT))||void 0===t||t.unmount(),this.stripeIntegrationService.deinitialize(),this._stripeElements=void 0,this._stripeUPEClient=void 0,Promise.resolve()}_executeWithStripeConfirmation(e,t,n){return X(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState(),{clientToken:r}=i.getPaymentMethodOrThrow(e),o=this._getPaymentPayload(e,r||"",t,n);try{yield this.paymentIntegrationService.submitPayment(o)}catch(i){yield this._processAdditionalActionWithStripeConfirmation(i,e,t,n)}}))}_executeWithVaulted(e,t,n){var i;return X(this,void 0,void 0,(function*(){const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(e),a=null===(i=r.getCart())||void 0===i?void 0:i.id;try{const i={methodId:e,paymentData:{formattedPayload:{cart_id:a,bigpay_token:{token:t},confirm:!1,client_token:o.clientToken,set_as_default_stored_instrument:n}}};return yield this.paymentIntegrationService.submitPayment(i)}catch(t){return this._processVaultedAdditionalAction(t,e,n)}}))}_loadStripeElement(e,t,n){return X(this,void 0,void 0,(function*(){const{containerId:r,style:o,render:a,initStripeElementUpdateTrigger:s}=e,d=yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:n}}),c=d.getPaymentMethodOrThrow(n),{checkoutSettings:l}=d.getStoreConfigOrThrow();if(!W(c))throw new y(i.MissingPaymentMethod);const{clientToken:u,initializationData:h}=c,{shopperLanguage:m,allowRedisplayForStoredInstruments:p=!1}=h;if(this._allowRedisplayForStoredInstruments=p,!u)throw new y(i.MissingPaymentMethod);let g;if(this._stripeUPEClient=yield this._loadStripeJs(h),this._isStripeElementUpdateEnabled=!!l.features["PI-1679.trigger_update_stripe_payment_element"]&&"function"==typeof s,o){const e=o;g={variables:this.stripeIntegrationService.mapAppearanceVariables(o),rules:{".Input":this.stripeIntegrationService.mapInputAppearanceRules(e)}}}this._stripeElements=yield this.scriptLoader.getElements(this._stripeUPEClient,{clientSecret:u,locale:K(m),appearance:g});const{getBillingAddress:v,getShippingAddress:f}=d,{postalCode:b}=f()||v()||{},S=this._stripeElements.getElement(F.PAYMENT)||this._stripeElements.create(F.PAYMENT,Object.assign({fields:{billingDetails:{email:z.NEVER,address:{country:z.NEVER,city:z.NEVER,postalCode:b?z.NEVER:z.AUTO}}},wallets:{applePay:z.NEVER,googlePay:z.NEVER}},this._getStripeElementTerms()));this.stripeIntegrationService.mountElement(S,r),S.on(R.READY,(()=>{a()})),S.on(R.CHANGE,(e=>{(null==e?void 0:e.value)&&"type"in e.value&&this._updateStripeLinkStateByElementType(e.value.type)})),this._isStripeElementUpdateEnabled&&(null==s||s(this._updateStripeElement.bind(this)))}))}_processAdditionalActionWithStripeConfirmation(e,t,n=!1,i=!1){return X(this,void 0,void 0,(function*(){if(!f(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new v(r.PaymentNotInitialized);const{data:o}=e.body.additional_action_required,{token:a}=o,{paymentIntent:s}=yield this._confirmStripePaymentOrThrow(t,o),d=this._getPaymentPayload(t,(null==s?void 0:s.id)||a,n,i);try{yield this.paymentIntegrationService.submitPayment(d)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}}))}_confirmStripePaymentOrThrow(e,t){var n,i;return X(this,void 0,void 0,(function*(){const{token:r,redirect_url:o}=t,a=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,o,!!this._allowRedisplayForStoredInstruments);let s;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this._stripeUPEClient))?yield null===(i=this._stripeUPEClient)||void 0===i?void 0:i.retrievePaymentIntent(r||""):yield null===(n=this._stripeUPEClient)||void 0===n?void 0:n.confirmPayment(a);if(s=null==t?void 0:t.error,s||!(null==t?void 0:t.paymentIntent))throw new V;return t}catch(e){this.stripeIntegrationService.throwStripeError(s)}}))}_processVaultedAdditionalAction(e,t,n=!1){var i;return X(this,void 0,void 0,(function*(){if(!t||!f(e)||!(0,s.some)(e.body.errors,{code:"three_d_secure_required"}))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new v(r.PaymentNotInitialized);const o=e.body.three_ds_result.token;let a,d=!1;try{a=yield this._stripeUPEClient.confirmCardPayment(o)}catch(e){try{a=yield this._stripeUPEClient.retrievePaymentIntent(o)}catch(e){d=!0}}if((null==a?void 0:a.error)&&this.stripeIntegrationService.throwStripeError(a.error),!(null==a?void 0:a.paymentIntent)&&!d)throw new $;const c=this._getPaymentPayload(t,d?o:null===(i=null==a?void 0:a.paymentIntent)||void 0===i?void 0:i.id,!1,n);return this.paymentIntegrationService.submitPayment(c)}))}_loadStripeJs(e){return X(this,void 0,void 0,(function*(){return this._stripeUPEClient?this._stripeUPEClient:this.scriptLoader.getStripeClient(e,J,Z)}))}_getPaymentPayload(e,t,n=!1,i=!1){var r;return{methodId:e,paymentData:{formattedPayload:{cart_id:(null===(r=this.paymentIntegrationService.getState().getCart())||void 0===r?void 0:r.id)||"",credit_card_token:{token:t},confirm:!1,vault_payment_instrument:n,set_as_default_stored_instrument:i}}}}_updateStripeElement({shouldShowTerms:e}){var t;const n=null===(t=this._stripeElements)||void 0===t?void 0:t.getElement(F.PAYMENT);null==n||n.update(Object.assign({},this._getStripeElementTerms(e)))}_getStripeElementTerms(e){let t=z.AUTO;return this._isStripeElementUpdateEnabled&&(t=e?z.AUTO:z.NEVER),{terms:{card:t}}}_updateStripeLinkStateByElementType(e){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomerOrThrow(),n=e===D.Link;!Q(t)&&n&&this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:n})}}const te=c((e=>{const t=new U((0,a.vQ)());return new ee(e,t,new H(e,t))}),[{gateway:"stripeupe"},{gateway:"stripeupe",id:"klarna"}]);var ne=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ie{constructor(e,t,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=n}initialize(e){var t;return ne(this,void 0,void 0,(function*(){const{stripeocs:n,methodId:i,gatewayId:o}=e;if(!(null==n?void 0:n.containerId))throw new v(r.PaymentNotInitialized);if(!o)throw new u('Unable to initialize payment because "gatewayId" argument is not provided.');try{yield this._initializeStripeElement(n,o,i)}catch(e){e instanceof Error&&(null===(t=n.onError)||void 0===t||t.call(n,e))}this.stripeIntegrationService.initCheckoutEventsSubscription(o,i,n,this.stripeElements)}))}execute(e,t){return ne(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{methodId:o,gatewayId:a}=n||{};if(!this.stripeClient)throw new v(r.PaymentNotInitialized);if(!a||!o)throw new u('Unable to initialize payment because "gatewayId" or "methodId" argument is not provided.');const s=this.paymentIntegrationService.getState(),{isStoreCreditApplied:d}=s.getCheckoutOrThrow();d&&(yield this.paymentIntegrationService.applyStoreCredit(d)),yield this.stripeIntegrationService.updateStripePaymentIntent(a,o),yield this.paymentIntegrationService.submitOrder(i,t);const{clientToken:c}=s.getPaymentMethodOrThrow(o),l=this._getPaymentPayload(o,c||"");try{yield this.paymentIntegrationService.submitPayment(l)}catch(e){yield this._processAdditionalAction(e,o)}}))}finalize(){return Promise.reject(new g)}deinitialize(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(F.PAYMENT);return null==t||t.unmount(),null==t||t.destroy(),this.stripeIntegrationService.deinitialize(),this.stripeElements=void 0,this.stripeClient=void 0,Promise.resolve()}_initializeStripeElement(e,t,n){return ne(this,void 0,void 0,(function*(){let r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n);if((null==r?void 0:r.clientToken)||(r=(yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:n}})).getPaymentMethodOrThrow(n)),!W(r))throw new y(i.MissingPaymentMethod);const{clientToken:o,initializationData:a}=r,{shopperLanguage:s,customerSessionToken:d,enableLink:c}=a;if(!o)throw new y(i.MissingPaymentMethod);this.stripeClient=yield this._loadStripeJs(a);const{appearance:l,containerId:u,fonts:h,layout:m,render:p,paymentMethodSelect:g,handleClosePaymentMethod:v,togglePreloader:f}=e;this.stripeElements=yield this.scriptLoader.getElements(this.stripeClient,{clientSecret:o,customerSessionClientSecret:d,locale:K(s),appearance:l,fonts:h});const{getBillingAddress:b,getShippingAddress:S}=this.paymentIntegrationService.getState(),C=b(),{postalCode:w}=S()||C||{},_=this.stripeElements.getElement(F.PAYMENT)||this.stripeElements.create(F.PAYMENT,{fields:{billingDetails:{email:z.NEVER,address:{country:z.NEVER,city:z.NEVER,postalCode:w?z.NEVER:z.AUTO}}},wallets:{applePay:z.NEVER,googlePay:z.NEVER,link:c?z.AUTO:z.NEVER},layout:m,savePaymentMethod:{maxVisiblePaymentMethods:20},defaultValues:{billingDetails:{email:(null==C?void 0:C.email)||""}}});this.stripeIntegrationService.mountElement(_,u),_.on(R.LOADER_START,(()=>{null==f||f(!1)})),_.on(R.READY,(()=>{p()})),_.on(R.CHANGE,(e=>{this._onStripeElementChange(e,t,n,g)})),null==v||v(this._collapseStripeElement.bind(this))}))}_loadStripeJs(e){return ne(this,void 0,void 0,(function*(){return this.stripeClient?this.stripeClient:this.scriptLoader.getStripeClient(e)}))}_collapseStripeElement(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(F.PAYMENT);null==t||t.collapse()}_getPaymentPayload(e,t,n){var i;const r=(null===(i=this.paymentIntegrationService.getState().getCart())||void 0===i?void 0:i.id)||"",{card:o,us_bank_account:a}=n||{},s=this._shouldSaveInstrument(o)||this._shouldSaveInstrument(a),d=this._getTokenizedOptions(t,n);return{methodId:e,paymentData:{formattedPayload:Object.assign({cart_id:r,confirm:!1,method:this.selectedMethodId,vault_payment_instrument:s},d)}}}_processAdditionalAction(e,t){return ne(this,void 0,void 0,(function*(){if(!f(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this.stripeClient||!this.stripeElements)throw new v(r.PaymentNotInitialized);const{data:n}=e.body.additional_action_required,{token:i}=n,{paymentIntent:o}=yield this._confirmStripePaymentOrThrow(t,n),{client_secret:a,payment_method_options:s}=o||{},d=this._getPaymentPayload(t,a||i,s);try{return yield this.paymentIntegrationService.submitPayment(d)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}}))}_confirmStripePaymentOrThrow(e,t){var n,i;return ne(this,void 0,void 0,(function*(){const{token:r,redirect_url:o}=t,a=this.stripeIntegrationService.mapStripePaymentData(this.stripeElements,o);let s;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this.stripeClient))?yield null===(i=this.stripeClient)||void 0===i?void 0:i.retrievePaymentIntent(r||""):yield null===(n=this.stripeClient)||void 0===n?void 0:n.confirmPayment(a);if(s=null==t?void 0:t.error,s||!(null==t?void 0:t.paymentIntent))throw new V;return t}catch(e){return this.stripeIntegrationService.throwStripeError(s)}}))}_onStripeElementChange(e,t,n,i){(e=>"object"==typeof e&&null!==e&&"value"in e&&"collapsed"in e)(e)&&!e.collapsed&&(this.selectedMethodId=e.value.type,null==i||i(`${t}-${n}`))}_shouldSaveInstrument(e){const t=null==e?void 0:e.setup_future_usage;return t===L.ON_SESSION||t===L.OFF_SESSION}_getTokenizedOptions(e,t){return this._shouldSaveInstrument(null==t?void 0:t.us_bank_account)?{tokenized_ach:{token:e}}:{credit_card_token:{token:e}}}}const re=c((e=>{const t=new U((0,a.vQ)());return new ie(e,t,new H(e,t))}),[{gateway:"stripeocs",id:"optimized_checkout"}]);class oe{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){var t,n,r,o;return n=this,o=function*(){let n;if(!e.stripeupe)throw new u('Unable to proceed because "options" argument is not provided.');const{container:r,gatewayId:o,methodId:a,onEmailChange:s,getStyles:d,isLoading:c}=e.stripeupe;Object.entries(e.stripeupe).forEach((([e,t])=>{if(!t)throw new u(`Unable to proceed because "${e}" argument is not provided.`)})),yield this.paymentIntegrationService.loadPaymentMethod(o,{params:{method:a}});const l=this.paymentIntegrationService.getState(),h=l.getPaymentMethodOrThrow(a,o),{clientToken:m}=h;if(!W(h)||!m)throw new y(i.MissingPaymentToken);const{email:p}=l.getCustomerOrThrow(),g=l.getPaymentProviderCustomerOrThrow(),v=(Q(g)?g:{}).stripeLinkAuthenticationState;if(!p){let e;const o="function"==typeof d&&d();e=o?{variables:{colorPrimary:o.fieldInnerShadow,colorBackground:o.fieldBackground,colorText:o.labelText,colorDanger:o.fieldErrorText,colorTextSecondary:o.labelText,colorTextPlaceholder:o.fieldPlaceholderText},rules:{".Input":{borderColor:o.fieldBorder,color:o.fieldText,boxShadow:o.fieldInnerShadow}}}:{},n=yield this.scriptLoader.getStripeClient(h.initializationData,J,Z),this._stripeElements=yield this.scriptLoader.getElements(n,{clientSecret:m,appearance:e});const{getBillingAddress:a,getConsignments:l}=this.paymentIntegrationService.getState(),u=l(),p=null===(t=null==u?void 0:u[0])||void 0===t?void 0:t.id,{email:g}=a()||{},f=g?{defaultValues:{mode:M.SHIPPING,email:g}}:{},b=this._stripeElements.getElement(F.AUTHENTICATION)||this._stripeElements.create(F.AUTHENTICATION,f);b.on(R.CHANGE,(e=>{if(!("authenticated"in e))throw new y(i.MissingCustomer);this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:e.authenticated}),e.complete?s(e.authenticated,e.value.email):s(!1,""),c&&c(!1),void 0===v&&e.authenticated&&p&&this.paymentIntegrationService.deleteConsignment(p)})),b.mount(`#${r}`)}},new((r=void 0)||(r=Promise))((function(e,t){function i(e){try{s(o.next(e))}catch(e){t(e)}}function a(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,a)}s((o=o.apply(n,[])).next())}))}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(F.AUTHENTICATION))||void 0===t||t.unmount(),Promise.resolve()}signIn(e,t){return this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}signOut(e){return this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}}const ae=c((e=>new oe(e,new U((0,a.vQ)()))),[{id:"stripeupe"}]),se={size:70,color:"#d9d9d9",backgroundColor:"#ffffff"},de={position:"fixed","background-color":"rgba(0, 0, 0, 0.4)","z-index":"1000"},ce="embedded-checkout-loading-indicator-rotation";class le{constructor(e){this.styles=Object.assign(Object.assign({},se),e&&e.styles),this.containerStyles=Object.assign({},e&&e.containerStyles),this.defineAnimation(),this.container=this.buildContainer(),this.indicator=this.buildIndicator(),this.container.appendChild(this.indicator)}show(e){if(e){const t=document.getElementById(e);if(!t)throw new Error("Unable to attach the loading indicator because the parent ID is not valid.");t.appendChild(this.container)}this.container.style.visibility="visible",this.container.style.opacity="1"}hide(){const e=()=>{this.container.style.visibility="hidden",this.container.removeEventListener("transitionend",e)};this.container.addEventListener("transitionend",e),this.container.style.opacity="0"}buildContainer(){const e=document.createElement("div");return e.style.display="block",e.style.bottom="0",e.style.left="0",e.style.height="100%",e.style.width="100%",e.style.position="absolute",e.style.right="0",e.style.top="0",e.style.transition="all 250ms ease-out",e.style.opacity="0",this.setStyleAttribute(e,this.containerStyles),e}buildIndicator(){const e=document.createElement("div");return e.style.display="block",e.style.width=`${this.styles.size}px`,e.style.height=`${this.styles.size}px`,e.style.borderRadius=`${this.styles.size}px`,e.style.border="solid 1px",e.style.borderColor=`${this.styles.backgroundColor} ${this.styles.backgroundColor} ${this.styles.color} ${this.styles.color}`,e.style.margin="0 auto",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="50%",e.style.transform="translateY(-50%) rotate(0deg)",e.style.transformStyle="preserve-3d",e.style.animation=`${ce} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`,e}setStyleAttribute(e,t){Object.keys(t).forEach((n=>{e.style.setProperty(n,t[n])}))}defineAnimation(){var e;if(document.getElementById(ce))return;const t=document.createElement("style");t.id=ce,null===(e=document.head)||void 0===e||e.appendChild(t),t.sheet instanceof CSSStyleSheet&&t.sheet.insertRule(`\n                @keyframes ${ce} {\n                    0% { transform: translateY(-50%) rotate(0deg); }\n                    100% { transform: translateY(-50%) rotate(360deg); }\n                }\n            `,0)}}class ue{constructor(e){this._decimalPlaces=e}toInteger(e){return Math.round(e*Math.pow(10,this._decimalPlaces))}}const he=["AC","AD","AE","AF","AG","AI","AL","AM","AO","AQ","AR","AT","AU","AW","AX","AZ","BA","BB","BD","BE","BF","BG","BH","BI","BJ","BL","BM","BN","BO","BQ","BR","BS","BT","BV","BW","BY","BZ","CA","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CV","CW","CY","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","EG","EH","ER","ES","ET","FI","FJ","FK","FO","FR","GA","GB","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GS","GT","GU","GW","GY","HK","HN","HR","HT","HU","ID","IE","IL","IM","IN","IO","IQ","IS","IT","JE","JM","JO","JP","KE","KG","KH","KI","KM","KN","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MF","MG","MK","ML","MM","MN","MO","MQ","MR","MS","MT","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NG","NI","NL","NO","NP","NR","NU","NZ","OM","PA","PE","PF","PG","PH","PK","PL","PM","PN","PR","PS","PT","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SE","SG","SH","SI","SJ","SK","SL","SM","SN","SO","SR","SS","ST","SV","SX","SZ","TA","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TR","TT","TV","TW","TZ","UA","UG","US","UY","UZ","VA","VC","VE","VG","VN","VU","WF","WS","XK","YE","YT","ZA","ZM","ZW","ZZ"];var me=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class pe{constructor(e,t,n,i){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=n,this.loadingIndicator=i}initialize(e){return me(this,void 0,void 0,(function*(){const{stripeocs:t}=e||{};if(!t)throw new u('Unable to proceed because "options" argument is not provided.');const{methodId:n,gatewayId:o,container:a}=t;if(!a||!n||!o)throw new v(r.PaymentNotInitialized);const s=(yield this.paymentIntegrationService.loadPaymentMethod(o,{params:{method:n}})).getPaymentMethodOrThrow(n,o),{loadingContainerId:d,buttonHeight:c,onComplete:l}=t;if(this._loadingIndicatorContainer=d,this._onComplete=l,!W(s))throw new y(i.MissingPaymentMethod);const{initializationData:h}=s,{captureMethod:m}=h;return this._captureMethod=m,this._stripeClient=yield this.scriptLoader.getStripeClient(h),yield this._mountExpressCheckoutElement(n,a,this._stripeClient,c),Promise.resolve()}))}signIn(){return Promise.resolve()}signOut(){return Promise.resolve()}executePaymentMethodCheckout(){return Promise.resolve()}deinitialize(){return Promise.resolve()}_mountExpressCheckoutElement(e,t,n,i=40){return me(this,void 0,void 0,(function*(){const r=this._shouldRequireShippingAddress(),o=Object.assign(Object.assign(Object.assign({shippingAddressRequired:r},r?{allowedShippingCountries:yield this._getAvailableCountries()}:{}),r?{shippingRates:[{id:"_",amount:0,displayName:"Pending rates"}]}:{}),{billingAddressRequired:!0,emailRequired:!0,phoneNumberRequired:!0,paymentMethods:{link:z.AUTO,applePay:z.NEVER,googlePay:z.NEVER,amazonPay:z.NEVER,paypal:z.NEVER,klarna:z.NEVER},buttonHeight:i}),{cartAmount:a}=this.paymentIntegrationService.getState().getCartOrThrow(),s=Object.assign({mode:"payment",amount:this._toCents(a),currency:this._getCurrency()},this._captureMethod?{captureMethod:this._captureMethod}:{});this._stripeElements=n.elements(s),this._linkV2Element=this._stripeElements.create(F.EXPRESS_CHECKOUT,o),this._linkV2Element.mount(`#${t}`),this._initializeEvents(this._linkV2Element,e)}))}_initializeEvents(e,t){this._shouldRequireShippingAddress()&&(e.on(R.SHIPPING_ADDRESS_CHANGE,(e=>me(this,void 0,void 0,(function*(){return this._onShippingAddressChange(e)})))),e.on(R.SHIPPING_RATE_CHANGE,(e=>me(this,void 0,void 0,(function*(){return this._onShippingRateChange(e)}))))),e.on(R.CONFIRM,(e=>me(this,void 0,void 0,(function*(){return this._onConfirm(e,t)})))),e.on(R.CANCEL,this._onCancel)}_onShippingAddressChange(e){return me(this,void 0,void 0,(function*(){if("address"in e){const t=e.address,n={firstName:"",lastName:"",phone:"",company:"",address1:"",address2:"",city:(null==t?void 0:t.city)||"",countryCode:(null==t?void 0:t.country)||"",postalCode:(null==t?void 0:t.postal_code)||"",stateOrProvince:(null==t?void 0:t.state)||"",stateOrProvinceCode:"",customFields:[]};yield this.paymentIntegrationService.updateShippingAddress(n);const i=yield this._getAvailableShippingOptions();yield this._updateDisplayedPrice(),e.resolve({shippingRates:i})}}))}_onCancel(){throw new b}_onShippingRateChange(e){return me(this,void 0,void 0,(function*(){if("shippingRate"in e){const{shippingRate:t}=e;yield this._handleShippingOptionChange(null==t?void 0:t.id),yield this._updateDisplayedPrice(),e.resolve({})}}))}_onConfirm(e,t){return me(this,void 0,void 0,(function*(){if("billingDetails"in e&&"shippingAddress"in e&&this._stripeClient&&this._stripeElements){yield this._updateShippingAndBillingAddress(e),yield this.paymentIntegrationService.submitOrder();const n=this._getPaymentPayload(t);try{yield this.paymentIntegrationService.submitPayment(n)}catch(e){yield this._processAdditionalAction(e,t)}}return Promise.resolve()}))}_updateShippingAndBillingAddress(e){var t,n,i,r,o,a,s,d;return me(this,void 0,void 0,(function*(){const c=this._shouldRequireShippingAddress(),l=(null===(n=null===(t=e.shippingAddress)||void 0===t?void 0:t.name)||void 0===n?void 0:n.split(" ")[0])||(null===(r=null===(i=e.billingDetails)||void 0===i?void 0:i.name)||void 0===r?void 0:r.split(" ")[0])||"",u=(null===(a=null===(o=e.shippingAddress)||void 0===o?void 0:o.name)||void 0===a?void 0:a.split(" ")[1])||(null===(d=null===(s=e.billingDetails)||void 0===s?void 0:s.name)||void 0===d?void 0:d.split(" ")[1])||"";if(c){const t=this._mapShippingAddress(e.shippingAddress,e.billingDetails,l,u);yield this.paymentIntegrationService.updateShippingAddress(t)}const h=this._mapBillingAddress(e.shippingAddress,e.billingDetails,l,u);yield this.paymentIntegrationService.updateBillingAddress(h)}))}_mapShippingAddress(e,t,n,i){var r,o,a,s,d,c,l;return{firstName:n,lastName:i,phone:(null==t?void 0:t.phone)||"",company:"",address1:(null===(r=null==e?void 0:e.address)||void 0===r?void 0:r.line1)||"",address2:(null===(o=null==e?void 0:e.address)||void 0===o?void 0:o.line2)||"",city:(null===(a=null==e?void 0:e.address)||void 0===a?void 0:a.city)||"",countryCode:(null===(s=null==e?void 0:e.address)||void 0===s?void 0:s.country)||"",postalCode:(null===(d=null==e?void 0:e.address)||void 0===d?void 0:d.postal_code)||"",stateOrProvince:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||"",stateOrProvinceCode:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||"",customFields:[]}}_mapBillingAddress(e,t,n,i){var r,o,a,s,d,c;return{email:(null==t?void 0:t.email)||"",firstName:n,lastName:i,phone:(null==t?void 0:t.phone)||"",company:"",address1:(null===(r=null==t?void 0:t.address)||void 0===r?void 0:r.line1)||"",address2:"",city:(null===(o=null==t?void 0:t.address)||void 0===o?void 0:o.city)||"",countryCode:(null===(a=null==t?void 0:t.address)||void 0===a?void 0:a.country)||"",postalCode:(null===(s=null==t?void 0:t.address)||void 0===s?void 0:s.postal_code)||"",stateOrProvince:(null===(d=null==t?void 0:t.address)||void 0===d?void 0:d.state)||"",stateOrProvinceCode:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||"",customFields:[]}}_processAdditionalAction(e,t){return me(this,void 0,void 0,(function*(){if(!f(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeClient||!this._stripeElements)throw new v(r.PaymentNotInitialized);const{data:n}=e.body.additional_action_required,{token:i}=n,{paymentIntent:o}=yield this._confirmStripePaymentOrThrow(n,t),a=this._getPaymentPayload(t,(null==o?void 0:o.id)||i);try{this._toggleLoadingIndicator(!0),yield this.paymentIntegrationService.submitPayment(a),yield this._completeCheckoutFlow()}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}finally{this._toggleLoadingIndicator(!1)}}))}_confirmStripePaymentOrThrow(e,t){var n,i,r;return me(this,void 0,void 0,(function*(){const{token:o,redirect_url:a}=e,s=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,a);let d;try{const e=(yield this.stripeIntegrationService.isPaymentCompleted(t,this._stripeClient))?yield null===(r=this._stripeClient)||void 0===r?void 0:r.retrievePaymentIntent(o||""):yield null===(n=this._stripeClient)||void 0===n?void 0:n.confirmPayment({elements:s.elements,clientSecret:o,redirect:z.IF_REQUIRED,confirmParams:{return_url:null===(i=s.confirmParams)||void 0===i?void 0:i.return_url}});if(d=null==e?void 0:e.error,d||!(null==e?void 0:e.paymentIntent))throw new V;return e}catch(e){return this.stripeIntegrationService.throwStripeError(d)}}))}_completeCheckoutFlow(){return me(this,void 0,void 0,(function*(){return"function"==typeof this._onComplete?this._onComplete():(window.location.replace("/order-confirmation"),Promise.resolve())}))}_getPaymentPayload(e,t){var n;const i=(null===(n=this.paymentIntegrationService.getState().getCart())||void 0===n?void 0:n.id)||"";return{methodId:e,paymentData:{formattedPayload:Object.assign(Object.assign({cart_id:i},t?{credit_card_token:{token:t}}:{}),{confirm:!1,payment_method_id:D.Link})}}}_shouldRequireShippingAddress(){const{getCartOrThrow:e}=this.paymentIntegrationService.getState(),{lineItems:t}=e();return!!t.physicalItems.length}_updateDisplayedPrice(){return me(this,void 0,void 0,(function*(){this._stripeElements&&this._stripeElements.update({currency:this._getCurrency(),mode:"payment",amount:yield this._getTotalPrice()})}))}_getCurrency(){if(!this._currencyCode){const{code:e}=this.paymentIntegrationService.getState().getCartOrThrow().currency;this._currencyCode=e.toLowerCase()}return this._currencyCode}_getTotalPrice(){return me(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.loadCheckout();const{getCheckoutOrThrow:e,getCartOrThrow:t}=this.paymentIntegrationService.getState(),{decimalPlaces:n}=t().currency,i=(0,s.round)(e().outstandingBalance,n).toFixed(n);return this._toCents(+i)}))}_getAvailableCountries(){var e;return me(this,void 0,void 0,(function*(){const t=yield this.paymentIntegrationService.loadShippingCountries();return((null===(e=t.getShippingCountries())||void 0===e?void 0:e.map((e=>e.code)))||[]).filter((e=>he.includes(e)))}))}_getAvailableShippingOptions(){var e,t;return me(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getConsignments();if(!(null==n?void 0:n[0]))return;const i=n[0],r=(i.availableShippingOptions||[]).map(this._getStripeShippingOption.bind(this)),o=null===(e=i.selectedShippingOption)||void 0===e?void 0:e.id;return o?r.sort((e=>e.id===o?-1:0)):yield this._handleShippingOptionChange(null===(t=r[0])||void 0===t?void 0:t.id),r}))}_getStripeShippingOption({id:e,cost:t,description:n}){return{id:e,displayName:n,amount:this._toCents(t)}}_handleShippingOptionChange(e){return me(this,void 0,void 0,(function*(){if(e&&"shipping_option_unselected"!==e)return this.paymentIntegrationService.selectShippingOption(e)}))}_getAmountTransformer(){if(this._amountTransformer)return this._amountTransformer;const{getCart:e}=this.paymentIntegrationService.getState(),{currency:t}=e()||{};return t?new ue(t.decimalPlaces):void 0}_toCents(e){const t=Math.round(100*e),n=this._getAmountTransformer();return n?n.toInteger(e):t}_toggleLoadingIndicator(e){e&&this._loadingIndicatorContainer?this.loadingIndicator.show(this._loadingIndicatorContainer):this.loadingIndicator.hide()}}const ye=c((e=>{const t=new U((0,a.vQ)()),n=new le({containerStyles:de});return new pe(e,t,new H(e,t),n)}),[{id:"stripeocs"}])},63163:(e,t,n)=>{n.d(t,{Ak:()=>i,Ay:()=>l,Mp:()=>r});var i,r,o=n(31635),a=n(3375),s=n.n(a),d=n(70355);function c(e){const{className:t,isFullWidth:n,isLoading:o,size:a,variant:d}=e;return s()("button",t,{"button--primary":d===i.Primary},{"button--tertiary":d===i.Secondary},{"button--action":d===i.Action},{"button--small":a===r.Small},{"button--tiny":a===r.Tiny},{"button--large":a===r.Large},{"button--slab":n},{"optimizedCheckout-buttonPrimary":d===i.Primary||d===i.Action},{"optimizedCheckout-buttonSecondary":d===i.Secondary},{"is-loading":o})}!function(e){e.Primary="primary",e.Secondary="secondary",e.Action="action"}(i||(i={})),function(e){e.Small="small",e.Tiny="tiny",e.Large="large"}(r||(r={}));const l=e=>{var{children:t,className:n,disabled:i,isFullWidth:r,isLoading:a,size:s,testId:l,type:u,variant:h}=e,m=(0,o.__rest)(e,["children","className","disabled","isFullWidth","isLoading","size","testId","type","variant"]);return d.createElement("button",Object.assign({},m,{className:c({className:n,isFullWidth:r,isLoading:a,size:s,variant:h}),"data-test":l,disabled:i||a,type:u||"button"}),t)}},64022:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(70355),r=n(64975),o=n(99838);const a=()=>i.createElement("div",{className:"layout optimizedCheckout-contentPrimary"},i.createElement("div",{className:"layout-main","data-test":"order-confirmation-page-skeleton"},i.createElement("div",{className:"order-confirmation-page-skeleton"},i.createElement("div",{className:"thankyou"}),i.createElement("div",{className:"line-1"}),i.createElement("div",{className:"line-2"}),i.createElement("div",{className:"continue"}))),i.createElement(o.W,null)),s=()=>i.createElement("div",{className:"layout optimizedCheckout-contentPrimary"},i.createElement("div",{className:"layout-main","data-test":"order-confirmation-page-skeleton-mobile"},i.createElement("div",{className:"order-confirmation-page-skeleton"},i.createElement("div",{className:"thankyou"}),i.createElement("div",{className:"text"},i.createElement("div",{className:"line"},i.createElement("div",{className:"animated-grey-box t1"}),i.createElement("div",{className:"animated-grey-box t2"})),i.createElement("div",{className:"animated-grey-box first-line"}),i.createElement("div",{className:"animated-grey-box"}),i.createElement("div",{className:"line"},i.createElement("div",{className:"animated-grey-box t3"}),i.createElement("div",{className:"animated-grey-box t4"}))),i.createElement("div",{className:"continue"}))),i.createElement("div",{className:"cartDrawer optimizedCheckout-orderSummary"},i.createElement("div",{className:"checkout-page-skeleton--cartdrawer"},i.createElement("div",{className:"product"},i.createElement("div",{className:"animated-grey-box figure"}),i.createElement("div",{className:"details"},i.createElement("div",{className:"animated-grey-box name"}),i.createElement("div",{className:"animated-grey-box description"}))),i.createElement("div",{className:"animated-grey-box more"})))),d=()=>(0,r.C3)()?i.createElement(s,null):i.createElement(a,null)},64975:(e,t,n)=>{n.d(t,{C3:()=>o});const i=968;let r;function o(){return r=window.matchMedia(`(max-width: ${i}px)`),r.matches}},67313:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(69440);const r=(e,t)=>{const n=(0,i.find)(t,{code:e.countryCode}),r=!n||(0,i.isEmpty)(n.subdivisions)?[]:n.subdivisions,o=(0,i.find)(r,{code:e.stateOrProvinceCode});return Object.assign(Object.assign({},e),{localizedCountry:n?n.name:e.country,localizedProvince:o?o.name:e.stateOrProvince})}},68512:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(19445),r=n(76049);const o=(0,i.A)(r.A,{displayNamePrefix:"WithLanguage",pickProps:(e,t)=>"language"===t&&!!e})},68801:(e,t,n)=>{n.d(t,{Y:()=>d});var i,r=n(70355),o=n(39981);!function(e){e.ShippingShippingAddressFormBefore="extension-region-shipping-shippingaddressform-before",e.ShippingShippingAddressFormAfter="extension-region-shipping-shippingaddressform-after",e.ShippingSelectedShippingMethod="extension-region-shipping-selectedshippingmethod",e.PaymentPaymentMethodListBefore="extension-region-payment-paymentmethodlist-before",e.SummaryAfter="extension-region-summary-after",e.SummaryLastItemAfter="extension-region-summary-lastitem-after"}(i||(i={}));const a={"shipping.shippingAddressForm.before":i.ShippingShippingAddressFormBefore,"shipping.shippingAddressForm.after":i.ShippingShippingAddressFormAfter,"shipping.selectedShippingMethod":i.ShippingSelectedShippingMethod,"payment.paymentMethodList.before":i.PaymentPaymentMethodListBefore,"summary.after":i.SummaryAfter,"summary.lastItem.after":i.SummaryLastItemAfter,global:""};var s=n(60489);const d=({region:e})=>{const{checkoutState:{data:{getExtensions:t,getConfig:n,getCheckout:i}}}=(0,o.Q)(),d=t(),c=n(),l=i(),{extensionService:u}=(0,s.O)(),h=d&&c&&l&&u.isRegionEnabled(e),m=a[e];return(0,r.useEffect)((()=>{if(h)return u.renderExtension(m,e),()=>{u.removeListeners(e)}}),[m,h,e]),h&&""!==m?r.createElement("div",{id:m}):null}},69022:(e,t,n)=>{n.d(t,{A:()=>a,w:()=>o});var i=n(70355);const r=(0,i.createContext)(void 0),o=()=>{const e=(0,i.useContext)(r);if(!e)throw new Error("useThemeContext must be used within an <ThemeContextProvider>");return e},a=r},71161:(e,t,n)=>{function i(e){return"request"===e.type}n.d(t,{A:()=>i})},72769:(e,t,n)=>{function i(e){return t=>{t.preventDefault(),e&&e(t)}}n.d(t,{A:()=>i})},74302:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(70355),r=n(49655),o=n(47135),a=n(35172),s=n(38989),d=n(62562),c=n(75794),l=n(45293),u=n(79001);const h=(0,l.A)((function({checkoutState:e},{address:t}){const{data:{getBillingAddressFields:n,getCheckout:i}}=e,r=i();return{fields:n(t.countryCode),payments:r&&r.payments}}))((0,i.memo)((({address:e,payments:t=u.M})=>{const{paypalFastlaneAddresses:n}=(0,s.A)(),l=(0,o.A)(e,n);return t.find((e=>"amazonpay"===e.providerId))?i.createElement("p",null,i.createElement(r.A,{id:"billing.billing_address_amazonpay"})):i.createElement(i.Fragment,null,i.createElement(c.A,{address:e,type:d.A.Billing}),l&&i.createElement(a.A,null))})))},75794:(e,t,n)=>{n.d(t,{A:()=>u});var i=n(3375),r=n.n(i),o=n(69440),a=n(70355),s=n(67313),d=n(69022),c=n(45293),l=n(62562);const u=(0,c.A)((function(e,{type:t}){const{checkoutState:{data:{getBillingCountries:n,getShippingCountries:i}}}=e;return{countries:t===l.A.Billing?n():i()}}))((0,a.memo)((({countries:e,address:t})=>{const{themeV2:n}=(0,d.w)(),i=(0,s.A)(t,e);return!(0,o.isEmpty)(i)?a.createElement("div",{className:"vcard checkout-address--static","data-test":"static-address"},(i.firstName||i.lastName)&&a.createElement("p",{className:r()("fn address-entry",{"body-regular":n})},a.createElement("span",{className:"first-name"},`${i.firstName} `),a.createElement("span",{className:"family-name"},i.lastName)),(i.phone||i.company)&&a.createElement("p",{className:r()("address-entry",{"body-regular":n})},a.createElement("span",{className:"company-name"},`${i.company} `),a.createElement("span",{className:"tel"},i.phone)),a.createElement("div",{className:"adr"},a.createElement("p",{className:r()("street-address address-entry",{"body-regular":n})},a.createElement("span",{className:"address-line-1"},`${i.address1} `),i.address2&&a.createElement("span",{className:"address-line-2"},` / ${i.address2}`)),a.createElement("p",{className:r()("address-entry",{"body-regular":n})},i.city&&a.createElement("span",{className:"locality"},`${i.city}, `),i.localizedProvince&&a.createElement("span",{className:"region"},`${i.localizedProvince}, `),i.postalCode&&a.createElement("span",{className:"postal-code"},`${i.postalCode} / `),i.localizedCountry&&a.createElement("span",{className:"country-name"},`${i.localizedCountry} `)))):null})))},76049:(e,t,n)=>{n.d(t,{A:()=>o,Y:()=>a});var i=n(70355);const r=(0,i.createContext)(void 0),o=r;function a(){const e=(0,i.useContext)(r);if(!e)throw new Error("useLocale must be used within a LocaleContextProvider");return e}},77050:(e,t,n)=>{var i;n.d(t,{A:()=>r}),function(e){e[e.USD=.5]="USD",e[e.AED=2]="AED",e[e.AUD=.5]="AUD",e[e.BGN=1]="BGN",e[e.BRL=.5]="BRL",e[e.CAD=.5]="CAD",e[e.CHF=.5]="CHF",e[e.CZK=15]="CZK",e[e.DKK=2.5]="DKK",e[e.EUR=.5]="EUR",e[e.GBP=.3]="GBP",e[e.HKD=4]="HKD",e[e.HUF=175]="HUF",e[e.INR=.5]="INR",e[e.JPY=50]="JPY",e[e.MXN=10]="MXN",e[e.MYR=2]="MYR",e[e.NOK=3]="NOK",e[e.NZD=.5]="NZD",e[e.PLN=2]="PLN",e[e.RON=2]="RON",e[e.SEK=3]="SEK",e[e.SGD=.5]="SGD",e[e.THB=10]="THB"}(i||(i={}));const r=e=>{const{currency:{code:t},cartAmount:n}=e;return!!((e=>e in i)(t)&&n>=i[t])}},77546:(e,t,n)=>{function i(e){const t=document.createElement("div");t.innerHTML=e;const n=t.querySelector("a");if(!n)return[];const i=t.innerHTML.split(n.outerHTML);return[i[0],n.text,i[1]]}n.d(t,{A:()=>i})},79001:(e,t,n)=>{n.d(t,{M:()=>i});const i=Object.freeze([]);Object.freeze({})},79877:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(69440);function r(e){return(0,i.reduce)(e,((e,t)=>e+t.quantity),0)}},81339:(e,t,n)=>{n.d(t,{A:()=>d,h:()=>s});var i=n(3375),r=n.n(i),o=n(70355),a=n(69022);const s=(e,t=!1,n=!1)=>o.createElement("span",{className:r()({"body-regular":t&&!n},{"sub-text":t&&n})},o.createElement("span",{className:r()({"body-bold":t&&!n},{"sub-text-bold":t&&n})},`${e.quantity} x `),e.name,(e=>e.options&&e.options.length?o.createElement("span",{className:"line-item-options"},` - ${e.options.map((e=>e.value)).join(" / ")}`):null)(e)),d=(0,o.memo)((({lineItems:e,isMultiShippingSummary:t=!1})=>{const{themeV2:n}=(0,a.w)();return o.createElement("ul",{className:"consignment-line-item-list"},e.map((e=>o.createElement("li",{key:e.id},s(e,n,t)))))}))},81655:(e,t,n)=>{n.d(t,{P:()=>i,Z:()=>r});const i=968,r=551},82897:(e,t,n)=>{n.r(t),n.d(t,{initializeLanguageService:()=>l.g,renderCheckout:()=>d,renderOrderConfirmation:()=>c});var i=n(31635),r=n(70355),o=n(54622);const a=document.currentScript?document.currentScript.src:void 0;function s(e){if(!e){const e=a;if(!e)throw new Error("Unable to configure the public path of the application because it is not specified and it cannot be inferred using the path of the current script.");return n.p=`${e.split("/").slice(0,-1).join("/")}/`,n.p}return n.p="/"===e.substr(-1)?e:`${e}/`,n.p}function d(e){var{containerId:t,publicPath:a}=e,d=(0,i.__rest)(e,["containerId","publicPath"]);const c=s(a),{default:l}=n(29923);o.render(r.createElement(l,Object.assign({containerId:t,publicPath:c},d)),document.getElementById(t))}function c(e){var{containerId:t,publicPath:a}=e,d=(0,i.__rest)(e,["containerId","publicPath"]);const c=s(a),{default:l}=n(10063);o.render(r.createElement(l,Object.assign({containerId:t,publicPath:c},d)),document.getElementById(t))}var l=n(84087)},82922:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(62174),r=n(87647),o=n(83030);const a=e=>(0,r.A)(e)||(0,o.A)(e)||(0,i.A)(e)},83030:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(28058);const r=e=>e===i.A.PaypalCommerceCreditCards||e===i.A.PayPalCommerceAcceleratedCheckout},84087:(e,t,n)=>{n.d(t,{A:()=>s,g:()=>d});var i=n(98227);const r="en",o=JSON.parse('{"optimized_checkout":{"address":{"address_line_1_label":"Address","address_line_1_required_error":"Address is required","address_line_2_label":"Apartment/Suite/Building","address_line_2_required_error":"Apartment/Suite/Building is required","address_not_recognized_heading":"We did not recognize your address","consignment_address_updated_text":"The item was successfully assigned the new address.","city_label":"City","city_required_error":"City is required","company_name_label":"Company Name","company_name_required_error":"Company is required","confirm_address_action":"Proceed with current address","confirm_address_text":"We could not find a match for the address you entered. Please confirm the address.","country_label":"Country","country_required_error":"Country is required","custom_required_error":"{label} is required","custom_min_error":"{label} should be no less than {min} characters","custom_max_error":"{label} should be no more than {max} characters","invalid_characters_error":"{label} contains invalid characters","custom_valid_error":"{label} is not valid","edit_address_action":"Edit address","enter_address_action":"Enter a new address","enter_or_select_address_action":"Enter or select a different address","add_address_heading":"Add Address","save_address_action":"Save Address","first_name_label":"First Name","first_name_required_error":"First Name is required","last_name_label":"Last Name","last_name_required_error":"Last Name is required","phone_number_label":"Phone Number","phone_number_required_error":"Phone Number is required","postal_code_label":"Postal Code","postal_code_required_error":"Postal Code is required","save_in_addressbook":"Save this address in my address book.","select_country_action":"Select a country","select_state_action":"Select a state","state_label":"State/Province","state_required_error":"State/Province is required","select":"Select","select_all":"All","select_none":"None"},"billing":{"billing_address_heading":"Billing Address","billing_heading":"Billing","save_billing_address_error":"An error occurred while saving the billing address to your price quote. Please try again.","billing_address_amazonpay":"Managed by Amazon Pay","use_shipping_address_label":"My billing address is the same as my shipping address."},"cart":{"billed_amount_text":"*You will be charged and invoiced {total} ({code}) for this order.","based_on_currency_text":"Based on {total} {code}","cart_heading":"Order Summary","digital_item_text":"Digital Item","discount_text":"Discount","downloads_action":"Go to Downloads","edit_cart_action":"Edit Cart","edit_multi_shipping_cart_message":"New items will default to Shipping Destination #1. Reallocate if you want them shipped to other destinations.","estimated_total_text":"Estimated Total","free_text":"Free","gift_certificate_text":"Gift Certificate","handling_text":"Handling","item":"item","items":"items","item_count_text":"{count, plural, one{1 Item} other{# Items} }","print_action":"Print","remaining_text":"Remaining","remove_action":"remove","return_to_checkout":"RETURN TO CHECKOUT","see_all_action":"See All","see_less_action":"See Less","shipping_text":"Shipping","gift_wrapping_text":"Gift Wrapping","show_details_action":"Show Details","store_credit_text":"Store Credit","subtotal_text":"Subtotal","taxes_text":"Taxes","total_text":"Total","empty_cart_message":"Your cart is empty, you are being redirected. Please <a href=\\"{url}\\" target=\\"_top\\">click here</a> if your browser does not redirect you.","consistency_error":"Your checkout could not be processed because some details have changed. Please review your order and try again.","empty_cart_error_message":"Your cart contains items that aren\'t available for purchase or have exceeded the purchase limit. To place your order, please create a new cart with the quantities to the allowed limit or with different items."},"common":{"back_action":"Back","confirm_action":"Confirm","cancel_action":"Cancel","close_action":"Close","continue_action":"Continue","change_action":"Change","proceed_action":"Proceed","edit_action":"Edit","delete_action":"Delete","error_heading":"Something\'s gone wrong","leave_warning":"Are you sure you want to leave? Data you have entered may not be saved.","loading_text":"Loading","missing_shipping_method_heading":"Shipping method unavailable","invalid_shipping_address":"Invalid shipping address","ok_action":"Ok","error_code":"Error code:","request_id":"Request ID:","optional_text":"(Optional)","unavailable_error":"Checkout is temporarily unavailable. Please try again later.","unavailable_heading":"Checkout is temporarily unavailable","unstable_network_error":"It looks like the server is taking too long to respond, this can be caused by either poor connectivity or an error with our servers. Please try again in a while.","order_loading_error":"There was an error loading your order. Please try again.","order_fatal_error_heading":"There was an error placing your order","order_fatal_error_extra":"Please choose another payment method or contact us for further assistance.","go_back":"Go Back","show_more":"Show more"},"customer":{"continue_as_guest_action":"Continue as guest","continue_as_stripe_customer_action":"Continue with Link","create_account_action":"Create Account","continue":"Continue","set_password_action":"Save Password","required_error":"{label} is required","min_error":"{label} should be bigger than {min}","max_error":"{label} should be smaller than {max}","invalid_characters_error":"{label} contains invalid characters","create_account_error":"An error occurred while creating your account. Please try again.","create_address_error":"However, an error occurred while saving the address in your address book.","create_account_requirements_error_heading":"Password does not match requirements","create_account_success":"Your account has been created.","set_password_success":"Your password has been saved.","create_account_text":"Create an account for a faster checkout in the future","set_password_text":"Setup a password for a faster checkout in the future","account_created_text":"An account has been created for you, but you\'ll need to setup a password to sign in.","create_account_to_continue_text":"<a href=\\"{url}\\" target=\\"_blank\\">Create an account</a>","guest_could_login":"Looks like you have an account. Sign in with {email} for a faster checkout.","guest_must_login":"Looks like you have an account. Please sign in to proceed with {email}, or use another email.","guest_temporary_disabled":"Guest checkout is temporarily disabled. Please sign in or <a href=\\"{url}\\" target=\\"_blank\\">create an account</a> to continue.","customer_heading":"Customer","email_invalid_error":"Email address must be valid","email_label":"Email","email_required_error":"Email address is required","forgot_password_action":"Forgot password?","guest_customer_text":"Guest Customer","guest_subscribe_to_newsletter_text":"Subscribe to our newsletter.","guest_marketing_consent":"I would like to receive updates and offers.","login_action":"Sign in now","login_text":"Already have an account?","email_in_use_text":"There\'s already an account for {email}. Please enter a different email address or sign-in.","unknown_email_in_use_text":"There\'s already an account for the provided email. Please enter a different email address or sign-in.","guest_could_login_change_email":"Not {email}? <a>Change email</a>.","password_confirmation_error":"Passwords do not match","password_confirmation_label":"Confirm Password","password_confirmation_required_error":"This field is required","password_label":"Password","password_letter_required_error":"","password_minimum_character_label":"character minimum, case sensitive","password_number_required_error":"Password needs to contain a number","password_over_maximum_length_error":"Password is too long","password_required_error":"Password is required","password_under_minimum_length_error":"Password is too short","reset_password_before_login_error":"Sign-in is currently unavailable. You will receive an e-mail in the next 5 minutes with instructions for resetting your password. If you don\'t receive this e-mail, please check your junk mail folder or contact us for further assistance.","returning_customer_text":"Returning Customer","sign_in_action":"Sign In","sign_in_error":"The email or password you entered is not valid.","sign_in_throttled_error":"Due to excessive login attempts, please wait 10 seconds before attempting to log in again.","sign_out_action":"Sign Out","sign_out_error":"An error occurred while signing out. Please try again.","subscribe_to_newsletter_text":"Yes, I\'d like to receive updates.","suggestion_text":"Looks like you have an account with {provider}. For fast checkout, continue with {providerFlow}.","suggestion_action":"{providerFlow}"},"login_email":{"error_server":"We couldn\'t send you a sign-in link. Please try again.","error_not_found":"The entered email is not associated to an account. Please try with a different email.","sent_header":"Check your inbox","sent_text":"If the entered email address is associated with this store, you will receive a sign-in link shortly. This link expires in 15 minutes. If you don\'t see it, check your junk folder.","text":"Enter the email address associated to your account. We will send you a sign-in link.","header":"Account sign-in link","header_with_email":"Confirm your email address","link":"<a>Send me a sign-in link instead</a>","use_another_email":"Use another email","send":"Send","error_temporary_disabled":"Sign-in link functionality is temporary unavailable. Please sign in by entering your password.","resend_link":"<a>Resend link</a>","use_password_link":" or <a>sign in using your password</a> instead."},"embedded_checkout":{"unsupported_error":"The following payment methods are not supported by Embedded Checkout: {methods}. Please contact us for assistance."},"payment":{"affirm_name_text":"Affirm","affirm_display_name_text":"Pay over time","affirm_body_text":"You will be redirected to Affirm to securely complete your purchase. Just fill out a few pieces of basic information and get a real-time decision. Checking your eligibility won\'t affect your credit score.","afterpay_name_text":"Afterpay","afterpay_description":"Checkout with Afterpay","amazon_continue_action":"Continue with Amazon","amazonpay_continue_action":"Continue with Amazon Pay","amazon_name_text":"Amazon Pay","barclaycard_continue_action":"Continue","bluesnap_v2_continue_action":"Continue","bluesnap_direct_account_type_select":{"label":"Select an account type","option_consumer_checking":"Consumer checking","option_consumer_savings":"Consumer savings","option_corporate_checking":"Corporate checking","option_corporate_savings":"Corporate savings"},"bluesnap_direct_account_number":{"label":"Account Number","is_required":"Account Number is required","only_numbers":"Account Number must contain only numbers","length":"Account Number must have at least 4 digits","length_max":"Account Number must have at least 17 digits"},"bluesnap_direct_iban":{"label":"IBAN","is_required":"IBAN is required","length":"IBAN must have at least 8 digits"},"bluesnap_direct_routing_number":{"label":"Routing Number","is_required":"Routing Number is required","only_numbers":"Routing Number must contain only numbers","length":"Routing Number must be 9 digits long"},"bluesnap_direct_company_name":{"length_max":"Company Name is too long"},"bluesnap_direct_account_type":{"label":"Account Type","is_required":"Account Type is required"},"ideal":{"label":"Your Bank"},"bluesnap_direct_permission":"I authorize this Electronic Check (ACH/ECP) transaction and agree to this debit of my account.","bluesnap_direct_sepa_mandate_disclaimer":"By signing this mandate form, you authorise (A) {creditorName} to send instructions to your bank to debit your account and (B) your bank to debit your account in accordance with the instructions from {creditorName}. As part of your rights, you are entitled to a refund from your bank under the terms and conditions of your agreement with your bank. A refund must be claimed within 8 weeks starting from the date on which your account was debited.","bluesnap_direct_electronic_check_label":"Electronic Check (ACH/ECP)","bluesnap_direct_sepa_direct_debit":"Sepa Direct Debit","bluesnap_direct_local_bank_transfer_label":"Local Bank Transfer","bolt_benefit_1":"Shop hundreds of brands with a passwordless login","bolt_benefit_2":"Check out with saved payment and shipping details","bolt_benefit_3":"Benefit from PCI-compliant account security","bolt_checkbox_agreement":"Save my information, create a Bolt account, and agree to Bolt’s <a href=\\"{termsUrl}\\" target=\\"_blank\\">Terms of Use</a> and <a href=\\"{privacyPolicyUrl}\\" target=\\"_blank\\">Privacy Policy</a>.","bolt_name_text":"Bolt","braintreevisacheckout_continue_action":"Continue with Visa Checkout","braintreeach_mandate_text":"By clicking Place Order, I authorize Braintree, a service of PayPal, on behalf of {storeName} to verify my bank account information using bank information and consumer reports and I authorize {storeName} to initiate an ACH/electronic debit to my {accountType} account, Depository Name: {depositoryName}, Routing Number: {routingNumber} and Account Number: {accountNumber}, in the amount of {outstandingBalance} on {currentDate}. I agree the ACH transactions I authorize comply with all applicable laws.","braintreeach_vaulting_mandate_text":"By clicking Place Order, I authorize Braintree, a service of PayPal, on behalf of {storeName} to verify my bank account information using bank information and consumer reports and I authorize {storeName} to initiate an ACH/electronic debit to my {accountType} account, Depository Name: {depositoryName}, Routing Number: {routingNumber} and Account Number: {accountNumber}, that will be stored on file, and debited on or after the due date. I agree the ACH transactions I authorize comply with all applicable laws.","complete_with_brand":"Complete order","continue_with_brand":"Continue with {brandName}","checkoutcom_document_label_boleto":"CPF or CNPJ","checkoutcom_document_label_oxxo":"CURP","checkoutcom_document_label_qpay":"National ID","checkoutcom_document_invalid_error_boleto":"CPF or CNPJ must be between 11 and 14 characters","checkoutcom_document_invalid_error_oxxo":"CURP must be at most 18 characters","checkoutcom_document_invalid_error_qpay":"National ID must be at most 32 characters","checkoutcom_fawry_customer_mobile_invalid_error":"Mobile Number must be valid","checkoutcom_fawry_customer_mobile_label":"Mobile Number","checkoutcom_fawry_customer_email_invalid_error":"Email address must be valid","checkoutcom_fawry_customer_email_label":"Email","checkoutcom_sepa_creditor_title":"Creditor","checkoutcom_sepa_creditor_id":"Creditor ID: {creditorId}","checkoutcom_sepa_debtor_title":"Debtor","checkoutcom_sepa_mandate_disclaimer":"By accepting this mandate form, you authorize {creditorName} to send instructions to your bank to debit your account, and your bank to debit your account in accordance with those instructions. You are entitled to a refund from your bank under the terms and conditions of your agreement with your bank. A refund must be claimed within 8 weeks starting from the date on which your account was debited.","checkoutcom_sepa_payment_type":"Payment type: one-off (non-recurring)","clearpay_name_text":"Clear Pay","credit_card_text":"Credit card","credit_card_customer_code_label":"Customer Code","credit_card_cvv_help_text":"For VISA and Mastercard, the CVV is a three-digit code printed on the back. For American Express it is the four-digit code printed on the front. The CVV is a security measure to ensure that you are in possession of the card.","credit_card_cvv_invalid_error":"CVV must be valid","credit_card_cvv_label":"CVV","credit_card_cvv_required_error":"CVV is required","credit_card_expiration_invalid_error":"Expiration date must be a valid future date in MM / YY format","credit_card_expiration_label":"Expiration","credit_card_expiration_date_label":"Expiration Date","credit_card_expiration_required_error":"Expiration Date is required","credit_card_expiration_placeholder_text":"MM / YY","credit_card_name_label":"Name on Card","credit_card_name_required_error":"Full name is required","credit_card_name_invalid_error":"Credit Card Name must be valid","credit_card_number_invalid_error":"Credit Card Number must be valid","credit_card_number_label":"Credit Card Number","credit_card_number_last_four":"Enter card number for {cardType} ending in {lastFour}","credit_card_number_required_error":"Credit Card Number is required","credit_card_number_mismatch_error":"The card number entered does not match the card stored in your account","credit_debit_card_text":"Credit/Debit Card","payment_methods_text":"Payment Methods","redeemable_payments_text":"Redeemable Payments","instrument_storage_options_text":"Payment Storage Options","stripev3_auth_3ds_fail":"User did not authenticate","google_pay_name_text":"Google Pay","humm_not_processable_error":"Humm cannot process your payment for this order, please select another payment method.","klarna_continue_action":"Continue with Klarna","klarna_name_text":"Klarna","masterpass_name_text":"Masterpass","mollie_unsupported_method_error":"This payment method cannot be used towards the purchase of digital products. Please contact customer support or try again.","opy_continue_action":"Continue with {methodName}","opy_widget_slogan":"Buy now. Pay smarter.","opy_widget_info":"You will be redirected to {methodName}\'s website to complete your order when you click \\"Continue with {methodName}\\"","opy_invalid_cart_error":"Cart price is different to {methodName} plan amount.","orbital_continue_action":"Place Order","orbital_description_text":"Pay using your ChasePay Account","payment_cancelled":"Payment was cancelled","payment_error":"An error occurred while processing your payment. Please try again.","payment_error_heading":"Payment Failed","payment_heading":"Payment","payment_invalid_error_heading":"Payment Unavailable","payment_method_disabled_error":"The selected payment method is no longer valid. Click OK to see the most up-to-date payment methods.","payment_method_error":"Response from payment provider: {message}","payment_method_invalid_error":"There\'s a problem processing your payment. Please contact us for assistance or choose another payment method.","payment_method_unavailable_error":"This payment provider is temporarily unavailable. Please try again later.","payment_not_required_text":"Payment is not required for this order.","paypal_complete_action":"Complete order","paypal_continue_action":"Continue with PayPal","paypal_pay_later_complete_action":"Complete order","paypal_pay_later_continue_action":"Continue with Pay Later","paypal_venmo_continue_action":"Continue with Venmo","paypal_credit_continue_action":"Continue with PayPal Credit","paypal_credit_description_text":"Buy Now, Pay Over Time","paypal_description_text":"Pay using your PayPal account","paypal_name_text":"PayPal","paypal_credit_name_text":"Pay Later","place_order_action":"Place Order","place_order_error":"There was an error placing your order. Please contact us.","place_order_error_heading":"Failed to place order","postal_code_label":"Postal Code","ideal_bic_required":"You must select an issuer to place the order","instrument_text":"Stored credit cards","instrument_add_card_action":"Use a different card","instrument_account_number_ending":"Account number ending in: {accountNumber}","instrument_default_ending_in_text":"Card ending in {endingIn}","instrument_ending_in_text":"{cardTitle} ending in {endingIn}","instrument_expired_text":"Expired {expiryDate}","instrument_expires_text":"Expires {expiryDate}","instrument_issuer":"Issuer","instrument_manage_button":"Manage","instrument_manage_modal_confirmation_action":"Yes, delete","instrument_manage_modal_confirmation_label":"Are you sure you want to delete this stored payment method?","instrument_manage_modal_title_text":"Manage stored payment methods","instrument_manage_modal_empty_text":"You do not have any stored payment methods.","instrument_manage_table_header_ending_in_text":"Ending in","instrument_manage_table_header_routing_number_text":"Routing Number","instrument_manage_table_header_expiry_date_text":"Expiry date","instrument_manage_table_header_payment_method_text":"Payment method","instrument_manage_delete_server_error":"There was an error when attempting to delete that stored payment method, please try again.","instrument_manage_delete_auth_error":"There was a problem authorizing your request. Please try signing in again","instrument_manage_delete_client_error":"There was an error when attempting to delete the stored payment method: payment method no longer exists or cannot be deleted.","instrument_save_payment_method_label":"Save this card for future transactions","instrument_save_as_default_payment_method_label":"Use this card as the default payment method for future transactions","account_instrument_add_action":"Use a different account","account_instrument_save_payment_method_label":"Save this account for future transactions","account_instrument_save_as_default_payment_method_label":"Use this account as the default payment method for future transactions","account_instrument_text":"Stored accounts","account_instrument_new_shipping_address":"<strong>We noticed this is a new shipping address.</strong><p>For security reasons, you will need to re-link your PayPal account when shipping to an address for the first time or if the shipping address was edited recently.</p>","bank_account_instrument_trusted_shipping_address_text":"This additional security step is applied to your account when shipping to an address for the first time or if the shipping address was edited recently.","bank_account_instrument_trusted_shipping_address_title_text":"Please re-enter your account data to authorize this transaction.","instrument_trusted_shipping_address_text":"This additional security step is applied to your card when shipping to an address for the first time or if the shipping address was edited recently.","instrument_trusted_shipping_address_title_text":"Please re-enter your card number to authorize this transaction.","quadpay_continue_action":"Continue with Zip","quadpay_display_name_text":"Pay in installments","ppsdk_continue_action":"Continue with {methodName}","select_your_bank":"Select your bank","sepa_account_number":"Account Number (IBAN)","sepa_account_number_required":"You must enter your account number (IBAN)","pay_by_bank_iban_required":"You must enter your account number (IBAN)","sepa_bic":"BIC","sepa_bic_length":"BIC must be 8 or 11 characters","sepa_mandate_required":"You must accept the mandate form","sezzle_display_name_text":"Buy Now Pay Later with Sezzle.","stripe_sepa_display_name_text":"Sepa Direct Debit.","stripe_sepa_mandate_disclaimer":"By providing your IBAN and confirming this payment, you authorise (A) {storeUrl} and Stripe, our payment service provider, to send instructions to your bank to debit your account and (B) your bank to debit your account in accordance with those instructions. You are entitled to a refund from your bank under the terms and conditions of your agreement with your bank. A refund must be claimed within eight weeks starting from the date on which your account was debited.","tax_provider_unavailable":"Sales tax could not be calculated. Please try again. If unsuccessful, please reach out to our support team to complete checkout.","vco_name_text":"Click to pay","visa_checkout_continue_action":"Continue with Click to pay","zip_continue_action":"Continue with Zip","zip_name_text":"Zip","zip_display_name_text":"Own it now, pay later","account_number_label":"Account Number","account_routing_label":"Routing Number","account_type_label":"Account Type","ownership_type_label":"Ownership Type","business_name_label":"Business Name","phone_number_label":"Phone Number","errors":{"account_number_required_error":"Account Number is required","routing_number_required_error":"Routing Number is required","phone_number_required_error":"Phone Number is required","business_name_required_error":"Business Name is required","only_numbers_error":"{label} must contain only numbers","additional_action_required":"Please continue with additional actions.","authorization_expired":"The authorization for this transaction has expired.","authorization_revoked":"The authorization for this transaction has been revoked.","call_issuer":"There was a problem processing your card. Please contact your card issuer.","captured_transaction":"Payment for this order has already been made.","card_declined":"Payment was declined. Please try a different card.","card_error":"Your card details could not be verified. Please double check them and try again.","card_replaced":"Unable to process the payment because invalid data was supplied with the transaction.","connection_error":"We\'re experiencing difficulty processing your transaction. Please try again later.","duplicate_transaction":"This is a duplicate transaction. Please contact us to confirm your order. Do not try to pay again.","expired_card":"Your card has expired. Please try again with a valid card.","gateway_error":"Something went wrong on the server. Please try again at a later time.","general_error":"Error while processing payment request.","google_pay_try_other_card":"Select a different card or log out of Google Pay to try the payment again.","hosted_form_error":"Unable to process the payment because invalid data was supplied with the transaction.","incorrect_address":"Your billing address couldn\'t be verified. Please check your billing address details and try again.","incorrect_amount":"Unable to process the payment because invalid data was supplied with the transaction.","incorrect_cvc":"Your card details could not be verified. Please double check them and try again.","incorrect_number":"Your card details could not be verified. Please double check them and try again.","incorrect_zip":"Your billing address couldn\'t be verified. Please check your billing address details and try again.","insufficient_funds":"Payment was declined. Please contact your bank.","invalid_address":"Your billing address couldn\'t be verified. Please check your billing address details and try again.","instrument_declined":"We would like to inform you that the total amount for your order has been adjusted from the initially confirmed sum with PayPal. This modification is in adherence to the regulations and safeguards set forth by the Second Payment Services Directive (PSD2). To proceed with the completion of your order, we kindly request your confirmation of the new total by clicking on the \'PayPal Checkout\' button situated at the bottom of the page.","invalid_amount":"There was an error while processing your payment. Please try again or contact us.","invalid_authorization_code":"There was an error while processing your payment. Please try again or contact us.","invalid_create_instrument_request":"Unable to process the payment because invalid data was supplied with the transaction.","invalid_cvc":"Your card details could not be verified. Please double check them and try again.","invalid_email_address":"Unable to process the payment because invalid email was supplied with the transaction.","invalid_expiry_date":"Your card details could not be verified. Please double check them and try again.","invalid_expiry_month":"Unable to process the payment because invalid data was supplied with the transaction.","invalid_expiry_year":"Unable to process the payment because invalid data was supplied with the transaction.","invalid_gateway":"Gateway is invalid.","invalid_gateway_options":"Gateway options are invalid.","invalid_instrument":"Unable to process the payment because invalid data was supplied with the transaction.","invalid_issuer":"Unable to process the payment because invalid data was supplied with the transaction.","invalid_number":"Your card details could not be verified. Please double check them and try again.","invalid_payment_request":"Unable to process the payment because invalid data was supplied with the transaction.","invalid_request_error":"We\'re experiencing difficulty processing your transaction. Please contact us or try again later.","invalid_user_authentication":"There was an error while processing your payment. Please contact us.","invalid_zip":"Unable to process the payment because invalid data was supplied with the transaction.","invalid_phone_number":"Phone Number is invalid.","journal_error":"Something went wrong on the server. Please try again at a later time.","lost_or_stolen_card":"Unable to process the payment because invalid data was supplied with the transaction.","missing_test_mode":"Unable to process the request because invalid data was supplied with the transaction.","not_found":"We\'re experiencing difficulty processing your transaction. Please try again later.","payment_config_error":"Something went wrong on the server. Please try again at a later time.","payment_config_not_found":"Something went wrong on the server. Please try again at a later time.","pending_review":"Your transaction was authorized, but is being held for review by the merchant.","pickup_card":"Your card cannot be used to make this payment. Please contact your card issuer, or try using a different card.","processing_error":"We\'re experiencing difficulty processing your transaction. Please try again later.","provider_configuration_error":"Merchant payment provider is not correctly configured.","refund_timelimit_expired":"The time-limit to refund this transaction has expired.","refunded_transaction":"This transaction has already been refunded.","request_timeout":"Unable to process your payment due to timeout. Please try again.","required_field":"Your payment couldn\'t be verified. Please check your card details and try again.","server_error":"There was an error processing your payment and your order couldn\'t be completed. Please try again.","store_instrument_failed":"Unable to process the request. Please try again.","stored_payment_instrument_not_found":"That stored payment instrument could not be found. Please try a different payment option.","three_d_secure_declined":"There has been an issue with your payment, please check your payment details or contact your card issuer.","three_d_secure_failed":"The payment failed. Please try again or use a different payment option.","three_d_secure_required":"Further authentication is required to process your payment. Please contact us.","token_error":"We\'re experiencing difficulty processing your transaction. Please try again later.","transaction_declined":"Your payment was declined. Please try again.","transaction_rejected":"Payment was declined. Please try again.","unauthorized":"We\'re experiencing difficulty processing your transaction. Please try again later.","unsupported_currency":"Unable to process the payment because invalid data was supplied with the transaction.","unsupported_instrument":"Your card details could not be verified. Please double check them and try again.","unsupported_request":"Unable to process the payment because invalid data was supplied with the transaction.","user_authorization_error":"There was an error while processing your payment. Please contact us.","vaulting_service_unavailable":"Vaulting service is currently not available.","voided_transaction":"Unable to process your payment because the transaction has already been voided. Please try again or contact us."},"ratepay":{"payment_method_title":"Pay upon Invoice","phone_country_code":"Country code","phone_number":"Phone number","birth_date":"Date of birth","errors":{"isRequired":"{fieldName} is required","isInvalid":"{fieldName} is invalid","paymentSourceInfoCannotBeVerified":"The combination of your name and address could not be validated. Please correct your data and try again. You can find further information in the <a href=\'https://www.ratepay.com/en/ratepay-data-privacy-statement/\' target=\'blank\'>Ratepay Data Privacy Statement</a> or you can contact Ratepay using this <a href=\'https://www.ratepay.com/en/contact/\' target=\'blank\'>contact form.</a>","paymentSourceDeclinedByProcessor":"It is not possible to use the selected payment method. This decision is based on automated data processing. You can find further information in the <a href=\'https://www.ratepay.com/en/ratepay-data-privacy-statement/\' target=\'blank\'>Ratepay Data Privacy Statement</a> or you can contact Ratepay using this <a href=\'https://www.ratepay.com/en/contact/\' target=\'blank\'>contact form.</a>","itemCategoryNotSupportedByPaymentSource":"Digital items are not supported for given method"}}},"redeemable":{"applied_text":"Applied","apply_action":"Apply","apply_store_credit_after_action":"store credit to order","apply_store_credit_before_action":"Apply","code_invalid_error":"The gift certificate or coupon code is invalid","code_label":"Gift Certificate or Coupon Code","code_required_error":"Please enter a gift certificate or coupon code","coupon_location_error":"Your shipping address doesn\'t meet the location requirements for the coupon code you entered.","coupon_min_order_total":"Your order does not meet the minimum total for this coupon code to be applied.","coupon_text":"Coupon","gift_certificate_remaining_text":"Remaining","gift_certificate_text":"Gift Certificate","remove_action":"Remove","store_credit_available_text":"Your account currently has {storeCredit} total store credit available","toggle_action":"Coupon/Gift Certificate"},"remote":{"browser_unsupported":"The selected payment method requires a different web browser. Please choose another payment method.","connection_error":"Connection to remote checkout refused, please try later.","continue_with_text":"Or continue with","or_text":"OR","payment_method_error":"There was an error retrieving your remote payment method. Please try again.","select_different_card_action":"Select a different card","session_error":"Your remote session has expired. Please log in again.","shipping_address_error":"There was an error retrieving your remote shipping address. Please try again.","sign_in_action":"Sign in to {providerName}","sign_out_action":"Sign out of {providerName}","sign_out_after_action":"to view other payment methods","sign_in_required_error":"Remote sign in required before payment","sign_out_before_action":"","start_with_text":"Check out faster with:","powered_by":"Powered by"},"shipping":{"cart_change_error":"An update to your shopping cart has been detected and your available shipping costs have been updated. Please re-select a shipping method to continue.","enter_shipping_address_text":"Please enter a shipping address in order to see shipping quotes","order_comment_label":"Order Comments","assign_item_error":"An error occurred while assigning item to address. Please try again","assign_item_invalid_address_error_heading":"Invalid Address","assign_item_invalid_address_error":"The selected address is not valid. Please go to your account page and update it.","unassign_item_error":"An error occurred while unassigning item to address.","save_shipping_address_error":"An error occurred while saving the shipping address to your price quote. Please try again.","save_shipping_option_error":"An error occurred while saving the shipping quote to your order. Please try again.","select_shipping_address_text":"Please select a shipping address in order to see shipping quotes","shipping_address_heading":"Shipping Address","multishipping_consignment_index_heading":"Destination #{consignmentNumber}","multishipping_incomplete_consignment_error":"Please complete the address, item allocation, and method selection for Destination #{consignmentNumber}.","multishipping_add_new_destination":"Add new destination","multishipping_address_heading":"Choose where to ship each item","multishipping_address_heading_guest":"Please sign in first","multishipping_guest_intro":"To ship your items to multiple addresses you need to","multishipping_guest_sign_in":"sign in to your account","multishipping_guest_create":"or <a href=\\"{url}\\" target=\\"_blank\\">create an account</a> prior to proceeding.","multishipping_item_to_allocate_message":"{count, plural, one{1 item left to allocate} other{{count} items left to allocate}}","multishipping_item_allocated_message":"{count, plural, one{1 item allocated} other{{count} items allocated}}","multishipping_item_reallocated_message":"Reallocate items","multishipping_item_hide_items_message":"Hide items","multishipping_item_show_items_message":"Show items","multishipping_left_to_allocate_message":"{count} left to allocate","multishipping_items_selected_message":"{count} items selected","multishipping_items_allocate_save":"Save","multishipping_items_allocate_allocate":"Allocate","multishipping_items_allocate_cancel":"Cancel","multishipping_items_allocate_clear_all":"Clear all","multishipping_items_allocate_select_all_items_left":"Select all items left","multishipping_all_items_allocated_message":"All items are allocated.","multishipping_no_item_allocated_message":"No item allocated","multishipping_allocate_items":"Allocate items","multishipping_digital_item_no_shipping_banner":"Shipping isn\'t required for digital products, thus it\'s not displayed here.","multishipping_left_to_allocate_items_table_item":"Item","multishipping_left_to_allocate_items_table_left_to_allocate":"Left to allocate","multishipping_left_to_allocate_items_table_quantity":"Quantity","multishipping_item_split_tooltip_message":"These item quantities are split into a separate row due to a quantity-based promotion or custom price.","ship_to_multi":"Ship to multiple addresses","ship_to_single":"Ship to a single address","ship_to_single_action":"Ship to a Single Address instead","ship_to_single_message":"If you proceed, all progress for multiple addresses will be lost. This action cannot be undone.","shipping_heading":"Shipping","shipping_method_label":"Shipping Method","shipping_option_expired_error":"The shipping price you were quoted is no longer valid. Click OK to see the most up-to-date shipping prices.","shipping_option_expired_heading":"Your shipping price has been updated","view_shipping_options_action":"See Other Options","quantity_required_error":"Quantity is required","quantity_invalid_error":"Quantity must be a number","quantity_max_error":"Quantity cannot exceed \\"Left to allocate\\" amount.","quantity_min_error":"Quantity cannot be less than 0","custom_item_quantity_error":"All quantities of this custom product must be allocated to the same destination, as it was created specifically for this draft order.","choose_shipping_address":"Choose a shipping address","multishipping_unavailable_action":"Multi-Address Shipping Unavailable","multishipping_unavailable_message":"Multi-address shipping is unavailable when a promotion adds a free item to your cart.","checkout_switched_to_single_shipping":"Your checkout has been automatically updated to use a single shipping address. Shipping to multiple addresses is unavailable when a promotional free item is in your cart.","guest_multishipping_no_shipping_address_message":"No shipping address entered","guest_multishipping_enter_shipping_address_action":"Enter shipping address"},"social":{"share_action":"Share","share_heading":"Tell your friends about your purchase!","tweet_action":"Tweet"},"spam_protection":{"verify_action":"Please click here to verify yourself as human before proceeding."},"privacy_policy":{"required_error":"Please agree to the Privacy Policy.","label":"Yes, I agree with the <a href=\\"{url}\\" target=\\"_blank\\">privacy policy</a>.","heading":"Privacy Policy"},"privacy_policy_auto_consent":{"label":"*By clicking continue, you agree to our  <a href=\\"{url}\\" target=\\"_blank\\">privacy policy</a>."},"tax":{"inclusive_label":"Tax Included in Total:"},"terms_and_conditions":{"agreement_required_error":"Please agree to the terms and conditions","agreement_text":"Yes, I agree with the above terms and conditions.","agreement_with_link_text":"Yes, I agree with the <a href=\\"{url}\\" target=\\"_blank\\">terms and conditions</a>.","terms_and_conditions_heading":"Terms and Conditions"},"order_confirmation":{"mandate":{"adyenv3":{"boletobancario":"Boleto Bancário Ticket"},"bluesnapdirect":{"sepa_direct_debit":"SEPA Direct Debit Mandate Reference: {mandate}"},"checkoutcom":{"boleto":"Boleto Bancário Ticket","oxxo":"OXXO Ticket","sepa":"SEPA Direct Debit (via Checkout.com) Mandate Reference: {mandate}"},"stripev3":{"iban":"SEPA Direct Debit Mandate"},"stripeupe":{"au_becs_debit":"BECS Direct Debit Mandate","boleto":"Boleto Bancário Ticket","oxxo":"OXXO Ticket","sepa_debit":"SEPA Direct Debit Mandate"},"paypalcommercealternativemethods":{"oxxo":"OXXO Ticket","ratepay":{"account_holder_name":"Account Holder","iban":"Iban","payment_reference":"Payment Reference"}}},"order_number_text":"Your order number is <strong>{orderNumber}</strong>","order_pending_review_text":"Your order was sent to us but is currently awaiting payment. Once we receive the payment for your order, it will be completed. If you\'ve already provided payment details then we will process your order manually and send you an email when it\'s completed.","order_pending_status_text":"We\'ve received your order and are processing your payment. Once the payment is verified, your order will be completed. We will send you an email when it\'s completed. Please note, this process may take a few minutes depending on the processing times of your chosen method. If you have any questions about your purchase, email us at <a href=\\"mailto:{supportEmail}?Subject=Order {orderNumber}\\" target=\\"_top\\">{supportEmail}</a>.","order_incomplete_status_text":"We\'ve received your order and payment. Your order is now being processed by our system. Please note, processing may take a few minutes. If you have any questions about your purchase, email us at <a href=\\"mailto:{supportEmail}?Subject=Order {orderNumber}\\" target=\\"_top\\">{supportEmail}</a>.","order_with_downloadable_digital_items_text":"You can download your digital purchases by clicking the links on this page, or by logging into your account at any time. There is also a download link in your confirmation email, which should be arriving shortly.","order_with_support_number_text":"An email will be sent containing information about your purchase. If you have any questions about your purchase, email us at <a href=\\"mailto:{supportEmail}?Subject=Order {orderNumber}\\" target=\\"_top\\">{supportEmail}</a> or call us at <a href=\\"tel://{supportPhoneNumber}\\">{supportPhoneNumber}</a>.","order_without_downloadable_digital_items_text":"Once we receive your payment, we\'ll send a confirmation email with a link to download your digital purchases.","order_without_support_number_text":"An email will be sent containing information about your purchase. If you have any questions about your purchase, email us at <a href=\\"mailto:{supportEmail}?Subject=Order {orderNumber}\\" target=\\"_top\\">{supportEmail}</a>.","thank_you_customer_heading":"Thank you {name}!","thank_you_heading":"Thank you!","continue_shopping":"Continue Shopping »","order_status_update_facebook_messenger_heading":"Get instant updates of your order to Messenger"}}}');let a;function s(){return a=null!=a?a:(0,i._T)({fallbackLocale:r,fallbackTranslations:o}),a}function d(e){return a=(0,i._T)(Object.assign(Object.assign({},e),{defaultLocale:e.locale,defaultTranslations:e.defaultTranslations,fallbackLocale:r,fallbackTranslations:o})),a}},84559:(e,t,n)=>{function i(e){return Boolean(e.checkoutUserExperienceSettings.floatingLabelEnabled)}n.d(t,{A:()=>i})},85021:(e,t,n)=>{function i(e,t){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}n.d(t,{h:()=>i})},85216:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(3375),r=n.n(i),o=n(70355),a=n(9343);const s=(0,o.memo)((({additionalClassName:e,children:t,className:n,hasError:i,testId:s})=>o.createElement(a.Ay.Consumer,null,(({isSubmitted:a})=>o.createElement("div",{className:n||r()("form-field",e,{"form-field--error":i&&a}),"data-test":s},t)))))},85814:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(70355);const r=(0,i.memo)((({isLoading:e})=>e?i.createElement("div",{"aria-busy":"true",className:"loadingSpinner loadingOverlay-container",role:"status",style:{height:100}},i.createElement("div",{className:"loadingOverlay optimizedCheckout-overlay"})):null))},86620:(e,t,n)=>{n.d(t,{N:()=>a});var i=n(70355),r=n(39981),o=n(69022);const a=({children:e})=>{var t;const{checkoutState:{data:{getConfig:n}}}=(0,r.Q)(),a=n();let s=!1;a&&(s=Boolean(null===(t=a.checkoutSettings.features["CHECKOUT-7962.update_font_style_on_checkout_page"])||void 0===t||t));const d=window.location.search&&window.location.search.includes("v2")||s;return i.createElement(o.A.Provider,{value:{themeV2:d}},e)}},87647:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(28058);const r=e=>e===i.A.Braintree||e===i.A.BraintreeAcceleratedCheckout},87980:(e,t,n)=>{function i(e,t,n=!0){var i;return Boolean(null!==(i=null==e?void 0:e.features[t])&&void 0!==i?i:n)}n.d(t,{A:()=>i})},89792:(e,t,n)=>{function i(e){return"object"==typeof e&&null!==e&&(t=e,n="type",Object.prototype.hasOwnProperty.call(t,n))&&"string"==typeof e.type;var t,n}n.d(t,{A:()=>i})},90184:(e,t,n)=>{n.d(t,{F:()=>i});const i=(0,n(70355).createContext)(void 0)},91124:(e,t,n)=>{n.d(t,{nz:()=>B,z2:()=>j});var i,r,o,a,s=n(38589),d=n(75568),c=n(91250),l=n(58002),u=n(79132),h={};function m(e,t){return Object.assign(e,{resolveIds:t})}h.d=(e,t)=>{for(var n in t)h.o(t,n)&&!h.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},h.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);class p extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class y extends p{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class g extends p{constructor(e){super(e||"Not implemented."),this.name="NotImplementedError",this.type="not_implemented"}}(a=i||(i={})).SandboxMode="bolt_sandbox",a.StagingMode="bolt_staging",a.DevelopmentMode="bolt_development",function(e){e.Small="small",e.Medium="medium",e.Large="large"}(r||(r={})),function(e){e.Pill="pill",e.Rect="rect"}(o||(o={}));class v{constructor(e,t,n=window){this.paymentIntegrationService=e,this.boltScriptLoader=t,this.boltHostWindow=n}initialize(e){return t=this,i=function*(){const{bolt:t,containerId:n,methodId:i}=e,{buyNowInitializeOptions:r,style:o}=t||{};if(!i)throw new y('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new y('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new y('Unable to initialize payment because "options.bolt" argument is not provided.');if(!Boolean(r))throw new g("Only buy now flow is implemented for Bolt button");if(!(null==r?void 0:r.storefrontApiToken)||"string"!=typeof r.storefrontApiToken)throw new y('Unable to initialize payment because "options.storefrontApiToken" argument is not provided.');const a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i),{initializationData:s,config:d}=a,{publishableKey:c,developerConfig:l}=s||{};yield this.boltScriptLoader.loadBoltClient(c,d.testMode,l,"BigCommerce",r.storefrontApiToken),this.renderButton(n,a,o)},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}deinitialize(){return Promise.resolve()}renderButton(e,t,n){var i;"function"==typeof(null===(i=this.boltHostWindow.BoltConnect)||void 0===i?void 0:i.setupProductPageCheckout)&&(this.addButtonContainer(e,t,n),this.boltHostWindow.BoltConnect.setupProductPageCheckout())}addButtonContainer(e,t,n){const i=document.getElementById(e);if(!i)return;const r=document.createElement("div"),o=document.createElement("object");r.setAttribute("id","product-page-checkout-wrapper"),r.setAttribute("class","bolt-button-wrapper"),r.setAttribute("style","display:none"),r.setAttribute("data-tid","product-page-checkout-wrapper"),o.setAttribute("data",this.getBoltObjectData(t,n)),o.setAttribute("class","bolt-product-checkout-button"),r.append(o),i.innerHTML="",i.append(r)}getBoltObjectData(e,t){const{initializationData:n,config:i}=e,{publishableKey:r,developerConfig:o}=n||{},a=this.boltScriptLoader.getDomainURL(!!i.testMode,o),s=this.getButtonHeight(null==t?void 0:t.size),c=this.getButtonBorderRadius(null==t?void 0:t.shape,s);return(0,d.stringifyUrl)({url:`https://${a}/v1/checkout_button`,query:{publishable_key:r,variant:"ppc",height:s,border_radius:c}})}getButtonHeight(e){if(e)switch(e){case r.Small:return 25;case r.Large:return 45;case r.Medium:default:return 40}}getButtonBorderRadius(e,t){if(e)switch(e){case o.Pill:return t?Math.round(t/2):void 0;case o.Rect:default:return 4}}}class f extends p{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}var b=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class S{constructor(e,t=window){this.scriptLoader=e,this.boltHostWindow=t}loadBoltClient(e,t,n,i,r){return b(this,void 0,void 0,(function*(){if(this.boltHostWindow.BoltCheckout)return this.boltHostWindow.BoltCheckout;if(!e)throw new y('Unable to initialize payment because "publishableKey" argument is not provided.');if(yield this.scriptLoader.loadScript(`//${this.getDomainURL(!!t,n)}/connect-bigcommerce.js`,this.getScriptOptions("bolt-connect",e,i,r)),yield this.scriptLoader.loadScript(`//${this.getDomainURL(!!t,n)}/track.js`,this.getScriptOptions("bolt-track",e)),!this.boltHostWindow.BoltCheckout)throw new f;return this.boltHostWindow.BoltCheckout}))}loadBoltEmbedded(e,t,n){return b(this,void 0,void 0,(function*(){if(yield this.scriptLoader.loadScript(`//${this.getDomainURL(!!t,n)}/embed.js`,{async:!0,attributes:{id:"bolt-embedded"}}),!this.boltHostWindow.Bolt)throw new f;return this.boltHostWindow.Bolt(e)}))}getDomainURL(e,t){if(!e)return"connect.bolt.com";if(t)switch(t.developerMode){case i.StagingMode:return"connect-staging.bolt.com";case i.DevelopmentMode:return`connect.${t.developerDomain}`}return"connect-sandbox.bolt.com"}getScriptOptions(e,t,n,i){return{async:!0,attributes:Object.assign(Object.assign({id:e,"data-publishable-key":t},n&&{"data-shopping-cart-id":n}),i&&{"data-storefront-api-token":i})}}}m((e=>new v(e,new S((0,s.vQ)()))),[{id:"bolt"}]);class C{constructor(e){this.storage=e}saveExtraItemsData(e,t){const n=[...t.physicalItems,...t.digitalItems].reduce(((e,t)=>(e[t.productId]={brand:t.brand?t.brand:"",category:t.categoryNames?t.categoryNames.join(", "):""},e)),{});try{return this.storage.setItem(this.getStorageKey(e),JSON.stringify(n)),n}catch(e){return{}}}readExtraItemsData(e){try{const t=this.storage.getItem(this.getStorageKey(e));if(!t)return null;const n=JSON.parse(t);return function(e){if(!(0,l.isObject)(e))return!1;const t=Object.values(e).some((e=>!(0,l.isObject)(e)||!("brand"in e)||!("category"in e)));return Boolean(!t)}(n)?n:null}catch(e){return null}}clearExtraItemData(e){try{this.storage.removeItem(this.getStorageKey(e))}catch(e){}}getStorageKey(e){return e?`ORDER_ITEMS_${e}`:""}}var w;!function(e){e[e.MissingBillingAddress=0]="MissingBillingAddress",e[e.MissingCart=1]="MissingCart",e[e.MissingCheckout=2]="MissingCheckout",e[e.MissingConsignments=3]="MissingConsignments",e[e.MissingCustomer=4]="MissingCustomer",e[e.MissingCheckoutConfig=5]="MissingCheckoutConfig",e[e.MissingOrder=6]="MissingOrder",e[e.MissingOrderConfig=7]="MissingOrderConfig",e[e.MissingOrderId=8]="MissingOrderId",e[e.MissingPayment=9]="MissingPayment",e[e.MissingPaymentId=10]="MissingPaymentId",e[e.MissingPaymentInstrument=11]="MissingPaymentInstrument",e[e.MissingPaymentMethod=12]="MissingPaymentMethod",e[e.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",e[e.MissingPaymentStatus=14]="MissingPaymentStatus",e[e.MissingPaymentToken=15]="MissingPaymentToken",e[e.MissingShippingAddress=16]="MissingShippingAddress"}(w||(w={}));class _ extends p{constructor(e){super(function(e){switch(e){case w.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case w.MissingCart:return"Unable to proceed because cart data is unavailable.";case w.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case w.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case w.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case w.MissingCheckoutConfig:case w.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case w.MissingOrder:return"Unable to proceed because order data is unavailable.";case w.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case w.MissingPayment:return"Unable to proceed because payment data is unavailable.";case w.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case w.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case w.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}class I extends p{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}class P extends y{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}class E extends p{constructor(e){super(e||"Unable to proceed because the client library of a payment method has thrown an unexpected error."),this.name="PaymentMethodFailedError",this.type="payment_method_client_invalid"}}class O extends p{constructor(e){super(e||"Payment process was cancelled."),this.name="PaymentMethodCancelledError",this.type="payment_cancelled"}}function A(e){return"object"==typeof e&&null!==e&&"shouldCreateAccount"in e}const k={body:{},headers:{},status:0};class T extends p{constructor(e,{message:t,errors:n}={}){const{body:i,headers:r,status:o}=e||k;super(t||"An unexpected error has occurred."),this.name="RequestError",this.type="request",this.body=i,this.headers=r,this.status=o,this.errors=n||[]}}class N extends T{constructor(e){super(e,{message:"There is a problem processing your payment. Please try again later."}),this.name="PaymentMethodInvalidError",this.type="payment_method_invalid"}}var M;!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(M||(M={}));class x extends p{constructor(e){super(function(e){switch(e){case M.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case M.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case M.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case M.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}class D extends p{constructor(e){super(),this.errorCode=e,this.name="BoltPaymentsFieldError",this.type="bolt_payments_field_error",this.body={errors:[D.getError(e)]}}static getError(e){switch(e){case"1000":case"2000":case"3000":return{code:"invalid_number"};case"1001":case"2001":case"3001":return{code:"invalid_expiry_date"};case"1002":case"2002":return{code:"invalid_cvc"};case"1003":return{code:"invalid_zip"};case"2003":return{code:"incorrect_zip"};default:return{code:"general_error"}}}}var z=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class F{constructor(e,t,n){this.paymentIntegrationService=e,this.boltScriptLoader=t,this.analyticsExtraItemsManager=n,this.useBoltClient=!1,this.useBoltEmbedded=!1}initialize(e){return z(this,void 0,void 0,(function*(){const{bolt:t,methodId:n}=e,{containerId:i,onPaymentSelect:r,useBigCommerceCheckout:o}=t||{};if(!n)throw new y('Unable to initialize payment because "options.methodId" argument is not provided.');if(!o)return void(this.boltClient=yield this.boltScriptLoader.loadBoltClient());const a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId),{initializationData:s,config:d}=a,{publishableKey:c,developerConfig:l,embeddedOneClickEnabled:u}=s||{},{testMode:h}=d;if(!c)throw new _(w.MissingPaymentMethod);if(this.boltClient=yield this.boltScriptLoader.loadBoltClient(c,h,l),this.useBoltClient=!u,this.useBoltEmbedded=!!u,this.useBoltEmbedded){if(!i)throw new y('Unable to initialize payment because "options.bolt.containerId" argument is not provided.');if(!r)throw new y('Unable to initialize payment because "options.bolt.onPaymentSelect" argument is not provided.');this.boltEmbedded=yield this.boltScriptLoader.loadBoltEmbedded(c,h,l),this.mountBoltEmbeddedField(i),r(yield this.hasBoltAccount())}}))}deinitialize(){var e;return null===(e=this.embeddedField)||void 0===e||e.unmount(),this.boltClient=void 0,this.boltEmbedded=void 0,Promise.resolve()}finalize(){return Promise.reject(new I)}execute(e,t){return z(this,void 0,void 0,(function*(){this.setExtraItemsForAnalytics();const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{methodId:r,paymentData:o}=n||{};let a;if(!e.payment)throw new P(["payment"]);if(!r)throw new _(w.MissingPaymentMethod);if(!o||!function(e){return Boolean((0,l.isObject)(e)&&("shouldSaveInstrument"in e||"nonce"in e||A(e)))}(o))throw new _(w.MissingPayment);yield this.paymentIntegrationService.submitOrder(i,t),a=this.useBoltClient?yield this.getBoltClientPaymentPayload(r,o,t):this.useBoltEmbedded?yield this.getBoltEmbeddedPaymentPayload(r,o):yield this.getBoltFullCheckoutPaymentPayload(r,o),yield this.paymentIntegrationService.submitPayment(a)}))}getBoltClientPaymentPayload(e,t,n){return z(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.loadPaymentMethod(e,n);const i=this.paymentIntegrationService.getState(),r=i.getPaymentMethodOrThrow(e).clientToken,{isStoreCreditApplied:o}=i.getCheckoutOrThrow(),{shouldSaveInstrument:a}=t,s=this.getBoltClientOrThrow();if(yield this.paymentIntegrationService.applyStoreCredit(o),!r)throw new _(w.MissingPaymentMethod);const d=yield new Promise(((e,t)=>{const n={success:(n,i)=>{n.reference?e(n):t(new E("Unable to proceed because transaction reference is unavailable. Please try again later.")),i()},close:()=>{t(new O)}};s.configure({orderToken:r},{},n).open()}));return{methodId:e,paymentData:{nonce:d.reference,shouldSaveInstrument:a}}}))}getBoltEmbeddedPaymentPayload(e,t){var n;return z(this,void 0,void 0,(function*(){if(!A(t))throw new _(w.MissingPayment);const i=this.validateTokenizeResultOrThrow(yield null===(n=this.embeddedField)||void 0===n?void 0:n.tokenize());return{methodId:e,paymentData:{formattedPayload:{credit_card_token:{token:i.token,last_four_digits:i.last4,iin:i.bin,expiration_month:+i.expiration.split("-")[1],expiration_year:+i.expiration.split("-")[0]},provider_data:{create_account:!!t.shouldCreateAccount,embedded_checkout:!0}}}}}))}getBoltFullCheckoutPaymentPayload(e,t){return z(this,void 0,void 0,(function*(){yield this.setBoltOrderId();const n=this.getBoltClientOrThrow(),i=yield n.getTransactionReference();if(!i)throw new N;return{methodId:e,paymentData:Object.assign(Object.assign({},t),{nonce:i})}}))}getBoltClientOrThrow(){if(!this.boltClient)throw new x(M.PaymentNotInitialized);return this.boltClient}getBoltEmbeddedOrThrow(){if(!this.boltEmbedded)throw new x(M.PaymentNotInitialized);return this.boltEmbedded}hasBoltAccount(){return z(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState(),t=e.getCustomer(),n=e.getBillingAddress(),i=(null==t?void 0:t.email)||(null==n?void 0:n.email)||"",r=this.getBoltClientOrThrow();try{return yield r.hasBoltAccount(i)}catch(e){throw new N}}))}setBoltOrderId(){return z(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState().getOrderOrThrow(),t=this.getBoltClientOrThrow();try{yield t.setOrderId(e.orderId)}catch(e){throw new N}}))}mountBoltEmbeddedField(e){const t=this.getBoltEmbeddedOrThrow().create("payment_field",{styles:{backgroundColor:"#fff"},renderSeparateFields:!0});t.mount(`#${e}`),this.embeddedField=t}validateTokenizeResultOrThrow(e){if(!e)throw new N;if(e instanceof Error)throw new D(e.message);const{token:t,last4:n,bin:i,expiration:r}=e,o=+n,a=+i,s=+`${r}`.split("-")[1],d=+`${r}`.split("-")[0];if(!t||Number.isNaN(o)||Number.isNaN(a)||Number.isNaN(s)||Number.isNaN(d))throw new P;return e}setExtraItemsForAnalytics(){const e=this.paymentIntegrationService.getState(),t=e.getStoreConfigOrThrow(),n=e.getCartOrThrow();if(t.checkoutSettings.isAnalyticsEnabled&&function(e){return Boolean(e.hasOwnProperty("analytics"))}(window)){const{id:e,lineItems:t}=n;this.analyticsExtraItemsManager.saveExtraItemsData(e,t)}}}const B=m((e=>new F(e,new S((0,s.vQ)()),new C(c.Ay))),[{id:"bolt"}]);var R=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class L{constructor(e,t){this.paymentIntegrationService=e,this.boltScriptLoader=t,this.boltHostWindow=window}initialize(e){var t;return R(this,void 0,void 0,(function*(){const{methodId:n,bolt:i}=e,{onInit:r}=i||{};if(!n)throw new y('Unable to proceed because "methodId" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n);if(!(null===(t=o.initializationData)||void 0===t?void 0:t.publishableKey))throw new _(w.MissingPaymentMethod);const{developerConfig:a,publishableKey:s}=o.initializationData;if(yield this.boltScriptLoader.loadBoltClient(s,o.config.testMode,a),r&&"function"==typeof r){const e=this.getCustomerEmail();r(yield this.hasBoltAccount(e),e)}}))}deinitialize(){return Promise.resolve()}signIn(e,t){return R(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}))}signOut(e){return R(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}))}executePaymentMethodCheckout(e){return R(this,void 0,void 0,(function*(){const{continueWithCheckoutCallback:t=u.l,checkoutPaymentMethodExecuted:n,methodId:i}=e||{},r=this.getCustomerEmail();if(!i)throw new y('Unable to proceed because "methodId" argument is not provided.');if("function"!=typeof t)throw new y('Unable to proceed because "continueWithCheckoutCallback" argument is not provided and it must be a function.');if(r)return this.openBoltCheckoutModalOrThrow(r,i,t,n);t()}))}openBoltCheckoutModalOrThrow(e,t,n,i){var r;return R(this,void 0,void 0,(function*(){const o=this.getBoltClientOrThrow(),a=this.paymentIntegrationService.getState().getPaymentMethod(t);try{if(null===(r=null==a?void 0:a.initializationData)||void 0===r?void 0:r.embeddedOneClickEnabled){const t=yield this.hasBoltAccount(e);if(t){const t={close:()=>{n()}};yield o.openCheckout(e,t)}else n();"function"==typeof i&&i({hasBoltAccount:t})}else n()}catch(e){if(function(e){return"string"==typeof e.message&&"string"==typeof e.type&&("string"==typeof e.subtype||!e.subtype)&&e instanceof Error}(e)&&"MissingDataError"!==e.name&&"NotInitializedError"!==e.name)throw new E(e.message);throw e}}))}getBoltClientOrThrow(){const e=this.boltHostWindow.BoltCheckout;if(!e)throw new x(M.PaymentNotInitialized);return e}hasBoltAccount(e){return R(this,void 0,void 0,(function*(){const t=this.getBoltClientOrThrow();try{return yield t.hasBoltAccount(e)}catch(e){throw new N}}))}getCustomerEmail(){const e=this.paymentIntegrationService.getState(),t=e.getCustomer(),n=e.getBillingAddress();return(null==t?void 0:t.email)||(null==n?void 0:n.email)||""}}const j=m((e=>new L(e,new S((0,s.vQ)()))),[{id:"bolt"}])},91182:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355),r=n(85814);const o=({children:e,hideContentWhenLoading:t,loadingSkeleton:n,unmountContentWhenLoading:o,isLoading:a})=>{const s=n||i.createElement(r.A,{isLoading:!0});return t||o?i.createElement(i.Fragment,null,a?s:null,o&&a?null:i.createElement("div",{style:{display:t&&a?"none":void 0}},e)):i.createElement("div",{className:"loadingOverlay-container"},e,a&&i.createElement("div",{className:"loadingOverlay optimizedCheckout-overlay","data-test":"loading-overlay"}))}},92909:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(31635),r=n(3375),o=n.n(r),a=n(69440),s=n(70355),d=n(38003),c=n.n(d),l=n(72769),u=n(53133);const h=e=>{var{children:t,closeButtonLabel:n="Close",footer:r,header:d,additionalHeaderClassName:h,additionalBodyClassName:m,additionalModalClassName:p,onRequestClose:y=a.noop,shouldShowCloseButton:g=!1}=e,v=(0,i.__rest)(e,["children","closeButtonLabel","footer","header","additionalHeaderClassName","additionalBodyClassName","additionalModalClassName","onRequestClose","shouldShowCloseButton"]);const f=(0,s.useCallback)((e=>{y(e)}),[y]);return s.createElement(c(),Object.assign({},v,{ariaHideApp:!0,bodyOpenClassName:"has-activeModal",className:{base:o()("modal optimizedCheckout-contentPrimary",p),afterOpen:"modal--afterOpen",beforeClose:"modal--beforeClose"},closeTimeoutMS:200,onRequestClose:y,overlayClassName:{base:"modalOverlay",afterOpen:"modalOverlay--afterOpen",beforeClose:"modalOverlay--beforeClose"},shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!1}),s.createElement("div",{className:o()("modal-header",h)},d,g&&s.createElement("a",{className:"modal-close","data-test":"modal-close-button",href:"#",onClick:(0,l.A)(f)},n&&s.createElement("span",{className:"is-srOnly"},n),s.createElement(u.A,null))),s.createElement("div",{className:o()("modal-body",m),"data-test":"modal-body"},t),Boolean(r)&&s.createElement("div",{className:"modal-footer","data-test":"modal-footer"},r))}},93422:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(3375),r=n.n(i),o=n(70355),a=n(9343);const s=(0,o.memo)((({additionalClassName:e,children:t,className:n,hasError:i,testId:s})=>o.createElement(a.Ay.Consumer,null,(({isSubmitted:a})=>o.createElement("div",{className:n||r()("form-field",e,{"form-field--error":i&&a}),"data-test":s},t)))))},94027:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(98227),r=n(44218),o=n(70355),a=n(84087),s=n(76049);const d=({checkoutService:e,children:t})=>{const[n,d]=(0,o.useState)(),c=(0,o.useMemo)((()=>(0,a.A)()),[]),l=(0,r.B4)((e=>({currency:e?(0,i.P5)(e):void 0,date:e?{inputFormat:e.inputDateFormat}:void 0,language:c})));(0,o.useEffect)((()=>{const t=e.subscribe((({data:e})=>{d(e.getConfig())}),(({data:e})=>e.getConfig()));return()=>{t()}}),[e]);const u=(0,o.useMemo)((()=>l(n)),[n,l]);return o.createElement(s.A.Provider,{value:u},t)}},96097:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(69440),r=n(9597);function o(e,t){return e.length>1||!(!(0,i.some)(e,(e=>e.lineItemIds.length))||!(0,r.A)(e,t))}},97834:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(31635),r=n(69462),o=n(69440),a=n(70355),s=n(30540),d=n.n(s),c=n(85216);const l=e=>{var{field:t,onChange:n=o.noop,component:r="input",render:s}=e,d=(0,i.__rest)(e,["field","onChange","component","render"]);const c=(0,a.useRef)(t.value);return(0,a.useEffect)((()=>{((0,o.isDate)(t.value)?t.value.getTime():t.value)!==((0,o.isDate)(c.current)?c.current.getTime():c.current)&&n(t.value),c.current=t.value}),[t.value,n]),s?s(Object.assign({field:t},d)):"string"==typeof r?(0,a.createElement)(r,t):(0,a.createElement)(r,Object.assign({field:t},d))},u=(0,a.memo)((({additionalClassName:e,component:t,field:n,form:i,onChange:o,render:s,testId:d})=>{const u=(0,a.useMemo)((()=>a.createElement(l,{component:t,field:n,form:i,meta:i.getFieldMeta(n.name),onChange:o,render:s})),[n,i,o,t,s]);return a.createElement(c.A,{additionalClassName:e,hasError:(0,r.O6)(i.errors,n.name),testId:d},u)}),((e,t)=>{var{form:n,field:r}=e,o=(0,i.__rest)(e,["form","field"]),a=t.form,s=t.field,c=(0,i.__rest)(t,["form","field"]);return d()(o,c)&&d()(n,a)&&d()(r,s)})),h=(0,a.memo)((e=>{var{additionalClassName:t,className:n,component:o,render:s,testId:d,onChange:c}=e,l=(0,i.__rest)(e,["additionalClassName","className","component","render","testId","onChange"]);const h=(0,a.useCallback)((e=>a.createElement(u,Object.assign({},e,{additionalClassName:t,className:n,component:o,onChange:c,render:s,testId:d}))),[t,n,o,s,d,c]);return a.createElement(r.D0,Object.assign({},l),h)}))},98227:(e,t,n)=>{var i;n.d(t,{G8:()=>DC,Gl:()=>FC,O0:()=>pb,P5:()=>wC,PN:()=>NC,Pi:()=>en,_T:()=>bC,ge:()=>pC,n7:()=>UC,ow:()=>tn});var r=n(4341),o=n(77056),a=n(91195),s=n(38589),d=n(7492),c=n(58002),l=n(75216),u=n(17321),h=n(79132),m=n(25627),p=n(44519),y=n(35422),g=n(25571),v=n(9099),f=n(3879),b=n(4174),S=n(72669),C=n(82144),w=n(9976),_=n(96095),I=n(22753),P=n(89965),E=n(62329),O=n(13655),A=n(65377),k=n(96852),T=n(83208),N=n(58636),M=n(7894),x=n(91250),D=n(87796),z=n(84667),F=n(75568),B=n(87920),R=n(87089),L=n(39986),j=n.n(L),U=n(4164),V=n(14950),q=n.n(V),H={785:e=>{e.exports=i||(i=n.t(r,2))},939:e=>{e.exports=o}},G={};function $(e){var t=G[e];if(void 0!==t)return t.exports;var n=G[e]={exports:{}};return H[e](n,n.exports,$),n.exports}$.d=(e,t)=>{for(var n in t)$.o(t,n)&&!$.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},$.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),$.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var W={};$.r(W),$.d(W,{createAmazonPayV2CustomerStrategy:()=>Bn,createApplePayCustomerStrategy:()=>mi,createBigCommercePaymentsCustomerStrategy:()=>Ri,createBigCommercePaymentsFastlaneCustomerStrategy:()=>rr,createBigCommercePaymentsPayLaterCustomerStrategy:()=>sr,createBigCommercePaymentsVenmoCustomerStrategy:()=>lr,createBoltCustomerStrategy:()=>Sr,createBraintreeFastlaneCustomerStrategy:()=>Hr,createBraintreePaypalCreditCustomerStrategy:()=>Br,createBraintreePaypalCustomerStrategy:()=>Dr,createBraintreeVisaCheckoutCustomerStrategy:()=>Wr,createGooglePayAdyenV2CustomerStrategy:()=>So,createGooglePayAdyenV3CustomerStrategy:()=>Co,createGooglePayAuthorizeDotNetCustomerStrategy:()=>_o,createGooglePayBigCommercePaymentsCustomerStrategy:()=>ea,createGooglePayBnzCustomerStrategy:()=>No,createGooglePayBraintreeCustomerStrategy:()=>Go,createGooglePayCheckoutComCustomerStrategy:()=>Ao,createGooglePayCybersourceCustomerStrategy:()=>To,createGooglePayOrbitalCustomerStrategy:()=>xo,createGooglePayPayPalCommerceCustomerStrategy:()=>Jo,createGooglePayStripeCustomerStrategy:()=>Lo,createGooglePayStripeUpeCustomerStrategy:()=>jo,createGooglePayTdOnlineMartCustomerStrategy:()=>ra,createGooglePayWorldpayAccessCustomerStrategy:()=>Vo,createPayPalCommerceCreditCustomerStrategy:()=>Ia,createPayPalCommerceCustomerStrategy:()=>Ca,createPayPalCommerceFastlaneCustomerStrategy:()=>qa,createPayPalCommerceVenmoCustomerStrategy:()=>Oa,createStripeLinkV2CustomerStrategy:()=>gs,createStripeUPECustomerStrategy:()=>os});var Y={};$.r(Y),$.d(Y,{createAdyenV2PaymentStrategy:()=>Ts,createAdyenV3PaymentStrategy:()=>zs,createAffirmPaymentStrategy:()=>js,createAfterpayPaymentStrategy:()=>Ws,createAmazonPayV2PaymentStrategy:()=>Qs,createApplePayPaymentStrategy:()=>ed,createBigCommercePaymentsAlternativeMethodsPaymentStrategy:()=>Od,createBigCommercePaymentsCreditCardsPaymentStrategy:()=>Id,createBigCommercePaymentsFastlanePaymentStrategy:()=>cd,createBigCommercePaymentsPayLaterPaymentStrategy:()=>md,createBigCommercePaymentsPaymentStrategy:()=>od,createBigCommercePaymentsRatePayPayPaymentStrategy:()=>vd,createBigCommercePaymentsVenmoPaymentStrategy:()=>Td,createBlueSnapDirectAPMPaymentStrategy:()=>Qd,createBlueSnapDirectCreditCardPaymentStrategy:()=>Yd,createBlueSnapV2PaymentStrategy:()=>tc,createBoltPaymentStrategy:()=>dc,createBraintreeAchPaymentStrategy:()=>hc,createBraintreeCreditCardPaymentStrategy:()=>Vc,createBraintreeFastlanePaymentStrategy:()=>Ac,createBraintreeLocalMethodsPaymentStrategy:()=>Ic,createBraintreePaypalPaymentStrategy:()=>Sc,createBraintreeVenmoPaymentStrategy:()=>Dc,createBraintreeVisaCheckoutPaymentStrategy:()=>Nc,createCheckoutComAPMPaymentStrategy:()=>sl,createCheckoutComCreditCardPaymentStrategy:()=>el,createCheckoutComFawryPaymentStrategy:()=>Kc,createCheckoutComIdealPaymentStrategy:()=>rl,createCheckoutComSepaPaymentStrategy:()=>nl,createClearpayPaymentStrategy:()=>ul,createCreditCardPaymentStrategy:()=>hl,createCyberSourcePaymentStrategy:()=>Ol,createCyberSourceV2PaymentStrategy:()=>Ml,createExternalPaymentStrategy:()=>Dl,createGooglePayAdyenV2PaymentStrategy:()=>jl,createGooglePayAdyenV3PaymentStrategy:()=>ql,createGooglePayAuthorizeNetPaymentStrategy:()=>Hl,createGooglePayBigCommercePaymentsPaymentStrategy:()=>au,createGooglePayBraintreePaymentStrategy:()=>Ql,createGooglePayCheckoutComPaymentStrategy:()=>Gl,createGooglePayCybersourcePaymentStrategy:()=>$l,createGooglePayOrbitalPaymentStrategy:()=>Wl,createGooglePayPPCPPaymentStrategy:()=>tu,createGooglePayStripePaymentStrategy:()=>Yl,createGooglePayTdOnlineMartPaymentStrategy:()=>su,createGooglePayWorldpayAccessPaymentStrategy:()=>Kl,createHummPaymentStrategy:()=>lu,createKlarnaPaymentStrategy:()=>gu,createKlarnaV2PaymentStrategy:()=>Cu,createLegacyPaymentStrategy:()=>_u,createMolliePaymentStrategy:()=>ku,createMonerisPaymentStrategy:()=>xu,createNoPaymentStrategy:()=>zu,createOfflinePaymentStrategy:()=>Bu,createOffsitePaymentStrategy:()=>ju,createPayPalCommerceAlternativeMethodsPaymentStrategy:()=>eh,createPayPalCommerceCreditCardsPaymentStrategy:()=>rh,createPayPalCommerceCreditPaymentStrategy:()=>Yu,createPayPalCommerceFastlanePaymentStrategy:()=>uh,createPayPalCommercePaymentStrategy:()=>Gu,createPayPalCommerceRatePayPaymentStrategy:()=>sh,createPayPalCommerceVenmoPaymentStrategy:()=>Ju,createPayPalProPaymentStrategy:()=>ph,createSagePayPaymentStrategy:()=>gh,createSezzlePaymentStrategy:()=>fh,createSquareV2PaymentStrategy:()=>Eh,createStripeOCSPaymentStrategy:()=>Gh,createStripeUPEPaymentStrategy:()=>Vh,createStripeV3PaymentStrategy:()=>Bh,createTDOnlineMartPaymentStrategy:()=>Qh,createWorldpayAccessPaymentStrategy:()=>tm,createZipPaymentStrategy:()=>rm});var K,Q,J,Z,X={};function ee(e,t,n){return(i=t)&&i.type&&i.error?(0,m.x)((0,b.of)(t),(0,S.$)((0,d.fQ)(e,t.payload,n))):(0,S.$)((0,d.fQ)(e,t,n));var i}$.r(X),$.d(X,{createAmazonPayV2ButtonStrategy:()=>Sb,createApplePayButtonStrategy:()=>Pb,createBigCommercePaymentsAlternativeMethodsButtonStrategy:()=>Db,createBigCommercePaymentsButtonStrategy:()=>Ab,createBigCommercePaymentsPayLaterButtonStrategy:()=>Nb,createBigCommercePaymentsVenmoButtonStrategy:()=>Bb,createBoltButtonStrategy:()=>Lb,createBraintreePaypalButtonStrategy:()=>Hb,createBraintreePaypalCreditButtonStrategy:()=>Wb,createBraintreeVenmoButtonStrategy:()=>nS,createBraintreeVisaCheckoutButtonStrategy:()=>Qb,createGooglePayAdyenV2ButtonStrategy:()=>dS,createGooglePayAdyenV3ButtonStrategy:()=>cS,createGooglePayAuthorizeDotNetButtonStrategy:()=>lS,createGooglePayBigCommercePaymentsButtonStrategy:()=>sS,createGooglePayBraintreeButtonStrategy:()=>oS,createGooglePayCheckoutComButtonStrategy:()=>uS,createGooglePayCybersourceButtonStrategy:()=>hS,createGooglePayOrbitalButtonStrategy:()=>mS,createGooglePayPayPalCommerceButtonStrategy:()=>aS,createGooglePayStripeButtonStrategy:()=>pS,createGooglePayTdOnlineMartButtonStrategy:()=>gS,createGooglePayWorldpayAccessButtonStrategy:()=>yS,createPayPalCommerceAlternativeMethodsButtonStrategy:()=>AS,createPayPalCommerceButtonStrategy:()=>bS,createPayPalCommerceCreditButtonStrategy:()=>wS,createPayPalCommerceVenmoButtonStrategy:()=>PS,createPaypalExpressButtonStrategy:()=>BS});class te extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}(J=K||(K={}))[J.MissingBillingAddress=0]="MissingBillingAddress",J[J.MissingCart=1]="MissingCart",J[J.MissingCheckout=2]="MissingCheckout",J[J.MissingConsignments=3]="MissingConsignments",J[J.MissingCustomer=4]="MissingCustomer",J[J.MissingCheckoutConfig=5]="MissingCheckoutConfig",J[J.MissingOrder=6]="MissingOrder",J[J.MissingOrderConfig=7]="MissingOrderConfig",J[J.MissingOrderId=8]="MissingOrderId",J[J.MissingPayment=9]="MissingPayment",J[J.MissingPaymentId=10]="MissingPaymentId",J[J.MissingPaymentInstrument=11]="MissingPaymentInstrument",J[J.MissingPaymentMethod=12]="MissingPaymentMethod",J[J.MissingPaymentProviderCustomer=13]="MissingPaymentProviderCustomer",J[J.MissingPaymentRedirectUrl=14]="MissingPaymentRedirectUrl",J[J.MissingPaymentStatus=15]="MissingPaymentStatus",J[J.MissingPaymentToken=16]="MissingPaymentToken",J[J.MissingShippingAddress=17]="MissingShippingAddress";class ne extends te{constructor(e){super(function(e){switch(e){case K.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case K.MissingCart:return"Unable to proceed because cart data is unavailable.";case K.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case K.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case K.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case K.MissingCheckoutConfig:case K.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case K.MissingOrder:return"Unable to proceed because order data is unavailable.";case K.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case K.MissingPayment:return"Unable to proceed because payment data is unavailable.";case K.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case K.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case K.MissingPaymentProviderCustomer:return"Unable to proceed because payment provider customer is unavailable.";case K.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}!function(e){e.UpdateBillingAddressRequested="UPDATE_BILLING_ADDRESS_REQUESTED",e.UpdateBillingAddressSucceeded="UPDATE_BILLING_ADDRESS_SUCCEEDED",e.UpdateBillingAddressFailed="UPDATE_BILLING_ADDRESS_FAILED",e.ContinueAsGuestRequested="CONTINUE_AS_GUEST_REQUESTED",e.ContinueAsGuestSucceeded="CONTINUE_AS_GUEST_SUCCEEDED",e.ContinueAsGuestFailed="CONTINUE_AS_GUEST_FAILED"}(Q||(Q={}));class ie extends te{constructor(e){super(e||"Unable to continue as a guest because the customer is already signed in."),this.name="UnableToContinueAsGuestError",this.type="unable_to_continue_as_guest"}}class re{constructor(e,t){this._requestSender=e,this._subscriptionActionCreator=t}continueAsGuest(e,t){return n=>{const i=n.getState(),r=i.checkout.getCheckout();if(!r)throw new ne(K.MissingCheckout);const o=i.customer.getCustomer();if(o&&!o.isGuest)throw new ie;const a=i.billingAddress.getBillingAddress();let s;if(a){const{country:t}=a,n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(a,["country"]);s=Object.assign(Object.assign({},n),e)}else s=e;const l=!(0,c.isEmpty)(a);return(0,f.h)((0,m.x)((0,b.of)((0,d.VP)(Q.ContinueAsGuestRequested)),(0,p.v)((()=>{return e=this,i=function*(){const{body:e}=yield this._createOrUpdateBillingAddress(r.id,s,l,t);return(0,d.VP)(Q.ContinueAsGuestSucceeded,e)},new((n=void 0)||(n=Promise))((function(t,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(e,[])).next())}));var e,n,i}))).pipe((0,C.W)((e=>ee(Q.ContinueAsGuestFailed,e)))),this._updateCustomerConsent(e,t))}}updateAddress(e,t){return n=>l.c.create((i=>{const r=n.getState(),o=r.checkout.getCheckout();if(!o)throw new ne(K.MissingCheckout);i.next((0,d.VP)(Q.UpdateBillingAddressRequested));const a=r.billingAddress.getBillingAddress(),s=!(0,c.isEmpty)(a),l=Object.assign(Object.assign({},e),{email:void 0===e.email&&a?a.email:e.email});a&&a.id&&(l.id=a.id),this._createOrUpdateBillingAddress(o.id,l,s,t).then((({body:e})=>{i.next((0,d.VP)(Q.UpdateBillingAddressSucceeded,e)),i.complete()})).catch((e=>{i.error((0,d.fQ)(Q.UpdateBillingAddressFailed,e))}))}))}_updateCustomerConsent({email:e,acceptsAbandonedCartEmails:t,acceptsMarketingNewsletter:n},i){return null==t&&null==n?(0,y.I)():this._subscriptionActionCreator.updateSubscriptions({email:e,acceptsMarketingNewsletter:n||!1,acceptsAbandonedCartEmails:t||!1},i)}_createOrUpdateBillingAddress(e,t,n,i){return n?this._requestSender.updateAddress(e,t,i):this._requestSender.createAddress(e,t,i)}}class oe extends te{constructor(e){super(e||"Your checkout could not be processed because your cart is empty. Please add items to your cart and try again."),this.name="EmptyCartError",this.type="empty_cart"}}!function(e){e.Json="application/json",e.JsonV1="application/vnd.bc.v1+json"}(Z||(Z={}));const ae=Z,se={"X-Checkout-SDK-Version":"1.808.0"},de={include:["cart.lineItems.physicalItems.options","cart.lineItems.digitalItems.options","customer","promotions.banners"].join(",")};class ce{constructor(e){this._requestSender=e}createAddress(e,t,{timeout:n}={}){const i=`/api/storefront/checkouts/${e}/billing-address`,r=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.post(i,{body:t,params:de,headers:r,timeout:n}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}updateAddress(e,t,{timeout:n}={}){const{id:i}=t,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["id"]),o=`/api/storefront/checkouts/${e}/billing-address/${i}`,a=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.put(o,{params:de,body:r,headers:a,timeout:n}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}}var le,ue;function he(e,t){const n=(0,d.iN)(((e,t)=>t.type===le.Synchronize?t.payload:e),e.getState(),{stateTransformer:t});return e.subscribe((e=>{n.dispatch((0,d.VP)(le.Synchronize,e))}),{initial:!1}),n}!function(e){e.Synchronize="SYNCHRONIZE"}(le||(le={}));class me{log(e){console.error(e)}}!function(e){e.ClearError="CLEAR_ERROR"}(ue||(ue={}));class pe{clearError(e){return{type:ue.ClearError,payload:e}}}function ye(){try{return"production"}catch(e){return"development"}}class ge{constructor(e){this._console=e}log(...e){this._logToConsole("log",...e)}info(...e){this._logToConsole("info",...e)}warn(...e){this._logToConsole("warn",...e)}error(...e){this._logToConsole("error",...e)}debug(...e){this._logToConsole("debug",...e)}_logToConsole(e,...t){this._console&&this._console[e]&&this._console[e].call(this._console,...t)}}class ve{log(){}info(){}warn(){}error(){}debug(){}}const fe=function(e=!0){return e?new ge(console):new ve}("test"!==ye());function be(){return fe}function Se(e,t,n){const i=new WeakMap;function r(e){return(...n)=>{const r=n[n.length-1],{useCache:o}=(a=r)&&"boolean"==typeof a.useCache?r:{useCache:!1};var a;if(!o)return e.call(this,...n);const s=i.get(this)||{};var d;return i.get(this)||i.set(this,s),s[t]||(s[t]=(d=e,(0,T.Bj)((function(...e){const t=d.call(this,...e);return t instanceof l.c?(0,g.H)(t).pipe((0,O.t)()):"function"==typeof t?(0,T.Bj)((e=>(0,g.H)(t(e)).pipe((0,O.t)())),{isEqual:c.isEqual}):t}),{isEqual:c.isEqual}))),s[t].call(this,...n)}}return{get(){if("function"!=typeof n.value)throw new Error("Decorator should be used in functions");const e=r.call(this,n.value);return Object.defineProperty(this,t,Object.assign(Object.assign({},n),{value:e})),e}}}var Ce;!function(e){e.LoadConfigRequested="LOAD_CONFIG_REQUESTED",e.LoadConfigSucceeded="LOAD_CONFIG_SUCCEEDED",e.LoadConfigFailed="LOAD_CONFIG_FAILED"}(Ce||(Ce={}));class we{constructor(e){this._configRequestSender=e}loadConfig(e){return l.c.create((t=>{t.next((0,d.VP)(Ce.LoadConfigRequested)),this._configRequestSender.loadConfig(e).then((e=>{t.next((0,d.VP)(Ce.LoadConfigSucceeded,e.body)),t.complete()})).catch((e=>{t.error((0,d.fQ)(Ce.LoadConfigFailed,e))}))}))}}!function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);o>3&&a&&Object.defineProperty(t,n,a)}([Se],we.prototype,"loadConfig",null);const _e={body:{},headers:{},status:0};class Ie extends te{constructor(e,{message:t,errors:n}={}){const{body:i,headers:r,status:o}=e||_e;super(t||"An unexpected error has occurred."),this.name="RequestError",this.type="request",this.body=i,this.headers=r,this.status=o,this.errors=n||[]}}class Pe extends Ie{constructor(e){super(e,{message:e.body.title}),this.name="CheckoutNotAvailableError",this.type="checkout_not_available"}}const Ee="This API endpoint is for internal use only and may change in the future";class Oe{constructor(e){this._requestSender=e}loadConfig({timeout:e,params:t}={}){return this._requestSender.get("/api/storefront/checkout-settings",{timeout:e,headers:Object.assign({Accept:ae.JsonV1,"X-API-INTERNAL":Ee},se),params:t}).catch((e=>{if(e.status>=400&&e.status<500)throw new Pe(e);throw e}))}}var Ae;!function(e){e.ApplyCouponRequested="APPLY_COUPON_REQUESTED",e.ApplyCouponSucceeded="APPLY_COUPON_SUCCEEDED",e.ApplyCouponFailed="APPLY_COUPON_FAILED",e.RemoveCouponRequested="REMOVE_COUPON_REQUESTED",e.RemoveCouponSucceeded="REMOVE_COUPON_SUCCEEDED",e.RemoveCouponFailed="REMOVE_COUPON_FAILED"}(Ae||(Ae={}));class ke{constructor(e){this._couponRequestSender=e}applyCoupon(e,t){return n=>l.c.create((i=>{const r=n.getState().checkout.getCheckout();if(!r)throw new ne(K.MissingCheckout);i.next((0,d.VP)(Ae.ApplyCouponRequested)),this._couponRequestSender.applyCoupon(r.id,e,t).then((({body:e})=>{i.next((0,d.VP)(Ae.ApplyCouponSucceeded,e)),i.complete()})).catch((e=>{i.error((0,d.fQ)(Ae.ApplyCouponFailed,e))}))}))}removeCoupon(e,t){return n=>l.c.create((i=>{const r=n.getState().checkout.getCheckout();if(!r)throw new ne(K.MissingCheckout);i.next((0,d.VP)(Ae.RemoveCouponRequested)),this._couponRequestSender.removeCoupon(r.id,e,t).then((({body:e})=>{i.next((0,d.VP)(Ae.RemoveCouponSucceeded,e)),i.complete()})).catch((e=>{i.error((0,d.fQ)(Ae.RemoveCouponFailed,e))}))}))}}const Te=["cart.lineItems.physicalItems.options","cart.lineItems.digitalItems.options","customer","customer.customerGroup","payments","promotions.banners"];var Ne,Me,xe,De,ze,Fe,Be,Re,Le;function je(e){return(0,c.uniq)(e).join(",")}!function(e){e.AvailableShippingOptions="consignments.availableShippingOptions",e.PhysicalItemsCategoryNames="cart.lineItems.physicalItems.categoryNames",e.DigitalItemsCategoryNames="cart.lineItems.digitalItems.categoryNames"}(Ne||(Ne={}));class Ue{constructor(e){this._requestSender=e}applyCoupon(e,t,{timeout:n}={}){const i=`/api/storefront/checkouts/${e}/coupons`,r=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.post(i,{headers:r,timeout:n,params:{include:je([...Te,Ne.AvailableShippingOptions])},body:{couponCode:t}}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}removeCoupon(e,t,{timeout:n}={}){const i=`/api/storefront/checkouts/${e}/coupons/${t}`,r=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.delete(i,{headers:r,timeout:n,params:{include:je([...Te,Ne.AvailableShippingOptions])}}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}}!function(e){e.ApplyGiftCertificateRequested="APPLY_GIFT_CERTIFICATE_REQUESTED",e.ApplyGiftCertificateSucceeded="APPLY_GIFT_CERTIFICATE_SUCCEEDED",e.ApplyGiftCertificateFailed="APPLY_GIFT_CERTIFICATE_FAILED",e.RemoveGiftCertificateRequested="REMOVE_GIFT_CERTIFICATE_REQUESTED",e.RemoveGiftCertificateSucceeded="REMOVE_GIFT_CERTIFICATE_SUCCEEDED",e.RemoveGiftCertificateFailed="REMOVE_GIFT_CERTIFICATE_FAILED"}(Me||(Me={}));class Ve{constructor(e){this._giftCertificateRequestSender=e}applyGiftCertificate(e,t){return n=>l.c.create((i=>{const r=n.getState().checkout.getCheckout();if(!r)throw new ne(K.MissingCheckout);i.next((0,d.VP)(Me.ApplyGiftCertificateRequested)),this._giftCertificateRequestSender.applyGiftCertificate(r.id,e,t).then((({body:e})=>{i.next((0,d.VP)(Me.ApplyGiftCertificateSucceeded,e)),i.complete()})).catch((e=>{i.error((0,d.fQ)(Me.ApplyGiftCertificateFailed,e))}))}))}removeGiftCertificate(e,t){return n=>l.c.create((i=>{const r=n.getState().checkout.getCheckout();if(!r)throw new ne(K.MissingCheckout);i.next((0,d.VP)(Me.RemoveGiftCertificateRequested)),this._giftCertificateRequestSender.removeGiftCertificate(r.id,e,t).then((({body:e})=>{i.next((0,d.VP)(Me.RemoveGiftCertificateSucceeded,e)),i.complete()})).catch((e=>{i.error((0,d.fQ)(Me.RemoveGiftCertificateFailed,e))}))}))}}class qe{constructor(e){this._requestSender=e}applyGiftCertificate(e,t,{timeout:n}={}){const i=`/api/storefront/checkouts/${e}/gift-certificates`,r=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.post(i,{headers:r,timeout:n,params:{include:je(Te)},body:{giftCertificateCode:t}}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}removeGiftCertificate(e,t,{timeout:n}={}){const i=`/api/storefront/checkouts/${e}/gift-certificates/${t}`,r=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.delete(i,{headers:r,timeout:n,params:{include:je(Te)}}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}}function He(e){return e&&"resolveIds"in e}function Ge(e,t){return Object.assign(e,{resolveIds:t})}class $e extends te{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class We{constructor(e){var t,n,i;this._factories={},this._instances={},this._defaultToken=null!==(t=null==e?void 0:e.defaultToken)&&void 0!==t?t:"default",this._useFallback=null===(n=null==e?void 0:e.useFallback)||void 0===n||n,this._tokenResolver=null!==(i=null==e?void 0:e.tokenResolver)&&void 0!==i?i:e=>e}get(e,t){try{return this._getInstance(e||this._defaultToken,t||e||this._defaultToken)}catch(e){if(!this._useFallback)throw e;return this._getInstance(this._defaultToken,t||this._defaultToken)}}getFactory(e){const t=this._tokenResolver(e,Object.keys(this._factories));return t?this._factories[t]:void 0}register(e,t){if(this._hasFactory(e))throw new $e(`'${e}' is already registered.`);this._factories[e]=t}_hasFactory(e){return!!this._factories[e]}_hasInstance(e){return!!this._instances[e]}_getInstance(e,t){if(!this._hasInstance(t)){const n=this.getFactory(e);if(!n)throw new $e(`'${e}' is not registered.`);this._instances[t]=n()}return this._instances[t]}}class Ye{constructor(e=!1){this._useFallback=e,this._registry=new We({tokenResolver:this._resolveToken.bind(this),useFallback:this._useFallback})}get(e){return this._registry.get(this._encodeToken(e))}getFactory(e){try{return this._registry.getFactory(this._encodeToken(e))}catch(e){return}}register(e,t){this._registry.register(this._encodeToken(e),t)}_encodeToken(e){return btoa(JSON.stringify(e))}_decodeToken(e){return JSON.parse(atob(e))}_resolveToken(e,t){var n;const i=this._decodeToken(e),r=[];t.forEach((e=>{const t=this._decodeToken(e),n={token:e,matches:0,default:!1};for(const[e,r]of Object.entries(t)){if(e in i&&i[e]!==r){n.matches=0;break}e in i&&i[e]===r&&n.matches++,"default"===e&&!0===r&&(n.default=!0)}r.push(n)}));const o=r.sort(((e,t)=>t.matches-e.matches)).filter((e=>e.matches>0));o.length>1&&o[0].matches===o[1].matches&&"development"===ye()&&be().warn("The provided query matches at least two strategies with the same specificity. This warning can be resolved by making their resolve ID more specific.");const a=o[0];if(a&&a.token)return a.token;if(this._useFallback){const e=null===(n=r.find((e=>e.default)))||void 0===n?void 0:n.token;if(e)return e}throw new Error("Unable to resolve to a registered token with the provided token.")}}function Ke(e){const t=e;return"object"==typeof t&&"object"==typeof t.payload&&"string"==typeof t.payload.token}!function(e){e.BuyNow="BUY_NOW"}(xe||(xe={})),function(e){e.SignInCustomerRequested="SIGN_IN_CUSTOMER_REQUESTED",e.SignInCustomerSucceeded="SIGN_IN_CUSTOMER_SUCCEEDED",e.SignInCustomerFailed="SIGN_IN_CUSTOMER_FAILED",e.SignOutCustomerRequested="SIGN_OUT_CUSTOMER_REQUESTED",e.SignOutCustomerSucceeded="SIGN_OUT_CUSTOMER_SUCCEEDED",e.SignOutCustomerFailed="SIGN_OUT_CUSTOMER_FAILED",e.CreateCustomerRequested="CREATE_CUSTOMER_REQUESTED",e.CreateCustomerSucceeded="CREATE_CUSTOMER_SUCCEEDED",e.CreateCustomerFailed="CREATE_CUSTOMER_FAILED",e.CreateCustomerAddressRequested="CREATE_CUSTOMER_ADDRESS_REQUESTED",e.CreateCustomerAddressSucceeded="CREATE_CUSTOMER_ADDRESS_SUCCEEDED",e.CreateCustomerAddressFailed="CREATE_CUSTOMER_ADDRESS_FAILED",e.StripeLinkAuthenticated="STRIPE_LINK_AUTHENTICATED"}(De||(De={}));class Qe{constructor(e,t,n){this._customerRequestSender=e,this._checkoutActionCreator=t,this._spamProtectionActionCreator=n}createCustomer(e,t){return n=>{const i=n.getState().config.getStoreConfigOrThrow(),{isStorefrontSpamProtectionEnabled:r}=i.checkoutSettings,o=i=>(0,g.H)(this._customerRequestSender.createAccount(Object.assign(Object.assign({},e),{token:i}),t)).pipe((0,A.n)((()=>(0,m.x)(this._checkoutActionCreator.loadCurrentCheckout(t)(n),(0,b.of)((0,d.VP)(De.CreateCustomerSucceeded))))));return(0,m.x)((0,b.of)((0,d.VP)(De.CreateCustomerRequested)),r?(0,g.H)(this._spamProtectionActionCreator.execute()(n)).pipe((0,A.n)((e=>{var t;return Ke(e)?(0,m.x)((0,b.of)(e),o(null===(t=e.payload)||void 0===t?void 0:t.token)):(0,b.of)(e)}))):o()).pipe((0,C.W)((e=>ee(De.CreateCustomerFailed,e))))}}createAddress(e,t){return(0,m.x)((0,b.of)((0,d.VP)(De.CreateCustomerAddressRequested)),(0,p.v)((()=>{return n=this,r=function*(){const{body:n}=yield this._customerRequestSender.createAddress(e,t);return(0,d.VP)(De.CreateCustomerAddressSucceeded,n)},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}))).pipe((0,C.W)((e=>ee(De.CreateCustomerAddressFailed,e))))}signInCustomer(e,t){return n=>{const i=n.getState().checkout.getCheckoutOrThrow(),r=i.cart.source===xe.BuyNow?i.id:void 0;return(0,m.x)((0,b.of)((0,d.VP)(De.SignInCustomerRequested)),(0,g.H)(this._customerRequestSender.signInCustomer(Object.assign(Object.assign({},e),{cartId:r}),t)).pipe((0,A.n)((({body:e})=>e.data.persistentCartRetrievalInformation?(0,m.x)(this._checkoutActionCreator.loadCheckout(e.data.persistentCartRetrievalInformation.id,t)(n),(0,b.of)((0,d.VP)(De.SignInCustomerSucceeded,e.data))):(0,m.x)(this._checkoutActionCreator.loadCurrentCheckout(t)(n),(0,b.of)((0,d.VP)(De.SignInCustomerSucceeded,e.data))))))).pipe((0,C.W)((e=>ee(De.SignInCustomerFailed,e))))}}signOutCustomer(e){return t=>{const n=t.getState().checkout.getCheckoutOrThrow(),i=n.cart.source===xe.BuyNow?n.id:void 0;return(0,m.x)((0,b.of)((0,d.VP)(De.SignOutCustomerRequested)),(0,g.H)(this._customerRequestSender.signOutCustomer(e,i)).pipe((0,A.n)((({body:n})=>(0,m.x)(this._checkoutActionCreator.loadCurrentCheckout(e)(t),(0,b.of)((0,d.VP)(De.SignOutCustomerSucceeded,n.data))))))).pipe((0,C.W)((e=>ee(De.SignOutCustomerFailed,e))))}}}class Je{constructor(e){this._requestSender=e}createAccount(e,{timeout:t}={}){return this._requestSender.post("/api/storefront/customer",{timeout:t,headers:se,body:e})}createAddress(e,{timeout:t}={}){return this._requestSender.post("/api/storefront/customer-address",{timeout:t,headers:se,body:e})}signInCustomer(e,{timeout:t}={}){return this._requestSender.post("/internalapi/v1/checkout/customer",{timeout:t,headers:se,body:e})}signOutCustomer({timeout:e}={},t){return this._requestSender.delete("/internalapi/v1/checkout/customer",Object.assign({timeout:e,headers:se},t&&{body:{cartId:t}}))}}function Ze(e,t,n=!0){var i;return null!==(i=e[t])&&void 0!==i?i:n}function Xe(e,t,n){t.forEach((t=>{He(t)&&t.resolveIds.forEach((i=>{if(e.getFactory(i))return;const r=Ge((()=>t(n)),t.resolveIds);e.register(i,r)}))}))}function et(e,t,n,i){const r=e.getFactory(n),o=t.some((e=>He(r)&&He(e)&&(0,c.isEqual)(r.resolveIds,e.resolveIds)));if(r&&!o){const e=`A different strategy is registered for ${JSON.stringify(n)}.`;i.log(new Error(e))}return o}!function(e){e.SignInFailed="CUSTOMER_STRATEGY_SIGN_IN_FAILED",e.SignInRequested="CUSTOMER_STRATEGY_SIGN_IN_REQUESTED",e.SignInSucceeded="CUSTOMER_STRATEGY_SIGN_IN_SUCCEEDED",e.SignOutFailed="CUSTOMER_STRATEGY_SIGN_OUT_FAILED",e.SignOutRequested="CUSTOMER_STRATEGY_SIGN_OUT_REQUESTED",e.SignOutSucceeded="CUSTOMER_STRATEGY_SIGN_OUT_SUCCEEDED",e.ExecutePaymentMethodCheckoutFailed="CUSTOMER_STRATEGY_EXECUTE_PAYMENT_METHOD_CHECKOUT_FAILED",e.ExecutePaymentMethodCheckoutRequested="CUSTOMER_STRATEGY_EXECUTE_PAYMENT_METHOD_CHECKOUT_REQUESTED",e.ExecutePaymentMethodCheckoutSucceeded="CUSTOMER_STRATEGY_EXECUTE_PAYMENT_METHOD_CHECKOUT_SUCCEEDED",e.InitializeFailed="CUSTOMER_STRATEGY_INITIALIZE_FAILED",e.InitializeRequested="CUSTOMER_STRATEGY_INITIALIZE_REQUESTED",e.InitializeSucceeded="CUSTOMER_STRATEGY_INITIALIZE_SUCCEEDED",e.DeinitializeFailed="CUSTOMER_STRATEGY_DEINITIALIZE_FAILED",e.DeinitializeRequested="CUSTOMER_STRATEGY_DEINITIALIZE_REQUESTED",e.DeinitializeSucceeded="CUSTOMER_STRATEGY_DEINITIALIZE_SUCCEEDED",e.WidgetInteractionStarted="CUSTOMER_STRATEGY_WIDGET_INTERACTION_STARTED",e.WidgetInteractionFinished="CUSTOMER_STRATEGY_WIDGET_INTERACTION_FINISHED",e.WidgetInteractionFailed="CUSTOMER_STRATEGY_WIDGET_INTERACTION_FAILED"}(ze||(ze={}));class tt{constructor(e,t,n,i){this._strategyRegistry=e,this._strategyRegistryV2=t,this._paymentIntegrationService=n,this._errorLogger=i}signIn(e,t){return l.c.create((n=>{const i=t&&t.methodId,r={methodId:i};n.next((0,d.VP)(ze.SignInRequested,void 0,r)),this._getStrategy(i).signIn(e,t).then((()=>{n.next((0,d.VP)(ze.SignInSucceeded,void 0,r)),n.complete()})).catch((e=>{n.error((0,d.fQ)(ze.SignInFailed,e,r))}))}))}signOut(e){return l.c.create((t=>{const n=e&&e.methodId,i={methodId:n};t.next((0,d.VP)(ze.SignOutRequested,void 0,i)),this._getStrategy(n).signOut(e).then((()=>{t.next((0,d.VP)(ze.SignOutSucceeded,void 0,i)),t.complete()})).catch((e=>{t.error((0,d.fQ)(ze.SignOutFailed,e,i))}))}))}executePaymentMethodCheckout(e){return l.c.create((t=>{const n=e&&e.methodId,i={methodId:n};t.next((0,d.VP)(ze.ExecutePaymentMethodCheckoutRequested,void 0,i)),this._getStrategy(n).executePaymentMethodCheckout(e).then((()=>{t.next((0,d.VP)(ze.ExecutePaymentMethodCheckoutSucceeded,void 0,i)),t.complete()})).catch((e=>{t.error((0,d.fQ)(ze.ExecutePaymentMethodCheckoutFailed,e,i))}))}))}initialize(e){return t=>l.c.create((n=>{var i,r;const o=t.getState(),a=e&&e.methodId,s={methodId:a},{features:c}=o.config.getStoreConfigOrThrow().checkoutSettings;if(Ze(c,"CHECKOUT-9450.lazy_load_payment_strategies",!1)){const t={id:a||""};et(this._strategyRegistryV2,null!==(i=null==e?void 0:e.integrations)&&void 0!==i?i:[],t,this._errorLogger),Xe(this._strategyRegistryV2,null!==(r=null==e?void 0:e.integrations)&&void 0!==r?r:[],this._paymentIntegrationService)}if(a&&o.customerStrategies.isInitialized(a))return n.complete();n.next((0,d.VP)(ze.InitializeRequested,void 0,s)),this._getStrategy(a).initialize(e).then((()=>{n.next((0,d.VP)(ze.InitializeSucceeded,void 0,s)),n.complete()})).catch((e=>{n.error((0,d.fQ)(ze.InitializeFailed,e,s))}))}))}deinitialize(e){return t=>l.c.create((n=>{const i=t.getState(),r=e&&e.methodId,o={methodId:r};if(r&&!i.customerStrategies.isInitialized(r))return n.complete();n.next((0,d.VP)(ze.DeinitializeRequested,void 0,o)),this._getStrategy(r).deinitialize(e).then((()=>{n.next((0,d.VP)(ze.DeinitializeSucceeded,void 0,o)),n.complete()})).catch((e=>{n.error((0,d.fQ)(ze.DeinitializeFailed,e,o))}))}))}widgetInteraction(e,t){return l.c.create((n=>{const i={methodId:t&&t.methodId};n.next((0,d.VP)(ze.WidgetInteractionStarted,void 0,i)),e().then((()=>{n.next((0,d.VP)(ze.WidgetInteractionFinished,void 0,i)),n.complete()})).catch((e=>{n.error((0,d.fQ)(ze.WidgetInteractionFailed,e,i))}))}))}_getStrategy(e){let t;try{t=this._strategyRegistryV2.get({id:e||""})}catch(n){t=this._strategyRegistry.get(e)}return t}}function nt(e,t=[]){return Array.isArray(t)?je([...e,...t]):function(e,t){const n=(0,c.keys)((0,c.pickBy)(t,(e=>!e))),i=(0,c.keys)((0,c.filter)(t));return je([...(0,c.difference)(e,n),...i])}(e,t)}class it{constructor(e){this._requestSender=e}loadCheckout(e,{params:{include:t}={},timeout:n}={}){const i=`/api/storefront/checkout/${e}`,r=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.get(i,{params:{include:nt(Te,t)},headers:r,timeout:n}).catch((e=>{if(e.status>=400&&e.status<500)throw new Pe(e);throw e}))}updateCheckout(e,t,{params:{include:n}={},timeout:i}={}){const r=`/api/storefront/checkout/${e}`,o=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.put(r,{params:{include:nt(Te,n)},body:t,headers:o,timeout:i})}}!function(e){e.LoadCheckoutRequested="LOAD_CHECKOUT_REQUESTED",e.LoadCheckoutSucceeded="LOAD_CHECKOUT_SUCCEEDED",e.LoadCheckoutFailed="LOAD_CHECKOUT_FAILED",e.UpdateCheckoutRequested="UPDATE_CHECKOUT_REQUESTED",e.UpdateCheckoutSucceeded="UPDATE_CHECKOUT_SUCCEEDED",e.UpdateCheckoutFailed="UPDATE_CHECKOUT_FAILED"}(Fe||(Fe={})),function(e){e.HydrateInitialState="HYDRATE_INITIAL_STATE"}(Be||(Be={}));class rt{constructor(e,t,n){this._checkoutRequestSender=e,this._configActionCreator=t,this._formFieldsActionCreator=n}loadCheckout(e,t){return()=>(0,m.x)((0,b.of)((0,d.VP)(Fe.LoadCheckoutRequested)),(0,f.h)(this._configActionCreator.loadConfig({useCache:!0,timeout:null==t?void 0:t.timeout,params:{checkoutId:e}}),this._formFieldsActionCreator.loadFormFields({useCache:!0,timeout:null==t?void 0:t.timeout})),(0,p.v)((()=>this._checkoutRequestSender.loadCheckout(e,t).then((({body:e})=>(0,d.VP)(Fe.LoadCheckoutSucceeded,this._transformCustomerAddresses(e))))))).pipe((0,C.W)((e=>ee(Fe.LoadCheckoutFailed,e))))}loadDefaultCheckout(e){return t=>(0,m.x)((0,b.of)((0,d.VP)(Fe.LoadCheckoutRequested)),(0,f.h)(this._configActionCreator.loadConfig({useCache:!0,timeout:null==e?void 0:e.timeout}),this._formFieldsActionCreator.loadFormFields({useCache:!0,timeout:null==e?void 0:e.timeout})),(0,p.v)((()=>{return n=this,r=function*(){const n=t.getState().config.getContextConfig();if(!n||!n.checkoutId)throw new ne(K.MissingCheckoutConfig);const{body:i}=yield this._checkoutRequestSender.loadCheckout(n.checkoutId,e);return(0,d.VP)(Fe.LoadCheckoutSucceeded,this._transformCustomerAddresses(i))},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}))).pipe((0,C.W)((e=>ee(Fe.LoadCheckoutFailed,e))))}updateCheckout(e,t){return n=>new l.c((i=>{const r=n.getState().checkout.getCheckout();if(!r)throw new ne(K.MissingCheckout);i.next((0,d.VP)(Fe.UpdateCheckoutRequested)),this._checkoutRequestSender.updateCheckout(r.id,e,t).then((({body:e})=>{i.next((0,d.VP)(Fe.UpdateCheckoutSucceeded,e)),i.complete()})).catch((e=>{i.error((0,d.fQ)(Fe.UpdateCheckoutFailed,e))}))}))}loadCurrentCheckout(e){return t=>{const n=t.getState().checkout.getCheckout();if(!n)throw new ne(K.MissingCheckout);return this.loadCheckout(n.id,e)(t)}}hydrateInitialState(e){return{type:Be.HydrateInitialState,payload:e}}_transformCustomerAddresses(e){return Object.assign(Object.assign({},e),{customer:Object.assign(Object.assign({},e.customer),{addresses:e.customer.addresses.map((e=>Object.assign(Object.assign({},e),{shouldSaveAddress:!1})))})})}}!function(e){e.LoadFormFieldsRequested="LOAD_FORM_FIELDS_REQUESTED",e.LoadFormFieldsSucceeded="LOAD_FORM_FIELDS_SUCCEEDED",e.LoadFormFieldsFailed="LOAD_FORM_FIELDS_FAILED"}(Re||(Re={}));class ot{constructor(e){this._formFieldsRequestSender=e}loadFormFields(e){return(0,m.x)((0,b.of)((0,d.VP)(Re.LoadFormFieldsRequested)),(0,p.v)((()=>{return t=this,i=function*(){const{body:t}=yield this._formFieldsRequestSender.loadFields(e);return(0,d.VP)(Re.LoadFormFieldsSucceeded,t)},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}))).pipe((0,C.W)((e=>ee(Re.LoadFormFieldsFailed,e))))}}!function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);o>3&&a&&Object.defineProperty(t,n,a)}([Se],ot.prototype,"loadFormFields",null);class at{constructor(e){this._requestSender=e}loadFields({timeout:e}={}){return this._requestSender.get("/api/storefront/form-fields",{timeout:e,headers:Object.assign({Accept:ae.JsonV1,"X-API-INTERNAL":Ee},se)})}}!function(e){e.LoadPaymentMethodRequested="LOAD_PAYMENT_METHOD_REQUESTED",e.LoadPaymentMethodSucceeded="LOAD_PAYMENT_METHOD_SUCCEEDED",e.LoadPaymentMethodFailed="LOAD_PAYMENT_METHOD_FAILED",e.LoadPaymentMethodsRequested="LOAD_PAYMENT_METHODS_REQUESTED",e.LoadPaymentMethodsSucceeded="LOAD_PAYMENT_METHODS_SUCCEEDED",e.LoadPaymentMethodsFailed="LOAD_PAYMENT_METHODS_FAILED"}(Le||(Le={}));const st=e=>!!e;class dt{constructor(e){this._requestSender=e}loadPaymentMethodsById(e,t){return n=>new l.c((i=>{var r;const o=null===(r=n.getState().cart.getCart())||void 0===r?void 0:r.id,a=o?Object.assign(Object.assign({},null==t?void 0:t.params),{cartId:o}):Object.assign({},null==t?void 0:t.params);i.next((0,d.VP)(Le.LoadPaymentMethodsRequested)),Promise.all(e.map((e=>{return n=this,r=function*(){try{return(yield this._requestSender.loadPaymentMethod(e,Object.assign(Object.assign({},t),{params:a}))).body}catch(e){return}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}))).then((e=>{const t=e.filter(st);i.next((0,d.VP)(Le.LoadPaymentMethodsSucceeded,t)),i.complete()})).catch((e=>{i.next((0,d.VP)(Le.LoadPaymentMethodsFailed,e)),i.complete()}))}))}loadPaymentMethods(e){return t=>l.c.create((n=>{const i=t.getState().cart.getCartOrThrow();n.next((0,d.VP)(Le.LoadPaymentMethodsRequested)),this._requestSender.loadPaymentMethods(Object.assign(Object.assign({},e),{params:Object.assign(Object.assign({},null==e?void 0:e.params),{cartId:i.id})})).then((e=>{const t={deviceSessionId:e.headers["x-device-session-id"],sessionHash:e.headers["x-session-hash"]},i=e.body;n.next((0,d.VP)(Le.LoadPaymentMethodsSucceeded,i,t)),n.complete()})).catch((e=>{n.error((0,d.fQ)(Le.LoadPaymentMethodsFailed,e))}))}))}loadPaymentMethod(e,t){return n=>l.c.create((i=>{var r;const o=null===(r=n.getState().cart.getCart())||void 0===r?void 0:r.id,a=o?Object.assign(Object.assign({},null==t?void 0:t.params),{cartId:o}):Object.assign({},null==t?void 0:t.params);i.next((0,d.VP)(Le.LoadPaymentMethodRequested,void 0,{methodId:e})),this._requestSender.loadPaymentMethod(e,Object.assign(Object.assign({},t),{params:a})).then((t=>{i.next((0,d.VP)(Le.LoadPaymentMethodSucceeded,t.body,{methodId:e})),i.complete()})).catch((t=>{i.error((0,d.fQ)(Le.LoadPaymentMethodFailed,t,{methodId:e}))}))}))}}!function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);o>3&&a&&Object.defineProperty(t,n,a)}([Se],dt.prototype,"loadPaymentMethod",null);class ct{constructor(e){this._requestSender=e}loadPaymentMethods({timeout:e,params:t}={}){return this._requestSender.get("/api/storefront/payments",{timeout:e,headers:Object.assign({Accept:ae.JsonV1,"X-API-INTERNAL":Ee},se),params:t})}loadPaymentMethod(e,{timeout:t,params:n}={}){const i=`/api/storefront/payments/${e}`;return this._requestSender.get(i,{timeout:t,headers:Object.assign({Accept:ae.JsonV1,"X-API-INTERNAL":Ee},se),params:n})}}class lt extends te{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}var ut,ht;class mt{constructor(e,t=window){this._scriptLoader=e,this._window=t}load({useMasterpassSrc:e,language:t,testMode:n,checkoutId:i}){return r=this,a=function*(){if(e){const e=[`https://${n?"sandbox.":""}src.mastercard.com/srci/integration/merchant.js`,[`locale=${t}`,`checkoutid=${i}`].join("&")].join("?");if(yield this._scriptLoader.loadScript(e),!this._window.masterpass)throw new lt;return this._window.masterpass}if(yield this._scriptLoader.loadScript(`//${n?"sandbox.":""}masterpass.com/integration/merchant.js`),!this._window.masterpass)throw new lt;return this._window.masterpass},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(n,i)}s((a=a.apply(r,[])).next())}));var r,o,a}}class pt{constructor(e){this._requestSender=e}initializeBilling(e,t,{timeout:n}={}){const i=`/remote-checkout/${e}/billing`;return this._requestSender.get(i,{params:t,timeout:n,headers:se})}initializeShipping(e,t,{timeout:n}={}){const i=`/remote-checkout/${e}/shipping`;return this._requestSender.get(i,{params:t,timeout:n,headers:se})}initializePayment(e,t,{timeout:n}={}){const i=`/remote-checkout/${e}/payment`;return this._requestSender.get(i,{params:t,timeout:n,headers:se})}loadSettings(e,{timeout:t}={}){const n=`/remote-checkout/${e}/settings`;return this._requestSender.get(n,{timeout:t,headers:se})}signOut(e,{timeout:t}={}){const n=`/remote-checkout/${e}/signout`;return this._requestSender.get(n,{timeout:t,headers:se})}generateToken({timeout:e}={}){return this._requestSender.get("/remote-checkout-token",{timeout:e,headers:se})}trackAuthorizationEvent({timeout:e}={}){return this._requestSender.post("/remote-checkout/events/shopper-checkout-service-provider-authorization-requested",{timeout:e,headers:se})}forgetCheckout({timeout:e}={}){return this._requestSender.post("/remote-checkout/forget-checkout",{timeout:e,headers:se})}}!function(e){e.ForgetCheckoutRemoteCustomerRequested="FORGET_CHECKOUT_REMOTE_CUSTOMER_REQUESTED",e.ForgetCheckoutRemoteCustomerSucceeded="FORGET_CHECKOUT_REMOTE_CUSTOMER_SUCCEEDED",e.ForgetCheckoutRemoteCustomerFailed="FORGET_CHECKOUT_REMOTE_CUSTOMER_FAILED",e.InitializeRemoteBillingRequested="INITIALIZE_REMOTE_BILLING_REQUESTED",e.InitializeRemoteBillingSucceeded="INITIALIZE_REMOTE_BILLING_SUCCEEDED",e.InitializeRemoteBillingFailed="INITIALIZE_REMOTE_BILLING_FAILED",e.InitializeRemoteShippingRequested="INITIALIZE_REMOTE_SHIPPING_REQUESTED",e.InitializeRemoteShippingSucceeded="INITIALIZE_REMOTE_SHIPPING_SUCCEEDED",e.InitializeRemoteShippingFailed="INITIALIZE_REMOTE_SHIPPING_FAILED",e.InitializeRemotePaymentRequested="INITIALIZE_REMOTE_PAYMENT_REQUESTED",e.InitializeRemotePaymentSucceeded="INITIALIZE_REMOTE_PAYMENT_SUCCEEDED",e.InitializeRemotePaymentFailed="INITIALIZE_REMOTE_PAYMENT_FAILED",e.LoadRemoteSettingsRequested="LOAD_REMOTE_SETTINGS_REQUESTED",e.LoadRemoteSettingsSucceeded="LOAD_REMOTE_SETTINGS_SUCCEEDED",e.LoadRemoteSettingsFailed="LOAD_REMOTE_SETTINGS_FAILED",e.SignOutRemoteCustomerRequested="SIGN_OUT_REMOTE_CUSTOMER_REQUESTED",e.SignOutRemoteCustomerSucceeded="SIGN_OUT_REMOTE_CUSTOMER_SUCCEEDED",e.SignOutRemoteCustomerFailed="SIGN_OUT_REMOTE_CUSTOMER_FAILED",e.UpdateRemoteCheckout="UPDATE_REMOTE_CHECKOUT"}(ut||(ut={}));class yt{constructor(e,t){this._remoteCheckoutRequestSender=e,this._checkoutActionCreator=t}initializeBilling(e,t,n){return l.c.create((i=>{i.next((0,d.VP)(ut.InitializeRemoteBillingRequested,void 0,{methodId:e})),this._remoteCheckoutRequestSender.initializeBilling(e,t,n).then((({body:t={}})=>{i.next((0,d.VP)(ut.InitializeRemoteBillingSucceeded,t,{methodId:e})),i.complete()})).catch((t=>{i.error((0,d.fQ)(ut.InitializeRemoteBillingFailed,t,{methodId:e}))}))}))}initializeShipping(e,t,n){return l.c.create((i=>{i.next((0,d.VP)(ut.InitializeRemoteShippingRequested,void 0,{methodId:e})),this._remoteCheckoutRequestSender.initializeShipping(e,t,n).then((({body:t={}})=>{i.next((0,d.VP)(ut.InitializeRemoteShippingSucceeded,t,{methodId:e})),i.complete()})).catch((t=>{i.error((0,d.fQ)(ut.InitializeRemoteShippingFailed,t,{methodId:e}))}))}))}initializePayment(e,t,n){return l.c.create((i=>{i.next((0,d.VP)(ut.InitializeRemotePaymentRequested,void 0,{methodId:e})),this._remoteCheckoutRequestSender.initializePayment(e,t,n).then((({body:t={}})=>{i.next((0,d.VP)(ut.InitializeRemotePaymentSucceeded,t,{methodId:e})),i.complete()})).catch((t=>{i.error((0,d.fQ)(ut.InitializeRemotePaymentFailed,t,{methodId:e}))}))}))}loadSettings(e,t){return l.c.create((n=>{n.next((0,d.VP)(ut.LoadRemoteSettingsRequested,void 0,{methodId:e})),this._remoteCheckoutRequestSender.loadSettings(e,t).then((({body:t})=>{n.next((0,d.VP)(ut.LoadRemoteSettingsSucceeded,t,{methodId:e})),n.complete()})).catch((t=>{n.error((0,d.fQ)(ut.LoadRemoteSettingsFailed,t,{methodId:e}))}))}))}signOut(e,t){return l.c.create((n=>{n.next((0,d.VP)(ut.SignOutRemoteCustomerRequested,void 0,{methodId:e})),this._remoteCheckoutRequestSender.signOut(e,t).then((()=>{n.next((0,d.VP)(ut.SignOutRemoteCustomerSucceeded,void 0,{methodId:e})),n.complete()})).catch((t=>{n.error((0,d.fQ)(ut.SignOutRemoteCustomerFailed,t,{methodId:e}))}))}))}forgetCheckout(e,t){return(0,m.x)((0,b.of)((0,d.VP)(ut.ForgetCheckoutRemoteCustomerRequested,void 0,{methodId:e})),(0,p.v)((()=>{return n=this,r=function*(){return yield this._remoteCheckoutRequestSender.forgetCheckout(t),yield this._checkoutActionCreator.loadCurrentCheckout(),(0,d.VP)(ut.ForgetCheckoutRemoteCustomerSucceeded,void 0,{methodId:e})},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}))).pipe((0,C.W)((t=>ee(ut.ForgetCheckoutRemoteCustomerFailed,t,{methodId:e}))))}updateCheckout(e,t){return(0,d.VP)(ut.UpdateRemoteCheckout,t,{methodId:e})}}class gt extends te{constructor(){super("You haven't complete our spam protection challenge. Please try again."),this.name="SpamProtectionChallengeNotCompletedError",this.type="spam_protection_challenge_not_completed"}}class vt extends te{constructor(){super("We were not able to complete your spam protection verification. Please try again."),this.name="SpamProtectionFailedError",this.type="spam_protection_failed"}}!function(e){e.InitializeFailed="SPAM_PROTECTION_INITIALIZE_FAILED",e.InitializeSucceeded="SPAM_PROTECTION_INITIALIZE_SUCCEEDED",e.InitializeRequested="SPAM_PROTECTION_INITIALIZE_REQUESTED",e.VerifyCheckoutRequested="SPAM_PROTECTION_CHECKOUT_VERIFY_REQUESTED",e.VerifyCheckoutSucceeded="SPAM_PROTECTION_CHECKOUT_VERIFY_SUCCEEDED",e.VerifyCheckoutFailed="SPAM_PROTECTION_CHECKOUT_VERIFY_FAILED",e.ExecuteRequested="SPAM_PROTECTION_EXECUTE_REQUESTED",e.ExecuteSucceeded="SPAM_PROTECTION_EXECUTE_SUCCEEDED",e.ExecuteFailed="SPAM_PROTECTION_EXECUTE_FAILED"}(ht||(ht={}));var ft,bt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class St{constructor(e,t){this._googleRecaptcha=e,this._requestSender=t}initialize(e){return t=>(0,m.x)((0,b.of)((0,d.VP)(ht.InitializeRequested,void 0)),(0,p.v)((()=>bt(this,void 0,void 0,(function*(){const n=e?e.containerId:"spamProtectionContainer";if(document.getElementById(n)&&this._googleRecaptcha.reset(n),!e&&!document.getElementById(n)){const e=document.createElement("div");e.setAttribute("id",n),document.body.appendChild(e)}const i=t.getState().config.getStoreConfigOrThrow().checkoutSettings.googleRecaptchaSitekey;return yield this._googleRecaptcha.load(n,i),(0,d.VP)(ht.InitializeSucceeded)}))))).pipe((0,C.W)((e=>ee(ht.InitializeFailed,e))))}verifyCheckoutSpamProtection(){return e=>(0,p.v)((()=>{const t=e.getState().checkout.getCheckout();if(!t)throw new ne(K.MissingCheckout);return(0,m.x)((0,b.of)((0,d.VP)(ht.VerifyCheckoutRequested)),(0,g.H)(this.execute()(e)).pipe((0,A.n)((e=>Ke(e)&&e.payload?(0,g.H)(this._requestSender.validate(t.id,e.payload.token)).pipe((0,A.n)((({body:t})=>(0,m.x)((0,b.of)(e),(0,b.of)((0,d.VP)(ht.VerifyCheckoutSucceeded,t)))))):(0,b.of)(e))))).pipe((0,C.W)((e=>ee(ht.VerifyCheckoutFailed,e))))}))}execute(){return e=>(0,m.x)((0,b.of)((0,d.VP)(ht.ExecuteRequested)),this.initialize()(e),this._googleRecaptcha.execute().pipe((0,k.s)(1)).pipe((0,A.n)((({error:e,token:t})=>bt(this,void 0,void 0,(function*(){if(e instanceof gt)throw e;if(e||!t)throw new vt;return(0,d.VP)(ht.ExecuteSucceeded,{token:t})})))))).pipe((0,C.W)((e=>ee(ht.ExecuteFailed,e))))}}class Ct{constructor(e=window){this._window=e}create(e){return new this._window.MutationObserver(e)}}!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(ft||(ft={}));class wt extends te{constructor(e){super(function(e){switch(e){case ft.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case ft.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case ft.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case ft.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}class _t extends te{constructor(){super("Spam protection is not loaded. Please try again."),this.name="SpamProtectionNotLoadedError",this.type="spam_protection_failed"}}class It{constructor(e,t){this.googleRecaptchaScriptLoader=e,this.mutationObserverFactory=t,this._memoized=(0,T.Bj)(((e,t,n)=>{const i=new u.B7;if(!n)throw new Error;return this._widgetId=e.render(n.id,{sitekey:t,size:"invisible",callback:()=>{i.next({token:e.getResponse(this._widgetId)}),e.reset(this._widgetId)},"error-callback":()=>{i.next({error:new vt})}}),i}),{isEqual:(e,t)=>e===t})}load(e,t){return this.googleRecaptchaScriptLoader.load().then((n=>{n&&(this._event$=this._memoized(n,t,document.getElementById(e)),this._recaptcha=n)})).catch((e=>{throw e}))}reset(e){var t;const n=document.getElementById(e);null==n||n.remove(),null===(t=this._recaptcha)||void 0===t||t.reset(this._widgetId)}execute(){return(0,p.v)((()=>{const e=this._event$,t=this._recaptcha;if(!e||!t)throw new wt(ft.SpamProtectionNotInitialized);return(0,p.v)((()=>{const e=document.querySelector('iframe[src*="bframe"]');return e?(0,b.of)(e):(0,S.$)(new _t)})).pipe((0,E.l)((e=>e.pipe((0,w.c)(250),(0,A.n)(((e,t)=>t<28?(0,b.of)(e):(0,S.$)(e)))))),(0,A.n)((n=>(this._watchRecaptchaChallengeWindow(e,n),t.execute(this._widgetId),e))),(0,C.W)((e=>(0,b.of)({error:e}))))}))}_watchRecaptchaChallengeWindow(e,t){const n=t.parentElement;if(!n)throw new _t;const i=n.parentElement;if(!i)throw new _t;this.mutationObserverFactory.create((()=>{"hidden"===i.style.visibility&&e.next({error:new gt})})).observe(i,{attributes:!0,attributeFilter:["style"]})}}class Pt{constructor(e,t=window){this._scriptLoader=e,this._window=t}load(){return this._loadPromise||(this._loadPromise=this._loadScript()),this._loadPromise}_loadScript(){const e="initRecaptcha",t=[`onload=${e}`,"render=explicit"].join("&");return new Promise(((n,i)=>{this._window[e]=()=>n(this._window.grecaptcha),this._scriptLoader.loadScript(`//www.google.com/recaptcha/api.js?${t}`).catch((e=>{this._loadPromise=void 0,i(e)}))}))}}function Et(e){return new It(new Pt(e),new Ct)}class Ot{constructor(e){this._requestSender=e}validate(e,t,{timeout:n}={}){const i=`/api/storefront/checkouts/${e}/spam-protection`,r=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.post(i,{body:{token:t},headers:r,timeout:n}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}}class At{constructor(e,t){this._store=e,this._customerActionCreator=t}signIn(e,t){return this._store.dispatch(this._customerActionCreator.signInCustomer(e,t))}signOut(e){return this._store.dispatch(this._customerActionCreator.signOutCustomer(e))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve(this._store.getState())}initialize(){return Promise.resolve(this._store.getState())}deinitialize(){return Promise.resolve(this._store.getState())}}class kt extends te{constructor(e){super(e||"Not implemented."),this.name="NotImplementedError",this.type="not_implemented"}}function Tt(e){return`${window.location.origin}/checkout.php?action=set_external_checkout&provider=masterpass&gateway=stripe&origin=${e}`}const Nt={es:["es_es","es_mx","es_pe","es_co","es_ar","es_cl"],en:["en_us","en_gb","en_ca","en_es","en_fr","en_ie","en_sg","en_au","en_nz","en_my","en_hk","en_th","en_ae","en_sa","en_qa","en_kw","en_za"],pt:["pt_br"],zu:["zu_za"],ar:["ar_sa","ar_ae","ar_qa","ar_kw"],zh:["zh_sg","zh_hk"],ms:["ms_my"],uk:["uk_ua"],sv:["sv_se"],hr:["hr_hr"],pl:["pl_pl"],nl:["nl_be"],it:["it_it"],de:["de_de"],fr:["fr_fr","fr_ca"]};function Mt(e){const[t,n]=e.replace("-","_").toLowerCase().split("_"),i=`${t}_${n}`,r=Nt[t];return r?r.indexOf(i)>-1?i:r[0]:"en_us"}class xt{constructor(e,t,n,i,r){this._store=e,this._paymentMethodActionCreator=t,this._remoteCheckoutActionCreator=n,this._masterpassScriptLoader=i,this._locale=r}initialize(e){const{masterpass:t,methodId:n}=e;if(!t||!n)throw new $e('Unable to proceed because "options.masterpass" argument is not provided.');return this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(n)).then((e=>{if(this._paymentMethod=e.paymentMethods.getPaymentMethod(n),!this._paymentMethod||!this._paymentMethod.initializationData.checkoutId)throw new ne(K.MissingPaymentMethod);const i=e.cart.getCart();if(!i)throw new ne(K.MissingCart);const{container:r}=t,o={checkoutId:this._paymentMethod.initializationData.checkoutId,allowedCardTypes:this._paymentMethod.initializationData.allowedCardTypes,amount:i.cartAmount.toString(),currency:i.currency.code,cartId:i.id,suppressShippingAddress:!1,callbackUrl:Tt("checkout")},a={useMasterpassSrc:this._paymentMethod.initializationData.isMasterpassSrcEnabled,language:Mt(this._locale),testMode:this._paymentMethod.config.testMode,checkoutId:this._paymentMethod.initializationData.checkoutId};return this._masterpassScriptLoader.load(a).then((e=>{this._signInButton=this._createSignInButton(r),this._signInButton.addEventListener("click",(()=>{e.checkout(o)}))}))})).then((()=>this._store.getState()))}deinitialize(){return this._paymentMethod=void 0,this._signInButton&&this._signInButton.parentNode&&(this._signInButton.parentNode.removeChild(this._signInButton),this._signInButton=void 0),Promise.resolve(this._store.getState())}signIn(){throw new kt('In order to sign in via Masterpass, the shopper must click on "Masterpass" button.')}signOut(e){const t=this._store.getState().payment.getPaymentId();return t?this._store.dispatch(this._remoteCheckoutActionCreator.signOut(t.providerId,e)):Promise.resolve(this._store.getState())}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve(this._store.getState())}_createSignInButton(e){const t=document.querySelector(`#${e}`);if(!this._paymentMethod||!this._paymentMethod.initializationData.checkoutId)throw new ne(K.MissingPaymentMethod);if(!t)throw new $e("Unable to create sign-in button without valid container ID.");const n=document.createElement("input");if(n.type="image",this._paymentMethod.initializationData.isMasterpassSrcEnabled){const e=this._paymentMethod.config.testMode?"sandbox.":"",{checkoutId:t}=this._paymentMethod.initializationData,i=[`locale=${Mt(this._locale)}`,"paymentmethod=master,visa,amex,discover",`checkoutid=${t}`];n.src=[`https://${e}src.mastercard.com/assets/img/btn/src_chk_btn_126x030px.svg`,i.join("&")].join("?")}else n.src="https://static.masterpass.com/dyn/img/btn/global/mp_chk_btn_160x037px.svg";return t.appendChild(n),n}}class Dt{constructor(e,t){this._store=e,this._remoteCheckoutActionCreator=t}signIn(){throw new kt('In order to sign in via Masterpass, the shopper must click on "Masterpass" button.')}signOut(e){const t=this._store.getState().payment.getPaymentId();return t?this._store.dispatch(this._remoteCheckoutActionCreator.signOut(t.providerId,e)):Promise.resolve(this._store.getState())}initialize(){return Promise.resolve(this._store.getState())}deinitialize(){return Promise.resolve(this._store.getState())}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve(this._store.getState())}}function zt(e){if(!/^(https?:)?\/\//.test(e))throw new $e("The provided URL must be absolute.");const t=document.createElement("a");t.href=e;const n=t.port&&-1!==e.indexOf(`${t.hostname}:${t.port}`)?t.port:"";return{hash:t.hash,hostname:t.hostname,href:t.href,origin:`${t.protocol}//${t.hostname}${n?`:${n}`:""}`,pathname:t.pathname,port:n,protocol:t.protocol,search:t.search}}class Ft extends te{constructor(e){super(e||"Unable to proceed due to no extension configured for this region."),this.name="ExtensionNotFoundError",this.type="extension_not_found"}}var Bt,Rt,Lt;function jt(e,t){return e.type===t}!function(e){e.LoadExtensionsRequested="LOAD_EXTENSIONS_REQUESTED",e.LoadExtensionsSucceeded="LOAD_EXTENSIONS_SUCCEEDED",e.LoadExtensionsFailed="LOAD_EXTENSIONS_FAILED",e.RenderExtensionRequested="RENDER_EXTENSION_REQUESTED",e.RenderExtensionSucceeded="RENDER_EXTENSION_SUCCEEDED",e.RenderExtensionFailed="RENDER_EXTENSION_FAILED"}(Bt||(Bt={}));class Ut{constructor(e,t,n){this._targetWindow=t,this._context=n,this._targetOrigin="*"===e?"*":zt(e).origin}post(e,t){const n=this._targetWindow;if(window===n)return;if(!n)throw new Error("Unable to post message because target window is not set.");const i=t&&(0,v.R)(window,"message").pipe((0,I.p)((e=>e.origin===this._targetOrigin&&jt(e.data,e.data.type)&&-1!==[t.successType,t.errorType].indexOf(e.data.type))),(0,P.T)((e=>{if(t.errorType===e.data.type)throw e.data;return e.data})),(0,k.s)(1)).toPromise();return n.postMessage(Object.assign(Object.assign({},e),{context:this._context}),this._targetOrigin),i}setTarget(e){this._targetWindow=e}setContext(e){this._context=e}}function Vt(e){var t;const n=null===(t=document.querySelector(`[data-extension-id="${e.id}"]`))||void 0===t?void 0:t.querySelector("iframe");if(!(null==n?void 0:n.contentWindow))throw new Ft(`Unable to post due to no extension rendered for ID: ${e.id}.`);return new Ut(e.url,n.contentWindow)}!function(e){e.ExtensionReady="EXTENSION:READY",e.ExtensionFailed="EXTENSION:FAILED"}(Rt||(Rt={}));class qt{constructor(e){const t=new Promise(((e,t)=>{this.cancel=t}));this.promise=Promise.race([e,t])}}class Ht extends te{constructor(e){super(e||"Unable to proceed because the required element is unexpectedly detached from the page."),this.name="UnexpectedDetachmentError",this.type="unexpected_detachment"}}class Gt{constructor(e){this._mutationObserver=e}ensurePresence(e,t){return n=this,r=function*(){const n=new qt(t),i=this._mutationObserver.create((t=>{t.forEach((t=>{0!==Array.from(t.removedNodes).filter((t=>e.some((e=>t===e||t.contains(e))))).length&&n.cancel(new Ht)}))}));i.observe(document.body,{childList:!0,subtree:!0});try{const e=yield n.promise;return i.disconnect(),e}catch(e){throw i.disconnect(),e}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}}function $t(e,t){const{iframeResizer:n}=$(785);return n(e,t)}class Wt extends te{constructor(e){super(e||"Unable to load an extension"),this.name="ExtensionNotLoadedError",this.type="extension_not_loaded"}}!function(e){e.Subscribe="EXTENSION_INTERNAL:SUBSCRIBE",e.Unsubscribe="EXTENSION_INTERNAL:UNSUBSCRIBE",e.ResizeIframe="EXTENSION_INTERNAL:RESIZE_IFRAME"}(Lt||(Lt={}));class Yt{constructor(e){this._options=e}createFrame(e,t,n,i){const r=document.getElementById(t),{timeout:o=6e4}=this._options||{};if(!r)throw new Wt("Unable to embed the iframe because the container element could not be found.");const a=document.createElement("iframe");return a.src=e,a.style.border="none",a.style.display="none",a.style.width="100%",r.appendChild(a),this._toResizableFrame(a,o,n,i).catch((e=>{throw r.removeChild(a),e}))}_toResizableFrame(e,t,n,i){return r=this,a=function*(){const r=new Gt(new Ct),o=new Promise(((r,o)=>{const a=window.setTimeout((()=>{try{i()}catch(e){e instanceof Error&&console.error(`Extension rendering timed out after ${t}ms, and the callback function could not be executed. Error: ${e.message}`)}o(new Wt("Unable to load the extension because the content could not be loaded."))}),t),s=t=>{if(t.origin===zt(e.src).origin&&jt(t.data,Lt.ResizeIframe)){e.style.display="";const t=$t({autoResize:!1,scrolling:!1,sizeWidth:!1,heightCalculationMethod:"bodyOffset",initCallback:n},e);d(),r(t[t.length-1])}},d=()=>{window.removeEventListener("message",s),window.clearTimeout(a)};window.addEventListener("message",s)}));return r.ensurePresence([e],o)},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(n,i)}s((a=a.apply(r,[])).next())}));var r,o,a}}class Kt{constructor(e,t,n){this._containerId=e,this._extension=t,this._config=n;const{cartId:i,parentOrigin:r}=this._config;this._url=new URL(this._extension.url),this._url.searchParams.set("extensionId",this._extension.id),this._url.searchParams.set("cartId",i),this._url.searchParams.set("parentOrigin",r)}attach(){var e,t,n,i;return t=this,i=function*(){if(null===(e=document.querySelector(`[data-extension-id="${this._extension.id}"]`))||void 0===e?void 0:e.querySelector("iframe"))return;const t=new Yt,n=e=>{Vt(this._extension).post({type:e})};this._iframe=yield t.createFrame(this._url.toString(),this._containerId,(()=>{n(Rt.ExtensionReady)}),(()=>{n(Rt.ExtensionFailed)}));const i=document.getElementById(this._containerId);null==i||i.setAttribute("data-extension-id",this._extension.id)},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}))}detach(){this._iframe&&this._iframe.parentElement&&this._iframe.parentElement.removeChild(this._iframe)}}class Qt{constructor(e){this._requestSender=e}loadExtensions(e){return()=>l.c.create((t=>{t.next((0,d.VP)(Bt.LoadExtensionsRequested)),this._requestSender.loadExtensions(e).then((e=>{const n=e.body;t.next((0,d.VP)(Bt.LoadExtensionsSucceeded,n)),t.complete()})).catch((e=>{t.error((0,d.fQ)(Bt.LoadExtensionsFailed,e))}))}))}renderExtension(e,t,n){return i=>l.c.create((r=>{return o=this,s=function*(){const o=i.getState(),{id:a}=o.cart.getCartOrThrow(),{links:{checkoutLink:s},checkoutSettings:{features:c}}=o.config.getStoreConfigOrThrow();if(!c["PROJECT-5029.checkout_extension"])return r.complete();const l=o.extensions.getExtensionByRegion(t);try{if(!l)throw new Ft(`Unable to proceed due to no extension configured for the region: ${t}.`);if(r.next((0,d.VP)(Bt.RenderExtensionRequested)),"worker"===l.type){const e=function(e){if(!window.Worker)throw new Error("Unable to load the extension's web worker: your browser does not support Web Workers.");try{const t=URL.createObjectURL(new Blob([`importScripts=((i)=>(...a)=>i(...a.map((u)=>''+new URL(u,"${e}"))))(importScripts);importScripts("${e}")`],{type:"text/javascript"}));return new Worker(t)}catch(e){throw new Error("Unable to load the extension's web worker")}}(l.url);n.add(l.id,e)}else{const t=new Kt(e,l,{cartId:a,parentOrigin:zt(s).origin});yield t.attach()}r.next((0,d.VP)(Bt.RenderExtensionSucceeded)),r.complete()}catch(e){r.error((0,d.fQ)(Bt.RenderExtensionFailed,e))}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{r(s.next(e))}catch(e){t(e)}}function i(e){try{r(s.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,i)}r((s=s.apply(o,[])).next())}));var o,a,s}))}}class Jt{constructor(e){this._requestSender=e}loadExtensions({timeout:e,params:t}={}){return this._requestSender.get("/api/storefront/checkout-extensions",{timeout:e,headers:Object.assign({Accept:ae.JsonV1},se),params:t})}}const Zt=function(e,t,n){return t&&n?Xt(0,t,n):function(e){const t=class extends e{};return Object.getOwnPropertyNames(e.prototype).forEach((n=>{const i=Object.getOwnPropertyDescriptor(e.prototype,n);i&&"constructor"!==n&&Object.defineProperty(t.prototype,n,Xt(e.prototype,n,i))})),t}(e)};function Xt(e,t,n){if("function"!=typeof n.value)return n;let i=n.value;return{get(){const e=i.bind(this);return Object.defineProperty(this,t,Object.assign(Object.assign({},n),{value:e})),e},set(e){i=e}}}var en,tn,nn;class rn{constructor(e){this._worker=e,this._isListening=!1,this._listeners={}}listen(){this._isListening||(this._isListening=!0,this._worker.addEventListener("message",this._handleMessage))}stopListen(){this._isListening&&(this._isListening=!1,this._worker.removeEventListener("message",this._handleMessage))}addListener(e,t){let n=this._listeners[e];n||(this._listeners[e]=n=[]),-1===n.indexOf(t)&&n.push(t)}removeListener(e,t){const n=this._listeners[e];if(!n)return;const i=n.indexOf(t);i>=0&&n.splice(i,1)}trigger(e,t){const n=this._listeners[e.type];n&&n.forEach((n=>t?n(e,t):n(e)))}_handleMessage(e){const t=e.data,{context:n}=t,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["context"]);this.trigger(i,n)}}!function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);o>3&&a&&Object.defineProperty(t,n,a)}([Zt],rn.prototype,"_handleMessage",null);class on{constructor(e,t){this._worker=e,this._context=t}post(e){if(!this._worker)throw new Error("WorkerPoster: Worker is not initialized or creation failed. Cannot post message.");this._worker.postMessage(Object.assign(Object.assign({},e),{context:this._context}))}}class an extends te{constructor(e){super(e||"Unable to proceed due to unsupported extension command."),this.name="UnsupportedExtensionCommandError",this.type="unsupported_extension_command_error"}}class sn extends te{constructor(e){super(e||"Unable to proceed due to unsupported extension query."),this.name="UnsupportedExtensionQueryError",this.type="unsupported_extension_query_error"}}!function(e){e.ReloadCheckout="EXTENSION:RELOAD_CHECKOUT",e.ShowLoadingIndicator="EXTENSION:SHOW_LOADING_INDICATOR",e.SetIframeStyle="EXTENSION:SET_IFRAME_STYLE",e.ReRenderShippingForm="EXTENSION:RE_RENDER_SHIPPING_FORM",e.ReRenderShippingStep="EXTENSION:RE_RENDER_SHIPPING_STEP"}(en||(en={})),function(e){e.GetConsignments="EXTENSION:GET_CONSIGNMENTS"}(tn||(tn={}));class dn{constructor(e={},t={},n={}){this._workers=e,this._commandListeners=t,this._queryListeners=n}add(e,t){this._workers[e]=t}listenForCommand(e,t,n){const i=this._getWorkerById(e);this._commandListeners[e]||(this._commandListeners[e]=new rn(i));const r=this._commandListeners[e];r.listen();const o=this._validateCommand(t),a=(t,i)=>{(null==i?void 0:i.extensionId)===e&&n(t,i)};return r.addListener(o,a),()=>{r.removeListener(o,a)}}listenForQuery(e,t,n){const i=this._getWorkerById(e);this._queryListeners[e]||(this._queryListeners[e]=new rn(i));const r=this._queryListeners[e];r.listen();const o=this._validateQuery(t),a=(t,i)=>{(null==i?void 0:i.extensionId)===e&&n(t,i)};return r.addListener(o,a),()=>{r.removeListener(o,a)}}stopListen(e){this._commandListeners[e]&&this._commandListeners[e].stopListen(),this._queryListeners[e]&&this._queryListeners[e].stopListen()}post(e,t){if(!this._workers[e])throw new Error(`Worker with extensionId ${e} not found`);new on(this._workers[e],e).post(t)}clearCacheById(e){delete this._workers[e]}_getWorkerById(e){const t=this._workers[e];if(!t)throw new Ft(`Worker with extensionId ${e} not found`);return t}_validateCommand(e){if(Object.values(en).includes(e))return e;throw new an}_validateQuery(e){if(Object.values(tn).includes(e))return e;throw new sn}}function cn(e){return zt(0===e.hostname.indexOf("www")?e.href:e.href.replace(e.hostname,`www.${e.hostname}`))}class ln{constructor(e){this._sourceOrigins=[zt(e).origin,cn(zt(e)).origin],this._isListening=!1,this._listeners={}}listen(){this._isListening||(this._isListening=!0,window.addEventListener("message",this._handleMessage))}stopListen(){this._isListening&&(this._isListening=!1,window.removeEventListener("message",this._handleMessage))}addListener(e,t){let n=this._listeners[e];n||(this._listeners[e]=n=[]),-1===n.indexOf(t)&&n.push(t)}removeListener(e,t){const n=this._listeners[e];if(!n)return;const i=n.indexOf(t);i>=0&&n.splice(i,1)}trigger(e,t){const n=this._listeners[e.type];n&&n.forEach((n=>t?n(e,t):n(e)))}_handleMessage(e){if(-1===this._sourceOrigins.indexOf(e.origin)||!jt(e.data,e.data.type))return;const t=e.data,{context:n}=t,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["context"]);this.trigger(i,n)}}!function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);o>3&&a&&Object.defineProperty(t,n,a)}([Zt],ln.prototype,"_handleMessage",null);class un{constructor(e,t,n={},i={},r={}){this._store=e,this._workerExtensionMessenger=t,this._commandListeners=n,this._queryListeners=i,this._posters=r}clearCacheByRegion(e){const t=this._getExtensionByRegion(e);"worker"!==t.type?this.clearCacheById(t.id):this._workerExtensionMessenger.clearCacheById(t.id)}clearCacheById(e){const t=this._getExtensionById(e);"worker"!==t.type?(this._commandListeners[e]&&delete this._commandListeners[e],this._queryListeners[e]&&delete this._queryListeners[e],this._posters[e]&&delete this._posters[e]):this._workerExtensionMessenger.clearCacheById(t.id)}listenForCommand(e,t,n){const i=this._getExtensionById(e);if("worker"===i.type)return this._workerExtensionMessenger.listenForCommand(e,t,n);this._commandListeners[e]||(this._commandListeners[e]=new ln(i.url));const r=this._commandListeners[e];r.listen();const o=this._validateCommand(t),a=(t,i)=>{(null==i?void 0:i.extensionId)===e&&n(t,i)};return r.addListener(o,a),()=>{r.removeListener(o,a)}}listenForQuery(e,t,n){const i=this._getExtensionById(e);if("worker"===i.type)return this._workerExtensionMessenger.listenForQuery(e,t,n);this._queryListeners[e]||(this._queryListeners[e]=new ln(i.url));const r=this._queryListeners[e];r.listen();const o=this._validateQuery(t),a=(t,i)=>{(null==i?void 0:i.extensionId)===e&&n(t,i)};return r.addListener(o,a),()=>{r.removeListener(o,a)}}stopListen(e){"worker"!==this._getExtensionById(e).type?(this._commandListeners[e]&&this._commandListeners[e].stopListen(),this._queryListeners[e]&&this._queryListeners[e].stopListen()):this._workerExtensionMessenger.stopListen(e)}post(e,t){try{const n=this._getExtensionById(e);if("worker"===n.type)return void this._workerExtensionMessenger.post(e,t);this._posters[e]||(this._posters[e]=Vt(n)),this._posters[e].post(t)}catch(n){this.clearCacheById(e),console.log(`Unable to post event to extension(${e}) because extension iframe is not mounted.\nThe event that could not be delivered:`,t)}}_getExtensionById(e){var t;this._getExtensions();const n=null===(t=this._extensions)||void 0===t?void 0:t.find((t=>t.id===e));if(!n)throw new Ft(`Unable to proceed due to no extension found for ID: ${e}.`);return n}_getExtensionByRegion(e){var t;this._getExtensions();const n=null===(t=this._extensions)||void 0===t?void 0:t.find((t=>t.region===e));if(!n)throw new Ft(`Unable to proceed due to no extension found for region: ${e}.`);return n}_getExtensions(){if(this._extensions)return;const{extensions:{getExtensions:e}}=this._store.getState();if(this._extensions=e(),!this._extensions)throw new Ft("Extension configurations not found.")}_validateCommand(e){if(Object.values(en).includes(e))return e;throw new an}_validateQuery(e){if(Object.values(tn).includes(e))return e;throw new sn}}class hn{constructor(e,t,n){this._store=e,this._extensionMessenger=t,this._subscribers=n,this._subscribed={},this._unsubscribers={},this._listeners={}}listen(){var e;const{data:{getExtensions:t}}=this._store.getState();null===(e=t())||void 0===e||e.forEach((e=>{if(this._listeners[e.id])return;const t=new ln(e.url);t.addListener(Lt.Subscribe,this._handleSubscribe.bind(this)),t.addListener(Lt.Unsubscribe,this._handleUnsubscribe.bind(this)),t.listen(),this._listeners[e.id]=t}))}broadcast(e){var t;const{data:{getExtensions:n}}=this._store.getState();null===(t=n())||void 0===t||t.forEach((t=>{this._subscribed[t.id]&&this._extensionMessenger.post(t.id,e)}))}_handleSubscribe({payload:{eventType:e,extensionId:t}}){this._subscribed[t]=!0,this._unsubscribers[e]||(this._unsubscribers[e]=this._subscribers[e](this._store,this))}_handleUnsubscribe({payload:{eventType:e,extensionId:t}}){var n,i;delete this._subscribed[t],Object.keys(this._subscribed).length||(null===(i=(n=this._unsubscribers)[e])||void 0===i||i.call(n),delete this._unsubscribers[e])}}!function(e){e.ConsignmentsChanged="EXTENSION:CONSIGNMENTS_CHANGED"}(nn||(nn={}));const mn=(e,t)=>{var n;const{data:{getConsignments:i}}=e.getState();let r=null!==(n=i())&&void 0!==n?n:[];return e.subscribe((({data:{getConsignments:e}})=>{var n;const i=null!==(n=e())&&void 0!==n?n:[];i!==r&&(t.broadcast({type:nn.ConsignmentsChanged,payload:{consignments:i,previousConsignments:r}}),r=i)}),(({data:{getConsignments:e}})=>e()))};class pn extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}var yn,gn;!function(e){e[e.MissingBillingAddress=0]="MissingBillingAddress",e[e.MissingCart=1]="MissingCart",e[e.MissingCheckout=2]="MissingCheckout",e[e.MissingConsignments=3]="MissingConsignments",e[e.MissingCustomer=4]="MissingCustomer",e[e.MissingCheckoutConfig=5]="MissingCheckoutConfig",e[e.MissingOrder=6]="MissingOrder",e[e.MissingOrderConfig=7]="MissingOrderConfig",e[e.MissingOrderId=8]="MissingOrderId",e[e.MissingPayment=9]="MissingPayment",e[e.MissingPaymentId=10]="MissingPaymentId",e[e.MissingPaymentInstrument=11]="MissingPaymentInstrument",e[e.MissingPaymentMethod=12]="MissingPaymentMethod",e[e.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",e[e.MissingPaymentStatus=14]="MissingPaymentStatus",e[e.MissingPaymentToken=15]="MissingPaymentToken",e[e.MissingShippingAddress=16]="MissingShippingAddress"}(yn||(yn={}));class vn extends pn{constructor(e){super(function(e){switch(e){case yn.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case yn.MissingCart:return"Unable to proceed because cart data is unavailable.";case yn.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case yn.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case yn.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case yn.MissingCheckoutConfig:case yn.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case yn.MissingOrder:return"Unable to proceed because order data is unavailable.";case yn.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case yn.MissingPayment:return"Unable to proceed because payment data is unavailable.";case yn.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case yn.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case yn.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}function fn(e){return t=e.lineItems.physicalItems.filter((e=>!e.addedByPromotion)),(0,c.reduce)(t,((e,t)=>e+t.quantity),0);var t}function bn(e,t){if(null==e)throw t?t():new Error("An unexpected error has occurred.");return e}!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(gn||(gn={}));class Sn extends pn{constructor(e){super(function(e){switch(e){case gn.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case gn.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case gn.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case gn.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}const Cn={de:"eu",jp:"fe",uk:"eu",us:"na"};var wn,_n,In,Pn,En,On;!function(e){e.en_US="en_US",e.en_GB="en_GB",e.de_DE="de_DE",e.fr_FR="fr_FR",e.it_IT="it_IT",e.es_ES="es_ES",e.ja_JP="ja_JP"}(wn||(wn={})),function(e){e.Home="Home",e.Product="Product",e.Cart="Cart",e.Checkout="Checkout",e.Other="Other"}(_n||(_n={})),function(e){e.USD="USD",e.EUR="EUR",e.GBP="GBP",e.JPY="JPY"}(In||(In={})),function(e){e.PayAndShip="PayAndShip",e.PayOnly="PayOnly"}(Pn||(Pn={})),function(e){e.Gold="Gold",e.LightGray="LightGray",e.DarkGray="DarkGray"}(En||(En={})),function(e){e.C0001="C0001"}(On||(On={}));var An=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class kn{constructor(e){this.amazonPayV2ScriptLoader=e}initialize(e){return An(this,void 0,void 0,(function*(){this.amazonPayV2SDK=yield this.amazonPayV2ScriptLoader.load(e),this.buttonParentContainer=this.buttonParentContainer||this.createAmazonPayButtonParentContainer()}))}deinitialize(){var e;return this.amazonPayV2Button=void 0,null===(e=this.buttonParentContainer)||void 0===e||e.remove(),this.buttonParentContainer=void 0,this.amazonPayV2SDK=void 0,Promise.resolve()}bindButton(e,t,n){this.getAmazonPayV2SDK().Pay.bindChangeAction(`#${e}`,{amazonCheckoutSessionId:t,changeAction:n})}createButton(e,t){this.amazonPayV2Button=this.getAmazonPayV2SDK().Pay.renderButton(`#${e}`,t)}prepareCheckout(e){const t=this.prepareRequestConfig(e);this.getAmazonPayV2Button().onClick((()=>{this.getAmazonPayV2Button().initCheckout(t)}))}prepareCheckoutWithCreationRequestConfig(e){this.getAmazonPayV2Button().onClick((()=>An(this,void 0,void 0,(function*(){const t=yield e();if(t){const e=this.prepareRequestConfig(t.createCheckoutSessionConfig,t.estimatedOrderAmount,t.productType);this.getAmazonPayV2Button().initCheckout(e)}}))))}signout(){return An(this,void 0,void 0,(function*(){return this.amazonPayV2SDK&&this.amazonPayV2SDK.Pay.signout(),Promise.resolve()}))}renderAmazonPayButton({buttonColor:e,checkoutState:t,containerId:n,decoupleCheckoutInitiation:i=!1,methodId:r,options:o,placement:a,isButtonMicroTextDisabled:s=!1}){const d=document.querySelector(`#${n}`);if(!d)return;const{id:c}=d.appendChild(this.getButtonParentContainer());o&&s&&(o.design=On.C0001);const l=null!=o?o:this.getAmazonPayV2ButtonOptions(t,r,a,i,e);return this.createButton(c,l),this.getButtonParentContainer()}updateBuyNowFlowFlag(e){this.isBuyNowFlow=Boolean(e)}isPh4Enabled(e,t){const n=!!e["PROJECT-3483.amazon_pay_ph4"],i=!!e["INT-6885.amazon_pay_ph4_us_only"];return n&&i?"US"===t:n}prepareRequestConfig(e,t,n){const{publicKeyId:i}=e,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["publicKeyId"]);return Object.assign(Object.assign({createCheckoutSessionConfig:this.isEnvironmentSpecific(i)?r:e},t&&{estimatedOrderAmount:t}),n&&{productType:n})}createAmazonPayButtonParentContainer(){const e=Math.random().toString(16).substr(-4),t=document.createElement("div");return t.id=`amazonpay_button_parent_container_${e}`,t}getAmazonPayV2ButtonOptions(e,t,n,i=!1,r=En.Gold){var o;const{getCart:a,getCheckout:s,getStoreConfigOrThrow:d,getPaymentMethodOrThrow:c}=this.getCheckoutState(e),{config:{merchantId:l,testMode:u},initializationData:h}=c(t);if(!h)throw new vn(yn.MissingPaymentMethod);const{checkoutLanguage:m,checkoutSessionMethod:p,createCheckoutSessionConfig:y,extractAmazonCheckoutSessionId:g,ledgerCurrency:v,publicKeyId:f="",isButtonMicroTextDisabled:b}=h;if(!l||!v)throw new vn(yn.MissingPaymentMethod);const S=Object.assign({merchantId:l,ledgerCurrency:v,checkoutLanguage:m,placement:n,buttonColor:r},b?{design:On.C0001}:{});if(this.isBuyNowFlow)return Object.assign(Object.assign({},S),{sandbox:!!u});const C=a();S.productType=C&&0===fn(C)?Pn.PayOnly:Pn.PayAndShip;const{checkoutSettings:{features:w},storeProfile:{shopPath:_,storeCountryCode:I}}=d();if(this.isPh4Enabled(w,I)){if(!y)throw new vn(yn.MissingPaymentMethod);const e=null===(o=s())||void 0===o?void 0:o.outstandingBalance.toString(),t=null==C?void 0:C.currency.code,n=Object.assign({},S);let r;return this.isEnvironmentSpecific(f)?(n.publicKeyId=f,r=y):(n.sandbox=!!u,r=Object.assign(Object.assign({},y),{publicKeyId:f})),i||(n.createCheckoutSessionConfig=r),e&&t&&(n.estimatedOrderAmount={amount:e,currencyCode:t}),n}const P={method:p,url:`${_}/remote-checkout/${t}/payment-session`,extractAmazonCheckoutSessionId:g};return Object.assign(Object.assign({},S),{createCheckoutSession:P,sandbox:!!u})}isEnvironmentSpecific(e){return/^(SANDBOX|LIVE)/.test(e)}getAmazonPayV2SDK(){return this.getOrThrow(this.amazonPayV2SDK)}getButtonParentContainer(){return this.getOrThrow(this.buttonParentContainer)}getAmazonPayV2Button(){return this.getOrThrow(this.amazonPayV2Button)}getOrThrow(e){return bn(e,(()=>new Sn(gn.PaymentNotInitialized)))}getCheckoutState(e){return"object"==typeof(t=e)&&null!==t&&"cart"in t&&"checkout"in t&&"config"in t&&"paymentMethods"in t?{getCart:e.cart.getCart,getCheckout:e.checkout.getCheckout,getStoreConfigOrThrow:e.config.getStoreConfigOrThrow,getPaymentMethodOrThrow:t=>e.paymentMethods.getPaymentMethodOrThrow(t)}:e;var t}}class Tn extends pn{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}class Nn{constructor(e,t=window){this.scriptLoader=e,this.windowWithAmazonPay=t}load(e){return t=this,i=function*(){const{initializationData:t}=e,n=(null==t?void 0:t.region)||"us",i=Cn[n];if(yield this.scriptLoader.loadScript(`https://static-${i}.payments-amazon.com/checkout.js`),!this.windowWithAmazonPay.amazon)throw new Tn;return this.windowWithAmazonPay.amazon},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}}function Mn(){return new kn(new Nn((0,s.vQ)()))}class xn extends pn{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class Dn extends pn{constructor(e){super(e||"Not implemented."),this.name="NotImplementedError",this.type="not_implemented"}}var zn=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Fn{constructor(e,t){this.paymentIntegrationService=e,this.amazonPayV2PaymentProcessor=t}initialize(e){return zn(this,void 0,void 0,(function*(){const{methodId:t,amazonpay:n}=e;if(!t||!(null==n?void 0:n.container))throw new xn('Unable to proceed because "methodId" or "containerId" argument is not provided.');let i;try{i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t)}catch(e){yield this.paymentIntegrationService.loadPaymentMethod(t),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t)}yield this.amazonPayV2PaymentProcessor.initialize(i),this.amazonPayV2PaymentProcessor.renderAmazonPayButton({checkoutState:this.paymentIntegrationService.getState(),containerId:n.container,methodId:t,placement:_n.Checkout})}))}deinitialize(){return zn(this,void 0,void 0,(function*(){yield this.amazonPayV2PaymentProcessor.deinitialize()}))}signIn(){throw new Dn('In order to sign in via Amazon, the shopper must click on "Amazon Pay" button.')}signOut(e){return zn(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getPaymentId();t&&(yield this.amazonPayV2PaymentProcessor.signout(),yield this.paymentIntegrationService.remoteCheckoutSignOut(t.providerId,e))}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}}const Bn=Ge((e=>new Fn(e,Mn())),[{id:"amazonpay"}]),Rn="3.128.0",Ln="3.123.2",jn="3.106.0";class Un{constructor(e){this.paymentIntegrationService=e,this.braintreeWindow=window}getSDKVersion(){const e=this.paymentIntegrationService.getState().getStoreConfig(),t=(null==e?void 0:e.checkoutSettings.features)||{};return this.getPreloadedSDKVersion()||(Ze(t,"PAYPAL-5809.braintree_hosted_fields_fix_version")?Rn:Ze(t,"PAYPAL-5636.update_braintree_sdk_version")?Ln:jn)}getPreloadedSDKVersion(){const e=this.braintreeWindow.braintree;if(e){const t=(0,c.find)(Object.values(e),(e=>!!e.VERSION));return null==t?void 0:t.VERSION}}}class Vn extends pn{constructor(e){super(e||"Unsupported browser error"),this.name="UnsupportedBrowserError",this.type="unsupported_browser"}}var qn,Hn,Gn,$n,Wn,Yn,Kn;function Qn(e){return Boolean("object"==typeof e&&null!==e&&("type"in e||"message"in e||"code"in e))}!function(e){e.ESTIMATED="ESTIMATED",e.FINAL="FINAL",e.NOT_CURRENTLY_KNOWN="NOT_CURRENTLY_KNOWN"}(qn||(qn={})),function(e){e.Completed="COMPLETED",e.Pending="PENDING",e.Failed="FAILED"}(Hn||(Hn={})),function(e){e.TRUSTLY="trustly"}(Gn||(Gn={})),function(e){e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="cancelled",e.UNRECOGNIZED="unrecognized"}($n||($n={})),function(e){e.Customer="CUSTOMER",e.Merchant="MERCHANT",e.Network="NETWORK",e.Internal="INTERNAL",e.Unknown="UNKNOWN"}(Wn||(Wn={})),function(e){e.KountNotEnabled="DATA_COLLECTOR_KOUNT_NOT_ENABLED"}(Yn||(Yn={})),function(e){e.Visa="visa",e.Mastercard="mastercard",e.AmericanExpress="american-express",e.DinersClub="diners-club",e.Discover="discover",e.Jcb="jcb",e.UnionPay="union-pay",e.Maestro="maestro",e.Elo="elo",e.Mir="mir",e.Hiper="hiper",e.Hipercard="hipercard"}(Kn||(Kn={}));var Jn,Zn,Xn,ei=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ti{constructor(e){this.braintreeScriptLoader=e}initialize(e){this.setClientToken(e)}deinitialize(){return ei(this,void 0,void 0,(function*(){yield this.teardownModule(this.dataCollector),this.dataCollector=void 0}))}getClient(){return ei(this,void 0,void 0,(function*(){if(!this.client){const e=this.getClientTokenOrThrow(),t=yield this.braintreeScriptLoader.loadClient();this.client=yield t.create({authorization:e})}return this.client}))}getDataCollectorOrThrow(e){return ei(this,void 0,void 0,(function*(){const t={deviceData:void 0,teardown:()=>Promise.resolve()};if(!this.dataCollector)try{const t=yield this.getClient(),n=yield this.braintreeScriptLoader.loadDataCollector(),i=Object.assign({client:t,kount:!0},e);this.dataCollector=yield n.create(i)}catch(e){if(Qn(e)&&e.code===Yn.KountNotEnabled)return t;throw e}return this.dataCollector}))}getBraintreeGooglePayment(){return ei(this,void 0,void 0,(function*(){if(!this.googlePayment){const[e,t]=yield Promise.all([this.getClient(),this.braintreeScriptLoader.loadGooglePayment()]);this.googlePayment=yield t.create({client:e})}return this.googlePayment}))}getBraintreeThreeDS(){return ei(this,void 0,void 0,(function*(){if(!this.threeDS){const[e,t]=yield Promise.all([this.getClient(),this.braintreeScriptLoader.load3DS()]);this.threeDS=yield t.create({client:e,version:2})}return this.threeDS}))}getBraintreeLocalPayment(e){return ei(this,void 0,void 0,(function*(){if(!this.braintreeLocalPayment){const[t,n]=yield Promise.all([this.getClient(),this.braintreeScriptLoader.loadLocalPayment()]);this.braintreeLocalPayment=yield new Promise(((i,r)=>{n.create({client:t,merchantAccountId:e},((e,t)=>{e&&r(e),i(t)}))}))}return this.braintreeLocalPayment}))}getUsBankAccount(){return ei(this,void 0,void 0,(function*(){if(!this.usBankAccount){const e=yield this.getClient(),t=yield this.braintreeScriptLoader.loadUsBankAccount();this.usBankAccount=yield t.create({client:e})}return this.usBankAccount}))}getBraintreeVisaCheckout(){return this.visaCheckout||(this.visaCheckout=Promise.all([this.getClient(),this.braintreeScriptLoader.loadVisaCheckout()]).then((([e,t])=>t.create({client:e})))),this.visaCheckout}getVisaCheckoutSdk(e){return ei(this,void 0,void 0,(function*(){return this.visaCheckoutSDK||(this.visaCheckoutSDK=yield this.braintreeScriptLoader.loadVisaCheckoutSdk(e)),this.visaCheckoutSDK}))}getVenmoCheckoutOrThrow(){return ei(this,void 0,void 0,(function*(){if(!this.braintreeVenmo){const e=yield this.getClient(),t=yield this.braintreeScriptLoader.loadVenmoCheckout(),n={client:e,allowDesktop:!0,paymentMethodUsage:"multi_use"},i=yield t.create(n);if(!i.isBrowserSupported())throw new Vn;this.braintreeVenmo=i}return this.braintreeVenmo}))}setClientToken(e){this.clientToken=e}getClientTokenOrThrow(){if(!this.clientToken)throw new Sn(gn.PaymentNotInitialized);return this.clientToken}teardownModule(e){return e?e.teardown():Promise.resolve()}}!function(e){e.Sandbox="sandbox",e.Production="production"}(Jn||(Jn={})),function(e){e.Client="client",e.DataCollector="dataCollector",e.Fastlane="fastlane",e.GooglePayment="googlePayment",e.HostedFields="hostedFields",e.LocalPayment="localPayment",e.Paypal="paypal",e.PaypalCheckout="paypalCheckout",e.ThreeDSecure="threeDSecure",e.UsBankAccount="usBankAccount",e.Venmo="venmo",e.VisaCheckout="visaCheckout"}(Zn||(Zn={})),function(e){e.CardCode="cardCode",e.CardCodeVerification="cardCodeVerification",e.CardExpiry="cardExpiry",e.CardName="cardName",e.CardNumber="cardNumber",e.CardNumberVerification="cardNumberVerification"}(Xn||(Xn={}));const ni={[jn]:{[Zn.Client]:"sha384-26BXDNnJI23JYRyFBj4xe4sVNrUSSiSSu11kxVXNM/vEPONm4LuL00w6ZaTgQewt",[Zn.PaypalCheckout]:"sha384-B+vzbZwnQtzWBthpkT4TXKUibO65tyeK7eCxSvpblgprTep2+IAXB2Cxxjrn710O",[Zn.Paypal]:"sha384-uyAGL1/3+XJAHnGoNy4eCoXdzJ4f7Ilzp+6w9PNnEjs6DCCz9WMyJjMN1gzc78U+",[Zn.LocalPayment]:"sha384-LIvOEMkIVEwVuYBdVOQc1AC5YbGGlwyfUheS0ACK218D2STuVYQlZ4FyEPowAEfT",[Zn.DataCollector]:"sha384-1bo9JDz+Kscthc085cCKWur8CLwUoBpoNyxsDi7932mCl0zFq3A5mv+FQLw9GHpV",[Zn.UsBankAccount]:"sha384-xmHBVaU+w74V+OebD3AaPONFxHUGMf+QRs8G/JxVPXNNP7MDa2jL0ICWHIe2tTfJ",[Zn.GooglePayment]:"sha384-WKDJl8mqoP82qZpMGH6AbZxnvXnSW8ILV4M64CyMLiugGMwu7LyP89wjCkHqsiBe",[Zn.ThreeDSecure]:"sha384-VQUlpGHzsGvs5XeiGFip7EXRsvoHWEXDVmgCacfbyieZI9mdBOqq3NSoyo28OCOB",[Zn.VisaCheckout]:"sha384-yx7mADfzTN0T43Q6rlH49LIg1EJ0iUZgBp/EczX9LXsUGkySgxrD+nWHQRBkyfoT",[Zn.Venmo]:"sha384-QX4rPjoj1ZDhuG0aSyKs56lEKDqTMTcjYxUHY1SzO5VZDsqIE2NTkqot7KNSCyov",[Zn.HostedFields]:"sha384-VvYBACfSu0Cr/J32uKmxG7AXcNOJE1AzIIL3kbikyS7YKp5fz5Is+NzNP/lyauNy",[Zn.Fastlane]:"sha384-9oGsZMRZwpGtDEDYa/dFt76dECqj1xAni9gIKgc3KfMIiRnR73nEeeUDLiBzxhFa"},[Ln]:{[Zn.Client]:"sha384-o+nbQGcwNNxIBeXeu3+XmbSq+Cg8R3EN3N0l5hXCgMMU2RGY0t1z0LroSEIAbfAO",[Zn.PaypalCheckout]:"sha384-WrfbWPBS4mH86GAoycPSgiH8hQ8KH7A67C93Hjhunv/xhNk2YpBn3wbFA4Fhg9U/",[Zn.Paypal]:"sha384-VF389nvvrRUgDsTXMxTYORDtVegB9IQa3Cxr//DyJnLYnz8/X8VCzEvck2c+Megt",[Zn.LocalPayment]:"sha384-tZKx2rEQbfmZpoPSY5VPmJEhaq4X75dLvwHMs3VE9U+C8lPyw+hWTIL1+GPvWCIH",[Zn.DataCollector]:"sha384-E6k3wOpP7syCDDwaRDLF06942Y00NkbwJvWi2OQXwwKzGwG5fd3E7RFUvCCecfvO",[Zn.UsBankAccount]:"sha384-258FON8LZGG0W9Qaz4Jij83pZHu30YnKjJA7gNulLBh6CclkucgF+tHDQuYFRYfW",[Zn.GooglePayment]:"sha384-taJ2p/0+n0VH328POAoBiuEbL3tnHUTE9S42hK1V+Txs3X+QYjZOyKW35JgHRFfO",[Zn.ThreeDSecure]:"sha384-+NSZH4Zj3sO5bdWvPKhU5N16QDxeueTVTnUVeleeESkhLSaz4Ob1hh/5myecc9Ym",[Zn.VisaCheckout]:"sha384-66DiBjghxk1OmBj8aksN8gbQ+CwoQcx1vPfiXUN08g1iQVM+BwewF0p7toM3i7SS",[Zn.Venmo]:"sha384-B5UwY42kE4RoLoWbQ7YpqosUlUad2/DlGWiw0HhoZbSPk30CQAaSA10ohyLDTkDU",[Zn.HostedFields]:"sha384-Aw9EesSaUeWxe36PqEHiOyOyOq8M6CIb1gw7/yHNVPRzGtFXXcd2OQ8qXrIlOj2P",[Zn.Fastlane]:"sha384-rhBL1hpZ71JqG+2TsT0Dih47mbjx8cjJCpeZjk9tw3df1gFMKfCTmMyZunhr7H4Y"},[Rn]:{[Zn.Client]:"sha384-0WNxksIpRP+fYZiIdr12g6DBUQfLDzYCQJZtR/C8KkcwSGhPHfcFp3tTaGcMyFTq",[Zn.PaypalCheckout]:"sha384-lWM1jk4BOxoDNV6Kop7tVNvQgINlmEVz0c/OwM+HNHK3QC8xqwd54Ovrt2QRDTjh",[Zn.Paypal]:"sha384-fXUmVxC2EMZBDXZ7eTHSTL/LFBrHej/MSXT/vTBXvra4lzgLNGvREAp+x0GYObuH",[Zn.LocalPayment]:"sha384-pha1xGuGSkmZH5x9aqHvRaO4xLea7rmQ/79PFj9zxNzxuFcOWZg7gOP7FibygOEC",[Zn.DataCollector]:"sha384-Q6PI2F9eekWbAxhroybl+aEcvqhdowN/EQlGwBUyJOzPFn9982u9xl6SU6XfGKzc",[Zn.UsBankAccount]:"sha384-W3RLQSKJL1tQ3+Y7mP6tmkamtZ8bV4Yw/XxL9Jj5JtXHraD8loMF8hAIG5m2zK7F",[Zn.GooglePayment]:"sha384-TITQMsFWA3elDNGP2mWz2oKBo4qjt+TlqzovcaPoeBiAh/wPBi6nae50ADdgU1/i",[Zn.ThreeDSecure]:"sha384-YiycYN89ZlL/Evcaq4y1ajW1mhd7JYfZBDuOwHtIn4/Jnm20GL+/XCM+zYAwWD8D",[Zn.VisaCheckout]:"sha384-/OdaTv9qrkKzjObtUe6yzfDhHozFW/+uXlrSl736sOZRJpjGQETvpYXqMFFg69xv",[Zn.Venmo]:"sha384-dA+ojdW9vbJS4JavcXyOs9d5uZHJg5dNtYupoPSH2zsXIiYDVS5amLb/u8qmQ6oz",[Zn.HostedFields]:"sha384-31ZkS58+iaWsW06ftW52zzVZFp43WPd7pNYRiddYynSNg6Oh7WGbSFGorAUH6T1z",[Zn.Fastlane]:"sha384-jlbrwNvL3HvLAUCtLSmrnQ2GH1udCUrRS/bVmReAS5fuIVvcW8Pko/Gkg82tlgtr"}};var ii,ri=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class oi{constructor(e,t,n){this.scriptLoader=e,this.braintreeHostWindow=t,this.braintreeSDKVersionManager=n}loadClient(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.Client,"client.min.js")}))}loadFastlane(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.Fastlane,"fastlane.min.js")}))}loadPaypalCheckout(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.PaypalCheckout,"paypal-checkout.min.js")}))}loadPaypal(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.Paypal,"paypal.min.js")}))}loadLocalPayment(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.LocalPayment,"local-payment.min.js")}))}loadDataCollector(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.DataCollector,"data-collector.min.js")}))}loadUsBankAccount(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.UsBankAccount,"us-bank-account.min.js")}))}loadGooglePayment(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.GooglePayment,"google-payment.min.js")}))}load3DS(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.ThreeDSecure,"three-d-secure.min.js")}))}loadVisaCheckout(){return this.loadBraintreeModuleOrThrow(Zn.VisaCheckout,"visa-checkout.min.js")}loadVenmoCheckout(){return this.loadBraintreeModuleOrThrow(Zn.Venmo,"venmo.min.js")}loadHostedFields(){return ri(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(Zn.HostedFields,"hosted-fields.min.js")}))}loadVisaCheckoutSdk(e){return ri(this,void 0,void 0,(function*(){if(this.braintreeHostWindow.V)return this.braintreeHostWindow.V;const t=e?"sha384-0eu1s1GtqzXlL9DtLgmwzC5WWlEH/ADRM0n38cVQkvtT+W/gey96rcb1LwuUOPDm":"sha384-1f1csvP3ZFxg4dILH1GaY4LHlZ0oX7Rk83rxmLlwbnIi4TM0NYzXoev1VoEiVDS6";return this.scriptLoader.loadScript(`//${e?"sandbox-":""}assets.secure.checkout.visa.com/checkout-widget/resources/js/integration/v1/sdk.js`,{async:!0,attributes:{integrity:t,crossorigin:"anonymous"}}).then((()=>{if(!this.braintreeHostWindow.V)throw new Tn;return this.braintreeHostWindow.V}))}))}loadBraintreeModuleOrThrow(e,t){return ri(this,void 0,void 0,(function*(){let n=this.getBraintreeModule(e);if(n)return n;const i=this.braintreeSDKVersionManager.getSDKVersion(),r=`//js.braintreegateway.com/web/${i}/js/${t}`,o=i in ni?this.getIntegrityValuesByModuleName(e,i):void 0;if(yield this.scriptLoader.loadScript(r,o?{async:!0,attributes:{integrity:o,crossorigin:"anonymous"}}:void 0),n=this.getBraintreeModule(e),!n)throw new Tn;return n}))}getBraintreeModule(e){var t;return null===(t=this.braintreeHostWindow.braintree)||void 0===t?void 0:t[e]}getIntegrityValuesByModuleName(e,t){const n=ni[t][e];if(!n)throw new Error("Unexpected fileName value");return n}}class ai extends pn{constructor(e){super(e||"Payment process was cancelled."),this.name="PaymentMethodCancelledError",this.type="payment_cancelled"}}!function(e){e.BRAINTREE="braintree",e.BRAINTREE_FASTLANE="braintreeacceleratedcheckout"}(ii||(ii={}));var si,di=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};!function(e){e.Subtotal="Subtotal",e.Shipping="Shipping"}(si||(si={}));class ci{constructor(e,t,n,i,r){this._requestSender=e,this._paymentIntegrationService=t,this._sessionFactory=n,this._braintreeSdk=i,this._applePayScriptLoader=r,this._onAuthorizeCallback=c.noop,this._onError=c.noop,this._onClick=c.noop,this._subTotalLabel=si.Subtotal,this._shippingLabel=si.Shipping,this._hasApplePaySession=!1}initialize(e){var t;return di(this,void 0,void 0,(function*(){const{methodId:n,applepay:i}=e;if(!n||!i)throw new vn(yn.MissingPaymentMethod);const{container:r,shippingLabel:o,subtotalLabel:a,onError:s=c.noop,onClick:d=c.noop,onPaymentAuthorize:l}=i;this._shippingLabel=o||si.Shipping,this._subTotalLabel=a||si.Subtotal,this._onAuthorizeCallback=l,this._onError=s,this._onClick=d;let u=this._paymentIntegrationService.getState();yield this._applePayScriptLoader.loadSdk();try{this._paymentMethod=u.getPaymentMethodOrThrow(n)}catch(e){u=yield this._paymentIntegrationService.loadPaymentMethod(n),this._paymentMethod=u.getPaymentMethodOrThrow(n)}yield this._paymentIntegrationService.verifyCheckoutSpamProtection(),this._applePayButton=this._createButton(r),this._applePayButton.addEventListener("click",this._handleWalletButtonClick.bind(this)),(null===(t=this._paymentMethod.initializationData)||void 0===t?void 0:t.gateway)===ii.BRAINTREE&&(yield this._initializeBraintreeSdk())}))}deinitialize(){return Promise.resolve()}signIn(){throw new Dn('In order to sign in via Apple, the shopper must click on "Apple Pay" button.')}signOut(){throw new Dn("Need to do signout via apple.")}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}_createButton(e){const t=document.getElementById(e);if(!t)throw new xn("Unable to create sign-in button without valid container ID.");const n=this._createApplePayButtonElement();return t.appendChild(n),n}_createApplePayButtonElement(){const e=document.createElement("apple-pay-button");return e.setAttribute("buttonstyle","black"),e.setAttribute("type","plain"),e.setAttribute("style","--apple-pay-button-width: 100%; --apple-pay-button-height: 36px; --apple-pay-button-border-radius: 4px;"),e}_handleWalletButtonClick(e){if(e.preventDefault(),this._hasApplePaySession)return;this._onClick();const t=this._paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getStoreConfigOrThrow(),r=t.getCheckoutOrThrow();if(!this._paymentMethod||!this._paymentMethod.initializationData)throw new vn(yn.MissingPaymentMethod);const o=this._getBaseRequest(n,r,i,this._paymentMethod),a=this._sessionFactory.create(o);this._handleApplePayEvents(a,this._paymentMethod,i),a.begin(),this._hasApplePaySession=!0}_getBaseRequest(e,t,n,i){var r;const{storeProfile:{storeCountryCode:o,storeName:a}}=n,{currency:{code:s,decimalPlaces:d}}=e,{initializationData:{merchantCapabilities:c,supportedNetworks:l}}=i,u=e.lineItems.physicalItems.length>0,h={requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:["email","phone"],countryCode:o,currencyCode:s,merchantCapabilities:c,supportedNetworks:l,lineItems:[],total:u?{label:a,amount:`${t.grandTotal.toFixed(d)}`,type:"pending"}:{label:a,amount:`${t.grandTotal.toFixed(d)}`,type:"final"}};if(u)null===(r=h.requiredShippingContactFields)||void 0===r||r.push("postalAddress");else{const e=[{label:this._subTotalLabel,amount:`${t.subtotal.toFixed(d)}`}];t.taxes.forEach((t=>e.push({label:t.name,amount:`${t.amount.toFixed(d)}`}))),h.lineItems=e}return h}_handleApplePayEvents(e,t,n){e.onvalidatemerchant=n=>di(this,void 0,void 0,(function*(){try{const{body:i}=yield this._onValidateMerchant(t,n);e.completeMerchantValidation(i)}catch(e){this._onError(e)}})),e.onshippingcontactselected=t=>di(this,void 0,void 0,(function*(){return this._handleShippingContactSelected(e,n,t)})),e.onshippingmethodselected=t=>di(this,void 0,void 0,(function*(){return this._handleShippingMethodSelected(e,n,t)})),e.oncancel=()=>di(this,void 0,void 0,(function*(){this._hasApplePaySession=!1;try{const e=`/remote-checkout/${t.id}/signout`;return yield this._requestSender.get(e),yield this._paymentIntegrationService.loadCheckout()}catch(e){return this._onError(new ai)}})),e.onpaymentauthorized=n=>di(this,void 0,void 0,(function*(){return this._onPaymentAuthorized(n,e,t)}))}_handleShippingContactSelected(e,t,n){var i;return di(this,void 0,void 0,(function*(){const r=this._transformContactToAddress(n.shippingContact);try{yield this._paymentIntegrationService.updateShippingAddress(r)}catch(t){return e.abort(),this._hasApplePaySession=!1,this._onError(t)}const{storeProfile:{storeName:o}}=t;let a=this._paymentIntegrationService.getState();const{currency:{decimalPlaces:s}}=a.getCartOrThrow();let d=a.getCheckoutOrThrow();const c=null===(i=d.consignments[0].selectedShippingOption)||void 0===i?void 0:i.id,l=d.consignments[0].availableShippingOptions,u=null==l?void 0:l.find((({id:e})=>e===c)),h=null==l?void 0:l.filter((e=>e.id!==c)),m=u?[{label:u.description,amount:`${u.cost.toFixed(s)}`,detail:u.additionalDescription,identifier:u.id}]:[];if(h&&[...h.filter((e=>e.isRecommended)),...h.filter((e=>!e.isRecommended))].forEach((e=>m.push({label:e.description,amount:`${e.cost.toFixed(s)}`,detail:e.additionalDescription,identifier:e.id}))),!(l instanceof Array))throw new Error("Shipping options not available.");if(0===l.length)return void e.completeShippingContactSelection(ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS,[],{type:"pending",label:o,amount:`${d.grandTotal.toFixed(s)}`},[]);const p=l.find((e=>e.isRecommended)),y=p?p.id:l[0].id,g=u?u.id:y;try{yield this._updateShippingOption(g)}catch(e){return this._onError(e)}a=this._paymentIntegrationService.getState(),d=a.getCheckoutOrThrow(),e.completeShippingContactSelection({newShippingMethods:m,newTotal:{type:"final",label:o,amount:`${d.grandTotal.toFixed(s)}`},newLineItems:this._getUpdatedLineItems(d,s)})}))}_handleShippingMethodSelected(e,t,n){return di(this,void 0,void 0,(function*(){const{storeProfile:{storeName:i}}=t,{shippingMethod:{identifier:r}}=n;try{yield this._updateShippingOption(r)}catch(t){return e.abort(),this._hasApplePaySession=!1,this._onError(t)}const o=this._paymentIntegrationService.getState(),{currency:{decimalPlaces:a}}=o.getCartOrThrow(),s=o.getCheckoutOrThrow();e.completeShippingMethodSelection({newTotal:{type:"final",label:i,amount:`${s.grandTotal.toFixed(a)}`},newLineItems:this._getUpdatedLineItems(s,a)})}))}_getUpdatedLineItems(e,t){const n=[{label:this._subTotalLabel,amount:`${e.subtotal.toFixed(t)}`}];return e.taxes.forEach((e=>n.push({label:e.name,amount:`${e.amount.toFixed(t)}`}))),n.push({label:this._shippingLabel,amount:`${e.shippingCostTotal.toFixed(t)}`}),n}_updateShippingOption(e){return di(this,void 0,void 0,(function*(){return this._paymentIntegrationService.selectShippingOption(e)}))}_onValidateMerchant(e,t){return di(this,void 0,void 0,(function*(){const n=[`validationUrl=${t.validationURL}`,`merchantIdentifier=${e.initializationData.merchantId}`,`displayName=${e.initializationData.storeName}`,`domainName=${window.location.hostname}`].join("&");return this._requestSender.post(`${e.initializationData.paymentsUrl}/api/public/v1/payments/applepay/validate_merchant`,{credentials:!1,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded","X-XSRF-TOKEN":null},body:n})}))}_onPaymentAuthorized(e,t,n){var i;return di(this,void 0,void 0,(function*(){const{token:r,billingContact:o,shippingContact:a}=e.payment,s=this._paymentIntegrationService.getState().getCartOrThrow().lineItems.physicalItems.length>0;let d;(null===(i=n.initializationData)||void 0===i?void 0:i.gateway)===ii.BRAINTREE&&(d=yield this._getBraintreeDeviceData());const c={methodId:n.id,paymentData:{deviceSessionId:d,formattedPayload:{apple_pay_token:{payment_data:r.paymentData,payment_method:r.paymentMethod,transaction_id:r.transactionIdentifier}}}},l=this._transformContactToAddress(o),u=this._transformContactToAddress(a),h=null==a?void 0:a.emailAddress,m=(null==a?void 0:a.phoneNumber)||"";try{return yield this._paymentIntegrationService.updateBillingAddress(Object.assign(Object.assign({},l),{email:h,phone:m})),s&&(yield this._paymentIntegrationService.updateShippingAddress(u)),yield this._paymentIntegrationService.submitOrder({useStoreCredit:!1}),yield this._paymentIntegrationService.submitPayment(c),t.completePayment(ApplePaySession.STATUS_SUCCESS),this._onAuthorizeCallback()}catch(e){return t.completePayment(ApplePaySession.STATUS_FAILURE),this._onError(e)}}))}_transformContactToAddress(e){return{firstName:(null==e?void 0:e.givenName)||"",lastName:(null==e?void 0:e.familyName)||"",city:(null==e?void 0:e.locality)||"",company:"",address1:(null==e?void 0:e.addressLines)&&e.addressLines[0]||"",address2:(null==e?void 0:e.addressLines)&&e.addressLines[1]||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCode:(null==e?void 0:e.countryCode)||"",phone:(null==e?void 0:e.phoneNumber)||"",stateOrProvince:(null==e?void 0:e.administrativeArea)||"",stateOrProvinceCode:(null==e?void 0:e.administrativeArea)||"",customFields:[]}}_getBraintreeDeviceData(){return di(this,void 0,void 0,(function*(){try{const{deviceData:e}=yield this._braintreeSdk.getDataCollectorOrThrow();return e}catch(e){}}))}_initializeBraintreeSdk(){return di(this,void 0,void 0,(function*(){yield this._paymentIntegrationService.loadPaymentMethod(ii.BRAINTREE);const e=this._paymentIntegrationService.getState().getPaymentMethod(ii.BRAINTREE);e&&e.clientToken&&e.initializationData&&this._braintreeSdk.initialize(e.clientToken)}))}}function li(e){if(!function(e){return"ApplePaySession"in e}(e))throw new Error("Apple pay is not supported")}class ui{create(e){return li(window),new ApplePaySession(1,e)}}class hi{constructor(e){this.scriptLoader=e,this.sdkVersion="1.latest"}loadSdk(){return e=this,n=function*(){yield this.scriptLoader.loadScript(`https://applepay.cdn-apple.com/jsapi/${this.sdkVersion}/apple-pay-sdk.js`),li(window)},new((t=void 0)||(t=Promise))((function(i,r){function o(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,a)}s((n=n.apply(e,[])).next())}));var e,t,n}}const mi=Ge((e=>{const{getHost:t}=e.getState(),n=new Un(e);return new ci((0,a.createRequestSender)({host:t()}),e,new ui,new ti(new oi((0,s.vQ)(),window,n)),new hi(new s.B2))}),[{id:"applepay"}]);class pi extends pn{constructor(e){super(e||"An unexpected error has occurred during buy now cart creation process. Please try again later."),this.name="BuyNowCartCreationError",this.type="buy_now_cart_creation_error"}}const yi={body:{},headers:{},status:0};class gi extends pn{constructor(e,{message:t,errors:n}={}){const{body:i,headers:r,status:o}=e||yi;super(t||"An unexpected error has occurred."),this.name="RequestError",this.type="request",this.body=i,this.headers=r,this.status=o,this.errors=n||[]}}var vi,fi,bi,Si,Ci,wi,_i;!function(e){e.Possible="POSSIBLE",e.No="NO",e.Unknown="UNKNOWN",e.Yes="YES"}(vi||(vi={})),function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(fi||(fi={})),function(e){e.paypal="paypal",e.checkout="checkout",e.buynow="buynow",e.pay="pay",e.installment="installment"}(bi||(bi={})),function(e){e.gold="gold",e.blue="blue",e.silver="silver",e.black="black",e.white="white"}(Si||(Si={})),function(e){e.pill="pill",e.rect="rect"}(Ci||(Ci={})),function(e){e.OXXO="oxxo"}(wi||(wi={})),function(e){e.Approved="APPROVED",e.Created="CREATED",e.PayerActionRequired="PAYER_ACTION_REQUIRED",e.PollingStop="POLLING_STOP",e.PollingError="POLLING_ERROR"}(_i||(_i={}));var Ii=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Pi{constructor(e,t,n,i){this.formPoster=e,this.paymentIntegrationService=t,this.bigCommercePaymentsRequestSender=n,this.bigCommercePaymentsScriptLoader=i}loadPayPalSdk(e,t,n,i){return Ii(this,void 0,void 0,(function*(){const r=this.paymentIntegrationService.getState(),o=t||r.getCartOrThrow().currency.code,a=r.getPaymentMethodOrThrow(e);return this.paypalSdk=yield this.bigCommercePaymentsScriptLoader.getPayPalSDK(a,o,n,i),this.paypalSdk}))}getPayPalSdkOrThrow(){if(!this.paypalSdk)throw new Tn;return this.paypalSdk}createBuyNowCartOrThrow(e){return Ii(this,void 0,void 0,(function*(){const t=e.getBuyNowCartRequestBody();if(!t)throw new vn(yn.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(t)}catch(e){throw new pi}}))}createOrder(e,t){return Ii(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getCartOrThrow().id,{orderId:i}=yield this.bigCommercePaymentsRequestSender.createOrder(e,Object.assign({cartId:n},t));return i}))}createOrderCardFields(e,t){return Ii(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getCartOrThrow().id,{orderId:i,setupToken:r}=yield this.bigCommercePaymentsRequestSender.createOrder(e,Object.assign({cartId:n},t));return Object.assign({orderId:i},r?{setupToken:r}:{})}))}updateOrder(){return Ii(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getConsignmentsOrThrow()[0];try{yield this.bigCommercePaymentsRequestSender.updateOrder({availableShippingOptions:n.availableShippingOptions,cartId:t.id,selectedShippingOption:n.selectedShippingOption})}catch(e){throw new gi}}))}getOrderStatus(e,t){return Ii(this,void 0,void 0,(function*(){try{const{status:n}=yield this.bigCommercePaymentsRequestSender.getOrderStatus(e,t);return n}catch(e){throw new gi}}))}tokenizePayment(e,t){const n=this.paymentIntegrationService.getState().getCartOrThrow();if(!t)throw new vn(yn.MissingOrderId);return this.formPoster.postForm("/checkout.php",Object.assign({payment_type:"paypal",action:"set_external_checkout",provider:e,order_id:t},n.source===xe.BuyNow&&{cart_id:n.id}))}submitPayment(e,t,n){return Ii(this,void 0,void 0,(function*(){const i={formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:null,method_id:e,paypal_account:{order_id:t}}};yield this.paymentIntegrationService.submitPayment(Object.assign({methodId:e,paymentData:i},n?{gatewayId:n}:{}))}))}getShippingOptionOrThrow(e){const t=this.paymentIntegrationService.getState().getConsignmentsOrThrow()[0],n=t.availableShippingOptions||[],i=n.find((e=>e.isRecommended)),r=(e?n.find((t=>t.id===e)):n.find((e=>{var n;return e.id===(null===(n=t.selectedShippingOption)||void 0===n?void 0:n.id)})))||i||n[0];if(!r)throw new Error("Your order can't be shipped to this address");return r}getAddress(e){return{firstName:(null==e?void 0:e.firstName)||"",lastName:(null==e?void 0:e.lastName)||"",email:(null==e?void 0:e.email)||"",phone:(null==e?void 0:e.phone)||"",company:"",address1:(null==e?void 0:e.address1)||"",address2:(null==e?void 0:e.address2)||"",city:(null==e?void 0:e.city)||"",countryCode:(null==e?void 0:e.countryCode)||"",postalCode:(null==e?void 0:e.postalCode)||"",stateOrProvince:"",stateOrProvinceCode:(null==e?void 0:e.stateOrProvinceCode)||"",customFields:[]}}getBillingAddressFromOrderDetails({payer:e}){var t,n;return this.getAddress({firstName:e.name.given_name,lastName:e.name.surname,email:e.email_address,address1:e.address.address_line_1,address2:e.address.address_line_2,city:e.address.admin_area_2,countryCode:e.address.country_code,postalCode:e.address.postal_code,stateOrProvinceCode:e.address.admin_area_1,phone:null===(n=null===(t=e.phone)||void 0===t?void 0:t.phone_number)||void 0===n?void 0:n.national_number})}getShippingAddressFromOrderDetails(e){const{payer:t,purchase_units:n}=e,{address:i,name:{full_name:r}}=n[0].shipping,[o,...a]=r.split(" ");return this.getAddress({firstName:o,lastName:a.join(" "),email:t.email_address,address1:i.address_line_1,address2:i.address_line_2,city:i.admin_area_2,countryCode:i.country_code,postalCode:i.postal_code,stateOrProvinceCode:i.admin_area_1})}getValidButtonStyle(e){const{color:t,height:n,label:i,shape:r}=e||{},o={color:t&&Si[t]?t:void 0,height:this.getValidHeight(n),label:i&&bi[i]?i:void 0,shape:r&&Ci[r]?r:void 0};return(0,c.omitBy)(o,c.isNil)}getValidHeight(e){return e&&"number"==typeof e?e>55?55:e<25?25:e:40}removeElement(e){const t=e&&document.getElementById(e);t&&(t.style.display="none")}}const Ei="This API endpoint is for internal use only and may change in the future";var Oi;!function(e){e.Json="application/json",e.JsonV1="application/vnd.bc.v1+json"}(Oi||(Oi={}));const Ai=Oi,ki={"X-Checkout-SDK-Version":"1.808.0"};var Ti=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ni{constructor(e){this.requestSender=e}createOrder(e,t){return Ti(this,void 0,void 0,(function*(){const n=`/api/storefront/payment/${e}`,i=t,r=Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki);return(yield this.requestSender.post(n,{headers:r,body:i})).body}))}updateOrder(e){return Ti(this,void 0,void 0,(function*(){const t=e,n=Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki);return(yield this.requestSender.put("/api/storefront/initialization/bigcommerce_payments",{headers:n,body:t})).body}))}getOrderStatus(e="bigcommerce_payments",t){return Ti(this,void 0,void 0,(function*(){const n=`/api/storefront/initialization/${e}`,i=Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki);return(yield this.requestSender.get(n,Object.assign({headers:i},t))).body}))}}var Mi=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class xi{constructor(e){this.scriptLoader=e,this.window=window}getPayPalSDK(e,t,n,i){return Mi(this,void 0,void 0,(function*(){const r=this.getPayPalSdkScriptConfigOrThrow(e,t,n);return this.loadPayPalSDK(r,i)}))}loadPayPalSDK(e,t=!1){return Mi(this,void 0,void 0,(function*(){if(!this.window.paypal||t){const t=this.transformConfig(e.options),n=this.transformConfig(e.attributes),i=`https://www.paypal.com/sdk/js?${new URLSearchParams(t).toString()}`;yield this.scriptLoader.loadScript(i,{async:!0,attributes:n})}if(!this.window.paypal)throw new Tn;return this.window.paypal}))}getPayPalSdkScriptConfigOrThrow(e,t,n=!0){const{id:i,clientToken:r,initializationData:o}=e;if(!(null==o?void 0:o.clientId))throw new vn(yn.MissingPaymentMethod);const{intent:a,clientId:s,merchantId:d,buyerCountry:c,attributionId:l,isVenmoEnabled:u,isHostedCheckoutEnabled:h,isPayPalCreditAvailable:m,isDeveloperModeApplicable:p,availableAlternativePaymentMethods:y=[],enabledAlternativePaymentMethods:g=[],isGooglePayEnabled:v}=o,f=h||n,b="bigcommerce_payments_creditcards"===i,S=b?["card"]:[],C=m?["credit","paylater"]:[],w=n||!f,_=u?["venmo"]:[],I=w?g:[],P=v?["googlepay"]:[],E=n?["card-fields"]:[],O=[...b?[]:["card"],...m?[]:["credit","paylater"],...u?[]:["venmo"],...w?y.filter((e=>!g.includes(e))):y],A=[...S,...C,..._,...I];return{options:Object.assign({"client-id":s,"merchant-id":d,"enable-funding":A.length>0?A:void 0,"disable-funding":O.length>0?O:void 0,commit:f,components:["buttons","hosted-fields","payment-fields","legal",...P,...E],currency:t,intent:a},p&&{"buyer-country":c}),attributes:{"data-partner-attribution-id":l,"data-client-token":r}}}transformConfig(e){let t={};return Object.keys(e).forEach((n=>{const i=e[n];null==i||""===i||Array.isArray(i)&&0===i.length||(t=Object.assign(Object.assign({},t),{[n]:Array.isArray(i)?i.join(","):i}))})),t}}const Di=e=>{const{getHost:t}=e.getState();return new Pi((0,N.createFormPoster)(),e,new Ni((0,a.createRequestSender)({host:t()})),new xi((0,s.vQ)()))},zi=36;var Fi=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Bi{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.onError=c.noop}initialize(e){return Fi(this,void 0,void 0,(function*(){const{bigcommerce_payments:t,methodId:n}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.bigcommerce_payments" argument is not provided.');if(!t.container)throw new xn('Unable to initialize payment because "options.bigcommerce_payments.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new xn('Unable to initialize payment because "options.bigcommerce_payments.onClick" argument is not a function.');this.onError=t.onError||c.noop,this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC PayPal]: PayPal Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return Fi(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}))}signOut(e){return Fi(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onClick:i,onComplete:r}=t,o=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{isHostedCheckoutEnabled:s,paymentButtonStyles:d}=a.initializationData||{},{checkoutTopButtonStyles:c}=d||{},l=Object.assign({createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments"),onApprove:({orderID:t})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(e,t)},i&&{onClick:()=>i()}),u={onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e),onApprove:(t,n)=>this.onHostedCheckoutApprove(t,n,e,r)},h=Object.assign(Object.assign({fundingSource:o.FUNDING.PAYPAL,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},c),{height:zi}))},l),s&&u),m=o.Buttons(h);m.isEligible()?m.render(`#${n}`):this.bigCommercePaymentsIntegrationService.removeElement(n)}onHostedCheckoutApprove(e,t,n,i){return Fi(this,void 0,void 0,(function*(){if(!e.orderID)throw new vn(yn.MissingOrderId);const r=this.paymentIntegrationService.getState().getCartOrThrow(),o=yield t.order.get();try{const t=this.bigCommercePaymentsIntegrationService.getBillingAddressFromOrderDetails(o);if(yield this.paymentIntegrationService.updateBillingAddress(t),r.lineItems.physicalItems.length>0){const e=this.bigCommercePaymentsIntegrationService.getShippingAddressFromOrderDetails(o);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.bigCommercePaymentsIntegrationService.updateOrder()}yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.bigCommercePaymentsIntegrationService.submitPayment(n,e.orderID),i&&"function"==typeof i&&i()}catch(e){this.handleError(e)}}))}onShippingAddressChange(e){return Fi(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}onShippingOptionsChange(e){return Fi(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}}const Ri=Ge((e=>new Bi(e,Di(e))),[{id:"bigcommerce_payments"}]);var Li,ji,Ui,Vi,qi,Hi,Gi,$i,Wi=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Yi{constructor(e){this.scriptLoader=e,this.window=window}getPayPalFastlaneSdk(e,t,n){return Wi(this,void 0,void 0,(function*(){if(!this.window.paypalFastlaneSdk){const i=this.getPayPalFastlaneSdkConfiguration(e,t,n);if(yield this.loadPayPalSdk(i),!this.window.paypalFastlaneSdk)throw new Tn}return this.window.paypalFastlaneSdk}))}getPayPalGooglePaySdk(e,t,n,i){return Wi(this,void 0,void 0,(function*(){if(!this.window.paypalGooglePay||i){const i=this.getPayPalGooglePaySdkScriptConfigOrThrow(e,t,n);yield this.loadPayPalSdk(i)}if(!this.window.paypalGooglePay)throw new Tn;return this.window.paypalGooglePay}))}getPayPalApmsSdk(e,t){return Wi(this,void 0,void 0,(function*(){if(!this.window.paypalApms){const n=this.getPayPalApmSdkConfiguration(e,t);if(yield this.loadPayPalSdk(n),!this.window.paypalApms)throw new Tn}return this.window.paypalApms}))}getPayPalMessages(e,t){return Wi(this,void 0,void 0,(function*(){if(!this.window.paypalMessages){const n=this.getPayPalSdkMessagesConfiguration(e,t);yield this.loadPayPalSdk(n)}if(!this.window.paypalMessages)throw new Tn;return this.window.paypalMessages}))}loadPayPalSdk({options:e,attributes:t}){return Wi(this,void 0,void 0,(function*(){const n=this.transformConfig(e),i=this.transformConfig(t),r=`https://www.paypal.com/sdk/js?${new URLSearchParams(n).toString()}`;yield this.scriptLoader.loadScript(r,{async:!0,attributes:i})}))}getPayPalFastlaneSdkConfiguration(e,t,n){const{clientToken:i,initializationData:r}=e;if(!r||!r.clientId)throw new vn(yn.MissingPaymentMethod);const{intent:o,clientId:a,merchantId:s,attributionId:d}=r;return{options:{"client-id":a,"merchant-id":s,commit:!0,components:["fastlane","three-domain-secure"],currency:t,intent:o},attributes:{"data-client-metadata-id":n.replace(/-/g,""),"data-namespace":"paypalFastlaneSdk","data-partner-attribution-id":d,"data-sdk-client-token":i}}}getPayPalGooglePaySdkScriptConfigOrThrow(e,t,n=!0){const{clientToken:i,initializationData:r}=e;if(!r||!r.clientId)throw new vn(yn.MissingPaymentMethod);const{intent:o,clientId:a,merchantId:s,buyerCountry:d,attributionId:c,isHostedCheckoutEnabled:l,isDeveloperModeApplicable:u}=r,h=l||n;return{options:Object.assign({"client-id":a,"merchant-id":s,commit:h,components:["googlepay"],currency:t,intent:o},u&&{"buyer-country":d}),attributes:{"data-partner-attribution-id":c,"data-client-token":i,"data-namespace":"paypalGooglePay"}}}getPayPalApmSdkConfiguration(e,t){const{initializationData:n}=e;if(!n||!n.clientId)throw new vn(yn.MissingPaymentMethod);const{intent:i,clientId:r,merchantId:o,buyerCountry:a,attributionId:s,isDeveloperModeApplicable:d,availableAlternativePaymentMethods:c=[],enabledAlternativePaymentMethods:l=[]}=n,u=l,h=c.filter((e=>!l.includes(e)));return{options:Object.assign({"client-id":r,"merchant-id":o,"enable-funding":u.length>0?u:void 0,"disable-funding":h.length>0?h:void 0,commit:!0,components:["buttons","payment-fields"],currency:t,intent:i},d&&{"buyer-country":a}),attributes:{"data-partner-attribution-id":s,"data-namespace":"paypalApms"}}}getPayPalSdkMessagesConfiguration(e,t){const{initializationData:n}=e;if(!n||!n.clientId)throw new vn(yn.MissingPaymentMethod);const{clientId:i,merchantId:r,attributionId:o,isDeveloperModeApplicable:a,buyerCountry:s}=n;return{options:Object.assign({"client-id":i,"merchant-id":r,components:["messages"],currency:t},a&&{"buyer-country":s}),attributes:{"data-namespace":"paypalMessages","data-partner-attribution-id":o}}}transformConfig(e){let t={};return Object.keys(e).forEach((n=>{const i=e[n];null==i||""===i||Array.isArray(i)&&0===i.length||(t=Object.assign(Object.assign({},t),{[n]:Array.isArray(i)?i.join(","):i}))})),t}}function Ki(){return new Yi((0,s.Hb)())}!function(e){e.CVV="cvv",e.PAN="pan"}(Li||(Li={}));class Qi{static get(e){const t=`${encodeURIComponent(`${e}`)}=`,n=document.cookie;let i=null;const r=n.indexOf(t);if(r>-1){let e=n.indexOf(";",r);-1===e&&(e=n.length),i=decodeURIComponent(n.substring(r+t.length,e))}return i}static set(e,t,n={secure:!0}){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;const{expires:r,path:o,domain:a,secure:s}=n;if(r)i+=`; expires=${r.toUTCString()}`;else{const e=new Date,t=60;e.setTime(e.getTime()+60*t*1e3),i+=`; expires=${e.toUTCString()}`}o&&(i+=`; path=${o}`),a&&(i+=`; domain=${a}`),s&&(i+="; secure"),document.cookie=i}static remove(e,t){Qi.set(e,"",Object.assign({expires:new Date(0)},t))}}!function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(ji||(ji={})),function(e){e.Possible="POSSIBLE",e.No="NO",e.Unknown="UNKNOWN",e.Yes="YES"}(Ui||(Ui={})),function(e){e.Succeeded="succeeded",e.Cancelled="cancelled",e.Errored="errored"}(Vi||(Vi={})),function(e){e.paypal="paypal",e.checkout="checkout",e.buynow="buynow",e.pay="pay",e.installment="installment"}(qi||(qi={})),function(e){e.gold="gold",e.blue="blue",e.silver="silver",e.black="black",e.white="white"}(Hi||(Hi={})),function(e){e.pill="pill",e.rect="rect"}(Gi||(Gi={})),function(e){e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled",e.UNRECOGNIZED="unrecognized"}($i||($i={}));var Ji=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Zi{constructor(){this.window=window}initializePayPalFastlane(e,t,n){return Ji(this,void 0,void 0,(function*(){if(t&&(window.localStorage.setItem("fastlaneEnv","sandbox"),window.localStorage.setItem("axoEnv","sandbox")),!this.window.paypalFastlane){const t={root:{backgroundColorPrimary:"transparent"}};this.window.paypalFastlane=yield e.Fastlane({styles:n||t})}return this.window.paypalFastlane}))}getPayPalFastlaneOrThrow(){if(!this.window.paypalFastlane)throw new Tn;return this.window.paypalFastlane}lookupCustomerOrThrow(e){return Ji(this,void 0,void 0,(function*(){return this.getPayPalFastlaneOrThrow().identity.lookupCustomerByEmail(e)}))}triggerAuthenticationFlowOrThrow(e){return Ji(this,void 0,void 0,(function*(){return e?this.getPayPalFastlaneOrThrow().identity.triggerAuthenticationFlow(e):{}}))}updateStorageSessionId(e){const t=new Date;t.setDate(t.getDate()+14);const n={expires:t,secure:!0};Qi.set("bc-fastlane-sessionId",e,n)}removeStorageSessionId(){Qi.remove("bc-fastlane-sessionId")}getStorageSessionId(){return Qi.get("bc-fastlane-sessionId")||""}mapPayPalFastlaneProfileToBcCustomerData(e,t){var n,i,r;const{authenticationState:o,profileData:a}=t,s=null===(r=null===(i=null===(n=null==a?void 0:a.card)||void 0===n?void 0:n.paymentSource)||void 0===i?void 0:i.card)||void 0===r?void 0:r.billingAddress,d=null==a?void 0:a.shippingAddress,c=null==a?void 0:a.name,l=null==a?void 0:a.card,u=d?this.mapPayPalToBcAddress(d.address,d.name,d.phoneNumber):void 0,h=s&&c?this.mapPayPalToBcAddress(s,c,null==d?void 0:d.phoneNumber):void 0,m=l?this.mapPayPalToBcInstrument(e,l):[],p=this.filterAddresses([u,h]);return{authenticationState:o||$i.UNRECOGNIZED,addresses:p,billingAddress:h,shippingAddress:u,instruments:m}}mapPayPalToBcInstrument(e,t){const{id:n,paymentSource:i}=t,{brand:r,expiry:o,lastDigits:a}=i.card,[s,d]=o.split("-");return[{bigpayToken:n,brand:r,defaultInstrument:!1,expiryMonth:d,expiryYear:s,iin:"",last4:a,method:e,provider:e,trustedShippingAddress:!1,untrustedShippingCardVerificationMode:Li.PAN,type:"card"}]}mapBcToPayPalAddress(e){return{company:(null==e?void 0:e.company)||"",addressLine1:(null==e?void 0:e.address1)||"",addressLine2:(null==e?void 0:e.address2)||"",adminArea1:(null==e?void 0:e.stateOrProvinceCode)||(null==e?void 0:e.stateOrProvince)||"",adminArea2:(null==e?void 0:e.city)||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCode:(null==e?void 0:e.countryCode)||""}}mapPayPalToBcAddress(e,t,n,i){const[r,o]=t.fullName.split(" "),a=(null==n?void 0:n.nationalNumber)||"",s=(null==n?void 0:n.countryCode)||"";return{id:Date.now(),type:"paypal-address",firstName:t.firstName||r||"",lastName:t.lastName||o||"",company:e.company||"",address1:e.addressLine1,address2:e.addressLine2||"",city:e.adminArea2,stateOrProvince:e.adminArea1,stateOrProvinceCode:e.adminArea1,country:e.countryCode||"",countryCode:e.countryCode||"",postalCode:e.postalCode,phone:s+a,customFields:i||[]}}filterAddresses(e){return e.reduce(((e,t)=>t?e.some((e=>this.isEqualAddresses(e,t)))?e:[...e,t]:e),[])}isEqualAddresses(e,t){return(0,c.isEqual)(this.normalizeAddress(e),this.normalizeAddress(t))}normalizeAddress(e){return(0,c.omit)(e,["id","phone"])}}function Xi(){return new Zi}function er(e){return"string"!=typeof e}function tr(e,t){if(t||e)return function(e){var t,n;const i={},r=(0,c.omitBy)(e.root,er),o=(0,c.omitBy)(e.input,er),a=(0,c.omitBy)(e.toggle,er),s=(0,c.omitBy)(null===(t=e.text)||void 0===t?void 0:t.body,er),d=(0,c.omitBy)(null===(n=e.text)||void 0===n?void 0:n.caption,er),l=e.branding;return Object.keys(r).length&&(i.root=r),Object.keys(o).length&&(i.input=o),Object.keys(a).length&&(i.toggle=a),Object.keys(s).length&&(i.text={},i.text.body=s),Object.keys(d).length&&(i.text=Object.assign({},i.text),i.text.caption=d),l&&(i.branding=l),i}(function(e,t){var n,i,r,o,a,s,d,c,l,u,h,m,p,y,g,v,f,b,S,C,w,_;return{root:{backgroundColorPrimary:(null==e?void 0:e.fastlaneRootSettingsBackgroundColor)||(null===(n=null==t?void 0:t.root)||void 0===n?void 0:n.backgroundColorPrimary),errorColor:(null==e?void 0:e.fastlaneRootSettingsErrorColor)||(null===(i=null==t?void 0:t.root)||void 0===i?void 0:i.errorColor),fontFamily:(null==e?void 0:e.fastlaneRootSettingsFontFamily)||(null===(r=null==t?void 0:t.root)||void 0===r?void 0:r.fontFamily),fontSizeBase:(null==e?void 0:e.fastlaneRootSettingsFontSize)||(null===(o=null==t?void 0:t.root)||void 0===o?void 0:o.fontSizeBase),padding:(null==e?void 0:e.fastlaneRootSettingsPadding)||(null===(a=null==t?void 0:t.root)||void 0===a?void 0:a.padding),primaryColor:(null==e?void 0:e.fastlaneRootSettingsPrimaryColor)||(null===(s=null==t?void 0:t.root)||void 0===s?void 0:s.primaryColor)},input:{borderRadius:(null==e?void 0:e.fastlaneInputSettingsBorderRadius)||(null===(d=null==t?void 0:t.input)||void 0===d?void 0:d.borderRadius),borderColor:(null==e?void 0:e.fastlaneInputSettingsBorderColor)||(null===(c=null==t?void 0:t.input)||void 0===c?void 0:c.borderColor),focusBorderColor:(null==e?void 0:e.fastlaneInputSettingsFocusBorderBase)||(null===(l=null==t?void 0:t.input)||void 0===l?void 0:l.focusBorderColor),backgroundColor:(null==e?void 0:e.fastlaneInputSettingsBackgroundColor)||(null===(u=null==t?void 0:t.input)||void 0===u?void 0:u.backgroundColor),borderWidth:(null==e?void 0:e.fastlaneInputSettingsBorderWidth)||(null===(h=null==t?void 0:t.input)||void 0===h?void 0:h.borderWidth),textColorBase:(null==e?void 0:e.fastlaneInputSettingsTextColorBase)||(null===(m=null==t?void 0:t.input)||void 0===m?void 0:m.textColorBase)},toggle:{colorPrimary:(null==e?void 0:e.fastlaneToggleSettingsColorPrimary)||(null===(p=null==t?void 0:t.toggle)||void 0===p?void 0:p.colorPrimary),colorSecondary:(null==e?void 0:e.fastlaneToggleSettingsColorSecondary)||(null===(y=null==t?void 0:t.toggle)||void 0===y?void 0:y.colorSecondary)},text:{body:{color:(null==e?void 0:e.fastlaneTextBodySettingsColor)||(null===(v=null===(g=null==t?void 0:t.text)||void 0===g?void 0:g.body)||void 0===v?void 0:v.color),fontSize:(null==e?void 0:e.fastlaneTextBodySettingsFontSize)||(null===(b=null===(f=null==t?void 0:t.text)||void 0===f?void 0:f.body)||void 0===b?void 0:b.fontSize)},caption:{color:(null==e?void 0:e.fastlaneTextCaptionSettingsColor)||(null===(C=null===(S=null==t?void 0:t.text)||void 0===S?void 0:S.caption)||void 0===C?void 0:C.color),fontSize:(null==e?void 0:e.fastlaneTextCaptionSettingsFontSize)||(null===(_=null===(w=null==t?void 0:t.text)||void 0===w?void 0:w.caption)||void 0===_?void 0:_.fontSize)}},branding:(null==e?void 0:e.fastlaneBrandingSettings)||(null==t?void 0:t.branding)}}(e,t))}var nr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ir{constructor(e,t,n){this.paymentIntegrationService=e,this.bigCommercePaymentsSdk=t,this.bigCommercePaymentsFastlaneUtils=n}initialize(e){var t;return nr(this,void 0,void 0,(function*(){const{methodId:n,bigcommerce_payments_fastlane:i}=e;if(!n)throw new xn('Unable to proceed because "methodId" argument is not provided.');try{yield this.paymentIntegrationService.loadPaymentMethod(n);const e=this.paymentIntegrationService.getState(),r=e.getCartOrThrow(),o=e.getPaymentMethodOrThrow(n),a=!!(null===(t=o.initializationData)||void 0===t?void 0:t.isDeveloperModeApplicable),s=yield this.bigCommercePaymentsSdk.getPayPalFastlaneSdk(o,r.currency.code,r.id);yield this.bigCommercePaymentsFastlaneUtils.initializePayPalFastlane(s,a,this.getFastlaneStyles(n,i))}catch(e){}return Promise.resolve()}))}deinitialize(){return nr(this,void 0,void 0,(function*(){return Promise.resolve()}))}signIn(e,t){return nr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return nr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){return nr(this,void 0,void 0,(function*(){const{checkoutPaymentMethodExecuted:t,continueWithCheckoutCallback:n,methodId:i}=e||{};if(!i)throw new xn('Unable to proceed because "methodId" argument is not provided.');if("function"!=typeof n)throw new xn('Unable to proceed because "continueWithCheckoutCallback" argument is not provided and it must be a function.');if(this.paymentIntegrationService.getState().getCustomerOrThrow().isGuest){t&&"function"==typeof t&&t();try{yield this.runPayPalAuthenticationFlowOrThrow(i)}catch(e){}}n()}))}runPayPalAuthenticationFlowOrThrow(e){return nr(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow().id,i=t.getCustomer(),r=t.getBillingAddress(),o=(null==i?void 0:i.email)||(null==r?void 0:r.email)||"",{customerContextId:a}=yield this.bigCommercePaymentsFastlaneUtils.lookupCustomerOrThrow(o),s=yield this.bigCommercePaymentsFastlaneUtils.triggerAuthenticationFlowOrThrow(a),d=s.authenticationState===$i.CANCELED;yield this.updateCustomerDataState(e,s),d?this.bigCommercePaymentsFastlaneUtils.removeStorageSessionId():this.bigCommercePaymentsFastlaneUtils.updateStorageSessionId(n)}))}updateCustomerDataState(e,t){var n;return nr(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState().getCartOrThrow(),{authenticationState:r,addresses:o,billingAddress:a,shippingAddress:s,instruments:d}=this.bigCommercePaymentsFastlaneUtils.mapPayPalFastlaneProfileToBcCustomerData(e,t);if(yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:r,addresses:o,instruments:d}),a&&(yield this.paymentIntegrationService.updateBillingAddress(a)),s&&i.lineItems.physicalItems.length>0){const t=yield this.paymentIntegrationService.updateShippingAddress(s),i=t.getPaymentMethodOrThrow(e),{isFastlaneShippingOptionAutoSelectEnabled:r}=i.initializationData||{},o=t.getConsignments()||[],a=(null===(n=o[0])||void 0===n?void 0:n.availableShippingOptions)||[],d=a[0],c=a.find((e=>e.isRecommended));if((c||d)&&r){const e=(null==c?void 0:c.id)||d.id;yield this.paymentIntegrationService.selectShippingOption(e)}}}))}getFastlaneStyles(e,t){const n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{fastlaneStyles:i,isFastlaneStylingEnabled:r}=n.initializationData||{};return tr(r?i:{},null==t?void 0:t.styles)}}const rr=Ge((e=>new ir(e,Ki(),Xi())),[{id:"bigcommerce_payments_fastlane"},{id:"bigcommerce_payments_creditcards"}]);var or=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ar{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.onError=c.noop}initialize(e){return or(this,void 0,void 0,(function*(){const{bigcommerce_payments_paylater:t,methodId:n}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_paylater" argument is not provided.');if(!t.container)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_paylater.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_paylater.onClick" argument is not a function.');this.onError=t.onError||c.noop,this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC BigCommercePayments PayLater]: button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return or(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return or(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onComplete:i,onClick:r}=t,o=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{isHostedCheckoutEnabled:s,paymentButtonStyles:d}=a.initializationData||{},{checkoutTopButtonStyles:c}=d||{},l=Object.assign({createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_paylater"),onApprove:({orderID:t})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(e,t)},r&&{onClick:()=>r()}),u={onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e),onApprove:(t,n)=>this.onHostedCheckoutApprove(t,n,e,i)},h=[o.FUNDING.PAYLATER,o.FUNDING.CREDIT];let m=!1;h.forEach((e=>{if(!m){const t=Object.assign(Object.assign({fundingSource:e,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},c),{height:zi}))},l),s&&u),i=o.Buttons(t);i.isEligible()&&(i.render(`#${n}`),m=!0)}})),m||this.bigCommercePaymentsIntegrationService.removeElement(n)}onHostedCheckoutApprove(e,t,n,i){return or(this,void 0,void 0,(function*(){if(!e.orderID)throw new vn(yn.MissingOrderId);const r=this.paymentIntegrationService.getState().getCartOrThrow(),o=yield t.order.get();try{const t=this.bigCommercePaymentsIntegrationService.getBillingAddressFromOrderDetails(o);if(yield this.paymentIntegrationService.updateBillingAddress(t),r.lineItems.physicalItems.length>0){const e=this.bigCommercePaymentsIntegrationService.getShippingAddressFromOrderDetails(o);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.bigCommercePaymentsIntegrationService.updateOrder()}yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.bigCommercePaymentsIntegrationService.submitPayment(n,e.orderID),i&&"function"==typeof i&&i()}catch(e){this.handleError(e)}}))}onShippingAddressChange(e){return or(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}onShippingOptionsChange(e){return or(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}}const sr=Ge((e=>new ar(e,Di(e))),[{id:"bigcommerce_payments_paylater"}]);var dr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class cr{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t}initialize(e){return dr(this,void 0,void 0,(function*(){const{bigcommerce_payments_venmo:t,methodId:n}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_venmo" argument is not provided.');if(!t.container)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_venmo.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_venmo.onClick" argument is not a function.');this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC Payments Venmo]: Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return dr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return dr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onClick:i}=t,r=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:a}=o.initializationData||{},{checkoutTopButtonStyles:s}=a||{},d=Object.assign({fundingSource:r.FUNDING.VENMO,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},s),{height:zi})),createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_venmo"),onApprove:({orderID:t})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(e,t)},i&&{onClick:()=>i()}),c=r.Buttons(d);c.isEligible()?c.render(`#${n}`):this.bigCommercePaymentsIntegrationService.removeElement(n)}}const lr=Ge((e=>new cr(e,Di(e))),[{id:"bigcommerce_payments_venmo"}]);class ur extends pn{constructor(e){super(e||"Unable to proceed because the client library of a payment method has thrown an unexpected error."),this.name="PaymentMethodFailedError",this.type="payment_method_client_invalid"}}class hr extends gi{constructor(e){super(e,{message:"There is a problem processing your payment. Please try again later."}),this.name="PaymentMethodInvalidError",this.type="payment_method_invalid"}}var mr,pr,yr,gr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class vr{constructor(e,t){this.paymentIntegrationService=e,this.boltScriptLoader=t,this.boltHostWindow=window}initialize(e){var t;return gr(this,void 0,void 0,(function*(){const{methodId:n,bolt:i}=e,{onInit:r}=i||{};if(!n)throw new xn('Unable to proceed because "methodId" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n);if(!(null===(t=o.initializationData)||void 0===t?void 0:t.publishableKey))throw new vn(yn.MissingPaymentMethod);const{developerConfig:a,publishableKey:s}=o.initializationData;if(yield this.boltScriptLoader.loadBoltClient(s,o.config.testMode,a),r&&"function"==typeof r){const e=this.getCustomerEmail();r(yield this.hasBoltAccount(e),e)}}))}deinitialize(){return Promise.resolve()}signIn(e,t){return gr(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}))}signOut(e){return gr(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}))}executePaymentMethodCheckout(e){return gr(this,void 0,void 0,(function*(){const{continueWithCheckoutCallback:t=h.l,checkoutPaymentMethodExecuted:n,methodId:i}=e||{},r=this.getCustomerEmail();if(!i)throw new xn('Unable to proceed because "methodId" argument is not provided.');if("function"!=typeof t)throw new xn('Unable to proceed because "continueWithCheckoutCallback" argument is not provided and it must be a function.');if(r)return this.openBoltCheckoutModalOrThrow(r,i,t,n);t()}))}openBoltCheckoutModalOrThrow(e,t,n,i){var r;return gr(this,void 0,void 0,(function*(){const o=this.getBoltClientOrThrow(),a=this.paymentIntegrationService.getState().getPaymentMethod(t);try{if(null===(r=null==a?void 0:a.initializationData)||void 0===r?void 0:r.embeddedOneClickEnabled){const t=yield this.hasBoltAccount(e);if(t){const t={close:()=>{n()}};yield o.openCheckout(e,t)}else n();"function"==typeof i&&i({hasBoltAccount:t})}else n()}catch(e){if(function(e){return"string"==typeof e.message&&"string"==typeof e.type&&("string"==typeof e.subtype||!e.subtype)&&e instanceof Error}(e)&&"MissingDataError"!==e.name&&"NotInitializedError"!==e.name)throw new ur(e.message);throw e}}))}getBoltClientOrThrow(){const e=this.boltHostWindow.BoltCheckout;if(!e)throw new Sn(gn.PaymentNotInitialized);return e}hasBoltAccount(e){return gr(this,void 0,void 0,(function*(){const t=this.getBoltClientOrThrow();try{return yield t.hasBoltAccount(e)}catch(e){throw new hr}}))}getCustomerEmail(){const e=this.paymentIntegrationService.getState(),t=e.getCustomer(),n=e.getBillingAddress();return(null==t?void 0:t.email)||(null==n?void 0:n.email)||""}}!function(e){e.SandboxMode="bolt_sandbox",e.StagingMode="bolt_staging",e.DevelopmentMode="bolt_development"}(mr||(mr={})),function(e){e.Small="small",e.Medium="medium",e.Large="large"}(pr||(pr={})),function(e){e.Pill="pill",e.Rect="rect"}(yr||(yr={}));var fr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class br{constructor(e,t=window){this.scriptLoader=e,this.boltHostWindow=t}loadBoltClient(e,t,n,i,r){return fr(this,void 0,void 0,(function*(){if(this.boltHostWindow.BoltCheckout)return this.boltHostWindow.BoltCheckout;if(!e)throw new xn('Unable to initialize payment because "publishableKey" argument is not provided.');if(yield this.scriptLoader.loadScript(`//${this.getDomainURL(!!t,n)}/connect-bigcommerce.js`,this.getScriptOptions("bolt-connect",e,i,r)),yield this.scriptLoader.loadScript(`//${this.getDomainURL(!!t,n)}/track.js`,this.getScriptOptions("bolt-track",e)),!this.boltHostWindow.BoltCheckout)throw new Tn;return this.boltHostWindow.BoltCheckout}))}loadBoltEmbedded(e,t,n){return fr(this,void 0,void 0,(function*(){if(yield this.scriptLoader.loadScript(`//${this.getDomainURL(!!t,n)}/embed.js`,{async:!0,attributes:{id:"bolt-embedded"}}),!this.boltHostWindow.Bolt)throw new Tn;return this.boltHostWindow.Bolt(e)}))}getDomainURL(e,t){if(!e)return"connect.bolt.com";if(t)switch(t.developerMode){case mr.StagingMode:return"connect-staging.bolt.com";case mr.DevelopmentMode:return`connect.${t.developerDomain}`}return"connect-sandbox.bolt.com"}getScriptOptions(e,t,n,i){return{async:!0,attributes:Object.assign(Object.assign({id:e,"data-publishable-key":t},n&&{"data-shopping-cart-id":n}),i&&{"data-storefront-api-token":i})}}}const Sr=Ge((e=>new vr(e,new br((0,s.vQ)()))),[{id:"bolt"}]);class Cr extends xn{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}class wr extends pn{constructor(e,t){super(t||"Unable to proceed because the payment form contains invalid data."),this.details=e,this.name="PaymentInvalidFormError",this.type="payment_invalid_form"}}const _r=["buttons","messages"];var Ir,Pr,Er,Or,Ar,kr;!function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(Ir||(Ir={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.RESPONSIVE="responsive"}(Pr||(Pr={})),function(e){e.GOLD="gold",e.BLUE="blue",e.SIlVER="silver",e.BLACK="black",e.WHITE="white"}(Er||(Er={})),function(e){e.CHECKOUT="checkout",e.PAY="pay",e.BUYNOW="buynow",e.PAYPAL="paypal",e.CREDIT="credit"}(Or||(Or={})),function(e){e.PILL="pill",e.RECT="rect"}(Ar||(Ar={})),function(e){e.CART="cart",e.HOME="homepage",e.PAYMENT="payment",e.PRODUCT="product"}(kr||(kr={}));var Tr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Nr{constructor(e,t,n){this.braintreeScriptLoader=e,this.braintreeHostWindow=t,this.overlay=n,this.dataCollectors={}}initialize(e,t){this.clientToken=e,this.threeDSecureOptions=t}getBraintreeFastlane(e,t,n){return Tr(this,void 0,void 0,(function*(){if(t&&(window.localStorage.setItem("axoEnv","sandbox"),window.localStorage.setItem("fastlaneEnv","sandbox")),!this.braintreeHostWindow.braintreeFastlane){const t=this.getClientTokenOrThrow(),i=yield this.getClient(),r=yield this.getSessionId(e),o=yield this.braintreeScriptLoader.loadFastlane(),a={root:{backgroundColorPrimary:"transparent"}};this.braintreeHostWindow.braintreeFastlane=yield o.create({authorization:t,client:i,deviceData:r,styles:n||a})}return this.braintreeHostWindow.braintreeFastlane}))}getClient(){return Tr(this,void 0,void 0,(function*(){if(!this.client){const e=this.getClientTokenOrThrow(),t=yield this.braintreeScriptLoader.loadClient();this.client=t.create({authorization:e})}return this.client}))}getPaypal(){return this.braintreePaypal||(this.braintreePaypal=Promise.all([this.getClient(),this.braintreeScriptLoader.loadPaypal()]).then((([e,t])=>t.create({client:e})))),this.braintreePaypal}paypal(e){var{shouldSaveInstrument:t}=e,n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["shouldSaveInstrument"]);const i=(0,M.Jt)();return this.getPaypal().then((e=>{var r;return i&&(null===(r=this.overlay)||void 0===r||r.show({onClick:()=>e.focusWindow()})),e.tokenize(Object.assign({enableShippingAddress:!0,flow:t?"vault":"checkout",useraction:"commit"},n))})).then((e=>{var t;return null===(t=this.overlay)||void 0===t||t.remove(),e})).catch((e=>{var t;throw null===(t=this.overlay)||void 0===t||t.remove(),e}))}getPaypalCheckout(e,t,n){return Tr(this,void 0,void 0,(function*(){const i=yield this.getClient(),r=yield this.braintreeScriptLoader.loadPaypalCheckout(),o={client:i};return this.paypalCheckout=yield r.create(o,((i,r)=>{var o;if(i)return n(i);const a=Object.assign(Object.assign({currency:e.currency},e.isCreditEnabled&&{"enable-funding":"paylater"}),{components:_r.toString(),intent:e.intent,commit:null===(o=e.commit)||void 0===o||o});this.braintreeHostWindow.paypal?t(r):r.loadPayPalSDK(a,(()=>t(r)))})),this.paypalCheckout}))}getDataCollector(e){return Tr(this,void 0,void 0,(function*(){const t=(null==e?void 0:e.paypal)?"paypal":"default";let n=this.dataCollectors[t];if(!n){try{const t=yield this.getClient(),i=yield this.braintreeScriptLoader.loadDataCollector(),r=Object.assign({client:t,kount:!0},e);n=yield i.create(r)}catch(e){if(!Qn(e)||"DATA_COLLECTOR_KOUNT_NOT_ENABLED"!==e.code)throw e;n={deviceData:void 0,teardown:()=>Promise.resolve()}}this.dataCollectors[t]=n}return n}))}getBraintreeEnv(e=!1){return e?Jn.Sandbox:Jn.Production}mapToBraintreeShippingAddressOverride(e){return{recipientName:`${e.firstName} ${e.lastName}`,line1:e.address1,line2:e.address2,city:e.city,state:e.stateOrProvinceCode,postalCode:e.postalCode,countryCode:e.countryCode,phone:e.phone}}mapToLegacyShippingAddress(e){const{email:t,phone:n,shippingAddress:i}=e,r=(null==i?void 0:i.recipientName)||"",[o,a]=r.split(" ");return{email:t,first_name:o||"",last_name:a||"",phone_number:n,address_line_1:null==i?void 0:i.line1,address_line_2:null==i?void 0:i.line2,city:null==i?void 0:i.city,state:null==i?void 0:i.state,country_code:null==i?void 0:i.countryCode,postal_code:null==i?void 0:i.postalCode}}mapToLegacyBillingAddress(e){const{billingAddress:t,email:n,firstName:i,lastName:r,phone:o,shippingAddress:a}=e,s=t||a;return{email:n,first_name:i,last_name:r,phone_number:o,address_line_1:null==s?void 0:s.line1,address_line_2:null==s?void 0:s.line2,city:null==s?void 0:s.city,state:null==s?void 0:s.state,country_code:null==s?void 0:s.countryCode,postal_code:null==s?void 0:s.postalCode}}removeElement(e){const t=e&&document.getElementById(e);t&&t.remove()}getSessionId(e){return Tr(this,void 0,void 0,(function*(){const{deviceData:t}=yield this.getDataCollector({riskCorrelationId:e});return t}))}teardown(){return Tr(this,void 0,void 0,(function*(){yield this.teardownModule(this.dataCollectors.default),yield this.teardownModule(this.dataCollectors.paypal),this.dataCollectors={},yield this.teardownModule(this.paypalCheckout),this.paypalCheckout=void 0}))}get3DS(){return Tr(this,void 0,void 0,(function*(){return this.threeDS||(this.threeDS=Promise.all([this.getClient(),this.braintreeScriptLoader.load3DS()]).then((([e,t])=>t.create({client:e,version:2})))),this.threeDS}))}getVenmoCheckout(e){return Tr(this,void 0,void 0,(function*(){if(!this.venmoCheckout){const t=yield this.getClient(),n=yield this.braintreeScriptLoader.loadVenmoCheckout(),i=Object.assign({client:t,allowDesktop:!0,paymentMethodUsage:"multi_use"},e||{});this.venmoCheckout=yield new Promise(((e,t)=>{n.create(i,((n,i)=>n?t(n):i.isBrowserSupported()?void e(i):t(new Vn)))}))}return this.venmoCheckout}))}verifyCard(e,t,n){return Tr(this,void 0,void 0,(function*(){const i=yield this.tokenizeCard(e,t);return this.challenge3DSVerification(i,n)}))}tokenizeCard(e,t){return Tr(this,void 0,void 0,(function*(){const{paymentData:n}=e;if(!function(e){if("object"!=typeof e||null===e)return!1;const t=e;return"object"==typeof t.ccExpiry&&null!==t.ccExpiry&&"string"==typeof t.ccNumber&&"string"==typeof t.ccName}(n))throw new Cr(["payment.paymentData"]);const i=this.getErrorsRequiredFields(n);if(!(0,c.isEmpty)(i))throw new wr(i);const r=this.mapToCreditCard(n,t),o=yield this.getClient(),{creditCards:a}=yield o.request(r);return{nonce:a[0].nonce,bin:a[0].details.bin}}))}challenge3DSVerification(e,t){return Tr(this,void 0,void 0,(function*(){const n=yield this.get3DS();return this.present3DSChallenge(n,t,e)}))}teardownModule(e){return e?e.teardown():Promise.resolve()}getClientTokenOrThrow(){if(!this.clientToken)throw new Sn(gn.PaymentNotInitialized);return this.clientToken}getErrorsRequiredFields(e){const{ccNumber:t,ccExpiry:n}=e,i={};return t||(i.ccNumber=[{message:"Credit card number is required",type:"required"}]),n||(i.ccExpiry=[{message:"Expiration date is required",type:"required"}]),i}mapToCreditCard(e,t){return{data:{creditCard:{cardholderName:e.ccName,number:e.ccNumber,cvv:e.ccCvv,expirationDate:`${e.ccExpiry.month}/${e.ccExpiry.year}`,options:{validate:!1},billingAddress:t&&{countryCodeAlpha2:t.countryCode,locality:t.city,countryName:t.country,postalCode:t.postalCode,streetAddress:t.address2?`${t.address1} ${t.address2}`:t.address1}}},endpoint:"payment_methods/credit_cards",method:"post"}}present3DSChallenge(e,t,n){const{nonce:i,bin:r}=n;if(!this.threeDSecureOptions||!i)throw new Sn(gn.PaymentNotInitialized);const{addFrame:o,removeFrame:a,challengeRequested:s=!0,additionalInformation:d}=this.threeDSecureOptions,c=()=>Tr(this,void 0,void 0,(function*(){const t=yield e.cancelVerifyCard();return u.cancel(new ai),t})),l=t.toFixed(2),u=new qt(e.verifyCard({addFrame:(e,t)=>{o&&o(e,t,c)},amount:Number(l),bin:r,challengeRequested:s,nonce:i,removeFrame:a,onLookupComplete:(e,t)=>{t()},collectDeviceData:!0,additionalInformation:d}));return u.promise}}var Mr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class xr{constructor(e,t,n,i){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeIntegrationService=n,this.braintreeHostWindow=i}initialize(e){return Mr(this,void 0,void 0,(function*(){const{braintreepaypal:t,methodId:n}=e,{container:i,onError:r}=t||{};if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.braintreepaypal" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.braintreepaypal.container" argument is not provided.');let o,a=this.paymentIntegrationService.getState();try{if(o=a.getPaymentMethodOrThrow(n),!o.clientToken)throw new vn(yn.MissingPaymentToken)}catch(e){a=yield this.paymentIntegrationService.loadPaymentMethod(n),o=a.getPaymentMethodOrThrow(n)}const{clientToken:s,config:d,initializationData:c}=o,{paymentButtonStyles:l}=c||{},{checkoutTopButtonStyles:u}=l||{};if(!s||!c)throw new vn(yn.MissingPaymentMethod);const h={currency:a.getCartOrThrow().currency.code,intent:c.intent,isCreditEnabled:c.isCreditEnabled,commit:!1};this.braintreeIntegrationService.initialize(s),yield this.braintreeIntegrationService.getPaypalCheckout(h,(e=>{this.renderPayPalButton(e,t,n,Boolean(d.testMode),u)}),(e=>this.handleError(e,i,r)))}))}deinitialize(){return Mr(this,void 0,void 0,(function*(){yield this.braintreeIntegrationService.teardown()}))}signIn(e,t){return Mr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return Mr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderPayPalButton(e,t,n,i,r){const{container:o,onClick:a=c.noop}=t,{paypal:s}=this.braintreeHostWindow,d=null==s?void 0:s.FUNDING.PAYPAL;if(s&&d){const c=s.Buttons({env:this.braintreeIntegrationService.getBraintreeEnv(i),fundingSource:d,style:Object.assign(Object.assign({},r),{height:zi}),createOrder:()=>this.setupPayment(e,t,n),onApprove:i=>this.tokenizePayment(i,e,n,t),onClick:a});c.isEligible()&&c.render(`#${o}`)}else this.braintreeIntegrationService.removeElement(o)}setupPayment(e,t,n){var i;return Mr(this,void 0,void 0,(function*(){try{yield this.paymentIntegrationService.loadDefaultCheckout();const t=this.paymentIntegrationService.getState(),r=t.getCheckoutOrThrow().outstandingBalance,o=t.getCartOrThrow().currency.code,a=t.getCustomer(),s=t.getPaymentMethodOrThrow(n),d=null==a?void 0:a.addresses[0],c=d?this.braintreeIntegrationService.mapToBraintreeShippingAddressOverride(d):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:c,amount:r,currency:o,offerCredit:!1,intent:null===(i=s.initializationData)||void 0===i?void 0:i.intent})}catch(e){const{container:n,onError:i}=t;this.handleError(e,n,i)}}))}tokenizePayment(e,t,n,i){return Mr(this,void 0,void 0,(function*(){try{const{deviceData:i}=yield this.braintreeIntegrationService.getDataCollector({paypal:!0}),r=yield t.tokenizePayment(e),{details:o,nonce:a}=r,s=this.braintreeIntegrationService.mapToLegacyBillingAddress(o),d=this.braintreeIntegrationService.mapToLegacyShippingAddress(o);return this.formPoster.postForm("/checkout.php",{payment_type:"paypal",provider:n,action:"set_external_checkout",nonce:a,device_data:i,billing_address:JSON.stringify(s),shipping_address:JSON.stringify(d)}),r}catch(e){const{container:t,onError:n}=i;this.handleError(e,t,n)}}))}handleError(e,t,n){if(this.braintreeIntegrationService.removeElement(t),!n||!Qn(e))throw e;n(e)}}const Dr=Ge((e=>{const t=window,n=new Un(e),i=new Nr(new oi((0,s.vQ)(),t,n),t);return new xr(e,(0,N.createFormPoster)(),i,t)}),[{id:"braintreepaypal"}]);var zr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Fr{constructor(e,t,n,i){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeIntegrationService=n,this.braintreeHostWindow=i}initialize(e){return zr(this,void 0,void 0,(function*(){const{braintreepaypalcredit:t,methodId:n}=e,{container:i,onError:r}=t||{};if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.braintreepaypalcredit" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.braintreepaypalcredit.container" argument is not provided.');let o,a=this.paymentIntegrationService.getState();try{o=a.getPaymentMethodOrThrow(n)}catch(e){a=yield this.paymentIntegrationService.loadPaymentMethod(n),o=a.getPaymentMethodOrThrow(n)}const{clientToken:s,config:d,initializationData:c}=o,{paymentButtonStyles:l}=c||{},{checkoutTopButtonStyles:u}=l||{};if(!s||!c)throw new vn(yn.MissingPaymentMethod);const h={currency:a.getCartOrThrow().currency.code,intent:c.intent,isCreditEnabled:c.isCreditEnabled,commit:!1};this.braintreeIntegrationService.initialize(s),yield this.braintreeIntegrationService.getPaypalCheckout(h,(e=>{this.renderPayPalButton(e,t,n,Boolean(d.testMode),Object.assign(Object.assign({},u),{height:zi}))}),(e=>this.handleError(e,i,r)))}))}deinitialize(){return zr(this,void 0,void 0,(function*(){yield this.braintreeIntegrationService.teardown()}))}signIn(e,t){return zr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return zr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderPayPalButton(e,t,n,i,r){const{container:o,onClick:a=c.noop}=t,{paypal:s}=this.braintreeHostWindow;let d=!1;s&&[s.FUNDING.PAYLATER,s.FUNDING.CREDIT].forEach((c=>{if(!d){const l=s.Buttons({env:i?"sandbox":"production",fundingSource:c,style:r,createOrder:()=>this.setupPayment(e,t,n),onApprove:i=>this.tokenizePayment(i,e,n,t),onClick:a});l.isEligible()&&(l.render(`#${o}`),d=!0)}})),s&&d||this.braintreeIntegrationService.removeElement(o)}setupPayment(e,t,n){var i;return zr(this,void 0,void 0,(function*(){try{yield this.paymentIntegrationService.loadDefaultCheckout();const t=this.paymentIntegrationService.getState(),r=t.getCheckoutOrThrow().outstandingBalance,o=t.getCartOrThrow().currency.code,a=t.getCustomer(),s=t.getPaymentMethodOrThrow(n),d=null==a?void 0:a.addresses[0],c=d?this.braintreeIntegrationService.mapToBraintreeShippingAddressOverride(d):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:c,amount:r,currency:o,offerCredit:!0,intent:null===(i=s.initializationData)||void 0===i?void 0:i.intent})}catch(e){const{container:n,onError:i}=t;this.handleError(e,n,i)}}))}tokenizePayment(e,t,n,i){return zr(this,void 0,void 0,(function*(){try{const{deviceData:i}=yield this.braintreeIntegrationService.getDataCollector({paypal:!0}),r=yield t.tokenizePayment(e),{details:o,nonce:a}=r,s=this.braintreeIntegrationService.mapToLegacyBillingAddress(o),d=this.braintreeIntegrationService.mapToLegacyShippingAddress(o);return this.formPoster.postForm("/checkout.php",{payment_type:"paypal",provider:n,action:"set_external_checkout",nonce:a,device_data:i,billing_address:JSON.stringify(s),shipping_address:JSON.stringify(d)}),r}catch(e){const{container:t,onError:n}=i;this.handleError(e,t,n)}}))}handleError(e,t,n){if(this.braintreeIntegrationService.removeElement(t),!n||!Qn(e))throw e;n(e)}}const Br=Ge((e=>{const t=window,n=new Un(e),i=new Nr(new oi((0,s.vQ)(),t,n),t);return new Fr(e,(0,N.createFormPoster)(),i,t)}),[{id:"braintreepaypalcredit"}]);function Rr(e){return"string"!=typeof e}function Lr(e,t){if(t||e)return function(e){var t,n;const i={},r=(0,c.omitBy)(e.root,Rr),o=(0,c.omitBy)(e.input,Rr),a=(0,c.omitBy)(e.toggle,Rr),s=(0,c.omitBy)(null===(t=e.text)||void 0===t?void 0:t.body,Rr),d=(0,c.omitBy)(null===(n=e.text)||void 0===n?void 0:n.caption,Rr),l=e.branding;return Object.keys(r).length&&(i.root=r),Object.keys(o).length&&(i.input=o),Object.keys(a).length&&(i.toggle=a),Object.keys(s).length&&(i.text={},i.text.body=s),Object.keys(d).length&&(i.text=Object.assign({},i.text),i.text.caption=d),l&&(i.branding=l),i}(function(e,t){var n,i,r,o,a,s,d,c,l,u,h,m,p,y,g,v,f,b,S,C,w,_;return{root:{backgroundColorPrimary:(null==e?void 0:e.fastlaneRootSettingsBackgroundColor)||(null===(n=null==t?void 0:t.root)||void 0===n?void 0:n.backgroundColorPrimary),errorColor:(null==e?void 0:e.fastlaneRootSettingsErrorColor)||(null===(i=null==t?void 0:t.root)||void 0===i?void 0:i.errorColor),fontFamily:(null==e?void 0:e.fastlaneRootSettingsFontFamily)||(null===(r=null==t?void 0:t.root)||void 0===r?void 0:r.fontFamily),fontSizeBase:(null==e?void 0:e.fastlaneRootSettingsFontSize)||(null===(o=null==t?void 0:t.root)||void 0===o?void 0:o.fontSizeBase),padding:(null==e?void 0:e.fastlaneRootSettingsPadding)||(null===(a=null==t?void 0:t.root)||void 0===a?void 0:a.padding),primaryColor:(null==e?void 0:e.fastlaneRootSettingsPrimaryColor)||(null===(s=null==t?void 0:t.root)||void 0===s?void 0:s.primaryColor)},input:{borderRadius:(null==e?void 0:e.fastlaneInputSettingsBorderRadius)||(null===(d=null==t?void 0:t.input)||void 0===d?void 0:d.borderRadius),borderColor:(null==e?void 0:e.fastlaneInputSettingsBorderColor)||(null===(c=null==t?void 0:t.input)||void 0===c?void 0:c.borderColor),focusBorderColor:(null==e?void 0:e.fastlaneInputSettingsFocusBorderBase)||(null===(l=null==t?void 0:t.input)||void 0===l?void 0:l.focusBorderColor),backgroundColor:(null==e?void 0:e.fastlaneInputSettingsBackgroundColor)||(null===(u=null==t?void 0:t.input)||void 0===u?void 0:u.backgroundColor),borderWidth:(null==e?void 0:e.fastlaneInputSettingsBorderWidth)||(null===(h=null==t?void 0:t.input)||void 0===h?void 0:h.borderWidth),textColorBase:(null==e?void 0:e.fastlaneInputSettingsTextColorBase)||(null===(m=null==t?void 0:t.input)||void 0===m?void 0:m.textColorBase)},toggle:{colorPrimary:(null==e?void 0:e.fastlaneToggleSettingsColorPrimary)||(null===(p=null==t?void 0:t.toggle)||void 0===p?void 0:p.colorPrimary),colorSecondary:(null==e?void 0:e.fastlaneToggleSettingsColorSecondary)||(null===(y=null==t?void 0:t.toggle)||void 0===y?void 0:y.colorSecondary)},text:{body:{color:(null==e?void 0:e.fastlaneTextBodySettingsColor)||(null===(v=null===(g=null==t?void 0:t.text)||void 0===g?void 0:g.body)||void 0===v?void 0:v.color),fontSize:(null==e?void 0:e.fastlaneTextBodySettingsFontSize)||(null===(b=null===(f=null==t?void 0:t.text)||void 0===f?void 0:f.body)||void 0===b?void 0:b.fontSize)},caption:{color:(null==e?void 0:e.fastlaneTextCaptionSettingsColor)||(null===(C=null===(S=null==t?void 0:t.text)||void 0===S?void 0:S.caption)||void 0===C?void 0:C.color),fontSize:(null==e?void 0:e.fastlaneTextCaptionSettingsFontSize)||(null===(_=null===(w=null==t?void 0:t.text)||void 0===w?void 0:w.caption)||void 0===_?void 0:_.fontSize)}},branding:(null==e?void 0:e.fastlaneBrandingSettings)||(null==t?void 0:t.branding)}}(e,t))}var jr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ur{constructor(e,t){this.paymentIntegrationService=e,this.braintreeFastlaneUtils=t,this.isAcceleratedCheckoutEnabled=!1}initialize({methodId:e,braintreefastlane:t}){var n;return jr(this,void 0,void 0,(function*(){if(!e)throw new xn('Unable to proceed because "methodId" argument is not provided.');const i=yield this.getValidPaymentMethodOrThrow(e),{isAcceleratedCheckoutEnabled:r,isFastlaneStylingEnabled:o}=i.initializationData||{},a=o?null===(n=i.initializationData)||void 0===n?void 0:n.fastlaneStyles:void 0;this.isAcceleratedCheckoutEnabled=!!r;try{if(this.isAcceleratedCheckoutEnabled){const e=Lr(a,null==t?void 0:t.styles);yield this.braintreeFastlaneUtils.initializeBraintreeFastlaneOrThrow(i.id,e)}}catch(e){}return Promise.resolve()}))}deinitialize(){return jr(this,void 0,void 0,(function*(){return Promise.resolve()}))}signIn(e,t){return jr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return jr(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){return jr(this,void 0,void 0,(function*(){const{checkoutPaymentMethodExecuted:t,continueWithCheckoutCallback:n}=e||{};if("function"!=typeof n)throw new xn('Unable to proceed because "continueWithCheckoutCallback" argument is not provided and it must be a function.');const i=this.paymentIntegrationService.getState().getCustomerOrThrow();if(this.isAcceleratedCheckoutEnabled&&i.isGuest){const e=yield this.shouldRunAuthenticationFlow();t&&"function"==typeof t&&t(),e&&(yield this.braintreeFastlaneUtils.runPayPalAuthenticationFlowOrThrow(void 0,!0))}n()}))}shouldRunAuthenticationFlow(){var e;return jr(this,void 0,void 0,(function*(){const t="braintreeacceleratedcheckout";try{yield this.paymentIntegrationService.loadPaymentMethod(t);const n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t);return(null===(e=n.initializationData)||void 0===e?void 0:e.shouldRunAcceleratedCheckout)||!1}catch(e){return!1}}))}getValidPaymentMethodOrThrow(e){return jr(this,void 0,void 0,(function*(){let t=e;try{yield this.paymentIntegrationService.loadPaymentMethod(t)}catch(n){t="braintree"===e?"braintreeacceleratedcheckout":"braintree",yield this.paymentIntegrationService.loadPaymentMethod(t)}return this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t)}))}}var Vr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class qr{constructor(e,t){this.paymentIntegrationService=e,this.braintreeIntegrationService=t}getDeviceSessionId(){return Vr(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState().getCart();return this.braintreeIntegrationService.getSessionId(null==e?void 0:e.id)}))}initializeBraintreeFastlaneOrThrow(e,t){return Vr(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getCart(),{clientToken:r,config:o}=n.getPaymentMethodOrThrow(e);if(!r)throw new vn(yn.MissingPaymentMethod);this.methodId=e,this.braintreeIntegrationService.initialize(r),this.braintreeFastlane=yield this.braintreeIntegrationService.getBraintreeFastlane(null==i?void 0:i.id,o.testMode,t)}))}getBraintreeFastlaneOrThrow(){if(!this.braintreeFastlane)throw new Tn;return this.braintreeFastlane}getBraintreeFastlaneComponentOrThrow(){return this.getBraintreeFastlaneOrThrow().FastlaneCardComponent}runPayPalAuthenticationFlowOrThrow(e,t){var n;return Vr(this,void 0,void 0,(function*(){try{const i=this.getMethodIdOrThrow(),r=this.getBraintreeFastlaneOrThrow(),{lookupCustomerByEmail:o,triggerAuthenticationFlow:a}=r.identity,s=this.paymentIntegrationService.getState(),d=s.getCartOrThrow(),c=s.getCustomer(),l=s.getBillingAddress(),{isFastlaneShippingOptionAutoSelectEnabled:u}=s.getPaymentMethodOrThrow(i).initializationData||{},h=e||(null==c?void 0:c.email)||(null==l?void 0:l.email)||"",{customerContextId:m}=yield o(h);if(!m)return yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:$n.UNRECOGNIZED,addresses:[],instruments:[]}),void this.saveSessionIdToCookies(d.id);const{authenticationState:p,profileData:y}=yield a(m),g=(null===(n=null==y?void 0:y.shippingAddress)||void 0===n?void 0:n.phoneNumber)||"";if(p===$n.CANCELED)return yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:p,addresses:[],instruments:[]}),void this.removeSessionIdFromCookies();const v=this.mapPayPalToBcAddress([y.shippingAddress],[g])||[],f=this.getPayPalBillingAddresses(y),b=f?this.mapPayPalToBcAddress([f],[g]):[],S=y.card?this.mapPayPalToBcInstrument(i,[y.card]):[],C=this.mergeShippingAndBillingAddresses(v,b);if(this.saveSessionIdToCookies(d.id),yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:p,addresses:C,instruments:S}),b.length>0&&d.lineItems.physicalItems.length>0&&(yield this.paymentIntegrationService.updateBillingAddress(b[0])),b.length>0&&d.lineItems.digitalItems.length>0&&0===d.lineItems.physicalItems.length){const{firstName:e,lastName:t}=C[0],n=Object.assign(Object.assign({},b[0]),{firstName:e,lastName:t});yield this.paymentIntegrationService.updateBillingAddress(n)}v.length>0&&d.lineItems.physicalItems.length>0&&(yield this.paymentIntegrationService.updateShippingAddress(v[0]),t&&u&&(yield this.setShippingOption()))}catch(e){}}))}getSessionIdFromCookies(){return Qi.get("bc-fastlane-sessionId")||""}saveSessionIdToCookies(e){const t=new Date;t.setDate(t.getDate()+14),Qi.set("bc-fastlane-sessionId",e,{expires:t,secure:!0})}removeSessionIdFromCookies(){Qi.remove("bc-fastlane-sessionId")}mapPayPalToBcInstrument(e,t){if(t)return t.map((t=>{const{id:n,paymentSource:i}=t,{brand:r,expiry:o,lastDigits:a,binDetails:s}=i.card,[d,c]=o.split("-");return{bigpayToken:n,brand:r,defaultInstrument:!1,expiryMonth:c,expiryYear:d,iin:(null==s?void 0:s.bin)||"",last4:a,method:e,provider:e,trustedShippingAddress:!1,type:"card",untrustedShippingCardVerificationMode:Li.PAN}}))}mapPayPalToBcAddress(e,t){if(!e)return[];const n=this.paymentIntegrationService.getState().getCountries()||[],i=e=>{const t=n.find((t=>t.code===e));return(null==t?void 0:t.name)||""};return e.map((e=>({id:Date.now(),type:"paypal-address",firstName:e.firstName||"",lastName:e.lastName||"",company:e.company||"",address1:e.streetAddress,address2:e.extendedAddress||"",city:e.locality,stateOrProvince:e.region,stateOrProvinceCode:e.region,country:i(e.countryCodeAlpha2),countryCode:e.countryCodeAlpha2,postalCode:e.postalCode,phone:t&&t[0]||"",customFields:[]})))}getPayPalBillingAddresses(e){const{card:t,name:n}=e||{};if(!t)return;const{firstName:i,lastName:r}=t.paymentSource.card.billingAddress,{firstName:o,lastName:a}=n||{},{shippingAddress:s}=e||{},d=Object.assign(Object.assign({},t.paymentSource.card.billingAddress),{firstName:i||o,lastName:r||a});return s&&(0,c.isEqual)(this.normalizeAddress(d),this.normalizeAddress(s))?s:d}normalizeAddress(e){return(0,c.omit)(e,["id"])}mergeShippingAndBillingAddresses(e,t){const n=t.filter((t=>!e.some((e=>(0,c.isEqual)(this.normalizeAddress(e),this.normalizeAddress(t))))));return[...e,...n]}getMethodIdOrThrow(){if(!this.methodId)throw new xn('Unable to proceed because "methodId" argument is not provided.');return this.methodId}setShippingOption(){var e;return Vr(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getConsignments()||[],n=(null===(e=t[0])||void 0===e?void 0:e.availableShippingOptions)||[],i=n.find((e=>e.isRecommended));if(i||n.length){const e=i||n[0];yield this.paymentIntegrationService.selectShippingOption(e.id)}}))}}const Hr=Ge((e=>{const t=window,n=new Un(e),i=new Nr(new oi((0,s.vQ)(),t,n),t),r=new qr(e,i);return new Ur(e,r)}),[{id:"braintreeacceleratedcheckout"},{id:"braintree"}]);var Gr=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class $r{constructor(e,t,n){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeSdk=n,this.buttonClassName="visa-checkout-wrapper",this.onError=c.noop}initialize(e){return Gr(this,void 0,void 0,(function*(){const{braintreevisacheckout:t,methodId:n}=e;if(!n)throw new xn('Unable to proceed because "methodId" argument is not provided.');if(!t)throw new xn('Unable to proceed because "options.braintreevisacheckout" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const i=this.paymentIntegrationService.getState(),r=i.getCheckoutOrThrow(),{clientToken:o,config:a}=i.getPaymentMethodOrThrow(n),s=i.getStoreConfigOrThrow();if(!o)throw new vn(yn.MissingPaymentMethod);this.braintreeSdk.initialize(o);const d=yield this.braintreeSdk.getBraintreeVisaCheckout(),l=yield this.braintreeSdk.getVisaCheckoutSdk(a.testMode),{container:u,onError:h}=t;this.onError=h||c.noop;const m=d.createInitOptions({paymentRequest:{currencyCode:s.currency.code,subtotal:String(r.subtotal)},settings:{locale:s.storeProfile.storeLanguage,shipping:{collectShipping:!0}}}),p=this.createSignInButton(u,this.buttonClassName);yield l.init(m),l.on("payment.success",(e=>this.tokenizePayment(d,e).then((()=>this.paymentIntegrationService.loadCheckout())).catch((e=>this.handleError(e))))),l.on("payment.error",((e,t)=>this.handleError(t))),p.style.visibility="visible"}))}deinitialize(){return Gr(this,void 0,void 0,(function*(){yield this.braintreeSdk.deinitialize()}))}signIn(){throw new Dn('In order to sign in via VisaCheckout, the shopper must click on "Visa Checkout" button.')}signOut(e){return Gr(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}tokenizePayment(e,t){return Gr(this,void 0,void 0,(function*(){return Promise.all([e.tokenize(t),this.braintreeSdk.getDataCollectorOrThrow()]).then((([e,t])=>{const n=this.paymentIntegrationService.getState(),i=n.getShippingAddress(),r=n.getBillingAddress(),{shippingAddress:o=this.mapToVisaCheckoutAddress(i),billingAddress:a=this.mapToVisaCheckoutAddress(r)}=e;return this.postForm(Object.assign(Object.assign({},e),{shippingAddress:o,billingAddress:a}),t)}))}))}postForm(e,t){const{userData:n,billingAddress:i,shippingAddress:r,details:o}=e,{userEmail:a}=n,{deviceData:s}=t;return this.formPoster.postForm("/checkout.php",{payment_type:e.type,nonce:e.nonce,provider:"braintreevisacheckout",action:"set_external_checkout",device_data:s,card_information:JSON.stringify({type:o.cardType,number:o.lastTwo}),billing_address:JSON.stringify(this.getAddress(a,i)),shipping_address:JSON.stringify(this.getAddress(a,r))})}mapToVisaCheckoutAddress(e){return e?{firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phone,streetAddress:e.address1,extendedAddress:e.address2,locality:e.city,region:e.stateOrProvinceCode,countryCode:e.countryCode,postalCode:e.postalCode}:{}}getAddress(e,t={}){return{email:e,first_name:t.firstName,last_name:t.lastName,phone_number:t.phoneNumber,address_line_1:t.streetAddress,address_line_2:t.extendedAddress,city:t.locality,state:t.region,country_code:t.countryCode,postal_code:t.postalCode}}createSignInButton(e,t){const n=document.querySelector(`#${e}`);if(!n)throw new Error("Unable to proceed because the provided container ID is not valid.");return this.insertVisaCheckoutButton(n,t)}insertVisaCheckoutButton(e,t){const n=document.createElement("div");return n.style.display="flex",n.style.flexDirection="column",n.style.visibility="hidden",n.style.width="max-content",n.className=t,n.innerHTML='\n            <img\n                alt="Visa Checkout"\n                class="v-button"\n                role="button"\n                src="https://secure.checkout.visa.com/wallet-services-web/xo/button.png?acceptCanadianVisaDebit=false&cobrand=true&height=34&width=178"\n                />\n            <a class="v-learn v-learn-default" style="text-align: right; display: block; font-size: 10px; color: #003366;" href="#" data-locale="en_US">Tell Me More</a>',e.appendChild(n),n}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}}const Wr=Ge((e=>{const t=window,n=new Un(e),i=new ti(new oi((0,s.vQ)(),t,n));return new $r(e,(0,N.createFormPoster)(),i)}),[{id:"braintreevisacheckout"}]);class Yr{constructor(e){if(!e)throw new Error("Currency settings missing");const{decimalPlaces:t,symbolLocation:n,symbol:i,thousandsSeparator:r,decimalSeparator:o}=e;if("string"!=typeof n||"string"!=typeof i||"string"!=typeof r||"string"!=typeof o||"string"!=typeof t)throw new xn("Invalid currency settings provided");this._decimalPlaces=parseInt(t,10),this._symbolLocation=n,this._symbol=i,this._thousandsSeparator=r,this._decimalSeparator=o}format(e){if("number"!=typeof e)throw new xn("Invalid amount provided");const t=this._formatNumber(e),n=this._formatCurrency(t);return e<0?`-${n}`:n}_formatNumber(e){const t=Math.abs(e),[n,i=""]=this._toFixed(t,this._decimalPlaces).split("."),r=n.replace(/\B(?=(\d{3})+(?!\d))/g,this._thousandsSeparator);return this._decimalPlaces<1?r:[r,i].join(this._decimalSeparator)}_formatCurrency(e){return"left"===this._symbolLocation.toLowerCase()?`${this._symbol}${e}`:`${e}${this._symbol}`}_toFixed(e,t){return(+`${Math.round(+`${e}e${t}`)}e${-t}`).toFixed(t)}}let Kr=class{constructor(e){this._storeConfig=e,this._customerFormatter=new Yr(this._storeConfig.shopperCurrency),this._storeFormatter=new Yr(this._storeConfig.currency)}toCustomerCurrency(e){const t=this._storeConfig.shopperCurrency.exchangeRate;return this._customerFormatter.format(e*t)}toStoreCurrency(e){return this._storeFormatter.format(e)}};Kr=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([Zt],Kr);const Qr=Kr,Jr=(e,t)=>!!e&&(!!e.lineItems.physicalItems.some((e=>e.isShippingRequired))||!(!t||!e.lineItems.customItems)&&e.lineItems.customItems.length>0);var Zr,Xr,eo,to,no,io,ro,oo,ao;function so(e){return e in io}!function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(Zr||(Zr={})),function(e){e.paypal="paypal",e.checkout="checkout",e.buynow="buynow",e.pay="pay",e.installment="installment"}(Xr||(Xr={})),function(e){e.gold="gold",e.blue="blue",e.silver="silver",e.black="black",e.white="white"}(eo||(eo={})),function(e){e.pill="pill",e.rect="rect"}(to||(to={})),function(e){e.ESTIMATED="ESTIMATED",e.FINAL="FINAL",e.NOT_CURRENTLY_KNOWN="NOT_CURRENTLY_KNOWN"}(no||(no={})),function(e){e.AMEX="AMEX",e.DISCOVER="DISCOVER",e.INTERAC="INTERAC",e.JCB="JCB",e.MC="MASTERCARD",e.VISA="VISA"}(io||(io={})),function(e){e.OFFER="OFFER",e.PAYMENT_AUTHORIZATION="PAYMENT_AUTHORIZATION",e.SHIPPING_ADDRESS="SHIPPING_ADDRESS",e.SHIPPING_OPTION="SHIPPING_OPTION"}(ro||(ro={})),function(e){e.OFFER_INVALID="OFFER_INVALID",e.PAYMENT_DATA_INVALID="PAYMENT_DATA_INVALID",e.SHIPPING_ADDRESS_INVALID="SHIPPING_ADDRESS_INVALID",e.SHIPPING_ADDRESS_UNSERVICEABLE="SHIPPING_ADDRESS_UNSERVICEABLE",e.SHIPPING_OPTION_INVALID="SHIPPING_OPTION_INVALID",e.OTHER_ERROR="OTHER_ERROR"}(oo||(oo={})),function(e){e.INITIALIZE="INITIALIZE",e.SHIPPING_OPTION="SHIPPING_OPTION",e.SHIPPING_ADDRESS="SHIPPING_ADDRESS",e.OFFER="OFFER"}(ao||(ao={}));var co,lo=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class uo{constructor(e,t){this._gatewayIdentifier=e,this._paymentIntegrationService=t,this._isBuyNowFlow=!1}mapToShippingAddressRequestBody({shippingAddress:e}){if(!e)return;const{company:t="",phone:n=""}=this._paymentIntegrationService.getState().getShippingAddress()||{};return this._mapToAddressRequestBody(e,t,n)}mapToBillingAddressRequestBody(e){const{billingAddress:t}=e.paymentMethodData.info;if(!t)return;const{company:n="",phone:i="",email:r,customFields:o=[]}=this._paymentIntegrationService.getState().getBillingAddress()||{};return Object.assign(Object.assign({},this._mapToAddressRequestBody(t,n,i,o)),{email:r||e.email})}mapToExternalCheckoutData(e){var t;const{paymentMethodData:{tokenizationData:{token:n},info:{cardNetwork:i,cardDetails:r}}}=e;if(!n)throw new vn(yn.MissingPaymentToken);return Promise.resolve(Object.assign({nonce:n,card_information:{type:i,number:r}},this._isBuyNowFlow&&{cart_id:null===(t=this._paymentIntegrationService.getState().getCart())||void 0===t?void 0:t.id}))}getRequiredData(){var e;return lo(this,void 0,void 0,(function*(){const t={emailRequired:!0};if(!this._isShippingAddressRequired())return t;const n=yield this._paymentIntegrationService.loadShippingCountries(),i=null===(e=n.getShippingCountries())||void 0===e?void 0:e.map((e=>e.code));return Object.assign(Object.assign({},t),{shippingAddressRequired:!0,shippingAddressParameters:Object.assign({phoneNumberRequired:!0},i&&{allowedCountryCodes:i}),shippingOptionRequired:!0})}))}getCallbackIntents(){return this._isShippingAddressRequired()?[ro.OFFER,ro.SHIPPING_ADDRESS,ro.SHIPPING_OPTION]:[ro.OFFER]}getCallbackTriggers(){const e=this._paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features["PI-2875.googlepay_coupons_handling"]||!1;return{availableTriggers:[ao.INITIALIZE,ao.SHIPPING_ADDRESS,ao.SHIPPING_OPTION,...e?[ao.OFFER]:[]],initializationTrigger:[ao.INITIALIZE],addressChangeTriggers:[ao.INITIALIZE,ao.SHIPPING_ADDRESS],shippingOptionsChangeTriggers:[ao.SHIPPING_OPTION],offerChangeTriggers:e?[ao.OFFER]:[]}}getNonce(e){var t;const n=null===(t=this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e).initializationData)||void 0===t?void 0:t.nonce;if(!n)throw new vn(yn.MissingPaymentToken);return Promise.resolve(n)}extraPaymentData(){return Promise.resolve(void 0)}getMerchantInfo(){const{googleMerchantName:e,googleMerchantId:t,platformToken:n}=this.getGooglePayInitializationData();return{merchantName:e,merchantId:t,authJwt:n}}getTransactionInfo(){let e;if(this._isBuyNowFlow)e=this._getCurrencyCodeOrThrow();else{const{getCartOrThrow:t}=this._paymentIntegrationService.getState();e=t().currency.code}const t=this.getGooglePayInitializationData().storeCountry;return Object.assign(Object.assign({},t&&{countryCode:t}),{currencyCode:e,totalPriceStatus:no.ESTIMATED,totalPrice:"0"})}getPaymentGatewayParameters(){const e=this.getGooglePayInitializationData().gatewayMerchantId;if(!e)throw new xn("Unable to proceed, gatewayMerchantId is missing.");return{gateway:this._gatewayIdentifier,gatewayMerchantId:e}}getCardParameters(){return{allowedAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],allowedCardNetworks:this.getPaymentMethod().supportedCards.filter(so).map((e=>io[e])),billingAddressRequired:!0,billingAddressParameters:{format:"FULL",phoneNumberRequired:!0}}}initialize(e,t,n){return this._getPaymentMethodFn=e,this._isBuyNowFlow=Boolean(t),this._currencyCode=n,this._isBuyNowFlow&&this._getCurrencyCodeOrThrow(),Promise.resolve()}handleShippingAddressChange(e){var t,n,i,r;return lo(this,void 0,void 0,(function*(){e&&(e.name=e.name||"",e.address1=e.address1||"");const o=this.mapToShippingAddressRequestBody({shippingAddress:e});o&&(yield this._paymentIntegrationService.updateShippingAddress(o));const a=this._paymentIntegrationService.getState(),s=a.getConsignments();if(!(null==s?void 0:s[0]))return;const d=s[0],c=a.getStoreConfigOrThrow();this._currencyService||(this._currencyService=new Qr(c));const l=(d.availableShippingOptions||[]).map(this._getGooglePayShippingOption.bind(this)),u=null===(t=d.availableShippingOptions)||void 0===t?void 0:t.find((e=>e.isRecommended));if(l.length){const e=(null===(n=d.selectedShippingOption)||void 0===n?void 0:n.id)||(null==u?void 0:u.id)||(null===(i=l[0])||void 0===i?void 0:i.id);return!(null===(r=d.selectedShippingOption)||void 0===r?void 0:r.id)&&l[0]&&(yield this.handleShippingOptionChange((null==u?void 0:u.id)||l[0].id)),{defaultSelectedOptionId:e,shippingOptions:l}}}))}handleShippingOptionChange(e){return lo(this,void 0,void 0,(function*(){if("shipping_option_unselected"!==e)return this._paymentIntegrationService.selectShippingOption(e)}))}getTotalPrice(){const{getCheckoutOrThrow:e,getCartOrThrow:t}=this._paymentIntegrationService.getState(),{decimalPlaces:n}=t().currency;return(0,c.round)(e().outstandingBalance,n).toFixed(n)}handleCoupons(e){return lo(this,void 0,void 0,(function*(){const{redemptionCodes:t=[]}=e,{offers:n}=this.getAppliedCoupons();let i;return yield t.reduce(((e,t)=>lo(this,void 0,void 0,(function*(){if(yield e,n.some((({redemptionCode:e})=>e===t)))return;const r=yield this.applyCoupon(t);r&&(i=r)}))),Promise.resolve()),yield n.reduce(((e,n)=>lo(this,void 0,void 0,(function*(){yield e,t.includes(n.redemptionCode)||(yield this._paymentIntegrationService.removeCoupon(n.redemptionCode))}))),Promise.resolve()),{newOfferInfo:this.getAppliedCoupons(),error:i}}))}getAppliedCoupons(){const e=this._paymentIntegrationService.getState(),{coupons:t}=e.getCheckout()||{};return{offers:(t||[]).map((e=>{const{displayName:t,code:n}=e;return{redemptionCode:n,description:t}}))}}applyCoupon(e){return lo(this,void 0,void 0,(function*(){let t;try{yield this._paymentIntegrationService.applyCoupon(e)}catch(e){return e instanceof Error&&(t={reason:oo.OFFER_INVALID,message:e.message,intent:ao.OFFER}),t}}))}getGooglePayInitializationData(){return bn(this.getPaymentMethod().initializationData,(()=>new xn("Missing initialization data.")))}getPaymentMethod(){return bn(this._getPaymentMethodFn,(()=>new Sn(gn.PaymentNotInitialized)))()}getGatewayIdentifier(){return this._gatewayIdentifier}setGatewayIdentifier(e){this._gatewayIdentifier=e||this.getGatewayIdentifier()}_isShippingAddressRequired(){const{getCartOrThrow:e,getStoreConfig:t,getShippingAddress:n}=this._paymentIntegrationService.getState();return void 0===n()&&Jr(e(),t())}_mapToAddressRequestBody(e,t,n,i){const{name:r,address1:o,address2:a,address3:s,locality:d,administrativeArea:c,countryCode:l,postalCode:u,phoneNumber:h}=e,[m,p]=this._getFirstAndLastName(r);return{firstName:m,lastName:p,company:t,address1:o,address2:`${a} ${s}`.trim(),city:d||c,stateOrProvince:c,stateOrProvinceCode:c,countryCode:l,postalCode:u,phone:h||n,customFields:i||[]}}_getFirstAndLastName(e){const t=e.split(" ");return 1===t.length?[e,""]:[t.slice(0,-1).join(" "),t[t.length-1]]}_getCurrencyCodeOrThrow(){return bn(this._currencyCode,(()=>new xn('Unable to initialize payment because "options.currencyCode" argument is not provided.')))}_getGooglePayShippingOption({id:e,cost:t,description:n,additionalDescription:i}){var r;const o=null===(r=this._currencyService)||void 0===r?void 0:r.toCustomerCurrency(t);return this._paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features["PI-3540.googlepay_new_shipping_options_description"]?{id:e,label:`${o||t} ${n}`,description:i}:{id:e,label:n,description:o||t}}}function ho(e){return"object"==typeof e&&null!==e&&"statusCode"in e}function mo(e){return Object.values(co).includes(e)}!function(e){e.ADYEN_V2="googlepayadyenv2",e.ADYEN_V3="googlepayadyenv3",e.AUTHORIZE_NET="googlepayauthorizenet",e.BNZ="googlepaybnz",e.BRAINTREE="googlepaybraintree",e.PAYPAL_COMMERCE="googlepaypaypalcommerce",e.BIGCOMMERCE_PAYMENTS="googlepay_bigcommerce_payments",e.CHECKOUT_COM="googlepaycheckoutcom",e.CYBERSOURCE_V2="googlepaycybersourcev2",e.ORBITAL="googlepayorbital",e.STRIPE="googlepaystripe",e.STRIPE_UPE="googlepaystripeupe",e.STRIPE_OCS="googlepaystripeocs",e.WORLDPAY_ACCESS="googlepayworldpayaccess",e.TD_ONLINE_MART="googlepaytdonlinemart"}(co||(co={}));var po=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class yo{constructor(e,t){this._paymentIntegrationService=e,this._googlePayPaymentProcessor=t}initialize(e){var t;return po(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.methodId)||!mo(e.methodId))throw new xn('Unable to proceed because "methodId" is not a valid key.');this._methodId=e.methodId;const n=e[this._getMethodId()];if(!n)throw new xn("Unable to proceed without valid options.");let i,r=this._paymentIntegrationService.getState();try{i=r.getPaymentMethodOrThrow(this._getMethodId())}catch(e){r=yield this._paymentIntegrationService.loadPaymentMethod(this._getMethodId()),i=r.getPaymentMethodOrThrow(this._getMethodId())}try{yield this._googlePayPaymentProcessor.initialize((()=>i),this._getGooglePayClientOptions(null===(t=i.initializationData)||void 0===t?void 0:t.storeCountry))}catch(e){return}this._addPaymentButton(n)}))}signIn(){return Promise.reject(new Dn('In order to sign in via Google Pay, the shopper must click on "Google Pay" button.'))}signOut(){var e;return po(this,void 0,void 0,(function*(){const t=null===(e=this._paymentIntegrationService.getState().getPaymentId())||void 0===e?void 0:e.providerId;t&&(yield this._googlePayPaymentProcessor.signOut(t))}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}deinitialize(){var e;return null===(e=this._paymentButton)||void 0===e||e.remove(),this._paymentButton=void 0,this._methodId=void 0,Promise.resolve()}_getGooglePayClientOptions(e){return{paymentDataCallbacks:{onPaymentDataChanged:({callbackTrigger:t,shippingAddress:n,shippingOptionData:i,offerData:r})=>po(this,void 0,void 0,(function*(){const{availableTriggers:o,addressChangeTriggers:a,shippingOptionsChangeTriggers:s,offerChangeTriggers:d}=this._googlePayPaymentProcessor.getCallbackTriggers();if(!o.includes(t))return;const c=a.includes(t)?yield this._googlePayPaymentProcessor.handleShippingAddressChange(n):void 0;s.includes(t)&&(yield this._googlePayPaymentProcessor.handleShippingOptionChange(i.id));const{newOfferInfo:l,error:u}=d.includes(t)?yield this._googlePayPaymentProcessor.handleCoupons(r):{},h=u;yield this._paymentIntegrationService.loadCheckout();const m=this._googlePayPaymentProcessor.getTotalPrice(),{code:p}=this._paymentIntegrationService.getState().getCartOrThrow().currency;return Object.assign(Object.assign(Object.assign({newTransactionInfo:Object.assign(Object.assign({},e&&{countryCode:e}),{currencyCode:p,totalPriceStatus:no.FINAL,totalPrice:m})},c&&{newShippingOptionParameters:c}),l&&{newOfferInfo:l}),h&&{error:h})}))}}}_addPaymentButton({container:e,buttonColor:t,buttonType:n,onClick:i,onError:r}){var o;this._paymentButton=null!==(o=this._paymentButton)&&void 0!==o?o:this._googlePayPaymentProcessor.addPaymentButton(e,{buttonColor:null!=t?t:"default",buttonType:null!=n?n:"plain",onClick:this._handleClick(r,i)})}_handleClick(e,t){return n=>po(this,void 0,void 0,(function*(){n.preventDefault(),t&&"function"==typeof t&&t();try{yield this._googlePayPaymentProcessor.initializeWidget(),yield this._interactWithPaymentSheet()}catch(t){let n=t;if(ho(t)){if("CANCELED"===t.statusCode)throw new ai;n=new ur(JSON.stringify(t))}throw null==e||e(new ur("An error occurred while requesting your Google Pay payment details.")),n}}))}_interactWithPaymentSheet(){return po(this,void 0,void 0,(function*(){const e=yield this._googlePayPaymentProcessor.showPaymentSheet(),t=this._googlePayPaymentProcessor.mapToBillingAddressRequestBody(e),n=this._googlePayPaymentProcessor.mapToShippingAddressRequestBody(e),i="/embedded-checkout"===window.location.pathname?this._paymentIntegrationService.getState().getStoreConfigOrThrow().links.siteLink:void 0;t&&(yield this._paymentIntegrationService.updateBillingAddress(t)),n&&(yield this._paymentIntegrationService.updateShippingAddress(n)),yield this._googlePayPaymentProcessor.setExternalCheckoutForm(this._getMethodId(),e,i)}))}_getMethodId(){return bn(this._methodId,(()=>new Sn(gn.PaymentNotInitialized)))}}var go=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class vo{constructor(e,t,n,i){this._scriptLoader=e,this._gateway=t,this._requestSender=n,this._formPoster=i,this._baseRequest={apiVersion:2,apiVersionMinor:0}}initialize(e,t,n,i){return go(this,void 0,void 0,(function*(){this._paymentsClient=yield this._scriptLoader.getGooglePaymentsClient(e().config.testMode,t),yield this._gateway.initialize(e,n,i),this._buildButtonPayloads()}))}initializeWidget(){return go(this,void 0,void 0,(function*(){yield this._buildWidgetPayloads(),yield this._determineReadinessToPay(),this._prefetchGooglePaymentData()}))}getNonce(e){return this._gateway.getNonce(e)}extraPaymentData(){return go(this,void 0,void 0,(function*(){return this._gateway.extraPaymentData()}))}addPaymentButton(e,t){const n=document.querySelector(`#${e}`);if(!n)return;const i=this._getPaymentsClient().createButton(Object.assign(Object.assign({},t),{allowedPaymentMethods:[this._getBaseCardPaymentMethod()]}));return n.appendChild(i)}showPaymentSheet(){return go(this,void 0,void 0,(function*(){const e=this._getPaymentDataRequest();return this._getPaymentsClient().loadPaymentData(e)}))}setExternalCheckoutXhr(e,t){return go(this,void 0,void 0,(function*(){return this._setExternalCheckout(e,t)}))}setExternalCheckoutForm(e,t,n){return go(this,void 0,void 0,(function*(){return this._setExternalCheckout(e,t,!0,n)}))}mapToBillingAddressRequestBody(e){return this._gateway.mapToBillingAddressRequestBody(e)}mapToShippingAddressRequestBody(e){return this._gateway.mapToShippingAddressRequestBody(e)}processAdditionalAction(e,t){return"processAdditionalAction"in this._gateway?this._gateway.processAdditionalAction(e,t):Promise.reject(e)}signOut(e){return go(this,void 0,void 0,(function*(){yield this._requestSender.get(`/remote-checkout/${e}/signout`)}))}getCallbackTriggers(){return this._gateway.getCallbackTriggers()}handleShippingAddressChange(e){return go(this,void 0,void 0,(function*(){return this._gateway.handleShippingAddressChange(e)}))}handleShippingOptionChange(e){return go(this,void 0,void 0,(function*(){yield this._gateway.handleShippingOptionChange(e)}))}handleCoupons(e){return go(this,void 0,void 0,(function*(){return this._gateway.handleCoupons(e)}))}getTotalPrice(){return this._gateway.getTotalPrice()}_setExternalCheckout(e,t,n=!1,i){return go(this,void 0,void 0,(function*(){const r="/checkout.php",o=Object.assign({action:"set_external_checkout",provider:e},yield this._gateway.mapToExternalCheckoutData(t));if(n)return new Promise((e=>{this._formPoster.postForm(i?`${i}/checkout`:r,Object.assign(Object.assign({},o),{card_information:JSON.stringify(o.card_information)}),e)}));yield this._requestSender.post(r,{headers:Object.assign({Accept:"text/html","Content-Type":"application/x-www-form-urlencoded"},ki),body:o})}))}_prefetchGooglePaymentData(){const e=this._getPaymentDataRequest();e.transactionInfo=this._gateway.getTransactionInfo(),this._getPaymentsClient().prefetchPaymentData(e)}_determineReadinessToPay(){return go(this,void 0,void 0,(function*(){try{const{result:e}=yield this._getPaymentsClient().isReadyToPay(this._getIsReadyToPayRequest());if(!1===e)throw new ur("Google Pay is not supported by the current device and browser, please try another payment method.")}catch(e){if(e instanceof ur)throw e;throw new ur}}))}_buildButtonPayloads(){this._baseCardPaymentMethod={type:"CARD",parameters:this._gateway.getCardParameters()}}_buildWidgetPayloads(){return go(this,void 0,void 0,(function*(){const e=this._getBaseCardPaymentMethod();this._cardPaymentMethod=Object.assign(Object.assign({},e),{tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:yield this._gateway.getPaymentGatewayParameters()}}),this._paymentDataRequest=Object.assign(Object.assign(Object.assign(Object.assign({},this._baseRequest),{allowedPaymentMethods:[this._cardPaymentMethod],transactionInfo:this._gateway.getTransactionInfo(),merchantInfo:this._gateway.getMerchantInfo()}),yield this._gateway.getRequiredData()),{callbackIntents:this._gateway.getCallbackIntents(),offerInfo:this._gateway.getAppliedCoupons()}),this._isReadyToPayRequest=Object.assign(Object.assign({},this._baseRequest),{allowedPaymentMethods:[e]})}))}_getBaseCardPaymentMethod(){return this._getOrThrow(this._baseCardPaymentMethod)}_getPaymentDataRequest(){return this._getOrThrow(this._paymentDataRequest)}_getIsReadyToPayRequest(){return this._getOrThrow(this._isReadyToPayRequest)}_getPaymentsClient(){return this._getOrThrow(this._paymentsClient)}_getOrThrow(e){return bn(e,(()=>new Sn(gn.PaymentNotInitialized)))}}class fo{constructor(e){this._scriptLoader=e,this._window=window}getGooglePaymentsClient(e=!1,t){return n=this,r=function*(){if(yield this._scriptLoader.loadScript("https://pay.google.com/gp/p/js/pay.js"),!this._window.google)throw new Tn;return void 0===this._paymentsClient&&(this._paymentsClient=new this._window.google.payments.api.PaymentsClient(Object.assign({environment:e?"TEST":"PRODUCTION"},null!=t?t:{}))),this._paymentsClient},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}}function bo(){return new fo((0,s.vQ)())}const So=Ge((e=>{const t=(0,a.createRequestSender)();return new yo(e,new vo(bo(),new uo("adyen",e),t,(0,N.createFormPoster)()))}),[{id:"googlepayadyenv2"}]),Co=Ge((e=>{const t=(0,a.createRequestSender)();return new yo(e,new vo(bo(),new uo("adyen",e),t,(0,N.createFormPoster)()))}),[{id:"googlepayadyenv3"}]);class wo extends uo{constructor(e){super("authorizenet",e)}mapToExternalCheckoutData(e){const t=Object.create(null,{mapToExternalCheckoutData:{get:()=>super.mapToExternalCheckoutData}});return n=this,r=function*(){const n=yield t.mapToExternalCheckoutData.call(this,e);return n.nonce=btoa(n.nonce),n},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}getPaymentGatewayParameters(){const e=this.getGooglePayInitializationData();return function(e){if(!function(e){return"paymentGatewayId"in e}(e))throw new vn(yn.MissingPaymentMethod)}(e),{gateway:this.getGatewayIdentifier(),gatewayMerchantId:e.paymentGatewayId}}}const _o=Ge((e=>new yo(e,new vo(bo(),new wo(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayauthorizenet"}]),Io=e=>"object"==typeof e&&null!==e&&"body"in e;function Po(e){if(!function(e){return"checkoutcomkey"in e}(e))throw new vn(yn.MissingPaymentMethod)}var Eo=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Oo extends uo{constructor(e,t){super("checkoutltd",e),this._requestSender=t}processAdditionalAction(e){return new Promise(((t,n)=>{if(Io(e)&&function(e){var t;if("object"!=typeof e||null===e)return!1;const n=e;return"string"==typeof(null===(t=n.three_ds_result)||void 0===t?void 0:t.acs_url)&&"string"==typeof n.three_ds_result.code}(e.body)&&"three_d_secure_required"===e.body.three_ds_result.code)return window.location.assign(e.body.three_ds_result.acs_url);n(e)}))}mapToExternalCheckoutData(e){const t=Object.create(null,{mapToExternalCheckoutData:{get:()=>super.mapToExternalCheckoutData}});return Eo(this,void 0,void 0,(function*(){const n=yield t.mapToExternalCheckoutData.call(this,e);let i;try{i=JSON.parse(n.nonce)}catch(e){throw new xn("Unable to parse response from Google Pay.")}return function(e){if(!function(e){return"object"==typeof e&&null!==e&&"protocolVersion"in e&&"signature"in e&&"signedMessage"in e}(e))throw new vn(yn.MissingPaymentToken)}(i),n.nonce=yield this._tokenize(i),n}))}getPaymentGatewayParameters(){const e=this.getGooglePayInitializationData();return Po(e),{gateway:this.getGatewayIdentifier(),gatewayMerchantId:e.checkoutcomkey}}_tokenize(e){return Eo(this,void 0,void 0,(function*(){const t=this.getPaymentMethod().config.testMode?"https://api.sandbox.checkout.com/tokens":"https://api.checkout.com/tokens",n=this.getGooglePayInitializationData();Po(n);const{body:i}=yield this._requestSender.post(t,{credentials:!1,body:{type:"googlepay",token_data:e},headers:{Authorization:n.checkoutcomkey,"Content-Type":Ai.Json,"X-XSRF-TOKEN":null}});return i.token}))}}const Ao=Ge((e=>{const t=(0,a.createRequestSender)();return new yo(e,new vo(bo(),new Oo(e,t),t,(0,N.createFormPoster)()))}),[{id:"googlepaycheckoutcom"}]);class ko extends uo{constructor(e){super("cybersource",e)}mapToExternalCheckoutData(e){const t=Object.create(null,{mapToExternalCheckoutData:{get:()=>super.mapToExternalCheckoutData}});return n=this,r=function*(){const n=yield t.mapToExternalCheckoutData.call(this,e);return n.nonce=btoa(n.nonce),n},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}}const To=Ge((e=>new yo(e,new vo(bo(),new ko(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaycybersourcev2"}]),No=Ge((e=>new yo(e,new vo(bo(),new ko(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaybnz"}]);class Mo extends uo{constructor(e){super("chase",e)}mapToExternalCheckoutData(e){const t=Object.create(null,{mapToExternalCheckoutData:{get:()=>super.mapToExternalCheckoutData}});return n=this,r=function*(){const n=yield t.mapToExternalCheckoutData.call(this,e);return n.nonce=btoa(n.nonce),n},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}}const xo=Ge((e=>new yo(e,new vo(bo(),new Mo(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayorbital"}]);function Do(e){if(!function(e){return"stripeConnectedAccount"in e&&"stripePublishableKey"in e&&"stripeVersion"in e}(e))throw new vn(yn.MissingPaymentMethod)}var zo=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Fo extends uo{constructor(e,t){super("stripe",e),this.paymentIntegrationService=e,this.scriptLoader=t}mapToExternalCheckoutData(e){const t=Object.create(null,{mapToExternalCheckoutData:{get:()=>super.mapToExternalCheckoutData}});return zo(this,void 0,void 0,(function*(){const n=yield t.mapToExternalCheckoutData.call(this,e);let i;try{i=JSON.parse(n.nonce)}catch(e){throw new xn("Unable to parse response from Google Pay.")}return function(e){if(!function(e){return"object"==typeof e&&null!==e&&"id"in e}(e))throw new vn(yn.MissingPaymentToken)}(i),n.nonce=i.id,n}))}getPaymentGatewayParameters(){const e=this.getGooglePayInitializationData();Do(e);const{stripeVersion:t,stripePublishableKey:n,stripeConnectedAccount:i}=e;return{gateway:this.getGatewayIdentifier(),"stripe:version":t,"stripe:publishableKey":`${n}/${i}`}}processAdditionalAction(e,t){var n,i;return zo(this,void 0,void 0,(function*(){if(!t)throw new Cr(["payment"]);if(!Io(e)||"object"!=typeof(r=e.body)||null===r||!("three_ds_result"in r)||!("errors"in r))throw e;var r;const o=this.paymentIntegrationService.getState(),a=null===(n=o.getStoreConfig())||void 0===n?void 0:n.checkoutSettings.features["STRIPE-476.enable_stripe_googlepay_3ds"];if((0,c.some)(e.body.errors,{code:"three_d_secure_required"})&&a){const n=this.getGooglePayInitializationData();Do(n);const{stripePublishableKey:r,stripeConnectedAccount:o}=n;this.stripeUPEClient=yield this.loadStripeJs(r,o);const a=e.body.three_ds_result.token;let s,d=!1;try{s=yield this.stripeUPEClient.confirmCardPayment(a)}catch(e){try{s=yield this.stripeUPEClient.retrievePaymentIntent(a)}catch(e){d=!0}}if(null==s?void 0:s.error){if(this._throwDisplayableStripeError(s.error),this._isCancellationError(s.error))throw new ai;throw new ur}if(!(null==s?void 0:s.paymentIntent)&&!d)throw new gi;return this.paymentIntegrationService.submitPayment({methodId:t,paymentData:{nonce:(null===(i=null==s?void 0:s.paymentIntent)||void 0===i?void 0:i.id)||a}})}throw e}))}loadStripeJs(e,t){return zo(this,void 0,void 0,(function*(){return this.stripeUPEClient?this.stripeUPEClient:this.scriptLoader.getStripeClient(e,t)}))}_isCancellationError(e){var t,n;return e&&-1!==(null===(n=null===(t=e.payment_intent.last_payment_error)||void 0===t?void 0:t.message)||void 0===n?void 0:n.indexOf("canceled"))}_throwDisplayableStripeError(e){if((0,c.includes)(["card_error","invalid_request_error","validation_error"],e.type))throw new Error(e.message)}}var Bo=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ro{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}getStripeClient(e,t,n){return Bo(this,void 0,void 0,(function*(){let i=this.stripeWindow.bcStripeClient;return i||(i=(yield this.load())(e,{stripeAccount:t,locale:n,betas:["payment_element_beta_2","alipay_pm_beta_1","link_default_integration_beta_1","shipping_address_element_beta_1","address_element_beta_1"],apiVersion:"2020-03-02;alipay_beta=v1;link_beta=v1"}),Object.assign(this.stripeWindow,{bcStripeClient:i})),i}))}load(){return Bo(this,void 0,void 0,(function*(){if(this.stripeWindow.Stripe||(yield this.scriptLoader.loadScript("https://js.stripe.com/v3/")),!this.stripeWindow.Stripe)throw new Tn;return this.stripeWindow.Stripe}))}}const Lo=Ge((e=>new yo(e,new vo(bo(),new Fo(e,new Ro((0,s.vQ)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaystripe"},{id:"googlepaystripeocs"}]),jo=Ge((e=>new yo(e,new vo(bo(),new Fo(e,new Ro((0,s.vQ)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaystripeupe"}]);class Uo extends uo{constructor(e){super("worldpay",e)}mapToExternalCheckoutData(e){const t=Object.create(null,{mapToExternalCheckoutData:{get:()=>super.mapToExternalCheckoutData}});return n=this,r=function*(){const n=yield t.mapToExternalCheckoutData.call(this,e);return n.nonce=btoa(n.nonce),n},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}}const Vo=Ge((e=>new yo(e,new vo(bo(),new Uo(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayworldpayaccess"}]);var qo=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ho extends uo{constructor(e,t){super("braintree",e),this._braintreeSdk=t,this._methodId=co.BRAINTREE,this._service=e}initialize(e,t,n){const i=Object.create(null,{initialize:{get:()=>super.initialize},getPaymentMethod:{get:()=>super.getPaymentMethod}});return qo(this,void 0,void 0,(function*(){yield i.initialize.call(this,e,t,n);let r=i.getPaymentMethod.call(this);if(r.clientToken||(r=(yield this._service.loadPaymentMethod(this._methodId)).getPaymentMethodOrThrow(this._methodId)),!r.clientToken||!r.initializationData)throw new vn(yn.MissingPaymentMethod);return this._braintreeSdk.initialize(r.clientToken),this._braintreeGooglePayment=yield this._braintreeSdk.getBraintreeGooglePayment(),Promise.resolve()}))}getNonce(e){const t=Object.create(null,{getNonce:{get:()=>super.getNonce},getPaymentMethod:{get:()=>super.getPaymentMethod}});var n;return qo(this,void 0,void 0,(function*(){const i=yield t.getNonce.call(this,e),{clientToken:r,initializationData:o}=t.getPaymentMethod.call(this);if(!r||!o||!(null===(n=o.card_information)||void 0===n?void 0:n.bin))throw new vn(yn.MissingPaymentMethod);const{isThreeDSecureEnabled:a,card_information:{bin:s,isNetworkTokenized:d}}=o;if(a&&!d){const e=yield this._braintreeSdk.getBraintreeThreeDS(),{orderAmount:t}=this._service.getState().getOrderOrThrow();return(yield this._braintreePresent3DSChallenge(e,t,i,s)).nonce}return i}))}extraPaymentData(){return qo(this,void 0,void 0,(function*(){return{deviceSessionId:yield this._getBraintreeDeviceData()}}))}mapToExternalCheckoutData(e){const t=Object.create(null,{mapToExternalCheckoutData:{get:()=>super.mapToExternalCheckoutData}});return qo(this,void 0,void 0,(function*(){const n=yield t.mapToExternalCheckoutData.call(this,e);let i;try{i=JSON.parse(n.nonce)}catch(e){throw new xn("Unable to parse response from Google Pay.")}return function(e){if(!function(e){return"object"==typeof e&&null!==e&&"androidPayCards"in e}(e))throw new vn(yn.MissingPaymentToken)}(i),n.nonce=i.androidPayCards[0].nonce,n.card_information.bin=i.androidPayCards[0].details.bin,n.card_information.isNetworkTokenized=i.androidPayCards[0].details.isNetworkTokenized,n}))}getCardParameters(){return super.getCardParameters()}getPaymentGatewayParameters(){const e=Object.create(null,{getMerchantInfo:{get:()=>super.getMerchantInfo},getTransactionInfo:{get:()=>super.getTransactionInfo},getRequiredData:{get:()=>super.getRequiredData}});return qo(this,void 0,void 0,(function*(){return this.getBraintreeGooglePayment().createPaymentDataRequest(Object.assign({merchantInfo:e.getMerchantInfo.call(this),transactionInfo:e.getTransactionInfo.call(this),cardRequirements:{billingAddressRequired:!0,billingAddressFormat:"FULL"}},yield e.getRequiredData.call(this))).paymentMethodTokenizationParameters.parameters}))}getBraintreeGooglePayment(){if(!this._braintreeGooglePayment)throw new vn(yn.MissingPaymentMethod);return this._braintreeGooglePayment}_getBraintreeDeviceData(){return qo(this,void 0,void 0,(function*(){const{deviceData:e}=yield this._braintreeSdk.getDataCollectorOrThrow();return e}))}_braintreePresent3DSChallenge(e,t,n,i){return new qt(e.verifyCard({amount:t,bin:i,nonce:n,onLookupComplete:(e,t)=>{t()}})).promise}}const Go=Ge((e=>{const t=(0,a.createRequestSender)(),n=window,i=new Un(e),r=new ti(new oi((0,s.vQ)(),n,i));return new yo(e,new vo(bo(),new Ho(e,r),t,(0,N.createFormPoster)()))}),[{id:"googlepaybraintree"}]);var $o=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Wo{constructor(e){this.scriptLoader=e,this.window=window}getPayPalFastlaneSdk(e,t,n){return $o(this,void 0,void 0,(function*(){if(!this.window.paypalFastlaneSdk){const i=this.getPayPalFastlaneSdkConfiguration(e,t,n);if(yield this.loadPayPalSdk(i),!this.window.paypalFastlaneSdk)throw new Tn}return this.window.paypalFastlaneSdk}))}getPayPalGooglePaySdk(e,t,n,i){return $o(this,void 0,void 0,(function*(){if(!this.window.paypalGooglePay||i){const i=this.getPayPalGooglePaySdkScriptConfigOrThrow(e,t,n);yield this.loadPayPalSdk(i)}if(!this.window.paypalGooglePay)throw new Tn;return this.window.paypalGooglePay}))}getPayPalApmsSdk(e,t){return $o(this,void 0,void 0,(function*(){if(!this.window.paypalApms){const n=this.getPayPalApmSdkConfiguration(e,t);if(yield this.loadPayPalSdk(n),!this.window.paypalApms)throw new Tn}return this.window.paypalApms}))}getPayPalMessages(e,t){return $o(this,void 0,void 0,(function*(){if(!this.window.paypalMessages){const n=this.getPayPalSdkMessagesConfiguration(e,t);yield this.loadPayPalSdk(n)}if(!this.window.paypalMessages)throw new Tn;return this.window.paypalMessages}))}loadPayPalSdk({options:e,attributes:t}){return $o(this,void 0,void 0,(function*(){const n=this.transformConfig(e),i=this.transformConfig(t),r=`https://www.paypal.com/sdk/js?${new URLSearchParams(n).toString()}`;yield this.scriptLoader.loadScript(r,{async:!0,attributes:i})}))}getPayPalFastlaneSdkConfiguration(e,t,n){const{clientToken:i,initializationData:r}=e;if(!r||!r.clientId)throw new vn(yn.MissingPaymentMethod);const{intent:o,clientId:a,merchantId:s,attributionId:d}=r;return{options:{"client-id":a,"merchant-id":s,commit:!0,components:["fastlane","buttons","payment-fields","hosted-fields","three-domain-secure"],currency:t,intent:o},attributes:{"data-client-metadata-id":n.replace(/-/g,""),"data-namespace":"paypalFastlaneSdk","data-partner-attribution-id":d,"data-sdk-client-token":i}}}getPayPalGooglePaySdkScriptConfigOrThrow(e,t,n=!0){const{clientToken:i,initializationData:r}=e;if(!r||!r.clientId)throw new vn(yn.MissingPaymentMethod);const{intent:o,clientId:a,merchantId:s,buyerCountry:d,attributionId:c,isHostedCheckoutEnabled:l,isDeveloperModeApplicable:u}=r,h=l||n;return{options:Object.assign({"client-id":a,"merchant-id":s,commit:h,components:["googlepay"],currency:t,intent:o},u&&{"buyer-country":d}),attributes:{"data-partner-attribution-id":c,"data-client-token":i,"data-namespace":"paypalGooglePay"}}}getPayPalApmSdkConfiguration(e,t){const{initializationData:n}=e;if(!n||!n.clientId)throw new vn(yn.MissingPaymentMethod);const{intent:i,clientId:r,merchantId:o,buyerCountry:a,attributionId:s,isDeveloperModeApplicable:d,availableAlternativePaymentMethods:c=[],enabledAlternativePaymentMethods:l=[]}=n,u=l,h=c.filter((e=>!l.includes(e)));return{options:Object.assign({"client-id":r,"merchant-id":o,"enable-funding":u.length>0?u:void 0,"disable-funding":h.length>0?h:void 0,commit:!0,components:["buttons","payment-fields"],currency:t,intent:i},d&&{"buyer-country":a}),attributes:{"data-partner-attribution-id":s,"data-namespace":"paypalApms"}}}getPayPalSdkMessagesConfiguration(e,t){const{initializationData:n}=e;if(!n||!n.clientId)throw new vn(yn.MissingPaymentMethod);const{clientId:i,merchantId:r,attributionId:o,isDeveloperModeApplicable:a,buyerCountry:s}=n;return{options:Object.assign({"client-id":i,"merchant-id":r,components:["messages"],currency:t},a&&{"buyer-country":s}),attributes:{"data-namespace":"paypalMessages","data-partner-attribution-id":o}}}transformConfig(e){let t={};return Object.keys(e).forEach((n=>{const i=e[n];null==i||""===i||Array.isArray(i)&&0===i.length||(t=Object.assign(Object.assign({},t),{[n]:Array.isArray(i)?i.join(","):i}))})),t}}function Yo(e){if(!function(e){return!!e.initializationData&&"attributionId"in e.initializationData&&"isVenmoEnabled"in e.initializationData&&"isGooglePayEnabled"in e.initializationData&&"isPayPalCreditAvailable"in e.initializationData}(e))throw new vn(yn.MissingPaymentMethod)}var Ko=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Qo extends uo{constructor(e,t){super("paypalsb",e),this.payPalCommerceSdk=t,this.service=e}initialize(e,t,n){const i=Object.create(null,{initialize:{get:()=>super.initialize},getPaymentMethod:{get:()=>super.getPaymentMethod}});var r,o,a,s,d;return Ko(this,void 0,void 0,(function*(){const c=null!==(o=null===(r=this.service.getState().getStoreConfig())||void 0===r?void 0:r.currency.code)&&void 0!==o?o:n;if(!c)throw new vn(yn.MissingPaymentMethod);yield i.initialize.call(this,e,t,c);const l=i.getPaymentMethod.call(this);if(!l.initializationData)throw new vn(yn.MissingPaymentMethod);Yo(l);const u=yield this.payPalCommerceSdk.getPayPalGooglePaySdk(l,c);this.googlepayConfig=yield u.Googlepay().config();const{allowedPaymentMethods:h}=this.googlepayConfig;this.setGatewayIdentifier(null===(d=null===(s=null===(a=h[0])||void 0===a?void 0:a.tokenizationSpecification)||void 0===s?void 0:s.parameters)||void 0===d?void 0:d.gateway)}))}getPaymentGatewayParameters(){if(this.googlepayConfig){const{allowedPaymentMethods:e}=this.googlepayConfig,{gatewayMerchantId:t}=e[0].tokenizationSpecification.parameters;return{gateway:this.getGatewayIdentifier(),gatewayMerchantId:t}}return{gateway:this.getGatewayIdentifier()}}mapToExternalCheckoutData(e){const t=Object.create(null,{mapToExternalCheckoutData:{get:()=>super.mapToExternalCheckoutData}});return Ko(this,void 0,void 0,(function*(){const n=yield t.mapToExternalCheckoutData.call(this,e);return n.nonce=btoa(n.nonce),n}))}}const Jo=Ge((e=>new yo(e,new vo(bo(),new Qo(e,new Wo((0,s.vQ)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaypaypalcommerce"}]);var Zo=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Xo extends uo{constructor(e,t){super("googlepay_bigcommerce_payments",e),this.payPalSdkHelper=t,this.service=e}initialize(e,t,n){const i=Object.create(null,{initialize:{get:()=>super.initialize},getPaymentMethod:{get:()=>super.getPaymentMethod}});var r,o,a,s,d;return Zo(this,void 0,void 0,(function*(){const c=null!==(o=null===(r=this.service.getState().getStoreConfig())||void 0===r?void 0:r.currency.code)&&void 0!==o?o:n;if(!c)throw new vn(yn.MissingPaymentMethod);yield i.initialize.call(this,e,t,c);const l=i.getPaymentMethod.call(this);if(!l.initializationData)throw new vn(yn.MissingPaymentMethod);Yo(l);const u=yield this.payPalSdkHelper.getPayPalGooglePaySdk(l,c);this.googlepayConfig=yield u.Googlepay().config();const{allowedPaymentMethods:h}=this.googlepayConfig;this.setGatewayIdentifier(null===(d=null===(s=null===(a=h[0])||void 0===a?void 0:a.tokenizationSpecification)||void 0===s?void 0:s.parameters)||void 0===d?void 0:d.gateway)}))}getPaymentGatewayParameters(){if(this.googlepayConfig){const{allowedPaymentMethods:e}=this.googlepayConfig,{gatewayMerchantId:t}=e[0].tokenizationSpecification.parameters;return{gateway:this.getGatewayIdentifier(),gatewayMerchantId:t}}return{gateway:this.getGatewayIdentifier()}}mapToExternalCheckoutData(e){const t=Object.create(null,{mapToExternalCheckoutData:{get:()=>super.mapToExternalCheckoutData}});return Zo(this,void 0,void 0,(function*(){const n=yield t.mapToExternalCheckoutData.call(this,e);return n.nonce=btoa(n.nonce),n}))}}const ea=Ge((e=>new yo(e,new vo(bo(),new Xo(e,new Yi((0,s.vQ)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepay_bigcommerce_payments"}]);function ta(){const{navigator:e}=window;let t;return t=e.language?e.language:e.userLanguage,{color_depth:window.screen.colorDepth||24,java_enabled:"function"==typeof e.javaEnabled&&e.javaEnabled(),language:t,screen_height:window.screen.height,screen_width:window.screen.width,time_zone_offset:(new Date).getTimezoneOffset().toString()}}var na=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ia extends uo{constructor(e,t){super("worldlinena",e),this.formPoster=t}extraPaymentData(){return na(this,void 0,void 0,(function*(){return Promise.resolve({browser_info:ta()})}))}processAdditionalAction(e){return na(this,void 0,void 0,(function*(){if(!function(e){return Io(e)&&(t=e.body,(0,c.isObject)(t)&&"object"==typeof t&&"errors"in t&&"three_ds_result"in t&&(0,c.isArray)(t.errors)&&(0,c.some)(t.errors,{code:"three_d_secure_required"}));var t}(e))throw e;const{three_ds_result:t}=e.body,{acs_url:n,payer_auth_request:i,merchant_data:r}=t||{};if(!n||!i||!r)throw new Cr(["formUrl","threeDSSessionData","creq"]);return new Promise((e=>{this.formPoster.postForm(n,{threeDSSessionData:i,creq:r},e,"_top")}))}))}}const ra=Ge((e=>new yo(e,new vo(bo(),new ia(e,(0,N.createFormPoster)()),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaytdonlinemart"}]);var oa,aa,sa,da,ca,la,ua;!function(e){e.Possible="POSSIBLE",e.No="NO",e.Unknown="UNKNOWN",e.Yes="YES"}(oa||(oa={})),function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(aa||(aa={})),function(e){e.paypal="paypal",e.checkout="checkout",e.buynow="buynow",e.pay="pay",e.installment="installment"}(sa||(sa={})),function(e){e.gold="gold",e.blue="blue",e.silver="silver",e.black="black",e.white="white"}(da||(da={})),function(e){e.pill="pill",e.rect="rect"}(ca||(ca={})),(la||(la={})).OXXO="oxxo",function(e){e.Approved="APPROVED",e.Created="CREATED",e.PayerActionRequired="PAYER_ACTION_REQUIRED",e.PollingStop="POLLING_STOP",e.PollingError="POLLING_ERROR"}(ua||(ua={}));var ha=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ma{constructor(e,t,n,i){this.formPoster=e,this.paymentIntegrationService=t,this.paypalCommerceRequestSender=n,this.paypalCommerceScriptLoader=i}loadPayPalSdk(e,t,n,i){return ha(this,void 0,void 0,(function*(){const r=this.paymentIntegrationService.getState(),o=t||r.getCartOrThrow().currency.code,a=r.getPaymentMethodOrThrow(e);return this.paypalSdk=yield this.paypalCommerceScriptLoader.getPayPalSDK(a,o,n,i),this.paypalSdk}))}getPayPalSdkOrThrow(){if(!this.paypalSdk)throw new Tn;return this.paypalSdk}createBuyNowCartOrThrow(e){return ha(this,void 0,void 0,(function*(){const t=e.getBuyNowCartRequestBody();if(!t)throw new vn(yn.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(t)}catch(e){throw new pi}}))}createOrder(e,t){return ha(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getCartOrThrow().id,{orderId:i}=yield this.paypalCommerceRequestSender.createOrder(e,Object.assign({cartId:n},t));return i}))}createOrderCardFields(e,t){return ha(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getCartOrThrow().id,{orderId:i,setupToken:r}=yield this.paypalCommerceRequestSender.createOrder(e,Object.assign({cartId:n},t));return Object.assign({orderId:i},r?{setupToken:r}:{})}))}updateOrder(){return ha(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getConsignmentsOrThrow()[0];try{yield this.paypalCommerceRequestSender.updateOrder({availableShippingOptions:n.availableShippingOptions,cartId:t.id,selectedShippingOption:n.selectedShippingOption})}catch(e){throw new gi}}))}getOrderStatus(e,t){return ha(this,void 0,void 0,(function*(){try{const{status:n}=yield this.paypalCommerceRequestSender.getOrderStatus(e,t);return n}catch(e){throw new gi}}))}tokenizePayment(e,t){const n=this.paymentIntegrationService.getState().getCartOrThrow();if(!t)throw new vn(yn.MissingOrderId);return this.formPoster.postForm("/checkout.php",Object.assign({payment_type:"paypal",action:"set_external_checkout",provider:e,order_id:t},n.source===xe.BuyNow&&{cart_id:n.id}))}submitPayment(e,t,n){return ha(this,void 0,void 0,(function*(){const i={formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:null,method_id:e,paypal_account:{order_id:t}}};yield this.paymentIntegrationService.submitPayment(Object.assign({methodId:e,paymentData:i},n?{gatewayId:n}:{}))}))}getShippingOptionOrThrow(e){const t=this.paymentIntegrationService.getState().getConsignmentsOrThrow()[0],n=t.availableShippingOptions||[],i=n.find((e=>e.isRecommended)),r=(e?n.find((t=>t.id===e)):n.find((e=>{var n;return e.id===(null===(n=t.selectedShippingOption)||void 0===n?void 0:n.id)})))||i||n[0];if(!r)throw new Error("Your order can't be shipped to this address");return r}getAddress(e){return{firstName:(null==e?void 0:e.firstName)||"",lastName:(null==e?void 0:e.lastName)||"",email:(null==e?void 0:e.email)||"",phone:(null==e?void 0:e.phone)||"",company:"",address1:(null==e?void 0:e.address1)||"",address2:(null==e?void 0:e.address2)||"",city:(null==e?void 0:e.city)||"",countryCode:(null==e?void 0:e.countryCode)||"",postalCode:(null==e?void 0:e.postalCode)||"",stateOrProvince:"",stateOrProvinceCode:(null==e?void 0:e.stateOrProvinceCode)||"",customFields:[]}}getBillingAddressFromOrderDetails({payer:e}){var t,n;return this.getAddress({firstName:e.name.given_name,lastName:e.name.surname,email:e.email_address,address1:e.address.address_line_1,address2:e.address.address_line_2,city:e.address.admin_area_2,countryCode:e.address.country_code,postalCode:e.address.postal_code,stateOrProvinceCode:e.address.admin_area_1,phone:null===(n=null===(t=e.phone)||void 0===t?void 0:t.phone_number)||void 0===n?void 0:n.national_number})}getShippingAddressFromOrderDetails(e){const{payer:t,purchase_units:n}=e,{address:i,name:{full_name:r}}=n[0].shipping,[o,...a]=r.split(" ");return this.getAddress({firstName:o,lastName:a.join(" "),email:t.email_address,address1:i.address_line_1,address2:i.address_line_2,city:i.admin_area_2,countryCode:i.country_code,postalCode:i.postal_code,stateOrProvinceCode:i.admin_area_1})}getValidButtonStyle(e){const{color:t,height:n,label:i,shape:r}=e||{},o={color:t&&da[t]?t:void 0,height:this.getValidHeight(n),label:i&&sa[i]?i:void 0,shape:r&&ca[r]?r:void 0};return(0,c.omitBy)(o,c.isNil)}getValidHeight(e){return e&&"number"==typeof e?e>55?55:e<25?25:e:40}removeElement(e){const t=e&&document.getElementById(e);t&&(t.style.display="none")}}var pa=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ya{constructor(e){this.requestSender=e}createOrder(e,t){return pa(this,void 0,void 0,(function*(){const n=`/api/storefront/payment/${e}`,i=t,r=Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki);return(yield this.requestSender.post(n,{headers:r,body:i})).body}))}updateOrder(e){return pa(this,void 0,void 0,(function*(){const t=e,n=Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki);return(yield this.requestSender.put("/api/storefront/initialization/paypalcommerce",{headers:n,body:t})).body}))}getOrderStatus(e="paypalcommerce",t){return pa(this,void 0,void 0,(function*(){const n=`/api/storefront/initialization/${e}`,i=Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki);return(yield this.requestSender.get(n,Object.assign({headers:i},t))).body}))}}var ga=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class va{constructor(e){this.scriptLoader=e,this.window=window}getPayPalSDK(e,t,n,i){return ga(this,void 0,void 0,(function*(){const r=this.getPayPalSdkScriptConfigOrThrow(e,t,n);return this.loadPayPalSDK(r,i)}))}loadPayPalSDK(e,t=!1){return ga(this,void 0,void 0,(function*(){if(!this.window.paypal||t){const t=this.transformConfig(e.options),n=this.transformConfig(e.attributes),i=`https://www.paypal.com/sdk/js?${new URLSearchParams(t).toString()}`;yield this.scriptLoader.loadScript(i,{async:!0,attributes:n})}if(!this.window.paypal)throw new Tn;return this.window.paypal}))}getPayPalSdkScriptConfigOrThrow(e,t,n=!0){const{id:i,clientToken:r,initializationData:o}=e;if(!(null==o?void 0:o.clientId))throw new vn(yn.MissingPaymentMethod);const{intent:a,clientId:s,merchantId:d,buyerCountry:c,attributionId:l,isVenmoEnabled:u,isHostedCheckoutEnabled:h,isPayPalCreditAvailable:m,isDeveloperModeApplicable:p,availableAlternativePaymentMethods:y=[],enabledAlternativePaymentMethods:g=[],isGooglePayEnabled:v}=o,f=h||n,b="paypalcommercecreditcards"===i,S=b?["card"]:[],C=m?["credit","paylater"]:[],w=n||!f,_=u?["venmo"]:[],I=w?g:[],P=v?["googlepay"]:[],E=n?["card-fields"]:[],O=[...b?[]:["card"],...m?[]:["credit","paylater"],...u?[]:["venmo"],...w?y.filter((e=>!g.includes(e))):y],A=[...S,...C,..._,...I];return{options:Object.assign({"client-id":s,"merchant-id":d,"enable-funding":A.length>0?A:void 0,"disable-funding":O.length>0?O:void 0,commit:f,components:["buttons","hosted-fields","payment-fields","legal",...P,...E],currency:t,intent:a},p&&{"buyer-country":c}),attributes:{"data-partner-attribution-id":l,"data-client-token":r}}}transformConfig(e){let t={};return Object.keys(e).forEach((n=>{const i=e[n];null==i||""===i||Array.isArray(i)&&0===i.length||(t=Object.assign(Object.assign({},t),{[n]:Array.isArray(i)?i.join(","):i}))})),t}}const fa=e=>{const{getHost:t}=e.getState();return new ma((0,N.createFormPoster)(),e,new ya((0,a.createRequestSender)({host:t()})),new va((0,s.vQ)()))};var ba=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Sa{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.onError=c.noop}initialize(e){return ba(this,void 0,void 0,(function*(){const{paypalcommerce:t,methodId:n}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.paypalcommerce" argument is not provided.');if(!t.container)throw new xn('Unable to initialize payment because "options.paypalcommerce.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new xn('Unable to initialize payment because "options.paypalcommerce.onClick" argument is not a function.');this.onError=t.onError||c.noop,this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.paypalCommerceIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC PayPal]: PayPal Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return ba(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}))}signOut(e){return ba(this,void 0,void 0,(function*(){return yield this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){var n,i;const{container:r,onClick:o,onComplete:a}=t,s=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),d=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{isHostedCheckoutEnabled:c,paymentButtonStyles:l,isAppSwitchEnabled:u}=d.initializationData||{},{checkoutTopButtonStyles:h}=l||{},m=Object.assign(Object.assign(Object.assign({},this.isPaypalCommerceAppSwitchEnabled(e)&&{appSwitchWhenAvailable:!0}),{createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommerce"),onApprove:({orderID:t})=>this.paypalCommerceIntegrationService.tokenizePayment(e,t)}),o&&{onClick:()=>o()}),p=Object.assign(Object.assign({},!u&&{onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e)}),{onApprove:(t,n)=>this.onHostedCheckoutApprove(t,n,e,a)}),y=Object.assign(Object.assign({fundingSource:s.FUNDING.PAYPAL,style:this.paypalCommerceIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},h),{height:zi}))},m),c&&p),g=s.Buttons(y);g.isEligible()?(null===(n=g.hasReturned)||void 0===n?void 0:n.call(g))&&this.isPaypalCommerceAppSwitchEnabled(e)?null===(i=g.resume)||void 0===i||i.call(g):g.render(`#${r}`):this.paypalCommerceIntegrationService.removeElement(r)}onHostedCheckoutApprove(e,t,n,i){return ba(this,void 0,void 0,(function*(){if(!e.orderID)throw new vn(yn.MissingOrderId);const r=this.paymentIntegrationService.getState().getCartOrThrow(),o=yield t.order.get();try{const t=this.paypalCommerceIntegrationService.getBillingAddressFromOrderDetails(o);if(yield this.paymentIntegrationService.updateBillingAddress(t),r.lineItems.physicalItems.length>0){const e=this.paypalCommerceIntegrationService.getShippingAddressFromOrderDetails(o);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.paypalCommerceIntegrationService.updateOrder()}yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.paypalCommerceIntegrationService.submitPayment(n,e.orderID),i&&"function"==typeof i&&i()}catch(e){this.handleError(e)}}))}onShippingAddressChange(e){return ba(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.paypalCommerceIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}onShippingOptionsChange(e){return ba(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}isPaypalCommerceAppSwitchEnabled(e){var t;return(null===(t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e).initializationData)||void 0===t?void 0:t.isAppSwitchEnabled)||!1}}const Ca=Ge((e=>new Sa(e,fa(e))),[{id:"paypalcommerce"}]);var wa=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class _a{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.onError=c.noop}initialize(e){return wa(this,void 0,void 0,(function*(){const{paypalcommercecredit:t,methodId:n}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.paypalcommercecredit" argument is not provided.');if(!t.container)throw new xn('Unable to initialize payment because "options.paypalcommercecredit.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new xn('Unable to initialize payment because "options.paypalcommercecredit.onClick" argument is not a function.');this.onError=t.onError||c.noop,this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.paypalCommerceIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC PayPal]: PayPal Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return wa(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return wa(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onComplete:i,onClick:r}=t,o=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{isHostedCheckoutEnabled:s,paymentButtonStyles:d,isAppSwitchEnabled:c}=a.initializationData||{},{checkoutTopButtonStyles:l}=d||{},u=Object.assign({createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercecredit"),onApprove:({orderID:t})=>this.paypalCommerceIntegrationService.tokenizePayment(e,t)},r&&{onClick:()=>r()}),h=Object.assign(Object.assign({},!c&&{onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e)}),{onApprove:(t,n)=>this.onHostedCheckoutApprove(t,n,e,i)}),m=[o.FUNDING.PAYLATER,o.FUNDING.CREDIT];let p=!1;m.forEach((e=>{if(!p){const t=Object.assign(Object.assign({fundingSource:e,style:this.paypalCommerceIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},l),{height:zi}))},u),s&&h),i=o.Buttons(t);i.isEligible()&&(i.render(`#${n}`),p=!0)}})),p||this.paypalCommerceIntegrationService.removeElement(n)}onHostedCheckoutApprove(e,t,n,i){return wa(this,void 0,void 0,(function*(){if(!e.orderID)throw new vn(yn.MissingOrderId);const r=this.paymentIntegrationService.getState().getCartOrThrow(),o=yield t.order.get();try{const t=this.paypalCommerceIntegrationService.getBillingAddressFromOrderDetails(o);if(yield this.paymentIntegrationService.updateBillingAddress(t),r.lineItems.physicalItems.length>0){const e=this.paypalCommerceIntegrationService.getShippingAddressFromOrderDetails(o);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.paypalCommerceIntegrationService.updateOrder()}yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.paypalCommerceIntegrationService.submitPayment(n,e.orderID),i&&"function"==typeof i&&i()}catch(e){this.handleError(e)}}))}onShippingAddressChange(e){return wa(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.paypalCommerceIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}onShippingOptionsChange(e){return wa(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){this.handleError(e)}}))}handleError(e){if("function"!=typeof this.onError)throw e;this.onError(e)}}const Ia=Ge((e=>new _a(e,fa(e))),[{id:"paypalcommercecredit"}]);var Pa=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ea{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t}initialize(e){return Pa(this,void 0,void 0,(function*(){const{paypalcommercevenmo:t,methodId:n}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.paypalcommercevenmo" argument is not provided.');if(!t.container)throw new xn('Unable to initialize payment because "options.paypalcommercevenmo.container" argument is not provided.');if(t.onClick&&"function"!=typeof t.onClick)throw new xn('Unable to initialize payment because "options.paypalcommercevenmo.onClick" argument is not a function.');this.paymentIntegrationService.getState().getPaymentMethod(n)||(yield this.paymentIntegrationService.loadPaymentMethod(n));const i=yield this.paypalCommerceIntegrationService.loadPayPalSdk(n);i&&i.Buttons&&"function"==typeof i.Buttons?this.renderButton(n,t):console.error("[BC PayPal]: PayPal Button could not be rendered, due to issues with loading PayPal SDK")}))}deinitialize(){return Promise.resolve()}signIn(e,t){return Pa(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return Pa(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}renderButton(e,t){const{container:n,onClick:i}=t,r=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:a}=o.initializationData||{},{checkoutTopButtonStyles:s}=a||{},d=Object.assign({fundingSource:r.FUNDING.VENMO,style:this.paypalCommerceIntegrationService.getValidButtonStyle(Object.assign(Object.assign({},s),{height:zi})),createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercevenmo"),onApprove:({orderID:t})=>this.paypalCommerceIntegrationService.tokenizePayment(e,t)},i&&{onClick:()=>i()}),c=r.Buttons(d);c.isEligible()?c.render(`#${n}`):this.paypalCommerceIntegrationService.removeElement(n)}}const Oa=Ge((e=>new Ea(e,fa(e))),[{id:"paypalcommercevenmo"}]);function Aa(){return new Wo((0,s.Hb)())}var ka,Ta,Na,Ma,xa,Da,za;!function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(ka||(ka={})),function(e){e.Succeeded="succeeded",e.Cancelled="cancelled",e.Errored="errored"}(Ta||(Ta={})),function(e){e.Possible="POSSIBLE",e.No="NO",e.Unknown="UNKNOWN",e.Yes="YES"}(Na||(Na={})),function(e){e.paypal="paypal",e.checkout="checkout",e.buynow="buynow",e.pay="pay",e.installment="installment"}(Ma||(Ma={})),function(e){e.gold="gold",e.blue="blue",e.silver="silver",e.black="black",e.white="white"}(xa||(xa={})),function(e){e.pill="pill",e.rect="rect"}(Da||(Da={})),function(e){e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled",e.UNRECOGNIZED="unrecognized"}(za||(za={}));var Fa=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ba{constructor(){this.window=window}initializePayPalFastlane(e,t,n){return Fa(this,void 0,void 0,(function*(){if(t&&(window.localStorage.setItem("fastlaneEnv","sandbox"),window.localStorage.setItem("axoEnv","sandbox")),!this.window.paypalFastlane){const t={root:{backgroundColorPrimary:"transparent"}};this.window.paypalFastlane=yield e.Fastlane({styles:n||t})}return this.window.paypalFastlane}))}getPayPalFastlaneOrThrow(){if(!this.window.paypalFastlane)throw new Tn;return this.window.paypalFastlane}lookupCustomerOrThrow(e){return Fa(this,void 0,void 0,(function*(){return this.getPayPalFastlaneOrThrow().identity.lookupCustomerByEmail(e)}))}triggerAuthenticationFlowOrThrow(e){return Fa(this,void 0,void 0,(function*(){return e?this.getPayPalFastlaneOrThrow().identity.triggerAuthenticationFlow(e):{}}))}updateStorageSessionId(e){const t=new Date;t.setDate(t.getDate()+14);const n={expires:t,secure:!0};Qi.set("bc-fastlane-sessionId",e,n)}removeStorageSessionId(){Qi.remove("bc-fastlane-sessionId")}getStorageSessionId(){return Qi.get("bc-fastlane-sessionId")||""}mapPayPalFastlaneProfileToBcCustomerData(e,t){var n,i,r;const{authenticationState:o,profileData:a}=t,s=null===(r=null===(i=null===(n=null==a?void 0:a.card)||void 0===n?void 0:n.paymentSource)||void 0===i?void 0:i.card)||void 0===r?void 0:r.billingAddress,d=null==a?void 0:a.shippingAddress,c=null==a?void 0:a.name,l=null==a?void 0:a.card,u=d?this.mapPayPalToBcAddress(d.address,d.name,d.phoneNumber):void 0,h=s&&c?this.mapPayPalToBcAddress(s,c,null==d?void 0:d.phoneNumber):void 0,m=l?this.mapPayPalToBcInstrument(e,l):[],p=this.filterAddresses([u,h]);return{authenticationState:o||za.UNRECOGNIZED,addresses:p,billingAddress:h,shippingAddress:u,instruments:m}}mapPayPalToBcInstrument(e,t){const{id:n,paymentSource:i}=t,{brand:r,expiry:o,lastDigits:a}=i.card,[s,d]=o.split("-");return[{bigpayToken:n,brand:r,defaultInstrument:!1,expiryMonth:d,expiryYear:s,iin:"",last4:a,method:e,provider:e,trustedShippingAddress:!1,untrustedShippingCardVerificationMode:Li.PAN,type:"card"}]}mapBcToPayPalAddress(e){return{company:(null==e?void 0:e.company)||"",addressLine1:(null==e?void 0:e.address1)||"",addressLine2:(null==e?void 0:e.address2)||"",adminArea1:(null==e?void 0:e.stateOrProvinceCode)||(null==e?void 0:e.stateOrProvince)||"",adminArea2:(null==e?void 0:e.city)||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCode:(null==e?void 0:e.countryCode)||""}}mapPayPalToBcAddress(e,t,n,i){const[r,o]=t.fullName.split(" "),a=(null==n?void 0:n.nationalNumber)||"",s=(null==n?void 0:n.countryCode)||"";return{id:Date.now(),type:"paypal-address",firstName:t.firstName||r||"",lastName:t.lastName||o||"",company:e.company||"",address1:e.addressLine1,address2:e.addressLine2||"",city:e.adminArea2,stateOrProvince:e.adminArea1,stateOrProvinceCode:e.adminArea1,country:e.countryCode||"",countryCode:e.countryCode||"",postalCode:e.postalCode,phone:s+a,customFields:i||[]}}filterAddresses(e){return e.reduce(((e,t)=>t?e.some((e=>this.isEqualAddresses(e,t)))?e:[...e,t]:e),[])}isEqualAddresses(e,t){return(0,c.isEqual)(this.normalizeAddress(e),this.normalizeAddress(t))}normalizeAddress(e){return(0,c.omit)(e,["id","phone"])}}function Ra(){return new Ba}function La(e){return"string"!=typeof e}function ja(e,t){if(t||e)return function(e){var t,n;const i={},r=(0,c.omitBy)(e.root,La),o=(0,c.omitBy)(e.input,La),a=(0,c.omitBy)(e.toggle,La),s=(0,c.omitBy)(null===(t=e.text)||void 0===t?void 0:t.body,La),d=(0,c.omitBy)(null===(n=e.text)||void 0===n?void 0:n.caption,La),l=e.branding;return Object.keys(r).length&&(i.root=r),Object.keys(o).length&&(i.input=o),Object.keys(a).length&&(i.toggle=a),Object.keys(s).length&&(i.text={},i.text.body=s),Object.keys(d).length&&(i.text=Object.assign({},i.text),i.text.caption=d),l&&(i.branding=l),i}(function(e,t){var n,i,r,o,a,s,d,c,l,u,h,m,p,y,g,v,f,b,S,C,w,_;return{root:{backgroundColorPrimary:(null==e?void 0:e.fastlaneRootSettingsBackgroundColor)||(null===(n=null==t?void 0:t.root)||void 0===n?void 0:n.backgroundColorPrimary),errorColor:(null==e?void 0:e.fastlaneRootSettingsErrorColor)||(null===(i=null==t?void 0:t.root)||void 0===i?void 0:i.errorColor),fontFamily:(null==e?void 0:e.fastlaneRootSettingsFontFamily)||(null===(r=null==t?void 0:t.root)||void 0===r?void 0:r.fontFamily),fontSizeBase:(null==e?void 0:e.fastlaneRootSettingsFontSize)||(null===(o=null==t?void 0:t.root)||void 0===o?void 0:o.fontSizeBase),padding:(null==e?void 0:e.fastlaneRootSettingsPadding)||(null===(a=null==t?void 0:t.root)||void 0===a?void 0:a.padding),primaryColor:(null==e?void 0:e.fastlaneRootSettingsPrimaryColor)||(null===(s=null==t?void 0:t.root)||void 0===s?void 0:s.primaryColor)},input:{borderRadius:(null==e?void 0:e.fastlaneInputSettingsBorderRadius)||(null===(d=null==t?void 0:t.input)||void 0===d?void 0:d.borderRadius),borderColor:(null==e?void 0:e.fastlaneInputSettingsBorderColor)||(null===(c=null==t?void 0:t.input)||void 0===c?void 0:c.borderColor),focusBorderColor:(null==e?void 0:e.fastlaneInputSettingsFocusBorderBase)||(null===(l=null==t?void 0:t.input)||void 0===l?void 0:l.focusBorderColor),backgroundColor:(null==e?void 0:e.fastlaneInputSettingsBackgroundColor)||(null===(u=null==t?void 0:t.input)||void 0===u?void 0:u.backgroundColor),borderWidth:(null==e?void 0:e.fastlaneInputSettingsBorderWidth)||(null===(h=null==t?void 0:t.input)||void 0===h?void 0:h.borderWidth),textColorBase:(null==e?void 0:e.fastlaneInputSettingsTextColorBase)||(null===(m=null==t?void 0:t.input)||void 0===m?void 0:m.textColorBase)},toggle:{colorPrimary:(null==e?void 0:e.fastlaneToggleSettingsColorPrimary)||(null===(p=null==t?void 0:t.toggle)||void 0===p?void 0:p.colorPrimary),colorSecondary:(null==e?void 0:e.fastlaneToggleSettingsColorSecondary)||(null===(y=null==t?void 0:t.toggle)||void 0===y?void 0:y.colorSecondary)},text:{body:{color:(null==e?void 0:e.fastlaneTextBodySettingsColor)||(null===(v=null===(g=null==t?void 0:t.text)||void 0===g?void 0:g.body)||void 0===v?void 0:v.color),fontSize:(null==e?void 0:e.fastlaneTextBodySettingsFontSize)||(null===(b=null===(f=null==t?void 0:t.text)||void 0===f?void 0:f.body)||void 0===b?void 0:b.fontSize)},caption:{color:(null==e?void 0:e.fastlaneTextCaptionSettingsColor)||(null===(C=null===(S=null==t?void 0:t.text)||void 0===S?void 0:S.caption)||void 0===C?void 0:C.color),fontSize:(null==e?void 0:e.fastlaneTextCaptionSettingsFontSize)||(null===(_=null===(w=null==t?void 0:t.text)||void 0===w?void 0:w.caption)||void 0===_?void 0:_.fontSize)}},branding:(null==e?void 0:e.fastlaneBrandingSettings)||(null==t?void 0:t.branding)}}(e,t))}var Ua=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Va{constructor(e,t,n){this.paymentIntegrationService=e,this.paypalCommerceSdk=t,this.paypalCommerceFastlaneUtils=n}initialize(e){var t;return Ua(this,void 0,void 0,(function*(){const{methodId:n,paypalcommercefastlane:i}=e;if(!n)throw new xn('Unable to proceed because "methodId" argument is not provided.');try{yield this.paymentIntegrationService.loadPaymentMethod(n);const e=this.paymentIntegrationService.getState(),r=e.getCartOrThrow(),o=e.getPaymentMethodOrThrow(n),a=!!(null===(t=o.initializationData)||void 0===t?void 0:t.isDeveloperModeApplicable),s=yield this.paypalCommerceSdk.getPayPalFastlaneSdk(o,r.currency.code,r.id);yield this.paypalCommerceFastlaneUtils.initializePayPalFastlane(s,a,this.getFastlaneStyles(n,i))}catch(e){}return Promise.resolve()}))}deinitialize(){return Ua(this,void 0,void 0,(function*(){return Promise.resolve()}))}signIn(e,t){return Ua(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signInCustomer(e,t)}))}signOut(e){return Ua(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.signOutCustomer(e)}))}executePaymentMethodCheckout(e){return Ua(this,void 0,void 0,(function*(){const{checkoutPaymentMethodExecuted:t,continueWithCheckoutCallback:n,methodId:i}=e||{};if(!i)throw new xn('Unable to proceed because "methodId" argument is not provided.');if("function"!=typeof n)throw new xn('Unable to proceed because "continueWithCheckoutCallback" argument is not provided and it must be a function.');if(this.paymentIntegrationService.getState().getCustomerOrThrow().isGuest){t&&"function"==typeof t&&t();try{yield this.runPayPalAuthenticationFlowOrThrow(i)}catch(e){}}n()}))}runPayPalAuthenticationFlowOrThrow(e){return Ua(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow().id,i=t.getCustomer(),r=t.getBillingAddress(),o=(null==i?void 0:i.email)||(null==r?void 0:r.email)||"",{customerContextId:a}=yield this.paypalCommerceFastlaneUtils.lookupCustomerOrThrow(o),s=yield this.paypalCommerceFastlaneUtils.triggerAuthenticationFlowOrThrow(a),d=s.authenticationState===za.CANCELED;yield this.updateCustomerDataState(e,s),d?this.paypalCommerceFastlaneUtils.removeStorageSessionId():this.paypalCommerceFastlaneUtils.updateStorageSessionId(n)}))}updateCustomerDataState(e,t){var n;return Ua(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState().getCartOrThrow(),{authenticationState:r,addresses:o,billingAddress:a,shippingAddress:s,instruments:d}=this.paypalCommerceFastlaneUtils.mapPayPalFastlaneProfileToBcCustomerData(e,t);if(yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:r,addresses:o,instruments:d}),a&&(yield this.paymentIntegrationService.updateBillingAddress(a)),s&&i.lineItems.physicalItems.length>0){const t=yield this.paymentIntegrationService.updateShippingAddress(s),i=t.getPaymentMethodOrThrow(e),{isFastlaneShippingOptionAutoSelectEnabled:r}=i.initializationData||{},o=t.getConsignments()||[],a=(null===(n=o[0])||void 0===n?void 0:n.availableShippingOptions)||[],d=a[0],c=a.find((e=>e.isRecommended));if((c||d)&&r){const e=(null==c?void 0:c.id)||d.id;yield this.paymentIntegrationService.selectShippingOption(e)}}}))}getFastlaneStyles(e,t){const n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{fastlaneStyles:i,isFastlaneStylingEnabled:r}=n.initializationData||{};return ja(r?i:{},null==t?void 0:t.styles)}}const qa=Ge((e=>new Va(e,Aa(),Ra())),[{id:"paypalcommerceacceleratedcheckout"},{id:"paypalcommercecreditcards"}]);var Ha,Ga,$a,Wa,Ya,Ka,Qa,Ja,Za=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Xa{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}getStripeClient(e,t,n){return Za(this,void 0,void 0,(function*(){if(this.stripeWindow.bcStripeClient)return this.stripeWindow.bcStripeClient;const i=yield this.load(),{stripePublishableKey:r,stripeConnectedAccount:o}=e,a=i(r,Object.assign(Object.assign(Object.assign({},o?{stripeAccount:o}:{}),t?{betas:t}:{}),n?{apiVersion:n}:{}));return Object.assign(this.stripeWindow,{bcStripeClient:a}),a}))}getElements(e,t){return Za(this,void 0,void 0,(function*(){let n=this.stripeWindow.bcStripeElements;return n?yield this.updateStripeElements(t):(n=e.elements(t),Object.assign(this.stripeWindow,{bcStripeElements:n})),n}))}updateStripeElements(e){return Za(this,void 0,void 0,(function*(){const t=this.stripeWindow.bcStripeElements;t&&(t.update(e),yield t.fetchUpdates())}))}load(){return Za(this,void 0,void 0,(function*(){if(!this.stripeWindow.Stripe&&(yield this.scriptLoader.loadScript("https://js.stripe.com/v3/"),!this.stripeWindow.Stripe))throw new Tn;return this.stripeWindow.Stripe}))}}function es(e){return"object"==typeof e&&null!==e&&"initializationData"in e&&void 0!==e.initializationData&&null!==e.initializationData&&"object"==typeof e.initializationData&&"stripePublishableKey"in e.initializationData&&"stripeConnectedAccount"in e.initializationData&&"shopperLanguage"in e.initializationData&&void 0!==e.initializationData.stripePublishableKey&&void 0!==e.initializationData.stripeConnectedAccount&&void 0!==e.initializationData.shopperLanguage}function ts(e){return"stripeLinkAuthenticationState"in e}!function(e){e.SHIPPING="shipping",e.BILLING="billing"}(Ha||(Ha={})),function(e){e.SPLIT="split",e.FULL="full",e.ORGANIZATION="organization"}(Ga||(Ga={})),function(e){e.CreditCard="card",e.Link="link",e.EPS="eps",e.GRABPAY="grabpay",e.BANCONTACT="bancontact",e.IDEAL="ideal",e.ALIPAY="alipay",e.KLARNA="klarna",e.OCS="optimized_checkout"}($a||($a={})),function(e){e.NEVER="never",e.AUTO="auto",e.ALWAYS="always",e.PAYMENT="payment",e.IF_REQUIRED="if_required"}(Wa||(Wa={})),function(e){e.PAYMENT="payment",e.AUTHENTICATION="linkAuthentication",e.SHIPPING="address",e.EXPRESS_CHECKOUT="expressCheckout"}(Ya||(Ya={})),function(e){e.REQUIRES_PAYMENT_METHOD="requires_payment_method",e.REQUIRES_CONFIRMATION="requires_confirmation",e.REQUIRES_ACTION="requires_action",e.PROCESSING="processing",e.SUCCEEDED="succeeded",e.CANCELED="canceled"}(Ka||(Ka={})),function(e){e.CLICK="click",e.CHANGE="change",e.READY="ready",e.SHIPPING_ADDRESS_CHANGE="shippingaddresschange",e.SHIPPING_RATE_CHANGE="shippingratechange",e.CONFIRM="confirm",e.CANCEL="cancel",e.LOADER_START="loaderstart"}(Qa||(Qa={})),function(e){e.ON_SESSION="on_session",e.OFF_SESSION="off_session"}(Ja||(Ja={}));const ns=["payment_element_beta_2","alipay_pm_beta_1","link_default_integration_beta_1","shipping_address_element_beta_1","address_element_beta_1"],is="2020-03-02;alipay_beta=v1;link_beta=v1";class rs{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){var t,n,i,r;return n=this,r=function*(){let n;if(!e.stripeupe)throw new xn('Unable to proceed because "options" argument is not provided.');const{container:i,gatewayId:r,methodId:o,onEmailChange:a,getStyles:s,isLoading:d}=e.stripeupe;Object.entries(e.stripeupe).forEach((([e,t])=>{if(!t)throw new xn(`Unable to proceed because "${e}" argument is not provided.`)})),yield this.paymentIntegrationService.loadPaymentMethod(r,{params:{method:o}});const c=this.paymentIntegrationService.getState(),l=c.getPaymentMethodOrThrow(o,r),{clientToken:u}=l;if(!es(l)||!u)throw new vn(yn.MissingPaymentToken);const{email:h}=c.getCustomerOrThrow(),m=c.getPaymentProviderCustomerOrThrow(),p=(ts(m)?m:{}).stripeLinkAuthenticationState;if(!h){let e;const r="function"==typeof s&&s();e=r?{variables:{colorPrimary:r.fieldInnerShadow,colorBackground:r.fieldBackground,colorText:r.labelText,colorDanger:r.fieldErrorText,colorTextSecondary:r.labelText,colorTextPlaceholder:r.fieldPlaceholderText},rules:{".Input":{borderColor:r.fieldBorder,color:r.fieldText,boxShadow:r.fieldInnerShadow}}}:{},n=yield this.scriptLoader.getStripeClient(l.initializationData,ns,is),this._stripeElements=yield this.scriptLoader.getElements(n,{clientSecret:u,appearance:e});const{getBillingAddress:o,getConsignments:c}=this.paymentIntegrationService.getState(),h=c(),m=null===(t=null==h?void 0:h[0])||void 0===t?void 0:t.id,{email:y}=o()||{},g=y?{defaultValues:{mode:Ha.SHIPPING,email:y}}:{},v=this._stripeElements.getElement(Ya.AUTHENTICATION)||this._stripeElements.create(Ya.AUTHENTICATION,g);v.on(Qa.CHANGE,(e=>{if(!("authenticated"in e))throw new vn(yn.MissingCustomer);this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:e.authenticated}),e.complete?a(e.authenticated,e.value.email):a(!1,""),d&&d(!1),void 0===p&&e.authenticated&&m&&this.paymentIntegrationService.deleteConsignment(m)})),v.mount(`#${i}`)}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}))}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(Ya.AUTHENTICATION))||void 0===t||t.unmount(),Promise.resolve()}signIn(e,t){return this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}signOut(e){return this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}}const os=Ge((e=>new rs(e,new Xa((0,s.vQ)()))),[{id:"stripeupe"}]),as={size:70,color:"#d9d9d9",backgroundColor:"#ffffff"},ss={position:"fixed","background-color":"rgba(0, 0, 0, 0.4)","z-index":"1000"},ds="embedded-checkout-loading-indicator-rotation";class cs{constructor(e){this.styles=Object.assign(Object.assign({},as),e&&e.styles),this.containerStyles=Object.assign({},e&&e.containerStyles),this.defineAnimation(),this.container=this.buildContainer(),this.indicator=this.buildIndicator(),this.container.appendChild(this.indicator)}show(e){if(e){const t=document.getElementById(e);if(!t)throw new Error("Unable to attach the loading indicator because the parent ID is not valid.");t.appendChild(this.container)}this.container.style.visibility="visible",this.container.style.opacity="1"}hide(){const e=()=>{this.container.style.visibility="hidden",this.container.removeEventListener("transitionend",e)};this.container.addEventListener("transitionend",e),this.container.style.opacity="0"}buildContainer(){const e=document.createElement("div");return e.style.display="block",e.style.bottom="0",e.style.left="0",e.style.height="100%",e.style.width="100%",e.style.position="absolute",e.style.right="0",e.style.top="0",e.style.transition="all 250ms ease-out",e.style.opacity="0",this.setStyleAttribute(e,this.containerStyles),e}buildIndicator(){const e=document.createElement("div");return e.style.display="block",e.style.width=`${this.styles.size}px`,e.style.height=`${this.styles.size}px`,e.style.borderRadius=`${this.styles.size}px`,e.style.border="solid 1px",e.style.borderColor=`${this.styles.backgroundColor} ${this.styles.backgroundColor} ${this.styles.color} ${this.styles.color}`,e.style.margin="0 auto",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="50%",e.style.transform="translateY(-50%) rotate(0deg)",e.style.transformStyle="preserve-3d",e.style.animation=`${ds} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`,e}setStyleAttribute(e,t){Object.keys(t).forEach((n=>{e.style.setProperty(n,t[n])}))}defineAnimation(){var e;if(document.getElementById(ds))return;const t=document.createElement("style");t.id=ds,null===(e=document.head)||void 0===e||e.appendChild(t),t.sheet instanceof CSSStyleSheet&&t.sheet.insertRule(`\n                @keyframes ${ds} {\n                    0% { transform: translateY(-50%) rotate(0deg); }\n                    100% { transform: translateY(-50%) rotate(360deg); }\n                }\n            `,0)}}var ls=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class us{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t,this.isMounted=!1}deinitialize(){var e;null===(e=this.checkoutEventsUnsubscribe)||void 0===e||e.call(this),this.isMounted=!1}initCheckoutEventsSubscription(e,t,n,i){this.checkoutEventsUnsubscribe=this.paymentIntegrationService.subscribe((()=>ls(this,void 0,void 0,(function*(){var r;const o=null==i?void 0:i.getElement(Ya.PAYMENT);if(o){try{yield this.updateStripePaymentIntent(e,t)}catch(e){return this.isMounted&&(o.unmount(),this.isMounted=!1),void(e instanceof Error&&(null===(r=n.onError)||void 0===r||r.call(n,e)))}this.isMounted||(yield null==i?void 0:i.fetchUpdates(),this.mountElement(o,n.containerId))}}))),(e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.outstandingBalance}),(e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.coupons}))}mountElement(e,t){document.getElementById(t)&&(e.mount(`#${t}`),this.isMounted=!0)}mapAppearanceVariables(e){return{colorPrimary:e.fieldInnerShadow,colorBackground:e.fieldBackground,colorText:e.labelText,colorDanger:e.fieldErrorText,colorTextSecondary:e.labelText,colorTextPlaceholder:e.fieldPlaceholderText,colorIcon:e.fieldPlaceholderText}}mapInputAppearanceRules(e){return{borderColor:e.fieldBorder,color:e.fieldText,boxShadow:e.fieldInnerShadow}}throwStripeError(e){if("object"==typeof(t=e)&&null!==t&&"type"in t&&(this.throwDisplayableStripeError(e),this.isCancellationError(e)))throw new ai;var t;throw new ur}throwDisplayableStripeError(e){if((0,c.includes)(["card_error","invalid_request_error","validation_error"],e.type))throw new Error(e.message)}isCancellationError(e){var t;const n=null===(t=null==e?void 0:e.payment_intent.last_payment_error)||void 0===t?void 0:t.message;return!!n&&-1!==n.indexOf("canceled")}throwPaymentConfirmationProceedMessage(){throw new ur("We've received your order and are processing your payment. Once the payment is verified, your order will be completed. We will send you an email when it's completed. Please note, this process may take a few minutes depending on the processing times of your chosen method.")}isPaymentCompleted(e,t){return ls(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getPaymentMethodOrThrow(e),{features:r}=n.getStoreConfigOrThrow().checkoutSettings;if(!i.clientToken||!t||!r["PI-626.Block_unnecessary_payment_confirmation_for_StripeUPE"])return!1;const{paymentIntent:o}=yield t.retrievePaymentIntent(i.clientToken);return(null==o?void 0:o.status)===Ka.SUCCEEDED}))}mapStripePaymentData(e,t,n=!1){const i=this.paymentIntegrationService.getState().getBillingAddress(),{firstName:r,lastName:o,email:a}=i||{},s=this._mapStripeAddress(i);if(!e)throw new Sn(gn.PaymentNotInitialized);if(!(a&&s&&s.city&&s.country&&r&&o))throw new vn(yn.MissingBillingAddress);return{elements:e,redirect:Wa.IF_REQUIRED,confirmParams:Object.assign({payment_method_data:Object.assign(Object.assign({},n?{allow_redisplay:"always"}:{}),{billing_details:{email:a,address:s,name:`${r} ${o}`}})},t&&{return_url:t})}}isAdditionalActionError(e){return(0,c.some)(e,{code:"additional_action_required"})}isRedirectAction(e){const{type:t,data:{redirect_url:n}}=e;return"redirect_to_url"===t&&!!n}isOnPageAdditionalAction(e){const{type:t,data:{token:n}}=e;return"additional_action_requires_payment_method"===t&&!!n}updateStripePaymentIntent(e,t){return ls(this,void 0,void 0,(function*(){const n=yield this.paymentIntegrationService.loadPaymentMethod(e,{params:{method:t}}),{clientToken:i}=n.getPaymentMethodOrThrow(t);if(!i)throw new vn(yn.MissingPaymentMethod);this.scriptLoader.updateStripeElements({clientSecret:i})}))}_mapStripeAddress(e){if(e){const{city:t,address1:n,address2:i,countryCode:r,postalCode:o,stateOrProvinceCode:a}=e;return Object.assign({city:t,country:r,postal_code:o,line1:n,line2:i},a?{state:a}:{})}throw new vn(yn.MissingBillingAddress)}}class hs{constructor(e){this._decimalPlaces=e}toInteger(e){return Math.round(e*Math.pow(10,this._decimalPlaces))}}const ms=["AC","AD","AE","AF","AG","AI","AL","AM","AO","AQ","AR","AT","AU","AW","AX","AZ","BA","BB","BD","BE","BF","BG","BH","BI","BJ","BL","BM","BN","BO","BQ","BR","BS","BT","BV","BW","BY","BZ","CA","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CV","CW","CY","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","EG","EH","ER","ES","ET","FI","FJ","FK","FO","FR","GA","GB","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GS","GT","GU","GW","GY","HK","HN","HR","HT","HU","ID","IE","IL","IM","IN","IO","IQ","IS","IT","JE","JM","JO","JP","KE","KG","KH","KI","KM","KN","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MF","MG","MK","ML","MM","MN","MO","MQ","MR","MS","MT","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NG","NI","NL","NO","NP","NR","NU","NZ","OM","PA","PE","PF","PG","PH","PK","PL","PM","PN","PR","PS","PT","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SE","SG","SH","SI","SJ","SK","SL","SM","SN","SO","SR","SS","ST","SV","SX","SZ","TA","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TR","TT","TV","TW","TZ","UA","UG","US","UY","UZ","VA","VC","VE","VG","VN","VU","WF","WS","XK","YE","YT","ZA","ZM","ZW","ZZ"];var ps=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ys{constructor(e,t,n,i){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=n,this.loadingIndicator=i}initialize(e){return ps(this,void 0,void 0,(function*(){const{stripeocs:t}=e||{};if(!t)throw new xn('Unable to proceed because "options" argument is not provided.');const{methodId:n,gatewayId:i,container:r}=t;if(!r||!n||!i)throw new Sn(gn.PaymentNotInitialized);const o=(yield this.paymentIntegrationService.loadPaymentMethod(i,{params:{method:n}})).getPaymentMethodOrThrow(n,i),{loadingContainerId:a,buttonHeight:s,onComplete:d}=t;if(this._loadingIndicatorContainer=a,this._onComplete=d,!es(o))throw new vn(yn.MissingPaymentMethod);const{initializationData:c}=o,{captureMethod:l}=c;return this._captureMethod=l,this._stripeClient=yield this.scriptLoader.getStripeClient(c),yield this._mountExpressCheckoutElement(n,r,this._stripeClient,s),Promise.resolve()}))}signIn(){return Promise.resolve()}signOut(){return Promise.resolve()}executePaymentMethodCheckout(){return Promise.resolve()}deinitialize(){return Promise.resolve()}_mountExpressCheckoutElement(e,t,n,i=40){return ps(this,void 0,void 0,(function*(){const r=this._shouldRequireShippingAddress(),o=Object.assign(Object.assign(Object.assign({shippingAddressRequired:r},r?{allowedShippingCountries:yield this._getAvailableCountries()}:{}),r?{shippingRates:[{id:"_",amount:0,displayName:"Pending rates"}]}:{}),{billingAddressRequired:!0,emailRequired:!0,phoneNumberRequired:!0,paymentMethods:{link:Wa.AUTO,applePay:Wa.NEVER,googlePay:Wa.NEVER,amazonPay:Wa.NEVER,paypal:Wa.NEVER,klarna:Wa.NEVER},buttonHeight:i}),{cartAmount:a}=this.paymentIntegrationService.getState().getCartOrThrow(),s=Object.assign({mode:"payment",amount:this._toCents(a),currency:this._getCurrency()},this._captureMethod?{captureMethod:this._captureMethod}:{});this._stripeElements=n.elements(s),this._linkV2Element=this._stripeElements.create(Ya.EXPRESS_CHECKOUT,o),this._linkV2Element.mount(`#${t}`),this._initializeEvents(this._linkV2Element,e)}))}_initializeEvents(e,t){this._shouldRequireShippingAddress()&&(e.on(Qa.SHIPPING_ADDRESS_CHANGE,(e=>ps(this,void 0,void 0,(function*(){return this._onShippingAddressChange(e)})))),e.on(Qa.SHIPPING_RATE_CHANGE,(e=>ps(this,void 0,void 0,(function*(){return this._onShippingRateChange(e)}))))),e.on(Qa.CONFIRM,(e=>ps(this,void 0,void 0,(function*(){return this._onConfirm(e,t)})))),e.on(Qa.CANCEL,this._onCancel)}_onShippingAddressChange(e){return ps(this,void 0,void 0,(function*(){if("address"in e){const t=e.address,n={firstName:"",lastName:"",phone:"",company:"",address1:"",address2:"",city:(null==t?void 0:t.city)||"",countryCode:(null==t?void 0:t.country)||"",postalCode:(null==t?void 0:t.postal_code)||"",stateOrProvince:(null==t?void 0:t.state)||"",stateOrProvinceCode:"",customFields:[]};yield this.paymentIntegrationService.updateShippingAddress(n);const i=yield this._getAvailableShippingOptions();yield this._updateDisplayedPrice(),e.resolve({shippingRates:i})}}))}_onCancel(){throw new ai}_onShippingRateChange(e){return ps(this,void 0,void 0,(function*(){if("shippingRate"in e){const{shippingRate:t}=e;yield this._handleShippingOptionChange(null==t?void 0:t.id),yield this._updateDisplayedPrice(),e.resolve({})}}))}_onConfirm(e,t){return ps(this,void 0,void 0,(function*(){if("billingDetails"in e&&"shippingAddress"in e&&this._stripeClient&&this._stripeElements){yield this._updateShippingAndBillingAddress(e),yield this.paymentIntegrationService.submitOrder();const n=this._getPaymentPayload(t);try{yield this.paymentIntegrationService.submitPayment(n)}catch(e){yield this._processAdditionalAction(e,t)}}return Promise.resolve()}))}_updateShippingAndBillingAddress(e){var t,n,i,r,o,a,s,d;return ps(this,void 0,void 0,(function*(){const c=this._shouldRequireShippingAddress(),l=(null===(n=null===(t=e.shippingAddress)||void 0===t?void 0:t.name)||void 0===n?void 0:n.split(" ")[0])||(null===(r=null===(i=e.billingDetails)||void 0===i?void 0:i.name)||void 0===r?void 0:r.split(" ")[0])||"",u=(null===(a=null===(o=e.shippingAddress)||void 0===o?void 0:o.name)||void 0===a?void 0:a.split(" ")[1])||(null===(d=null===(s=e.billingDetails)||void 0===s?void 0:s.name)||void 0===d?void 0:d.split(" ")[1])||"";if(c){const t=this._mapShippingAddress(e.shippingAddress,e.billingDetails,l,u);yield this.paymentIntegrationService.updateShippingAddress(t)}const h=this._mapBillingAddress(e.shippingAddress,e.billingDetails,l,u);yield this.paymentIntegrationService.updateBillingAddress(h)}))}_mapShippingAddress(e,t,n,i){var r,o,a,s,d,c,l;return{firstName:n,lastName:i,phone:(null==t?void 0:t.phone)||"",company:"",address1:(null===(r=null==e?void 0:e.address)||void 0===r?void 0:r.line1)||"",address2:(null===(o=null==e?void 0:e.address)||void 0===o?void 0:o.line2)||"",city:(null===(a=null==e?void 0:e.address)||void 0===a?void 0:a.city)||"",countryCode:(null===(s=null==e?void 0:e.address)||void 0===s?void 0:s.country)||"",postalCode:(null===(d=null==e?void 0:e.address)||void 0===d?void 0:d.postal_code)||"",stateOrProvince:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||"",stateOrProvinceCode:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||"",customFields:[]}}_mapBillingAddress(e,t,n,i){var r,o,a,s,d,c;return{email:(null==t?void 0:t.email)||"",firstName:n,lastName:i,phone:(null==t?void 0:t.phone)||"",company:"",address1:(null===(r=null==t?void 0:t.address)||void 0===r?void 0:r.line1)||"",address2:"",city:(null===(o=null==t?void 0:t.address)||void 0===o?void 0:o.city)||"",countryCode:(null===(a=null==t?void 0:t.address)||void 0===a?void 0:a.country)||"",postalCode:(null===(s=null==t?void 0:t.address)||void 0===s?void 0:s.postal_code)||"",stateOrProvince:(null===(d=null==t?void 0:t.address)||void 0===d?void 0:d.state)||"",stateOrProvinceCode:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||"",customFields:[]}}_processAdditionalAction(e,t){return ps(this,void 0,void 0,(function*(){if(!Io(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeClient||!this._stripeElements)throw new Sn(gn.PaymentNotInitialized);const{data:n}=e.body.additional_action_required,{token:i}=n,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(n,t),o=this._getPaymentPayload(t,(null==r?void 0:r.id)||i);try{this._toggleLoadingIndicator(!0),yield this.paymentIntegrationService.submitPayment(o),yield this._completeCheckoutFlow()}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}finally{this._toggleLoadingIndicator(!1)}}))}_confirmStripePaymentOrThrow(e,t){var n,i,r;return ps(this,void 0,void 0,(function*(){const{token:o,redirect_url:a}=e,s=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,a);let d;try{const e=(yield this.stripeIntegrationService.isPaymentCompleted(t,this._stripeClient))?yield null===(r=this._stripeClient)||void 0===r?void 0:r.retrievePaymentIntent(o||""):yield null===(n=this._stripeClient)||void 0===n?void 0:n.confirmPayment({elements:s.elements,clientSecret:o,redirect:Wa.IF_REQUIRED,confirmParams:{return_url:null===(i=s.confirmParams)||void 0===i?void 0:i.return_url}});if(d=null==e?void 0:e.error,d||!(null==e?void 0:e.paymentIntent))throw new ur;return e}catch(e){return this.stripeIntegrationService.throwStripeError(d)}}))}_completeCheckoutFlow(){return ps(this,void 0,void 0,(function*(){return"function"==typeof this._onComplete?this._onComplete():(window.location.replace("/order-confirmation"),Promise.resolve())}))}_getPaymentPayload(e,t){var n;const i=(null===(n=this.paymentIntegrationService.getState().getCart())||void 0===n?void 0:n.id)||"";return{methodId:e,paymentData:{formattedPayload:Object.assign(Object.assign({cart_id:i},t?{credit_card_token:{token:t}}:{}),{confirm:!1,payment_method_id:$a.Link})}}}_shouldRequireShippingAddress(){const{getCartOrThrow:e}=this.paymentIntegrationService.getState(),{lineItems:t}=e();return!!t.physicalItems.length}_updateDisplayedPrice(){return ps(this,void 0,void 0,(function*(){this._stripeElements&&this._stripeElements.update({currency:this._getCurrency(),mode:"payment",amount:yield this._getTotalPrice()})}))}_getCurrency(){if(!this._currencyCode){const{code:e}=this.paymentIntegrationService.getState().getCartOrThrow().currency;this._currencyCode=e.toLowerCase()}return this._currencyCode}_getTotalPrice(){return ps(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.loadCheckout();const{getCheckoutOrThrow:e,getCartOrThrow:t}=this.paymentIntegrationService.getState(),{decimalPlaces:n}=t().currency,i=(0,c.round)(e().outstandingBalance,n).toFixed(n);return this._toCents(+i)}))}_getAvailableCountries(){var e;return ps(this,void 0,void 0,(function*(){const t=yield this.paymentIntegrationService.loadShippingCountries();return((null===(e=t.getShippingCountries())||void 0===e?void 0:e.map((e=>e.code)))||[]).filter((e=>ms.includes(e)))}))}_getAvailableShippingOptions(){var e,t;return ps(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState().getConsignments();if(!(null==n?void 0:n[0]))return;const i=n[0],r=(i.availableShippingOptions||[]).map(this._getStripeShippingOption.bind(this)),o=null===(e=i.selectedShippingOption)||void 0===e?void 0:e.id;return o?r.sort((e=>e.id===o?-1:0)):yield this._handleShippingOptionChange(null===(t=r[0])||void 0===t?void 0:t.id),r}))}_getStripeShippingOption({id:e,cost:t,description:n}){return{id:e,displayName:n,amount:this._toCents(t)}}_handleShippingOptionChange(e){return ps(this,void 0,void 0,(function*(){if(e&&"shipping_option_unselected"!==e)return this.paymentIntegrationService.selectShippingOption(e)}))}_getAmountTransformer(){if(this._amountTransformer)return this._amountTransformer;const{getCart:e}=this.paymentIntegrationService.getState(),{currency:t}=e()||{};return t?new hs(t.decimalPlaces):void 0}_toCents(e){const t=Math.round(100*e),n=this._getAmountTransformer();return n?n.toInteger(e):t}_toggleLoadingIndicator(e){e&&this._loadingIndicatorContainer?this.loadingIndicator.show(this._loadingIndicatorContainer):this.loadingIndicator.hide()}}const gs=Ge((e=>{const t=new Xa((0,s.vQ)()),n=new cs({containerStyles:ss});return new ys(e,t,new us(e,t),n)}),[{id:"stripeocs"}]);var vs,fs,bs,Ss,Cs,ws,_s;class Is{constructor(e,t,n=window){this._scriptLoader=e,this._stylesheetLoader=t,this._window=n}load(e){var t,n,i,r,o;return i=this,o=function*(){if(yield Promise.all([this._stylesheetLoader.loadStylesheet(`https://checkoutshopper-${null!==(t=e.environment)&&void 0!==t?t:""}.adyen.com/checkoutshopper/sdk/3.10.1/adyen.css`,{prepend:!1,attributes:{integrity:"sha384-8ofgICZZ/k5cC5N7xegqFZOA73H9RQ7H13439JfAZW8Gj3qjuKL2isaTD3GMIhDE",crossorigin:"anonymous"}}),this._scriptLoader.loadScript(`https://checkoutshopper-${null!==(n=e.environment)&&void 0!==n?n:""}.adyen.com/checkoutshopper/sdk/3.10.1/adyen.js`,{async:!0,attributes:{integrity:"sha384-wG2z9zSQo61EIvyXmiFCo+zB3y0ZB4hsrXVcANmpP8HLthjoQJQPBh7tZKJSV8jA",crossorigin:"anonymous"}})]),!this._window.AdyenCheckout)throw new Tn;return new this._window.AdyenCheckout(e)},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{s(o.next(e))}catch(e){t(e)}}function a(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,a)}s((o=o.apply(i,[])).next())}))}}function Ps(e){return"object"==typeof e&&"string"==typeof e.data.paymentMethod.encryptedSecurityCode||"string"==typeof e.data.paymentMethod.encryptedExpiryMonth}function Es(e){return Boolean(e.instrumentId)}!function(e){e.ThreeDS2Fingerprint="threeDS2Fingerprint",e.ThreeDS2="threeDS2",e.Redirect="redirect",e.QRCode="qrCode",e.Voucher="voucher",e.Sdk="sdk"}(vs||(vs={})),function(e){e.ThreeDS2Fingerprint="threeDS2Fingerprint",e.ThreeDS2Challenge="threeDS2Challenge",e.Redirect="redirect",e.QRCode="qrCode",e.Voucher="voucher"}(fs||(fs={})),function(e){e.SecuredFields="securedfields"}(bs||(bs={})),function(e){e.ACH="ach",e.AliPay="alipay",e.Bancontact="bcmc",e.CreditCard="scheme",e.Klarna="klarna",e.KlarnaPayNow="klarna_paynow",e.KlarnaAccount="klarna_account",e.IDEAL="ideal",e.GiroPay="giropay",e.GooglePay="paywithgoogle",e.SEPA="sepadirectdebit",e.Sofort="directEbanking",e.Vipps="vipps",e.WeChatPayQR="wechatpayQR"}(Ss||(Ss={})),function(e){e.POST="POST"}(Cs||(Cs={})),function(e){e.ChallengeShopper="ChallengeShopper",e.Error="Error",e.IdentifyShopper="IdentifyShopper"}(ws||(ws={})),function(e){e.CardNumber="encryptedCardNumber",e.SecurityCode="encryptedSecurityCode",e.ExpiryDate="encryptedExpiryDate"}(_s||(_s={}));class Os extends pn{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}var As=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ks{constructor(e,t){this._paymentIntegrationService=e,this._scriptLoader=t}initialize(e){return As(this,void 0,void 0,(function*(){const{adyenv2:t}=e;if(!t)throw new xn('Unable to initialize payment because "options.adyenv2" argument is not provided.');this._paymentInitializeOptions=t;const n=this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId),{originKey:i,clientKey:r,environment:o,paymentMethodsResponse:a}=n.initializationData||{},s={key:"",value:""};return i?(s.key="originKey",s.value=i):(s.key="clientKey",s.value=r||""),this._adyenClient=yield this._scriptLoader.load({environment:o,locale:this._paymentIntegrationService.getState().getLocale(),[s.key]:s.value,paymentMethodsResponse:a,translations:{es:{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-AR":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-ES":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-MX":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-CL":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-CO":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-PE":{"creditCard.expiryDateField.title":"Fecha de caducidad"}}}),this._paymentComponent=yield this._mountPaymentComponent(n),n.method!==Ss.CreditCard&&n.method!==Ss.Bancontact||(this._cardVerificationComponent=yield this._mountCardVerificationComponent()),Promise.resolve()}))}execute(e,t){return As(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),r=n&&n.paymentData,o=r&&r.shouldSaveInstrument,a=r&&r.shouldSetAsDefaultInstrument;if(!n)return Promise.reject(new Cr(["payment"]));this._validateCardData(),yield this._paymentIntegrationService.submitOrder(i,t);const s=this._componentState;if(!s)throw new Sn(gn.PaymentNotInitialized);if(r&&Es(r)){let e={};if(Ps(s)){const{encryptedCardNumber:t,encryptedSecurityCode:n,encryptedExpiryMonth:i,encryptedExpiryYear:r}=s.data.paymentMethod;e={credit_card_number_confirmation:t,expiry_month:i,expiry_year:r,verification_value:n}}if(Ps(s)||-1!==["ideal","sepadirectdebit","directEbanking","giropay"].indexOf(s.data.paymentMethod.type))try{return void(yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:{formattedPayload:{bigpay_token:Object.assign(Object.assign({},e),{token:r.instrumentId}),origin:window.location.origin,browser_info:ta(),set_as_default_stored_instrument:a||null}}})))}catch(e){return void(yield this._processAdditionalAction(e,o,a))}}try{yield this._paymentIntegrationService.submitPayment({methodId:n.methodId,paymentData:{formattedPayload:{credit_card_token:{token:JSON.stringify(Object.assign(Object.assign({},s.data.paymentMethod),{origin:window.location.origin}))},browser_info:ta(),vault_payment_instrument:o||null,set_as_default_stored_instrument:a||null}}})}catch(e){yield this._processAdditionalAction(e,o,a)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return this._componentState=void 0,this._paymentComponent&&(this._paymentComponent.unmount(),this._paymentComponent=void 0),this._cardVerificationComponent&&(this._cardVerificationComponent.unmount(),this._cardVerificationComponent=void 0),Promise.resolve()}_getAdyenClient(){if(!this._adyenClient)throw new Sn(gn.PaymentNotInitialized);return this._adyenClient}_getPaymentInitializeOptions(){if(!this._paymentInitializeOptions)throw new xn('"options.adyenv2" argument was not provided during initialization.');return this._paymentInitializeOptions}_getThreeDS2ChallengeWidgetSize(){const{additionalActionOptions:e,threeDS2Options:t}=this._getPaymentInitializeOptions();return e.widgetSize||(null==t?void 0:t.widgetSize)||"05"}_handleAction(e){return new Promise(((t,n)=>{const{threeDS2ContainerId:i,additionalActionOptions:r}=this._getPaymentInitializeOptions(),{onBeforeLoad:o,containerId:a,onLoad:s,onComplete:d}=r,c=JSON.parse(e.action),l=this._getAdyenClient().createFromAction(c,{onAdditionalDetails:e=>{const n={methodId:c.paymentMethodType,paymentData:{nonce:JSON.stringify(e.data)}};d&&d(),t(n)},size:this._getThreeDS2ChallengeWidgetSize(),onError:e=>n(e)});o&&o(c.type===fs.ThreeDS2Challenge||c.type===fs.QRCode),l.mount(`#${a||i}`),s&&s((()=>{n(new ai),l.unmount()}))}))}_mapAdyenPlaceholderData(e,t){if(!e)return{};const{firstName:n,lastName:i,address1:r,address2:o,postalCode:a,city:s,stateOrProvinceCode:d,countryCode:c}=e;return{holderName:t?`${n} ${i}`:"",billingAddress:{street:r,houseNumberOrName:o,postalCode:a,city:s,stateOrProvince:d,country:c}}}_mountCardVerificationComponent(){const e=this._getPaymentInitializeOptions(),t=this._getAdyenClient();let n;return new Promise(((i,r)=>{var o,a,s;if(e.cardVerificationContainerId){n=t.create(bs.SecuredFields,Object.assign(Object.assign({},e.options),{styles:Object.assign(Object.assign({},null===(o=e.options)||void 0===o?void 0:o.styles),{placeholder:Object.assign({color:"transparent",caretColor:"#000"},null===(s=null===(a=e.options)||void 0===a?void 0:a.styles)||void 0===s?void 0:s.placeholder)}),onChange:e=>this._updateComponentState(e),onError:t=>e.validateCardFields(t),onFieldValid:t=>e.validateCardFields(t)}));try{n.mount(`#${e.cardVerificationContainerId}`)}catch(e){r(new Sn(gn.PaymentNotInitialized))}}i(n)}))}_mountPaymentComponent(e){let t;const n=this._getPaymentInitializeOptions(),i=this._getAdyenClient();return new Promise(((r,o)=>{switch(e.method){case Ss.CreditCard:case Ss.ACH:case Ss.Bancontact:{const r=this._paymentIntegrationService.getState().getBillingAddress(),{prefillCardHolderName:a}=e.initializationData;t=i.create(e.method,Object.assign(Object.assign({},n.options),{onChange:e=>this._updateComponentState(e),data:this._mapAdyenPlaceholderData(r,a)}));try{t.mount(`#${n.containerId}`)}catch(e){o(new Sn(gn.PaymentNotInitialized))}break}case Ss.IDEAL:case Ss.SEPA:if(n.hasVaultedInstruments)this._updateComponentState({data:{paymentMethod:{type:e.method}}});else{t=i.create(e.method,Object.assign(Object.assign({},n.options),{onChange:e=>this._updateComponentState(e)}));try{t.mount(`#${n.containerId}`)}catch(e){o(new Sn(gn.PaymentNotInitialized))}}break;case Ss.AliPay:case Ss.GiroPay:case Ss.Sofort:case Ss.Klarna:case Ss.KlarnaPayNow:case Ss.KlarnaAccount:case Ss.Vipps:case Ss.WeChatPayQR:this._updateComponentState({data:{paymentMethod:{type:e.method}}})}r(t)}))}_processAdditionalAction(e,t,n){return As(this,void 0,void 0,(function*(){if(!Io(e)||!(0,c.some)(e.body.errors,{code:"additional_action_required"}))throw e;const i=yield this._handleAction(e.body.provider_data);try{yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},i),{paymentData:Object.assign(Object.assign({},i.paymentData),{shouldSaveInstrument:t,shouldSetAsDefaultInstrument:n})}))}catch(e){return this._processAdditionalAction(e,t,n)}}))}_updateComponentState(e){this._componentState=e}_validateCardData(){var e,t;const n=this._getPaymentInitializeOptions().hasVaultedInstruments?this._cardVerificationComponent:this._paymentComponent;if((null===(e=null==n?void 0:n.componentRef)||void 0===e?void 0:e.showValidation)&&n.state&&(n.componentRef.showValidation(),0===Object.keys(n.state).length||!n.state.isValid&&!n.state.issuer||"sepadirectdebit"===(null===(t=n.props)||void 0===t?void 0:t.type)&&n.state.data&&Object.values(n.state.data).some((e=>0===e.toString().trim().length))))throw new wr(this._mapCardErrors(n.state.errors))}_mapCardErrors(e={}){const t={};return Object.keys(e).forEach((n=>{t[n]=[{message:e[n],type:n}]})),t}}const Ts=Ge((e=>new ks(e,new Is((0,s.vQ)(),(0,s._U)()))),[{gateway:"adyenv2"}]);class Ns{constructor(e,t,n=window){this._scriptLoader=e,this._stylesheetLoader=t,this._window=n}load(e){var t,n,i,r,o;return i=this,o=function*(){if(yield Promise.all([this._stylesheetLoader.loadStylesheet(`https://checkoutshopper-${null!==(t=e.environment)&&void 0!==t?t:""}.adyen.com/checkoutshopper/sdk/5.71.1/adyen.css`,{prepend:!1,attributes:{integrity:"sha384-5MvB4RnzvviA3VBT4KYABZ4HXNZG5LRqREEgd41xt/pf/QvKmsj2O9GuNuywRXx9",crossorigin:"anonymous"}}),this._scriptLoader.loadScript(`https://checkoutshopper-${null!==(n=e.environment)&&void 0!==n?n:""}.adyen.com/checkoutshopper/sdk/5.71.1/adyen.js`,{async:!0,attributes:{integrity:"sha384-yvY2yFNR4WqIjPqP9MzjI+gJimmaJnAvj4rLHKvgJbgFD5fMuf8zIJrFJOW8Lhhf",crossorigin:"anonymous"}})]),!this._window.AdyenCheckout)throw new Tn;return yield this._window.AdyenCheckout(e)},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{s(o.next(e))}catch(e){t(e)}}function a(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,a)}s((o=o.apply(i,[])).next())}))}}function Ms(e){return!("object"!=typeof e||null===e||void 0!==e.shouldSaveInstrument&&"boolean"!=typeof e.shouldSaveInstrument||void 0!==e.shouldSetAsDefaultInstrument&&"boolean"!=typeof e.shouldSetAsDefaultInstrument)}var xs=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ds{constructor(e,t){this._paymentIntegrationService=e,this._scriptLoader=t}initialize(e){return xs(this,void 0,void 0,(function*(){const{adyenv3:t}=e;if(!t)throw new xn('Unable to initialize payment because "options.adyenv3" argument is not provided.');this._paymentInitializeOptions=t;const n=this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId),{environment:i,clientKey:r,paymentMethodsResponse:o,installmentOptions:a}=n.initializationData||{};return this._adyenClient=yield this._scriptLoader.load({paymentMethodsConfiguration:Object.assign({klarna:{useKlarnaWidget:!0},klarna_account:{useKlarnaWidget:!0},klarna_paynow:{useKlarnaWidget:!0}},a?{card:{installmentOptions:Object.assign({showInstallmentAmounts:!0},a)}}:{}),environment:i,locale:this._getLocale(),clientKey:r,paymentMethodsResponse:o,showPayButton:!1,translations:{es:{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-AR":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-ES":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-MX":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-CL":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-CO":{"creditCard.expiryDateField.title":"Fecha de caducidad"},"es-PE":{"creditCard.expiryDateField.title":"Fecha de caducidad"}}}),this._paymentComponent=yield this._mountPaymentComponent(n),n.method!==Ss.CreditCard&&n.method!==Ss.Bancontact||(this._cardVerificationComponent=yield this._mountCardVerificationComponent()),Promise.resolve()}))}execute(e,t){var n;return xs(this,void 0,void 0,(function*(){const{payment:i}=e,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!i)throw new Cr(["payment"]);const o=i.paymentData,{shouldSaveInstrument:a,shouldSetAsDefaultInstrument:s}=Ms(o)?o:{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1};this._validateCardData(),"klarna"!==i.methodId&&"klarna_account"!==i.methodId&&"klarna_paynow"!==i.methodId||null===(n=this._paymentComponent)||void 0===n||n.submit(),yield this._paymentIntegrationService.submitOrder(r,t);const d=this._componentState||{data:{paymentMethod:{type:i.methodId}}};if(o&&Es(o)){let e={};if(Ps(d)){const{encryptedCardNumber:t,encryptedSecurityCode:n,encryptedExpiryMonth:i,encryptedExpiryYear:r}=d.data.paymentMethod;e={credit_card_number_confirmation:t,expiry_month:i,expiry_year:r,verification_value:n}}try{return void(yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},i),{paymentData:{formattedPayload:{bigpay_token:Object.assign(Object.assign({},e),{token:o.instrumentId}),origin:window.location.origin,browser_info:ta(),set_as_default_stored_instrument:s||null}}})))}catch(e){return void(yield this._processAdditionalAction(e,a,s))}}let c=JSON.stringify(Object.assign(Object.assign({},d.data.paymentMethod),{type:i.methodId,origin:window.location.origin}));"boletobancario"===i.methodId&&function(e){var t,n;return"string"===("object"==typeof e&&typeof e.data.socialSecurityNumber)&&"string"==typeof(null===(t=e.data.shopperName)||void 0===t?void 0:t.firstName)&&"string"==typeof(null===(n=e.data.shopperName)||void 0===n?void 0:n.lastName)}(d)&&(c=JSON.stringify(Object.assign(Object.assign({socialSecurityNumber:d.data.socialSecurityNumber},d.data.shopperName),{type:i.methodId,origin:window.location.origin})));try{yield this._paymentIntegrationService.submitPayment({methodId:i.methodId,paymentData:{formattedPayload:Object.assign(Object.assign({credit_card_token:{token:c}},Ps(d)&&d.data.installments?{installments:{value:d.data.installments.value,plan:d.data.installments.plan||"regular"}}:{}),{browser_info:ta(),vault_payment_instrument:a||null,set_as_default_stored_instrument:s||null})}})}catch(e){yield this._processAdditionalAction(e,a,s)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return this._componentState=void 0,this._paymentComponent&&(this._paymentComponent.unmount(),this._paymentComponent=void 0),this._cardVerificationComponent&&(this._cardVerificationComponent.unmount(),this._cardVerificationComponent=void 0),Promise.resolve()}_updateComponentState(e){this._componentState=e}_getLocale(){const e=this._paymentIntegrationService.getState().getLocale();return e&&"es"===e.substring(0,2)?"es":e}_getAdyenClient(){if(!this._adyenClient)throw new Sn(gn.PaymentNotInitialized);return this._adyenClient}_getPaymentInitializeOptions(){if(!this._paymentInitializeOptions)throw new xn('"options.adyenv3" argument was not provided during initialization.');return this._paymentInitializeOptions}_handleAction(e){return new Promise(((t,n)=>{const{additionalActionOptions:i}=this._getPaymentInitializeOptions(),{onBeforeLoad:r,containerId:o,onLoad:a,onComplete:s,widgetSize:d,onActionHandled:c}=i,l=JSON.parse(e.action),u=this._getAdyenClient().createFromAction(l,{onActionHandled:e=>{c&&"function"==typeof c&&"3DS2Fingerprint"!==e.componentType&&c()},onAdditionalDetails:e=>{const n={methodId:l.paymentMethodType,paymentData:{nonce:JSON.stringify(e.data)}};s&&"function"==typeof s&&s(),t(n)},challengeWindowSize:d||"05",onError:e=>n(e)});r&&"function"==typeof r&&r(l.type===vs.ThreeDS2||l.type===vs.QRCode||l.type===vs.Sdk),this._mountElement(u,o),a&&"function"==typeof a&&a((()=>{n(new ai),u.unmount()}))}))}_mapAdyenPlaceholderData(e,t){if(!e)return{};const{firstName:n,lastName:i,address1:r,address2:o,postalCode:a,city:s,stateOrProvinceCode:d,countryCode:c}=e;return{holderName:t?`${n} ${i}`:"",firstName:t?n:"",lastName:t?i:"",billingAddress:{street:r,houseNumberOrName:o,postalCode:a,city:s,stateOrProvince:d,country:c}}}_mountCardVerificationComponent(){const e=this._getPaymentInitializeOptions(),t=this._getAdyenClient();let n;return new Promise(((i,r)=>{var o,a,s;if(e.cardVerificationContainerId){n=t.create(bs.SecuredFields,Object.assign(Object.assign({},e.options),{styles:Object.assign(Object.assign({},null===(o=e.options)||void 0===o?void 0:o.styles),{placeholder:Object.assign({color:"transparent",caretColor:"#000"},null===(s=null===(a=e.options)||void 0===a?void 0:a.styles)||void 0===s?void 0:s.placeholder)}),onChange:e=>this._updateComponentState(e),onError:t=>e.validateCardFields(t),onFieldValid:t=>e.validateCardFields(t)}));try{this._mountElement(n,e.cardVerificationContainerId)}catch(e){r(new Sn(gn.PaymentNotInitialized))}}i(n)}))}_mountPaymentComponent(e){let t;const n=this._getPaymentInitializeOptions(),i=this._getAdyenClient();return new Promise(((r,o)=>{const a=this._paymentIntegrationService.getState().getBillingAddress(),{prefillCardHolderName:s}=e.initializationData;t=i.create(e.method,Object.assign(Object.assign(Object.assign({},n.options),{showBrandsUnderCardNumber:!1,billingAddressRequired:!1,showEmailAddress:!1,onChange:e=>this._updateComponentState(e),onSubmit:e=>this._updateComponentState(e)}),a?{data:this._mapAdyenPlaceholderData(a,s)}:{}));try{this._mountElement(t,n.containerId)}catch(e){o(new Sn(gn.PaymentNotInitialized))}r(t)}))}_processAdditionalAction(e,t,n){return xs(this,void 0,void 0,(function*(){if(!Io(e)||!(0,c.some)(e.body.errors,{code:"additional_action_required"}))throw e;const i=yield this._handleAction(e.body.provider_data);try{yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},i),{paymentData:Object.assign(Object.assign({},i.paymentData),{shouldSaveInstrument:t,shouldSetAsDefaultInstrument:n})}))}catch(e){return this._processAdditionalAction(e,t,n)}}))}_validateCardData(){var e;const t=this._getPaymentInitializeOptions().hasVaultedInstruments?this._cardVerificationComponent:this._paymentComponent;if((null===(e=null==t?void 0:t.componentRef)||void 0===e?void 0:e.showValidation)&&t.state&&(t.componentRef.showValidation(),0===Object.keys(t.state).length||!t.state.isValid))throw new wr(this._mapCardErrors(t.state.errors))}_mapCardErrors(e={}){const t={};return Object.keys(e).forEach((n=>{t[n]=[{message:e[n],type:n}]})),t}_mountElement(e,t){document.getElementById(t)&&e.mount(`#${t}`)}}const zs=Ge((e=>new Ds(e,new Ns((0,s.vQ)(),(0,s._U)()))),[{gateway:"adyenv3"}]);var Fs,Bs=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Rs{constructor(e,t){this.paymentIntegrationService=e,this.affirmScriptLoader=t}initialize(e){return Bs(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.loadPaymentMethod(e.methodId);const t=this.paymentIntegrationService.getState(),{clientToken:n,config:{testMode:i}}=t.getPaymentMethodOrThrow(e.methodId);if(!n)throw new vn(yn.MissingPaymentMethod);this.affirm=yield this.affirmScriptLoader.load(n,i)}))}execute(e,t){var n;return Bs(this,void 0,void 0,(function*(){const i=null===(n=e.payment)||void 0===n?void 0:n.methodId,{useStoreCredit:r}=e;if(!this.affirm)throw new Sn(gn.PaymentNotInitialized);if(!i)throw new Cr(["payment.methodId"]);yield this.paymentIntegrationService.submitOrder({useStoreCredit:r},t);const o={methodId:i,paymentData:{nonce:(yield this.initializeAffirmCheckout()).checkout_token}};yield this.paymentIntegrationService.submitPayment(o)}))}deinitialize(){return this.affirm&&(this.affirm=void 0),Promise.resolve()}finalize(){return Promise.reject(new Os)}initializeAffirmCheckout(){var e;return null===(e=this.affirm)||void 0===e||e.checkout(this.getCheckoutInformation()),new Promise(((e,t)=>{var n,i;null===(n=this.affirm)||void 0===n||n.checkout.open({onFail:e=>{"canceled"===e.reason?t(new ai):t(new hr)},onSuccess:t=>{e(t)}}),null===(i=this.affirm)||void 0===i||i.ui.error.on("close",(()=>{t(new ai)}))}))}getCheckoutInformation(){const e=this.paymentIntegrationService.getState(),t=e.getStoreConfig(),n=e.getConsignments(),i=e.getOrder(),r=e.getCart();if(!t)throw new vn(yn.MissingCheckoutConfig);if(!i)throw new vn(yn.MissingCheckout);const o=new hs(i.currency.decimalPlaces),a=this.getBillingAddress(),s=this.getShippingAddress(),d=Jr(r,t)&&s?s:a;return{merchant:{user_confirmation_url:t.links.checkoutLink,user_cancel_url:t.links.checkoutLink,user_confirmation_url_action:"POST"},shipping:d,billing:a,items:this.getItems(o,i),metadata:{shipping_type:this.getShippingType(n),mode:"modal",platform_type:"BigCommerce",platform_version:"",platform_affirm:""},discounts:this.getDiscounts(o,i),order_id:i.orderId?i.orderId.toString():"",shipping_amount:o.toInteger(i.shippingCostTotal),tax_amount:o.toInteger(i.taxTotal),total:o.toInteger(i.orderAmount)}}getShippingType(e){if(!e)return"";const t=e[0];return(null==t?void 0:t.selectedShippingOption)?t.selectedShippingOption.type:""}getBillingAddress(){const e=this.paymentIntegrationService.getState().getBillingAddress();if(!e)throw new vn(yn.MissingBillingAddress);return{name:{first:e.firstName,last:e.lastName,full:`${e.firstName} ${e.lastName}`},address:{line1:e.address1,line2:e.address2,city:e.city,state:e.stateOrProvinceCode,zipcode:e.postalCode,country:e.countryCode},phone_number:e.phone,email:e.email}}getShippingAddress(){const e=this.paymentIntegrationService.getState().getShippingAddress();if(e)return{name:{first:e.firstName,last:e.lastName,full:`${e.firstName} ${e.lastName}`},address:{line1:e.address1,line2:e.address2,city:e.city,state:e.stateOrProvinceCode,zipcode:e.postalCode,country:e.countryCode},phone_number:e.phone}}getItems(e,t){const n=[];return t.lineItems.physicalItems.forEach((t=>{n.push({display_name:t.name,sku:t.sku,unit_price:e.toInteger(t.salePrice),qty:t.quantity,item_image_url:t.imageUrl,item_url:t.url,categories:this.getCategories(t.categories)})})),t.lineItems.digitalItems.forEach((t=>{n.push({display_name:t.name,sku:t.sku,unit_price:e.toInteger(t.salePrice),qty:t.quantity,item_image_url:t.imageUrl,item_url:t.url,categories:this.getCategories(t.categories)})})),t.lineItems.giftCertificates.forEach((t=>{n.push({display_name:t.name,sku:"",unit_price:e.toInteger(t.amount),qty:1,item_image_url:"",item_url:""})})),t.lineItems.customItems&&t.lineItems.customItems.forEach((t=>{n.push({display_name:t.name,sku:t.sku,unit_price:e.toInteger(t.listPrice),qty:t.quantity,item_image_url:"",item_url:""})})),n}getDiscounts(e,t){const n={};return t.coupons.forEach((t=>{t.discountedAmount>0&&(n[t.code]={discount_amount:e.toInteger(t.discountedAmount),discount_display_name:t.displayName})})),t.discountAmount>0&&(n.DISCOUNTED_AMOUNT={discount_amount:e.toInteger(t.discountAmount),discount_display_name:"discount"}),n}getCategories(e){return e?e.map((e=>e.map((e=>e.name)))):[[]]}}!function(e){e.PROD="//cdn1.affirm.com/js/v2/affirm.js",e.SANDBOX="//cdn1-sandbox.affirm.com/js/v2/affirm.js"}(Fs||(Fs={}));class Ls{constructor(e=window){this.affirmWindow=e}load(e="",t){const n=t?Fs.SANDBOX:Fs.PROD;if(function(e,t,n,i,r,o,a){const s=e[n]||{},d=document.createElement(o),c=document.getElementsByTagName(o)[0],l=function(e,t,n){return function(){e[t]._.push([n,arguments])}};s[i]=l(s,i,"set");const u=s[i];s[r]={},s[r]._=[],u._=[],s._=[],s[r][a]=l(s,r,a),s.jsReady=function(){s._.push([a,arguments])};let h=0;for(const e="set add save post open empty reset on off trigger ready setProduct".split(" ");h<e.length;h++)u[e[h]]=l(s,i,e[h]);let m=0;for(const e=["get","token","url","items"];m<e.length;m++)u[e[m]]=function(){};d.async=!0,d.src=t[o],c.parentNode&&c.parentNode.insertBefore(d,c),delete t[o],u(t),e[n]=s}(window,{public_api_key:e,script:n},"affirm","checkout","ui","script","ready"),!this.affirmWindow.affirm)throw new Tn;return Promise.resolve(this.affirmWindow.affirm)}}const js=Ge((e=>new Rs(e,new Ls)),[{id:"affirm"}]);class Us extends pn{constructor(e){super(e||"The current order could not be finalized successfully"),this.name="OrderFinalizationNotCompletedError",this.type="order_finalization_not_completed"}}var Vs,qs,Hs=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Gs{constructor(e,t){this._paymentIntegrationService=e,this._afterpayScriptLoader=t}initialize(e){var t;return Hs(this,void 0,void 0,(function*(){const n=this._paymentIntegrationService.getState(),i=n.getPaymentMethod(e.methodId,e.gatewayId),r=(null===(t=n.getCart())||void 0===t?void 0:t.currency.code)||"",o=this._mapCurrencyToISO2(r);if(!i)throw new vn(yn.MissingPaymentMethod);this._afterpaySdk=yield this._afterpayScriptLoader.load(i,o)}))}deinitialize(){return this._afterpaySdk&&(this._afterpaySdk=void 0),Promise.resolve()}execute(e,t){var n;return Hs(this,void 0,void 0,(function*(){if(!e.payment)throw new Cr(["payment.gatewayId","payment.methodId"]);const{gatewayId:i,methodId:r}=e.payment;if(!i||!r)throw new Cr(["payment.gatewayId","payment.methodId"]);const{useStoreCredit:o}=e;void 0!==o&&(yield this._paymentIntegrationService.applyStoreCredit(o)),yield this._loadPaymentMethod(i,r,t);const a=this._paymentIntegrationService.getState();yield this._paymentIntegrationService.validateCheckout(a.getCheckout(),t);const s=(null===(n=a.getCart())||void 0===n?void 0:n.currency.code)||"",d=this._mapCurrencyToISO2(s);return this._redirectToAfterpay(d,a.getPaymentMethod(r,i)),new Promise((()=>{}))}))}finalize(e){var t,n,i;return Hs(this,void 0,void 0,(function*(){const r=this._paymentIntegrationService.getState(),o=r.getPaymentId(),a=r.getContextConfig();if(!o)throw new vn(yn.MissingCheckout);if(!(null==a?void 0:a.payment.token))throw new vn(yn.MissingCheckoutConfig);const s={methodId:o.providerId,paymentData:{nonce:a.payment.token}};yield this._paymentIntegrationService.submitOrder({},e);try{yield this._paymentIntegrationService.submitPayment(s)}catch(e){if(yield this._paymentIntegrationService.forgetCheckout(o.providerId),yield this._paymentIntegrationService.loadPaymentMethods(),Io(e))throw new Us(null===(i=null===(n=null===(t=e.body)||void 0===t?void 0:t.errors)||void 0===n?void 0:n[0])||void 0===i?void 0:i.message)}}))}_redirectToAfterpay(e,t){if(!this._afterpaySdk||!(null==t?void 0:t.clientToken))throw new Sn(gn.PaymentNotInitialized);this._afterpaySdk.initialize({countryCode:e}),this._afterpaySdk.redirect({token:t.clientToken})}_mapCurrencyToISO2(e){return{AUD:"AU",NZD:"NZ",CAD:"CA",USD:"US"}[e]||"AU"}_loadPaymentMethod(e,t,n){var i;return Hs(this,void 0,void 0,(function*(){try{return yield this._paymentIntegrationService.loadPaymentMethod(e,Object.assign(Object.assign({},n),{params:Object.assign(Object.assign({},null==n?void 0:n.params),{method:t})}))}catch(e){if(e instanceof gi&&422===(null===(i=e.body)||void 0===i?void 0:i.status))throw new xn("Afterpay can't process your payment for this order, please try another payment method");throw e}}))}}!function(e){e.PROD="//portal.afterpay.com/afterpay-async.js",e.SANDBOX="//portal-sandbox.afterpay.com/afterpay-async.js"}(Vs||(Vs={})),function(e){e.PROD="//portal.afterpay.com/afterpay-async.js",e.SANDBOX="//portal.sandbox.afterpay.com/afterpay-async.js"}(qs||(qs={}));class $s{constructor(e){this._scriptLoader=e}load(e,t){return n=this,r=function*(){const n=e.config.testMode||!1,i=this._getScriptURI(t,n);return this._scriptLoader.loadScript(i).then((()=>{if(!("AfterPay"in window))throw new Tn;return window.AfterPay}))},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}_getScriptURI(e,t){return"US"===e?t?qs.SANDBOX:qs.PROD:t?Vs.SANDBOX:Vs.PROD}}const Ws=Ge((e=>new Gs(e,new $s((0,s.Hb)()))),[{gateway:"afterpay"},{id:"afterpay"}]);var Ys=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ks{constructor(e,t){this.paymentIntegrationService=e,this.amazonPayV2PaymentProcessor=t}initialize(e){return Ys(this,void 0,void 0,(function*(){const{methodId:t,amazonpay:n}=e;if(!t)throw new xn('Unable to proceed because "methodId" argument is not provided.');const i=this.paymentIntegrationService.getState(),{features:r}=i.getStoreConfigOrThrow().checkoutSettings,o=i.getPaymentMethodOrThrow(t),a=o.initializationData||{},{paymentToken:s="",region:d="",isButtonMicroTextDisabled:c}=a;if(yield this.amazonPayV2PaymentProcessor.initialize(o),this._isReadyToPay(s))(null==n?void 0:n.editButtonId)&&this._bindEditButton(n.editButtonId,s,"changePayment",this._isModalFlow(d));else{const{id:e}=this._createContainer();if(this._amazonPayButton=this.amazonPayV2PaymentProcessor.renderAmazonPayButton({checkoutState:i,containerId:e,decoupleCheckoutInitiation:this._isOneTimeTransaction(r,d.toUpperCase()),methodId:t,placement:_n.Checkout,isButtonMicroTextDisabled:c}),!this._amazonPayButton)throw new xn("Unable to render the Amazon Pay button to an invalid HTML container element.")}}))}execute(e,t){return Ys(this,void 0,void 0,(function*(){const{payment:n}=e;if(!n)throw new Cr(["payment"]);const{methodId:i}=n,r=this.paymentIntegrationService.getState(),{features:o}=r.getStoreConfigOrThrow().checkoutSettings,a=r.getPaymentMethodOrThrow(i).initializationData||{},{paymentToken:s="",region:d=""}=a;if(this._isReadyToPay(s)||this._isOneTimeTransaction(o,d.toUpperCase())){const n={methodId:i,paymentData:{nonce:s||"apb"}};yield this.paymentIntegrationService.submitOrder(e,t);try{return void(yield this.paymentIntegrationService.submitPayment(n))}catch(e){if(!(Io(e)&&(l=e.body,"object"==typeof l&&null!==l&&"status"in l&&"additional_action_required"in l&&"additional_action_required"===l.status&&"data"in l.additional_action_required&&"redirect_url"in l.additional_action_required.data&&"string"==typeof l.additional_action_required.data.redirect_url)))throw e;const{additional_action_required:t}=e.body,{redirect_url:n}=t.data;if(s)return new Promise((()=>window.location.assign(n)));this.amazonPayV2PaymentProcessor.prepareCheckout(JSON.parse(n))}}var l;return this._getAmazonPayButton().click(),this._isModalFlow(d)?new Promise(((e,t)=>{const n=()=>{window.removeEventListener("focus",n),t(new ai("Shopper needs to login to Amazonpay to continue"))};window.addEventListener("focus",n)})):new Promise(c.noop)}))}finalize(){return Promise.reject(new Os)}deinitialize(){return Ys(this,void 0,void 0,(function*(){yield this.amazonPayV2PaymentProcessor.deinitialize(),this._amazonPayButton=void 0}))}_bindEditButton(e,t,n,i){const r=document.getElementById(e);if(r&&r.parentNode){if(!i){const e=r.cloneNode(!0);r.parentNode.replaceChild(e,r),e.addEventListener("click",(()=>{this._showLoadingSpinner()}))}this.amazonPayV2PaymentProcessor.bindButton(e,t,n)}}_isModalFlow(e){return"us"===e}_showLoadingSpinner(){return Ys(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.widgetInteraction((()=>new Promise(c.noop)))}))}_createContainer(){let e=document.getElementById("AmazonPayButton");return e||(e=document.createElement("div"),e.id="AmazonPayButton",e.style.display="none",document.body.appendChild(e))}_getAmazonPayButton(){return bn(this._amazonPayButton,(()=>new Sn(gn.PaymentNotInitialized)))}_isOneTimeTransaction(e,t){return this.amazonPayV2PaymentProcessor.isPh4Enabled(e,t)&&e["INT-6399.amazon_pay_apb"]}_isReadyToPay(e){return!!e}}const Qs=Ge((e=>new Ks(e,Mn())),[{id:"amazonpay"}]);var Js,Zs=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};!function(e){e.Shipping="Shipping",e.Subtotal="Subtotal",e.StoreCredit="Store Credit"}(Js||(Js={}));class Xs{constructor(e,t,n,i,r){this._requestSender=e,this._paymentIntegrationService=t,this._sessionFactory=n,this._braintreeSdk=i,this._applePayScriptLoader=r,this._shippingLabel=Js.Shipping,this._subTotalLabel=Js.Subtotal,this._storeCreditLabel=Js.StoreCredit}initialize(e){var t,n,i,r;return Zs(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.methodId))throw new xn('Unable to submit payment because "options.methodId" argument is not provided.');const{methodId:o}=e;yield this._applePayScriptLoader.loadSdk(),this._shippingLabel=(null===(t=e.applepay)||void 0===t?void 0:t.shippingLabel)||Js.Shipping,this._subTotalLabel=(null===(n=e.applepay)||void 0===n?void 0:n.subtotalLabel)||Js.Subtotal,this._storeCreditLabel=(null===(i=e.applepay)||void 0===i?void 0:i.storeCreditLabel)||Js.StoreCredit;const a=(yield this._paymentIntegrationService.loadPaymentMethod(o)).getPaymentMethodOrThrow(o);(null===(r=a.initializationData)||void 0===r?void 0:r.gateway)===ii.BRAINTREE&&(yield this._initializeBraintreeSdk())}))}execute(e,t){return Zs(this,void 0,void 0,(function*(){const{payment:n}=e,i=this._paymentIntegrationService.getState();if(!n)throw new Cr(["payment"]);const{methodId:r}=n,o=i.getPaymentMethodOrThrow(r),a=this._getBaseRequest(i,o),s=this._sessionFactory.create(a);return yield this._paymentIntegrationService.submitOrder({useStoreCredit:e.useStoreCredit},t),s.begin(),new Promise(((e,t)=>{this._handleApplePayEvents(s,o,{resolve:e,reject:t})}))}))}finalize(){return Promise.reject(new Os)}deinitialize(){return Promise.resolve()}_getBaseRequest(e,t){const n=e.getCheckoutOrThrow(),i=e.getCartOrThrow(),r=e.getStoreConfigOrThrow(),{storeProfile:{storeCountryCode:o,storeName:a}}=r,{currency:{code:s,decimalPlaces:d}}=i,{initializationData:{merchantCapabilities:c,supportedNetworks:l}}=t,{grandTotal:u,isStoreCreditApplied:h,outstandingBalance:m}=n,p=[{label:this._subTotalLabel,amount:`${n.subtotal.toFixed(d)}`}];if(n.taxes.forEach((e=>p.push({label:e.name,amount:`${e.amount.toFixed(d)}`}))),p.push({label:this._shippingLabel,amount:`${n.shippingCostTotal.toFixed(d)}`}),h){const{storeCredit:t}=e.getCustomerOrThrow();p.push({label:this._storeCreditLabel,amount:`-${Math.min(u,t).toFixed(d)}`})}return{countryCode:o,currencyCode:s,merchantCapabilities:c,supportedNetworks:l,lineItems:p,total:{label:a,amount:`${m.toFixed(d)}`,type:"final"}}}_handleApplePayEvents(e,t,n){e.onvalidatemerchant=n=>Zs(this,void 0,void 0,(function*(){try{const{body:i}=yield this._onValidateMerchant(t,n);e.completeMerchantValidation(i)}catch(e){throw new Error("Merchant validation failed")}})),e.oncancel=()=>Zs(this,void 0,void 0,(function*(){return n.reject(new ai("Continue with applepay"))})),e.onpaymentauthorized=i=>this._onPaymentAuthorized(i,e,t,n)}_onValidateMerchant(e,t){return Zs(this,void 0,void 0,(function*(){const n=[`validationUrl=${t.validationURL}`,`merchantIdentifier=${e.initializationData.merchantId}`,`displayName=${e.initializationData.storeName}`,`domainName=${window.location.hostname}`].join("&");return this._requestSender.post(`${e.initializationData.paymentsUrl}/api/public/v1/payments/applepay/validate_merchant`,{credentials:!1,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded","X-XSRF-TOKEN":null},body:n})}))}_onPaymentAuthorized(e,t,n,i){var r;return Zs(this,void 0,void 0,(function*(){const{token:o}=e.payment;let a;(null===(r=n.initializationData)||void 0===r?void 0:r.gateway)===ii.BRAINTREE&&(a=yield this._getBraintreeDeviceData());const s={methodId:n.id,paymentData:{deviceSessionId:a,formattedPayload:{apple_pay_token:{payment_data:o.paymentData,payment_method:o.paymentMethod,transaction_id:o.transactionIdentifier}}}};try{return yield this._paymentIntegrationService.submitPayment(s),t.completePayment(ApplePaySession.STATUS_SUCCESS),i.resolve()}catch(e){return t.completePayment(ApplePaySession.STATUS_FAILURE),i.reject(new Sn(gn.PaymentNotInitialized))}}))}_getBraintreeDeviceData(){return Zs(this,void 0,void 0,(function*(){try{const{deviceData:e}=yield this._braintreeSdk.getDataCollectorOrThrow();return e}catch(e){}}))}_initializeBraintreeSdk(){return Zs(this,void 0,void 0,(function*(){const e=this._paymentIntegrationService.getState();let t=e.getPaymentMethod(ii.BRAINTREE_FASTLANE)||e.getPaymentMethod(ii.BRAINTREE);t||(yield this._paymentIntegrationService.loadPaymentMethod(ii.BRAINTREE),t=e.getPaymentMethod(ii.BRAINTREE)),t&&t.clientToken&&t.initializationData&&this._braintreeSdk.initialize(t.clientToken)}))}}const ed=Ge((e=>{const{getHost:t}=e.getState(),n=new Un(e);return new Xs((0,a.createRequestSender)({host:t()}),e,new ui,new ti(new oi((0,s.vQ)(),window,n)),new hi(new s.B2))}),[{id:"applepay"}]),td={"background-color":"rgba(0, 0, 0, 0.4)","z-index":"1000"};function nd(e){return"object"==typeof e&&null!==e&&"bigpayToken"in e&&"defaultInstrument"in e&&"provider"in e&&"trustedShippingAddress"in e&&"method"in e&&"type"in e}var id=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class rd{constructor(e,t,n){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.loadingIndicator=n}initialize(e){var t,n;return id(this,void 0,void 0,(function*(){const{methodId:i,bigcommerce_payments:r}=e||{};if(this.bigcommerce_payments=r,!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.bigcommerce_payments" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(i);const o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i);this.loadingIndicatorContainer=r.container.split("#")[1],(null===(t=o.initializationData)||void 0===t?void 0:t.orderId)?this.orderId=null===(n=o.initializationData)||void 0===n?void 0:n.orderId:(yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i),r.onInit&&"function"==typeof r.onInit&&r.onInit((()=>this.renderButton(i,r))),(void 0===r.shouldRenderPayPalButtonOnInitialization||r.shouldRenderPayPalButtonOnInitialization)&&this.renderButton(i,r))}))}execute(e,t){return id(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{onError:r}=this.bigcommerce_payments||{},o=this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,a=o&&o["PAYPAL-3438.handling_instrument_declined_error_ppc"];if(!n)throw new Cr(["payment"]);const{methodId:s,paymentData:d}=n;if(this.isPayPalVaultedInstrumentPaymentData(d)&&!this.orderId&&(this.orderId=yield this.createOrder()),!this.orderId)throw new hr;const c=this.isPayPalVaultedInstrumentPaymentData(d)?this.prepareVaultedInstrumentPaymentPayload(s,this.orderId,d):this.preparePaymentPayload(s,this.orderId,d);try{yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment(c)}catch(e){return this.isProviderError(e)&&a&&(yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n.methodId),yield new Promise(((e,t)=>{var i;this.bigcommerce_payments&&(null===(i=this.paypalButton)||void 0===i||i.close(),this.renderButton(n.methodId,this.bigcommerce_payments),this.handleError(new Error("INSTRUMENT_DECLINED"),r)),t()}))),this.handleError(e,r),Promise.reject()}}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}prepareVaultedInstrumentPaymentPayload(e,t,n){const{instrumentId:i,shouldSetAsDefaultInstrument:r}=n,o=!this.isTrustedVaultingFlow(n);return o?{methodId:e,paymentData:{shouldSaveInstrument:o,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t}}}}:{methodId:e,paymentData:{instrumentId:i,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t},bigpay_token:{token:i}}}}}preparePaymentPayload(e,t,n){const{shouldSaveInstrument:i=!1,shouldSetAsDefaultInstrument:r=!1}=Ms(n)?n:{};return{methodId:e,paymentData:{shouldSaveInstrument:i,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t}}}}}renderButton(e,t){const n=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u={fundingSource:n.FUNDING.PAYPAL,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o),createOrder:()=>this.createOrder(),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onError:e=>this.handleError(e,s),onCancel:()=>this.toggleLoadingIndicator(!1)};this.paypalButton=n.Buttons(u),this.paypalButton.isEligible()&&(d&&"function"==typeof d&&d(),this.paypalButton.render(a))}handleClick(e,t){return id(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;yield t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,t()}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}createOrder(){return id(this,void 0,void 0,(function*(){const e=this.getFieldsValues();return this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_paymentscheckout",{shouldSaveInstrument:(null==e?void 0:e.shouldSaveInstrument)||!1})}))}getFieldsValues(){const{getFieldsValues:e}=this.bigcommerce_payments||{};return"function"==typeof e?e():void 0}isTrustedVaultingFlow(e){if(e&&Es(e)){const t=this.paymentIntegrationService.getState().getInstruments(),n=null==t?void 0:t.find((t=>nd(t)&&t.bigpayToken===e.instrumentId));return!(nd(n)&&!n.trustedShippingAddress)}return!1}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}isPayPalVaultedInstrumentPaymentData(e){return!!e&&Es(e)&&Ms(e)}isProviderError(e){var t,n,i;return!!function(e){return"object"==typeof e&&null!==e&&"errors"in e}(e)&&"INSTRUMENT_DECLINED"===(null===(i=null===(n=((null===(t=null==e?void 0:e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error)))||[])[0])||void 0===n?void 0:n.provider_error)||void 0===i?void 0:i.code)}}const od=Ge((e=>new rd(e,Di(e),new cs({containerStyles:td}))),[{id:"bigcommerce_payments"}]);function ad(e){return!!e&&("authenticationState"in e||"addresses"in e||"instruments"in e)}var sd=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class dd{constructor(e,t,n,i){this.paymentIntegrationService=e,this.bigCommercePaymentsRequestSender=t,this.bigCommercePaymentsSdk=n,this.bigCommercePaymentsFastlaneUtils=i}initialize(e){var t,n;return sd(this,void 0,void 0,(function*(){const{methodId:i,bigcommerce_payments_fastlane:r}=e;if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(this.methodId=i,!r)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_fastlane" argument is not provided.');if(this.bigcommerce_payments_fastlane=r,!r.onInit||"function"!=typeof r.onInit)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_fastlane.onInit" argument is not provided or it is not a function.');if(!r.onChange||"function"!=typeof r.onChange)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_fastlane.onChange" argument is not provided or it is not a function.');yield this.paymentIntegrationService.loadPaymentMethod(i);const o=this.paymentIntegrationService.getState(),a=o.getCartOrThrow(),s=o.getPaymentMethodOrThrow(i),{isDeveloperModeApplicable:d,isFastlaneStylingEnabled:c}=s.initializationData||{};this.threeDSVerificationMethod=null===(t=s.initializationData)||void 0===t?void 0:t.threeDSVerificationMethod,this.paypalFastlaneSdk=yield this.bigCommercePaymentsSdk.getPayPalFastlaneSdk(s,a.currency.code,a.id);const l=tr(c?null===(n=null==s?void 0:s.initializationData)||void 0===n?void 0:n.fastlaneStyles:{},null==r?void 0:r.styles);yield this.bigCommercePaymentsFastlaneUtils.initializePayPalFastlane(this.paypalFastlaneSdk,!!d,l),this.shouldRunAuthenticationFlow()&&(yield this.runPayPalAuthenticationFlowOrThrow(i)),yield this.initializePayPalPaymentComponent(),r.onInit((e=>this.renderPayPalPaymentComponent(e))),r.onChange((()=>this.handlePayPalStoredInstrumentChange(i)))}))}execute(e,t){return sd(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);const{paymentData:r,methodId:o}=n,a=r&&Es(r);try{yield this.paymentIntegrationService.submitOrder(i,t);const e=a?yield this.prepareVaultedInstrumentPaymentPayload(o,r):yield this.preparePaymentPayload(o,r);yield this.paymentIntegrationService.submitPayment(e),this.bigCommercePaymentsFastlaneUtils.removeStorageSessionId()}catch(e){if(function(e){return"object"==typeof e&&null!==e&&"message"in e&&"response"in e&&"name"in e.response}(e)&&"INVALID_REQUEST"===e.response.name){const e={translationKey:"payment.errors.invalid_request_error"};return this.handleError(e),Promise.reject()}if(e instanceof Error&&"FastlaneError"!==e.name)throw e;return Promise.reject()}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return sd(this,void 0,void 0,(function*(){return Promise.resolve()}))}shouldRunAuthenticationFlow(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getCustomerOrThrow(),i=e.getPaymentProviderCustomer(),r=ad(i)?i:{},o=this.bigCommercePaymentsFastlaneUtils.getStorageSessionId();return!(!n.isGuest||(null==r?void 0:r.authenticationState)===$i.CANCELED||(null==r?void 0:r.authenticationState)||o!==t.id)}runPayPalAuthenticationFlowOrThrow(e){return sd(this,void 0,void 0,(function*(){try{const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getCustomer(),r=t.getBillingAddress(),o=(null==i?void 0:i.email)||(null==r?void 0:r.email)||"",{customerContextId:a}=yield this.bigCommercePaymentsFastlaneUtils.lookupCustomerOrThrow(o),s=yield this.bigCommercePaymentsFastlaneUtils.triggerAuthenticationFlowOrThrow(a),{authenticationState:d,addresses:c,instruments:l}=this.bigCommercePaymentsFastlaneUtils.mapPayPalFastlaneProfileToBcCustomerData(e,s);yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:d,addresses:c,instruments:l}),s.authenticationState===$i.CANCELED?this.bigCommercePaymentsFastlaneUtils.removeStorageSessionId():this.bigCommercePaymentsFastlaneUtils.updateStorageSessionId(n.id)}catch(e){}}))}initializePayPalPaymentComponent(){return sd(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),t=e.phone,n=`${e.firstName} ${e.lastName}`.trim(),i=this.bigCommercePaymentsFastlaneUtils.getPayPalFastlaneOrThrow(),r={fields:Object.assign({cardholderName:{prefill:n,enabled:!0}},t&&{phoneNumber:{prefill:t}})};this.paypalComponentMethods=yield i.FastlaneCardComponent(r)}))}renderPayPalPaymentComponent(e){const t=this.getPayPalComponentMethodsOrThrow();if(!e)throw new xn('Unable to render card component because "container" argument is not provided.');t.render(e)}getPayPalComponentMethodsOrThrow(){if(!this.paypalComponentMethods)throw new Tn;return this.paypalComponentMethods}prepareVaultedInstrumentPaymentPayload(e,t){return sd(this,void 0,void 0,(function*(){const{instrumentId:n}=t,i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),r=this.isBigcommercePaymentsFastlaneThreeDSAvailable()&&i.config.is3dsEnabled;r||(yield this.createOrder(n));const o=r?yield this.get3DSNonce(n):n;return{methodId:e,paymentData:{formattedPayload:{paypal_fastlane_token:{order_id:this.orderId,token:o}}}}}))}preparePaymentPayload(e,t){return sd(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getBillingAddressOrThrow(),r=n.getPaymentMethodOrThrow(e),o=`${i.firstName} ${i.lastName}`.trim(),{getPaymentToken:a}=this.getPayPalComponentMethodsOrThrow(),{id:s}=yield a({name:{fullName:o},billingAddress:this.bigCommercePaymentsFastlaneUtils.mapBcToPayPalAddress(i)}),d=this.isBigcommercePaymentsFastlaneThreeDSAvailable()&&r.config.is3dsEnabled;d||(yield this.createOrder(s));const{shouldSaveInstrument:c=!1,shouldSetAsDefaultInstrument:l=!1}=Ms(t)?t:{},u=d?yield this.get3DSNonce(s):s;return{methodId:e,paymentData:Object.assign(Object.assign({},t),{shouldSaveInstrument:c,shouldSetAsDefaultInstrument:l,formattedPayload:{paypal_fastlane_token:{order_id:this.orderId,token:u}}})}}))}createOrder(e){return sd(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getCartOrThrow().id;if(this.methodId){const{orderId:n}=yield this.bigCommercePaymentsRequestSender.createOrder(this.methodId,{cartId:t,fastlaneToken:e});this.orderId=n}}))}get3DSNonce(e){var t;return sd(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getCartOrThrow(),r=n.getOrderOrThrow(),o=n.getStoreConfigOrThrow().links.checkoutLink,a=null===(t=this.paypalFastlaneSdk)||void 0===t?void 0:t.ThreeDomainSecureClient;if(!a)throw new Tn;const s={amount:r.orderAmount.toFixed(2),currency:i.currency.code,nonce:e,threeDSRequested:"SCA_ALWAYS"===this.threeDSVerificationMethod,transactionContext:{experience_context:{locale:"en-US",return_url:o,cancel_url:o}}};if(yield a.isEligible(s)){const{liabilityShift:t,authenticationState:n,nonce:i}=yield a.show();if(t===vi.No||t===vi.Unknown)throw new hr;if(yield this.createOrder(e),n===Vi.Succeeded)return i;if(n===Vi.Errored)throw new hr;if(n===Vi.Cancelled)throw console.error("3DS check was canceled"),new hr}return e}))}handlePayPalStoredInstrumentChange(e){return sd(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsFastlaneUtils.getPayPalFastlaneOrThrow(),{selectionChanged:n,selectedCard:i}=yield t.profile.showCardSelector();if(n){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomer(),n=ad(t)?t:{},r=this.bigCommercePaymentsFastlaneUtils.mapPayPalToBcInstrument(e,i)[0];return yield this.paymentIntegrationService.updatePaymentProviderCustomer(Object.assign(Object.assign({},n),{instruments:[r]})),r}}))}isBigcommercePaymentsFastlaneThreeDSAvailable(){return Ze(this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,"PROJECT-7080.bcp_fastlane_three_ds")}handleError(e){var t;(null===(t=this.bigcommerce_payments_fastlane)||void 0===t?void 0:t.onError)&&"function"==typeof this.bigcommerce_payments_fastlane.onError&&this.bigcommerce_payments_fastlane.onError(e)}}const cd=Ge((e=>{const{getHost:t}=e.getState();return new dd(e,new Ni((0,a.createRequestSender)({host:t()})),Ki(),Xi())}),[{id:"bigcommerce_payments_fastlane"}]),ld=function({styles:e}){const t={};return e.color&&(t.color=e.color),e.layout&&(t.layout=e.layout),(e["logo-type"]||e["logo-position"])&&(t.logo={},e["logo-type"]&&(t.logo.type=e["logo-type"]),e["logo-position"]&&(t.logo.position=e["logo-position"])),e.ratio&&(t.ratio=e.ratio),(e["text-color"]||e["text-size"])&&(t.text={},e["text-color"]&&(t.text.color=e["text-color"]),e["text-size"]&&(t.text.size=+e["text-size"])),t};var ud=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class hd{constructor(e,t,n,i){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.loadingIndicator=n,this.paypalSdkHelper=i}initialize(e){return ud(this,void 0,void 0,(function*(){const{methodId:t,bigcommerce_payments_paylater:n}=e||{};if(!t)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_paylater" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(t);const i=this.paymentIntegrationService.getState(),r=i.getPaymentMethodOrThrow(t),{paypalBNPLConfiguration:o=[],orderId:a}=r.initializationData||{},{bannerContainerId:s,container:d}=n;if(void 0!==s){if(!document.getElementById(s))return void console.error("Unable to create banner without valid banner container ID.");const e=o&&o.find((({id:e})=>"checkout"===e));if(!(null==e?void 0:e.status))return;const t=yield this.paypalSdkHelper.getPayPalMessages(r,i.getCartOrThrow().currency.code);return this.renderMessages(t,s,e)}a?this.orderId=a:(yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(t),this.loadingIndicatorContainer=null==d?void 0:d.split("#")[1],this.renderButton(t,n))}))}execute(e,t){return ud(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);if(!this.orderId)throw new hr;yield this.paymentIntegrationService.submitOrder(i,t),yield this.bigCommercePaymentsIntegrationService.submitPayment(n.methodId,this.orderId)}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.bigCommercePaymentsButtons)||void 0===e||e.close(),Promise.resolve()}renderButton(e,t){if(!(null==t?void 0:t.container))throw new xn('Unable to initialize payment because "container" argument is not provided.');const n=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u=[n.FUNDING.PAYLATER,n.FUNDING.CREDIT];let h=!1;u.forEach((e=>{if(h)return;const t={fundingSource:e,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o),createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_paylater"),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onCancel:()=>this.toggleLoadingIndicator(!1),onError:e=>this.handleError(e,s)};if(this.bigCommercePaymentsButtons=n.Buttons(t),this.bigCommercePaymentsButtons.isEligible()||e!==n.FUNDING.PAYLATER){if(!this.bigCommercePaymentsButtons.isEligible()&&e===n.FUNDING.CREDIT)throw new Dn(`BigCommercePayments ${e} is not available for your region. Please use BigCommercePayments Checkout instead.`);d&&"function"==typeof d&&d(),this.bigCommercePaymentsButtons.render(a),h=!0}}))}handleClick(e,t){return ud(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;t&&"function"==typeof t&&(yield t((()=>(this.toggleLoadingIndicator(!0),n())),i))}))}handleApprove({orderID:e},t){this.orderId=e,t&&"function"==typeof t&&t()}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"payment",style:ld(n)};e.Messages(i).render(`#${t}`)}}const md=Ge((e=>new hd(e,Di(e),new cs({containerStyles:td}),Ki())),[{id:"bigcommerce_payments_paylater"}]);class pd extends gi{constructor(e){super(e,{message:"The request has timed out or aborted."}),this.name="TimeoutError",this.type="timeout"}}var yd=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class gd{constructor(e,t,n,i=3e3,r=3e5){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.loadingIndicator=n,this.pollingInterval=i,this.maxPollingIntervalTime=r,this.pollingTimer=0,this.stopPolling=c.noop}initialize(e){return yd(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,bigcommerce_payments_ratepay:i}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_ratepay" argument is not provided.');const{legalTextContainer:r,container:o,loadingContainerId:a}=i;if(!o)throw new xn('Unable to initialize payment because "options.container" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.legalTextContainer" argument is not provided.');if(!a)throw new xn('Unable to initialize payment because "options.loadingContainerId" argument is not provided.');this.loadingIndicatorContainer=a;const s=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n,t),{merchantId:d}=s.initializationData||{};if(!d)throw new xn("Unable to initialize payment because merchantId argument is not provided.");this.bigcommerce_payments_ratepay=i,yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(n),this.createFraudNetScript(d,n,t),this.loadFraudnetConfig(),this.renderLegalText(r,o)}))}execute(e,t){return yd(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{getFieldsValues:r}=this.bigcommerce_payments_ratepay||{};if(!n)throw new Cr(["payment"]);if(!r||"function"!=typeof r)throw new xn('Unable to initialize payment because "options.getFieldsValues" argument is not provided.');this.toggleLoadingIndicator(!0);try{const e=yield this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_apmscheckout",{metadataId:this.guid}),{ratepayBirthDate:o,ratepayPhoneNumber:a,ratepayPhoneCountryCode:s}=r(),d={formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:null,method_id:n.methodId,rate_pay:{birth_date:this.normalizeDate(o),phone:{national_number:a,country_code:s.split("+")[1]}},paypal_account:{order_id:e}}};return yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment({methodId:n.methodId,paymentData:d}),yield new Promise(((e,t)=>{this.initializePollingMechanism(n.methodId,e,t,n.gatewayId)}))}catch(e){return this.handleError(e),new Promise(((e,t)=>t()))}}))}finalize(){return Promise.reject(new Os)}deinitialize(){const{legalTextContainer:e}=this.bigcommerce_payments_ratepay||{},t=document.querySelectorAll('[data-id="fraudnetScript"]')[0],n=document.querySelectorAll('[data-id="fraudnetConfig"]')[0];if(this.deinitializePollingMechanism(),t.remove(),n.remove(),e){const t=document.getElementById(e);null==t||t.remove()}return Promise.resolve()}normalizeDate(e){const t=this.formatDate(e.getDate()),n=this.formatDate(e.getMonth()+1);return`${e.getFullYear()}-${n}-${t}`}formatDate(e){return`${e<10?0:""}${e}`}renderLegalText(e,t){const n=e,i=t.split("#")[1],r=document.getElementById(i),o=null==r?void 0:r.parentNode,a=document.createElement("div");a.style.marginBottom="20px",a.setAttribute("id",n),null==o||o.prepend(a);const s=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),d=s.Legal({fundingSource:s.Legal.FUNDING.PAY_UPON_INVOICE});if(!document.getElementById(n))throw new xn('Unable to initialize payment because "legalTextContainerElement" argument is not found.');d.render(`#${n}`)}handleError(e){const{onError:t}=this.bigcommerce_payments_ratepay||{};this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}createFraudNetScript(e,t,n){const i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t,n),{testMode:r}=i.config,o=document.createElement("script");o.setAttribute("type","application/json"),o.setAttribute("fncls","fnparams-dede7cc5-15fd-4c75-a9f4-36c430ee3a99"),o.setAttribute("data-id","fraudnetScript"),this.guid=this.generateGUID();const a={f:this.guid,s:`${e}_checkout-page`,sandbox:r};o.innerHTML=JSON.stringify(a),document.body.appendChild(o)}generateGUID(){let e="";for(let t=0;t<32;t+=1)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())];return e}loadFraudnetConfig(){const e=document.createElement("script");e.setAttribute("data-id","fraudnetConfig"),e.src="https://c.paypal.com/da/r/fb.js",document.body.appendChild(e)}reinitializeStrategy(e){return yd(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}initializePollingMechanism(e,t,n,i){return yd(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.bigCommercePaymentsIntegrationService.getOrderStatus("bigcommerce_payments_apms",{params:{useMetadata:!0}}),o=r===_i.PollingStop,a=r===_i.PollingError;if(o)return this.deinitializePollingMechanism(),t();if(a)return n();if(!o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,bigcommerce_payments_ratepay:this.bigcommerce_payments_ratepay}),this.handleError(new pd)}catch(e){this.handleError(e),n()}}))}deinitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deinitializePollingMechanism()}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const vd=Ge((e=>new gd(e,Di(e),new cs({containerStyles:Object.assign(Object.assign({},td),{position:"fixed"})}))),[{gateway:"bigcommerce_payments_apms",id:"ratepay"}]);var fd;!function(e){e.CardCode="cardCode",e.CardCodeVerification="cardCodeVerification",e.CardExpiry="cardExpiry",e.CardName="cardName",e.CardNumber="cardNumber",e.CardNumberVerification="cardNumberVerification",e.CardExpiryVerification="cardExpiryVerification"}(fd||(fd={}));const bd=fd;function Sd(e){return bd.CardNumber in e&&bd.CardName in e&&bd.CardExpiry in e}function Cd(e){return bd.CardNumberVerification in e&&bd.CardCodeVerification in e&&bd.CardExpiryVerification in e}var wd=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class _d{constructor(e,t,n,i){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.bigCommercePaymentsSdk=n,this.bigCommercePaymentsFastlaneUtils=i}initialize(e){return wd(this,void 0,void 0,(function*(){const{methodId:t,bigcommerce_payments_creditcards:n}=e,i=n,{form:r,onCreditCardFieldsRenderingError:o}=i||{};if(!t)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new xn('Unable to proceed because "options.bigcommerce_payments_creditcards.form" argument is not provided.');this.hostedFormOptions=r,this.isCreditCardForm=Sd(r.fields),this.isCreditCardVaultedForm=Cd(r.fields)&&!this.hasUndefinedValues(),yield this.paymentIntegrationService.loadPaymentMethod(t),yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(t,void 0,!0,!0),(this.isCreditCardForm||this.isCreditCardVaultedForm)&&(yield this.initializeFields(r,o)),this.shouldInitializePayPalFastlane(t)&&(yield this.initializePayPalFastlaneOrThrow(t))}))}execute(e,t){return wd(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{methodId:r,paymentData:o}=n||{};if(!n||!r)throw new Cr(["payment"]);if(this.executionPaymentData=o,this.isCreditCardForm||this.isCreditCardVaultedForm)yield this.validateHostedFormOrThrow(),yield this.submitHostedForm();else{const{orderId:e}=yield this.bigCommercePaymentsIntegrationService.createOrderCardFields("bigcommerce_payments_creditcardscheckout",this.getInstrumentParams());this.returnedOrderId=e}const a=this.preparePaymentPayload(r,o,this.returnedOrderId,this.returnedVaultedToken);yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment(a)}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e,t,n,i;return wd(this,void 0,void 0,(function*(){return yield null===(e=this.cvvField)||void 0===e?void 0:e.close(),yield null===(t=this.expiryField)||void 0===t?void 0:t.close(),yield null===(n=this.numberField)||void 0===n?void 0:n.close(),yield null===(i=this.nameField)||void 0===i?void 0:i.close(),Promise.resolve()}))}preparePaymentPayload(e,t,n,i){const{shouldSaveInstrument:r=!1,shouldSetAsDefaultInstrument:o=!1}=Ms(t)?t:{},a=t&&Es(t)?t.instrumentId:void 0,s=(0,c.omitBy)({verification_nonce:i,token:a},c.isNil);return{methodId:e,paymentData:{shouldSaveInstrument:r,shouldSetAsDefaultInstrument:o,instrumentId:a,formattedPayload:Object.assign(Object.assign({},i||a?{bigpay_token:s}:{}),n?{card_with_order:{order_id:n}}:{})}}}initializeFields(e,t){return wd(this,void 0,void 0,(function*(){const{fields:n,styles:i}=e,r=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),o=this.getExecuteCallback(n),a=Object.assign({style:this.getInputStyles(i),onApprove:({orderID:e,vaultSetupToken:t,liabilityShift:n})=>{if(n===vi.No||n===vi.Unknown)throw new Error;return this.handleApprove({orderID:e,vaultSetupToken:t})},onError:()=>{throw new ur},inputEvents:{onChange:t=>this.onChangeHandler(e,t),onFocus:t=>this.onFocusHandler(e,t),onBlur:t=>this.onBlurHandler(e,t),onInputSubmitRequest:t=>this.onInputSubmitRequest(e,t)}},o);if(this.cardFields=yield r.CardFields(a),!this.cardFields.isEligible())throw new Sn(gn.PaymentNotInitialized);try{this.stylizeInputContainers(n),Sd(n)&&(yield this.renderFields(n)),Cd(n)&&(yield this.renderVaultedFields(n))}catch(e){"function"==typeof t&&t(e)}}))}getExecuteCallback(e){return Cd(e)?this.createVaultSetupTokenCallback():this.createOrderCallback()}createVaultSetupTokenCallback(){return{createVaultSetupToken:()=>wd(this,void 0,void 0,(function*(){const{setupToken:e}=(yield this.bigCommercePaymentsIntegrationService.createOrderCardFields("bigcommerce_payments_creditcardscheckout",Object.assign(Object.assign({},this.getInstrumentParams()),{setupToken:!0})))||{};return e}))}}createOrderCallback(){return{createOrder:()=>wd(this,void 0,void 0,(function*(){const{orderId:e}=(yield this.bigCommercePaymentsIntegrationService.createOrderCardFields("bigcommerce_payments_creditcardscheckout",this.getInstrumentParams()))||{};return e}))}}handleApprove({orderID:e,vaultSetupToken:t}){e&&(this.returnedOrderId=e),t&&(this.returnedVaultedToken=t)}renderFields(e){var t,n,i,r;return wd(this,void 0,void 0,(function*(){const o=this.getCardFieldsOrThrow();(null===(t=e.cardCode)||void 0===t?void 0:t.containerId)&&(this.cvvField=o.CVVField({placeholder:""}),yield this.cvvField.render(`#${e.cardCode.containerId}`)),(null===(n=e.cardExpiry)||void 0===n?void 0:n.containerId)&&(this.expiryField=o.ExpiryField(),yield this.expiryField.render(`#${e.cardExpiry.containerId}`)),(null===(i=e.cardName)||void 0===i?void 0:i.containerId)&&(this.nameField=o.NameField({placeholder:""}),yield this.nameField.render(`#${e.cardName.containerId}`)),(null===(r=e.cardNumber)||void 0===r?void 0:r.containerId)&&(this.numberField=o.NumberField({placeholder:""}),yield this.numberField.render(`#${e.cardNumber.containerId}`))}))}renderVaultedFields(e){var t,n,i;return wd(this,void 0,void 0,(function*(){const r=this.getCardFieldsOrThrow();(null===(t=e.cardCodeVerification)||void 0===t?void 0:t.containerId)&&(this.cvvField=r.CVVField({placeholder:""}),yield this.cvvField.render(`#${e.cardCodeVerification.containerId}`)),(null===(n=e.cardExpiryVerification)||void 0===n?void 0:n.containerId)&&(this.expiryField=r.ExpiryField(),yield this.expiryField.render(`#${e.cardExpiryVerification.containerId}`)),(null===(i=e.cardNumberVerification)||void 0===i?void 0:i.containerId)&&(this.numberField=r.NumberField({placeholder:""}),yield this.numberField.render(`#${e.cardNumberVerification.containerId}`))}))}getInstrumentParams(){if(!this.executionPaymentData)return{};if(Ms(this.executionPaymentData)){const{shouldSaveInstrument:e,shouldSetAsDefaultInstrument:t}=this.executionPaymentData;return{shouldSaveInstrument:e,shouldSetAsDefaultInstrument:t}}if(Es(this.executionPaymentData)){const{instrumentId:e}=this.executionPaymentData;return{instrumentId:e}}return{}}getFieldTypeByEmittedField({emittedBy:e}){return{fieldType:this.mapFieldType(e)}}submitHostedForm(){return wd(this,void 0,void 0,(function*(){const e=this.getCardFieldsOrThrow(),t=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),n={billingAddress:{company:t.company,addressLine1:t.address1,addressLine2:t.address2,adminArea1:t.stateOrProvinceCode,adminArea2:t.city,postalCode:t.postalCode,countryCode:t.countryCode}};try{this.isCreditCardVaultedForm?yield e.submit():yield e.submit(n)}catch(e){throw new ur("Failed authentication. Please try to authorize again.")}}))}validateHostedFormOrThrow(){var e,t;return wd(this,void 0,void 0,(function*(){const n=this.getCardFieldsOrThrow(),i=yield n.getState().then((e=>e)),r=this.getValidityData(i);if(!r.isValid)throw null===(t=null===(e=this.hostedFormOptions)||void 0===e?void 0:e.onValidate)||void 0===t||t.call(e,r),new wr(this.mapValidationErrors(r.errors))}))}getValidityData({fields:e}){const t=Object.assign({},e);delete t.cardNameField;const n=Object.keys(t);return{isValid:n.every((e=>{var n;return null===(n=t[e])||void 0===n?void 0:n.isValid})),errors:n.reduce(((e,n)=>{var i;const r=this.mapFieldType(n);return Object.assign(Object.assign({},e),{[r]:(null===(i=t[n])||void 0===i?void 0:i.isValid)?void 0:[this.getInvalidErrorByFieldType(r)]})}),{})}}getInvalidErrorByFieldType(e){switch(e){case bd.CardCode:case bd.CardCodeVerification:return{fieldType:e,message:"Invalid card code",type:"invalid_card_code"};case bd.CardNumber:case bd.CardNumberVerification:return{fieldType:e,message:"Invalid card number",type:"invalid_card_number"};case bd.CardExpiry:case bd.CardExpiryVerification:return{fieldType:e,message:"Invalid card expiry",type:"invalid_card_expiry"};default:return{fieldType:e,message:"Invalid field",type:"invalid"}}}mapValidationErrors(e={}){const t={};return Object.keys(e).forEach((n=>{var i,r;t[n]=[{message:(null===(r=null===(i=e[n])||void 0===i?void 0:i[0])||void 0===r?void 0:r.message)||"",type:n}]})),t}mapFieldType(e){switch(e){case"name":return bd.CardName;case"cardNumberField":case"number":return this.isCreditCardForm?bd.CardNumber:bd.CardNumberVerification;case"cardExpiryField":case"expiry":return this.isCreditCardForm?bd.CardExpiry:bd.CardExpiryVerification;case"cardCvvField":case"cvv":return this.isCreditCardForm?bd.CardCode:bd.CardCodeVerification;default:throw new Error("Unexpected field type")}}getCardFieldsOrThrow(){if(!this.cardFields)throw new Sn(gn.PaymentNotInitialized);return this.cardFields}getInputStyles(e){var t,n,i;const r={"font-size":(null===(t=null==e?void 0:e.default)||void 0===t?void 0:t.fontSize)||"1rem","font-family":(null===(n=null==e?void 0:e.default)||void 0===n?void 0:n.fontFamily)||"Montserrat, Arial, Helvetica, sans-serif","font-weight":(null===(i=null==e?void 0:e.default)||void 0===i?void 0:i.fontWeight)||"400",outline:"none",padding:"9px 13px"},o=Object.assign(Object.assign({},r),{color:"#333333"});return{input:o,".invalid":Object.assign(Object.assign({},r),{color:"red"}),".valid":o,":focus":o}}stylizeInputContainers(e){Object.values(e||{}).forEach((e=>{const t=document.getElementById(`${(null==e?void 0:e.containerId)||""}`);t&&(t.style.padding="0px",t.style.boxShadow="none",t.style.border="none",t.style.background="transparent",t.style.marginBottom="10px",t.style.marginLeft="-5px")}))}hasUndefinedValues(){return!this.hostedFormOptions||Object.values(this.hostedFormOptions.fields).some((e=>void 0===e))}onChangeHandler(e,t){var n;null===(n=null==e?void 0:e.onValidate)||void 0===n||n.call(e,this.getValidityData(t))}onFocusHandler(e,t){var n;null===(n=null==e?void 0:e.onFocus)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}onBlurHandler(e,t){var n;null===(n=null==e?void 0:e.onBlur)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}onInputSubmitRequest(e,t){var n;null===(n=null==e?void 0:e.onEnter)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}shouldInitializePayPalFastlane(e){var t,n;const i=this.paymentIntegrationService.getState(),r=i.getPaymentMethodOrThrow(e),o=i.getPaymentProviderCustomer(),a=(s=o)&&("authenticationState"in s||"addresses"in s||"instruments"in s)?o:{};var s;return(null===(t=null==r?void 0:r.initializationData)||void 0===t?void 0:t.isAcceleratedCheckoutEnabled)&&(null===(n=null==r?void 0:r.initializationData)||void 0===n?void 0:n.isBigCommercePaymentsAnalyticsV2Enabled)&&!(null==a?void 0:a.authenticationState)}initializePayPalFastlaneOrThrow(e){return wd(this,void 0,void 0,(function*(){try{const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getPaymentMethodOrThrow(e),{initializationData:r}=i;if(!(null==r?void 0:r.connectClientToken))return;const o=yield this.bigCommercePaymentsSdk.getPayPalFastlaneSdk(i,n.currency.code,n.id);yield this.bigCommercePaymentsFastlaneUtils.initializePayPalFastlane(o,!!(null==r?void 0:r.isDeveloperModeApplicable))}catch(e){}}))}}const Id=Ge((e=>new _d(e,Di(e),Ki(),Xi())),[{id:"bigcommerce_payments_creditcards"}]);var Pd=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ed{constructor(e,t,n,i,r=3e3,o=3e5){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.bigCommercePaymentsSdkHelper=n,this.loadingIndicator=i,this.pollingInterval=r,this.maxPollingIntervalTime=o,this.pollingTimer=0,this.stopPolling=c.noop,this.isPollingEnabled=!1}initialize(e){return Pd(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,bigcommerce_payments_apms:i}=e;if(this.bigCommercePaymentsAlternativeMethods=i,!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_apms" argument is not provided.');const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(n,t),{orderId:a,shouldRenderFields:s}=o.initializationData||{},d=r.getStoreConfigOrThrow().checkoutSettings.features;this.isPollingEnabled=Ze(d,"PAYPAL-5624.bcp_ideal_polling"),a?this.orderId=a:(this.paypalApms=yield this.bigCommercePaymentsSdkHelper.getPayPalApmsSdk(o,r.getCartOrThrow().currency.code),this.loadingIndicatorContainer=i.container.split("#")[1],this.renderButton(n,t,i),s&&this.renderFields(n,i))}))}execute(e,t){return Pd(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);const{methodId:r,gatewayId:o}=n;if(!this.orderId)throw new hr;this.isPollingEnabled&&"ideal"===r&&(yield new Promise(((e,t)=>{this.initializePollingMechanism(r,e,t,o)}))),this.isNonInstantPaymentMethod(r)||(yield this.paymentIntegrationService.submitOrder(i,t)),yield this.bigCommercePaymentsIntegrationService.submitPayment(r,this.orderId,o)}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this.orderId=void 0,this.isPollingEnabled&&this.resetPollingMechanism(),null===(e=this.bigCommercePaymentsButton)||void 0===e||e.close(),Promise.resolve()}initializePollingMechanism(e,t,n,i){return Pd(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.bigCommercePaymentsIntegrationService.getOrderStatus(i),o=r===_i.Approved,a=r===_i.PollingError;if(o)return this.deInitializePollingMechanism(),t();if(a)return n();if(!o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,bigCommercePaymentsAlternativeMethods:this.bigCommercePaymentsAlternativeMethods}),this.handleError(new pd)}catch(e){n()}}))}deInitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deInitializePollingMechanism()}reinitializeStrategy(e){return Pd(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}handleError(e){const{onError:t}=this.bigCommercePaymentsAlternativeMethods||{};this.isPollingEnabled&&this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}renderButton(e,t,n){const i=this.getPaypalAmpsSdkOrThrow(),r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t),{buttonStyle:o}=r.initializationData||{},{container:a,onError:s,onRenderButton:d,submitForm:c}=n,l={fundingSource:e,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o),onInit:(e,t)=>n.onInitButton(t),createOrder:()=>this.onCreateOrder(e,t,n),onApprove:e=>this.handleApprove(e,c),onCancel:()=>{this.toggleLoadingIndicator(!1),this.deInitializePollingMechanism()},onError:e=>{this.deInitializePollingMechanism(),this.handleFailure(e,s)},onClick:(e,t)=>Pd(this,void 0,void 0,(function*(){return n.onValidate(t.resolve,t.reject)}))};this.bigCommercePaymentsButton=i.Buttons(l),this.bigCommercePaymentsButton.isEligible()&&(d&&"function"==typeof d&&d(),this.bigCommercePaymentsButton.render(a))}onCreateOrder(e,t,n){return Pd(this,void 0,void 0,(function*(){const{onValidate:i}=n;yield i((()=>(this.toggleLoadingIndicator(!0),()=>Promise.resolve())),c.noop);const r=yield this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_apms");if(this.isNonInstantPaymentMethod(e)){const n={useStoreCredit:!1},i={params:{methodId:e,gatewayId:t}};yield this.paymentIntegrationService.submitOrder(n,i),yield this.bigCommercePaymentsIntegrationService.submitPayment(e,r,t)}return r}))}handleApprove({orderID:e},t){this.orderId=e,t()}handleFailure(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}renderFields(e,t){const n=this.getPaypalAmpsSdkOrThrow(),i=this.paymentIntegrationService.getState(),{firstName:r,lastName:o,email:a}=i.getBillingAddressOrThrow(),{apmFieldsContainer:s,apmFieldsStyles:d}=t;if(!s)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_apms" argument should contain "apmFieldsContainer".');const c=document.querySelector(s);c&&(c.innerHTML="");const l={fundingSource:e,style:d||{},fields:{name:{value:`${r} ${o}`},email:{value:a}}};n.PaymentFields(l).render(s)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}isNonInstantPaymentMethod(e){return e.toUpperCase()in wi}getPaypalAmpsSdkOrThrow(){if(!this.paypalApms)throw new Tn;return this.paypalApms}}const Od=Ge((e=>new Ed(e,Di(e),Ki(),new cs({containerStyles:td}))),[{gateway:"bigcommerce_payments_apms"}]);var Ad=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class kd{constructor(e,t,n){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.loadingIndicator=n}initialize(e){var t,n;return Ad(this,void 0,void 0,(function*(){const{methodId:i,bigcommerce_payments_venmo:r}=e||{};if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_venmo" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(i);const o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i);(null===(t=o.initializationData)||void 0===t?void 0:t.orderId)?this.orderId=null===(n=o.initializationData)||void 0===n?void 0:n.orderId:(yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i),this.loadingIndicatorContainer=r.container.split("#")[1],this.renderButton(i,r))}))}execute(e,t){return Ad(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);if(!this.orderId)throw new hr;yield this.paymentIntegrationService.submitOrder(i,t),yield this.bigCommercePaymentsIntegrationService.submitPayment(n.methodId,this.orderId)}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}renderButton(e,t){const n=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u={fundingSource:n.FUNDING.VENMO,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o),createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_venmo_checkout"),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onCancel:()=>this.toggleLoadingIndicator(!1),onError:e=>this.handleError(e,s)};if(this.paypalButton=n.Buttons(u),!this.paypalButton.isEligible())throw new Dn("Venmo is not available for your region. Please another payment method instead.");d&&"function"==typeof d&&d(),this.paypalButton.render(a)}handleClick(e,t){return Ad(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;yield t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,t(),this.toggleLoadingIndicator(!1)}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const Td=Ge((e=>new kd(e,Di(e),new cs({styles:{backgroundColor:"black"}}))),[{id:"bigcommerce_payments_venmo"}]);class Nd{initialize(e){this._blueSnapSdk=e}initialize3ds(e,t){return n=this,r=function*(){const n=this._getBlueSnapSdk();return new Promise(((i,r)=>{n.threeDsPaymentsSetup(e,(e=>"1"===e.code?i(e.threeDSecure.threeDSecureReferenceId):r(new ur))),n.threeDsPaymentsSubmitData(t)}))},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}_getBlueSnapSdk(){return bn(this._blueSnapSdk,(()=>new Sn(gn.PaymentNotInitialized)))}}function Md(e){return bd.CardNumber in e}function xd(e){return bd.CardCodeVerification in e||bd.CardNumberVerification in e}var Dd,zd,Fd,Bd,Rd,Ld=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class jd{constructor(e,t,n,i){this._scriptLoader=e,this._paymentIntegrationService=t,this._blueSnapDirectHostedForm=n,this._blueSnapDirect3ds=i}initialize(e){return Ld(this,void 0,void 0,(function*(){const{methodId:t,gatewayId:n,creditCard:i}=e;if(!n||!i)throw new xn;const r=yield this._paymentIntegrationService.loadPaymentMethod(n,{params:{method:t,bigpayToken:i.bigpayToken}}),{config:{testMode:o,is3dsEnabled:a},clientToken:s}=r.getPaymentMethodOrThrow(t,n);this._blueSnapSdk=yield this._scriptLoader.load(o),this._paymentFieldsToken=s,this._shouldUseHostedFields=Md(i.form.fields)||xd(i.form.fields)&&!!i.form.fields.cardNumberVerification,this._shouldUseHostedFields&&(this._blueSnapDirectHostedForm.initialize(this._blueSnapSdk,i.form.fields),yield this._blueSnapDirectHostedForm.attach(this._getPaymentFieldsToken(),i,a))}))}execute(e){return Ld(this,void 0,void 0,(function*(){if(!e.payment)throw new Cr(["payment"]);if(!this._blueSnapSdk)throw new Cr(["payment"]);const{paymentData:t}=e.payment,{shouldSaveInstrument:n,shouldSetAsDefaultInstrument:i}=Ms(t)?t:{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1},r=this._getPaymentFieldsToken();let o;const{is3dsEnabled:a}=this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e.payment.methodId,e.payment.gatewayId).config,s=this._shouldUseHostedFields?yield this._blueSnapDirectHostedForm.validate().submit(a?this._getBlueSnapDirectThreeDSecureData():void 0,!(Ms(t)&&Es(t))):void 0;if(yield this._paymentIntegrationService.submitOrder(),Ms(t)&&Es(t)&&this._paymentFieldsToken&&t.instrumentId){if(a){this._blueSnapDirect3ds.initialize(this._blueSnapSdk);const{last4:e,brand:n}=this._paymentIntegrationService.getState().getCardInstrumentOrThrow(t.instrumentId),i=Object.assign({last4Digits:e,ccType:n.toUpperCase()},this._getBlueSnapDirectThreeDSecureData());o=yield this._blueSnapDirect3ds.initialize3ds(this._paymentFieldsToken,i)}yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},e.payment),{paymentData:Object.assign(Object.assign(Object.assign({instrumentId:t.instrumentId},this._shouldUseHostedFields?{nonce:r}:{}),o?{deviceSessionId:o}:{}),{shouldSetAsDefaultInstrument:!!i})}))}else yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},e.payment),{paymentData:{formattedPayload:{credit_card_token:{token:JSON.stringify({pfToken:r,cardHolderName:s&&s.cardHolderName})},vault_payment_instrument:n,set_as_default_stored_instrument:i}}}))}))}finalize(){return Promise.reject(new Os)}deinitialize(){return this._shouldUseHostedFields&&this._blueSnapDirectHostedForm.detach(),Promise.resolve()}_getBlueSnapDirectThreeDSecureData(){var e;const{getBillingAddress:t,getShippingAddress:n,getCustomer:i,getCheckoutOrThrow:r,getCartOrThrow:o}=this._paymentIntegrationService.getState(),a=t(),s=n(),d=(null===(e=i())||void 0===e?void 0:e.email)||(null==a?void 0:a.email),c=(null==a?void 0:a.phone)||(null==s?void 0:s.phone);return Object.assign(Object.assign(Object.assign(Object.assign({amount:r().outstandingBalance,currency:o().currency.code},d&&{email:d}),c&&{phone:c}),a&&{billingFirstName:a.firstName,billingLastName:a.lastName,billingCountry:a.countryCode,billingCity:a.city,billingAddress:`${a.address1} ${a.address2}`.trim(),billingZip:a.postalCode}),s&&{shippingFirstName:s.firstName,shippingLastName:s.lastName,shippingCountry:s.countryCode,shippingCity:s.city,shippingAddress:`${s.address1} ${s.address2}`.trim(),shippingZip:s.postalCode})}_getPaymentFieldsToken(){return bn(this._paymentFieldsToken,(()=>new vn(yn.MissingPaymentToken)))}}!function(e){e.AMEX="american-express",e.CHINA_UNION_PAY="unionpay",e.DINERS="diners-club",e.DISCOVER="discover",e.JCB="jcb",e.MASTERCARD="mastercard",e.UNKNOWN="unknown",e.VISA="visa"}(Dd||(Dd={})),function(e){e.ON_BLUR="onBlur",e.ON_SUBMIT="onSubmit"}(zd||(zd={})),function(e){e.EMPTY="empty",e.INVALID="invalid",e.THREE_DS_NOT_ENABLED="3D Secure is not enabled"}(Fd||(Fd={})),function(e){e.CC_NOT_SUPORTED="22013",e.ERROR_403="403",e.ERROR_404="404",e.ERROR_500="500",e.INVALID_OR_EMPTY="10",e.SESSION_EXPIRED="400",e.THREE_DS_AUTH_FAILED="14101",e.THREE_DS_CLIENT_ERROR="14103",e.THREE_DS_MISSING_FIELDS="14102",e.THREE_DS_NOT_ENABLED="14100",e.TOKEN_EXPIRED="14040",e.TOKEN_NOT_ASSOCIATED="14042",e.TOKEN_NOT_FOUND="14041"}(Bd||(Bd={})),function(e){e.CardCode="cvv",e.CardExpiry="exp",e.CardName="noc",e.CardNumber="ccn"}(Rd||(Rd={}));const Ud={[Rd.CardNumber]:bd.CardNumber,[Rd.CardExpiry]:bd.CardExpiry,[Rd.CardName]:bd.CardName,[Rd.CardCode]:bd.CardCode},Vd={empty:{[bd.CardNumber]:{fieldType:"cardNumber",message:"Credit card number is required",type:"required"},[bd.CardNumberVerification]:{fieldType:"cardNumber",message:"Credit card number is required",type:"required"},[bd.CardExpiry]:{fieldType:"cardExpiry",message:"Expiration date is required",type:"required"},[bd.CardCode]:{fieldType:"cardCode",message:"CVV is required",type:"required"},[bd.CardName]:{fieldType:"cardName",message:"Full name is required",type:"required"}},invalid:{[bd.CardNumber]:{fieldType:"cardNumber",message:"Credit card number must be valid",type:"invalid_card_number"},[bd.CardNumberVerification]:{fieldType:"cardNumber",message:"Credit card number must be valid",type:"invalid_card_number"},[bd.CardExpiry]:{fieldType:"cardExpiry",message:"Expiration date must be a valid future date in MM / YY format",type:"invalid_card_expiry"},[bd.CardCode]:{fieldType:"cardCode",message:"CVV must be valid",type:"invalid_card_code"},[bd.CardName]:{fieldType:"cardName",message:"Full name is required",type:"required"}}};class qd{constructor(e,t){this._nameOnCardInput=e,this._hostedInputValidator=t}initialize(e,t){this._blueSnapSdk=e,t&&(Md(t)?this._hostedInputValidator.initialize():xd(t)&&t.cardNumberVerification&&this._hostedInputValidator.initializeValidationFields())}attach(e,t,n){var i,r,o,a=t.form,{fields:s}=a,d=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(a,["fields"]);return void 0===n&&(n=!1),i=this,o=function*(){const t=this._getBlueSnapSdk();if(!Md(s)&&!xd(s))throw new xn("Field options must be of type HostedCardFieldOptionsMap");return this._onValidate=d.onValidate,Md(s)&&this._setCustomBlueSnapAttributes(s),xd(s)&&this._setCustomStoredCardsBlueSnapAttributes(s),new Promise((i=>{const r=this._getHostedPaymentFieldsOptions(e,s,d,i,n);t.hostedPaymentFieldsCreate(r),Md(s)&&this._nameOnCardInput.attach(r,s.cardName.accessibilityLabel,s.cardName.placeholder)}))},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{s(o.next(e))}catch(e){t(e)}}function a(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,a)}s((o=o.apply(i,[])).next())}))}validate(){var e;const t=this._hostedInputValidator.validate();if(null===(e=this._onValidate)||void 0===e||e.call(this,t),!t.isValid){const e=Object.entries(t.errors).reduce(((e,[t,n])=>Object.assign(Object.assign({},e),{[t]:n.map((({message:e,type:t})=>({message:e,type:t})))})),{});throw new wr(e)}return this}submit(e,t=!1){return new Promise(((n,i)=>this._getBlueSnapSdk().hostedPaymentFieldsSubmitData((e=>this._isBlueSnapDirectCallbackError(e)?i(new ur(e.statusCode===Bd.THREE_DS_AUTH_FAILED?e.error[0].errorDescription:`Submission failed with status: ${e.statusCode} and errors: ${JSON.stringify(e.error)}`)):n(Object.assign(Object.assign({},e.cardData),t?{cardHolderName:this._nameOnCardInput.getValue()}:{}))),e)))}detach(){this._nameOnCardInput.detach()}_isBlueSnapDirectCallbackError(e){return"error"in e}_getHostedPaymentFieldsOptions(e,t,{onFocus:n,onBlur:i,onValidate:r,onCardTypeChange:o,onEnter:a,styles:s},d,c){var l;return Object.assign(Object.assign(Object.assign({token:e,onFieldEventHandler:{setupComplete:()=>d(),onFocus:this._usetUiEventCallback(n),onBlur:this._usetUiEventCallback(i),onError:this._handleError(r),onType:(e,t)=>null==o?void 0:o({cardType:Dd[t]}),onEnter:this._usetUiEventCallback(a),onValid:e=>null==r?void 0:r(this._hostedInputValidator.validate({tagId:e}))}},Md(t)&&{ccnPlaceHolder:t.cardNumber.placeholder||"",cvvPlaceHolder:(null===(l=t.cardCode)||void 0===l?void 0:l.placeholder)||"",expPlaceHolder:t.cardExpiry.placeholder||"MM / YY"}),s&&{style:this._mapStyles(s)}),{"3DS":c})}_mapStyles({default:e,error:t,focus:n}){return Object.entries(Object.assign(Object.assign(Object.assign({},e&&{input:e}),t&&{".invalid":t}),n&&{":focus":n})).reduce(((e,[t,n])=>Object.assign(Object.assign({},e),{[t]:Object.entries(n).reduce(((e,[t,n])=>Object.assign(Object.assign({},e),{[(0,c.kebabCase)(t)]:n})),{})})),{})}_handleError(e){return(t,n,i,r)=>{if(n===Bd.INVALID_OR_EMPTY&&t&&function(e){return void 0!==e&&[Fd.EMPTY,Fd.INVALID].includes(e)}(i))return null==e?void 0:e(this._hostedInputValidator.validate({tagId:t,errorDescription:i}));throw new ur(`An unexpected error has occurred: ${JSON.stringify({tagId:t,errorCode:n,errorDescription:i,eventOrigin:r})}`)}}_usetUiEventCallback(e){return t=>{e&&e({fieldType:Ud[t]})}}_getBlueSnapSdk(){return bn(this._blueSnapSdk,(()=>new Sn(gn.PaymentNotInitialized)))}_setCustomBlueSnapAttributes(e){const{cardNumber:t,cardExpiry:n,cardCode:i,cardName:r}=e,o=document.getElementById(t.containerId),a=document.getElementById(n.containerId),s=i&&document.getElementById(i.containerId),d=document.getElementById(r.containerId);if(!(o&&a&&s&&d))throw new xn("Unable to create hosted payment fields to invalid HTML container elements.");o.dataset.bluesnap=Rd.CardNumber,a.dataset.bluesnap=Rd.CardExpiry,s.dataset.bluesnap=Rd.CardCode,d.dataset.bluesnap=Rd.CardName}_setCustomStoredCardsBlueSnapAttributes(e){const{cardNumberVerification:t,cardCodeVerification:n}=e,i=t&&document.getElementById(t.containerId),r=n&&document.getElementById(n.containerId);(i||r)&&(i&&(i.dataset.bluesnap=Rd.CardNumber),r&&(r.dataset.bluesnap=Rd.CardCode))}}class Hd{constructor(){this._errors={}}initialize(){this._errors={cardNumber:[Vd.empty.cardNumber],cardExpiry:[Vd.empty.cardExpiry],cardCode:[Vd.empty.cardCode],cardName:[Vd.empty.cardName]}}initializeValidationFields(){this._errors={cardNumberVerification:[Vd.empty.cardNumber]}}validate(e){return e&&this._updateErrors(e.tagId,e.errorDescription),{isValid:Object.values(this._errors).every((e=>0===e.length)),errors:this._errors}}_updateErrors(e,t){const n=this._errors.cardNumberVerification?bd.CardNumberVerification:Ud[e];this._errors[n]=t?[Vd[t][n]]:[]}}class Gd{attach({style:e,onFieldEventHandler:{onFocus:t,onBlur:n,onValid:i,onError:r,onEnter:o}={}},a,s){var d;this._style=e,this._create(),this._getInput().addEventListener("focus",this._handleFocus(t)),this._getInput().addEventListener("blur",this._handleBlur(n,i,r)),this._getInput().addEventListener("enter",this._handleEnter(o)),a&&this._getInput().setAttribute("aria-label",a),s&&(this._getInput().placeholder=s),null===(d=document.querySelector('[data-bluesnap="noc"]'))||void 0===d||d.appendChild(this._getInput())}getValue(){return this._getInput().value}detach(){this._input&&(this._input.remove(),this._input=void 0)}_handleFocus(e){return()=>{var t;this._applyStyles(null===(t=this._style)||void 0===t?void 0:t[":focus"]),null==e||e(Rd.CardName)}}_handleBlur(e,t,n){return({target:i})=>{var r,o;null==e||e(Rd.CardName),i instanceof HTMLInputElement&&(/\w{1,200}/.test(i.value)?(this._applyStyles(null===(r=this._style)||void 0===r?void 0:r.input),null==t||t(Rd.CardName)):(this._applyStyles(null===(o=this._style)||void 0===o?void 0:o[".invalid"]),null==n||n(Rd.CardName,Bd.INVALID_OR_EMPTY,Fd.EMPTY,zd.ON_BLUR)))}}_handleEnter(e){return()=>null==e?void 0:e(Rd.CardName)}_applyStyles(e={}){const t={color:e.color,fontFamily:e["font-family"],fontSize:e["font-size"],fontWeight:e["font-weight"]},n=Object.keys(t);n.every((e=>["color","fontFamily","fontSize","fontWeight"].includes(e)))&&n.forEach((e=>{t[e]&&(this._getInput().style[e]=t[e]||"")}))}_configureInput(){this._getInput().autocomplete="cc-name",this._getInput().id=Rd.CardName,this._getInput().inputMode="text",this._getInput().maxLength=200,this._getInput().style.backgroundColor="transparent",this._getInput().style.border="0",this._getInput().style.height="100%",this._getInput().style.margin="0",this._getInput().style.outline="none",this._getInput().style.padding="0",this._getInput().style.width="100%",this._getInput().type="text"}_getInput(){return bn(this._input,(()=>new Sn(gn.PaymentNotInitialized)))}_create(){var e;this._input=document.createElement("input"),this._configureInput(),this._applyStyles(null===(e=this._style)||void 0===e?void 0:e.input)}}var $d;!function(e){e.PRODUCTION="https://pay.bluesnap.com/web-sdk/5/bluesnap.js",e.SANDBOX="https://sandpay.bluesnap.com/web-sdk/5/bluesnap.js"}($d||($d={}));class Wd{constructor(e,t=window){this._scriptLoader=e,this._window=t}load(e=!1){return t=this,i=function*(){if(this._window.bluesnap)return this._window.bluesnap;if(yield this._scriptLoader.loadScript(e?$d.SANDBOX:$d.PRODUCTION),!this._window.bluesnap)throw new Tn;return this._window.bluesnap},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}}const Yd=Ge((e=>new jd(new Wd((0,s.vQ)()),e,new qd(new Gd,new Hd),new Nd)),[{id:"credit_card",gateway:"bluesnapdirect"}]);class Kd{constructor(e){this._paymentIntegrationService=e}execute(e){return t=this,i=function*(){const t=this._formatePaymentPayload(e);yield this._paymentIntegrationService.submitOrder();try{yield this._paymentIntegrationService.submitPayment(t)}catch(e){if(this._isBlueSnapDirectRedirectResponse(e)){const t=e.body.provider_data&&JSON.parse(e.body.provider_data);let n=e.body.additional_action_required.data.redirect_url;if(function(e){if("object"!=typeof e||null===e)return!1;const t=e;return!!t.merchantid&&"string"==typeof t.merchantid}(t)){const e=new URLSearchParams(t).toString();n=`${n}&${e}`}return new Promise((()=>window.location.replace(n)))}return Promise.reject(e)}},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}initialize(){return Promise.resolve()}finalize(){return Promise.reject(new Os)}deinitialize(){return Promise.resolve()}_formatePaymentPayload({payment:e}){if(!e)throw new Cr(["payment"]);return e.paymentData&&Es(e.paymentData)&&Ms(e.paymentData)?Object.assign(Object.assign({},e),{paymentData:{instrumentId:e.paymentData.instrumentId,shouldSetAsDefaultInstrument:!!e.paymentData.shouldSetAsDefaultInstrument}}):(t=e.paymentData,Boolean("object"==typeof t&&null!==t&&"accountNumber"in t&&"accountType"in t&&"shopperPermission"in t&&"routingNumber"in t)?Object.assign(Object.assign({},e),{paymentData:{formattedPayload:{ecp:Object.assign({account_number:e.paymentData.accountNumber,account_type:e.paymentData.accountType,shopper_permission:e.paymentData.shopperPermission,routing_number:e.paymentData.routingNumber},e.paymentData.companyName?{company_name:e.paymentData.companyName}:{}),vault_payment_instrument:e.paymentData.shouldSaveInstrument,set_as_default_stored_instrument:e.paymentData.shouldSetAsDefaultInstrument}}}):(n=e.paymentData,Boolean("object"==typeof n&&null!==n&&"iban"in n&&"firstName"in n&&"lastName"in n&&"shopperPermission"in n)?Object.assign(Object.assign({},e),{paymentData:{formattedPayload:{sepa_direct_debit:{iban:e.paymentData.iban,first_name:e.paymentData.firstName,last_name:e.paymentData.lastName,shopper_permission:e.paymentData.shopperPermission},vault_payment_instrument:e.paymentData.shouldSaveInstrument,set_as_default_stored_instrument:e.paymentData.shouldSetAsDefaultInstrument}}}):function(e){return Boolean("object"==typeof e&&null!==e&&"bic"in e)}(e.paymentData)?Object.assign(Object.assign({},e),{paymentData:{formattedPayload:{ideal:{bic:e.paymentData.bic}}}}):function(e){return Boolean("object"==typeof e&&null!==e&&"iban"in e&&!("firstName"in e)&&!("lastName"in e)&&!("shopperPermission"in e))}(e.paymentData)?Object.assign(Object.assign({},e),{paymentData:{formattedPayload:{pay_by_bank:{iban:e.paymentData.iban}}}}):{methodId:e.methodId}));var t,n}_isBlueSnapDirectRedirectResponse(e){var t;if("object"!=typeof e||null===e)return!1;const n=e;if(!n.body)return!1;const i=n.body;return"additional_action_required"===i.status&&!!(null===(t=i.additional_action_required)||void 0===t?void 0:t.data.redirect_url)}}const Qd=Ge((e=>new Kd(e)),[{gateway:"bluesnapdirect"}]);var Jd;!function(e){e.ACKNOWLEDGE="ACKNOWLEDGE",e.FINALIZE="FINALIZE",e.INITIALIZE="INITIALIZE"}(Jd||(Jd={}));const Zd=Jd;var Xd=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ec{constructor(e){this._paymentIntegrationService=e}execute(e,t){return Xd(this,void 0,void 0,(function*(){const{payment:n}=e;if(!n)throw new Cr(["payment"]);if(!this._initializeOptions)throw new Sn(gn.PaymentNotInitialized);const{onLoad:i,style:r}=this._initializeOptions,o=this._createIframe("bluesnapv2_hosted_payment_page",r),a=new qt(new Promise(c.noop));i(o,(()=>a.cancel(new ai))),yield this._paymentIntegrationService.submitOrder(e,t),yield this._paymentIntegrationService.initializeOffsitePayment({methodId:n.methodId,gatewayId:n.gatewayId,shouldSaveInstrument:!1,target:o.name,promise:a.promise})}))}finalize(e){return Xd(this,void 0,void 0,(function*(){const t=this._paymentIntegrationService.getState(),n=t.getOrder(),i=t.getPaymentStatus();if(!n||i!==Zd.ACKNOWLEDGE&&i!==Zd.FINALIZE)return Promise.reject(new Os);yield this._paymentIntegrationService.finalizeOrder(e)}))}initialize(e){return Xd(this,void 0,void 0,(function*(){this._initializeOptions=e&&e.bluesnapv2,yield Promise.resolve()}))}deinitialize(){return Promise.resolve()}_createIframe(e,t){const n=document.createElement("iframe");if(n.setAttribute("sandbox","allow-top-navigation allow-scripts allow-forms allow-same-origin"),n.name=e,t){const{border:e,height:i,width:r}=t;n.style.border=null!=e?e:"",n.style.height=null!=i?i:"",n.style.width=null!=r?r:""}return n}}const tc=Ge((e=>new ec(e)),[{gateway:"bluesnapv2"}]);class nc{constructor(e){this.storage=e}saveExtraItemsData(e,t){const n=[...t.physicalItems,...t.digitalItems].reduce(((e,t)=>(e[t.productId]={brand:t.brand?t.brand:"",category:t.categoryNames?t.categoryNames.join(", "):""},e)),{});try{return this.storage.setItem(this.getStorageKey(e),JSON.stringify(n)),n}catch(e){return{}}}readExtraItemsData(e){try{const t=this.storage.getItem(this.getStorageKey(e));if(!t)return null;const n=JSON.parse(t);return function(e){if(!(0,c.isObject)(e))return!1;const t=Object.values(e).some((e=>!(0,c.isObject)(e)||!("brand"in e)||!("category"in e)));return Boolean(!t)}(n)?n:null}catch(e){return null}}clearExtraItemData(e){try{this.storage.removeItem(this.getStorageKey(e))}catch(e){}}getStorageKey(e){return e?`ORDER_ITEMS_${e}`:""}}function ic(e){return Boolean(e.hasOwnProperty("analytics"))}function rc(e){return"object"==typeof e&&null!==e&&"shouldCreateAccount"in e}class oc extends pn{constructor(e){super(),this.errorCode=e,this.name="BoltPaymentsFieldError",this.type="bolt_payments_field_error",this.body={errors:[oc.getError(e)]}}static getError(e){switch(e){case"1000":case"2000":case"3000":return{code:"invalid_number"};case"1001":case"2001":case"3001":return{code:"invalid_expiry_date"};case"1002":case"2002":return{code:"invalid_cvc"};case"1003":return{code:"invalid_zip"};case"2003":return{code:"incorrect_zip"};default:return{code:"general_error"}}}}var ac=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class sc{constructor(e,t,n){this.paymentIntegrationService=e,this.boltScriptLoader=t,this.analyticsExtraItemsManager=n,this.useBoltClient=!1,this.useBoltEmbedded=!1}initialize(e){return ac(this,void 0,void 0,(function*(){const{bolt:t,methodId:n}=e,{containerId:i,onPaymentSelect:r,useBigCommerceCheckout:o}=t||{};if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!o)return void(this.boltClient=yield this.boltScriptLoader.loadBoltClient());const a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId),{initializationData:s,config:d}=a,{publishableKey:c,developerConfig:l,embeddedOneClickEnabled:u}=s||{},{testMode:h}=d;if(!c)throw new vn(yn.MissingPaymentMethod);if(this.boltClient=yield this.boltScriptLoader.loadBoltClient(c,h,l),this.useBoltClient=!u,this.useBoltEmbedded=!!u,this.useBoltEmbedded){if(!i)throw new xn('Unable to initialize payment because "options.bolt.containerId" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.bolt.onPaymentSelect" argument is not provided.');this.boltEmbedded=yield this.boltScriptLoader.loadBoltEmbedded(c,h,l),this.mountBoltEmbeddedField(i),r(yield this.hasBoltAccount())}}))}deinitialize(){var e;return null===(e=this.embeddedField)||void 0===e||e.unmount(),this.boltClient=void 0,this.boltEmbedded=void 0,Promise.resolve()}finalize(){return Promise.reject(new Os)}execute(e,t){return ac(this,void 0,void 0,(function*(){this.setExtraItemsForAnalytics();const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{methodId:r,paymentData:o}=n||{};let a;if(!e.payment)throw new Cr(["payment"]);if(!r)throw new vn(yn.MissingPaymentMethod);if(!o||!function(e){return Boolean((0,c.isObject)(e)&&("shouldSaveInstrument"in e||"nonce"in e||rc(e)))}(o))throw new vn(yn.MissingPayment);yield this.paymentIntegrationService.submitOrder(i,t),a=this.useBoltClient?yield this.getBoltClientPaymentPayload(r,o,t):this.useBoltEmbedded?yield this.getBoltEmbeddedPaymentPayload(r,o):yield this.getBoltFullCheckoutPaymentPayload(r,o),yield this.paymentIntegrationService.submitPayment(a)}))}getBoltClientPaymentPayload(e,t,n){return ac(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.loadPaymentMethod(e,n);const i=this.paymentIntegrationService.getState(),r=i.getPaymentMethodOrThrow(e).clientToken,{isStoreCreditApplied:o}=i.getCheckoutOrThrow(),{shouldSaveInstrument:a}=t,s=this.getBoltClientOrThrow();if(yield this.paymentIntegrationService.applyStoreCredit(o),!r)throw new vn(yn.MissingPaymentMethod);const d=yield new Promise(((e,t)=>{const n={success:(n,i)=>{n.reference?e(n):t(new ur("Unable to proceed because transaction reference is unavailable. Please try again later.")),i()},close:()=>{t(new ai)}};s.configure({orderToken:r},{},n).open()}));return{methodId:e,paymentData:{nonce:d.reference,shouldSaveInstrument:a}}}))}getBoltEmbeddedPaymentPayload(e,t){var n;return ac(this,void 0,void 0,(function*(){if(!rc(t))throw new vn(yn.MissingPayment);const i=this.validateTokenizeResultOrThrow(yield null===(n=this.embeddedField)||void 0===n?void 0:n.tokenize());return{methodId:e,paymentData:{formattedPayload:{credit_card_token:{token:i.token,last_four_digits:i.last4,iin:i.bin,expiration_month:+i.expiration.split("-")[1],expiration_year:+i.expiration.split("-")[0]},provider_data:{create_account:!!t.shouldCreateAccount,embedded_checkout:!0}}}}}))}getBoltFullCheckoutPaymentPayload(e,t){return ac(this,void 0,void 0,(function*(){yield this.setBoltOrderId();const n=this.getBoltClientOrThrow(),i=yield n.getTransactionReference();if(!i)throw new hr;return{methodId:e,paymentData:Object.assign(Object.assign({},t),{nonce:i})}}))}getBoltClientOrThrow(){if(!this.boltClient)throw new Sn(gn.PaymentNotInitialized);return this.boltClient}getBoltEmbeddedOrThrow(){if(!this.boltEmbedded)throw new Sn(gn.PaymentNotInitialized);return this.boltEmbedded}hasBoltAccount(){return ac(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState(),t=e.getCustomer(),n=e.getBillingAddress(),i=(null==t?void 0:t.email)||(null==n?void 0:n.email)||"",r=this.getBoltClientOrThrow();try{return yield r.hasBoltAccount(i)}catch(e){throw new hr}}))}setBoltOrderId(){return ac(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState().getOrderOrThrow(),t=this.getBoltClientOrThrow();try{yield t.setOrderId(e.orderId)}catch(e){throw new hr}}))}mountBoltEmbeddedField(e){const t=this.getBoltEmbeddedOrThrow().create("payment_field",{styles:{backgroundColor:"#fff"},renderSeparateFields:!0});t.mount(`#${e}`),this.embeddedField=t}validateTokenizeResultOrThrow(e){if(!e)throw new hr;if(e instanceof Error)throw new oc(e.message);const{token:t,last4:n,bin:i,expiration:r}=e,o=+n,a=+i,s=+`${r}`.split("-")[1],d=+`${r}`.split("-")[0];if(!t||Number.isNaN(o)||Number.isNaN(a)||Number.isNaN(s)||Number.isNaN(d))throw new Cr;return e}setExtraItemsForAnalytics(){const e=this.paymentIntegrationService.getState(),t=e.getStoreConfigOrThrow(),n=e.getCartOrThrow();if(t.checkoutSettings.isAnalyticsEnabled&&ic(window)){const{id:e,lineItems:t}=n;this.analyticsExtraItemsManager.saveExtraItemsData(e,t)}}}const dc=Ge((e=>new sc(e,new br((0,s.vQ)()),new nc(x.Ay))),[{id:"bolt"}]);function cc(e){return!!e&&"accountNumber"in e&&"routingNumber"in e&&"ownershipType"in e&&"accountType"in e}var lc=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class uc{constructor(e,t){this.paymentIntegrationService=e,this.braintreeSdk=t}initialize(e){return lc(this,void 0,void 0,(function*(){const{methodId:t,braintreeach:n}=e||{};if(!t)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');this.getMandateText=null==n?void 0:n.getMandateText,yield this.paymentIntegrationService.loadPaymentMethod(t);const i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{clientToken:r,initializationData:o}=i;if(!r||!o)throw new vn(yn.MissingPaymentMethod);this.braintreeSdk.initialize(r);try{this.usBankAccount=yield this.braintreeSdk.getUsBankAccount()}catch(e){this.handleBraintreeError(e)}}))}execute(e,t){return lc(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);const r=Es(n.paymentData||{}),o=r?yield this.tokenizePaymentForVaultedInstrument(n):yield this.tokenizePayment(n),a=r?yield this.preparePaymentDataForVaultedInstrument(o,n):yield this.preparePaymentData(o,n);yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment(a)}))}finalize(){return Promise.reject(new Os)}deinitialize(){return lc(this,void 0,void 0,(function*(){return yield this.braintreeSdk.deinitialize(),Promise.resolve()}))}tokenizePayment({paymentData:e}){return lc(this,void 0,void 0,(function*(){const t=this.getUsBankAccountOrThrow();if(!cc(e))throw new Cr(["payment.paymentData"]);const n=Es(e)?"The data are used for stored instrument verification":"function"==typeof this.getMandateText&&this.getMandateText();if(!n)throw new xn("Unable to proceed because getMandateText is not provided or returned undefined value.");try{const{nonce:i}=yield t.tokenize({bankDetails:this.getBankDetails(e),mandateText:n});return i}catch(e){this.handleBraintreeError(e)}}))}tokenizePaymentForVaultedInstrument(e){return lc(this,void 0,void 0,(function*(){const{methodId:t,paymentData:n={}}=e,i=this.paymentIntegrationService.getState(),{config:r}=i.getPaymentMethodOrThrow(t);if(!r.isVaultingEnabled)throw new xn("Vaulting is disabled but a vaulted instrument was being used for this transaction");return cc(n)?this.tokenizePayment(e):null}))}preparePaymentData(e,t){return lc(this,void 0,void 0,(function*(){const{methodId:n,paymentData:i={}}=t;if(!cc(i))throw new Cr(["payment.paymentData"]);const{deviceData:r}=yield this.braintreeSdk.getDataCollectorOrThrow(),{shouldSaveInstrument:o,shouldSetAsDefaultInstrument:a,routingNumber:s,accountNumber:d}=i;return{methodId:n,paymentData:{deviceSessionId:r,shouldSetAsDefaultInstrument:a,shouldSaveInstrument:o,formattedPayload:{tokenized_bank_account:{issuer:s,masked_account_number:d.substr(-4),token:e}}}}}))}preparePaymentDataForVaultedInstrument(e,t){return lc(this,void 0,void 0,(function*(){const{methodId:n,paymentData:i={}}=t;if(!Es(i)||!Ms(i))throw new Cr(["payment.paymentData"]);const{deviceData:r}=yield this.braintreeSdk.getDataCollectorOrThrow(),{instrumentId:o,shouldSetAsDefaultInstrument:a}=i;return{methodId:n,paymentData:Object.assign({deviceSessionId:r,instrumentId:o,shouldSetAsDefaultInstrument:a},e&&{nonce:e})}}))}getBankDetails(e){const t=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),n=e.ownershipType.toLowerCase(),i=e.accountType.toLowerCase();return Object.assign(Object.assign({accountNumber:e.accountNumber,routingNumber:e.routingNumber,ownershipType:n},"personal"===n?{firstName:e.firstName,lastName:e.lastName}:{businessName:e.businessName}),{accountType:i,billingAddress:{streetAddress:t.address1,extendedAddress:t.address2,locality:t.city,region:t.stateOrProvinceCode,postalCode:t.postalCode}})}getUsBankAccountOrThrow(){if(!this.usBankAccount)throw new Sn(gn.PaymentNotInitialized);return this.usBankAccount}handleBraintreeError(e){if(!Qn(e))throw e;throw new ur(e.message)}}const hc=Ge((e=>new uc(e,(e=>{const t=new Un(e),n=new oi((0,s.vQ)(),window,t);return new ti(n)})(e))),[{id:"braintreeach"}]);class mc{constructor(e){this.paymentIntegrationService=e,this.braintreeHostWindow=window}render(e,t,n){const i=t&&document.getElementById(t);if(this.braintreeHostWindow.paypal&&i){const r=this.paymentIntegrationService.getState(),o=r.getCartOrThrow(),a=r.getBillingAddressOrThrow(),s=r.getPaymentMethodOrThrow(e);if(!s.initializationData)return;const{paypalBNPLConfiguration:d=[]}=s.initializationData,c=n===kr.PAYMENT?"checkout":n,l=d&&d.find((({id:e})=>e===c));if(!l||!l.status)return;n===kr.CART&&(i.removeAttribute("data-pp-style-logo-type"),i.removeAttribute("data-pp-style-logo-position"),i.removeAttribute("data-pp-style-text-color"),i.removeAttribute("data-pp-style-text-size")),this.braintreeHostWindow.paypal.Messages({amount:o.cartAmount,buyerCountry:a.countryCode,placement:n,style:this.getPaypalMessagesStylesFromBNPLConfig(l)}).render(`#${t}`)}}getPaypalMessagesStylesFromBNPLConfig({styles:e}){const t={};return e.color&&(t.color=e.color),e.layout&&(t.layout=e.layout),(e["logo-type"]||e["logo-position"])&&(t.logo={},e["logo-type"]&&(t.logo.type=e["logo-type"]),e["logo-position"]&&(t.logo.position=e["logo-position"])),e.ratio&&(t.ratio=e.ratio),(e["text-color"]||e["text-size"])&&(t.text={},e["text-color"]&&(t.text.color=e["text-color"]),e["text-size"]&&(t.text.size=+e["text-size"])),t}}class pc{constructor(e){const{element:t,closeElement:n,mainElement:i}=this._createElements(e);this._element=t,this._closeElement=n,this._mainElement=i}show(e){this._mainElement.parentElement||(this._registerClick(e),document.body.appendChild(this._mainElement),setTimeout((()=>this._element.style.opacity="1")))}remove(){this._mainElement.parentElement&&(this._unregisterClick&&this._unregisterClick(),this._removeAfterTransition(),setTimeout((()=>this._element.style.opacity="0")))}_createElements(e){const t=document.createElement("div"),{background:n="rgba(0, 0, 0, 0.8)",id:i="checkoutOverlay",transitionDuration:r=400,hasCloseButton:o=!1,innerHtml:a=null}=e||{};let s,d,c,l,u=t;if(i&&(t.id=i),a){const e=document.createElement("div");l=`${i}--overlayText`,e.className=l,e.appendChild(a),t.appendChild(e)}return o&&(c=`${i}--close`,s=document.createElement("div"),s.className=c,d=`${i}--layout`,u=document.createElement("div"),u.className=d,u.appendChild(t),u.appendChild(s)),u.appendChild(function(e){const{id:t,background:n,transitionDuration:i,classLayout:r,classOverlayText:o,classClose:a}=e,s=document.createElement("style"),d=r?`, .${r}`:"";return s.id=`${t}--styles`,s.type="text/css",s.innerText=`\n        #${t}${d} {\n            display: block;\n            height: 100%;\n            width: 100%;\n            left: 0;\n            top: 0;\n            position: fixed;\n            z-index: 2147483647;\n        }\n        #${t} {\n            transition: opacity ${i}ms ease-out;\n            background: ${n};\n            opacity: 0;\n        }\n    `,o&&(s.innerText+=`\n             #${t} {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n             }\n             #${t} .${o} {\n                color: white;\n                max-width: 330px;\n                font-size: 1.2em;\n                text-align: center;\n             }\n        `),a&&(s.innerText+=`\n            #${t} {\n                opacity: 1;\n            }\n            .${r} .${a} {\n                position: fixed;\n                right: 16px;\n                top: 16px;\n                width: 16px;\n                height: 16px;\n                opacity: 0.6;\n                cursor: pointer;\n                z-index: 3147483647;\n            }\n            .${r} .${a}::after, .${r} .${a}::before {\n                position: absolute;\n                left: 8px;\n                content: '';\n                height: 16px;\n                width: 2px;\n                background-color: #fff;\n            }\n            .${r} .${a}::after {\n                transform: rotate(-45deg);\n            }\n            .${r} .${a}::before {\n                transform: rotate(45deg);\n            }\n        `),s}({id:i,background:n,transitionDuration:r,classLayout:d,classOverlayText:l,classClose:c})),{element:t,closeElement:s,mainElement:u}}_addEventListener(e,t){e&&t&&e.addEventListener("click",t)}_removeEventListener(e,t){e&&t&&e.removeEventListener("click",t)}_registerClick(e){if(this._unregisterClick&&this._unregisterClick(),e){const{onClick:t,onClickClose:n}=e;this._addEventListener(this._element,t),this._addEventListener(this._closeElement,n),this._unregisterClick=()=>{this._removeEventListener(this._element,t),this._removeEventListener(this._closeElement,n),this._unregisterClick=void 0}}}_removeAfterTransition(){const e=t=>{"opacity"===t.propertyName&&(this._mainElement.parentElement&&this._mainElement.remove(),this._element.removeEventListener("transitionend",e))};this._element.addEventListener("transitionend",e)}}const yc={"background-color":"rgba(0, 0, 0, 0.4)","z-index":"1000"};function gc(e){return"object"==typeof e&&null!==e&&"name"in e&&"BraintreeError"===e.name}function vc(e){return{recipientName:`${e.firstName} ${e.lastName}`,line1:e.address1,line2:e.address2,city:e.city,state:e.stateOrProvinceCode,postalCode:e.postalCode,countryCode:e.countryCode,phone:e.phone}}var fc=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class bc{constructor(e,t,n,i){this.paymentIntegrationService=e,this.braintreeIntegrationService=t,this.braintreeMessages=n,this.loadingIndicator=i,this.braintreeHostWindow=window}initialize(e){return fc(this,void 0,void 0,(function*(){const{braintree:t,methodId:n}=e;if(this.braintree=t,this.paymentMethod&&this.paymentMethod.nonce||(this.paymentMethod=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n)),this.paymentMethod.clientToken&&(null==t?void 0:t.bannerContainerId))return yield this.loadPaypal(),this.loadPaypalCheckoutInstance();if(this.paymentMethod.clientToken)return this.loadPaypal();const i=yield this.paymentIntegrationService.loadPaymentMethod(n);if(this.paymentMethod=i.getPaymentMethodOrThrow(n),null==t?void 0:t.bannerContainerId)return this.loadPaypalCheckoutInstance();if(!this.paymentMethod.clientToken)throw new vn(yn.MissingPaymentMethod);return this.loadPaypal()}))}execute(e,t){var n;return fc(this,void 0,void 0,(function*(){const{payment:i}=e,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{onError:o}=this.braintree||{},a=this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,s=a&&a["PAYPAL-3521.handling_declined_error_braintree"];if(!i)throw new Cr(["payment"]);try{const e=yield this.preparePaymentData(i,r.useStoreCredit);yield this.paymentIntegrationService.submitOrder(r,t),yield this.paymentIntegrationService.submitPayment(e)}catch(e){this.isProviderError(e)&&s&&(yield this.loadPaypal(),null===(n=this.paypalButtonRender)||void 0===n||n.close(),yield this.loadPaypalCheckoutInstance(),yield new Promise(((e,t)=>{o&&"function"==typeof o&&o(new Error("INSTRUMENT_DECLINED")),t()}))),this.handleError(e)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this.braintreeTokenizePayload=void 0,null===(e=this.paypalButtonRender)||void 0===e||e.close(),this.braintreeIntegrationService.teardown()}preparePaymentData(e,t){var n;return fc(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState(),r=i.getOutstandingBalance(t),o=i.getStoreConfig();if(!r)throw new vn(yn.MissingCheckout);if(!o)throw new vn(yn.MissingCheckoutConfig);if(!this.paymentMethod)throw new Sn(gn.PaymentNotInitialized);const{currency:a,storeProfile:{storeLanguage:s}}=o,{nonce:d,config:{isVaultingEnabled:c}}=this.paymentMethod,{methodId:l,paymentData:u={}}=e,h=(null===(n=this.braintreeTokenizePayload)||void 0===n?void 0:n.nonce)||d;if(h){const t=yield this.paymentIntegrationService.loadPaymentMethod(l);return this.paymentMethod=t.getPaymentMethod(l),Object.assign(Object.assign({},e),{paymentData:this.formattedPayload(h)})}if(Es(u)||(m=u,Boolean(m.instrumentId)&&!Object.prototype.hasOwnProperty.call(m,"ccNumber")&&!Object.prototype.hasOwnProperty.call(m,"ccCvv"))){if(!c)throw new xn("Vaulting is disabled but a vaulted instrument was being used for this transaction");return Promise.resolve(e)}var m;if(!Ms(u))throw new vn(yn.MissingPayment);const{shouldSaveInstrument:p,shouldSetAsDefaultInstrument:y}=u;if(p&&!c)throw new xn("Vaulting is disabled but shouldSaveInstrument is set to true");const g=i.getShippingAddress(),v=g?vc(g):void 0;return Promise.all([this.braintreeIntegrationService.paypal({amount:r,locale:s,currency:a.code,offerCredit:"braintreepaypalcredit"===this.paymentMethod.id,shippingAddressOverride:v,shouldSaveInstrument:p||!1,shippingAddressEditable:!1}),this.braintreeIntegrationService.getSessionId()]).then((([{nonce:t,details:n}={},i])=>Object.assign(Object.assign({},e),{paymentData:this.formattedPayload(t,n&&n.email,i,p,y)})))}))}formattedPayload(e,t,n,i,r){return{formattedPayload:{vault_payment_instrument:i||null,set_as_default_stored_instrument:r||null,device_info:n||null,paypal_account:{token:e,email:t||null}}}}loadPaypalCheckoutInstance(){return fc(this,void 0,void 0,(function*(){const{clientToken:e,initializationData:t,id:n}=this.paymentMethod||{};if(!e)throw new vn(yn.MissingPaymentMethod);try{this.braintreeIntegrationService.initialize(e);const i={currency:this.paymentIntegrationService.getState().getCartOrThrow().currency.code,intent:null==t?void 0:t.intent,isCreditEnabled:null==t?void 0:t.isCreditEnabled},r="braintreepaypalcredit"===n||!(null==t?void 0:t.isCreditEnabled);yield this.braintreeIntegrationService.getPaypalCheckout(i,(e=>{var t;r&&n&&(null===(t=this.braintree)||void 0===t?void 0:t.bannerContainerId)&&this.renderPayPalMessages(n,this.braintree.bannerContainerId),this.renderPayPalButton(e)}),this.handleError)}catch(e){this.handleError(e)}}))}renderPayPalMessages(e,t){this.braintreeMessages.render(e,t,kr.PAYMENT)}renderPayPalButton(e){const{onPaymentError:t,submitForm:n,onRenderButton:i,containerId:r,onError:o}=this.braintree||{};if(!r)return;if(!this.paymentMethod)throw new Sn(gn.PaymentNotInitialized);this.loadingIndicatorContainer=r.split("#")[1];const{id:a,config:{testMode:s}}=this.paymentMethod,{paypal:d}=this.braintreeHostWindow,c=null==d?void 0:d.FUNDING.PAYPAL;d&&c?(this.paypalButtonRender=d.Buttons({env:s?"sandbox":"production",commit:!1,fundingSource:c,onClick:()=>{this.toggleLoadingIndicator(!0)},createOrder:()=>this.setupPayment(e,a,t),onApprove:t=>fc(this,void 0,void 0,(function*(){this.braintreeTokenizePayload=yield this.tokenizePaymentOrThrow(t,e),n&&"function"==typeof n&&n()})),onCancel:()=>{this.toggleLoadingIndicator(!1)},onError:e=>{this.toggleLoadingIndicator(!1),null==o||o(e)}}),i&&"function"==typeof i&&i(),this.paypalButtonRender.isEligible()&&this.paypalButtonRender.render(`${r}`)):this.removeElement(r.split("#")[1])}setupPayment(e,t,n){return fc(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState();try{const n=i.getCustomer(),r=i.getPaymentMethodOrThrow(t),o=i.getCheckoutOrThrow().outstandingBalance,a=i.getStoreConfigOrThrow().currency.code,s=i.getShippingAddress()||(null==n?void 0:n.addresses[0]),d=s?vc(s):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:d,amount:o,currency:a,offerCredit:!1,intent:r.initializationData.intent})}catch(e){throw n&&(gc(e)||e instanceof pn)&&n(e),e}}))}tokenizePaymentOrThrow(e,t,n){return fc(this,void 0,void 0,(function*(){try{return yield t.tokenizePayment(e)}catch(e){throw n&&(gc(e)||e instanceof pn)&&n(e),e}}))}loadPaypal(){return fc(this,void 0,void 0,(function*(){const{clientToken:e,initializationData:t}=this.paymentMethod||{};if(!e||!t)throw new vn(yn.MissingPaymentMethod);try{this.braintreeIntegrationService.initialize(e),yield this.braintreeIntegrationService.getPaypal()}catch(e){this.handleError(e)}return Promise.resolve()}))}handleError(e){if(!gc(e))throw e;if("PAYPAL_POPUP_CLOSED"===e.code)throw new ai(e.message);throw new ur(e.message)}isProviderError(e){var t,n,i;return!!function(e){return"object"==typeof e&&null!==e&&"errors"in e}(e)&&"2046"===(null===(i=null===(n=((null===(t=null==e?void 0:e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error)))||[])[0])||void 0===n?void 0:n.provider_error)||void 0===i?void 0:i.code)}removeElement(e){const t=e&&document.getElementById(e);t&&t.remove()}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const Sc=Ge((e=>{const t=window,n=new pc,i=new Un(e),r=new Nr(new oi((0,s.vQ)(),t,i),t,n),o=new mc(e);return new bc(e,r,o,new cs({containerStyles:yc}))}),[{id:"braintreepaypal"},{id:"braintreepaypalcredit"}]);class Cc{constructor(e){this.requestSender=e}getOrderStatus(e="braintreelocalmethods",t){return n=this,r=function*(){const n=`/api/storefront/initialization/${e}`,i=Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki);return(yield this.requestSender.get(n,Object.assign({headers:i},t))).body},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}}var wc=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class _c{constructor(e,t,n,i,r=3e3,o=3e5){this.paymentIntegrationService=e,this.braintreeSdk=t,this.braintreeRequestSender=n,this.loadingIndicator=i,this.pollingInterval=r,this.maxPollingIntervalTime=o,this.isLPMsUpdateExperimentEnabled=!1,this.pollingTimer=0,this.stopPolling=c.noop,this.isPollingEnabled=!1}initialize(e){return wc(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,braintreelocalmethods:i}=e;if(this.gatewayId=t,!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.braintreelocalmethods" argument is not provided.');this.braintreelocalmethods=i,this.loadingIndicatorContainer=i.container.split("#")[1],yield this.paymentIntegrationService.loadPaymentMethod(t);const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(t),{clientToken:a,config:s,initializationData:d}=o,c=r.getStoreConfigOrThrow().checkoutSettings.features;if(this.isPollingEnabled=Ze(c,"PAYPAL-5258.braintree_local_methods_polling"),this.isLPMsUpdateExperimentEnabled=Ze(c,"PAYPAL-4853.add_new_payment_flow_for_braintree_lpms"),!a||!d||!s.merchantId)throw new vn(yn.MissingPaymentMethod);try{this.braintreeSdk.initialize(a),this.isNonInstantPaymentMethod(n)||(this.braintreeLocalPayment=yield this.braintreeSdk.getBraintreeLocalPayment(s.merchantId))}catch(e){this.handleError(e)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return wc(this,void 0,void 0,(function*(){return this.toggleLoadingIndicator(!1),Promise.resolve()}))}execute(e,t){return wc(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);const{methodId:r}=n;this.toggleLoadingIndicator(!0),this.isNonInstantPaymentMethod(r)?yield this.executeWithNotInstantLPM(r):yield this.executeWithInstantLPM(r,i,t)}))}executeWithNotInstantLPM(e){return wc(this,void 0,void 0,(function*(){try{const t=yield this.getLPMsBasicPaymentData();yield this.paymentIntegrationService.submitOrder(),yield this.paymentIntegrationService.submitPayment({methodId:e,paymentData:Object.assign(Object.assign({},t),{formattedPayload:{method:e}})})}catch(e){if(this.isBraintreeRedirectError(e)){const t=e.body.additional_action_required.data.redirect_url;return new Promise(((e,n)=>{window.location.replace(t),this.toggleLoadingIndicator(!1),n()}))}return this.handleError(e),Promise.reject(e)}}))}executeWithInstantLPM(e,t,n){return wc(this,void 0,void 0,(function*(){if(!this.braintreeLocalPayment)throw new hr;yield new Promise(((i,r)=>{var o;null===(o=this.braintreeLocalPayment)||void 0===o||o.startPayment(this.getInstantLPMConfig(e,t,n),this.getInstantLPMCallback(i,r,e,t,n))}))}))}getLPMsBasicPaymentData(){return wc(this,void 0,void 0,(function*(){const{deviceData:e}=yield this.braintreeSdk.getDataCollectorOrThrow();return{deviceSessionId:e}}))}getInstantLPMConfig(e,t,n){const i=this.paymentIntegrationService.getState(),r=i.getCartOrThrow(),o=i.getBillingAddressOrThrow(),{firstName:a,lastName:s,countryCode:d}=o,{currency:c,email:l,lineItems:u}=r,h=u.physicalItems.length>0,m=i.getCheckoutOrThrow().outstandingBalance,p=i.getStoreConfigOrThrow().links.checkoutLink;return{paymentType:e,amount:m,fallback:{url:p,buttonText:"Complete Payment"},currencyCode:c.code,shippingAddressRequired:h,email:l,givenName:a,surname:s,address:{countryCode:d},onPaymentStart:(i,r)=>wc(this,void 0,void 0,(function*(){if(!this.isLPMsUpdateExperimentEnabled)return this.orderId=i.paymentId,void r();const o=yield this.getLPMsBasicPaymentData(),a=Object.assign(Object.assign({},o),{formattedPayload:{method:e,[`${e}_account`]:{order_id:i.paymentId}}});try{yield this.paymentIntegrationService.submitOrder(t,n),yield this.paymentIntegrationService.submitPayment({methodId:e,paymentData:a})}catch(t){if(this.isBraintreeOrderSavedResponse(t)&&t.body.additional_action_required.data.order_id_saved_successfully)return r(),this.isPollingEnabled?new Promise(((t,n)=>{this.initializePollingMechanism(e,t,n,this.gatewayId)})):void 0;throw t}}))}}getInstantLPMCallback(e,t,n,i,r){const o=this.paymentIntegrationService.getState().getCartOrThrow();return(a,s)=>wc(this,void 0,void 0,(function*(){if(a)return"LOCAL_PAYMENT_WINDOW_CLOSED"===a.code?(this.toggleLoadingIndicator(!1),this.resetPollingMechanism(),t()):(this.isPollingEnabled&&this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t(new hr));const d=yield this.getLPMsBasicPaymentData(),c=Object.assign(Object.assign({},d),{formattedPayload:{method:n,[`${n}_account`]:Object.assign({email:o.email,token:s.nonce},this.isLPMsUpdateExperimentEnabled?{}:{order_id:this.orderId})}});try{return this.isLPMsUpdateExperimentEnabled||(yield this.paymentIntegrationService.submitOrder(i,r)),yield this.paymentIntegrationService.submitPayment({methodId:n,paymentData:c}),e(void 0)}catch(e){return this.handleError(e),t(e)}}))}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}handleError(e){const{onError:t}=this.braintreelocalmethods||{};this.isPollingEnabled&&this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}isNonInstantPaymentMethod(e){return e.toUpperCase()in Gn}isBraintreeRedirectError(e){var t;if("object"!=typeof e||null===e)return!1;const{body:n}=e;return!!n&&!!(null===(t=n.additional_action_required)||void 0===t?void 0:t.data.redirect_url)}isBraintreeOrderSavedResponse(e){var t;if("object"!=typeof e||null===e)return!1;const{body:n}=e;return!!n&&(null===(t=n.additional_action_required)||void 0===t?void 0:t.data.hasOwnProperty("order_id_saved_successfully"))}initializePollingMechanism(e,t,n,i){return wc(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.braintreeRequestSender.getOrderStatus(i,{params:{useMetadata:!1}}),o=r.status===Hn.Pending,a=r.status===Hn.Completed,s=r.status===Hn.Failed;if(a)return this.deinitializePollingMechanism(),t();if(s)return n();if(!a&&o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,braintreelocalmethods:this.braintreelocalmethods}),this.handleError(new pd)}catch(e){n()}}))}deinitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deinitializePollingMechanism()}reinitializeStrategy(e){return wc(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}}const Ic=Ge((e=>{const t=window,n=new Un(e),i=new ti(new oi((0,s.vQ)(),t,n)),r=(0,a.createRequestSender)(),o=new Cc(r);return new _c(e,i,o,new cs({styles:{backgroundColor:"black"}}))}),[{gateway:"braintreelocalmethods"}]);function Pc(e){return!!e&&("authenticationState"in e||"addresses"in e||"instruments"in e)}var Ec=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Oc{constructor(e,t,n){this.paymentIntegrationService=e,this.braintreeFastlaneUtils=t,this.braintreeSdk=n}initialize(e){var t;return Ec(this,void 0,void 0,(function*(){const{methodId:n,braintreefastlane:i}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.braintreefastlane" argument is not provided.');if(!i.onInit||"function"!=typeof i.onInit)throw new xn('Unable to initialize payment because "options.braintreefastlane.onInit" argument is not provided or it is not a function.');if(!i.onChange||"function"!=typeof i.onChange)throw new xn('Unable to initialize payment because "options.braintreefastlane.onChange" argument is not provided or it is not a function.');yield this.paymentIntegrationService.loadPaymentMethod(n);const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(n),{initializationData:a,clientToken:s}=o||{},{isFastlaneStylingEnabled:d}=a||{},c=Ze(r.getStoreConfigOrThrow().checkoutSettings.features,"PROJECT-7080.braintree_fastlane_three_ds");this.is3DSEnabled=o.config.is3dsEnabled,s&&c&&this.braintreeSdk.initialize(s);const l=Lr(d?null===(t=o.initializationData)||void 0===t?void 0:t.fastlaneStyles:void 0,i.styles);yield this.braintreeFastlaneUtils.initializeBraintreeFastlaneOrThrow(n,l),this.shouldRunAuthenticationFlow()&&(yield this.braintreeFastlaneUtils.runPayPalAuthenticationFlowOrThrow()),yield this.initializeCardComponent(),this.onError=i.onError,i.onInit((e=>this.renderBraintreeCardComponent(e))),i.onChange((()=>this.handleBraintreeStoredInstrumentChange(n)))}))}execute(e,t){return Ec(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);yield this.paymentIntegrationService.submitOrder(i,t);const r=yield this.preparePaymentPayload(n.methodId);yield this.paymentIntegrationService.submitPayment(r),this.braintreeFastlaneUtils.removeSessionIdFromCookies()}))}finalize(){return Promise.reject(new Os)}deinitialize(){return Ec(this,void 0,void 0,(function*(){return this.braintreeCardComponent=void 0,Promise.resolve()}))}initializeCardComponent(){return Ec(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState(),{phone:t,firstName:n,lastName:i}=e.getBillingAddressOrThrow(),r=`${n} ${i}`,o={styles:{},fields:Object.assign({cardholderName:{prefill:r,enabled:!0}},t&&{phoneNumber:{prefill:t}})},a=this.braintreeFastlaneUtils.getBraintreeFastlaneComponentOrThrow();this.braintreeCardComponent=yield a(o)}))}renderBraintreeCardComponent(e){const t=this.getBraintreeCardComponentOrThrow();if(!e)throw new xn('Unable to initialize payment because "container" argument is not provided.');t.render(e)}preparePaymentPayload(e){var t,n;return Ec(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState(),r=i.getBillingAddressOrThrow(),o=`${r.firstName} ${r.lastName}`,a=this.getPayPalInstruments()[0],s=yield this.braintreeFastlaneUtils.getDeviceSessionId(),d=Ze(i.getStoreConfigOrThrow().checkoutSettings.features,"PROJECT-7080.braintree_fastlane_three_ds");if(a){const t=this.is3DSEnabled&&d?yield this.get3DS(a.bigpayToken,(null==a?void 0:a.iin)||""):void 0;return{methodId:e,paymentData:{deviceSessionId:s,formattedPayload:{paypal_fastlane_token:{token:t||a.bigpayToken}}}}}const{getPaymentToken:c}=this.getBraintreeCardComponentOrThrow(),l=yield c({name:{fullName:o},billingAddress:this.mapToPayPalAddress(r)}),u=(null===(n=null===(t=l.paymentSource.card)||void 0===t?void 0:t.binDetails)||void 0===n?void 0:n.bin)||"",h=this.is3DSEnabled&&d?yield this.get3DS(l.id,u):void 0;return{methodId:e,paymentData:{deviceSessionId:s,nonce:h||l.id}}}))}get3DS(e,t){return Ec(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=yield this.braintreeSdk.getBraintreeThreeDS(),r=n.getOrderOrThrow();return new Promise(((n,o)=>{i.verifyCard({amount:null==r?void 0:r.orderAmount,nonce:e,bin:t,onLookupComplete:(e,t)=>{i.on("customer-canceled",(()=>{"function"==typeof this.onError&&this.onError(new ai),o(new ai)})),t()}},((e,t)=>(e&&"THREEDS_VERIFY_CARD_CANCELED_BY_MERCHANT"===e.code&&("function"==typeof this.onError&&this.onError(new ai),o(new ai)),n(t.nonce))))}))}))}mapToPayPalAddress(e){return{streetAddress:(null==e?void 0:e.address1)||"",locality:(null==e?void 0:e.city)||"",region:(null==e?void 0:e.stateOrProvinceCode)||(null==e?void 0:e.stateOrProvince)||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCodeAlpha2:(null==e?void 0:e.countryCode)||""}}shouldRunAuthenticationFlow(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getCustomerOrThrow(),i=e.getPaymentProviderCustomer(),r=Pc(i)?i:{},o=this.braintreeFastlaneUtils.getSessionIdFromCookies();return!(!n.isGuest||(null==r?void 0:r.authenticationState)===$n.CANCELED||(null==r?void 0:r.authenticationState)||o!==t.id)}getBraintreeCardComponentOrThrow(){if(!this.braintreeCardComponent)throw new Tn;return this.braintreeCardComponent}getPayPalInstruments(){const e=this.paymentIntegrationService.getState().getPaymentProviderCustomerOrThrow();return(Pc(e)?e:{}).instruments||[]}handleBraintreeStoredInstrumentChange(e){return Ec(this,void 0,void 0,(function*(){const t=this.braintreeFastlaneUtils.getBraintreeFastlaneOrThrow(),{selectionChanged:n,selectedCard:i}=yield t.profile.showCardSelector();if(n){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomer(),n=Pc(t)?t:{},r=this.braintreeFastlaneUtils.mapPayPalToBcInstrument(e,[i]);if(r&&r.length>0)return yield this.paymentIntegrationService.updatePaymentProviderCustomer(Object.assign(Object.assign({},n),{instruments:[...r]})),r[0]}}))}}const Ac=Ge((e=>{const t=window,n=new Un(e),i=new Nr(new oi((0,s.vQ)(),t,n),t),r=new qr(e,i),o=new oi((0,s.vQ)(),t,n),a=new ti(o);return new Oc(e,r,a)}),[{id:"braintreeacceleratedcheckout"}]);var kc=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Tc{constructor(e,t,n){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeSdk=n}initialize(e){return kc(this,void 0,void 0,(function*(){const{braintreevisacheckout:t,methodId:n}=e;if(!t)throw new xn('Unable to initialize payment because "options.braintreevisacheckout" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const i=this.paymentIntegrationService.getState();this.paymentMethod=i.getPaymentMethodOrThrow(n);const r=i.getCheckoutOrThrow(),o=i.getStoreConfigOrThrow(),{clientToken:a,config:s}=this.paymentMethod||{};if(!a)throw new vn(yn.MissingPaymentMethod);const{onError:d=c.noop,onPaymentSelect:l=c.noop}=t;this.braintreeSdk.initialize(a);const u=yield this.braintreeSdk.getBraintreeVisaCheckout(),h=yield this.braintreeSdk.getVisaCheckoutSdk(null==s?void 0:s.testMode),m=u.createInitOptions({settings:{locale:o.storeProfile.storeLanguage,shipping:{collectShipping:!1}},paymentRequest:{currencyCode:o.currency.code,subtotal:String(r.subtotal)}});yield h.init(m),h.on("payment.success",(e=>this.tokenizePayment(u,e).then((()=>Promise.all([this.paymentIntegrationService.loadCheckout(),this.paymentIntegrationService.loadPaymentMethod(n)]))).then((()=>l())).catch((e=>d(e))))),h.on("payment.error",((e,t)=>d(t)))}))}execute(e,t){var n,i;return kc(this,void 0,void 0,(function*(){const{payment:r}=e,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!r)throw new xn('Unable to submit payment because "payload.payment" argument is not provided.');if(!(null===(i=null===(n=this.paymentMethod)||void 0===n?void 0:n.initializationData)||void 0===i?void 0:i.nonce))throw new vn(yn.MissingPaymentMethod);const{nonce:a}=this.paymentMethod.initializationData;try{yield this.paymentIntegrationService.submitOrder(o,t),yield this.paymentIntegrationService.submitPayment(Object.assign(Object.assign({},r),{paymentData:{nonce:a}}))}catch(e){this.handleError(e)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return kc(this,void 0,void 0,(function*(){yield this.braintreeSdk.deinitialize()}))}tokenizePayment(e,t){return kc(this,void 0,void 0,(function*(){return Promise.all([e.tokenize(t),this.braintreeSdk.getDataCollectorOrThrow()]).then((([e,t])=>{const n=this.paymentIntegrationService.getState(),i=n.getShippingAddress(),r=n.getBillingAddress(),{shippingAddress:o=this.mapToVisaCheckoutAddress(i),billingAddress:a=this.mapToVisaCheckoutAddress(r)}=e;return this.postForm(Object.assign(Object.assign({},e),{shippingAddress:o,billingAddress:a}),t)}))}))}mapToVisaCheckoutAddress(e){return e?{firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phone,streetAddress:e.address1,extendedAddress:e.address2,locality:e.city,region:e.stateOrProvinceCode,countryCode:e.countryCode,postalCode:e.postalCode}:{}}postForm(e,t){const{userData:n,billingAddress:i,shippingAddress:r,details:o}=e,{userEmail:a}=n,{deviceData:s}=t;return this.formPoster.postForm("/checkout.php",{payment_type:e.type,nonce:e.nonce,provider:"braintreevisacheckout",action:"set_external_checkout",device_data:s,card_information:JSON.stringify({type:o.cardType,number:o.lastTwo}),billing_address:JSON.stringify(this.getAddress(a,i)),shipping_address:JSON.stringify(this.getAddress(a,r))})}getAddress(e,t={}){return{email:e,first_name:t.firstName,last_name:t.lastName,phone_number:t.phoneNumber,address_line_1:t.streetAddress,address_line_2:t.extendedAddress,city:t.locality,state:t.region,country_code:t.countryCode,postal_code:t.postalCode}}handleError(e){if(e instanceof Error&&"BraintreeError"===e.name)throw new ur(e.message);throw e}}const Nc=Ge((e=>{const t=window,n=new Un(e),i=new ti(new oi((0,s.vQ)(),t,n));return new Tc(e,(0,N.createFormPoster)(),i)}),[{id:"braintreevisacheckout"}]);var Mc=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class xc{constructor(e,t){this.paymentIntegrationService=e,this.braintreeIntegrationService=t}initialize(e){return Mc(this,void 0,void 0,(function*(){const{methodId:t}=e;yield this.paymentIntegrationService.loadPaymentMethod(t);const n=this.paymentIntegrationService.getState();this.venmoOptions=e.braintreevenmo;const i=n.getPaymentMethodOrThrow(t);yield this.initializeBraintreeVenmo(i)}))}execute(e){return Mc(this,void 0,void 0,(function*(){const{payment:t}=e,n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!t)throw new Cr(["payment"]);try{const e=yield this.preparePaymentData(t);yield this.paymentIntegrationService.submitOrder(n),yield this.paymentIntegrationService.submitPayment(e)}catch(e){this.handleError(e)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return Mc(this,void 0,void 0,(function*(){return yield this.braintreeIntegrationService.teardown(),Promise.resolve()}))}handleError(e){if(!Qn(e))throw e;if("PAYPAL_POPUP_CLOSED"===e.code)throw new ai(e.message);throw new ur(e.message)}initializeBraintreeVenmo(e){var t;return Mc(this,void 0,void 0,(function*(){const{clientToken:n}=e;if(!n)throw new vn(yn.MissingPaymentMethod);const i=Ze(this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,"PAYPAL-5406.braintree_venmo_web_fallback_support");try{this.braintreeIntegrationService.initialize(n),this.braintreeVenmoCheckout=yield this.braintreeIntegrationService.getVenmoCheckout(Object.assign(Object.assign({},void 0!==(null===(t=this.venmoOptions)||void 0===t?void 0:t.allowDesktop)?{allowDesktop:this.venmoOptions.allowDesktop}:{}),i?{mobileWebFallBack:i}:{}))}catch(e){this.handleError(e)}}))}preparePaymentData(e){return Mc(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),{nonce:n}=t.getPaymentMethodOrThrow(e.methodId);if(n)return Object.assign(Object.assign({},e),{paymentData:this.formattedPayload(n)});const i=yield this.braintreeVenmoTokenize(),r=yield this.braintreeIntegrationService.getSessionId();return Object.assign(Object.assign({},e),{paymentData:this.formattedPayload(i.nonce,i.details.email,r)})}))}formattedPayload(e,t,n){return{formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:n||null,paypal_account:{token:e,email:t||null}}}}braintreeVenmoTokenize(){return new Promise(((e,t)=>{var n;null===(n=this.braintreeVenmoCheckout)||void 0===n||n.tokenize(((n,i)=>{if(n)return t(n);e(i)}))}))}}const Dc=Ge((e=>{const t=window,n=(0,s.vQ)(),i=new Un(e),r=new oi(n,t,i),o=new Nr(r,t);return new xc(e,o)}),[{id:"braintreevenmo"}]);var zc=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Fc{constructor(e,t,n){this.paymentIntegrationService=e,this.braintreeIntegrationService=t,this.braintreeHostedForm=n}initialize(e){return zc(this,void 0,void 0,(function*(){const{methodId:t,gatewayId:n,braintree:i}=e;yield this.paymentIntegrationService.loadPaymentMethod(t);const r=this.paymentIntegrationService.getState();this.paymentMethod=r.getPaymentMethodOrThrow(t);const{clientToken:o}=this.paymentMethod;if(!o)throw new vn(yn.MissingPaymentMethod);this.threeDSecure=null==i?void 0:i.threeDSecure;try{this.braintreeIntegrationService.initialize(o,this.threeDSecure),this.isHostedPaymentFormEnabled(t,n)&&(null==i?void 0:i.form)&&(yield this.braintreeHostedForm.initialize(i.form,i.unsupportedCardBrands,o),this.isHostedFormInitialized=this.braintreeHostedForm.isInitialized()),this.is3dsEnabled=this.paymentMethod.config.is3dsEnabled,this.deviceSessionId=yield this.braintreeIntegrationService.getSessionId(),this.shouldInitializeBraintreeFastlane()&&(yield this.initializeBraintreeFastlaneOrThrow(t))}catch(e){return this.handleError(e)}}))}execute(e){return zc(this,void 0,void 0,(function*(){const{payment:t}=e,n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!t)throw new Cr(["payment"]);this.isHostedFormInitialized&&this.braintreeHostedForm.validate(),yield this.paymentIntegrationService.submitOrder(n);const i=this.paymentIntegrationService.getState(),r=i.getBillingAddressOrThrow(),o=i.getOrderOrThrow().orderAmount;try{const e=this.isHostedFormInitialized?yield this.prepareHostedPaymentData(t,r,o):yield this.preparePaymentData(t,r,o);yield this.paymentIntegrationService.submitPayment(Object.assign(Object.assign({},t),{paymentData:e}))}catch(e){return this.processAdditionalAction(e,t,o)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return zc(this,void 0,void 0,(function*(){return this.isHostedFormInitialized=!1,yield Promise.all([this.braintreeIntegrationService.teardown(),this.braintreeHostedForm.deinitialize()]),Promise.resolve()}))}handleError(e){if(gc(e))throw new ur(e.message);throw e}preparePaymentData(e,t,n){return zc(this,void 0,void 0,(function*(){const{paymentData:i}=e,r={deviceSessionId:this.deviceSessionId};if(this.isSubmittingWithStoredCard(e))return Object.assign(Object.assign({},r),i);const{shouldSaveInstrument:o=!1,shouldSetAsDefaultInstrument:a=!1}=Ms(i)?i:{},{nonce:s}=this.shouldPerform3DSVerification(e)?yield this.braintreeIntegrationService.verifyCard(e,t,n):yield this.braintreeIntegrationService.tokenizeCard(e,t);return Object.assign(Object.assign({},r),{nonce:s,shouldSaveInstrument:o,shouldSetAsDefaultInstrument:a})}))}prepareHostedPaymentData(e,t,n){return zc(this,void 0,void 0,(function*(){const{paymentData:i}=e,r={deviceSessionId:this.deviceSessionId};if(this.isSubmittingWithStoredCard(e)){const{nonce:e}=yield this.braintreeHostedForm.tokenizeForStoredCardVerification();return Object.assign(Object.assign(Object.assign({},r),i),{nonce:e})}const{shouldSaveInstrument:o=!1,shouldSetAsDefaultInstrument:a=!1}=Ms(i)?i:{},{nonce:s}=this.shouldPerform3DSVerification(e)?yield this.verifyCardWithHostedForm(t,n):yield this.braintreeHostedForm.tokenize(t);return Object.assign(Object.assign({},r),{shouldSaveInstrument:o,shouldSetAsDefaultInstrument:a,nonce:s})}))}verifyCardWithHostedForm(e,t){return zc(this,void 0,void 0,(function*(){const n=yield this.braintreeHostedForm.tokenize(e);return this.braintreeIntegrationService.challenge3DSVerification(n,t)}))}processAdditionalAction(e,t,n){return zc(this,void 0,void 0,(function*(){if(!Io(e)||!(0,c.some)(e.body.errors,{code:"three_d_secure_required"}))return this.handleError(e);try{const{payer_auth_request:i}=function(e){return"object"==typeof e&&null!==e&&"name"in e&&"body"in e&&"status"in e.body&&"three_ds_result"in e.body&&"payer_auth_request"in e.body.three_ds_result&&"errors"in e.body}(e)&&e.body.three_ds_result||{},{paymentData:r}=t,o=this.paymentIntegrationService.getState();if(!r||!Es(r))throw new Cr(["instrumentId"]);const a=o.getCardInstrumentOrThrow(r.instrumentId),{nonce:s}=yield this.braintreeIntegrationService.challenge3DSVerification({nonce:i||"",bin:a.iin},n);yield this.paymentIntegrationService.submitPayment(Object.assign(Object.assign({},t),{paymentData:{deviceSessionId:this.deviceSessionId,nonce:s}}))}catch(e){return this.handleError(e)}}))}isHostedPaymentFormEnabled(e,t){return!!e&&!0===this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t).config.isHostedFormEnabled}isSubmittingWithStoredCard(e){return!(!e.paymentData||!Es(e.paymentData))}shouldPerform3DSVerification(e){return!(!this.is3dsEnabled||this.isSubmittingWithStoredCard(e))}shouldInitializeBraintreeFastlane(){var e;const t=this.paymentIntegrationService.getState().getPaymentProviderCustomerOrThrow(),n=Pc(t)?t:{};return(null===(e=this.paymentMethod)||void 0===e?void 0:e.initializationData.isAcceleratedCheckoutEnabled)&&!(null==n?void 0:n.authenticationState)}initializeBraintreeFastlaneOrThrow(e){return zc(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getPaymentMethodOrThrow(e),{clientToken:r,config:o}=i;if(!r)throw new vn(yn.MissingPaymentMethod);this.braintreeIntegrationService.initialize(r,this.threeDSecure),yield this.braintreeIntegrationService.getBraintreeFastlane(n.id,o.testMode)}))}}function Bc(e){return"cardNumber"in e}function Rc(e){if(!Qn(e))return!1;const{details:t}=e;return void 0===t||"object"==typeof t&&null!==t&&void 0===t.invalidFieldKeys||(n=t,Array.isArray(n)&&n.every((e=>"string"==typeof e)));var n}var Lc,jc=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};!function(e){e[e.CreditCard=0]="CreditCard",e[e.StoredCardVerification=1]="StoredCardVerification"}(Lc||(Lc={}));class Uc{constructor(e,t){this.braintreeScriptLoader=e,this.braintreeSDKVersionManager=t,this.isInitializedHostedForm=!1,this.handleBlur=e=>{var t,n;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onBlur)||void 0===n||n.call(t,{fieldType:this.mapFieldType(e.emittedBy),errors:this.mapErrors(e.fields)})},this.handleFocus=e=>{var t,n;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onFocus)||void 0===n||n.call(t,{fieldType:this.mapFieldType(e.emittedBy)})},this.handleCardTypeChange=e=>{var t,n;const i=1===e.cards.length?e.cards[0].type.replace(/^master-card$/,"mastercard"):void 0;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onCardTypeChange)||void 0===n||n.call(t,{cardType:i})},this.handleInputSubmitRequest=e=>{var t,n;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onEnter)||void 0===n||n.call(t,{fieldType:this.mapFieldType(e.emittedBy)})},this.handleValidityChange=e=>{var t,n;null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onValidate)||void 0===n||n.call(t,{isValid:this.isValidForm(e),errors:this.mapValidationErrors(e.fields)})}}initialize(e,t,n){var i,r,o,a,s;return jc(this,void 0,void 0,(function*(){this.clientToken=n,this.formOptions=e,this.type=Bc(e.fields)?Lc.CreditCard:Lc.StoredCardVerification;const d=this.mapFieldOptions(e.fields,t);(0,c.isEmpty)(d)?this.isInitializedHostedForm=!1:(this.cardFields=yield this.createHostedFields({fields:d,styles:e.styles&&this.mapStyleOptions(e.styles)}),null===(i=this.cardFields)||void 0===i||i.on("blur",this.handleBlur),null===(r=this.cardFields)||void 0===r||r.on("focus",this.handleFocus),null===(o=this.cardFields)||void 0===o||o.on("cardTypeChange",this.handleCardTypeChange),null===(a=this.cardFields)||void 0===a||a.on("validityChange",this.handleValidityChange),null===(s=this.cardFields)||void 0===s||s.on("inputSubmitRequest",this.handleInputSubmitRequest),this.isInitializedHostedForm=!0)}))}isInitialized(){return!!this.isInitializedHostedForm}deinitialize(){var e;return jc(this,void 0,void 0,(function*(){this.isInitializedHostedForm&&(this.isInitializedHostedForm=!1,yield null===(e=this.cardFields)||void 0===e?void 0:e.teardown())}))}validate(){if(!this.cardFields)throw new Sn(gn.PaymentNotInitialized);const e=this.cardFields.getState();if(!this.isValidForm(e)){this.handleValidityChange(e);const t=this.mapValidationErrors(e.fields);throw new wr(t)}}tokenize(e){var t,n,i,r,o;return jc(this,void 0,void 0,(function*(){if(!this.cardFields)throw new Sn(gn.PaymentNotInitialized);try{const r=yield this.cardFields.tokenize((0,c.omitBy)({billingAddress:e&&this.mapBillingAddress(e)},c.isNil));return null===(n=null===(t=this.formOptions)||void 0===t?void 0:t.onValidate)||void 0===n||n.call(t,{isValid:!0,errors:{}}),{nonce:r.nonce,bin:null===(i=r.details)||void 0===i?void 0:i.bin}}catch(e){if(Rc(e)){const t=this.mapTokenizeError(e);if(t)throw null===(o=null===(r=this.formOptions)||void 0===r?void 0:r.onValidate)||void 0===o||o.call(r,{isValid:!1,errors:t}),new wr(t)}throw e}}))}tokenizeForStoredCardVerification(){var e,t,n,i,r;return jc(this,void 0,void 0,(function*(){if(!this.cardFields)throw new Sn(gn.PaymentNotInitialized);try{const i=yield this.cardFields.tokenize();return null===(t=null===(e=this.formOptions)||void 0===e?void 0:e.onValidate)||void 0===t||t.call(e,{isValid:!0,errors:{}}),{nonce:i.nonce,bin:null===(n=i.details)||void 0===n?void 0:n.bin}}catch(e){if(Rc(e)){const t=this.mapTokenizeError(e,!0);if(t)throw null===(r=null===(i=this.formOptions)||void 0===i?void 0:i.onValidate)||void 0===r||r.call(i,{isValid:!1,errors:t}),new wr(t)}throw e}}))}createHostedFields(e){return jc(this,void 0,void 0,(function*(){const t=yield this.getClient(),n=yield this.braintreeScriptLoader.loadHostedFields(),i=this.braintreeSDKVersionManager.getSDKVersion()===Rn?Object.assign(Object.assign({},e),{preventCursorJumps:!0}):e;return n.create(Object.assign(Object.assign({},i),{client:t}))}))}getClient(){return jc(this,void 0,void 0,(function*(){if(!this.clientToken)throw new Sn(gn.PaymentNotInitialized);if(!this.client){const e=yield this.braintreeScriptLoader.loadClient();this.client=e.create({authorization:this.clientToken})}return this.client}))}mapBillingAddress(e){return{countryName:e.country,postalCode:e.postalCode,streetAddress:e.address2?`${e.address1} ${e.address2}`:e.address1}}mapFieldOptions(e,t){if(Bc(e)){const n={};return null==t||t.forEach((e=>{(e=>Object.values(Kn).includes(e))(e)&&(n[e]=!1)})),(0,c.omitBy)({number:Object.assign({container:`#${e.cardNumber.containerId}`,placeholder:e.cardNumber.placeholder,internalLabel:e.cardNumber.accessibilityLabel},Object.keys(n).length>0?{supportedCardBrands:n}:{}),expirationDate:{container:`#${e.cardExpiry.containerId}`,placeholder:e.cardExpiry.placeholder,internalLabel:e.cardExpiry.accessibilityLabel},cvv:e.cardCode&&{container:`#${e.cardCode.containerId}`,placeholder:e.cardCode.placeholder,internalLabel:e.cardCode.accessibilityLabel},cardholderName:{container:`#${e.cardName.containerId}`,placeholder:e.cardName.placeholder,internalLabel:e.cardName.accessibilityLabel}},c.isNil)}return(0,c.omitBy)({number:e.cardNumberVerification&&{container:`#${e.cardNumberVerification.containerId}`,placeholder:e.cardNumberVerification.placeholder},cvv:e.cardCodeVerification&&{container:`#${e.cardCodeVerification.containerId}`,placeholder:e.cardCodeVerification.placeholder}},c.isNil)}mapStyleOptions(e){const t=(e={})=>(0,c.omitBy)({color:e.color,"font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight},c.isNil);return{input:t(e.default),".invalid":t(e.error),":focus":t(e.focus)}}mapFieldType(e){switch(e){case"number":return this.type===Lc.StoredCardVerification?Xn.CardNumberVerification:Xn.CardNumber;case"expirationDate":return Xn.CardExpiry;case"cvv":return this.type===Lc.StoredCardVerification?Xn.CardCodeVerification:Xn.CardCode;case"cardholderName":return Xn.CardName;default:throw new Error("Unexpected field type")}}mapErrors(e){const t={};if(e)for(const[n,i]of Object.entries(e))if(i&&this.isValidParam(n)){const{isValid:e,isEmpty:r,isPotentiallyValid:o}=i;t[n]={isValid:e,isEmpty:r,isPotentiallyValid:o}}return t}mapValidationErrors(e){return Object.keys(e).reduce(((t,n)=>{var i;return Object.assign(Object.assign({},t),{[this.mapFieldType(n)]:(null===(i=e[n])||void 0===i?void 0:i.isValid)?void 0:[this.createInvalidError(this.mapFieldType(n))]})}),{})}mapTokenizeError(e,t=!1){var n,i;if("HOSTED_FIELDS_FIELDS_EMPTY"===e.code){const e=[this.createRequiredError(this.mapFieldType("cvv"))];return t?{[this.mapFieldType("cvv")]:e}:{[this.mapFieldType("cvv")]:e,[this.mapFieldType("expirationDate")]:[this.createRequiredError(this.mapFieldType("expirationDate"))],[this.mapFieldType("number")]:[this.createRequiredError(this.mapFieldType("number"))],[this.mapFieldType("cardholderName")]:[this.createRequiredError(this.mapFieldType("cardholderName"))]}}return null===(i=null===(n=e.details)||void 0===n?void 0:n.invalidFieldKeys)||void 0===i?void 0:i.reduce(((e,t)=>{const n=this.mapFieldType(t);return Object.assign(Object.assign({},e),{[n]:[this.createInvalidError(n)]})}),{})}createRequiredError(e){var t;return{fieldType:e,message:null!==(t={[Xn.CardCode]:"CVV is required",[Xn.CardCodeVerification]:"CVV is required",[Xn.CardNumber]:"Credit card number is required",[Xn.CardNumberVerification]:"Credit card number is required",[Xn.CardExpiry]:"Expiration date is required",[Xn.CardName]:"Full name is required"}[e])&&void 0!==t?t:"Field is required",type:"required"}}createInvalidError(e){var t,n,i,r;const o={[Xn.CardCode]:{message:"Invalid card code",type:"invalid_card_code"},[Xn.CardCodeVerification]:{message:"Invalid card code",type:"invalid_card_code"},[Xn.CardNumber]:{message:"Invalid card number",type:"invalid_card_number"},[Xn.CardNumberVerification]:{message:"Invalid card number",type:"invalid_card_number"},[Xn.CardExpiry]:{message:"Invalid card expiry",type:"invalid_card_expiry"},[Xn.CardName]:{message:"Invalid card name",type:"invalid_card_name"}};return{fieldType:e,message:null!==(n=null===(t=o[e])||void 0===t?void 0:t.message)&&void 0!==n?n:"Invalid field",type:null!==(r=null===(i=o[e])||void 0===i?void 0:i.type)&&void 0!==r?r:"invalid"}}isValidForm(e){return Object.keys(e.fields).every((t=>{var n;return null===(n=e.fields[t])||void 0===n?void 0:n.isValid}))}isValidParam(e){return["number","cvv","expirationDate","postalCode","cardholderName","cardType"].includes(e)}}const Vc=Ge((e=>{const t=window,n=new Un(e),i=new oi((0,s.vQ)(),t,n),r=new Nr(i,t),o=new Uc(i,n);return new Fc(e,r,o)}),[{id:"braintree"}]);var qc,Hc=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))},Gc=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};class $c{constructor(e){this._paymentIntegrationService=e}execute(e,t){var n,i;return this._isHostedPaymentFormEnabled(null===(n=e.payment)||void 0===n?void 0:n.methodId,null===(i=e.payment)||void 0===i?void 0:i.gatewayId)&&this._shouldRenderHostedForm?this._executeWithHostedForm(e,t):this._executeWithoutHostedForm(e,t)}initialize(e){if(!this._isHostedPaymentFormEnabled(null==e?void 0:e.methodId,null==e?void 0:e.gatewayId)||!this._isHostedFieldAvailable(e))return this._shouldRenderHostedForm=!1,Promise.resolve();const t=e&&e.creditCard&&e.creditCard.form,n=this._paymentIntegrationService.getState(),{paymentSettings:{bigpayBaseUrl:i=""}={}}=n.getStoreConfigOrThrow();if(!t)throw new xn;const r=this._paymentIntegrationService.createHostedForm(i,t);return r.attach().then((()=>(this._shouldRenderHostedForm=!0,this._hostedForm=r,Promise.resolve())))}deinitialize(){return this._hostedForm&&this._hostedForm.detach(),Promise.resolve()}finalize(){return Promise.reject(new Os)}_executeWithoutHostedForm(e,t){return Hc(this,void 0,void 0,(function*(){const{payment:n}=e,i=Gc(e,["payment"]),r=n&&n.paymentData;if(!n||!r)throw new Cr(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(i,t),yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:r}))}))}_executeWithHostedForm(e,t){return Hc(this,void 0,void 0,(function*(){const{payment:n}=e,i=Gc(e,["payment"]),r=this._hostedForm;if(!r)throw new Sn(gn.PaymentNotInitialized);if(!n||!n.methodId)throw new Cr(["payment.methodId"]);yield this._paymentIntegrationService.submitOrder(i,t),yield r.validate().then((()=>r.submit(n)))}))}_isHostedPaymentFormEnabled(e,t){return!!e&&!0===this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t).config.isHostedFormEnabled}_isHostedFieldAvailable(e){return!(0,c.values)(e&&e.creditCard&&e.creditCard.form.fields).every(c.isNil)}}!function(e){e.OffsiteRedirect="offsite_redirect"}(qc||(qc={}));class Wc extends $c{constructor(e){super(e),this.paymentIntegrationService=e}finalize(e){const t=this.paymentIntegrationService.getState();return t.getOrder()&&t.getPaymentStatus()===Zd.FINALIZE&&this.paymentIntegrationService.finalizeOrder(e),Promise.reject(new Os)}_executeWithHostedForm(e,t){return n=this,r=function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),r=this._hostedForm;if(!r)throw new Sn(gn.PaymentNotInitialized);if(!n||!n.methodId)throw new Cr(["payment.methodId"]);try{yield r.validate(),yield this.paymentIntegrationService.submitOrder(i,t),yield r.submit(n)}catch(e){return this._processResponse(e)}this.paymentIntegrationService.loadCurrentOrder()},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}_processResponse(e){if(!Io(e))return Promise.reject(e);const t=e.body.additional_action_required;return t&&t.type===qc.OffsiteRedirect?this._performRedirect(t):Promise.reject(e)}_performRedirect(e){return new Promise((()=>{window.location.replace(e.data.redirect_url)}))}}class Yc extends Wc{_executeWithoutHostedForm(e,t){return n=this,r=function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),r=n&&n.paymentData;if(!n||!r)throw new Cr(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(i,t);try{yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:Object.assign(Object.assign({},r),{formattedPayload:this._createFormattedPayload(n.methodId,r)})}))}catch(e){return this._processResponse(e)}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}_createFormattedPayload(e,t){if("fawry"===e&&"customerMobile"in t&&"customerEmail"in t){const e=t;return{customerMobile:e.customerMobile,customerEmail:e.customerEmail}}}}const Kc=Ge((e=>new Yc(e)),[{gateway:"checkoutcom",id:"fawry"}]);function Qc(e){return Io(e)&&(0,c.some)(e.body.errors,{code:"three_d_secure_required"})}var Jc=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))},Zc=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};class Xc extends $c{constructor(e,t){super(e),this.paymentIntegrationService=e,this.formPoster=t}finalize(e){const t=this.paymentIntegrationService.getState();return t.getOrder()&&t.getPaymentStatus()===Zd.FINALIZE&&this.paymentIntegrationService.finalizeOrder(e),Promise.reject(new Os)}_executeWithoutHostedForm(e,t){return Jc(this,void 0,void 0,(function*(){const{payment:n}=e,i=Zc(e,["payment"]),r=n&&n.paymentData;if(!n||!r)throw new Cr(["payment.paymentData"]);yield this.paymentIntegrationService.submitOrder(i,t);try{yield this.paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:r}))}catch(e){return Qc(e)?this._handleThreeDSecure(e):Promise.reject(e)}}))}_executeWithHostedForm(e,t){return Jc(this,void 0,void 0,(function*(){const{payment:n}=e,i=Zc(e,["payment"]),r=this._hostedForm;if(!r)throw new Sn(gn.PaymentNotInitialized);if(!n||!n.methodId)throw new Cr(["payment.methodId"]);try{yield r.validate(),yield this.paymentIntegrationService.submitOrder(i,t),yield r.submit(n)}catch(e){return Qc(e)?this._handleThreeDSecure(e):Promise.reject(e)}this.paymentIntegrationService.loadCurrentOrder()}))}_handleThreeDSecure(e){const{acs_url:t,payer_auth_request:n,callback_url:i,merchant_data:r}=e.body.three_ds_result;return new Promise((()=>this.formPoster.postForm(t,{PaReq:n||null,TermUrl:i||null,MD:r||null})))}}const el=Ge((e=>new Xc(e,(0,N.createFormPoster)())),[{gateway:"checkoutcom",id:"credit_card"},{gateway:"checkoutcom",id:"card"}]);class tl extends Wc{_executeWithoutHostedForm(e,t){return n=this,r=function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),r=null==n?void 0:n.paymentData;if(!n||!r)throw new Cr(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(i,t);try{yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:Object.assign(Object.assign({},r),{formattedPayload:this._createFormattedPayload(n.methodId,r)})}))}catch(e){return this._processResponse(e)}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}_createFormattedPayload(e,t){const n={iban:"",bic:""},{iban:i,bic:r}="iban"in t&&"bic"in t?t:n;return"sepa"===e&&document&&(n.iban=i,n.bic=r),n}}const nl=Ge((e=>new tl(e)),[{gateway:"checkoutcom",id:"sepa"}]);class il extends Wc{_executeWithoutHostedForm(e,t){return n=this,r=function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),r=null==n?void 0:n.paymentData;if(!n||!r)throw new Cr(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(i,t);try{yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:Object.assign(Object.assign({},r),{formattedPayload:this._createFormattedPayload(n.methodId,r)})}))}catch(e){return this._processResponse(e)}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}_createFormattedPayload(e,t){if("ideal"===e&&"bic"in t)return{bic:t.bic}}}const rl=Ge((e=>new il(e)),[{gateway:"checkoutcom",id:"ideal"}]),ol=["boleto","oxxo","qpay","ideal"];class al extends Wc{_executeWithoutHostedForm(e,t){return n=this,r=function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),r=null==n?void 0:n.paymentData;if(!n||!r)throw new Cr(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(i,t);try{yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:Object.assign(Object.assign({},r),{formattedPayload:this._createFormattedPayload(n.methodId,r)})}))}catch(e){return this._processResponse(e)}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}_createFormattedPayload(e,t){const n={ccDocument:""},i="ccDocument"in t?t.ccDocument:"";return-1!==ol.indexOf(e)&&i&&(n.ccDocument=i),n}}const sl=Ge((e=>new al(e)),[{gateway:"checkoutcom"}]);var dl=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class cl{constructor(e,t){this._paymentIntegrationService=e,this._clearpayScriptLoader=t}initialize(e){return dl(this,void 0,void 0,(function*(){const{getPaymentMethodOrThrow:t}=this._paymentIntegrationService.getState(),n=t(e.methodId,e.gatewayId);this._clearpaySdk=yield this._clearpayScriptLoader.load(n)}))}deinitialize(){return this._clearpaySdk=void 0,Promise.resolve()}execute(e,t){return dl(this,void 0,void 0,(function*(){const{gatewayId:n,methodId:i}=e.payment||{};if(!n||!i)throw new Cr(["payment.gatewayId","payment.methodId"]);const r=this._paymentIntegrationService.getState(),{isStoreCreditApplied:o}=r.getCheckoutOrThrow();yield this._paymentIntegrationService.applyStoreCredit(o),yield this._paymentIntegrationService.validateCheckout(r.getCheckout(),t);const{countryCode:a}=r.getBillingAddressOrThrow();if(!this._isCountrySupported(a))throw new xn("Unable to proceed because billing country is not supported.");return yield this._loadPaymentMethod(n,i,t),yield this._redirectToClearpay(a,this._paymentIntegrationService.getState().getPaymentMethod(i,n)),new Promise(c.noop)}))}finalize(e){var t,n,i;return dl(this,void 0,void 0,(function*(){const r=this._paymentIntegrationService.getState(),o=r.getPaymentId(),a=r.getContextConfig();if(!o)throw new vn(yn.MissingCheckout);if(!a||!a.payment.token)throw new vn(yn.MissingCheckoutConfig);const s={methodId:o.providerId,paymentData:{nonce:a.payment.token}};yield this._paymentIntegrationService.submitOrder({},e);try{yield this._paymentIntegrationService.submitPayment(s)}catch(e){if(yield this._paymentIntegrationService.forgetCheckout(o.providerId),yield this._paymentIntegrationService.loadPaymentMethods(),Io(e))throw new Us(null===(i=null===(n=null===(t=e.body)||void 0===t?void 0:t.errors)||void 0===n?void 0:n[0])||void 0===i?void 0:i.message)}}))}_redirectToClearpay(e,t){return dl(this,void 0,void 0,(function*(){if(!this._clearpaySdk||!t||!t.clientToken)throw new Sn(gn.PaymentNotInitialized);return this._clearpaySdk.initialize({countryCode:e}),this._clearpaySdk.redirect({token:t.clientToken}),Promise.resolve()}))}_isCountrySupported(e){return"GB"===e}_loadPaymentMethod(e,t,n){var i;return dl(this,void 0,void 0,(function*(){try{return yield this._paymentIntegrationService.loadPaymentMethod(e,Object.assign(Object.assign({},n),{params:Object.assign(Object.assign({},null==n?void 0:n.params),{method:t})}))}catch(e){if(e instanceof gi&&422===(null===(i=e.body)||void 0===i?void 0:i.status))throw new xn("Clearpay can't process your payment for this order, please try another payment method");throw e}}))}}class ll{constructor(e,t=window){this._scriptLoader=e,this._window=t}load(e){return t=this,i=function*(){if(yield this._scriptLoader.loadScript(this._getScriptUrl(e.config.testMode)),!this._window.AfterPay)throw new Tn;return this._window.AfterPay},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}_getScriptUrl(e){return e?"//portal.sandbox.clearpay.co.uk/afterpay-async.js":"//portal.clearpay.co.uk/afterpay-async.js"}}const ul=Ge((e=>new cl(e,new ll((0,s.vQ)()))),[{gateway:"clearpay"},{id:"clearpay"}]),hl=Ge((e=>new $c(e)),[{default:!0}]);var ml=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class pl{constructor(e,t){this._paymentIntegrationService=e,this._cardinalClient=t}prepare(e){return ml(this,void 0,void 0,(function*(){yield this._cardinalClient.load(e.id,e.config.testMode),yield this._cardinalClient.configure(yield this._getClientToken(e))}))}start(e,t,n,i){return ml(this,void 0,void 0,(function*(){const{getCardInstrument:r,getPaymentMethodOrThrow:o}=this._paymentIntegrationService.getState(),{payment:{methodId:a="",paymentData:s={}}={}}=t,d=Es(s)&&r(s.instrumentId),l=d?d.iin:i&&i.getBin();l&&(yield this._cardinalClient.runBinProcess(l));try{return yield e((0,c.merge)(t,{payment:{paymentData:{threeDSecure:{token:o(a).clientToken}}}}),n)}catch(e){if(!Io(e)||!(0,c.some)(e.body.errors,{code:"three_d_secure_required"}))throw e;const n=yield this._cardinalClient.getThreeDSecureData(e.body.three_ds_result,this._getOrderData());if(!i)return void(yield this._paymentIntegrationService.submitPayment((0,c.merge)(t.payment,{paymentData:{threeDSecure:n}})));yield i.submit((0,c.merge)(t.payment,{paymentData:{threeDSecure:n}}))}}))}_getClientToken(e){return ml(this,void 0,void 0,(function*(){return e.clientToken?e.clientToken:(yield this._paymentIntegrationService.loadPaymentMethod(e.id),this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e.id).clientToken||"")}))}_getOrderData(){const e=this._paymentIntegrationService.getState(),t=e.getBillingAddressOrThrow(),n=e.getShippingAddress(),i=e.getCheckoutOrThrow(),r=e.getOrderOrThrow();return{billingAddress:t,shippingAddress:n,currencyCode:i.cart.currency.code,id:r.orderId.toString(),amount:i.cart.cartAmount}}}const yl=[100004,1010,1011,1020];var gl,vl,fl,bl,Sl,Cl,wl;!function(e){e.SetupCompleted="payments.setupComplete",e.Validated="payments.validated"}(gl||(gl={})),function(e){e.Init="init",e.Complete="complete",e.Confirm="confirm"}(vl||(vl={})),function(e){e.Success="SUCCESS",e.NoAction="NOACTION",e.Failure="FAILURE",e.Error="ERROR"}(fl||(fl={})),function(e){e.CCA="CCA",e.Paypal="Paypal",e.Wallet="Wallet",e.VisaCheckout="VisaCheckout",e.ApplePay="ApplePay",e.DiscoverWallet="DiscoverWallet"}(bl||(bl={})),function(e){e.BinProcess="bin.process"}(Sl||(Sl={})),function(e){e.CCA="cca"}(Cl||(Cl={})),function(e){e.Yes="Y",e.No="N"}(wl||(wl={}));class _l{constructor(e){this._scriptLoader=e,this._provider="",this._testMode=!1,this._configurationToken=""}load(e,t=!1){return this._provider=e,this._testMode=t,this._sdk||(this._sdk=this._scriptLoader.load(e,t)),this._sdk.then(c.noop)}configure(e){if(this._configurationToken){if(this._configurationToken===e)return Promise.resolve();this._sdk=this._scriptLoader.load(`${this._provider}.${Date.now()}`,this._testMode)}return this._getClientSDK().then((t=>new Promise(((n,i)=>{t.on(gl.SetupCompleted,(()=>{t.off(gl.SetupCompleted),t.off(gl.Validated),this._configurationToken=e,n()})),t.on(gl.Validated,(e=>{t.off(gl.SetupCompleted),t.off(gl.Validated),e.ActionCode===fl.Error&&((0,c.includes)(yl,e.ErrorNumber)&&i(new vn(yn.MissingPaymentMethod)),i(new ur(e.ErrorDescription)))})),t.setup(vl.Init,{jwt:e})}))))}runBinProcess(e){return this._getClientSDK().then((t=>t.trigger(Sl.BinProcess,e).catch(c.noop))).then((e=>{if(!e||!e.Status)throw new Sn(gn.PaymentNotInitialized)}))}getThreeDSecureData(e,t){return this._getClientSDK().then((n=>new Promise(((i,r)=>{n.on(gl.Validated,((e,t)=>{if(n.off(gl.Validated),!t)return r(new ur(e.ErrorDescription?e.ErrorDescription:"An error was encountered while processing the transaction."));if(!e.ActionCode)return i({token:t});switch(e.ActionCode){case fl.Success:return i({token:t});case fl.NoAction:return e.ErrorNumber>0?r(new ur(e.ErrorDescription)):e.Payment&&e.Payment.ExtendedData&&e.Payment.ExtendedData.SignatureVerification===wl.Yes?i({token:t}):r(new ur("Transaction signature could not be validated."));case fl.Failure:return r(new ur("User failed authentication or an error was encountered while processing the transaction."));case fl.Error:return r(new ur(e.ErrorDescription))}}));const o={AcsUrl:e.acs_url,Payload:e.merchant_data},a=this._mapToPartialOrder(t,e.payer_auth_request);n.continue(Cl.CCA,o,a)}))))}_mapToPartialOrder(e,t){const n={BillingAddress:this._mapToCardinalAddress(e.billingAddress)};return e.paymentData&&(n.Account=this._mapToCardinalAccount(e.paymentData)),e.billingAddress.email&&(n.Email1=e.billingAddress.email),e.shippingAddress&&(n.ShippingAddress=this._mapToCardinalAddress(e.shippingAddress)),{Consumer:n,OrderDetails:{OrderNumber:e.id,Amount:e.amount,CurrencyCode:e.currencyCode,OrderChannel:"S",TransactionId:t}}}_mapToCardinalAccount(e){return{AccountNumber:Number(e.ccNumber),ExpirationMonth:Number(e.ccExpiry.month),ExpirationYear:Number(e.ccExpiry.year),NameOnAccount:e.ccName,CardCode:Number(e.ccCvv)}}_mapToCardinalAddress(e){const t={FirstName:e.firstName,LastName:e.lastName,Address1:e.address1,City:e.city,State:e.stateOrProvince,PostalCode:e.postalCode,CountryCode:e.countryCode};return e.address2&&(t.Address2=e.address2),e.phone&&(t.Phone1=e.phone),t}_getClientSDK(){if(!this._sdk)throw new Sn(gn.PaymentNotInitialized);return this._sdk}}class Il{constructor(e,t=window){this._scriptLoader=e,this._window=t}load(e,t){const n=t?"https://songbirdstag.cardinalcommerce.com/edge/v1/songbird.js":"https://songbird.cardinalcommerce.com/edge/v1/songbird.js";return this._scriptLoader.loadScript(`${n}?v=${e}`).then((()=>{if(!this._window.Cardinal)throw new Tn;return this._window.Cardinal}))}}var Pl=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class El extends $c{constructor(e,t){super(e),this._threeDSecureFlow=t}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return Pl(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const{getPaymentMethodOrThrow:n}=this._paymentIntegrationService.getState(),i=n(e.methodId);i.config.is3dsEnabled&&(yield this._threeDSecureFlow.prepare(i))}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return Pl(this,void 0,void 0,(function*(){const{payment:{methodId:i=""}={}}=e,{getPaymentMethodOrThrow:r}=this._paymentIntegrationService.getState();return r(i).config.is3dsEnabled?this._threeDSecureFlow.start(n.execute.bind(this),e,t,this._hostedForm):n.execute.call(this,e,t)}))}}const Ol=Ge((e=>new El(e,new pl(e,new _l(new Il((0,s.vQ)()))))),[{id:"cybersource"}]);var Al=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class kl{constructor(e,t){this._paymentIntegrationService=e,this._cardinalClient=t}prepare(e){return Al(this,void 0,void 0,(function*(){yield this._cardinalClient.load(e.id,e.config.testMode)}))}start(e,t,n,i){var r,o,a,s;return Al(this,void 0,void 0,(function*(){const{getCardInstrument:d}=this._paymentIntegrationService.getState(),{payment:l={methodId:""}}=t,{paymentData:u={}}=l;try{return yield e(t,n)}catch(e){if(Io(e)&&"additional_action_required"===(null===(r=e.body)||void 0===r?void 0:r.status)){const t=null===(a=null===(o=e.body.additional_action_required)||void 0===o?void 0:o.data)||void 0===a?void 0:a.token,n=null===(s=e.body.three_ds_result)||void 0===s?void 0:s.payer_auth_request;yield this._cardinalClient.configure(t);const r=this._getBin(u,d,i);r&&(yield this._cardinalClient.runBinProcess(r));try{return yield this._submitPayment(l,{xid:n},i)}catch(e){if(Io(e)&&(0,c.some)(e.body.errors,{code:"three_d_secure_required"})){const t=e.body.three_ds_result,n=null==t?void 0:t.payer_auth_request;return yield this._cardinalClient.getThreeDSecureData(t,this._getOrderData()),this._submitPayment(l,{token:n},i)}throw e}}throw e}}))}_getOrderData(){const e=this._paymentIntegrationService.getState(),t=e.getBillingAddressOrThrow(),n=e.getShippingAddress(),{cart:{currency:{code:i},cartAmount:r}}=e.getCheckoutOrThrow();return{billingAddress:t,shippingAddress:n,currencyCode:i,id:e.getOrderOrThrow().orderId.toString(),amount:r}}_submitPayment(e,t,n){return Al(this,void 0,void 0,(function*(){const i=(0,c.merge)({},e,{paymentData:{threeDSecure:t}});n||(yield this._paymentIntegrationService.submitPayment(i)),yield null==n?void 0:n.submit(i)}))}_getBin(e,t,n){const i=Es(e)&&t(e.instrumentId),r=function(e){const t=e;return!Es(t)&&"string"==typeof t.ccName&&"string"==typeof t.ccNumber&&"object"==typeof t.ccExpiry&&"string"==typeof t.ccExpiry.month&&"string"==typeof t.ccExpiry.year}(e)&&e.ccNumber,o=n?n.getBin():r;return(i?i.iin:o)||""}}var Tl=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Nl extends $c{constructor(e,t){super(e),this._threeDSecureFlow=t}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return Tl(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const{getPaymentMethodOrThrow:n}=this._paymentIntegrationService.getState(),i=n(e.methodId);i.config.is3dsEnabled&&(yield this._threeDSecureFlow.prepare(i))}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return Tl(this,void 0,void 0,(function*(){const{payment:{methodId:i=""}={}}=e,{getPaymentMethodOrThrow:r}=this._paymentIntegrationService.getState();return r(i).config.is3dsEnabled?this._threeDSecureFlow.start(n.execute.bind(this),e,t,this._hostedForm):n.execute.call(this,e,t)}))}}const Ml=Ge((e=>new Nl(e,new kl(e,new _l(new Il((0,s.vQ)()))))),[{id:"cybersourcev2"}]);class xl{constructor(e,t){this._formPoster=e,this._paymentIntegrationService=t}execute(e,t){return n=this,r=function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),r=n&&n.paymentData;if(!n||!r)throw new Cr(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(i,t);try{yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:r}))}catch(e){if(!Io(e)||"object"!=typeof(o=e.body)||null===o||!("additional_action_required"in o)||!this._isAdditionalActionRequired(e.body))return Promise.reject(e);const{body:{additional_action_required:{data:{redirect_url:t}}}}=e;return new Promise((()=>{this.redirectUrl(t)}))}var o},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}finalize(){return Promise.reject(new Os)}initialize(){return Promise.resolve()}deinitialize(){return Promise.resolve()}redirectUrl(e){return this._formPoster.postForm(e,{})}_isAdditionalActionRequired(e){const{additional_action_required:t,status:n}=e;return"additional_action_required"===n&&t&&"offsite_redirect"===t.type}}const Dl=Ge((e=>new xl((0,N.createFormPoster)(),e)),[{id:"laybuy"}]);function zl(e){return"object"==typeof e&&null!==e&&"errors"in e&&Array.isArray(e.errors)&&"code"in e.errors[0]&&"string"==typeof e.errors[0].code&&"provider_data"in e&&"object"==typeof e.provider_data}var Fl=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Bl extends uo{constructor(e,t){super("adyen",e),this._scriptLoader=t,this._service=e}initialize(e,t,n){const i=Object.create(null,{initialize:{get:()=>super.initialize},getPaymentMethod:{get:()=>super.getPaymentMethod}});return Fl(this,void 0,void 0,(function*(){yield i.initialize.call(this,e,t,n);const r=i.getPaymentMethod.call(this),o=this._service.getState().getStoreConfig();if(!o)throw new vn(yn.MissingCheckoutConfig);return this._adyenClient=yield this._scriptLoader.load({environment:r.config.testMode?"test":"live",locale:o.storeProfile.storeLanguage}),Promise.resolve()}))}getNonce(e){const t=Object.create(null,{getNonce:{get:()=>super.getNonce},getPaymentMethod:{get:()=>super.getPaymentMethod}});return Fl(this,void 0,void 0,(function*(){const n=yield t.getNonce.call(this,e),i=t.getPaymentMethod.call(this);return JSON.stringify({type:i.method,googlePayToken:n,browser_info:ta()})}))}processAdditionalAction(e){return Fl(this,void 0,void 0,(function*(){if(!Io(e)||!zl(e.body))throw e;const t=yield this._handleAction(e.body.provider_data);try{return yield this._service.submitPayment(t)}catch(e){return this.processAdditionalAction(e)}}))}_handleAction(e){return new Promise(((t,n)=>{const i=JSON.parse(e.action);this._getAdyenClient().createFromAction(i,{onAdditionalDetails:e=>{const n={methodId:i.paymentMethodType,paymentData:{nonce:JSON.stringify(e.data)}};t(n)},size:"05",onError:e=>n(e)}).mount("body"),n(new ai)}))}_getAdyenClient(){if(!this._adyenClient)throw new Sn(gn.PaymentNotInitialized);return this._adyenClient}}var Rl=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ll{constructor(e,t){this._paymentIntegrationService=e,this._googlePayPaymentProcessor=t,this._loadingIndicator=new cs({containerStyles:ss})}initialize(e){var t;return Rl(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.methodId)||!mo(e.methodId))throw new xn('Unable to proceed because "methodId" is not a valid key.');this._methodId=e.methodId;const n=e[this._getMethodId()];if(!(null==n?void 0:n.walletButton))throw new xn("Unable to proceed without valid options.");const{walletButton:i,loadingContainerId:r}=n,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(n,["walletButton","loadingContainerId"]);this._loadingIndicatorContainer=r,yield this._paymentIntegrationService.loadPaymentMethod(this._getMethodId());const a=this._paymentIntegrationService.getState().getPaymentMethodOrThrow(this._getMethodId());yield this._googlePayPaymentProcessor.initialize((()=>a),this._getGooglePayClientOptions(null===(t=a.initializationData)||void 0===t?void 0:t.storeCountry)),this._addPaymentButton(i,o)}))}execute({payment:e}){return Rl(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.methodId))throw new Cr(["payment"]);yield this._paymentIntegrationService.submitOrder();const t=yield this._googlePayPaymentProcessor.getNonce(e.methodId),n=yield this._googlePayPaymentProcessor.extraPaymentData();try{yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},e),{paymentData:Object.assign({nonce:t},n)}))}catch(t){yield this._googlePayPaymentProcessor.processAdditionalAction(t,e.methodId)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this._clickListener&&(null===(e=this._paymentButton)||void 0===e||e.removeEventListener("click",this._clickListener)),this._paymentButton=void 0,this._clickListener=void 0,this._methodId=void 0,Promise.resolve()}_addPaymentButton(e,t){if(this._paymentButton)return;const n=document.getElementById(e);if(!n)throw new xn("Unable to proceed without a walletButton.");this._paymentButton=n,this._clickListener=this._handleClick(t),this._paymentButton.addEventListener("click",this._clickListener)}_handleClick({onPaymentSelect:e,onError:t}){return n=>Rl(this,void 0,void 0,(function*(){n.preventDefault();try{yield this._googlePayPaymentProcessor.initializeWidget(),yield this._interactWithPaymentSheet()}catch(e){let n=e;if(this._toggleLoadingIndicator(!1),ho(e)){if("CANCELED"===e.statusCode)throw new ai;n=new ur(JSON.stringify(e))}throw null==t||t(new ur("An error occurred while requesting your Google Pay payment details.")),n}null==e||e()}))}_interactWithPaymentSheet(){return Rl(this,void 0,void 0,(function*(){const e=yield this._googlePayPaymentProcessor.showPaymentSheet();this._toggleLoadingIndicator(!0);const t=this._googlePayPaymentProcessor.mapToBillingAddressRequestBody(e);t&&(yield this._paymentIntegrationService.updateBillingAddress(t)),yield this._googlePayPaymentProcessor.setExternalCheckoutXhr(this._getMethodId(),e),yield this._paymentIntegrationService.loadCheckout(),yield this._paymentIntegrationService.loadPaymentMethod(this._getMethodId()),this._toggleLoadingIndicator(!1)}))}_getMethodId(){return bn(this._methodId,(()=>new Sn(gn.PaymentNotInitialized)))}_getIsSignedInOrThrow(){return Rl(this,void 0,void 0,(function*(){try{return!!(yield this._googlePayPaymentProcessor.getNonce(this._getMethodId()))}catch(e){if(e instanceof vn&&e.subtype===yn.MissingPaymentToken)return!1;throw e}}))}_handleOfferTrigger(e){return Rl(this,void 0,void 0,(function*(){let t=!1,n="Sign in to Google Pay first to apply or remove promo codes.";try{t=yield this._getIsSignedInOrThrow()}catch(e){e instanceof vn&&(n=e.message)}if(t){const{newOfferInfo:t,error:n}=yield this._googlePayPaymentProcessor.handleCoupons(e);return{newOfferInfo:t,error:n}}return{error:{reason:oo.OFFER_INVALID,message:n,intent:ao.OFFER}}}))}_getGooglePayClientOptions(e){return{paymentDataCallbacks:{onPaymentDataChanged:({callbackTrigger:t,offerData:n})=>Rl(this,void 0,void 0,(function*(){const i=this._paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features["PI-2875.googlepay_coupons_handling"]||!1;if(t!==ao.INITIALIZE&&(!i||t!==ao.OFFER))return;const{offerChangeTriggers:r}=this._googlePayPaymentProcessor.getCallbackTriggers(),{newOfferInfo:o,error:a}=r.includes(t)?yield this._handleOfferTrigger(n):{},s=a;yield this._paymentIntegrationService.loadCheckout();const{getCheckoutOrThrow:d,getCartOrThrow:l}=this._paymentIntegrationService.getState(),{code:u,decimalPlaces:h}=l().currency,m=(0,c.round)(d().outstandingBalance,h).toFixed(h);return Object.assign(Object.assign({newTransactionInfo:Object.assign(Object.assign({},e&&{countryCode:e}),{currencyCode:u,totalPriceStatus:no.FINAL,totalPrice:m})},o&&{newOfferInfo:o}),s&&{error:s})}))}}}_toggleLoadingIndicator(e){e&&this._loadingIndicatorContainer?this._loadingIndicator.show(this._loadingIndicatorContainer):this._loadingIndicator.hide()}}const jl=Ge((e=>new Ll(e,new vo(bo(),new Bl(e,new Is((0,s.vQ)(),(0,s._U)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayadyenv2"}]);var Ul=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Vl extends uo{constructor(e,t){super("adyen",e),this._scriptLoader=t,this._service=e}initialize(e,t,n){const i=Object.create(null,{initialize:{get:()=>super.initialize},getPaymentMethod:{get:()=>super.getPaymentMethod}});return Ul(this,void 0,void 0,(function*(){yield i.initialize.call(this,e,t,n);const r=i.getPaymentMethod.call(this),o=this._service.getState().getStoreConfig();if(!o)throw new vn(yn.MissingCheckoutConfig);return this._adyenClient=yield this._scriptLoader.load({environment:r.config.testMode?"test":"live",locale:o.storeProfile.storeLanguage}),Promise.resolve()}))}processAdditionalAction(e){return Ul(this,void 0,void 0,(function*(){if(!Io(e)||!zl(e.body))throw e;const t=yield this._handleAction(e.body.provider_data);try{return yield this._service.submitPayment(t)}catch(e){return this.processAdditionalAction(e)}}))}getNonce(e){const t=Object.create(null,{getNonce:{get:()=>super.getNonce},getPaymentMethod:{get:()=>super.getPaymentMethod}});return Ul(this,void 0,void 0,(function*(){const n=yield t.getNonce.call(this,e),i=t.getPaymentMethod.call(this);return JSON.stringify({type:i.method,googlePayToken:n,browser_info:ta()})}))}_handleAction(e){return new Promise(((t,n)=>{const i=JSON.parse(e.action);this._getAdyenClient().createFromAction(i,{onAdditionalDetails:e=>{const n={methodId:i.paymentMethodType,paymentData:{nonce:JSON.stringify(e.data)}};t(n)},size:"05",onError:e=>n(e)}).mount("body"),n(new ai)}))}_getAdyenClient(){if(!this._adyenClient)throw new Sn(gn.PaymentNotInitialized);return this._adyenClient}}const ql=Ge((e=>new Ll(e,new vo(bo(),new Vl(e,new Ns((0,s.vQ)(),(0,s._U)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayadyenv3"}]),Hl=Ge((e=>new Ll(e,new vo(bo(),new wo(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayauthorizenet"}]),Gl=Ge((e=>{const t=(0,a.createRequestSender)();return new Ll(e,new vo(bo(),new Oo(e,t),t,(0,N.createFormPoster)()))}),[{id:"googlepaycheckoutcom"}]),$l=Ge((e=>new Ll(e,new vo(bo(),new ko(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaycybersourcev2"},{id:"googlepaybnz"}]),Wl=Ge((e=>new Ll(e,new vo(bo(),new Mo(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayorbital"}]),Yl=Ge((e=>new Ll(e,new vo(bo(),new Fo(e,new Ro((0,s.vQ)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaystripe"},{id:"googlepaystripeupe"},{id:"googlepaystripeocs"}]),Kl=Ge((e=>new Ll(e,new vo(bo(),new Uo(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayworldpayaccess"}]),Ql=Ge((e=>{const t=(0,a.createRequestSender)(),n=window,i=new Un(e),r=new ti(new oi((0,s.vQ)(),n,i));return new Ll(e,new vo(bo(),new Ho(e,r),t,(0,N.createFormPoster)()))}),[{id:"googlepaybraintree"}]);var Jl,Zl;!function(e){e.Approved="APPROVED",e.PayerActionRequired="PAYER_ACTION_REQUIRED"}(Jl||(Jl={})),function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(Zl||(Zl={}));var Xl=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class eu extends Ll{constructor(e,t,n,i){super(e,t),this._payPalCommerceSdk=n,this._requestSender=i}execute({payment:e}){return Xl(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.methodId))throw new Cr(["payment"]);const t=this._paymentIntegrationService.getState(),n=t.getCartOrThrow().id,{initializationData:i}=t.getPaymentMethodOrThrow(this._getMethodId()),{orderId:r}=yield this.getOrderId(n),{card_information:o}=i||{},a=yield this._googlePayPaymentProcessor.getNonce(e.methodId),s={tokenizationData:{type:"PAYMENT_GATEWAY",token:atob(a)},info:{cardNetwork:(null==o?void 0:o.type)||"",cardDetails:(null==o?void 0:o.number)||""},type:"CARD"};yield this.confirmOrder(r,s),yield this._paymentIntegrationService.submitOrder();try{const t={formattedPayload:{method_id:e.methodId,paypal_account:{order_id:r}}};yield this._paymentIntegrationService.submitPayment({methodId:e.methodId,paymentData:t})}catch(e){yield this._googlePayPaymentProcessor.processAdditionalAction(e)}}))}confirmOrder(e,t){return Xl(this,void 0,void 0,(function*(){const n=this._paymentIntegrationService.getState(),i=n.getPaymentMethodOrThrow(this._getMethodId());if(!i.initializationData)throw new vn(yn.MissingPaymentMethod);const r=n.getCartOrThrow().currency.code,o=yield this._payPalCommerceSdk.getPayPalGooglePaySdk(i,r,!0),{status:a}=yield o.Googlepay().confirmOrder({orderId:e,paymentMethodData:t});if(a===Jl.PayerActionRequired)return yield o.Googlepay().initiatePayerAction({orderId:e}),Promise.resolve();if(a!==Jl.Approved)throw new xn("Payment is not approved.");return Promise.resolve()}))}getOrderId(e){return Xl(this,void 0,void 0,(function*(){const t={cartId:e,shouldSaveInstrument:!1},{body:n}=yield this._requestSender.post("/api/storefront/payments/googlepaypaypalcommercecheckout",{headers:Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki),body:t});return n}))}}const tu=Ge((e=>{const t=new Wo((0,s.vQ)());return new eu(e,new vo(bo(),new Qo(e,t),(0,a.createRequestSender)(),(0,N.createFormPoster)()),t,(0,a.createRequestSender)())}),[{id:"googlepaypaypalcommerce"}]);var nu,iu;!function(e){e.Approved="APPROVED",e.PayerActionRequired="PAYER_ACTION_REQUIRED"}(nu||(nu={})),function(e){e.AUTHORIZE="authorize",e.CAPTURE="capture"}(iu||(iu={}));var ru=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ou extends Ll{constructor(e,t,n,i){super(e,t),this._payPalSdkHelper=n,this._requestSender=i}execute({payment:e}){return ru(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.methodId))throw new Cr(["payment"]);const t=this._paymentIntegrationService.getState(),n=t.getCartOrThrow().id,{initializationData:i}=t.getPaymentMethodOrThrow(this._getMethodId()),{orderId:r}=yield this.getOrderId(n),{card_information:o}=i||{},a=yield this._googlePayPaymentProcessor.getNonce(e.methodId),s={tokenizationData:{type:"PAYMENT_GATEWAY",token:atob(a)},info:{cardNetwork:(null==o?void 0:o.type)||"",cardDetails:(null==o?void 0:o.number)||""},type:"CARD"};yield this.confirmOrder(r,s),yield this._paymentIntegrationService.submitOrder();try{const t={formattedPayload:{method_id:e.methodId,paypal_account:{order_id:r}}};yield this._paymentIntegrationService.submitPayment({methodId:e.methodId,paymentData:t})}catch(e){yield this._googlePayPaymentProcessor.processAdditionalAction(e)}}))}confirmOrder(e,t){return ru(this,void 0,void 0,(function*(){const n=this._paymentIntegrationService.getState(),i=n.getPaymentMethodOrThrow(this._getMethodId());if(!i.initializationData)throw new vn(yn.MissingPaymentMethod);const r=n.getCartOrThrow().currency.code,o=yield this._payPalSdkHelper.getPayPalGooglePaySdk(i,r,!0),{status:a}=yield o.Googlepay().confirmOrder({orderId:e,paymentMethodData:t});if(a===nu.PayerActionRequired)return yield o.Googlepay().initiatePayerAction({orderId:e}),Promise.resolve();if(a!==nu.Approved)throw new xn("Payment is not approved.");return Promise.resolve()}))}getOrderId(e){return ru(this,void 0,void 0,(function*(){const t={cartId:e,shouldSaveInstrument:!1},{body:n}=yield this._requestSender.post("/api/storefront/payments/googlepay_bigcommerce_paymentscheckout",{headers:Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki),body:t});return n}))}}const au=Ge((e=>{const t=new Yi((0,s.vQ)());return new ou(e,new vo(bo(),new Xo(e,t),(0,a.createRequestSender)(),(0,N.createFormPoster)()),t,(0,a.createRequestSender)())}),[{id:"googlepay_bigcommerce_payments"}]),su=Ge((e=>new Ll(e,new vo(bo(),new ia(e,(0,N.createFormPoster)()),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaytdonlinemart"}]);class du extends pn{constructor(e,t,n){super(n||"Payment cannot be processed for this order, please select another payment method"),this.type="custom_provider_execute_error",this.name=t,this.subtype=e}}class cu{constructor(e,t){this.paymentIntegrationService=e,this.formPoster=t}execute(e,t){var n,i,r,o;return i=this,o=function*(){const{payment:i}=e,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!(null==i?void 0:i.methodId))throw new Cr(["payment.methodId"]);yield this.paymentIntegrationService.loadPaymentMethod(i.methodId,t);const o=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i.methodId);if(!(null===(n=o.initializationData)||void 0===n?void 0:n.processable))throw new du("payment.humm_not_processable_error","hummNotProcessableError");yield this.paymentIntegrationService.submitOrder(r,t);try{yield this.paymentIntegrationService.submitPayment({methodId:i.methodId})}catch(e){return this.isOffsiteRedirectResponse(e)?this.handleOffsiteRedirectResponse(e):Promise.reject(e)}},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{s(o.next(e))}catch(e){t(e)}}function a(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,a)}s((o=o.apply(i,[])).next())}))}finalize(){return Promise.reject(new Os)}initialize(){return Promise.resolve()}deinitialize(){return Promise.resolve()}handleOffsiteRedirectResponse(e){const t=e.body.additional_action_required.data.redirect_url,n=e.body.provider_data;return new Promise((e=>{this.formPoster.postForm(t,JSON.parse(n),e)}))}isOffsiteRedirectResponse(e){if("object"!=typeof e||null===e)return!1;const t=e;if(!t.body)return!1;const n=t.body;return"additional_action_required"===n.status&&!!n.additional_action_required&&"offsite_redirect"===n.additional_action_required.type&&"string"==typeof n.provider_data}}const lu=Ge((e=>new cu(e,(0,N.createFormPoster)())),[{id:"humm"}]),uu=["AT","BE","CA","CH","CZ","DE","DK","ES","FI","FR","GB","GR","IE","IT","NL","NO","NZ","PL","PT","SE"],hu=["AU"];var mu=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class pu{constructor(e,t){this.paymentIntegrationService=e,this.klarnaScriptLoader=t}initialize(e){return mu(this,void 0,void 0,(function*(){this.klarnaCredit=yield this.klarnaScriptLoader.load(),this.unsubscribe=this.paymentIntegrationService.subscribe((t=>{t.isPaymentMethodInitialized({methodId:e.methodId,gatewayId:e.gatewayId})&&this.loadWidget(e)}),(e=>{const t=e.getCheckout();return t&&t.outstandingBalance}),(e=>{const t=e.getCheckout();return t&&t.coupons})),yield this.loadWidget(e)}))}deinitialize(){return this.unsubscribe&&this.unsubscribe(),Promise.resolve()}execute(e,t){return mu(this,void 0,void 0,(function*(){if(!e.payment)throw new xn('Unable to proceed because "payload.payment" argument is not provided.');const n=e.payment,{paymentData:i}=n,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(n,["paymentData"]),{authorization_token:o}=yield this.authorize();yield this.paymentIntegrationService.initializePayment(r.methodId,{authorizationToken:o}),yield this.paymentIntegrationService.submitOrder(Object.assign(Object.assign({},e),{payment:r,useStoreCredit:e.useStoreCredit}),t)}))}finalize(){return Promise.reject(new Os)}loadWidget(e){return mu(this,void 0,void 0,(function*(){if(!e.klarna)throw new xn('Unable to load widget because "options.klarna" argument is not provided.');const{methodId:t,klarna:{container:n,onLoad:i}}=e;return yield this.paymentIntegrationService.loadPaymentMethod(t),new Promise((e=>{const r=this.paymentIntegrationService.getState().getPaymentMethod(t);if(!r)throw new vn(yn.MissingPaymentMethod);if(!this.klarnaCredit||!r.clientToken)throw new Sn(gn.PaymentNotInitialized);this.klarnaCredit.init({client_token:r.clientToken}),this.klarnaCredit.load({container:n},(t=>{i&&i(t),e(t)}))}))}))}getUpdateSessionData(e,t){if(!(0,c.includes)([...uu,...hu],e.countryCode))return{};const n={billing_address:this.mapToKlarnaAddress(e,e.email)};return t&&(n.shipping_address=this.mapToKlarnaAddress(t,e.email)),n}needsStateCode(e){return(0,c.includes)(hu,e)}mapToKlarnaAddress(e,t){const n={street_address:e.address1,city:e.city,country:e.countryCode,given_name:e.firstName,family_name:e.lastName,postal_code:e.postalCode,region:this.needsStateCode(e.countryCode)?e.stateOrProvinceCode:e.stateOrProvince,email:t};return e.address2&&(n.street_address2=e.address2),e.phone&&(n.phone=e.phone),n}authorize(){return new Promise(((e,t)=>{const n=this.paymentIntegrationService.getState(),i=n.getBillingAddress(),r=n.getShippingAddress();if(!i)throw new vn(yn.MissingBillingAddress);if(!this.klarnaCredit)throw new Sn(gn.PaymentNotInitialized);const o=this.getUpdateSessionData(i,r);this.klarnaCredit.authorize(o,(n=>n.approved?e(n):n.show_form?t(new ai):void t(new hr)))}))}}class yu{constructor(e,t=window){this.scriptLoader=e,this.klarnaWindow=t}load(){var e,t,n,i,r;return n=this,r=function*(){if((null===(e=this.klarnaWindow.Klarna)||void 0===e?void 0:e.Credit)||(yield this.scriptLoader.loadScript("//credit.klarnacdn.net/lib/v1/api.js")),!(null===(t=this.klarnaWindow.Klarna)||void 0===t?void 0:t.Credit))throw new Tn;return this.klarnaWindow.Klarna.Credit},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}))}}const gu=Ge((e=>new pu(e,new yu((0,s.vQ)()))),[{id:"klarna"}]);var vu=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class fu{constructor(e,t,n){this.paymentIntegrationService=e,this.klarnav2ScriptLoader=t,this.klarnav2TokenUpdater=n}initialize(e){return vu(this,void 0,void 0,(function*(){this.klarnaPayments=yield this.klarnav2ScriptLoader.load(),this.unsubscribe=this.paymentIntegrationService.subscribe((t=>{t.isPaymentMethodInitialized({methodId:e.methodId,gatewayId:e.gatewayId})&&this.loadPaymentsWidget(e)}),(e=>{const t=e.getCheckout();return t&&t.outstandingBalance}),(e=>{const t=e.getCheckout();return t&&t.coupons})),yield this.loadPaymentsWidget(e)}))}deinitialize(){return this.unsubscribe&&this.unsubscribe(),Promise.resolve()}execute(e,t){return vu(this,void 0,void 0,(function*(){if(!e.payment)throw new xn('Unable to proceed because "payload.payment" argument is not provided.');const n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e.payment,[]),{gatewayId:i,methodId:r}=n;if(!i)throw new xn('Unable to proceed because "payload.payment.gatewayId" argument is not provided.');const o=this.paymentIntegrationService.getState(),{id:a}=o.getCartOrThrow(),{clientToken:s}=o.getPaymentMethodOrThrow(r);yield this.klarnav2TokenUpdater.klarnaOrderInitialization(a,s);const d=this.isKlarnaSingleRadioButtonEnabled()?i:r,{authorization_token:c}=yield this.authorizeOrThrow(d,r);yield this.paymentIntegrationService.initializePayment(i,{authorizationToken:c}),yield this.paymentIntegrationService.submitOrder(Object.assign(Object.assign({},e),{payment:n,useStoreCredit:e.useStoreCredit}),t)}))}finalize(){return Promise.reject(new Os)}loadPaymentsWidget(e){return vu(this,void 0,void 0,(function*(){if(!e.klarnav2)throw new xn('Unable to load widget because "options.klarnav2" argument is not provided.');const{methodId:t,gatewayId:n,klarnav2:{container:i,onLoad:r}}=e;if(!n)throw new xn('Unable to proceed because "payload.payment.gatewayId" argument is not provided.');const o=this.paymentIntegrationService.getState(),a={params:o.getCartOrThrow().id};return yield this.klarnav2TokenUpdater.updateClientToken(n,{params:a}).catch((()=>{throw new vn(yn.MissingPaymentMethod)})),new Promise((e=>{const n=o.getPaymentMethodOrThrow(t);if(!this.klarnaPayments||!n.clientToken)throw new Sn(gn.PaymentNotInitialized);this.klarnaPayments.init({client_token:n.clientToken}),this.klarnaPayments.load({container:i,payment_method_category:this.isKlarnaSingleRadioButtonEnabled()?n.gateway:t},(t=>{r&&r(t),e(t)}))}))}))}getUpdateSessionData(e,t,n){if(!(0,c.includes)([...uu,...hu],t.countryCode))return{};const i={billing_address:this.mapToKlarnaAddress(e,t,t.email)};return n&&(i.shipping_address=this.mapToKlarnaAddress(e,n,t.email)),i}needsStateCode(e){return(0,c.includes)(hu,e)}mapToKlarnaAddress(e,t,n){const i=this.paymentIntegrationService.getState(),{checkoutSettings:r}=i.getStoreConfigOrThrow(),o=i.getPaymentMethodOrThrow(e),{enableBillie:a}=o.initializationData||{},s={street_address:t.address1,city:t.city,country:t.countryCode,given_name:t.firstName,family_name:t.lastName,postal_code:t.postalCode,region:this.needsStateCode(t.countryCode)?t.stateOrProvinceCode:t.stateOrProvince,email:n};return t.address2&&(s.street_address2=t.address2),t.phone&&(s.phone=t.phone),t.company&&a&&Ze(r.features,"PI-3915.b2b_payment_session_for_klarna")&&(s.organization_name=t.company),s}authorizeOrThrow(e,t){return vu(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.loadCheckout();const n=this.paymentIntegrationService.getState(),i=n.getBillingAddressOrThrow(),r=n.getShippingAddress(),o=this.getUpdateSessionData(t,i,r);return new Promise(((t,n)=>{if(!this.klarnaPayments)return n(new Sn(gn.PaymentNotInitialized));this.klarnaPayments.authorize({payment_method_category:e},o,(e=>e.approved?t(e):e.show_form?n(new ai):void n(new hr)))}))}))}isKlarnaSingleRadioButtonEnabled(){const{features:e}=this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings;return e["PI-4025.klarna_single_radio_button"]}}class bu{constructor(e,t=window){this.scriptLoader=e,this.klarnaWindow=t}load(){var e,t,n,i,r;return n=this,r=function*(){if((null===(e=this.klarnaWindow.Klarna)||void 0===e?void 0:e.Payments)||(yield this.scriptLoader.loadScript("https://x.klarnacdn.net/kp/lib/v1/api.js")),!(null===(t=this.klarnaWindow.Klarna)||void 0===t?void 0:t.Payments))throw new Tn;return this.klarnaWindow.Klarna.Payments},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}))}}class Su{constructor(e){this.requestSender=e}updateClientToken(e,{timeout:t,params:n}={}){const i=`/api/storefront/payments/${e}`;return this.requestSender.get(i,{timeout:t,headers:Object.assign({Accept:Ai.JsonV1,"X-API-INTERNAL":Ei},ki),params:n})}klarnaOrderInitialization(e,t){return n=this,r=function*(){const n={headers:Object.assign({Accept:Ai.JsonV1,"X-API-INTERNAL":Ei},ki),body:{cartId:e,clientToken:t}};yield this.requestSender.put("/api/storefront/initialization/klarna",n)},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}}const Cu=Ge((e=>{const{getHost:t}=e.getState(),n=(0,a.createRequestSender)({host:t()});return new fu(e,new bu((0,s.vQ)()),new Su(n))}),[{gateway:"klarna"}]);class wu{constructor(e){this._paymentIntegrationService=e}execute(e,t){return n=this,r=function*(){return yield this._paymentIntegrationService.submitOrder(e,t),Promise.resolve()},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}finalize(){return Promise.reject(new Os)}initialize(){return Promise.resolve()}deinitialize(){return Promise.resolve()}}const _u=Ge((e=>new wu(e)),[{id:"testgateway"}]);var Iu,Pu=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};!function(e){e.CREDIT_CARD="credit_card"}(Iu||(Iu={}));const Eu=["klarnapaylater","klarnasliceit"];class Ou{constructor(e,t){this.mollieScriptLoader=e,this.paymentIntegrationService=t}initialize(e){return Pu(this,void 0,void 0,(function*(){const{mollie:t,methodId:n,gatewayId:i}=e;if(!t)throw new xn('Unable to initialize payment because "options.mollie" argument is not provided.');if(!n||!i)throw new xn('Unable to initialize payment because "methodId" and/or "gatewayId" argument is not provided.');const r=document.querySelectorAll(".mollie-components-controller");(0,c.each)(r,(e=>e.remove()));const o=this.paymentIntegrationService.getState(),a=o.getStoreConfigOrThrow();this.initializeOptions=t;const s=o.getPaymentMethodOrThrow(n,i),{config:{merchantId:d,testMode:l}}=s;if(this.locale=o.getLocale(),!d)throw new vn(yn.MissingPaymentMethod);return this.isCreditCard(n)&&t.form&&this.shouldShowTSVHostedForm(n,i)?this.hostedForm=yield this.mountCardVerificationfields(t.form):this.isCreditCard(n)&&(this.mollieClient=yield this.loadMollieJs(d,a.storeProfile.storeLanguage,l),this.mountElements()),this.unsubscribe=()=>{if(this.paymentIntegrationService.getState().isPaymentMethodInitialized({methodId:e.methodId,gatewayId:e.gatewayId})){const e=document.getElementById(`${i}-${n}-paragraph`);e&&e.remove(),t.disableButton(!1),this.loadPaymentMethodsAllowed(t,n,i)}},this.unsubscribe(),this.loadPaymentMethodsAllowed(t,n,i),Promise.resolve()}))}execute(e,t){return Pu(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),r=null==n?void 0:n.paymentData;if(!n||!n.gatewayId||!r)throw new Cr(["payment","gatewayId","paymentData"]);try{return yield this.paymentIntegrationService.submitOrder(i,t),Es(r)?yield this.executeWithVaulted(n):this.isCreditCard(n.methodId)?yield this.executeWithCC(n):yield this.executeWithAPM(n)}catch(e){yield this.processAdditionalAction(e)}}))}finalize(){return Promise.resolve()}deinitialize(e){if(this.unsubscribe&&this.unsubscribe(),this.hostedForm&&this.hostedForm.detach(),e&&e.methodId&&e.gatewayId&&!this.hostedForm){const t=document.getElementById(`${e.gatewayId}-${e.methodId}`);t&&t.remove()}else e&&e.methodId&&this.isCreditCard(e.methodId)&&this.cardHolderElement&&this.cardNumberElement&&this.verificationCodeElement&&this.expiryDateElement&&(this.cardHolderElement.unmount(),this.cardHolderElement=void 0,this.cardNumberElement.unmount(),this.cardNumberElement=void 0,this.verificationCodeElement.unmount(),this.verificationCodeElement=void 0,this.expiryDateElement.unmount(),this.expiryDateElement=void 0);return this.mollieClient=void 0,Promise.resolve()}executeWithCC(e){return Pu(this,void 0,void 0,(function*(){const t=e.paymentData,{shouldSaveInstrument:n=!1,shouldSetAsDefaultInstrument:i=!1}=Ms(t)?t:{},{token:r,error:o}=yield this.getMollieClient().createToken();if(o)return Promise.reject(o);const a={credit_card_token:{token:r},vault_payment_instrument:n,set_as_default_stored_instrument:i,browser_info:ta(),shopper_locale:this.getShopperLocale()};yield this.paymentIntegrationService.submitPayment(Object.assign(Object.assign({},e),{paymentData:{formattedPayload:a}}))}))}executeWithVaulted(e){return Pu(this,void 0,void 0,(function*(){if(this.isHostedPaymentFormEnabled(e.methodId,e.gatewayId)){const t=this.hostedForm;if(!t)throw new Sn(gn.PaymentNotInitialized);yield t.validate(),yield t.submit(e),yield this.paymentIntegrationService.loadCurrentOrder()}else yield this.paymentIntegrationService.submitPayment(e)}))}executeWithAPM(e){return Pu(this,void 0,void 0,(function*(){const t=e.paymentData,n=t&&"issuer"in t?t.issuer:"";yield this.paymentIntegrationService.submitPayment(Object.assign(Object.assign({},e),{paymentData:Object.assign(Object.assign({},t),{formattedPayload:{issuer:n,shopper_locale:this.getShopperLocale()}})}))}))}isCreditCard(e){return e===Iu.CREDIT_CARD}shouldShowTSVHostedForm(e,t){return this.isHostedPaymentFormEnabled(e,t)&&this.isHostedFieldAvailable()}mountCardVerificationfields(e){return new Promise(((t,n)=>Pu(this,void 0,void 0,(function*(){try{const n=this.paymentIntegrationService.getState().getStoreConfig(),i=null==n?void 0:n.paymentSettings.bigpayBaseUrl;if(!i)throw new vn(yn.MissingCheckoutConfig);const r=this.paymentIntegrationService.createHostedForm(i,e);yield r.attach(),t(r)}catch(e){n(e)}}))))}isHostedPaymentFormEnabled(e,t){const{getPaymentMethodOrThrow:n}=this.paymentIntegrationService.getState();return!0===n(e,t).config.isHostedFormEnabled}isHostedFieldAvailable(){var e;return!!(null===(e=this.getInitializeOptions().form)||void 0===e?void 0:e.fields)}processAdditionalAction(e){if(!Io(e))return Promise.reject(e);if((0,c.some)(e.body.errors,{code:"additional_action_required"})){const{additional_action_required:{data:{redirect_url:t}}}=e.body;return new Promise((()=>window.location.replace(t)))}return Promise.reject(e)}getInitializeOptions(){if(!this.initializeOptions)throw new Sn(gn.PaymentNotInitialized);return this.initializeOptions}loadMollieJs(e,t,n=!1){return this.mollieClient?Promise.resolve(this.mollieClient):this.mollieScriptLoader.load(e,t,n)}getMollieClient(){if(!this.mollieClient)throw new Sn(gn.PaymentNotInitialized);return this.mollieClient}getShopperLocale(){if(!this.locale)throw new Sn(gn.PaymentNotInitialized);return this.locale}mountElements(){const{containerId:e,cardNumberId:t,cardCvcId:n,cardExpiryId:i,cardHolderId:r,styles:o}=this.getInitializeOptions();let a;e&&(a=document.getElementById(e)),setTimeout((()=>{if(!e||"none"!==(null==a?void 0:a.style.display)){const e=this.getMollieClient();this.cardHolderElement=e.createComponent("cardHolder",{styles:o}),this.cardHolderElement.mount(`#${r}`),this.cardNumberElement=e.createComponent("cardNumber",{styles:o}),this.cardNumberElement.mount(`#${t}`),this.verificationCodeElement=e.createComponent("verificationCode",{styles:o}),this.verificationCodeElement.mount(`#${n}`),this.expiryDateElement=e.createComponent("expiryDate",{styles:o}),this.expiryDateElement.mount(`#${i}`)}}),0)}loadPaymentMethodsAllowed(e,t,n){var i;if(Eu.includes(t)){const r=null===(i=this.paymentIntegrationService.getState().getCartOrThrow().lineItems)||void 0===i?void 0:i.digitalItems;if(r&&r.length>0){const{containerId:i}=this.getInitializeOptions();if(i){const r=document.getElementById(i);if(r){const i=document.createElement("p");i.setAttribute("id",`${n}-${t}-paragraph`),e.unsupportedMethodMessage&&(i.innerText=e.unsupportedMethodMessage,r.appendChild(i),e.disableButton(!0))}}}}}}class Au{constructor(e,t=window){this.scriptLoader=e,this.mollieHostWindow=t}load(e,t,n){return i=this,o=function*(){if(yield this.scriptLoader.loadScript("https://js.mollie.com/v1/mollie.js"),!function(e){return"Mollie"in e}(this.mollieHostWindow))throw new Tn;return this.mollieHostWindow.Mollie(e,{locale:t,testmode:n})},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{s(o.next(e))}catch(e){t(e)}}function a(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,a)}s((o=o.apply(i,[])).next())}));var i,r,o}}const ku=Ge((e=>new Ou(new Au((0,s.vQ)()),e)),[{gateway:"mollie"},{gateway:"mollie",id:"applepay"}]);var Tu=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};const Nu="moneris-payment-iframe";class Mu{constructor(e){this.paymentIntegrationService=e}initialize(e){return Tu(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),{moneris:n,methodId:i}=e;if(!i)throw new xn('Unable to initialize payment because "methodId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.moneris" argument is not provided.');this.initializeOptions=n;const{config:r,initializationData:o}=t.getPaymentMethodOrThrow(i);if(!(null==o?void 0:o.profileId))throw new vn(yn.MissingPaymentMethod);return n.form&&this.shouldShowTSVHostedForm(i)&&(this.hostedForm=yield this.mountCardVerificationfields(n.form)),this.iframe||(this.iframe=this.createIframe(n.containerId,o,!!r.testMode)),Promise.resolve()}))}execute(e,t){return Tu(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);const{isStoreCreditApplied:r}=this.paymentIntegrationService.getState().getCheckoutOrThrow();if(r&&(yield this.paymentIntegrationService.applyStoreCredit(r)),yield this.paymentIntegrationService.submitOrder(i,t),!n.paymentData||!Es(n.paymentData))return this.executeWithCC(n);yield this.executeWithVaulted(n)}))}finalize(){return Promise.reject(new Os)}deinitialize(){return this.hostedForm&&this.hostedForm.detach(),this.windowEventListener&&(window.removeEventListener("message",this.windowEventListener),this.windowEventListener=void 0),this.iframe&&this.iframe.parentNode&&(this.iframe.parentNode.removeChild(this.iframe),this.iframe=void 0),Promise.resolve()}executeWithCC(e){return Tu(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId).config.testMode,n=e.paymentData||{},i=Ms(n)?n:{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1},{shouldSaveInstrument:r,shouldSetAsDefaultInstrument:o}=i,a=yield new Promise(((e,n)=>{if(!this.iframe)throw new Sn(gn.PaymentNotInitialized);const i=this.iframe.contentWindow;if(null===i)throw new Sn(gn.PaymentNotInitialized);i.postMessage("tokenize",this.monerisURL(!!t)),this.windowEventListener=i=>{if("string"==typeof i.data&&i.origin===`https://${t?"esqa":"www3"}.moneris.com`)try{e(this.handleMonerisResponse(i))}catch(e){n(e)}},window.addEventListener("message",this.windowEventListener)}));void 0!==a&&(yield this.paymentIntegrationService.submitPayment({methodId:e.methodId,paymentData:{nonce:a,shouldSaveInstrument:r,shouldSetAsDefaultInstrument:o}}))}))}executeWithVaulted(e){return Tu(this,void 0,void 0,(function*(){if(this.hostedForm){const t=this.hostedForm;return yield t.validate(),yield t.submit(e),this.paymentIntegrationService.loadCurrentOrder()}return this.paymentIntegrationService.submitPayment(e)}))}shouldShowTSVHostedForm(e){return this.isHostedPaymentFormEnabled(e)&&this.isHostedFieldAvailable()}isHostedPaymentFormEnabled(e){const t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e);return Boolean(t.config.isHostedFormEnabled)}isHostedFieldAvailable(){var e;const t=this.getInitializeOptions(),n=(0,c.omitBy)(null===(e=t.form)||void 0===e?void 0:e.fields,c.isEmpty);return!(0,c.isEmpty)(n)}getInitializeOptions(){if(!this.initializeOptions)throw new Sn(gn.PaymentNotInitialized);return this.initializeOptions}mountCardVerificationfields(e){var t;return Tu(this,void 0,void 0,(function*(){const n=null===(t=this.paymentIntegrationService.getState().getStoreConfig())||void 0===t?void 0:t.paymentSettings.bigpayBaseUrl;if(!n)throw new vn(yn.MissingCheckoutConfig);const i=this.paymentIntegrationService.createHostedForm(n,e);return yield i.attach(),i}))}createIframe(e,t,n,i){const r=document.getElementById(e);if(!r)throw new xn("Unable to create iframe without valid container ID.");const o=document.createElement("iframe"),a={id:t.profileId,pmmsg:!0,display_labels:1,enable_exp:1,enable_cvd:1,css_body:(null==i?void 0:i.cssBody)||"font-family: Arial, Helvetica,sans-serif;background: transparent;",css_textbox:(null==i?void 0:i.cssTextbox)||"border-radius:4px;border: 2px solid rgb(00,00,00);width: 100%;font-weight: 600;padding: 8px 8px;outline: 0;",css_textbox_pan:(null==i?void 0:i.cssTextboxCardNumber)||"width: 240px;",css_textbox_exp:(null==i?void 0:i.cssTextboxExpiryDate)||"margin-bottom: 0;width: calc(30% - 12px);",css_textbox_cvd:(null==i?void 0:i.cssTextboxCVV)||"margin-bottom: 0;width: calc(30% - 12px);",css_input_label:(null==i?void 0:i.cssInputLabel)||"font-size: 10px;position: relative;top: 8px;left: 6px;background: rgb(255,255,255);padding: 3px 2px;color: rgb(66,66,66);font-weight: 600;z-index: 2;",pan_label:t.creditCardLabel||"Credit Card Number",exp_label:t.expiryDateLabel||"Expiration",cvd_label:t.cvdLabel||"CVD"},s=(0,c.map)(a,((e,t)=>`${t}=${e}`)).join("&");return o.width="100%",o.height="100%",o.name=Nu,o.id=Nu,o.style.border="none",o.src=`${this.monerisURL(n)}?${s}`,o.allow="payment",r.appendChild(o),o}handleMonerisResponse(e){const t=JSON.parse(e.data);if("001"!==t.responseCode[0])throw new Error(t.errorMessage);return t.dataKey}monerisURL(e){return`https://${e?"esqa":"www3"}.moneris.com/HPPtoken/index.php`}}const xu=Ge((e=>new Mu(e)),[{id:"moneris"}]);class Du{constructor(e){this._paymentIntegrationService=e}execute(e,t){return n=this,r=function*(){yield this._paymentIntegrationService.submitOrder((0,c.omit)(e,"payment"),t)},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}finalize(){return Promise.reject(new Os)}initialize(){return Promise.resolve()}deinitialize(){return Promise.resolve()}}const zu=Ge((e=>new Du(e)),[{id:"nopaymentdatarequired"}]);class Fu{constructor(e){this._paymentIntegrationService=e}execute(e,t){return n=this,r=function*(){return yield this._paymentIntegrationService.submitOrder(Object.assign(Object.assign({},e),{payment:e.payment?{methodId:e.payment.methodId}:void 0}),t),Promise.resolve()},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}finalize(){return Promise.reject(new Os)}initialize(){return Promise.resolve()}deinitialize(){return Promise.resolve()}}const Bu=Ge((e=>new Fu(e)),[{type:"PAYMENT_TYPE_OFFLINE"}]);var Ru=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Lu{constructor(e){this._paymentIntegrationService=e}execute(e,t){return Ru(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),r=this._shouldSubmitFullPayload(n)?e:i,o=n&&n.paymentData,a=o&&Es(o)&&o.instrumentId||void 0,s=o&&Ms(o)&&o.shouldSaveInstrument||void 0,d=o&&Ms(o)&&o.shouldSetAsDefaultInstrument||void 0;if(!n)throw new Cr(["payment"]);const{methodId:c,gatewayId:l}=n;yield this._paymentIntegrationService.submitOrder(r,t),yield this._paymentIntegrationService.initializeOffsitePayment({methodId:c,gatewayId:l,instrumentId:a,shouldSaveInstrument:s,shouldSetAsDefaultInstrument:d})}))}finalize(e){return Ru(this,void 0,void 0,(function*(){const t=this._paymentIntegrationService.getState(),n=t.getOrder(),i=t.getPaymentStatus();if(!n||i!==Zd.ACKNOWLEDGE&&i!==Zd.FINALIZE)return Promise.reject(new Os);yield this._paymentIntegrationService.finalizeOrder(e)}))}initialize(){return Promise.resolve()}deinitialize(){return Promise.resolve()}_shouldSubmitFullPayload(e){return!!e&&("adyen"===e.gatewayId||"barclaycard"===e.gatewayId)}}const ju=Ge((e=>new Lu(e)),[{type:"PAYMENT_TYPE_HOSTED"}]),Uu={"background-color":"rgba(0, 0, 0, 0.4)","z-index":"1000"},Vu=function({styles:e}){const t={};return e.color&&(t.color=e.color),e.layout&&(t.layout=e.layout),(e["logo-type"]||e["logo-position"])&&(t.logo={},e["logo-type"]&&(t.logo.type=e["logo-type"]),e["logo-position"]&&(t.logo.position=e["logo-position"])),e.ratio&&(t.ratio=e.ratio),(e["text-color"]||e["text-size"])&&(t.text={},e["text-color"]&&(t.text.color=e["text-color"]),e["text-size"]&&(t.text.size=+e["text-size"])),t};var qu=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Hu{constructor(e,t,n,i){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.paypalCommerceSdk=n,this.loadingIndicator=i}initialize(e){var t;return qu(this,void 0,void 0,(function*(){const{methodId:n,paypalcommerce:i}=e||{};if(this.paypalcommerce=i,!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.paypalcommerce" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(n),{container:a,bannerContainerId:s}=i,{orderId:d,paypalBNPLConfiguration:c=[],isPayPalCreditAvailable:l}=o.initializationData||{};if(void 0!==s){if(!document.getElementById(s))return void console.error("Unable to create banner without valid banner container ID.");const e=null==c?void 0:c.find((({id:e})=>"checkout"===e));if(l||!(null==e?void 0:e.status))return;const t=yield this.paypalCommerceSdk.getPayPalMessages(o,r.getCartOrThrow().currency.code);return t&&"function"==typeof(null==t?void 0:t.Messages)?this.renderMessages(t,s,e):void console.error("[BC PayPalCommerce PayLater]: banner could not be rendered, due to issues with loading PayPal SDK")}d?this.orderId=null===(t=o.initializationData)||void 0===t?void 0:t.orderId:(this.loadingIndicatorContainer=null==a?void 0:a.split("#")[1],yield this.paypalCommerceIntegrationService.loadPayPalSdk(n),i.onInit&&"function"==typeof i.onInit&&i.onInit((()=>this.renderButton(n,i))),(void 0===i.shouldRenderPayPalButtonOnInitialization||i.shouldRenderPayPalButtonOnInitialization)&&this.renderButton(n,i))}))}execute(e,t){var n,i;return qu(this,void 0,void 0,(function*(){const{payment:r}=e,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{onError:a}=this.paypalcommerce||{},s=this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,d=s&&s["PAYPAL-3438.handling_instrument_declined_error_ppc"];if(!r)throw new Cr(["payment"]);const{methodId:c,paymentData:l}=r;if(this.isPayPalVaultedInstrumentPaymentData(l)&&!this.orderId&&(this.orderId=yield this.createOrder()),!this.orderId)throw new hr;const u=this.isPayPalVaultedInstrumentPaymentData(l)?this.prepareVaultedInstrumentPaymentPayload(c,this.orderId,l):this.preparePaymentPayload(c,this.orderId,l);try{yield this.paymentIntegrationService.submitOrder(o,t),yield this.paymentIntegrationService.submitPayment(u)}catch(e){if(function(e){var t;return Io(e)&&"offsite_redirect"===(null===(t=e.body.additional_action_required)||void 0===t?void 0:t.type)}(e)){const t=null===(i=null===(n=e.body.additional_action_required)||void 0===n?void 0:n.data)||void 0===i?void 0:i.redirect_url;return new Promise((()=>window.location.replace(t)))}return this.isProviderError(e)&&d&&(yield this.paypalCommerceIntegrationService.loadPayPalSdk(r.methodId),yield new Promise(((e,t)=>{var n;this.paypalcommerce&&(null===(n=this.paypalButton)||void 0===n||n.close(),this.renderButton(r.methodId,this.paypalcommerce),this.handleError(new Error("INSTRUMENT_DECLINED"),a)),t()}))),this.handleError(e,a),Promise.reject()}}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}prepareVaultedInstrumentPaymentPayload(e,t,n){const{instrumentId:i,shouldSetAsDefaultInstrument:r}=n,o=!this.isTrustedVaultingFlow(n);return o?{methodId:e,paymentData:{shouldSaveInstrument:o,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t}}}}:{methodId:e,paymentData:{instrumentId:i,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t},bigpay_token:{token:i}}}}}preparePaymentPayload(e,t,n){const{shouldSaveInstrument:i=!1,shouldSetAsDefaultInstrument:r=!1}=Ms(n)?n:{};return{methodId:e,paymentData:{shouldSaveInstrument:i,shouldSetAsDefaultInstrument:r,formattedPayload:{paypal_account:{order_id:t}}}}}renderButton(e,t){const n=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t;if(!a)throw new xn('Unable to initialize payment because "container" argument is not provided.');const u={fundingSource:n.FUNDING.PAYPAL,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o),createOrder:()=>this.createOrder(),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onError:e=>this.handleError(e,s),onCancel:()=>this.toggleLoadingIndicator(!1)};this.paypalButton=n.Buttons(u),this.paypalButton.isEligible()&&(d&&"function"==typeof d&&d(),this.paypalButton.render(a))}handleClick(e,t){return qu(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;return null==t?void 0:t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,null==t||t()}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}createOrder(){return qu(this,void 0,void 0,(function*(){const e=this.getFieldsValues();return this.paypalCommerceIntegrationService.createOrder("paypalcommercecheckout",{shouldSaveInstrument:(null==e?void 0:e.shouldSaveInstrument)||!1})}))}getFieldsValues(){const{getFieldsValues:e}=this.paypalcommerce||{};return"function"==typeof e?e():void 0}isTrustedVaultingFlow(e){if(e&&Es(e)){const t=this.paymentIntegrationService.getState().getInstruments(),n=null==t?void 0:t.find((t=>nd(t)&&t.bigpayToken===e.instrumentId));return!(nd(n)&&!n.trustedShippingAddress)}return!1}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}isPayPalVaultedInstrumentPaymentData(e){return!!e&&Es(e)&&Ms(e)}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"payment",style:Vu(n)};e.Messages(i).render(`#${t}`)}isProviderError(e){var t,n,i;return!!function(e){return"object"==typeof e&&null!==e&&"errors"in e}(e)&&"INSTRUMENT_DECLINED"===(null===(i=null===(n=((null===(t=null==e?void 0:e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error)))||[])[0])||void 0===n?void 0:n.provider_error)||void 0===i?void 0:i.code)}}const Gu=Ge((e=>new Hu(e,fa(e),new Wo((0,s.vQ)()),new cs({containerStyles:Uu}))),[{id:"paypalcommerce"}]);var $u=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Wu{constructor(e,t,n,i){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.loadingIndicator=n,this.paypalCommerceSdk=i}initialize(e){return $u(this,void 0,void 0,(function*(){const{methodId:t,paypalcommerce:n,paypalcommercecredit:i}=e||{},r=i||n;if(!t)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.paypalcommerce" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(t);const o=this.paymentIntegrationService.getState(),a=o.getPaymentMethodOrThrow(t),{paypalBNPLConfiguration:s=[],orderId:d}=a.initializationData||{},{bannerContainerId:c,container:l}=r;if(void 0!==c){if(!document.getElementById(c))return void console.error("Unable to create banner without valid banner container ID.");const e=s&&s.find((({id:e})=>"checkout"===e));if(!(null==e?void 0:e.status))return;const t=yield this.paypalCommerceSdk.getPayPalMessages(a,o.getCartOrThrow().currency.code);return this.renderMessages(t,c,e)}d?this.orderId=d:(yield this.paypalCommerceIntegrationService.loadPayPalSdk(t),this.loadingIndicatorContainer=null==l?void 0:l.split("#")[1],this.renderButton(t,r))}))}execute(e,t){return $u(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);if(!this.orderId)throw new hr;yield this.paymentIntegrationService.submitOrder(i,t),yield this.paypalCommerceIntegrationService.submitPayment(n.methodId,this.orderId)}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}renderButton(e,t){if(!(null==t?void 0:t.container))throw new xn('Unable to initialize payment because "container" argument is not provided.');const n=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u=[n.FUNDING.PAYLATER,n.FUNDING.CREDIT];let h=!1;u.forEach((e=>{if(h)return;const t={fundingSource:e,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o),createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercecreditcheckout"),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onCancel:()=>this.toggleLoadingIndicator(!1),onError:e=>this.handleError(e,s)};if(this.paypalButton=n.Buttons(t),this.paypalButton.isEligible()||e!==n.FUNDING.PAYLATER){if(!this.paypalButton.isEligible()&&e===n.FUNDING.CREDIT)throw new Dn(`PayPal ${e} is not available for your region. Please use PayPal Checkout instead.`);d&&"function"==typeof d&&d(),this.paypalButton.render(a),h=!0}}))}handleClick(e,t){return $u(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;if(t&&"function"==typeof t)return t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,t&&"function"==typeof t&&t()}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"payment",style:Vu(n)};e.Messages(i).render(`#${t}`)}}const Yu=Ge((e=>new Wu(e,fa(e),new cs({containerStyles:Uu}),Aa())),[{id:"paypalcommercecredit"}]);var Ku=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Qu{constructor(e,t,n){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.loadingIndicator=n}initialize(e){var t,n;return Ku(this,void 0,void 0,(function*(){const{methodId:i,paypalcommerce:r,paypalcommercevenmo:o}=e||{},a=o||r;if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!a)throw new xn('Unable to initialize payment because "options.paypalcommercevenmo" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(i);const s=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i);(null===(t=s.initializationData)||void 0===t?void 0:t.orderId)?this.orderId=null===(n=s.initializationData)||void 0===n?void 0:n.orderId:(yield this.paypalCommerceIntegrationService.loadPayPalSdk(i),this.loadingIndicatorContainer=a.container.split("#")[1],this.renderButton(i,a))}))}execute(e,t){return Ku(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);if(!this.orderId)throw new hr;yield this.paymentIntegrationService.submitOrder(i,t),yield this.paypalCommerceIntegrationService.submitPayment(n.methodId,this.orderId)}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this.orderId=void 0,null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}renderButton(e,t){const n=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),{paymentButtonStyles:r}=i.initializationData||{},{checkoutPaymentButtonStyles:o}=r||{},{container:a,onError:s,onRenderButton:d,onValidate:c,submitForm:l}=t,u={fundingSource:n.FUNDING.VENMO,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o),createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercevenmocheckout"),onClick:(e,t)=>this.handleClick(t,c),onApprove:e=>this.handleApprove(e,l),onCancel:()=>this.toggleLoadingIndicator(!1),onError:e=>this.handleError(e,s)};if(this.paypalButton=n.Buttons(u),!this.paypalButton.isEligible())throw new Dn("PayPal Venmo is not available for your region. Please use PayPal Checkout instead.");d&&"function"==typeof d&&d(),this.paypalButton.render(a)}handleClick(e,t){return Ku(this,void 0,void 0,(function*(){const{resolve:n,reject:i}=e;return t((()=>(this.toggleLoadingIndicator(!0),n())),i)}))}handleApprove({orderID:e},t){this.orderId=e,t(),this.toggleLoadingIndicator(!1)}handleError(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const Ju=Ge((e=>new Qu(e,fa(e),new cs({styles:{backgroundColor:"black"}}))),[{id:"paypalcommercevenmo"}]);var Zu=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Xu{constructor(e,t,n,i,r=3e3,o=3e5){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.paypalCommerceSdk=n,this.loadingIndicator=i,this.pollingInterval=r,this.maxPollingIntervalTime=o,this.pollingTimer=0,this.stopPolling=c.noop,this.isPollingEnabled=!1}initialize(e){return Zu(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,paypalcommerce:i,paypalcommercealternativemethods:r}=e,o=r||i;if(this.paypalcommercealternativemethods=r,!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!o)throw new xn('Unable to initialize payment because "options.paypalcommercealternativemethods" argument is not provided.');const a=this.paymentIntegrationService.getState(),s=a.getPaymentMethodOrThrow(n,t),{orderId:d,shouldRenderFields:c}=s.initializationData||{},l=a.getStoreConfigOrThrow().checkoutSettings.features;this.isPollingEnabled=Ze(l,"PAYPAL-5192.paypal_commerce_ideal_polling"),d?this.orderId=d:(this.paypalApms=yield this.paypalCommerceSdk.getPayPalApmsSdk(s,a.getCartOrThrow().currency.code),this.loadingIndicatorContainer=o.container.split("#")[1],this.renderButton(n,t,o),c&&this.renderFields(n,o))}))}execute(e,t){return Zu(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);const{methodId:r,gatewayId:o}=n;if(!this.orderId)throw new hr;this.isPollingEnabled&&"ideal"===r&&(yield new Promise(((e,t)=>{this.initializePollingMechanism(r,e,t,o)}))),this.isNonInstantPaymentMethod(r)||(yield this.paymentIntegrationService.submitOrder(i,t)),yield this.paypalCommerceIntegrationService.submitPayment(r,this.orderId,o)}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;return this.orderId=void 0,this.isPollingEnabled&&this.resetPollingMechanism(),null===(e=this.paypalButton)||void 0===e||e.close(),Promise.resolve()}initializePollingMechanism(e,t,n,i){return Zu(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.paypalCommerceIntegrationService.getOrderStatus(i),o=r===ua.Approved,a=r===ua.PollingError;if(o)return this.deinitializePollingMechanism(),t();if(a)return n();if(!o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,paypalcommercealternativemethods:this.paypalcommercealternativemethods}),this.handleError(new pd)}catch(e){n()}}))}deinitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deinitializePollingMechanism()}reinitializeStrategy(e){return Zu(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}handleError(e){const{onError:t}=this.paypalcommercealternativemethods||{};this.isPollingEnabled&&this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}renderButton(e,t,n){const i=this.getPaypalAmpsSdkOrThrow(),r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t),{buttonStyle:o}=r.initializationData||{},{container:a,onError:s,onRenderButton:d,submitForm:c}=n,l={fundingSource:e,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o),onInit:(e,t)=>n.onInitButton(t),createOrder:()=>this.onCreateOrder(e,t,n),onApprove:e=>this.handleApprove(e,c),onCancel:()=>{this.toggleLoadingIndicator(!1),this.deinitializePollingMechanism()},onError:e=>{this.deinitializePollingMechanism(),this.handleFailure(e,s)},onClick:(e,t)=>Zu(this,void 0,void 0,(function*(){return n.onValidate(t.resolve,t.reject)}))};this.paypalButton=i.Buttons(l),this.paypalButton.isEligible()&&(d&&"function"==typeof d&&d(),this.paypalButton.render(a))}onCreateOrder(e,t,n){return Zu(this,void 0,void 0,(function*(){const{onValidate:i}=n;yield i((()=>(this.toggleLoadingIndicator(!0),()=>Promise.resolve())),c.noop);const r=yield this.paypalCommerceIntegrationService.createOrder("paypalcommercealternativemethodscheckout");if(this.isNonInstantPaymentMethod(e)){const n={useStoreCredit:!1},i={params:{methodId:e,gatewayId:t}};yield this.paymentIntegrationService.submitOrder(n,i),yield this.paypalCommerceIntegrationService.submitPayment(e,r,t)}return r}))}handleApprove({orderID:e},t){this.orderId=e,t()}handleFailure(e,t){this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}renderFields(e,t){const n=this.getPaypalAmpsSdkOrThrow(),i=this.paymentIntegrationService.getState(),{firstName:r,lastName:o,email:a}=i.getBillingAddressOrThrow(),{apmFieldsContainer:s,apmFieldsStyles:d}=t;if(!s)throw new xn('Unable to initialize payment because "options.paypalcommercealternativemethods" argument should contain "apmFieldsContainer".');const c=document.querySelector(s);c&&(c.innerHTML="");const l={fundingSource:e,style:d||{},fields:{name:{value:`${r} ${o}`},email:{value:a}}};n.PaymentFields(l).render(s)}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}isNonInstantPaymentMethod(e){return e.toUpperCase()in la}getPaypalAmpsSdkOrThrow(){if(!this.paypalApms)throw new Tn;return this.paypalApms}}const eh=Ge((e=>new Xu(e,fa(e),Aa(),new cs({containerStyles:Uu}))),[{gateway:"paypalcommercealternativemethods"}]);function th(e){return!!e&&("authenticationState"in e||"addresses"in e||"instruments"in e)}var nh=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ih{constructor(e,t,n,i){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.paypalCommerceSdk=n,this.paypalCommerceFastlaneUtils=i}initialize(e){return nh(this,void 0,void 0,(function*(){const{methodId:t,paypalcommercecreditcards:n,paypalcommerce:i}=e,r=n||i,{form:o,onCreditCardFieldsRenderingError:a}=r||{};if(!t)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!o)throw new xn('Unable to proceed because "options.paypalcommercecreditcards.form" argument is not provided.');this.hostedFormOptions=o,this.isCreditCardForm=Sd(o.fields),this.isCreditCardVaultedForm=Cd(o.fields)&&!this.hasUndefinedValues(),yield this.paymentIntegrationService.loadPaymentMethod(t),yield this.paypalCommerceIntegrationService.loadPayPalSdk(t,void 0,!0,!0),(this.isCreditCardForm||this.isCreditCardVaultedForm)&&(yield this.initializeFields(o,a)),this.shouldInitializePayPalFastlane(t)&&(yield this.initializePayPalFastlaneOrThrow(t))}))}execute(e,t){return nh(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{methodId:r,paymentData:o}=n||{};if(!n||!r)throw new Cr(["payment"]);if(this.executionPaymentData=o,this.isCreditCardForm||this.isCreditCardVaultedForm)yield this.validateHostedFormOrThrow(),yield this.submitHostedForm();else{const{orderId:e}=yield this.paypalCommerceIntegrationService.createOrderCardFields("paypalcommercecreditcardscheckout",this.getInstrumentParams());this.returnedOrderId=e}const a=this.preparePaymentPayload(r,o,this.returnedOrderId,this.returnedVaultedToken);yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment(a)}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e,t,n,i;return nh(this,void 0,void 0,(function*(){return yield null===(e=this.cvvField)||void 0===e?void 0:e.close(),yield null===(t=this.expiryField)||void 0===t?void 0:t.close(),yield null===(n=this.numberField)||void 0===n?void 0:n.close(),yield null===(i=this.nameField)||void 0===i?void 0:i.close(),Promise.resolve()}))}preparePaymentPayload(e,t,n,i){const{shouldSaveInstrument:r=!1,shouldSetAsDefaultInstrument:o=!1}=Ms(t)?t:{},a=t&&Es(t)?t.instrumentId:void 0,s=(0,c.omitBy)({verification_nonce:i,token:a},c.isNil);return{methodId:e,paymentData:{shouldSaveInstrument:r,shouldSetAsDefaultInstrument:o,instrumentId:a,formattedPayload:Object.assign(Object.assign({},i||a?{bigpay_token:s}:{}),n?{card_with_order:{order_id:n}}:{})}}}initializeFields(e,t){return nh(this,void 0,void 0,(function*(){const{fields:n,styles:i}=e,r=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),o=this.getExecuteCallback(n),a=Object.assign({style:this.getInputStyles(i),onApprove:({orderID:e,vaultSetupToken:t,liabilityShift:n})=>{if(n===oa.No||n===oa.Unknown)throw new Error;return this.handleApprove({orderID:e,vaultSetupToken:t})},onError:()=>{throw new ur},inputEvents:{onChange:t=>this.onChangeHandler(e,t),onFocus:t=>this.onFocusHandler(e,t),onBlur:t=>this.onBlurHandler(e,t),onInputSubmitRequest:t=>this.onInputSubmitRequest(e,t)}},o);if(this.cardFields=yield r.CardFields(a),!this.cardFields.isEligible())throw new Sn(gn.PaymentNotInitialized);try{this.stylizeInputContainers(n),Sd(n)&&(yield this.renderFields(n)),Cd(n)&&(yield this.renderVaultedFields(n))}catch(e){"function"==typeof t&&t(e)}}))}getExecuteCallback(e){return Cd(e)?this.createVaultSetupTokenCallback():this.createOrderCallback()}createVaultSetupTokenCallback(){return{createVaultSetupToken:()=>nh(this,void 0,void 0,(function*(){const{setupToken:e}=(yield this.paypalCommerceIntegrationService.createOrderCardFields("paypalcommercecreditcardscheckout",Object.assign(Object.assign({},this.getInstrumentParams()),{setupToken:!0})))||{};return e}))}}createOrderCallback(){return{createOrder:()=>nh(this,void 0,void 0,(function*(){const{orderId:e}=(yield this.paypalCommerceIntegrationService.createOrderCardFields("paypalcommercecreditcardscheckout",this.getInstrumentParams()))||{};return e}))}}handleApprove({orderID:e,vaultSetupToken:t}){e&&(this.returnedOrderId=e),t&&(this.returnedVaultedToken=t)}renderFields(e){var t,n,i,r;return nh(this,void 0,void 0,(function*(){const o=this.getCardFieldsOrThrow();(null===(t=e.cardCode)||void 0===t?void 0:t.containerId)&&(this.cvvField=o.CVVField({placeholder:""}),yield this.cvvField.render(`#${e.cardCode.containerId}`)),(null===(n=e.cardExpiry)||void 0===n?void 0:n.containerId)&&(this.expiryField=o.ExpiryField(),yield this.expiryField.render(`#${e.cardExpiry.containerId}`)),(null===(i=e.cardName)||void 0===i?void 0:i.containerId)&&(this.nameField=o.NameField({placeholder:""}),yield this.nameField.render(`#${e.cardName.containerId}`)),(null===(r=e.cardNumber)||void 0===r?void 0:r.containerId)&&(this.numberField=o.NumberField({placeholder:""}),yield this.numberField.render(`#${e.cardNumber.containerId}`))}))}renderVaultedFields(e){var t,n,i;return nh(this,void 0,void 0,(function*(){const r=this.getCardFieldsOrThrow();(null===(t=e.cardCodeVerification)||void 0===t?void 0:t.containerId)&&(this.cvvField=r.CVVField({placeholder:""}),yield this.cvvField.render(`#${e.cardCodeVerification.containerId}`)),(null===(n=e.cardExpiryVerification)||void 0===n?void 0:n.containerId)&&(this.expiryField=r.ExpiryField(),yield this.expiryField.render(`#${e.cardExpiryVerification.containerId}`)),(null===(i=e.cardNumberVerification)||void 0===i?void 0:i.containerId)&&(this.numberField=r.NumberField({placeholder:""}),yield this.numberField.render(`#${e.cardNumberVerification.containerId}`))}))}getInstrumentParams(){if(!this.executionPaymentData)return{};if(Ms(this.executionPaymentData)){const{shouldSaveInstrument:e,shouldSetAsDefaultInstrument:t}=this.executionPaymentData;return{shouldSaveInstrument:e,shouldSetAsDefaultInstrument:t}}if(Es(this.executionPaymentData)){const{instrumentId:e}=this.executionPaymentData;return{instrumentId:e}}return{}}getFieldTypeByEmittedField({emittedBy:e}){return{fieldType:this.mapFieldType(e)}}submitHostedForm(){return nh(this,void 0,void 0,(function*(){const e=this.getCardFieldsOrThrow(),t=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),n={billingAddress:{company:t.company,addressLine1:t.address1,addressLine2:t.address2,adminArea1:t.stateOrProvinceCode,adminArea2:t.city,postalCode:t.postalCode,countryCode:t.countryCode}};try{this.isCreditCardVaultedForm?yield e.submit():yield e.submit(n)}catch(e){throw new ur("Failed authentication. Please try to authorize again.")}}))}validateHostedFormOrThrow(){var e,t;return nh(this,void 0,void 0,(function*(){const n=this.getCardFieldsOrThrow(),i=yield n.getState().then((e=>e)),r=this.getValidityData(i);if(!r.isValid)throw null===(t=null===(e=this.hostedFormOptions)||void 0===e?void 0:e.onValidate)||void 0===t||t.call(e,r),new wr(this.mapValidationErrors(r.errors))}))}getValidityData({fields:e}){const t=Object.assign({},e);delete t.cardNameField;const n=Object.keys(t);return{isValid:n.every((e=>{var n;return null===(n=t[e])||void 0===n?void 0:n.isValid})),errors:n.reduce(((e,n)=>{var i;const r=this.mapFieldType(n);return Object.assign(Object.assign({},e),{[r]:(null===(i=t[n])||void 0===i?void 0:i.isValid)?void 0:[this.getInvalidErrorByFieldType(r)]})}),{})}}getInvalidErrorByFieldType(e){switch(e){case bd.CardCode:case bd.CardCodeVerification:return{fieldType:e,message:"Invalid card code",type:"invalid_card_code"};case bd.CardNumber:case bd.CardNumberVerification:return{fieldType:e,message:"Invalid card number",type:"invalid_card_number"};case bd.CardExpiry:case bd.CardExpiryVerification:return{fieldType:e,message:"Invalid card expiry",type:"invalid_card_expiry"};default:return{fieldType:e,message:"Invalid field",type:"invalid"}}}mapValidationErrors(e={}){const t={};return Object.keys(e).forEach((n=>{var i,r;t[n]=[{message:(null===(r=null===(i=e[n])||void 0===i?void 0:i[0])||void 0===r?void 0:r.message)||"",type:n}]})),t}mapFieldType(e){switch(e){case"name":return bd.CardName;case"cardNumberField":case"number":return this.isCreditCardForm?bd.CardNumber:bd.CardNumberVerification;case"cardExpiryField":case"expiry":return this.isCreditCardForm?bd.CardExpiry:bd.CardExpiryVerification;case"cardCvvField":case"cvv":return this.isCreditCardForm?bd.CardCode:bd.CardCodeVerification;default:throw new Error("Unexpected field type")}}getCardFieldsOrThrow(){if(!this.cardFields)throw new Sn(gn.PaymentNotInitialized);return this.cardFields}getInputStyles(e){var t,n,i;const r={"font-size":(null===(t=null==e?void 0:e.default)||void 0===t?void 0:t.fontSize)||"1rem","font-family":(null===(n=null==e?void 0:e.default)||void 0===n?void 0:n.fontFamily)||"Montserrat, Arial, Helvetica, sans-serif","font-weight":(null===(i=null==e?void 0:e.default)||void 0===i?void 0:i.fontWeight)||"400",outline:"none",padding:"9px 13px"},o=Object.assign(Object.assign({},r),{color:"#333333"});return{input:o,".invalid":Object.assign(Object.assign({},r),{color:"red"}),".valid":o,":focus":o}}stylizeInputContainers(e){Object.values(e||{}).forEach((e=>{const t=document.getElementById(`${(null==e?void 0:e.containerId)||""}`);t&&(t.style.padding="0px",t.style.boxShadow="none",t.style.border="none",t.style.background="transparent",t.style.marginBottom="10px",t.style.marginLeft="-5px")}))}hasUndefinedValues(){return!this.hostedFormOptions||Object.values(this.hostedFormOptions.fields).some((e=>void 0===e))}onChangeHandler(e,t){var n;null===(n=null==e?void 0:e.onValidate)||void 0===n||n.call(e,this.getValidityData(t))}onFocusHandler(e,t){var n;null===(n=null==e?void 0:e.onFocus)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}onBlurHandler(e,t){var n;null===(n=null==e?void 0:e.onBlur)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}onInputSubmitRequest(e,t){var n;null===(n=null==e?void 0:e.onEnter)||void 0===n||n.call(e,this.getFieldTypeByEmittedField(t))}shouldInitializePayPalFastlane(e){var t,n;const i=this.paymentIntegrationService.getState(),r=i.getPaymentMethodOrThrow(e),o=i.getPaymentProviderCustomer(),a=th(o)?o:{};return(null===(t=null==r?void 0:r.initializationData)||void 0===t?void 0:t.isAcceleratedCheckoutEnabled)&&(null===(n=null==r?void 0:r.initializationData)||void 0===n?void 0:n.isPayPalCommerceAnalyticsV2Enabled)&&!(null==a?void 0:a.authenticationState)}initializePayPalFastlaneOrThrow(e){return nh(this,void 0,void 0,(function*(){try{const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getPaymentMethodOrThrow(e),{initializationData:r}=i;if(!(null==r?void 0:r.connectClientToken))return;const o=yield this.paypalCommerceSdk.getPayPalFastlaneSdk(i,n.currency.code,n.id);yield this.paypalCommerceFastlaneUtils.initializePayPalFastlane(o,!!(null==r?void 0:r.isDeveloperModeApplicable))}catch(e){}}))}}const rh=Ge((e=>new ih(e,fa(e),Aa(),Ra())),[{id:"paypalcommercecreditcards"}]);var oh=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ah{constructor(e,t,n,i=3e3,r=3e5){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.loadingIndicator=n,this.pollingInterval=i,this.maxPollingIntervalTime=r,this.pollingTimer=0,this.stopPolling=c.noop}initialize(e){return oh(this,void 0,void 0,(function*(){const{gatewayId:t,methodId:n,paypalcommerceratepay:i}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.gatewayId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.paypalcommerceratepay" argument is not provided.');const{legalTextContainer:r,container:o,loadingContainerId:a}=i;if(!o)throw new xn('Unable to initialize payment because "options.container" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.legalTextContainer" argument is not provided.');if(!a)throw new xn('Unable to initialize payment because "options.loadingContainerId" argument is not provided.');this.loadingIndicatorContainer=a;const s=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n,t),{merchantId:d}=s.initializationData||{};if(!d)throw new xn("Unable to initialize payment because merchantId argument is not provided.");this.paypalcommerceratepay=i,yield this.paypalCommerceIntegrationService.loadPayPalSdk(n),this.createFraudNetScript(d,n,t),this.loadFraudnetConfig(),this.renderLegalText(r,o)}))}execute(e,t){return oh(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{getFieldsValues:r}=this.paypalcommerceratepay||{};if(!n)throw new Cr(["payment"]);if(!r||"function"!=typeof r)throw new xn('Unable to initialize payment because "options.getFieldsValues" argument is not provided.');this.toggleLoadingIndicator(!0);try{const e=yield this.paypalCommerceIntegrationService.createOrder("paypalcommercealternativemethodscheckout",{metadataId:this.guid}),{ratepayBirthDate:o,ratepayPhoneNumber:a,ratepayPhoneCountryCode:s}=r(),d={formattedPayload:{vault_payment_instrument:null,set_as_default_stored_instrument:null,device_info:null,method_id:n.methodId,rate_pay:{birth_date:this.normalizeDate(o),phone:{national_number:a,country_code:s.split("+")[1]}},paypal_account:{order_id:e}}};return yield this.paymentIntegrationService.submitOrder(i,t),yield this.paymentIntegrationService.submitPayment({methodId:n.methodId,paymentData:d}),yield new Promise(((e,t)=>{this.initializePollingMechanism(n.methodId,e,t,n.gatewayId)}))}catch(e){return this.handleError(e),new Promise(((e,t)=>t()))}}))}finalize(){return Promise.reject(new Os)}deinitialize(){const{legalTextContainer:e}=this.paypalcommerceratepay||{},t=document.querySelectorAll('[data-id="fraudnetScript"]')[0],n=document.querySelectorAll('[data-id="fraudnetConfig"]')[0];if(this.deinitializePollingMechanism(),t.remove(),n.remove(),e){const t=document.getElementById(e);null==t||t.remove()}return Promise.resolve()}normalizeDate(e){const t=this.formatDate(e.getDate()),n=this.formatDate(e.getMonth()+1);return`${e.getFullYear()}-${n}-${t}`}formatDate(e){return`${e<10?0:""}${e}`}renderLegalText(e,t){const n=e,i=t.split("#")[1],r=document.getElementById(i),o=null==r?void 0:r.parentNode,a=document.createElement("div");a.style.marginBottom="20px",a.setAttribute("id",n),null==o||o.prepend(a);const s=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),d=s.Legal({fundingSource:s.Legal.FUNDING.PAY_UPON_INVOICE});if(!document.getElementById(n))throw new xn('Unable to initialize payment because "legalTextContainerElement" argument is not found.');d.render(`#${n}`)}handleError(e){const{onError:t}=this.paypalcommerceratepay||{};this.resetPollingMechanism(),this.toggleLoadingIndicator(!1),t&&"function"==typeof t&&t(e)}createFraudNetScript(e,t,n){const i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t,n),{testMode:r}=i.config,o=document.createElement("script");o.setAttribute("type","application/json"),o.setAttribute("fncls","fnparams-dede7cc5-15fd-4c75-a9f4-36c430ee3a99"),o.setAttribute("data-id","fraudnetScript"),this.guid=this.generateGUID();const a={f:this.guid,s:`${e}_checkout-page`,sandbox:r};o.innerHTML=JSON.stringify(a),document.body.appendChild(o)}generateGUID(){let e="";for(let t=0;t<32;t+=1)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())];return e}loadFraudnetConfig(){const e=document.createElement("script");e.setAttribute("data-id","fraudnetConfig"),e.src="https://c.paypal.com/da/r/fb.js",document.body.appendChild(e)}reinitializeStrategy(e){return oh(this,void 0,void 0,(function*(){yield this.deinitialize(),yield this.initialize(e)}))}initializePollingMechanism(e,t,n,i){return oh(this,void 0,void 0,(function*(){yield new Promise(((e,t)=>{const n=setTimeout(e,this.pollingInterval);this.stopPolling=()=>(clearTimeout(n),this.toggleLoadingIndicator(!1),t())}));try{this.pollingTimer+=this.pollingInterval;const r=yield this.paypalCommerceIntegrationService.getOrderStatus("paypalcommercealternativemethods",{params:{useMetadata:!0}}),o=r===ua.PollingStop,a=r===ua.PollingError;if(o)return this.deinitializePollingMechanism(),t();if(a)return n();if(!o&&this.pollingTimer<this.maxPollingIntervalTime)return yield this.initializePollingMechanism(e,t,n,i);yield this.reinitializeStrategy({methodId:e,gatewayId:i,paypalcommerceratepay:this.paypalcommerceratepay}),this.handleError(new pd)}catch(e){this.handleError(e),n()}}))}deinitializePollingMechanism(){this.stopPolling(),this.pollingTimer=0}resetPollingMechanism(){this.deinitializePollingMechanism()}toggleLoadingIndicator(e){e&&this.loadingIndicatorContainer?this.loadingIndicator.show(this.loadingIndicatorContainer):this.loadingIndicator.hide()}}const sh=Ge((e=>new ah(e,fa(e),new cs({containerStyles:Object.assign(Object.assign({},Uu),{position:"fixed"})}))),[{gateway:"paypalcommercealternativemethods",id:"ratepay"}]);function dh(e){return!!e&&("authenticationState"in e||"addresses"in e||"instruments"in e)}var ch=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class lh{constructor(e,t,n,i){this.paymentIntegrationService=e,this.paypalCommerceRequestSender=t,this.paypalCommerceSdk=n,this.paypalCommerceFastlaneUtils=i}initialize(e){var t,n;return ch(this,void 0,void 0,(function*(){const{methodId:i,paypalcommercefastlane:r}=e;if(this.methodId=i,this.paypalcommercefastlane=r,!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.paypalcommercefastlane" argument is not provided.');if(!r.onInit||"function"!=typeof r.onInit)throw new xn('Unable to initialize payment because "options.paypalcommercefastlane.onInit" argument is not provided or it is not a function.');if(!r.onChange||"function"!=typeof r.onChange)throw new xn('Unable to initialize payment because "options.paypalcommercefastlane.onChange" argument is not provided or it is not a function.');yield this.paymentIntegrationService.loadPaymentMethod(i);const o=this.paymentIntegrationService.getState(),a=o.getCartOrThrow(),s=o.getPaymentMethodOrThrow(i),{isDeveloperModeApplicable:d,isFastlaneStylingEnabled:c}=s.initializationData||{};this.threeDSVerificationMethod=null===(t=s.initializationData)||void 0===t?void 0:t.threeDSVerificationMethod,this.paypalFastlaneSdk=yield this.paypalCommerceSdk.getPayPalFastlaneSdk(s,a.currency.code,a.id);const l=ja(c?null===(n=null==s?void 0:s.initializationData)||void 0===n?void 0:n.fastlaneStyles:{},null==r?void 0:r.styles);yield this.paypalCommerceFastlaneUtils.initializePayPalFastlane(this.paypalFastlaneSdk,!!d,l),this.shouldRunAuthenticationFlow()&&(yield this.runPayPalAuthenticationFlowOrThrow(i)),yield this.initializePayPalPaymentComponent(),r.onInit((e=>this.renderPayPalPaymentComponent(e))),r.onChange((()=>this.handlePayPalStoredInstrumentChange(i)))}))}execute(e,t){return ch(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);const{paymentData:r,methodId:o}=n,a=r&&Es(r);try{yield this.paymentIntegrationService.submitOrder(i,t);const e=a?yield this.prepareVaultedInstrumentPaymentPayload(o,r):yield this.preparePaymentPayload(o,r);yield this.paymentIntegrationService.submitPayment(e),this.paypalCommerceFastlaneUtils.removeStorageSessionId()}catch(e){if(function(e){return"object"==typeof e&&null!==e&&"message"in e&&"response"in e&&"body"in e.response&&"name"in e.response.body}(e)&&"INVALID_REQUEST"===e.response.body.name){const e={translationKey:"payment.errors.invalid_request_error"};return this.handleError(e),Promise.reject()}if(e instanceof Error&&"FastlaneError"!==e.name)throw e;return Promise.reject()}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return ch(this,void 0,void 0,(function*(){return Promise.resolve()}))}shouldRunAuthenticationFlow(){const e=this.paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getCustomerOrThrow(),i=e.getPaymentProviderCustomer(),r=dh(i)?i:{},o=this.paypalCommerceFastlaneUtils.getStorageSessionId();return!(!n.isGuest||(null==r?void 0:r.authenticationState)===za.CANCELED||(null==r?void 0:r.authenticationState)||o!==t.id)}runPayPalAuthenticationFlowOrThrow(e){return ch(this,void 0,void 0,(function*(){try{const t=this.paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getCustomer(),r=t.getBillingAddress(),o=(null==i?void 0:i.email)||(null==r?void 0:r.email)||"",{customerContextId:a}=yield this.paypalCommerceFastlaneUtils.lookupCustomerOrThrow(o),s=yield this.paypalCommerceFastlaneUtils.triggerAuthenticationFlowOrThrow(a),{authenticationState:d,addresses:c,instruments:l}=this.paypalCommerceFastlaneUtils.mapPayPalFastlaneProfileToBcCustomerData(e,s);yield this.paymentIntegrationService.updatePaymentProviderCustomer({authenticationState:d,addresses:c,instruments:l}),s.authenticationState===za.CANCELED?this.paypalCommerceFastlaneUtils.removeStorageSessionId():this.paypalCommerceFastlaneUtils.updateStorageSessionId(n.id)}catch(e){}}))}initializePayPalPaymentComponent(){return ch(this,void 0,void 0,(function*(){const e=this.paymentIntegrationService.getState().getBillingAddressOrThrow(),t=e.phone,n=`${e.firstName} ${e.lastName}`.trim(),i=this.paypalCommerceFastlaneUtils.getPayPalFastlaneOrThrow(),r={fields:Object.assign({cardholderName:{prefill:n,enabled:!0}},t&&{phoneNumber:{prefill:t}})};this.paypalComponentMethods=yield i.FastlaneCardComponent(r)}))}renderPayPalPaymentComponent(e){const t=this.getPayPalComponentMethodsOrThrow();if(!e)throw new xn('Unable to render card component because "container" argument is not provided.');t.render(e)}getPayPalComponentMethodsOrThrow(){if(!this.paypalComponentMethods)throw new Tn;return this.paypalComponentMethods}prepareVaultedInstrumentPaymentPayload(e,t){return ch(this,void 0,void 0,(function*(){const{instrumentId:n}=t,i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e),r=this.isPaypalCommerceFastlaneThreeDSAvailable()&&i.config.is3dsEnabled;r||(yield this.createOrder(n));const o=r?yield this.get3DSNonce(n):n;return{methodId:e,paymentData:{formattedPayload:{paypal_fastlane_token:{order_id:this.orderId,token:o}}}}}))}preparePaymentPayload(e,t){return ch(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getBillingAddressOrThrow(),r=n.getPaymentMethodOrThrow(e),o=`${i.firstName} ${i.lastName}`.trim(),{getPaymentToken:a}=this.getPayPalComponentMethodsOrThrow(),{id:s}=yield a({name:{fullName:o},billingAddress:this.paypalCommerceFastlaneUtils.mapBcToPayPalAddress(i)}),d=this.isPaypalCommerceFastlaneThreeDSAvailable()&&r.config.is3dsEnabled;d||(yield this.createOrder(s));const c=d?yield this.get3DSNonce(s):s,{shouldSaveInstrument:l=!1,shouldSetAsDefaultInstrument:u=!1}=Ms(t)?t:{};return{methodId:e,paymentData:Object.assign(Object.assign({},t),{shouldSaveInstrument:l,shouldSetAsDefaultInstrument:u,formattedPayload:{paypal_fastlane_token:{order_id:this.orderId,token:c}}})}}))}createOrder(e){return ch(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getCartOrThrow().id;if(this.methodId){const{orderId:n}=yield this.paypalCommerceRequestSender.createOrder(this.methodId,{cartId:t,fastlaneToken:e});this.orderId=n}}))}get3DSNonce(e){var t;return ch(this,void 0,void 0,(function*(){const n=this.paymentIntegrationService.getState(),i=n.getCartOrThrow(),r=n.getOrderOrThrow(),o=n.getStoreConfigOrThrow().links.checkoutLink,a=null===(t=this.paypalFastlaneSdk)||void 0===t?void 0:t.ThreeDomainSecureClient;if(!a)throw new Tn;const s={amount:r.orderAmount.toFixed(2),currency:i.currency.code,nonce:e,threeDSRequested:"SCA_ALWAYS"===this.threeDSVerificationMethod,transactionContext:{experience_context:{locale:"en-US",return_url:o,cancel_url:o}}};if(yield a.isEligible(s)){const{liabilityShift:e,authenticationState:t,nonce:n}=yield a.show();if(e===oa.No||e===oa.Unknown||t===Ta.Errored||t===Ta.Cancelled)throw new hr;if(t===Ta.Succeeded)return yield this.createOrder(n),n}return e}))}handlePayPalStoredInstrumentChange(e){return ch(this,void 0,void 0,(function*(){const t=this.paypalCommerceFastlaneUtils.getPayPalFastlaneOrThrow(),{selectionChanged:n,selectedCard:i}=yield t.profile.showCardSelector();if(n){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomer(),n=dh(t)?t:{},r=this.paypalCommerceFastlaneUtils.mapPayPalToBcInstrument(e,i)[0];return yield this.paymentIntegrationService.updatePaymentProviderCustomer(Object.assign(Object.assign({},n),{instruments:[r]})),r}}))}isPaypalCommerceFastlaneThreeDSAvailable(){return Ze(this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features,"PROJECT-7080.paypalcommerce_fastlane_three_ds")}handleError(e){var t;(null===(t=this.paypalcommercefastlane)||void 0===t?void 0:t.onError)&&"function"==typeof this.paypalcommercefastlane.onError&&this.paypalcommercefastlane.onError(e)}}const uh=Ge((e=>{const{getHost:t}=e.getState();return new lh(e,new ya((0,a.createRequestSender)({host:t()})),Aa(),Ra())}),[{id:"paypalcommerceacceleratedcheckout"}]);var hh=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class mh extends $c{constructor(e,t){super(e),this.paymentIntegrationService=e,this.threeDSecureFlow=t}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return hh(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId);n.config.is3dsEnabled&&(yield this.threeDSecureFlow.prepare(n))}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return hh(this,void 0,void 0,(function*(){const{payment:{methodId:i=""}={}}=e,r=this.paymentIntegrationService.getState();return r.getPaymentStatus()===Zd.ACKNOWLEDGE?(yield this.paymentIntegrationService.submitOrder(Object.assign(Object.assign({},e),{payment:{methodId:i}}),t),Promise.resolve()):r.getPaymentMethodOrThrow(i).config.is3dsEnabled?this.threeDSecureFlow.start(n.execute.bind(this),e,t,this._hostedForm):n.execute.call(this,e,t)}))}}const ph=Ge((e=>new mh(e,new pl(e,new _l(new Il((0,s.vQ)()))))),[{id:"paypal"}]);class yh extends $c{constructor(e,t){super(e),this.paymentIntegrationService=e,this._formPoster=t}execute(e,t){const{payment:n}=e;if(!n)throw new Sn(gn.PaymentNotInitialized);const{paymentData:i}=n;if(!i)throw new vn(yn.MissingPayment);if(this._isThreeDSTwoExperimentOn()){const t=Object.assign(Object.assign({},i),{browser_info:ta()});e.payment&&(e.payment.paymentData=t)}return super.execute(e,t).catch((e=>Io(e)&&(0,c.some)(e.body.errors,{code:"three_d_secure_required"})?new Promise((()=>{let t;t=this._isThreeDSTwoExperimentOn()&&!e.body.three_ds_result.merchant_data?{creq:e.body.three_ds_result.payer_auth_request}:{PaReq:e.body.three_ds_result.payer_auth_request,TermUrl:e.body.three_ds_result.callback_url,MD:e.body.three_ds_result.merchant_data},this._formPoster.postForm(e.body.three_ds_result.acs_url,t,void 0,"_top")})):Promise.reject(e)))}finalize(e){const t=this.paymentIntegrationService.getState();return t.getOrder()&&t.getPaymentStatus()===Zd.FINALIZE&&this.paymentIntegrationService.finalizeOrder(e),super.finalize()}_isThreeDSTwoExperimentOn(){return!0===this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features["INT-4994.Opayo_3DS2"]}}const gh=Ge((e=>new yh(e,(0,N.createFormPoster)())),[{id:"sagepay"}]);class vh extends xl{redirectUrl(e){window.location.replace(e)}}const fh=Ge((e=>new vh((0,N.createFormPoster)(),e)),[{id:"sezzle"}]);var bh;!function(e){e.CHARGE="CHARGE",e.STORE="STORE"}(bh||(bh={}));var Sh=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ch{constructor(e,t){this._scriptLoader=e,this._paymentIntegrationService=t}initialize({testMode:e,applicationId:t,locationId:n}){return Sh(this,void 0,void 0,(function*(){const i=yield this._scriptLoader.load(e);this._payments=i.payments(t,n)}))}deinitialize(){return Sh(this,void 0,void 0,(function*(){this._formValidationSubscription&&this._formValidationSubscription.unsubscribe(),this._card&&(yield this._card.destroy()),this._formValidationSubscription=void 0,this._card=void 0,this._payments=void 0}))}initializeCard({containerId:e,style:t,onValidationChange:n}){return Sh(this,void 0,void 0,(function*(){const{postalCode:i}=this._paymentIntegrationService.getState().getBillingAddress()||{};this._card=yield this._getPayments().card(),yield this._card.attach(`#${e}`);try{yield this._card.configure({postalCode:i,style:t})}catch(e){}n&&(this._formValidationSubscription=this._subscribeToFormValidation(this._card,n))}))}tokenize(){return Sh(this,void 0,void 0,(function*(){const e=yield this._getCard().tokenize();if("OK"!==e.status||!e.token){let t=`Tokenization failed with status: ${e.status}`;throw e.errors&&(t+=` and errors: ${JSON.stringify(e.errors)}`),new du("payment.errors.card_error","SquareV2TokenizationError",t)}return e.token}))}verifyBuyer(e,t){return Sh(this,void 0,void 0,(function*(){return t===bh.CHARGE?this._chargeVerifyBuyer(e):this._storeVerifyBuyer(e)}))}_getPayments(){return bn(this._payments,(()=>new Sn(gn.PaymentNotInitialized)))}_subscribeToFormValidation(e,t){const n=["cardNumber","cvv"],i=new Set(n),r=["focusClassAdded","focusClassRemoved","errorClassAdded","errorClassRemoved","cardBrandChanged","postalCodeChanged"].map((t=>(0,v.R)(e,t)));return(0,f.h)(...r).pipe((0,P.T)((e=>{const{detail:{field:t,currentState:{isCompletelyValid:r}}}=e;return n.includes(t)&&i[r?"delete":"add"](t),0===i.size})),(0,_.F)()).subscribe(t)}_getCard(){return bn(this._card,(()=>new Sn(gn.PaymentNotInitialized)))}_mapToSquareBillingContact({firstName:e,lastName:t,address1:n,address2:i,city:r,stateOrProvinceCode:o,postalCode:a,countryCode:s,email:d,phone:c}){return{givenName:e,familyName:t,addressLines:[n,i],city:r,state:o,postalCode:a,countryCode:s,email:d,phone:c}}_chargeVerifyBuyer(e){return Sh(this,void 0,void 0,(function*(){const{getCheckoutOrThrow:t,getBillingAddressOrThrow:n}=this._paymentIntegrationService.getState(),{outstandingBalance:i,cart:r}=t(),o={amount:i.toString(),billingContact:this._mapToSquareBillingContact(n()),currencyCode:r.currency.code,intent:bh.CHARGE},a=yield this._getPayments().verifyBuyer(e,o);return a?a.token:""}))}_storeVerifyBuyer(e){return Sh(this,void 0,void 0,(function*(){const{getBillingAddressOrThrow:t}=this._paymentIntegrationService.getState(),n={billingContact:this._mapToSquareBillingContact(t()),intent:bh.STORE},i=yield this._getPayments().verifyBuyer(e,n);return i?i.token:""}))}}var wh,_h=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ih{constructor(e,t){this._paymentIntegrationService=e,this._squareV2PaymentProcessor=t}initialize(e){var t;return _h(this,void 0,void 0,(function*(){if(!(null===(t=null==e?void 0:e.squarev2)||void 0===t?void 0:t.containerId))throw new xn('Unable to proceed because "containerId" argument is not provided.');const{methodId:n,squarev2:i}=e,{config:{testMode:r},initializationData:o}=this._paymentIntegrationService.getState().getPaymentMethodOrThrow(n),{applicationId:a,locationId:s}=o||{};if(!a)throw new hr;yield this._squareV2PaymentProcessor.initialize({applicationId:a,locationId:s,testMode:r}),yield this._squareV2PaymentProcessor.initializeCard(i)}))}execute({payment:e}){return _h(this,void 0,void 0,(function*(){if(!e)throw new Cr(["payment"]);const{methodId:t,paymentData:n}=e,{shouldSaveInstrument:i,shouldSetAsDefaultInstrument:r}=Ms(n)?n:{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1};yield this._paymentIntegrationService.submitOrder();const o=n&&Es(n)?yield this._getVaultedInstrumentPayload(t,n):yield this._getCardPayload(t,i);yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},e),{paymentData:{formattedPayload:Object.assign(Object.assign({},o),{vault_payment_instrument:i||!1,set_as_default_stored_instrument:r||!1})}}))}))}finalize(){return Promise.reject(new Os)}deinitialize(){return this._squareV2PaymentProcessor.deinitialize()}shouldVerify(){const{features:e}=this._paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings;return e["PROJECT-3828.add_3ds_support_on_squarev2"]}_getCardPayload(e,t){return _h(this,void 0,void 0,(function*(){const{getPaymentMethodOrThrow:n}=this._paymentIntegrationService.getState(),{initializationData:i}=n(e),r=yield this._squareV2PaymentProcessor.tokenize();if(i&&"isSquareV2ApiV2Enabled"in i?!i.isSquareV2ApiV2Enabled:!this.shouldVerify())return{credit_card_token:{token:r}};let o={nonce:r,token:yield this._squareV2PaymentProcessor.verifyBuyer(r,bh.CHARGE)};if(t){const e=yield this._squareV2PaymentProcessor.tokenize();o=Object.assign(Object.assign({},o),{store_card_nonce:e,store_card_token:yield this._squareV2PaymentProcessor.verifyBuyer(e,bh.STORE)})}return{credit_card_token:{token:JSON.stringify(o)}}}))}_getVaultedInstrumentPayload(e,t){return _h(this,void 0,void 0,(function*(){const{getPaymentMethodOrThrow:n}=this._paymentIntegrationService.getState(),{initializationData:i}=n(e),{instrumentId:r}=t,o=(i&&"isSquareV2ApiV2Enabled"in i?i.isSquareV2ApiV2Enabled:this.shouldVerify())?yield this._squareV2PaymentProcessor.verifyBuyer(yield this._getSquareCardIdOrThrow(e,r),bh.CHARGE):void 0;return{bigpay_token:Object.assign({token:r},o&&{three_d_secure:{token:o}})}}))}_getSquareCardIdOrThrow(e,t){return _h(this,void 0,void 0,(function*(){const n=yield this._paymentIntegrationService.loadPaymentMethod(e,{params:{method:e,bigpayToken:t}}),{initializationData:i}=n.getPaymentMethodOrThrow(e),{cardId:r}=i||{};if(!r)throw new Cr(["cardId"]);return r}))}}!function(e){e.LIVE="https://web.squarecdn.com/v1/square.js",e.SANDBOX="https://sandbox.web.squarecdn.com/v1/square.js"}(wh||(wh={}));class Ph{constructor(e){this._scriptLoader=e}load(e=!1){return t=this,i=function*(){return yield this._scriptLoader.loadScript(e?wh.SANDBOX:wh.LIVE),function(){if(!function(e){return"Square"in e}(window))throw new Tn}(),window.Square},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}}const Eh=Ge((e=>new Ih(e,new Ch(new Ph((0,s.vQ)()),e))),[{id:"squarev2"}]);function Oh(e){return null!==e&&"object"==typeof e&&"cardNumberElementOptions"in e&&"cardCvcElementOptions"in e&&"cardExpiryElementOptions"in e&&void 0!==e.cardNumberElementOptions&&void 0!==e.cardCvcElementOptions&&void 0!==e.cardExpiryElementOptions}var Ah,kh,Th,Nh;!function(e){e.Solid="solid",e.Default="default"}(Ah||(Ah={})),function(e){e.Alipay="alipay",e.CardCvc="cardCvc",e.CardExpiry="cardExpiry",e.CardNumber="cardNumber",e.CreditCard="card",e.IDEAL="idealBank",e.Sepa="iban"}(kh||(kh={})),function(e){e.Alipay="alipay",e.CreditCard="card",e.IDEAL="ideal",e.Sepa="sepa_debit"}(Th||(Th={})),function(e){e.AuthFailure="auth_failure"}(Nh||(Nh={}));class Mh extends pn{constructor(e){super(e===Nh.AuthFailure?"User did not authenticate":"There was an error while processing your payment. Please try again or contact us."),this.type="stripev3_error",this.subtype=e}}var xh=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};const Dh=[kh.Alipay,kh.IDEAL];class zh{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){return xh(this,void 0,void 0,(function*(){const{stripev3:t,methodId:n,gatewayId:i}=e;if(!i)throw new xn('Unable to initialize payment because "gatewayId" argument is not provided.');this.initializeOptions=t,this.isDeinitialize=!1;const r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n),{initializationData:{stripePublishableKey:o,stripeConnectedAccount:a,useIndividualCardFields:s,allowRedisplayForStoredInstruments:d}}=r;this._allowRedisplayForStoredInstruments=d;const c=this.getInitializeOptions().form;this.useIndividualCardFields=s,this.stripeV3Client=yield this.loadStripeJs(o,a),this.isCreditCard(n)&&this.shouldShowTSVHostedForm(n,i)&&c?this.hostedForm=yield this.mountCardVerificationFields(c):this.stripeElement=yield this.mountCardFields(n)}))}execute(e,t){var n,i;return xh(this,void 0,void 0,(function*(){const{payment:r}=e,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);let a,s;if(!r||!r.paymentData)throw new Cr(["payment.paymentData"]);const{paymentData:d,gatewayId:l,methodId:u}=r,{shouldSaveInstrument:h,shouldSetAsDefaultInstrument:m}=Ms(d)?d:{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1},p=(0,c.includes)(Dh,u),{isStoreCreditApplied:y}=this.paymentIntegrationService.getState().getCheckoutOrThrow();y&&(yield this.paymentIntegrationService.applyStoreCredit(y));try{p&&(yield this.paymentIntegrationService.submitOrder(o,t)),l&&(yield this.paymentIntegrationService.loadPaymentMethod(l,{params:{method:u}}));const e=this.paymentIntegrationService.getState();if(Es(d)){yield this.paymentIntegrationService.submitOrder(o,t);const{instrumentId:n}=d,i=e.getPaymentMethodOrThrow(r.methodId).clientToken;if(!i)throw new vn(yn.MissingPaymentMethod);return yield this.executeWithVaulted(r,n,m,i)}const c=e.getPaymentMethodOrThrow(u),y=yield this.confirmStripePayment(c),{clientToken:g,method:v}=c,{id:f}=null!==(i=null!==(n=y.paymentIntent)&&void 0!==n?n:y.paymentMethod)&&void 0!==i?i:{id:""};s=y.error,a={credit_card_token:{token:f},vault_payment_instrument:h,confirm:!1,set_as_default_stored_instrument:m},v===kh.CreditCard&&(a.client_token=g),p||(yield this.paymentIntegrationService.submitOrder(o,t));const b=this.buildPaymentPayload(u,a,m);yield this.paymentIntegrationService.submitPayment(b)}catch(e){yield this.processAdditionalAction(this.handleEmptyPaymentIntentError(e,s),u,h,m)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return this.hostedForm&&this.hostedForm.detach(),this.isDeinitialize=!0,this.unmountElement(),Promise.resolve()}buildPaymentPayload(e,t,n){return{methodId:e,paymentData:n?{formattedPayload:Object.assign(Object.assign({},t),{set_as_default_stored_instrument:n})}:{formattedPayload:t}}}isCancellationError(e){var t,n;return e&&-1!==(null===(n=null===(t=e.payment_intent.last_payment_error)||void 0===t?void 0:t.message)||void 0===n?void 0:n.indexOf("canceled"))}isAuthError(e){return"payment_intent_authentication_failure"===(null==e?void 0:e.code)}isCreditCard(e){return e===Th.CreditCard}isHostedFieldAvailable(){var e;const t=this.getInitializeOptions(),n=(0,c.omitBy)(null===(e=t.form)||void 0===e?void 0:e.fields,c.isEmpty);return!(0,c.isEmpty)(n)}isHostedPaymentFormEnabled(e,t){const{getPaymentMethodOrThrow:n}=this.paymentIntegrationService.getState(),i=n(e,t);return Boolean(i.config.isHostedFormEnabled)}confirmStripePayment(e){return xh(this,void 0,void 0,(function*(){const{clientToken:t,method:n,returnUrl:i}=e;if(!t)throw new vn(yn.MissingPaymentMethod);switch(n){case kh.Alipay:return this.getStripeJs().confirmAlipayPayment(t,{return_url:i},{handleActions:!1});case kh.IDEAL:{const e=this.mapStripePaymentData(Th.IDEAL,i);return this.getStripeJs().confirmIdealPayment(t,e,{handleActions:!1})}case kh.Sepa:{const e=this.mapStripePaymentData(Th.Sepa);return this.getStripeJs().confirmSepaDebitPayment(t,e)}default:{const e=this.useIndividualCardFields?this.getStripeCardElements()[0]:this.getStripeElement(),t=this.mapStripeBillingDetails(this.paymentIntegrationService.getState().getBillingAddress(),this.paymentIntegrationService.getState().getCustomer()),n=this._allowRedisplayForStoredInstruments;return this.getStripeJs().createPaymentMethod(Object.assign({type:Th.CreditCard,card:e,billing_details:t},n?{allow_redisplay:"always"}:{}))}}}))}executeWithVaulted(e,t,n,i){var r;return xh(this,void 0,void 0,(function*(){const o={bigpay_token:{token:t},confirm:!0,client_token:i,set_as_default_stored_instrument:n};if(this.isHostedPaymentFormEnabled(e.methodId,e.gatewayId)&&this.hostedForm){const t=this.hostedForm;return e.paymentData&&Es(e.paymentData)&&(e.paymentData=Object.assign(Object.assign({},e.paymentData),{instrumentId:JSON.stringify({token:(null===(r=e.paymentData)||void 0===r?void 0:r.instrumentId)||"",client_token:i})})),yield t.validate(),yield t.submit(e),this.paymentIntegrationService.loadCurrentOrder()}const a=this.buildPaymentPayload(e.methodId,o,n);return this.paymentIntegrationService.submitPayment(a)}))}getInitializeOptions(){if(!this.initializeOptions)throw new Sn(gn.PaymentNotInitialized);return this.initializeOptions}getStripeCardElements(){if(!this.stripeCardElements)throw new Sn(gn.PaymentNotInitialized);return this.stripeCardElements}getStripeElement(){if(!this.stripeElement)throw new Sn(gn.PaymentNotInitialized);return this.stripeElement}getStripeJs(){if(!this.stripeV3Client)throw new Sn(gn.PaymentNotInitialized);return this.stripeV3Client}handleEmptyPaymentIntentError(e,t){return Io(e)&&(0,c.some)(e.body.errors,{code:"required_field"})&&t?new Error(t.message):e}loadStripeJs(e,t){return xh(this,void 0,void 0,(function*(){return this.stripeV3Client?Promise.resolve(this.stripeV3Client):this.scriptLoader.load(e,t,this.paymentIntegrationService.getState().getLocale())}))}mapStripeAddress(e){if(e){const{city:t,countryCode:n,address1:i,address2:r,postalCode:o,stateOrProvinceCode:a}=e;return{city:t,country:n,line1:i,line2:r,postal_code:o,state:a}}return{line1:""}}mapStripeBillingDetails(e,t){const{firstName:n,lastName:i}=e||t||{firstName:"Guest",lastName:""},r=`${n} ${i}`.trim(),{options:o}=this.getInitializeOptions();if(this.useIndividualCardFields&&Oh(o)){const{zipCodeElementOptions:t}=o;if(t){const n=document.getElementById(t.containerId)?document.getElementById(t.containerId).value:"";n&&e&&(e=Object.assign(Object.assign({},e),{postalCode:n}))}}const a={address:this.mapStripeAddress(e)};if(t&&t.addresses[0]&&function(e){return"object"==typeof e&&null!==e&&"id"in e&&void 0!==e.id}(t.addresses[0])){const e=t.addresses[0],{email:n}=t,{phone:i}=e;return i?Object.assign(Object.assign({},a),{email:n,name:r,phone:i}):Object.assign(Object.assign({},a),{email:n,name:r})}if(e){const{email:t,phone:n}=e;return n?Object.assign(Object.assign({},a),{email:t,name:r,phone:n}):Object.assign(Object.assign({},a),{email:t,name:r})}return Object.assign(Object.assign({},a),{name:r})}mapStripePaymentData(e,t){const n=this.paymentIntegrationService.getState().getCustomer(),i=this.paymentIntegrationService.getState().getBillingAddress(),r={payment_method:{[e]:this.getStripeElement(),billing_details:this.mapStripeBillingDetails(i,n)}};return e===Th.IDEAL?Object.assign(Object.assign({},r),{return_url:t}):r}mountCardFields(e){const{options:t,containerId:n}=this.getInitializeOptions();let i;return new Promise(((r,o)=>{switch(this.stripeElements||(this.stripeElements=this.getStripeJs().elements()),e){case kh.CreditCard:if(this.useIndividualCardFields&&Oh(t)){const{cardNumberElementOptions:e,cardExpiryElementOptions:n,cardCvcElementOptions:r}=t,a=this.stripeElements.getElement(kh.CardNumber)||this.stripeElements.create(kh.CardNumber,e),s=this.stripeElements.getElement(kh.CardExpiry)||this.stripeElements.create(kh.CardExpiry,n),d=this.stripeElements.getElement(kh.CardCvc)||this.stripeElements.create(kh.CardCvc,r);this.stripeCardElements=[a,s,d],i=this.stripeCardElements[0];try{a.mount(`#${e.containerId}`),s.mount(`#${n.containerId}`),d.mount(`#${r.containerId}`)}catch(e){this.isDeinitialize||o(new xn("Unable to mount Stripe component without valid container ID."))}}else{i=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{i.mount(`#${n}`)}catch(e){this.isDeinitialize||o(new xn("Unable to mount Stripe component without valid container ID."))}}break;case kh.IDEAL:case kh.Sepa:i=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{i.mount(`#${n}`)}catch(e){this.isDeinitialize||o(new xn("Unable to mount Stripe component without valid container ID."))}case kh.Alipay:}r(i)}))}mountCardVerificationFields(e){return xh(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getStoreConfig();if(!t)throw new vn(yn.MissingCheckoutConfig);const n=t.paymentSettings.bigpayBaseUrl,i=this.paymentIntegrationService.createHostedForm(n,e);return yield i.attach(),i}))}processAdditionalAction(e,t,n=!1,i=!1){return xh(this,void 0,void 0,(function*(){if(!Io(e))throw e;const r=(0,c.some)(e.body.errors,{code:"additional_action_required"}),o=(0,c.some)(e.body.errors,{code:"three_d_secure_required"});if(r){const t=e.body.additional_action_required;if(t&&"redirect_to_url"===t.type)return new Promise((()=>{t.data.redirect_url&&window.location.replace(t.data.redirect_url)}))}if(o){const r=e.body.three_ds_result.token,o=!1;let a,s=!1;try{a=yield this.getStripeJs().confirmCardPayment(r)}catch(e){s=!0}if(null==a?void 0:a.error){if(this.isCancellationError(a.error))throw new ai;if(this.isAuthError(a.error))throw new Mh(Nh.AuthFailure);throw new Error(a.error.message)}const d={credit_card_token:{token:this.getPaymentToken(null==a?void 0:a.paymentIntent,r,s)},vault_payment_instrument:n,confirm:o},c=this.buildPaymentPayload(t,d,i);try{return yield this.paymentIntegrationService.submitPayment(c)}catch(e){throw this.handleEmptyPaymentIntentError(e,null==a?void 0:a.error)}}throw e}))}getPaymentToken(e,t,n){return!e||n?t:e.id}shouldShowTSVHostedForm(e,t){return this.isHostedFieldAvailable()&&this.isHostedPaymentFormEnabled(e,t)}unmountElement(){this.stripeElement&&(this.stripeElement.unmount(),this.stripeElement=void 0)}}class Fh{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}load(e,t,n){return this.scriptLoader.loadScript("https://js.stripe.com/v3/").then((()=>{if(!this.stripeWindow.Stripe)throw new Tn;return this.stripeWindow.Stripe(e,{stripeAccount:t,locale:n,betas:["payment_intent_beta_3","alipay_pm_beta_1"],apiVersion:"2020-03-02;alipay_beta=v1"})}))}}const Bh=Ge((e=>new zh(e,new Fh((0,s.vQ)()))),[{gateway:"stripev3"}]),Rh={ar:["ar"],bg:["bg"],cs:["cs"],da:["da"],de:["de"],el:["el"],en:["en","en-GB"],es:["es","es-419"],et:["et"],fi:["fi"],fil:["fil"],fr:["fr","fr-CA"],he:["he"],hr:["hr"],hu:["hu"],id:["id"],it:["it"],ja:["ja"],ko:["ko"],lt:["lt"],lv:["lv"],ms:["ms"],mt:["mt"],nb:["nb"],nl:["nl"],pl:["pl"],pt:["pt","pt-BR"],ro:["ro"],ru:["ru"],sk:["sk"],sl:["sl"],sv:["sv"],th:["th"],tr:["tr"],vi:["vi"],zh:["zh","zh-HK","zh-TW"]};function Lh(e){const[t,n]=e.replace(/_/g,"-").toLowerCase().split("-"),i=Rh[t];if(!i)return"auto";const r=n?`${t}-${n.toUpperCase()}`:t;return i.indexOf(r)>-1?r:i[0]}var jh=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Uh{constructor(e,t,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=n}initialize(e){return jh(this,void 0,void 0,(function*(){const{stripeupe:t,methodId:n,gatewayId:i}=e;if(!(null==t?void 0:t.containerId))throw new Sn(gn.PaymentNotInitialized);if(!i)throw new xn('Unable to initialize payment because "gatewayId" argument is not provided.');return this._loadStripeElement(t,i,n).catch((e=>{var n;return null===(n=t.onError)||void 0===n?void 0:n.call(t,e)})),this.stripeIntegrationService.initCheckoutEventsSubscription(i,n,t,this._stripeElements),Promise.resolve()}))}execute(e,t){return jh(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n||!n.paymentData)throw new Cr(["payment.paymentData"]);if(!this._stripeUPEClient)throw new Sn(gn.PaymentNotInitialized);const{paymentData:r,methodId:o,gatewayId:a}=n,{shouldSaveInstrument:s=!1,shouldSetAsDefaultInstrument:d=!1}=Ms(r)?r:{},c=this.paymentIntegrationService.getState(),{isStoreCreditApplied:l}=c.getCheckoutOrThrow(),u=c.getPaymentProviderCustomerOrThrow(),h=(ts(u)?u:{}).stripeLinkAuthenticationState;if(l&&(yield this.paymentIntegrationService.applyStoreCredit(l)),a){yield this.stripeIntegrationService.updateStripePaymentIntent(a,o);const{email:e}=c.getCustomerOrThrow();if(void 0!==h&&!e){const e=c.getBillingAddressOrThrow();yield this.paymentIntegrationService.updateBillingAddress(e)}}if(yield this.paymentIntegrationService.submitOrder(i,t),Es(r)){const{instrumentId:e}=r;yield this._executeWithVaulted(n.methodId,e,d)}else yield this._executeWithStripeConfirmation(n.methodId,!h&&s,d)}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(Ya.PAYMENT))||void 0===t||t.unmount(),this.stripeIntegrationService.deinitialize(),this._stripeElements=void 0,this._stripeUPEClient=void 0,Promise.resolve()}_executeWithStripeConfirmation(e,t,n){return jh(this,void 0,void 0,(function*(){const i=this.paymentIntegrationService.getState(),{clientToken:r}=i.getPaymentMethodOrThrow(e),o=this._getPaymentPayload(e,r||"",t,n);try{yield this.paymentIntegrationService.submitPayment(o)}catch(i){yield this._processAdditionalActionWithStripeConfirmation(i,e,t,n)}}))}_executeWithVaulted(e,t,n){var i;return jh(this,void 0,void 0,(function*(){const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(e),a=null===(i=r.getCart())||void 0===i?void 0:i.id;try{const i={methodId:e,paymentData:{formattedPayload:{cart_id:a,bigpay_token:{token:t},confirm:!1,client_token:o.clientToken,set_as_default_stored_instrument:n}}};return yield this.paymentIntegrationService.submitPayment(i)}catch(t){return this._processVaultedAdditionalAction(t,e,n)}}))}_loadStripeElement(e,t,n){return jh(this,void 0,void 0,(function*(){const{containerId:i,style:r,render:o,initStripeElementUpdateTrigger:a}=e,s=yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:n}}),d=s.getPaymentMethodOrThrow(n),{checkoutSettings:c}=s.getStoreConfigOrThrow();if(!es(d))throw new vn(yn.MissingPaymentMethod);const{clientToken:l,initializationData:u}=d,{shopperLanguage:h,allowRedisplayForStoredInstruments:m=!1}=u;if(this._allowRedisplayForStoredInstruments=m,!l)throw new vn(yn.MissingPaymentMethod);let p;if(this._stripeUPEClient=yield this._loadStripeJs(u),this._isStripeElementUpdateEnabled=!!c.features["PI-1679.trigger_update_stripe_payment_element"]&&"function"==typeof a,r){const e=r;p={variables:this.stripeIntegrationService.mapAppearanceVariables(r),rules:{".Input":this.stripeIntegrationService.mapInputAppearanceRules(e)}}}this._stripeElements=yield this.scriptLoader.getElements(this._stripeUPEClient,{clientSecret:l,locale:Lh(h),appearance:p});const{getBillingAddress:y,getShippingAddress:g}=s,{postalCode:v}=g()||y()||{},f=this._stripeElements.getElement(Ya.PAYMENT)||this._stripeElements.create(Ya.PAYMENT,Object.assign({fields:{billingDetails:{email:Wa.NEVER,address:{country:Wa.NEVER,city:Wa.NEVER,postalCode:v?Wa.NEVER:Wa.AUTO}}},wallets:{applePay:Wa.NEVER,googlePay:Wa.NEVER}},this._getStripeElementTerms()));this.stripeIntegrationService.mountElement(f,i),f.on(Qa.READY,(()=>{o()})),f.on(Qa.CHANGE,(e=>{(null==e?void 0:e.value)&&"type"in e.value&&this._updateStripeLinkStateByElementType(e.value.type)})),this._isStripeElementUpdateEnabled&&(null==a||a(this._updateStripeElement.bind(this)))}))}_processAdditionalActionWithStripeConfirmation(e,t,n=!1,i=!1){return jh(this,void 0,void 0,(function*(){if(!Io(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new Sn(gn.PaymentNotInitialized);const{data:r}=e.body.additional_action_required,{token:o}=r,{paymentIntent:a}=yield this._confirmStripePaymentOrThrow(t,r),s=this._getPaymentPayload(t,(null==a?void 0:a.id)||o,n,i);try{yield this.paymentIntegrationService.submitPayment(s)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}}))}_confirmStripePaymentOrThrow(e,t){var n,i;return jh(this,void 0,void 0,(function*(){const{token:r,redirect_url:o}=t,a=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,o,!!this._allowRedisplayForStoredInstruments);let s;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this._stripeUPEClient))?yield null===(i=this._stripeUPEClient)||void 0===i?void 0:i.retrievePaymentIntent(r||""):yield null===(n=this._stripeUPEClient)||void 0===n?void 0:n.confirmPayment(a);if(s=null==t?void 0:t.error,s||!(null==t?void 0:t.paymentIntent))throw new ur;return t}catch(e){this.stripeIntegrationService.throwStripeError(s)}}))}_processVaultedAdditionalAction(e,t,n=!1){var i;return jh(this,void 0,void 0,(function*(){if(!t||!Io(e)||!(0,c.some)(e.body.errors,{code:"three_d_secure_required"}))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new Sn(gn.PaymentNotInitialized);const r=e.body.three_ds_result.token;let o,a=!1;try{o=yield this._stripeUPEClient.confirmCardPayment(r)}catch(e){try{o=yield this._stripeUPEClient.retrievePaymentIntent(r)}catch(e){a=!0}}if((null==o?void 0:o.error)&&this.stripeIntegrationService.throwStripeError(o.error),!(null==o?void 0:o.paymentIntent)&&!a)throw new gi;const s=this._getPaymentPayload(t,a?r:null===(i=null==o?void 0:o.paymentIntent)||void 0===i?void 0:i.id,!1,n);return this.paymentIntegrationService.submitPayment(s)}))}_loadStripeJs(e){return jh(this,void 0,void 0,(function*(){return this._stripeUPEClient?this._stripeUPEClient:this.scriptLoader.getStripeClient(e,ns,is)}))}_getPaymentPayload(e,t,n=!1,i=!1){var r;return{methodId:e,paymentData:{formattedPayload:{cart_id:(null===(r=this.paymentIntegrationService.getState().getCart())||void 0===r?void 0:r.id)||"",credit_card_token:{token:t},confirm:!1,vault_payment_instrument:n,set_as_default_stored_instrument:i}}}}_updateStripeElement({shouldShowTerms:e}){var t;const n=null===(t=this._stripeElements)||void 0===t?void 0:t.getElement(Ya.PAYMENT);null==n||n.update(Object.assign({},this._getStripeElementTerms(e)))}_getStripeElementTerms(e){let t=Wa.AUTO;return this._isStripeElementUpdateEnabled&&(t=e?Wa.AUTO:Wa.NEVER),{terms:{card:t}}}_updateStripeLinkStateByElementType(e){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomerOrThrow(),n=e===$a.Link;!ts(t)&&n&&this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:n})}}const Vh=Ge((e=>{const t=new Xa((0,s.vQ)());return new Uh(e,t,new us(e,t))}),[{gateway:"stripeupe"},{gateway:"stripeupe",id:"klarna"}]);var qh=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Hh{constructor(e,t,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=n}initialize(e){var t;return qh(this,void 0,void 0,(function*(){const{stripeocs:n,methodId:i,gatewayId:r}=e;if(!(null==n?void 0:n.containerId))throw new Sn(gn.PaymentNotInitialized);if(!r)throw new xn('Unable to initialize payment because "gatewayId" argument is not provided.');try{yield this._initializeStripeElement(n,r,i)}catch(e){e instanceof Error&&(null===(t=n.onError)||void 0===t||t.call(n,e))}this.stripeIntegrationService.initCheckoutEventsSubscription(r,i,n,this.stripeElements)}))}execute(e,t){return qh(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{methodId:r,gatewayId:o}=n||{};if(!this.stripeClient)throw new Sn(gn.PaymentNotInitialized);if(!o||!r)throw new xn('Unable to initialize payment because "gatewayId" or "methodId" argument is not provided.');const a=this.paymentIntegrationService.getState(),{isStoreCreditApplied:s}=a.getCheckoutOrThrow();s&&(yield this.paymentIntegrationService.applyStoreCredit(s)),yield this.stripeIntegrationService.updateStripePaymentIntent(o,r),yield this.paymentIntegrationService.submitOrder(i,t);const{clientToken:d}=a.getPaymentMethodOrThrow(r),c=this._getPaymentPayload(r,d||"");try{yield this.paymentIntegrationService.submitPayment(c)}catch(e){yield this._processAdditionalAction(e,r)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(Ya.PAYMENT);return null==t||t.unmount(),null==t||t.destroy(),this.stripeIntegrationService.deinitialize(),this.stripeElements=void 0,this.stripeClient=void 0,Promise.resolve()}_initializeStripeElement(e,t,n){return qh(this,void 0,void 0,(function*(){let i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(n);if((null==i?void 0:i.clientToken)||(i=(yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:n}})).getPaymentMethodOrThrow(n)),!es(i))throw new vn(yn.MissingPaymentMethod);const{clientToken:r,initializationData:o}=i,{shopperLanguage:a,customerSessionToken:s,enableLink:d}=o;if(!r)throw new vn(yn.MissingPaymentMethod);this.stripeClient=yield this._loadStripeJs(o);const{appearance:c,containerId:l,fonts:u,layout:h,render:m,paymentMethodSelect:p,handleClosePaymentMethod:y,togglePreloader:g}=e;this.stripeElements=yield this.scriptLoader.getElements(this.stripeClient,{clientSecret:r,customerSessionClientSecret:s,locale:Lh(a),appearance:c,fonts:u});const{getBillingAddress:v,getShippingAddress:f}=this.paymentIntegrationService.getState(),b=v(),{postalCode:S}=f()||b||{},C=this.stripeElements.getElement(Ya.PAYMENT)||this.stripeElements.create(Ya.PAYMENT,{fields:{billingDetails:{email:Wa.NEVER,address:{country:Wa.NEVER,city:Wa.NEVER,postalCode:S?Wa.NEVER:Wa.AUTO}}},wallets:{applePay:Wa.NEVER,googlePay:Wa.NEVER,link:d?Wa.AUTO:Wa.NEVER},layout:h,savePaymentMethod:{maxVisiblePaymentMethods:20},defaultValues:{billingDetails:{email:(null==b?void 0:b.email)||""}}});this.stripeIntegrationService.mountElement(C,l),C.on(Qa.LOADER_START,(()=>{null==g||g(!1)})),C.on(Qa.READY,(()=>{m()})),C.on(Qa.CHANGE,(e=>{this._onStripeElementChange(e,t,n,p)})),null==y||y(this._collapseStripeElement.bind(this))}))}_loadStripeJs(e){return qh(this,void 0,void 0,(function*(){return this.stripeClient?this.stripeClient:this.scriptLoader.getStripeClient(e)}))}_collapseStripeElement(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(Ya.PAYMENT);null==t||t.collapse()}_getPaymentPayload(e,t,n){var i;const r=(null===(i=this.paymentIntegrationService.getState().getCart())||void 0===i?void 0:i.id)||"",{card:o,us_bank_account:a}=n||{},s=this._shouldSaveInstrument(o)||this._shouldSaveInstrument(a),d=this._getTokenizedOptions(t,n);return{methodId:e,paymentData:{formattedPayload:Object.assign({cart_id:r,confirm:!1,method:this.selectedMethodId,vault_payment_instrument:s},d)}}}_processAdditionalAction(e,t){return qh(this,void 0,void 0,(function*(){if(!Io(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this.stripeClient||!this.stripeElements)throw new Sn(gn.PaymentNotInitialized);const{data:n}=e.body.additional_action_required,{token:i}=n,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(t,n),{client_secret:o,payment_method_options:a}=r||{},s=this._getPaymentPayload(t,o||i,a);try{return yield this.paymentIntegrationService.submitPayment(s)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}}))}_confirmStripePaymentOrThrow(e,t){var n,i;return qh(this,void 0,void 0,(function*(){const{token:r,redirect_url:o}=t,a=this.stripeIntegrationService.mapStripePaymentData(this.stripeElements,o);let s;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this.stripeClient))?yield null===(i=this.stripeClient)||void 0===i?void 0:i.retrievePaymentIntent(r||""):yield null===(n=this.stripeClient)||void 0===n?void 0:n.confirmPayment(a);if(s=null==t?void 0:t.error,s||!(null==t?void 0:t.paymentIntent))throw new ur;return t}catch(e){return this.stripeIntegrationService.throwStripeError(s)}}))}_onStripeElementChange(e,t,n,i){(e=>"object"==typeof e&&null!==e&&"value"in e&&"collapsed"in e)(e)&&!e.collapsed&&(this.selectedMethodId=e.value.type,null==i||i(`${t}-${n}`))}_shouldSaveInstrument(e){const t=null==e?void 0:e.setup_future_usage;return t===Ja.ON_SESSION||t===Ja.OFF_SESSION}_getTokenizedOptions(e,t){return this._shouldSaveInstrument(null==t?void 0:t.us_bank_account)?{tokenized_ach:{token:e}}:{credit_card_token:{token:e}}}}const Gh=Ge((e=>{const t=new Xa((0,s.vQ)());return new Hh(e,t,new us(e,t))}),[{gateway:"stripeocs",id:"optimized_checkout"}]);var $h;!function(e){e.CARD_NUMBER="card-number",e.CVV="cvv",e.EXPIRY="expiry"}($h||($h={}));var Wh=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Yh{constructor(e,t,n){this.paymentIntegrationService=e,this.tdOnlineMartScriptLoader=t,this.formPoster=n,this.tdInputs=[{id:"ccNumber",fieldType:$h.CARD_NUMBER},{id:"ccCvv",fieldType:$h.CVV},{id:"ccExpiry",fieldType:$h.EXPIRY}]}initialize(e){return Wh(this,void 0,void 0,(function*(){const{methodId:t}=e;if(!t)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');this.tdOnlineMartClient=yield this.loadTDOnlineMartJs(),this.mountHostedFields(t)}))}execute(e,t){return Wh(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);if(!n.methodId)throw new vn(yn.MissingPaymentMethod);const r=yield this.getPaymentPayloadOrThrow(n);yield this.paymentIntegrationService.submitOrder(i,t);try{yield this.paymentIntegrationService.submitPayment(r)}catch(e){yield this.processWithAdditionalAction(e)}}))}finalize(){return Promise.reject(new Os)}deinitialize(){return this.tdOnlineMartClient=void 0,this.tdInputs.forEach((({inputElement:e})=>{null==e||e.unmount()})),Promise.resolve()}getPaymentPayloadOrThrow(e){return Wh(this,void 0,void 0,(function*(){const{methodId:t,paymentData:n}=e,{shouldSaveInstrument:i=!1,shouldSetAsDefaultInstrument:r=!1}=Ms(n)?n:{},o={browser_info:ta(),shouldSaveInstrument:i,shouldSetAsDefaultInstrument:r};if(Ms(n)&&Es(n)&&n.instrumentId){const e=!!this.paymentIntegrationService.getState().getCartOrThrow().lineItems.digitalItems.length,i=!this.isTrustedVaultingInstrument(n.instrumentId)||e;return{methodId:t,paymentData:Object.assign(Object.assign(Object.assign({},o),{instrumentId:n.instrumentId}),i?{nonce:n.instrumentId}:{})}}let a;try{a=yield this.getTokenOrThrow()}catch(e){this.throwTokenizationError(e)}return{methodId:t,paymentData:Object.assign(Object.assign({},o),{nonce:a})}}))}mountHostedFields(e){const t=this.getHostedFieldsOptions(),n=this.getTDOnlineMartClientOrThrow();this.tdInputs.forEach((i=>{const r=`${e}-${i.id}`;document.getElementById(r)&&(i.inputElement=n.create(i.fieldType,t),i.inputElement.mount(`#${r}`))}))}loadTDOnlineMartJs(){return Wh(this,void 0,void 0,(function*(){return this.tdOnlineMartClient?this.tdOnlineMartClient:this.tdOnlineMartScriptLoader.load()}))}getTokenOrThrow(){return new Promise(((e,t)=>{this.getTDOnlineMartClientOrThrow().createToken((n=>{const{error:i,token:r}=n;if(i||!r)return t(i);e(r)}))}))}getTDOnlineMartClientOrThrow(){if(!this.tdOnlineMartClient)throw new Sn(gn.PaymentNotInitialized);return this.tdOnlineMartClient}processWithAdditionalAction(e){return Wh(this,void 0,void 0,(function*(){if(!function(e){return Io(e)&&(t=e.body,(0,c.isObject)(t)&&"object"==typeof t&&"errors"in t&&"three_ds_result"in t&&(0,c.isArray)(t.errors)&&(0,c.some)(t.errors,{code:"three_d_secure_required"}));var t}(e))throw e;const{three_ds_result:t}=e.body,{acs_url:n,payer_auth_request:i,merchant_data:r}=t||{};if(!n||!i||!r)throw new Cr(["formUrl","threeDSSessionData","creq"]);return new Promise((e=>{this.formPoster.postForm(n,{threeDSSessionData:i,creq:r},e,"_top")}))}))}throwTokenizationError(e){if(!function(e){return"object"==typeof e&&null!==e&&"field"in e&&"type"in e&&"message"in e}(e))throw new vn(yn.MissingPaymentToken);throw new Error(e.message)}getHostedFieldsOptions(){return{style:{error:{color:"#d14343"}},classes:{error:"form-input--error"}}}isTrustedVaultingInstrument(e){const t=this.paymentIntegrationService.getState().getInstruments(),n=null==t?void 0:t.find((t=>nd(t)&&t.bigpayToken===e));return!(nd(n)&&!n.trustedShippingAddress)}}class Kh{constructor(e,t=window){this.scriptLoader=e,this.tdOnlineMartWindow=t}load(){return e=this,n=function*(){if(this.tdOnlineMartWindow.customcheckout||(yield this.scriptLoader.loadScript("https://libs.na.bambora.com/customcheckout/1/customcheckout.js")),!this.tdOnlineMartWindow.customcheckout)throw new Tn;return this.tdOnlineMartWindow.customcheckout()},new((t=void 0)||(t=Promise))((function(i,r){function o(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,a)}s((n=n.apply(e,[])).next())}));var e,t,n}}const Qh=Ge((e=>new Yh(e,new Kh((0,s.vQ)()),(0,N.createFormPoster)())),[{id:"tdonlinemart"}]);var Jh=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};const Zh="Payment cannot continue";let Xh;class em extends $c{initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return Jh(this,void 0,void 0,(function*(){if(this._initializeOptions=e&&e.worldpay,!this._initializeOptions)throw new Sn(gn.PaymentNotInitialized);return t.initialize.call(this,e)}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return Jh(this,void 0,void 0,(function*(){const{payment:i}=e;if(Xh=this._submitAdditionalAction(),!i)throw new Cr(["payment"]);try{return yield n.execute.call(this,e,t)}catch(e){return this._processAdditionalAction(e,i)}}))}_processAdditionalAction(e,t){return Jh(this,void 0,void 0,(function*(){return Io(e)&&(0,c.some)(e.body.errors,{code:"additional_action_required"})?new Promise(((n,i)=>{const r=e=>Jh(this,void 0,void 0,(function*(){if("string"!=typeof e.data||!this._isValidJsonWithSessionId(e.data))return i(new Error(Zh));window.removeEventListener("message",r),o.remove();const a=JSON.parse(e.data),s=(0,c.merge)({},t,{paymentData:{threeDSecure:{token:a.SessionId}}});try{n(yield Xh(s))}catch(e){if(!Io(e)||!(0,c.some)(e.body.errors,{code:"three_d_secure_required"}))return i(e);if(!this._initializeOptions)return i(new Sn(gn.PaymentNotInitialized));const{onLoad:t}=this._initializeOptions,n=this._createIframe(e.body.three_ds_result);try{t(n,(()=>i(new Error("Payment was cancelled"))))}catch(e){i(new Error(Zh))}}}));let o;window.addEventListener("message",r);try{o=this._createHiddenIframe(e.body)}catch(e){throw window.removeEventListener("message",r),new Error(Zh)}})):Promise.reject(e)}))}_createHiddenIframe(e){const t=document.createElement("iframe");if(document.body.appendChild(t),!t.contentWindow)throw new Error;t.id="worldpay_hosted_hidden_payment_page",t.height="0px",t.width="0px";const n=document.createElement("form"),i="collectionForm";n.id=i,n.name="devicedata",n.method="post";const r=e.additional_action_required.data.redirect_url;n.action=r;const o=document.createElement("input");o.name="Bin",o.type="hidden",o.value=e.provider_data.source_id,n.appendChild(o);const a=document.createElement("input");a.name="JWT",a.type="hidden",a.value=e.provider_data.data,n.appendChild(a);const s=document.createElement("button");s.type="submit",s.id="btnsubmit",n.appendChild(s),navigator.userAgent.match("Firefox")?t.srcdoc=n.outerHTML:t.contentWindow.document.body.appendChild(n);const d=document.createElement("script");return d.innerHTML=`\n            document.getElementById('${i}').submit();\n        `,t.contentWindow.document.body.appendChild(d),t}_createIframe(e){const t=document.createElement("form");t.id="challengeForm",t.method="POST",t.action=e.acs_url;const n=document.createElement("input");n.name="JWT",n.type="hidden",n.value=e.payer_auth_request,t.appendChild(n);const i=document.createElement("input");i.name="MD",i.type="hidden",i.value=`merchantSessionId=${e.merchant_data}`,t.appendChild(i);const r=document.createElement("script");r.type="text/javascript",r.innerHTML="window.onload = function() { document.getElementById('challengeForm').submit(); }";const o=document.createElement("iframe");return o.name="worldpay_hosted_payment_page",o.height="400",o.width="100%",o.srcdoc=`${t.outerHTML} ${r.outerHTML}`,o}_submitAdditionalAction(){if(this._shouldRenderHostedForm){if(!this._hostedForm)throw new Sn(gn.PaymentNotInitialized);const e=this._hostedForm;return t=>Jh(this,void 0,void 0,(function*(){yield e.submit(t)}))}return e=>Jh(this,void 0,void 0,(function*(){yield this._paymentIntegrationService.submitPayment(e)}))}_isValidJsonWithSessionId(e){try{return!!JSON.parse(e).SessionId}catch(e){return!1}}}const tm=Ge((e=>new em(e)),[{id:"worldpayaccess"}]);class nm{constructor(e){this._requestSender=e}saveExternalId(e,t){return n=this,r=function*(){const n=`/api/storefront/payment/${e}/save-external-id`,i={headers:Object.assign({Accept:Ai.JsonV1,"X-API-INTERNAL":Ei},ki),body:{externalId:t,provider:e}};yield this._requestSender.post(n,i)},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}}class im{constructor(e,t){this.paymentIntegrationService=e,this.storefrontPaymentRequestSender=t}initialize(){return Promise.resolve()}execute(e,t){return n=this,r=function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new Cr(["payment"]);const{methodId:r}=n,{getPaymentMethodOrThrow:o}=yield this.paymentIntegrationService.loadPaymentMethod(r,t),{clientToken:a,initializationData:s}=o(r),d=null==s?void 0:s.redirectUrl;if(!a||!d)throw new vn(yn.MissingPaymentMethod);const{id:c}=JSON.parse(a);if(!c)throw new vn(yn.MissingPaymentToken);const{isStoreCreditApplied:l}=this.paymentIntegrationService.getState().getCheckoutOrThrow();yield this.paymentIntegrationService.applyStoreCredit(l),yield this.paymentIntegrationService.initializePayment(r,{useStoreCredit:l}),yield this.paymentIntegrationService.submitOrder(i,t),yield this._prepareForReferredRegistration(r,c);try{yield this.paymentIntegrationService.submitPayment({methodId:r,paymentData:{nonce:c}})}catch(e){if(Io(e)&&"additional_action_required"===e.body.status)return new Promise((()=>window.location.replace(d)));throw e}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}finalize(){return Promise.reject(new Os)}deinitialize(){return Promise.resolve()}_prepareForReferredRegistration(e,t){return this.storefrontPaymentRequestSender.saveExternalId(e,t)}}const rm=Ge((e=>{const{getHost:t}=e.getState(),n=(0,a.createRequestSender)({host:t()}),i=new nm(n);return new im(e,i)}),[{id:"zip"},{id:"quadpay"}]);var om,am,sm,dm;!function(e){e.LoadCountriesRequested="LOAD_COUNTRIES_REQUESTED",e.LoadCountriesSucceeded="LOAD_COUNTRIES_SUCCEEDED",e.LoadCountriesFailed="LOAD_COUNTRIES_FAILED"}(om||(om={}));class cm{constructor(e){this._countryRequestSender=e}loadCountries(e){return l.c.create((t=>{t.next((0,d.VP)(om.LoadCountriesRequested)),this._countryRequestSender.loadCountries(e).then((e=>{t.next((0,d.VP)(om.LoadCountriesSucceeded,e.body.data)),t.complete()})).catch((e=>{t.error((0,d.fQ)(om.LoadCountriesFailed,e))}))}))}}class lm{constructor(e,t){this._requestSender=e,this._config=t}loadCountries({timeout:e}={}){const t=Object.assign({"Accept-Language":this._config.locale},se);return this._requestSender.get("/internalapi/v1/store/countries",{headers:t,timeout:e})}}class um extends te{constructor(e){super(e||"Your checkout could not be processed because some details have changed. Please review your order and try again."),this.name="CartConsistencyError",this.type="cart_consistency"}}class hm extends te{constructor(e){super(e||"The tax provider is unavailable."),this.name="OrderTaxProviderUnavailableError",this.type="tax_provider_unavailable"}}class mm extends te{constructor(e){super(e),this.name="MissingShippingMethodError",this.type="missing_shipping_method"}}class pm extends te{constructor(e){super(e),this.name="InvalidShippingAddressError",this.type="invalid_shipping_address"}}class ym{constructor(e){this._requestSender=e}loadOrder(e,{timeout:t}={}){const n=`/api/storefront/orders/${e}`,i=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.get(n,{params:{include:je(["payments","lineItems.physicalItems.socialMedia","lineItems.physicalItems.options","lineItems.physicalItems.categories","lineItems.digitalItems.socialMedia","lineItems.digitalItems.options","lineItems.digitalItems.categories"])},headers:i,timeout:t})}submitOrder(e,{headers:t,timeout:n}={}){return this._requestSender.post("/internalapi/v1/checkout/order",{body:e,headers:(0,c.omitBy)(Object.assign({"X-Checkout-Variant":t&&t.checkoutVariant},se),c.isNil),timeout:n}).catch((e=>{if("tax_provider_unavailable"===e.body.type)throw new hm;if("cart_has_changed"===e.body.type)throw new um;if("missing_shipping_method"===e.body.type)throw new mm(e.body.detail);if("invalid_shipping_address"===e.body.type)throw new pm(e.body.detail);if("empty_cart"===e.body.type)throw new oe;throw e}))}finalizeOrder(e,{timeout:t}={}){const n=`/internalapi/v1/checkout/order/${e}`;return this._requestSender.post(n,{timeout:t,headers:se})}}class gm extends te{constructor(){super("You haven't complete our spam check. Please try again."),this.name="SpamProtectionNotCompletedError",this.type="spam_protection_not_completed"}}!function(e){e.LoadOrderRequested="LOAD_ORDER_REQUESTED",e.LoadOrderSucceeded="LOAD_ORDER_SUCCEEDED",e.LoadOrderFailed="LOAD_ORDER_FAILED",e.LoadOrderPaymentsRequested="LOAD_ORDER_PAYMENTS_REQUESTED",e.LoadOrderPaymentsSucceeded="LOAD_ORDER_PAYMENTS_SUCCEEDED",e.LoadOrderPaymentsFailed="LOAD_ORDER_PAYMENTS_FAILED",e.SubmitOrderRequested="SUBMIT_ORDER_REQUESTED",e.SubmitOrderSucceeded="SUBMIT_ORDER_SUCCEEDED",e.SubmitOrderFailed="SUBMIT_ORDER_FAILED",e.FinalizeOrderRequested="FINALIZE_ORDER_REQUESTED",e.FinalizeOrderSucceeded="FINALIZE_ORDER_SUCCEEDED",e.FinalizeOrderFailed="FINALIZE_ORDER_FAILED"}(am||(am={}));class vm{constructor(e,t){this._orderRequestSender=e,this._checkoutValidator=t}loadOrder(e,t){return new l.c((n=>{n.next((0,d.VP)(am.LoadOrderRequested)),this._orderRequestSender.loadOrder(e,t).then((e=>{n.next((0,d.VP)(am.LoadOrderSucceeded,e.body)),n.complete()})).catch((e=>{n.error((0,d.fQ)(am.LoadOrderFailed,e))}))}))}loadOrderPayments(e,t){return new l.c((n=>{n.next((0,d.VP)(am.LoadOrderPaymentsRequested)),this._orderRequestSender.loadOrder(e,t).then((e=>{n.next((0,d.VP)(am.LoadOrderPaymentsSucceeded,e.body)),n.complete()})).catch((e=>{n.error((0,d.fQ)(am.LoadOrderPaymentsFailed,e))}))}))}loadCurrentOrder(e){return t=>(0,p.v)((()=>{const n=this._getCurrentOrderId(t.getState());if(!n)throw new ne(K.MissingOrderId);return this.loadOrder(n,e)}))}submitOrder(e,t){return n=>(0,m.x)((0,b.of)((0,d.VP)(am.SubmitOrderRequested)),(0,p.v)((()=>{const i=n.getState(),r=i.config.getExternalSource(),o=i.config.getVariantIdentificationToken(),a=i.checkout.getCheckout();if(!a)throw new ne(K.MissingCheckout);if(a.shouldExecuteSpamCheck)throw new gm;return(0,g.H)(this._checkoutValidator.validate(a,t).then((()=>this._orderRequestSender.submitOrder(this._mapToOrderRequestBody(null!=e?e:{},a.id,a.customerMessage,r),Object.assign(Object.assign({},t),{headers:{checkoutVariant:o}}))))).pipe((0,A.n)((e=>(0,m.x)(this.loadOrder(e.body.data.order.orderId,t),(0,b.of)((0,d.VP)(am.SubmitOrderSucceeded,e.body.data,Object.assign(Object.assign({},e.body.meta),{token:e.headers.token})))))))})).pipe((0,C.W)((e=>ee(am.SubmitOrderFailed,e)))))}finalizeOrder(e,t){return(0,m.x)((0,b.of)((0,d.VP)(am.FinalizeOrderRequested)),(0,g.H)(this._orderRequestSender.finalizeOrder(e,t)).pipe((0,A.n)((n=>(0,m.x)(this.loadOrder(e,t),(0,b.of)((0,d.VP)(am.FinalizeOrderSucceeded,n.body.data))))))).pipe((0,C.W)((e=>ee(am.FinalizeOrderFailed,e))))}_getCurrentOrderId(e){const t=e.order.getOrder(),n=e.checkout.getCheckout();return t&&t.orderId||n&&n.orderId}_mapToOrderRequestBody(e,t,n,i){const{payment:r}=e,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);return r?Object.assign(Object.assign({},o),{cartId:t,customerMessage:n,externalSource:i,payment:{paymentData:r.paymentData,name:r.methodId,gateway:r.gatewayId}}):Object.assign(Object.assign({},o),{cartId:t,customerMessage:n,externalSource:i})}}function fm(e){const t=(0,D.U)();return e.subscribe((e=>{const n=e.config.getStoreConfig();n&&t.setHost(n.paymentSettings.bigpayBaseUrl)}),(e=>e.config.getStoreConfig())),t}function bm(e,t,n={useFallback:!1}){const{useFallback:i}=n,r=new Ye(i);for(const[,n]of Object.entries(t))if(He(n))for(const t of n.resolveIds){const i=Ge((()=>n(e)),n.resolveIds);r.register(t,i)}return r}class Sm extends te{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}!function(e){e.ExecuteFailed="PAYMENT_STRATEGY_EXECUTE_FAILED",e.ExecuteRequested="PAYMENT_STRATEGY_EXECUTE_REQUESTED",e.ExecuteSucceeded="PAYMENT_STRATEGY_EXECUTE_SUCCEEDED",e.FinalizeFailed="PAYMENT_STRATEGY_FINALIZE_FAILED",e.FinalizeRequested="PAYMENT_STRATEGY_FINALIZE_REQUESTED",e.FinalizeSucceeded="PAYMENT_STRATEGY_FINALIZE_SUCCEEDED",e.InitializeFailed="PAYMENT_STRATEGY_INITIALIZE_FAILED",e.InitializeRequested="PAYMENT_STRATEGY_INITIALIZE_REQUESTED",e.InitializeSucceeded="PAYMENT_STRATEGY_INITIALIZE_SUCCEEDED",e.DeinitializeFailed="PAYMENT_STRATEGY_DEINITIALIZE_FAILED",e.DeinitializeRequested="PAYMENT_STRATEGY_DEINITIALIZE_REQUESTED",e.DeinitializeSucceeded="PAYMENT_STRATEGY_DEINITIALIZE_SUCCEEDED",e.WidgetInteractionStarted="PAYMENT_STRATEGY_WIDGET_INTERACTION_STARTED",e.WidgetInteractionFinished="PAYMENT_STRATEGY_WIDGET_INTERACTION_FINISHED",e.WidgetInteractionFailed="PAYMENT_STRATEGY_WIDGET_INTERACTION_FAILED"}(sm||(sm={})),function(e){e.ADYENV2="adyenv2",e.ADYENV2_GOOGLEPAY="googlepayadyenv2",e.ADYENV3="adyenv3",e.ADYENV3_GOOGLEPAY="googlepayadyenv3",e.AFFIRM="affirm",e.AFTERPAY="afterpay",e.AUTHORIZENET_GOOGLE_PAY="googlepayauthorizenet",e.AMAZONPAY="amazonpay",e.APPLEPAY="applepay",e.BARCLAYS="barclays",e.BLUESNAPV2="bluesnapv2",e.BOLT="bolt",e.CBA_MPGS="cba_mpgs",e.CHECKOUTCOM="checkoutcom",e.CHECKOUTCOM_APM="checkoutcomapm",e.CHECKOUTCOM_FAWRY="checkoutcomfawry",e.CHECKOUTCOM_SEPA="checkoutcomsepa",e.CHECKOUTCOM_IDEAL="checkoutcomideal",e.CREDIT_CARD="creditcard",e.CHECKOUTCOM_GOOGLE_PAY="googlepaycheckoutcom",e.CLEARPAY="clearpay",e.CONVERGE="converge",e.CYBERSOURCE="cybersource",e.CYBERSOURCEV2="cybersourcev2",e.BNZ="bnz",e.BNZ_GOOGLEPAY="googlepaybnz",e.CYBERSOURCEV2_GOOGLE_PAY="googlepaycybersourcev2",e.HUMM="humm",e.KLARNA="klarna",e.KLARNAV2="klarnav2",e.LAYBUY="laybuy",e.LEGACY="legacy",e.MOLLIE="mollie",e.MONERIS="moneris",e.NO_PAYMENT_DATA_REQUIRED="nopaymentdatarequired",e.OFFLINE="offline",e.OFFSITE="offsite",e.ORBITAL_GOOGLE_PAY="googlepayorbital",e.PAYPAL_EXPRESS="paypalexpress",e.PAYPAL_EXPRESS_CREDIT="paypalexpresscredit",e.PAYPAL_COMMERCE="paypalcommerce",e.PAYPAL_COMMERCE_CREDIT="paypalcommercecredit",e.PAYPAL_COMMERCE_CREDIT_CARD="paypalcommercecreditcards",e.PAYPAL_COMMERCE_ALTERNATIVE_METHODS="paypalcommercealternativemethods",e.PAYPAL_COMMERCE_VENMO="paypalcommercevenmo",e.PPSDK="PAYMENT_TYPE_SDK",e.QUADPAY="quadpay",e.SAGE_PAY="sagepay",e.SQUARE="squarev2",e.STRIPEV3="stripev3",e.STRIPE_UPE="stripeupe",e.STRIPE_UPE_GOOGLE_PAY="googlepaystripeupe",e.BRAINTREE="braintree",e.BRAINTREE_PAYPAL="braintreepaypal",e.BRAINTREE_VENMO="braintreevenmo",e.BRAINTREE_PAYPAL_CREDIT="braintreepaypalcredit",e.BRAINTREE_VISA_CHECKOUT="braintreevisacheckout",e.BRAINTREE_GOOGLE_PAY="googlepaybraintree",e.WE_PAY="wepay",e.WORLDPAYACCESS="worldpayaccess",e.WORLDPAYACCESS_GOOGLE_PAY="googlepayworldpayaccess",e.MASTERPASS="masterpass",e.STRIPE_GOOGLE_PAY="googlepaystripe",e.SEZZLE="sezzle",e.ZIP="zip"}(dm||(dm={}));const Cm=dm;class wm{widgetInteraction(e,t){const n={methodId:t&&t.methodId};return(0,m.x)((0,b.of)((0,d.VP)(sm.WidgetInteractionStarted,void 0,n)),(0,p.v)((()=>e().then((()=>(0,d.VP)(sm.WidgetInteractionFinished,void 0,n)))))).pipe((0,C.W)((e=>ee(sm.WidgetInteractionFailed,e,n))))}}class _m{constructor(e,t,n,i,r,o){this._strategyRegistry=e,this._strategyRegistryV2=t,this._orderActionCreator=n,this._spamProtectionActionCreator=i,this._paymentIntegrationService=r,this._errorLogger=o,this._paymentStrategyWidgetActionCreator=new wm}execute(e,t){const{payment:n={},useStoreCredit:i}=e,r={methodId:n.methodId};return o=>{const{checkout:a}=o.getState(),{shouldExecuteSpamCheck:s}=a.getCheckoutOrThrow();return(0,m.x)(s?this._spamProtectionActionCreator.verifyCheckoutSpamProtection()(o):(0,y.I)(),(0,b.of)((0,d.VP)(sm.ExecuteRequested,void 0,r)),(0,p.v)((()=>{const a=o.getState();let s;if(a.payment.isPaymentDataRequired(i)){const e=a.paymentMethods.getPaymentMethod(n.methodId,n.gatewayId);if(!e)throw new ne(K.MissingPaymentMethod);s=this._getStrategy(e)}else s=this._strategyRegistryV2.get({id:Cm.NO_PAYMENT_DATA_REQUIRED});return s.execute(e,Object.assign(Object.assign({},t),{methodId:n.methodId,gatewayId:n.gatewayId})).then((()=>(0,d.VP)(sm.ExecuteSucceeded,void 0,r)))}))).pipe((0,C.W)((e=>ee(sm.ExecuteFailed,e,r))))}}finalize(e){return t=>(0,m.x)((0,b.of)((0,d.VP)(sm.FinalizeRequested)),this._loadOrderPaymentsIfNeeded(t,e),(0,p.v)((()=>{return n=this,r=function*(){const n=t.getState(),{providerId:i="",gatewayId:r=""}=n.payment.getPaymentId()||{},o=n.paymentMethods.getPaymentMethod(i,r);if(!o)throw new Sm;const a=this._getStrategy(o);return yield a.finalize(Object.assign(Object.assign({},e),{methodId:o.id,gatewayId:o.gateway})),(0,d.VP)(sm.FinalizeSucceeded,void 0,{methodId:o.id})},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}))).pipe((0,C.W)((e=>{const n=t.getState().payment.getPaymentId();return ee(sm.FinalizeFailed,e,{methodId:n&&n.providerId})})))}initialize(e){const{methodId:t,gatewayId:n}=e;return i=>(0,p.v)((()=>{var r,o;const a=i.getState(),s=a.paymentMethods.getPaymentMethod(t,n);if(!s)throw new ne(K.MissingPaymentMethod);if(t&&a.paymentStrategies.isInitialized({methodId:t,gatewayId:n}))return(0,y.I)();const{features:c}=a.config.getStoreConfigOrThrow().checkoutSettings;if(Ze(c,"CHECKOUT-9450.lazy_load_payment_strategies",!1)){const t={id:s.id,gateway:s.gateway,type:s.type};et(this._strategyRegistryV2,null!==(r=e.integrations)&&void 0!==r?r:[],t,this._errorLogger),Xe(this._strategyRegistryV2,null!==(o=e.integrations)&&void 0!==o?o:[],this._paymentIntegrationService)}const l=this._getStrategy(s).initialize(Object.assign(Object.assign({},e),{methodId:t,gatewayId:n}));return(0,m.x)((0,b.of)((0,d.VP)(sm.InitializeRequested,void 0,{methodId:t,gatewayId:n})),l.then((()=>(0,d.VP)(sm.InitializeSucceeded,void 0,{methodId:t,gatewayId:n}))))})).pipe((0,C.W)((e=>ee(sm.InitializeFailed,e,{methodId:t,gatewayId:n}))))}deinitialize(e){const{methodId:t,gatewayId:n}=e;return i=>(0,p.v)((()=>{const r=i.getState(),o=r.paymentMethods.getPaymentMethod(t,n);if(!o)throw new ne(K.MissingPaymentMethod);if(t&&!r.paymentStrategies.isInitialized({methodId:t,gatewayId:n}))return(0,y.I)();const a=this._getStrategy(o).deinitialize(Object.assign(Object.assign({},e),{methodId:t,gatewayId:n}));return(0,m.x)((0,b.of)((0,d.VP)(sm.DeinitializeRequested,void 0,{methodId:t,gatewayId:n})),a.then((()=>(0,d.VP)(sm.DeinitializeSucceeded,void 0,{methodId:t,gatewayId:n}))))})).pipe((0,C.W)((e=>ee(sm.DeinitializeFailed,e,{methodId:t,gatewayId:n}))))}widgetInteraction(e,t){return this._paymentStrategyWidgetActionCreator.widgetInteraction(e,t)}_getStrategy(e){let t;try{t=this._strategyRegistry.getByMethod(e)}catch(n){t=this._strategyRegistryV2.get({id:e.id,gateway:e.gateway,type:e.type})}return t}_loadOrderPaymentsIfNeeded(e,t){const n=e.getState().checkout.getCheckout();return n&&n.orderId?this._orderActionCreator.loadOrderPayments(n.orderId,t):(0,y.I)()}}class Im{isEqual(e,t){return(0,c.isEqual)(this._normalize(e),this._normalize(t))}_normalize(e){return{cartAmount:e.cartAmount,currency:e.currency,id:e.id,lineItems:{digitalItems:e.lineItems.digitalItems.slice().sort(((e,t)=>`${e.productId}${e.variantId}`.localeCompare(`${t.productId}${t.variantId}`))).map((e=>({extendedSalePrice:e.extendedSalePrice,productId:e.productId,quantity:e.quantity,variantId:e.variantId}))),giftCertificates:e.lineItems.giftCertificates.slice().sort(((e,t)=>`${e.id}`.localeCompare(`${t.id}`))).map((e=>({amount:e.amount,recipient:e.recipient}))),physicalItems:e.lineItems.physicalItems.slice().sort(((e,t)=>`${e.productId}${e.variantId}`.localeCompare(`${t.productId}${t.variantId}`))).map((e=>({extendedSalePrice:e.extendedSalePrice,productId:e.productId,quantity:e.quantity,variantId:e.variantId,giftWrapping:e.giftWrapping})))}}}}class Pm extends te{constructor(e,t){super("An update to your shopping cart has been detected and your available shipping costs have been updated."),this.name="CartChangedError",this.type="cart_changed",this.data={previous:e,updated:t}}}class Em{constructor(e){this._checkoutRequestSender=e}validate(e,t){if(!e)throw new ne(K.MissingCheckout);return this._checkoutRequestSender.loadCheckout(e.id,t).then((t=>{const n=new Im;if(!(e.outstandingBalance===t.body.outstandingBalance&&this._compareCoupons(e.coupons,t.body.coupons)&&this._compareGiftCertificates(e.giftCertificates,t.body.giftCertificates)&&n.isEqual(e.cart,t.body.cart)))throw new Pm(this._getComparableCheckout(e),this._getComparableCheckout(t.body))}))}_compareCoupons(e,t){return(0,c.isEqual)((0,c.map)(e,"code"),(0,c.map)(t,"code"))}_compareGiftCertificates(e,t){return(0,c.isEqual)((0,c.map)(e,"code"),(0,c.map)(t,"code"))}_getComparableCheckout(e){const{cart:t,coupons:n,giftCertificates:i,outstandingBalance:r}=e;return{cart:{cartAmount:t.cartAmount,currency:t.currency,lineItems:t.lineItems},coupons:n,giftCertificates:i,outstandingBalance:r}}}class Om{constructor(e){this._namespace=e}getItem(e){const t=x.Ay.getItem(this.withNamespace(e));if(null===t)return null;try{return JSON.parse(t)}catch(t){return this.removeItem(this.withNamespace(e)),null}}getItemOnce(e){const t=this.getItem(e);return this.removeItem(e),t}setItem(e,t){return x.Ay.setItem(this.withNamespace(e),JSON.stringify(t))}removeItem(e){return x.Ay.removeItem(this.withNamespace(e))}withNamespace(e){return`${this._namespace}.${e}`}}class Am extends te{constructor(){super("Please complete our human verification challenge and try again."),this.name="CardingProtectionChallengeNotCompletedError",this.type="carding_protection_challenge_not_completed"}}class km extends te{constructor(){super("We were not able to verify that you are not a robot. Please try again."),this.name="CardingProtectionFailedError",this.type="carding_protection_failed"}}var Tm,Nm,Mm=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class xm{constructor(e){this._googleRecaptcha=e}handle(e,t){return Mm(this,void 0,void 0,(function*(){return"string"==typeof e?this.handleWithRecaptchaSitekey(e,t):this.handleWithPaymentHumanVerificationRequestError(e)}))}handleWithPaymentHumanVerificationRequestError(e){return Mm(this,void 0,void 0,(function*(){if(!this._isPaymentHumanVerificationRequest(e))throw e;return yield this._initialize(e.body.additional_action_required.data.key),this._performRecaptcha()}))}handleWithRecaptchaSitekey(e,t){return Mm(this,void 0,void 0,(function*(){if("recaptcha_v2"!==e)throw Error("Human verification method is not supported.");if(!t)throw Error("Recaptcha site key is missing.");return yield this._initialize(t),this._performRecaptcha()}))}_performRecaptcha(){return this._googleRecaptcha.execute().pipe((0,k.s)(1)).pipe((0,A.n)((({error:e,token:t})=>Mm(this,void 0,void 0,(function*(){if(e instanceof gt)throw new Am;if(e||!t)throw new km;return{type:"recaptcha_v2_verification",data:{human_verification_token:t}}}))))).toPromise()}_initialize(e){const t="cardingProtectionContainer";let n=document.getElementById(t);return n&&n.parentNode&&n.parentNode.removeChild(n),n=document.createElement("div"),n.setAttribute("id",t),document.body.appendChild(n),this._googleRecaptcha.load(t,e)}_isPaymentHumanVerificationRequest(e){const{additional_action_required:t,status:n}=e.body||{};return"additional_action_required"===n&&t&&"recaptcha_v2_verification"===t.type}}function Dm(e,t){const{body:n}=e,{errors:i=[]}=n;return new Ie(e,{message:zm(i)||t,errors:i})}function zm(e){if(Array.isArray(e))return e.reduce(((e,t)=>t&&t.message?[...e,t.message]:e),[]).join(" ")}class Fm extends te{constructor(e){super(e||"Unable to proceed due to invalid configuration provided for the hosted payment form."),this.name="InvalidHostedFormConfigError",this.type="invalid_hosted_form_config"}}class Bm extends te{constructor(e){super(e||"Unable to proceed due to an unknown error with the hosted payment form."),this.name="InvalidHostedFormError",this.type="invalid_hosted_form"}}class Rm extends te{constructor(e){super(["Unable to proceed due to invalid user input values",...(0,c.flatMap)((0,c.values)(e),(e=>(0,c.map)(e,(({message:e})=>e))))].join(". ")),this.errors=e,this.name="InvalidHostedFormValueError",this.type="invalid_hosted_form_value"}}!function(e){e.AttachRequested="HOSTED_FIELD:ATTACH_REQUESTED",e.SubmitRequested="HOSTED_FIELD:SUBMITTED_REQUESTED",e.ValidateRequested="HOSTED_FIELD:VALIDATE_REQUESTED",e.StoredCardRequested="HOSTED_FIELD:STORED_CARD_REQUESTED"}(Tm||(Tm={})),function(e){e.AttachSucceeded="HOSTED_INPUT:ATTACH_SUCCEEDED",e.AttachFailed="HOSTED_INPUT:ATTACH_FAILED",e.BinChanged="HOSTED_INPUT:BIN_CHANGED",e.Blurred="HOSTED_INPUT:BLURRED",e.Changed="HOSTED_INPUT:CHANGED",e.CardTypeChanged="HOSTED_INPUT:CARD_TYPE_CHANGED",e.Entered="HOSTED_INPUT:ENTERED",e.Focused="HOSTED_INPUT:FOCUSED",e.SubmitSucceeded="HOSTED_INPUT:SUBMIT_SUCCEEDED",e.SubmitFailed="HOSTED_INPUT:SUBMIT_FAILED",e.Validated="HOSTED_INPUT:VALIDATED",e.StoredCardSucceeded="HOSTED_INPUT:STORED_CARD_SUCCEEDED",e.StoredCardFailed="HOSTED_INPUT:STORED_CARD_FAILED"}(Nm||(Nm={}));var Lm=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class jm{constructor(e,t,n,i,r,o,a,s,d,c){this._type=e,this._containerId=t,this._placeholder=n,this._accessibilityLabel=i,this._styles=r,this._eventPoster=o,this._eventListener=a,this._detachmentObserver=s,this._checkoutId=d,this._cardInstrument=c,this._iframe=document.createElement("iframe");const l=this._checkoutId?`/checkout/payment/hosted-field?version=1.808.0&checkoutId=${this._checkoutId}`:"/checkout/payment/hosted-field?version=1.808.0";this._iframe.src=l,this._iframe.style.border="none",this._iframe.style.height="100%",this._iframe.style.overflow="hidden",this._iframe.style.width="100%"}getType(){return this._type}attach(){return Lm(this,void 0,void 0,(function*(){const e=document.getElementById(this._containerId);if(!e)throw new Fm("Unable to proceed because the provided container ID is not valid.");e.appendChild(this._iframe),this._eventListener.listen();const t=(0,v.R)(this._iframe,"load").pipe((0,A.n)((({target:e})=>Lm(this,void 0,void 0,(function*(){const t=e&&e.contentWindow;if(!t)throw new Error("The content window of the iframe cannot be accessed.");this._eventPoster.setTarget(t),yield this._eventPoster.post({type:Tm.AttachRequested,payload:{accessibilityLabel:this._accessibilityLabel,cardInstrument:this._cardInstrument,fontUrls:this._getFontUrls(),placeholder:this._placeholder,styles:this._styles,origin:document.location.origin,type:this._type}},{successType:Nm.AttachSucceeded,errorType:Nm.AttachFailed})})))),(0,k.s)(1)).toPromise();yield this._detachmentObserver.ensurePresence([this._iframe],t)}))}detach(){this._iframe.parentElement&&(this._iframe.parentElement.removeChild(this._iframe),this._eventListener.stopListen())}submitForm(e,t){return Lm(this,void 0,void 0,(function*(){try{const n=this._eventPoster.post({type:Tm.SubmitRequested,payload:{fields:e,data:t}},{successType:Nm.SubmitSucceeded,errorType:Nm.SubmitFailed});return yield this._detachmentObserver.ensurePresence([this._iframe],n)}catch(e){if(this._isSubmitErrorEvent(e)){if("hosted_form_error"===e.payload.error.code)throw new Bm(e.payload.error.message);if(e.payload.response)throw Dm(e.payload.response);throw new Error(e.payload.error.message)}throw e}}))}submitStoredCardForm(e,t){return Lm(this,void 0,void 0,(function*(){const n=this._eventPoster.post({type:Tm.StoredCardRequested,payload:{fields:e,data:t}},{successType:Nm.StoredCardSucceeded,errorType:Nm.StoredCardFailed});return this._detachmentObserver.ensurePresence([this._iframe],n)}))}validateForm(){return Lm(this,void 0,void 0,(function*(){const e=this._eventPoster.post({type:Tm.ValidateRequested},{successType:Nm.Validated}),{payload:t}=yield this._detachmentObserver.ensurePresence([this._iframe],e);if(!t.isValid)throw new Rm(t.errors)}))}_getFontUrls(){const e="fonts.googleapis.com",t=document.querySelectorAll(`link[href*='${e}'][rel='stylesheet']`);return Array.prototype.slice.call(t).filter((t=>zt(t.href).hostname===e)).filter((e=>(0,c.values)(this._styles).map((e=>e&&e.fontFamily)).filter((e=>"string"==typeof e)).some((t=>t.split(/,\s/).some((t=>-1!==e.href.indexOf(t.replace(" ","+")))))))).map((e=>e.href))}_isSubmitErrorEvent(e){return e.type===Nm.SubmitFailed}}var Um,Vm=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class qm{constructor(e,t,n,i,r){this._fields=e,this._eventListener=t,this._payloadTransformer=n,this._eventCallbacks=i,this._paymentHumanVerificationHandler=r,this._handleEnter=({payload:e})=>Vm(this,void 0,void 0,(function*(){try{yield this.validate()}catch(e){if(e instanceof Error&&"InvalidHostedFormValueError"!==e.name)throw e}const{onEnter:t=c.noop}=this._eventCallbacks;t(e)}));const{onBlur:o=c.noop,onCardTypeChange:a=c.noop,onFocus:s=c.noop,onValidate:d=c.noop}=this._eventCallbacks;this._eventListener.addListener(Nm.Blurred,(({payload:e})=>o(e))),this._eventListener.addListener(Nm.CardTypeChanged,(({payload:e})=>a(e))),this._eventListener.addListener(Nm.Focused,(({payload:e})=>s(e))),this._eventListener.addListener(Nm.Validated,(({payload:e})=>d(e))),this._eventListener.addListener(Nm.Entered,this._handleEnter),this._eventListener.addListener(Nm.CardTypeChanged,(({payload:e})=>this._cardType=e.cardType)),this._eventListener.addListener(Nm.BinChanged,(({payload:e})=>this._bin=e.bin))}getBin(){return this._bin}getCardType(){return this._cardType}attach(){return Vm(this,void 0,void 0,(function*(){this._eventListener.listen();const e=this._getFirstField(),t=(0,c.without)(this._fields,e);yield e.attach(),yield Promise.all(t.map((e=>e.attach())))}))}detach(){this._eventListener.stopListen(),this._fields.forEach((e=>{e.detach()}))}submit(e,t){return Vm(this,void 0,void 0,(function*(){try{return yield this._getFirstField().submitForm(this._fields.map((e=>e.getType())),this._payloadTransformer.transform(e,t))}catch(t){const n=yield this._paymentHumanVerificationHandler.handle(t);return yield this._getFirstField().submitForm(this._fields.map((e=>e.getType())),this._payloadTransformer.transform(e,n))}}))}submitStoredCard(e){return Vm(this,void 0,void 0,(function*(){return this._getFirstField().submitStoredCardForm(e.fields,e.data)}))}validate(){return Vm(this,void 0,void 0,(function*(){return this._getFirstField().validateForm()}))}_getFirstField(){const e=this._fields[0];if(!e)throw new Fm("Unable to proceed because the payment form has no field defined.");return e}}function Hm(e){return Boolean(e.instrumentId)}class Gm{constructor(e){this._store=e}transform(e,t){const n=this._store.getState(),i=n.checkout.getCheckout(),r=n.config.getConfig(),o=n.instruments.getInstrumentsMeta(),a=n.order.getOrder(),s=n.order.getOrderMeta(),d=(0,c.omit)(e.paymentData,"ccExpiry","ccName","ccNumber","ccCvv"),l=n.paymentMethods.getPaymentMethod(e.methodId,e.gatewayId),u=n.paymentMethods.getPaymentMethodsMeta(),h=o&&d&&Hm(d)?`${n.payment.getPaymentToken()}, ${o.vaultAccessToken}`:n.payment.getPaymentToken();if(!h)throw new ne(K.MissingPaymentToken);return{additionalAction:t,authToken:h,checkout:i,config:r,order:a,orderMeta:s,payment:d,paymentMethod:l,paymentMethodMeta:u}}}class $m{constructor(e){this._store=e}create(e,t,n){const i=Object.keys(t.fields).reduce(((i,r)=>{const o=t.fields[r];return o?[...i,new jm(r,o.containerId,o.placeholder||"",o.accessibilityLabel||"",t.styles||{},new Ut(e),new ln(e),new Gt(new Ct),n,"instrumentId"in o?this._getCardInstrument(o.instrumentId):void 0)]:i}),[]);return new qm(i,new ln(e),new Gm(this._store),(0,c.pick)(t,"onBlur","onEnter","onFocus","onCardTypeChange","onValidate"),new xm(Et((0,s.Hb)())))}_getCardInstrument(e){const{instruments:{getCardInstrument:t}}=this._store.getState(),n=t(e);if(!n)throw new ne(K.MissingPaymentInstrument);return n}}class Wm{constructor(e){this._requestSender=e}createBuyNowCart(e,{timeout:t}={}){const n=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.post("/api/storefront/carts",{body:e,headers:n,timeout:t})}}!function(e){e.SubmitPaymentRequested="SUBMIT_PAYMENT_REQUESTED",e.SubmitPaymentSucceeded="SUBMIT_PAYMENT_SUCCEEDED",e.SubmitPaymentFailed="SUBMIT_PAYMENT_FAILED",e.InitializeOffsitePaymentRequested="INITIALIZE_OFFSITE_PAYMENT_REQUESTED",e.InitializeOffsitePaymentSucceeded="INITIALIZE_OFFSITE_PAYMENT_SUCCEEDED",e.InitializeOffsitePaymentFailed="INITIALIZE_OFFSITE_PAYMENT_FAILED"}(Um||(Um={}));class Ym{constructor(e,t,n,i){this._paymentRequestSender=e,this._orderActionCreator=t,this._paymentRequestTransformer=n,this._paymentHumanVerificationHandler=i,this.initializeOffsitePayment=({methodId:e,gatewayId:t,instrumentId:n,target:i,promise:r,shouldSaveInstrument:o,shouldSetAsDefaultInstrument:a})=>s=>{let c;n?c={formattedPayload:{bigpay_token:n}}:o&&(c={formattedPayload:{vault_payment_instrument:o,set_as_default_stored_instrument:a||null}});const l=this._paymentRequestTransformer.transform({gatewayId:t,methodId:e,paymentData:c},s.getState());return(0,m.x)((0,b.of)((0,d.VP)(Um.InitializeOffsitePaymentRequested)),Promise.race([this._paymentRequestSender.initializeOffsitePayment(l,i),r].filter(Boolean)).then((()=>(0,d.VP)(Um.InitializeOffsitePaymentSucceeded)))).pipe((0,C.W)((e=>ee(Um.InitializeOffsitePaymentFailed,e))))}}submitPayment(e){return t=>(0,m.x)((0,b.of)((0,d.VP)(Um.SubmitPaymentRequested)),(0,p.v)((()=>{return n=this,r=function*(){try{return yield this._paymentRequestSender.submitPayment(this._paymentRequestTransformer.transform(e,t.getState()))}catch(n){const i=yield this._paymentHumanVerificationHandler.handle(n);return yield this._paymentRequestSender.submitPayment(this._paymentRequestTransformer.transform(Object.assign(Object.assign({},e),{additionalAction:i}),t.getState()))}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r})).pipe((0,A.n)((({body:e})=>(0,m.x)(this._orderActionCreator.loadCurrentOrder()(t),(0,b.of)((0,d.VP)(Um.SubmitPaymentSucceeded,e))))))).pipe((0,C.W)((e=>ee(Um.SubmitPaymentFailed,e))))}}class Km{constructor(e){this._client=e}submitPayment(e){return new Promise(((t,n)=>{this._client.submitPayment(e,((e,i)=>{e?n(this._transformResponse(e)):t(this._transformResponse(i))}))}))}initializeOffsitePayment(e,t){return new Promise((()=>{this._client.initializeOffsitePayment(e,null,t)}))}_transformResponse(e){return{headers:e.headers,body:e.data,status:e.status,statusText:e.statusText}}}function Qm(e,t){let n;return function(e){return void 0!==e.id}(e)?n=e.id:t&&t.length&&(n=t[0].id),{id:n,firstName:e.firstName,lastName:e.lastName,company:e.company,addressLine1:e.address1,addressLine2:e.address2,city:e.city,province:e.stateOrProvince,provinceCode:e.stateOrProvinceCode,postCode:e.postalCode,country:e.country,countryCode:e.countryCode,phone:e.phone,customFields:e.customFields}}const Jm=["per_item_discount","percentage_discount","per_total_discount","shipping_discount","free_shipping"];function Zm(e){return{code:e.code,discount:e.displayName,discountType:Jm.indexOf(e.couponType)}}function Xm(e){return{code:e.code,discountedAmount:e.used,remainingBalance:e.remaining,giftCertificate:{balance:e.balance,code:e.code,purchaseDate:e.purchaseDate}}}function ep(e){const t=[];return(e||[]).forEach((e=>{(e.banners||[]).forEach((e=>{t.push({placeholders:[],discountType:null,message:"",messageHtml:e.text})}))})),t}function tp(e,t,n="id"){return Object.keys(e).reduce(((i,r)=>[...i,...e[r].map((e=>"giftCertificates"===r?function(e,t){const n=new hs(t);return{id:e.id,imageUrl:"",name:e.name,amount:e.amount,amountAfterDiscount:e.amount,discount:0,integerAmount:n.toInteger(e.amount),integerAmountAfterDiscount:n.toInteger(e.amount),integerUnitPrice:n.toInteger(e.amount),integerUnitPriceAfterDiscount:n.toInteger(e.amount),integerDiscount:0,quantity:1,sender:e.sender,recipient:e.recipient,type:"ItemGiftCertificateEntity",attributes:[],variantId:null}}(e,t):function(e,t,n,i="id"){const r=new hs(n);return{id:e[i],imageUrl:e.imageUrl,amount:e.extendedListPrice,amountAfterDiscount:e.extendedSalePrice,discount:e.discountAmount,integerAmount:r.toInteger(e.extendedListPrice),integerAmountAfterDiscount:r.toInteger(e.extendedSalePrice),integerDiscount:r.toInteger(e.discountAmount),integerUnitPrice:r.toInteger(e.listPrice),integerUnitPriceAfterDiscount:r.toInteger(e.salePrice),downloadsPageUrl:e.downloadPageUrl,name:e.name,quantity:e.quantity,brand:e.brand,sku:e.sku,categoryNames:e.categoryNames,variantId:e.variantId,productId:e.productId,attributes:(e.options||[]).map((e=>({name:e.name,value:e.value}))),addedByPromotion:e.addedByPromotion,type:t}}(e,function(e){switch(e){case"physicalItems":return"ItemPhysicalEntity";case"digitalItems":return"ItemDigitalEntity";case"giftCertificates":return"ItemGiftCertificateEntity";default:return""}}(r),t,n)))]),[])}function np(e){const t=e.cart.currency.decimalPlaces,n=new hs(t);return{id:e.cart.id,items:tp(e.cart.lineItems,t),currency:e.cart.currency.code,coupon:{discountedAmount:(0,c.reduce)(e.cart.coupons,((e,t)=>e+t.discountedAmount),0),coupons:e.cart.coupons.map(Zm)},discount:{amount:e.cart.discountAmount,integerAmount:n.toInteger(e.cart.discountAmount)},discountNotifications:ep(e.promotions),giftCertificate:{totalDiscountedAmount:(0,c.reduce)(e.giftCertificates,((e,t)=>e+t.used),0),appliedGiftCertificates:(0,c.keyBy)(e.giftCertificates.map(Xm),"code")},shipping:{amount:e.shippingCostTotal,integerAmount:n.toInteger(e.shippingCostTotal),amountBeforeDiscount:e.shippingCostBeforeDiscount,integerAmountBeforeDiscount:n.toInteger(e.shippingCostBeforeDiscount),required:(0,c.some)(e.cart.lineItems.physicalItems,(e=>e.isShippingRequired))},subtotal:{amount:e.subtotal,integerAmount:n.toInteger(e.subtotal)},storeCredit:{amount:e.customer?e.customer.storeCredit:0},taxSubtotal:{amount:e.taxTotal,integerAmount:n.toInteger(e.taxTotal)},taxes:e.taxes,taxTotal:{amount:e.taxTotal,integerAmount:n.toInteger(e.taxTotal)},handling:{amount:e.handlingCostTotal,integerAmount:n.toInteger(e.handlingCostTotal)},grandTotal:{amount:e.grandTotal,integerAmount:n.toInteger(e.grandTotal)}}}var ip;!function(e){e.APPLEPAY="applepay",e.AMAZON_PAY_V2="amazonpay",e.BRAINTREE_PAYPAL="braintreepaypal",e.BRAINTREE_VENMO="braintreevenmo",e.BRAINTREE_PAYPAL_CREDIT="braintreepaypalcredit",e.GOOGLEPAY_ADYENV2="googlepayadyenv2",e.GOOGLEPAY_ADYENV3="googlepayadyenv3",e.GOOGLEPAY_AUTHORIZENET="googlepayauthorizenet",e.GOOGLEPAY_BNZ="googlepaybnz",e.GOOGLEPAY_BRAINTREE="googlepaybraintree",e.GOOGLEPAY_CHECKOUTCOM="googlepaycheckoutcom",e.GOOGLEPAY_CYBERSOURCEV2="googlepaycybersourcev2",e.GOOGLEPAY_ORBITAL="googlepayorbital",e.GOOGLEPAY_STRIPE="googlepaystripe",e.GOOGLEPAY_STRIPEUPE="googlepaystripeupe",e.GOOGLEPAY_WORLDPAYACCESS="googlepayworldpayaccess",e.MASTERPASS="masterpass",e.PAYPALEXPRESS="paypalexpress"}(ip||(ip={}));const rp=ip;function op(e,t){const n=e.firstName||t.firstName||"",i=e.lastName||t.lastName||"";return{addresses:(e.addresses||[]).map((e=>Qm(e))),customerId:e.id,isGuest:e.isGuest,storeCredit:e.storeCredit,email:e.email||t.email||"",firstName:n,lastName:i,name:e.fullName||[n,i].join(" "),customerGroupName:e.customerGroup&&e.customerGroup.name}}class ap{format(e){const[t="",n=""]=e.split(new RegExp("\\s*/\\s*")),i=t.slice(0,2),r=4===n.length?n.slice(-2):n?n.slice(0,2):t.slice(2);return e.length<2?t:e.length>3&&!r?i:`${i} / ${r}`}toObject(e){const[t="",n=""]=e.split(new RegExp("\\s*/\\s*"));return/^\d+$/.test(t)&&/^\d+$/.test(n)?{month:1===t.length?`0${t}`:t.slice(0,2),year:2===n.length?`20${n}`:n.slice(0,4)}:{month:"",year:""}}}class sp{format(e){const{card:t}=(0,z.number)(e);if(!t)return e;const n=(0,c.max)((0,z.creditCardType)(e).map((e=>(0,c.max)(e.lengths)))),i=this.unformat(e).slice(0,n);return t.gaps.filter((e=>i.length>e)).reduce(((e,t,n)=>[e.slice(0,t+n),e.slice(t+n)].join(" ")),i)}unformat(e){const{card:t}=(0,z.number)(e);return t?e.replace(new RegExp(" ","g"),""):e}}function dp(e,t={}){const n=e.currency.decimalPlaces,i=new hs(n);return{id:e.orderId,items:tp(e.lineItems,e.currency.decimalPlaces,"productId"),orderId:e.orderId,currency:e.currency.code,customerCanBeCreated:e.customerCanBeCreated,payment:up(e.payments,t.payment),subtotal:{amount:e.baseAmount,integerAmount:i.toInteger(e.baseAmount)},coupon:{discountedAmount:(0,c.reduce)(e.coupons,((e,t)=>e+t.discountedAmount),0),coupons:e.coupons.map(Zm)},discount:{amount:e.discountAmount,integerAmount:i.toInteger(e.discountAmount)},token:t.orderToken,callbackUrl:t.callbackUrl,discountNotifications:[],giftCertificate:lp(e.payments),socialData:mp(e),status:e.status,hasDigitalItems:e.hasDigitalItems,isDownloadable:e.isDownloadable,isComplete:e.isComplete,shipping:{amount:e.shippingCostTotal,integerAmount:i.toInteger(e.shippingCostTotal),amountBeforeDiscount:e.shippingCostBeforeDiscount,integerAmountBeforeDiscount:i.toInteger(e.shippingCostBeforeDiscount)},storeCredit:{amount:cp(e.payments)},taxes:e.taxes,taxTotal:{amount:e.taxTotal,integerAmount:i.toInteger(e.taxTotal)},handling:{amount:e.handlingCostTotal,integerAmount:i.toInteger(e.handlingCostTotal)},grandTotal:{amount:e.orderAmount,integerAmount:e.orderAmountAsInteger}}}function cp(e){const t=(0,c.find)(e,{providerId:"storecredit"});return t?t.amount:0}function lp(e){const t=(0,c.filter)(e,{providerId:"giftcertificate"});return{totalDiscountedAmount:(0,c.reduce)(t,((e,t)=>t.amount+e),0),appliedGiftCertificates:(0,c.keyBy)(t.map((e=>({code:e.detail.code,discountedAmount:e.amount,remainingBalance:e.detail.remaining,giftCertificate:{balance:e.amount+e.detail.remaining,code:e.detail.code,purchaseDate:""}}))),"code")}}function up(e,t={}){const n=(0,c.find)(e,hp);return n?{id:n.providerId,status:(i=n.detail.step,`PAYMENT_STATUS_${i}`),helpText:n.detail.instructions,returnUrl:t.returnUrl}:{};var i}function hp(e){return"giftcertificate"!==e.providerId&&"storecredit"!==e.providerId}function mp(e){const t={};return[...e.lineItems.physicalItems,...e.lineItems.digitalItems].forEach((e=>{var n;t[e.id]=(n=e,["fb","tw","gp"].reduce(((e,t)=>{const i=n.socialMedia&&(0,c.find)(n.socialMedia,(e=>e.code===t));return i?(e[t]={name:n.name,description:n.name,image:n.imageUrl,url:i.link,shareText:i.text,sharingLink:i.link,channelName:i.channel,channelCode:i.code},e):e}),{}))})),t}function pp(e,t){return{description:e.description,module:e.type,price:e.cost,id:e.id,selected:t,isRecommended:e.isRecommended,imageUrl:e.imageUrl,transitTime:e.transitTime}}class yp{constructor(){this._cardExpiryFormatter=new ap,this._cardNumberFormatter=new sp}transform(e,t){const n=t.billingAddress.getBillingAddress(),i=t.checkout.getCheckout(),r=t.customer.getCustomer(),o=t.order.getOrder(),a=t.paymentMethods.getPaymentMethod(e.methodId,e.gatewayId),s=this._mapShippingAddress(t,a),d=t.consignments.getConsignments(),l=t.consignments.getShippingOption(),u=t.config.getStoreConfig(),h=t.config.getContextConfig(),m=t.instruments.getInstrumentsMeta(),p=t.paymentMethods.getPaymentMethodsMeta(),y=t.order.getOrderMeta(),g=r&&n&&op(r,n),v=m&&e.paymentData&&(Hm(e.paymentData)||function(e){const t=e.formattedPayload;return!!t&&("string"==typeof t.bigpay_token||Boolean(t.bigpay_token&&t.bigpay_token.token))}(e.paymentData))?`${t.payment.getPaymentToken()}, ${m.vaultAccessToken}`:t.payment.getPaymentToken();if(!v)throw new ne(K.MissingPaymentToken);return{additionalAction:e.additionalAction,authToken:v,customer:g,billingAddress:n&&Qm(n),shippingAddress:s&&Qm(s,d),shippingOption:l&&pp(l,!0),cart:i&&np(i),order:o&&dp(o,y),orderMeta:y,payment:e.paymentData,paymentMethod:a&&this._transformPaymentMethod(a),quoteMeta:{request:Object.assign(Object.assign({},p),{geoCountryCode:h&&h.geoCountryCode})},source:"bigcommerce-checkout-js-sdk",store:(0,c.pick)(u&&u.storeProfile,["storeHash","storeId","storeLanguage","storeName"])}}transformWithHostedFormData(e,t,n){const{additionalAction:i,authToken:r,checkout:o,config:a,order:s,orderMeta:d,payment:l={},paymentMethod:u,paymentMethodMeta:h}=t,m=o&&o.consignments[0],p=m&&m.shippingAddress,y=m&&m.selectedShippingOption;return{additionalAction:i,authToken:r,paymentMethod:u&&this._transformPaymentMethod(u),customer:s&&s.billingAddress&&o&&op(o.customer,s.billingAddress),billingAddress:s&&s.billingAddress&&Qm(s.billingAddress),shippingAddress:p&&o&&Qm(p,o.consignments),shippingOption:y&&pp(y,!0),cart:o&&np(o),order:s&&dp(s,d),orderMeta:d,payment:this._transformHostedInputValues(e,l,n),quoteMeta:{request:Object.assign(Object.assign({},h),{geoCountryCode:a&&a.context.geoCountryCode})},source:"bigcommerce-checkout-js-sdk",store:a&&(0,c.pick)(a.storeConfig.storeProfile,["storeHash","storeId","storeLanguage","storeName"])}}_transformPaymentMethod(e){return"multi-option"!==e.method||e.gateway?e.initializationData&&e.initializationData.gateway?Object.assign(Object.assign({},e),{id:e.initializationData.gateway}):e.id===rp.BRAINTREE_VENMO?Object.assign(Object.assign({},e),{id:rp.BRAINTREE_PAYPAL}):e:Object.assign(Object.assign({},e),{gateway:e.id})}_transformHostedInputValues(e,t,n){return"instrumentId"in t?Object.assign(Object.assign({},t),{ccCvv:e.cardCodeVerification,ccNumber:e.cardNumberVerification&&this._cardNumberFormatter.unformat(e.cardNumberVerification),hostedFormNonce:n}):Object.assign(Object.assign({},t),{ccCvv:e.cardCode,ccExpiry:this._cardExpiryFormatter.toObject(e.cardExpiry||""),ccName:e.cardName||"",ccNumber:this._cardNumberFormatter.unformat(e.cardNumber||""),hostedFormNonce:n})}_mapShippingAddress(e,t){var n,i,r,o;if(t){const a=null===(i=null===(n=t.initializationData)||void 0===n?void 0:n.bopis)||void 0===i?void 0:i.enabled,s=null===(o=null===(r=t.initializationData)||void 0===r?void 0:r.bopis)||void 0===o?void 0:o.requiredAddress,d=e.consignments.getConsignments(),c=null==d?void 0:d.every((e=>e.selectedPickupOption));if(a&&c&&"none"===s)return}return e.shippingAddress.getShippingAddress()}}var gp,vp;!function(e){e.UpdatePaymentProviderCustomer="UPDATE_PAYMENT_PROVIDER_CUSTOMER"}(gp||(gp={}));class fp{updatePaymentProviderCustomer(e){return(0,b.of)((0,d.VP)(gp.UpdatePaymentProviderCustomer,e))}}!function(e){e.CreateConsignmentsRequested="CREATE_CONSIGNMENTS_REQUESTED",e.CreateConsignmentsSucceeded="CREATE_CONSIGNMENTS_SUCCEEDED",e.CreateConsignmentsFailed="CREATE_CONSIGNMENTS_FAILED",e.UpdateConsignmentRequested="UPDATE_CONSIGNMENT_REQUESTED",e.UpdateConsignmentSucceeded="UPDATE_CONSIGNMENT_SUCCEEDED",e.UpdateConsignmentFailed="UPDATE_CONSIGNMENT_FAILED",e.DeleteConsignmentRequested="DELETE_CONSIGNMENT_REQUESTED",e.DeleteConsignmentSucceeded="DELETE_CONSIGNMENT_SUCCEEDED",e.DeleteConsignmentFailed="DELETE_CONSIGNMENT_FAILED",e.UpdateShippingOptionRequested="UPDATE_SHIPPING_OPTION_REQUESTED",e.UpdateShippingOptionSucceeded="UPDATE_SHIPPING_OPTION_SUCCEEDED",e.UpdateShippingOptionFailed="UPDATE_SHIPPING_OPTION_FAILED",e.LoadShippingOptionsRequested="LOAD_SHIPPING_OPTIONS_REQUESTED",e.LoadShippingOptionsSucceeded="LOAD_SHIPPING_OPTIONS_SUCCEEDED",e.LoadShippingOptionsFailed="LOAD_SHIPPING_OPTIONS_FAILED"}(vp||(vp={}));class bp{constructor(e,t){this._consignmentRequestSender=e,this._checkoutRequestSender=t}unassignItemsByAddress(e,t){return n=>{const i=n.getState();if(!i.checkout.getCheckout())throw new ne(K.MissingCheckout);const r=this._consignmentHasAddress(e)?e.address:e.shippingAddress,o=i.consignments.getConsignmentByAddress(r);if(!o)throw new $e("No consignment found for the specified address");const a=this._removeLineItems(e.lineItems,o,i.cart.getCart());return a.length?this.updateConsignment({id:o.id,address:r,lineItems:a},t)(n):this.deleteConsignment(o.id,t)(n)}}assignItemsByAddress(e,t){return n=>{const i=n.getState(),r=this._consignmentHasAddress(e)?e.address:e.shippingAddress,o=i.consignments.getConsignmentByAddress(r);return this._createOrUpdateConsignment({id:o&&o.id,address:r,lineItems:this._addLineItems(e.lineItems,o,i.cart.getCart())},t)(n)}}selectShippingOption(e,t){return n=>l.c.create((i=>{const r=n.getState(),o=r.checkout.getCheckout(),a=r.consignments.getConsignments();if(!o)throw new ne(K.MissingCheckout);if(!a||!a.length)throw new ne(K.MissingConsignments);const s={id:a[0].id,shippingOptionId:e},c={id:a[0].id};i.next((0,d.VP)(vp.UpdateShippingOptionRequested,void 0,c)),this._consignmentRequestSender.updateConsignment(o.id,s,t).then((({body:e})=>{i.next((0,d.VP)(vp.UpdateShippingOptionSucceeded,e,c)),i.complete()})).catch((e=>{i.error((0,d.fQ)(vp.UpdateShippingOptionFailed,e,c))}))}))}loadShippingOptions(e){return t=>l.c.create((n=>{const i=t.getState().checkout.getCheckout();if(!i)throw new ne(K.MissingCheckout);n.next((0,d.VP)(vp.LoadShippingOptionsRequested)),this._checkoutRequestSender.loadCheckout(i.id,Object.assign(Object.assign({},e),{params:{include:[Ne.AvailableShippingOptions]}})).then((({body:e})=>{n.next((0,d.VP)(vp.LoadShippingOptionsSucceeded,e)),n.complete()})).catch((e=>{n.error((0,d.fQ)(vp.LoadShippingOptionsFailed,e))}))}))}updateAddress(e,t){return n=>{const i=this._getUpdateAddressRequestBody(e,n),r=n.getState().consignments.getConsignments();return r&&r.length&&(i.id=r[0].id),this._createOrUpdateConsignment(i,t)(n)}}createConsignments(e,t){return n=>l.c.create((i=>{const r=n.getState().checkout.getCheckout();if(!r||!r.id)throw new ne(K.MissingCheckout);i.next((0,d.VP)(vp.CreateConsignmentsRequested)),this._consignmentRequestSender.createConsignments(r.id,e,t).then((({body:e})=>{i.next((0,d.VP)(vp.CreateConsignmentsSucceeded,e)),i.complete()})).catch((e=>{i.error((0,d.fQ)(vp.CreateConsignmentsFailed,e))}))}))}updateConsignment(e,t){return n=>l.c.create((i=>{const r=n.getState().checkout.getCheckout();if(!r||!r.id)throw new ne(K.MissingCheckout);const o={id:e.id};i.next((0,d.VP)(vp.UpdateConsignmentRequested,void 0,o)),this._consignmentRequestSender.updateConsignment(r.id,e,t).then((({body:e})=>{i.next((0,d.VP)(vp.UpdateConsignmentSucceeded,e,o)),i.complete()})).catch((e=>{i.error((0,d.fQ)(vp.UpdateConsignmentFailed,e,o))}))}))}deleteConsignment(e,t){return n=>l.c.create((i=>{const r=n.getState().checkout.getCheckout(),o={id:e};if(!r||!r.id)throw new ne(K.MissingCheckout);i.next((0,d.VP)(vp.DeleteConsignmentRequested,void 0,o)),this._consignmentRequestSender.deleteConsignment(r.id,e,t).then((({body:e})=>{i.next((0,d.VP)(vp.DeleteConsignmentSucceeded,e,o)),i.complete()})).catch((e=>{i.error((0,d.fQ)(vp.DeleteConsignmentFailed,e,o))}))}))}updateShippingOption(e,t){return n=>l.c.create((i=>{var r;const o=n.getState().checkout.getCheckout(),a=n.getState().consignments.getConsignmentById(e.id);if((null===(r=null==a?void 0:a.selectedShippingOption)||void 0===r?void 0:r.id)===e.shippingOptionId)return void i.complete();if(!o||!o.id)throw new ne(K.MissingCheckout);const s={id:e.id};i.next((0,d.VP)(vp.UpdateShippingOptionRequested,void 0,s)),this._consignmentRequestSender.updateConsignment(o.id,e,t).then((({body:e})=>{i.next((0,d.VP)(vp.UpdateShippingOptionSucceeded,e,s)),i.complete()})).catch((e=>{i.error((0,d.fQ)(vp.UpdateShippingOptionFailed,e,s))}))}))}_createOrUpdateConsignment(e,t){return n=>{const i=n.getState().checkout.getCheckout();if(!i||!i.id)throw new ne(K.MissingCheckout);return this._isUpdateConsignmentRequest(e)?this.updateConsignment(e,t)(n):this.createConsignments([e],t)(n)}}_getUpdateAddressRequestBody(e,t){const n=t.getState().cart.getCart();if(!n)throw new ne(K.MissingCart);const{physicalItems:i,customItems:r=[]}=n.lineItems;return{address:e,lineItems:[...i,...r].map((e=>({itemId:e.id,quantity:e.quantity})))}}_removeLineItems(e,t,n){if(!n)throw new ne(K.MissingCart);return this._hydrateLineItems(t.lineItemIds,n).map((t=>{const n=(0,c.find)(e,(e=>e.itemId===t.itemId));return Object.assign(Object.assign({},t),{quantity:n?t.quantity-n.quantity:t.quantity})})).filter((e=>e.quantity>0))}_addLineItems(e,t,n){if(!t)return e;if(!n)throw new ne(K.MissingCart);return e.concat(this._hydrateLineItems(t.lineItemIds,n)).filter((e=>e.quantity>0))}_hydrateLineItems(e,t){return e.map((e=>{const n=(0,c.find)(t.lineItems.physicalItems,(t=>t.id===e));return{itemId:e,quantity:n?n.quantity:0}}))}_isUpdateConsignmentRequest(e){return!!e.id}_consignmentHasAddress(e){return"object"==typeof e&&"address"in e}}const Sp=["consignments.availableShippingOptions","cart.lineItems.physicalItems.options","cart.lineItems.digitalItems.options","customer","promotions.banners"];class Cp{constructor(e){this._requestSender=e}createConsignments(e,t,{timeout:n,params:{include:i}={}}={}){const r=`/api/storefront/checkouts/${e}/consignments`,o=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.post(r,{body:t,params:{include:nt(Sp,i)},headers:o,timeout:n}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}updateConsignment(e,t,{timeout:n,params:{include:i}={}}={}){const{id:r}=t,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["id"]),a=`/api/storefront/checkouts/${e}/consignments/${r}`,s=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.put(a,{body:o,params:{include:nt(Sp,i)},headers:s,timeout:n}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}deleteConsignment(e,t,{timeout:n}={}){const i=`/api/storefront/checkouts/${e}/consignments/${t}`,r=Object.assign({Accept:ae.JsonV1},se),o=je(Sp);return this._requestSender.delete(i,{params:{include:o},headers:r,timeout:n}).catch((e=>{if("empty_cart"===e.body.type)throw new oe;throw e}))}}var wp,_p,Ip;!function(e){e.LoadShippingCountriesRequested="LOAD_SHIPPING_COUNTRIES_REQUESTED",e.LoadShippingCountriesSucceeded="LOAD_SHIPPING_COUNTRIES_SUCCEEDED",e.LoadShippingCountriesFailed="LOAD_SHIPPING_COUNTRIES_FAILED"}(wp||(wp={}));class Pp{constructor(e,t){this._shippingCountryRequestSender=e,this._store=t}loadCountries(e){const{checkout:t}=this._store.getState(),n=t.getCheckout(),i=n?n.channelId:null;return l.c.create((t=>{t.next((0,d.VP)(wp.LoadShippingCountriesRequested)),this._shippingCountryRequestSender.loadCountries(i,e).then((e=>{t.next((0,d.VP)(wp.LoadShippingCountriesSucceeded,e.body.data)),t.complete()})).catch((e=>{t.error((0,d.fQ)(wp.LoadShippingCountriesFailed,e))}))}))}}class Ep{constructor(e,t){this._requestSender=e,this._config=t}loadCountries(e,{timeout:t}={}){const n="/internalapi/v1/shipping/countries"+(e?`?channel_id=${e}`:""),i=Object.assign({"Accept-Language":this._config.locale},se);return this._requestSender.get(n,{headers:i,timeout:t})}}!function(e){e.ApplyStoreCreditRequested="APPLY_STORE_CREDIT_REQUESTED",e.ApplyStoreCreditSucceeded="APPLY_STORE_CREDIT_SUCCEEDED",e.ApplyStoreCreditFailed="APPLY_STORE_CREDIT_FAILED"}(_p||(_p={}));class Op{constructor(e){this._storeCreditRequestSender=e}applyStoreCredit(e,t){return n=>(0,m.x)((0,b.of)((0,d.VP)(_p.ApplyStoreCreditRequested)),(0,p.v)((()=>{return i=this,o=function*(){const i=n.getState().checkout.getCheckout();if(!i)throw new ne(K.MissingCheckout);const{body:r}=yield e?this._storeCreditRequestSender.applyStoreCredit(i.id,t):this._storeCreditRequestSender.removeStoreCredit(i.id,t);return(0,d.VP)(_p.ApplyStoreCreditSucceeded,r)},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{s(o.next(e))}catch(e){t(e)}}function a(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,a)}s((o=o.apply(i,[])).next())}));var i,r,o}))).pipe((0,C.W)((e=>ee(_p.ApplyStoreCreditFailed,e))))}}class Ap{constructor(e){this._requestSender=e}applyStoreCredit(e,{timeout:t}={}){const n=`/api/storefront/checkouts/${e}/store-credit`,i=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.post(n,{headers:i,timeout:t,params:{include:je(Te)}})}removeStoreCredit(e,{timeout:t}={}){const n=`/api/storefront/checkouts/${e}/store-credit`,i=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.delete(n,{headers:i,timeout:t,params:{include:je(Te)}})}}!function(e){e.UpdateSubscriptionsRequested="UPDATE_SUBSCRIPTIONS_REQUESTED",e.UpdateSubscriptionsSucceeded="UPDATE_SUBSCRIPTIONS_SUCCEEDED",e.UpdateSubscriptionsFailed="UPDATE_SUBSCRIPTIONS_FAILED"}(Ip||(Ip={}));class kp extends Ie{constructor(e){super(e),this.name="UpdateSubscriptionsError",this.type="update_subscriptions"}}class Tp{constructor(e){this._subscriptionsRequestSender=e}updateSubscriptions(e,t){return(0,m.x)((0,b.of)((0,d.VP)(Ip.UpdateSubscriptionsRequested)),(0,p.v)((()=>{return n=this,r=function*(){const{body:n}=yield this._subscriptionsRequestSender.updateSubscriptions(e,t);return(0,d.VP)(Ip.UpdateSubscriptionsSucceeded,n)},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}))).pipe((0,C.W)((e=>ee(Ip.UpdateSubscriptionsFailed,new kp(e)))))}}class Np{constructor(e){this._requestSender=e}updateSubscriptions(e,{timeout:t}={}){const n=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.post("/api/storefront/subscriptions",{body:e,headers:n,timeout:t})}}function Mp(e){return(0,c.isPlainObject)(e)}const xp=(0,c.memoize)((e=>Array.isArray(e)?e.map((e=>Dp(e))):Mp(e)?Object.keys(e).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Dp(e[n])})),{}):e));xp.cache=new WeakMap;const Dp=e=>"object"==typeof e&&null!==e?xp(e):e;function zp(e){return(...t)=>Dp(e(...t))}function Fp({billingAddress:{getBillingAddress:e,getBillingAddressOrThrow:t},cart:{getCart:n,getCartOrThrow:i},checkout:{getCheckout:r,getCheckoutOrThrow:o,getOutstandingBalance:a},config:{getContextConfig:s,getHost:d,getLocale:c,getStoreConfig:l,getStoreConfigOrThrow:u,getConfig:h},consignments:{getConsignments:m,getConsignmentsOrThrow:p},countries:{getCountries:y},customer:{getCustomer:g,getCustomerOrThrow:v},instruments:{getCardInstrument:f,getCardInstrumentOrThrow:b,getInstruments:S,getInstrumentsMeta:C},order:{getOrder:w,getOrderOrThrow:_,getOrderMeta:I},payment:{getPaymentToken:P,getPaymentTokenOrThrow:E,getPaymentId:O,getPaymentIdOrThrow:A,getPaymentStatus:k,getPaymentStatusOrThrow:T,getPaymentRedirectUrl:N,getPaymentRedirectUrlOrThrow:M,isPaymentDataRequired:x},paymentMethods:{getPaymentMethod:D,getPaymentMethodOrThrow:z,getPaymentMethodsMeta:F},paymentProviderCustomer:{getPaymentProviderCustomer:B,getPaymentProviderCustomerOrThrow:R},paymentStrategies:{isInitialized:L},shippingAddress:{getShippingAddress:j,getShippingAddressOrThrow:U,getShippingAddresses:V,getShippingAddressesOrThrow:q},shippingCountries:{getShippingCountries:H}}){return{getHost:zp(d),getLocale:zp(c),getBillingAddress:zp(e),getBillingAddressOrThrow:zp(t),getCart:zp(n),getCartOrThrow:zp(i),getCheckout:zp(r),getCheckoutOrThrow:zp(o),getCountries:zp(y),getStoreConfig:zp(l),getStoreConfigOrThrow:zp(u),getConfig:zp(h),getConsignments:zp(m),getConsignmentsOrThrow:zp(p),getContextConfig:zp(s),getCustomer:zp(g),getCustomerOrThrow:zp(v),getCardInstrument:zp(f),getInstruments:zp(S),getCardInstrumentOrThrow:zp(b),getOrder:zp(w),getOrderOrThrow:zp(_),getOrderMeta:zp(I),getInstrumentsMeta:zp(C),getPaymentToken:P,getPaymentTokenOrThrow:E,getPaymentId:O,getPaymentIdOrThrow:A,getPaymentStatus:k,getPaymentStatusOrThrow:T,getPaymentRedirectUrl:N,getPaymentRedirectUrlOrThrow:M,getPaymentMethod:zp(D),getPaymentMethodOrThrow:zp(z),getPaymentMethodsMeta:zp(F),getPaymentProviderCustomer:zp(B),getPaymentProviderCustomerOrThrow:zp(R),getShippingAddress:zp(j),getShippingAddressOrThrow:zp(U),getShippingAddresses:zp(V),getShippingAddressesOrThrow:zp(q),getShippingCountries:zp(H),getOutstandingBalance:zp(a),isPaymentDataRequired:x,isPaymentMethodInitialized:L}}var Bp=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Rp{constructor(e,t,n,i,r,o,a,s,d,c,l,u,h,m,p,y,g,v,f,b){this._store=e,this._storeProjectionFactory=t,this._checkoutActionCreator=n,this._checkoutValidator=i,this._hostedFormFactory=r,this._orderActionCreator=o,this._billingAddressActionCreator=a,this._consignmentActionCreator=s,this._paymentMethodActionCreator=d,this._paymentActionCreator=c,this._paymentHumanVerificationHandler=l,this._customerActionCreator=u,this._cartRequestSender=h,this._storeCreditActionCreator=m,this._couponActionCreator=p,this._spamProtectionActionCreator=y,this._paymentProviderCustomerActionCreator=g,this._shippingCountryActionCreator=v,this._remoteCheckoutActionCreator=f,this._paymentStrategyWidgetActionCreator=b,this._storeProjection=this._storeProjectionFactory.create(this._store)}createHostedForm(e,t){const n=this._storeProjection.getState().getCheckoutOrThrow().id;return this._hostedFormFactory.create(e,t,n)}subscribe(e,...t){return this._storeProjection.subscribe(e,...t)}getState(){return this._storeProjection.getState()}initializeOffsitePayment(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._paymentActionCreator.initializeOffsitePayment(e)),this._storeProjection.getState()}))}loadCheckout(e){return Bp(this,void 0,void 0,(function*(){return e?yield this._store.dispatch(this._checkoutActionCreator.loadCheckout(e)):yield this._store.dispatch(this._checkoutActionCreator.loadCurrentCheckout()),this._storeProjection.getState()}))}loadDefaultCheckout(){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._checkoutActionCreator.loadDefaultCheckout()),this._storeProjection.getState()}))}loadPaymentMethod(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(e,t)),this._storeProjection.getState()}))}loadPaymentMethods(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethods(e)),this._storeProjection.getState()}))}submitOrder(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._orderActionCreator.submitOrder(e,t)),this._storeProjection.getState()}))}submitPayment(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._paymentActionCreator.submitPayment(e)),this._storeProjection.getState()}))}finalizeOrder(e){return Bp(this,void 0,void 0,(function*(){const{order:{getOrderOrThrow:t}}=this._store.getState();return yield this._store.dispatch(this._orderActionCreator.finalizeOrder(t().orderId,e)),this._storeProjection.getState()}))}updateBillingAddress(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._billingAddressActionCreator.updateAddress(e)),this._storeProjection.getState()}))}updateShippingAddress(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._consignmentActionCreator.updateAddress(e)),this._storeProjection.getState()}))}selectShippingOption(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._consignmentActionCreator.selectShippingOption(e,t)),this._storeProjection.getState()}))}signInCustomer(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._customerActionCreator.signInCustomer(e,t)),this._storeProjection.getState()}))}signOutCustomer(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._customerActionCreator.signOutCustomer(e)),this._storeProjection.getState()}))}createBuyNowCart(e,t){return Bp(this,void 0,void 0,(function*(){const{body:n}=yield this._cartRequestSender.createBuyNowCart(e,t);return n}))}applyStoreCredit(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._storeCreditActionCreator.applyStoreCredit(e,t)),this._storeProjection.getState()}))}applyCoupon(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._couponActionCreator.applyCoupon(e,t)),this._storeProjection.getState()}))}removeCoupon(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._couponActionCreator.removeCoupon(e,t)),this._storeProjection.getState()}))}verifyCheckoutSpamProtection(){return Bp(this,void 0,void 0,(function*(){const{checkout:e}=this._store.getState(),{shouldExecuteSpamCheck:t}=e.getCheckoutOrThrow();return t&&(yield this._store.dispatch(this._spamProtectionActionCreator.verifyCheckoutSpamProtection())),this._storeProjection.getState()}))}loadCurrentOrder(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._orderActionCreator.loadCurrentOrder(e)),this._storeProjection.getState()}))}updatePaymentProviderCustomer(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._paymentProviderCustomerActionCreator.updatePaymentProviderCustomer(e)),this._storeProjection.getState()}))}loadShippingCountries(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._shippingCountryActionCreator.loadCountries(e)),this._storeProjection.getState()}))}deleteConsignment(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._consignmentActionCreator.deleteConsignment(e,t)),this._storeProjection.getState()}))}initializePayment(e,t,n){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._remoteCheckoutActionCreator.initializePayment(e,t,n)),this._storeProjection.getState()}))}forgetCheckout(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._remoteCheckoutActionCreator.forgetCheckout(e,t)),this._storeProjection.getState()}))}remoteCheckoutSignOut(e,t){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._remoteCheckoutActionCreator.signOut(e,t)),this._storeProjection.getState()}))}validateCheckout(e,t){return Bp(this,void 0,void 0,(function*(){yield this._checkoutValidator.validate(e,t)}))}handlePaymentHumanVerification(e,t){return Bp(this,void 0,void 0,(function*(){return"string"==typeof e?this._paymentHumanVerificationHandler.handle(e,null!=t?t:""):this._paymentHumanVerificationHandler.handle(e)}))}widgetInteraction(e){return Bp(this,void 0,void 0,(function*(){return yield this._store.dispatch(this._paymentStrategyWidgetActionCreator.widgetInteraction(e),{queueId:"widgetInteraction"}),this._storeProjection.getState()}))}}class Lp{constructor(e){this._transformSelectors=e}create(e){return he(e,this._transformSelectors)}}function jp(e){const{config:{getHost:t,getLocale:n}}=e.getState(),i=(0,a.createRequestSender)({host:t()}),r=new Lp(Fp),o=new rt(new it(i),new we(new Oe(i)),new ot(new at(i))),d=new Em(new it(i)),c=new $m(e),l=new vm(new ym(i),new Em(new it(i))),u=new re(new ce(i),new Tp(new Np(i))),h=new bp(new Cp(i),new it(i)),m=new dt(new ct(i)),p=new Ym(new Km(fm(e)),l,new yp,new xm(Et((0,s.Hb)()))),y=new xm(Et((0,s.Hb)())),g=new Qe(new Je(i),o,new St(Et((0,s.Hb)()),new Ot(i))),v=new Op(new Ap(i)),f=new ke(new Ue(i)),b=Et((0,s.Hb)()),S=new Ot(i),C=new St(b,S),w=new Wm(i),_=new fp,I=new Pp(new Ep(i,{locale:n()}),e),P=new yt(new pt(i),o),E=new wm;return new Rp(e,r,o,d,c,l,u,h,m,p,y,g,w,v,f,C,_,I,P,E)}const Up=e=>{const{type:t,initializationStrategy:n}=e;return t===Cm.PPSDK&&"string"==typeof(null==n?void 0:n.type)};class Vp extends We{getByMethod(e){if(!e)return this.get();const t=this._getToken(e),n=[e.gateway,e.id].filter((e=>null!=e)).join("-");return this.get(t,n)}_getToken(e){if(Up(e))return Cm.PPSDK;if("klarna"===e.gateway)return Cm.KLARNAV2;const t=e.gateway||e.id;if(this._hasFactoryForMethod(t))return t;if("PAYMENT_TYPE_OFFLINE"===e.type)return Cm.OFFLINE;throw new $e(`'${t}' is not registered.`)}_hasFactoryForMethod(e){return this._hasFactory(e)}}class qp extends $e{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}var Hp=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};class Gp{constructor(e,t,n,i){this._store=e,this._orderActionCreator=t,this._paymentActionCreator=n,this._hostedFormFactory=i}execute(e,t){var n,i;return this._isHostedPaymentFormEnabled(null===(n=e.payment)||void 0===n?void 0:n.methodId,null===(i=e.payment)||void 0===i?void 0:i.gatewayId)&&this._shouldRenderHostedForm?this._executeWithHostedForm(e,t):this._executeWithoutHostedForm(e,t)}finalize(e){return Promise.reject(new Sm)}initialize(e){if(!this._isHostedPaymentFormEnabled(null==e?void 0:e.methodId,null==e?void 0:e.gatewayId)||!this._isHostedFieldAvailable(e))return this._shouldRenderHostedForm=!1,Promise.resolve(this._store.getState());const t=e&&e.creditCard&&e.creditCard.form,{config:n}=this._store.getState(),{paymentSettings:{bigpayBaseUrl:i=""}={}}=n.getStoreConfig()||{};if(!t)throw new $e;const r=this._hostedFormFactory.create(i,t);return r.attach().then((()=>(this._shouldRenderHostedForm=!0,this._hostedForm=r,this._store.getState())))}deinitialize(e){return this._hostedForm&&this._hostedForm.detach(),Promise.resolve(this._store.getState())}_executeWithoutHostedForm(e,t){const{payment:n}=e,i=Hp(e,["payment"]),r=n&&n.paymentData;if(!n||!r)throw new qp(["payment.paymentData"]);return this._store.dispatch(this._orderActionCreator.submitOrder(i,t)).then((()=>this._store.dispatch(this._paymentActionCreator.submitPayment(Object.assign(Object.assign({},n),{paymentData:r})))))}_executeWithHostedForm(e,t){const{payment:n}=e,i=Hp(e,["payment"]),r=this._hostedForm;if(!r)throw new wt(ft.PaymentNotInitialized);if(!n||!n.methodId)throw new qp(["payment.methodId"]);return r.validate().then((()=>this._store.dispatch(this._orderActionCreator.submitOrder(i,t)))).then((()=>r.submit(n))).then((()=>this._store.dispatch(this._orderActionCreator.loadCurrentOrder())))}_isHostedPaymentFormEnabled(e,t){if(!e)return!1;const{paymentMethods:{getPaymentMethodOrThrow:n}}=this._store.getState();return!0===n(e,t).config.isHostedFormEnabled}_isHostedFieldAvailable(e){return!(0,c.values)(e&&e.creditCard&&e.creditCard.form.fields).every(c.isNil)}}var $p=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Wp extends Gp{constructor(e,t,n,i,r){super(e,t,n,i),this._threeDSecureFlow=r}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return $p(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const{paymentMethods:{getPaymentMethodOrThrow:n}}=this._store.getState(),i=n(e.methodId);return i.config.is3dsEnabled&&(yield this._threeDSecureFlow.prepare(i)),this._store.getState()}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return $p(this,void 0,void 0,(function*(){const{payment:{methodId:i=""}={}}=e,{paymentMethods:{getPaymentMethodOrThrow:r}}=this._store.getState();return r(i).config.is3dsEnabled?this._threeDSecureFlow.start(n.execute.bind(this),e,t,this._hostedForm):n.execute.call(this,e,t)}))}}var Yp=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Kp extends Gp{constructor(e,t,n,i,r){super(e,t,n,i),this._threeDSecureFlow=r}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return Yp(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const{paymentMethods:{getPaymentMethodOrThrow:n}}=this._store.getState(),i=n(e.methodId);return i.config.is3dsEnabled&&(yield this._threeDSecureFlow.prepare(i)),this._store.getState()}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return Yp(this,void 0,void 0,(function*(){if(!e.payment)throw new qp(["payment.methodId"]);const{methodId:i}=e.payment;if(!i)throw new qp(["payment.methodId"]);const{paymentMethods:{getPaymentMethodOrThrow:r}}=this._store.getState();return r(i).config.is3dsEnabled?this._threeDSecureFlow.start(n.execute.bind(this),e,t,this._hostedForm):n.execute.call(this,e,t)}))}}class Qp{constructor(e,t,n,i,r,o,a,s){this._store=e,this._checkoutActionCreator=t,this._paymentMethodActionCreator=n,this._paymentStrategyActionCreator=i,this._paymentActionCreator=r,this._orderActionCreator=o,this._braintreeVisaCheckoutPaymentProcessor=a,this._visaCheckoutScriptLoader=s}initialize(e){const{braintreevisacheckout:t,methodId:n}=e;if(!t)throw new $e('Unable to initialize payment because "options.braintreevisacheckout" argument is not provided.');return this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(n)).then((e=>{this._paymentMethod=e.paymentMethods.getPaymentMethod(n);const i=e.checkout.getCheckout(),r=e.config.getStoreConfig();if(!i)throw new ne(K.MissingCheckout);if(!r)throw new ne(K.MissingCheckoutConfig);const{clientToken:o,config:a}=this._paymentMethod||{};if(!o)throw new ne(K.MissingPaymentMethod);const{onError:s=c.noop,onPaymentSelect:d=c.noop}=t,l={locale:r.storeProfile.storeLanguage,collectShipping:!1,subtotal:i.subtotal,currencyCode:r.currency.code};return Promise.all([this._visaCheckoutScriptLoader.load(null==a?void 0:a.testMode),this._braintreeVisaCheckoutPaymentProcessor.initialize(o,l)]).then((([e,t])=>{e.init(t),e.on("payment.success",(e=>this._paymentInstrumentSelected(e).then((()=>d())).catch((e=>s(e))))),e.on("payment.error",((e,t)=>s(t)))}))})).then((()=>this._store.getState()))}execute(e,t){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]);if(!n)throw new $e('Unable to submit payment because "payload.payment" argument is not provided.');if(!this._paymentMethod||!this._paymentMethod.initializationData||!this._paymentMethod.initializationData.nonce)throw new ne(K.MissingPaymentMethod);const{nonce:r}=this._paymentMethod.initializationData;return this._store.dispatch(this._orderActionCreator.submitOrder(i,t)).then((()=>this._store.dispatch(this._paymentActionCreator.submitPayment(Object.assign(Object.assign({},n),{paymentData:{nonce:r}}))))).catch((e=>this._handleError(e)))}finalize(){return Promise.reject(new Sm)}deinitialize(){return this._braintreeVisaCheckoutPaymentProcessor.deinitialize().then((()=>this._store.getState()))}_paymentInstrumentSelected(e){const t=this._store.getState();if(!this._paymentMethod)throw new Error("Payment method not initialized");const{id:n}=this._paymentMethod;return this._store.dispatch(this._paymentStrategyActionCreator.widgetInteraction((()=>this._braintreeVisaCheckoutPaymentProcessor.handleSuccess(e,t.shippingAddress.getShippingAddress(),t.billingAddress.getBillingAddress()).then((()=>Promise.all([this._store.dispatch(this._checkoutActionCreator.loadCurrentCheckout()),this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(n))])))),{methodId:n}),{queueId:"widgetInteraction"})}_handleError(e){if("BraintreeError"===e.name)throw new ur(e.message);throw e}}var Jp=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Zp{constructor(e){this._braintreeScriptLoader=e,this._dataCollectors={},this._window=window}initialize(e){this._clientToken=e}getClient(){if(!this._clientToken)throw new wt(ft.PaymentNotInitialized);return this._client||(this._client=this._braintreeScriptLoader.loadClient().then((e=>e.create({authorization:this._clientToken})))),this._client}getPaypalCheckout(e,t,n){return Jp(this,void 0,void 0,(function*(){const i=yield this.getClient(),r=yield this._braintreeScriptLoader.loadPaypalCheckout(),o={client:i};return this._paypalCheckout=r.create(o,((i,r)=>{if(i)return n(i);this._window.paypal?t(r):r.loadPayPalSDK(this._getPayPalSDKConfig(e),(()=>t(r)))})),this._paypalCheckout}))}get3DS(){return this._3ds||(this._3ds=Promise.all([this.getClient(),this._braintreeScriptLoader.load3DS()]).then((([e,t])=>t.create({client:e,version:2})))),this._3ds}getDataCollector(e){const t=e&&e.paypal?"paypal":"default";let n=this._dataCollectors[t];return n||(n=Promise.all([this.getClient(),this._braintreeScriptLoader.loadDataCollector()]).then((([t,n])=>n.create(Object.assign({client:t,kount:!0},e)))).catch((e=>{if(e&&"DATA_COLLECTOR_KOUNT_NOT_ENABLED"===e.code)return{deviceData:void 0,teardown:()=>Promise.resolve()};throw e})),this._dataCollectors[t]=n),n}getVisaCheckout(){return this._visaCheckout||(this._visaCheckout=Promise.all([this.getClient(),this._braintreeScriptLoader.loadVisaCheckout()]).then((([e,t])=>t.create({client:e})))),this._visaCheckout}createHostedFields(e){return Jp(this,void 0,void 0,(function*(){const[t,n]=yield Promise.all([this.getClient(),this._braintreeScriptLoader.loadHostedFields()]);return n.create(Object.assign(Object.assign({},e),{client:t}))}))}teardown(){return Promise.all([this._teardown(this._3ds),this._teardown(this._dataCollectors.default),this._teardown(this._dataCollectors.paypal),this._teardown(this._paypalCheckout),this._teardown(this._venmoCheckout),this._teardown(this._visaCheckout)]).then((()=>{this._3ds=void 0,this._dataCollectors={},this._paypalCheckout=void 0,this._venmoCheckout=void 0,this._visaCheckout=void 0}))}_teardown(e){return e?e.then((e=>e.teardown())).catch((e=>{if("METHOD_CALLED_AFTER_TEARDOWN"!==e.code)throw e})):Promise.resolve()}_getPayPalSDKConfig(e){return Object.assign(Object.assign({currency:e.currency},e.isCreditEnabled&&{"enable-funding":"paylater"}),{components:_r.toString(),intent:e.intent,commit:!1})}}class Xp{constructor(e,t){this._braintreeSDKCreator=e,this._requestSender=t}initialize(e,t){return this._braintreeSDKCreator.initialize(e),this._braintreeSDKCreator.getVisaCheckout().then((e=>e.createInitOptions({settings:{locale:t.locale,shipping:{collectShipping:t.collectShipping}},paymentRequest:{currencyCode:t.currencyCode,subtotal:String(t.subtotal)}})))}deinitialize(){return this._braintreeSDKCreator.teardown()}handleSuccess(e,t,n){return this._braintreeSDKCreator.getVisaCheckout().then((i=>Promise.all([i.tokenize(e),this._braintreeSDKCreator.getDataCollector()]).then((([e,i])=>{const{shippingAddress:r=this._toVisaCheckoutAddress(t),billingAddress:o=this._toVisaCheckoutAddress(n)}=e;return this._postForm(Object.assign(Object.assign({},e),{shippingAddress:r,billingAddress:o}),i)}))))}_postForm(e,t){const{userData:n,billingAddress:i,shippingAddress:r,details:o}=e,{userEmail:a}=n,{deviceData:s}=t;return this._requestSender.post("/checkout.php",{headers:Object.assign({Accept:"text/html","Content-Type":"application/x-www-form-urlencoded"},se),body:{payment_type:e.type,nonce:e.nonce,provider:"braintreevisacheckout",action:"set_external_checkout",device_data:s,card_information:this._getCardInformation(o),billing_address:this._getAddress(a,i),shipping_address:this._getAddress(a,r)}})}_toVisaCheckoutAddress(e){return e?{firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phone,streetAddress:e.address1,extendedAddress:e.address2,locality:e.city,region:e.stateOrProvinceCode,countryCode:e.countryCode,postalCode:e.postalCode}:{}}_getAddress(e,t={}){return{email:e,first_name:t.firstName,last_name:t.lastName,phone_number:t.phoneNumber,address_line_1:t.streetAddress,address_line_2:t.extendedAddress,city:t.locality,state:t.region,country_code:t.countryCode,postal_code:t.postalCode}}_getCardInformation(e){return{type:e.cardType,number:e.lastTwo}}}class ey{constructor(e,t=window){this._scriptLoader=e,this._window=t}load(e){return this._scriptLoader.loadScript(`//${e?"sandbox-":""}assets.secure.checkout.visa.com/checkout-widget/resources/js/integration/v1/sdk.js`).then((()=>{if(!this._window.V)throw new lt;return this._window.V}))}}var ty=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ny{constructor(e,t,n){this._store=e,this._paymentActionCreator=t,this._cardinalClient=n}prepare(e){return ty(this,void 0,void 0,(function*(){yield this._cardinalClient.load(e.id,e.config.testMode)}))}start(e,t,n,i){var r,o,a;return ty(this,void 0,void 0,(function*(){const{instruments:{getCardInstrument:s}}=this._store.getState(),{payment:d={methodId:""}}=t,{paymentData:l={}}=d;try{return yield e(t,n)}catch(e){if(e instanceof Ie&&"additional_action_required"===e.body.status){const t=null===(o=null===(r=e.body.additional_action_required)||void 0===r?void 0:r.data)||void 0===o?void 0:o.token,n=null===(a=e.body.three_ds_result)||void 0===a?void 0:a.payer_auth_request;yield this._cardinalClient.configure(t);const u=this._getBin(l,s,i);u&&(yield this._cardinalClient.runBinProcess(u));try{return yield this._submitPayment(d,{xid:n},i)}catch(e){if(e instanceof Ie&&(0,c.some)(e.body.errors,{code:"three_d_secure_required"})){const t=e.body.three_ds_result,n=null==t?void 0:t.payer_auth_request;return yield this._cardinalClient.getThreeDSecureData(t,this._getOrderData()),yield this._submitPayment(d,{token:n},i)}throw e}}throw e}}))}_getOrderData(){const e=this._store.getState(),t=e.billingAddress.getBillingAddressOrThrow(),n=e.shippingAddress.getShippingAddress(),{cart:{currency:{code:i},cartAmount:r}}=e.checkout.getCheckoutOrThrow();return{billingAddress:t,shippingAddress:n,currencyCode:i,id:e.order.getOrderOrThrow().orderId.toString(),amount:r}}_submitPayment(e,t,n){return ty(this,void 0,void 0,(function*(){const i=(0,c.merge)({},e,{paymentData:{threeDSecure:t}});return n?(yield n.submit(i),this._store.getState()):this._store.dispatch(this._paymentActionCreator.submitPayment(i))}))}_getBin(e,t,n){const i=Hm(e)&&t(e.instrumentId),r=function(e){const t=e;return!Hm(t)&&"string"==typeof t.ccName&&"string"==typeof t.ccNumber&&"object"==typeof t.ccExpiry&&"string"==typeof t.ccExpiry.month&&"string"==typeof t.ccExpiry.year}(e)&&e.ccNumber;return(i?i.iin:n?n.getBin():r)||""}}const iy=[100004,1010,1011,1020];var ry,oy,ay,sy,dy,cy,ly;!function(e){e.Init="init",e.Complete="complete",e.Confirm="confirm"}(ry||(ry={})),function(e){e.SetupCompleted="payments.setupComplete",e.Validated="payments.validated"}(oy||(oy={})),function(e){e.Success="SUCCESS",e.NoAction="NOACTION",e.Failure="FAILURE",e.Error="ERROR"}(ay||(ay={})),function(e){e.CCA="CCA",e.Paypal="Paypal",e.Wallet="Wallet",e.VisaCheckout="VisaCheckout",e.ApplePay="ApplePay",e.DiscoverWallet="DiscoverWallet"}(sy||(sy={})),(dy||(dy={})).BinProcess="bin.process",(cy||(cy={})).CCA="cca",function(e){e.Yes="Y",e.No="N"}(ly||(ly={}));class uy{constructor(e){this._scriptLoader=e,this._provider="",this._testMode=!1,this._configurationToken=""}load(e,t=!1){return this._provider=e,this._testMode=t,this._sdk||(this._sdk=this._scriptLoader.load(e,t)),this._sdk.then((()=>{}))}configure(e){if(this._configurationToken){if(this._configurationToken===e)return Promise.resolve();this._sdk=this._scriptLoader.load(`${this._provider}.${Date.now()}`,this._testMode)}return this._getClientSDK().then((t=>new Promise(((n,i)=>{t.on(oy.SetupCompleted,(()=>{t.off(oy.SetupCompleted),t.off(oy.Validated),this._configurationToken=e,n()})),t.on(oy.Validated,(e=>{t.off(oy.SetupCompleted),t.off(oy.Validated),e.ActionCode===ay.Error&&((0,c.includes)(iy,e.ErrorNumber)&&i(new ne(K.MissingPaymentMethod)),i(new ur(e.ErrorDescription)))})),t.setup(ry.Init,{jwt:e})}))))}runBinProcess(e){return this._getClientSDK().then((t=>t.trigger(dy.BinProcess,e).catch((()=>{})))).then((e=>{if(!e||!e.Status)throw new wt(ft.PaymentNotInitialized)}))}getThreeDSecureData(e,t){return this._getClientSDK().then((n=>new Promise(((i,r)=>{n.on(oy.Validated,((e,t)=>{if(n.off(oy.Validated),!t)return r(new ur(e.ErrorDescription?e.ErrorDescription:"An error was encountered while processing the transaction."));if(!e.ActionCode)return i({token:t});switch(e.ActionCode){case ay.Success:return i({token:t});case ay.NoAction:return e.ErrorNumber>0?r(new ur(e.ErrorDescription)):e.Payment&&e.Payment.ExtendedData&&e.Payment.ExtendedData.SignatureVerification===ly.Yes?i({token:t}):r(new ur("Transaction signature could not be validated."));case ay.Failure:return r(new ur("User failed authentication or an error was encountered while processing the transaction."));case ay.Error:return r(new ur(e.ErrorDescription))}}));const o={AcsUrl:e.acs_url,Payload:e.merchant_data},a=this._mapToPartialOrder(t,e.payer_auth_request);n.continue(cy.CCA,o,a)}))))}_mapToPartialOrder(e,t){const n={BillingAddress:this._mapToCardinalAddress(e.billingAddress)};return e.paymentData&&(n.Account=this._mapToCardinalAccount(e.paymentData)),e.billingAddress.email&&(n.Email1=e.billingAddress.email),e.shippingAddress&&(n.ShippingAddress=this._mapToCardinalAddress(e.shippingAddress)),{Consumer:n,OrderDetails:{OrderNumber:e.id,Amount:e.amount,CurrencyCode:e.currencyCode,OrderChannel:"S",TransactionId:t}}}_mapToCardinalAccount(e){return{AccountNumber:Number(e.ccNumber),ExpirationMonth:Number(e.ccExpiry.month),ExpirationYear:Number(e.ccExpiry.year),NameOnAccount:e.ccName,CardCode:Number(e.ccCvv)}}_mapToCardinalAddress(e){const t={FirstName:e.firstName,LastName:e.lastName,Address1:e.address1,City:e.city,State:e.stateOrProvince,PostalCode:e.postalCode,CountryCode:e.countryCode};return e.address2&&(t.Address2=e.address2),e.phone&&(t.Phone1=e.phone),t}_getClientSDK(){if(!this._sdk)throw new wt(ft.PaymentNotInitialized);return this._sdk}}class hy{constructor(e,t=window){this._scriptLoader=e,this._window=t}load(e,t){const n=t?"https://songbirdstag.cardinalcommerce.com/edge/v1/songbird.js":"https://songbird.cardinalcommerce.com/edge/v1/songbird.js";return this._scriptLoader.loadScript(`${n}?v=${e}`).then((()=>{if(!this._window.Cardinal)throw new lt;return this._window.Cardinal}))}}class my extends te{constructor(e){super(e||"The selected payment method was declined. Please select another payment method."),this.name="PaymentMethodDeclinedError",this.type="payment_declined"}}const py="ACKNOWLEDGE",yy="FINALIZE";var gy=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class vy extends Gp{constructor(e,t,n,i,r,o,a){super(e,t,n,i),this._paymentMethodActionCreator=r,this._CBAMGPSScriptLoader=o,this._locale=a,this._sessionId=""}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return gy(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const{methodId:n}=e,i=(yield this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(n))).paymentMethods.getPaymentMethodOrThrow(n),{clientToken:r,initializationData:{isTestModeFlagEnabled:o=!1,merchantId:a},config:{is3dsEnabled:s}}=i;if(s){if(this._threeDSjs=yield this._CBAMGPSScriptLoader.load(o),!this._threeDSjs)throw new wt(ft.PaymentNotInitialized);if(!r||!a)throw new ne(K.MissingPaymentMethod);this._sessionId=r,yield this._threeDSjs.configure({merchantId:a,sessionId:this._sessionId,callback:()=>{var e;if(null===(e=this._threeDSjs)||void 0===e?void 0:e.isConfigured())return this._store.getState();throw new ur("Failed to configure 3DS API.")},configuration:{userLanguage:this._locale,wsVersion:62}})}return Promise.resolve(this._store.getState())}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return gy(this,void 0,void 0,(function*(){const{payment:i}=e,r=i&&i.paymentData;if(!i||!r)throw new qp(["payment.paymentData"]);const{paymentMethods:{getPaymentMethodOrThrow:o}}=this._store.getState(),a=o(i.methodId),{is3dsEnabled:s}=a.config;if(s){const t=Object.assign(Object.assign({},r),{threeDSecure:{token:this._sessionId}});e.payment&&(e.payment.paymentData=t)}return n.execute.call(this,e,t).catch((e=>{if(!(s&&e instanceof Ie&&(0,c.some)(e.body.errors,{code:"three_d_secure_required"})))return Promise.reject(e);const t=this._store.getState(),n=t.order.getOrder(),{storeProfile:{storeId:i}}=t.config.getStoreConfigOrThrow();if(!n||!this._sessionId)throw new ne(K.MissingCheckout);const r=`${i}_${n.orderId}`,{three_ds_result:{token:o}}=e.body;return o?this._initiateAuthentication(r,o):Promise.reject(e)}))}))}finalize(e){const t=this._store.getState(),n=t.order.getOrder();return n&&t.payment.getPaymentStatus()===yy?this._store.dispatch(this._orderActionCreator.finalizeOrder(n.orderId,e)):Promise.reject(new Sm)}deinitialize(){return this._threeDSjs=void 0,this._sessionId="",super.deinitialize()}_initiateAuthentication(e,t){return gy(this,void 0,void 0,(function*(){const n=yield new Promise(((n,i)=>{if(!this._threeDSjs)throw new wt(ft.PaymentNotInitialized);this._threeDSjs.initiateAuthentication(e,t,(e=>{const t=e.error;return t?i(new my(t.msg)):this._threeDSjs&&"PROCEED"===e.gatewayRecommendation?n(e.restApiResponse):i(new my)}))}));if(n.transaction&&"AUTHENTICATION_AVAILABLE"===n.transaction.authenticationStatus)return this._authenticatePayer(e,t);throw new my}))}_authenticatePayer(e,t,n=1){return gy(this,void 0,void 0,(function*(){return new Promise(((i,r)=>{if(!this._threeDSjs)return r(new wt(ft.PaymentNotInitialized));this._threeDSjs.authenticatePayer(e,t,(i=>gy(this,void 0,void 0,(function*(){const o=i.error;return o?o.cause&&"SERVER_BUSY"===o.cause&&n<5?(yield new Promise((e=>setTimeout(e,3e3))),this._authenticatePayer(e,t,++n)):r(new my):new Promise(c.noop)}))),{fullScreenRedirect:!0})}))}))}}class fy{constructor(e,t=window){this._scriptLoader=e,this._window=t}load(e){return t=this,i=function*(){if(yield this._scriptLoader.loadScript(`//${e?"test":"ap"}-gateway.mastercard.com/static/threeDS/1.3.0/three-ds.min.js`),!this._window.ThreeDS)throw new lt;return this._window.ThreeDS},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}}class by extends Gp{constructor(e,t,n,i,r){super(e,t,n,i),this._formPoster=r}execute(e,t){return super.execute(e,t).catch((e=>e instanceof Ie&&(0,c.some)(e.body.errors,{code:"three_d_secure_required"})?new Promise((()=>{this._formPoster.postForm(e.body.three_ds_result.acs_url,{PaReq:e.body.three_ds_result.payer_auth_request,TermUrl:e.body.three_ds_result.callback_url,MD:e.body.three_ds_result.merchant_data})})):Promise.reject(e)))}finalize(e){const t=this._store.getState(),n=t.order.getOrder();return n&&t.payment.getPaymentStatus()===yy?this._store.dispatch(this._orderActionCreator.finalizeOrder(n.orderId,e)):Promise.reject(new Sm)}}class Sy{constructor(e,t,n,i,r){this._store=e,this._orderActionCreator=t,this._paymentActionCreator=n,this._masterpassScriptLoader=i,this._locale=r}initialize(e){const{methodId:t}=e;if(this._paymentMethod=this._store.getState().paymentMethods.getPaymentMethod(t),!this._paymentMethod)throw new ne(K.MissingPaymentMethod);const n={useMasterpassSrc:this._paymentMethod.initializationData.isMasterpassSrcEnabled,language:Mt(this._locale),testMode:this._paymentMethod.config.testMode,checkoutId:this._paymentMethod.initializationData.checkoutId};return this._masterpassScriptLoader.load(n).then((t=>{if(this._masterpassClient=t,!e.masterpass)throw new $e('Unable to initialize payment because "options.masterpass" argument is not provided.');const n=e.masterpass.walletButton&&document.getElementById(e.masterpass.walletButton);return n&&(this._walletButton=n,this._walletButton.addEventListener("click",this._handleWalletButtonClick)),this._store.getState()}))}deinitialize(){return this._paymentMethod=void 0,this._walletButton&&this._walletButton.removeEventListener("click",this._handleWalletButtonClick),this._walletButton=void 0,this._masterpassClient=void 0,Promise.resolve(this._store.getState())}execute(e,t){const{payment:n}=e,i={useStoreCredit:e.useStoreCredit};if(!n)throw new $e('Unable to submit payment because "payload.payment" argument is not provided.');if(!this._paymentMethod||!this._paymentMethod.initializationData||!this._paymentMethod.initializationData.gateway)throw new ne(K.MissingPaymentMethod);const r=this._paymentMethod.initializationData.paymentData;if(!r)throw new $e('Unable to proceed because "paymentMethod.initializationData.paymentData" argument is not provided.');return this._store.dispatch(this._orderActionCreator.submitOrder(i,t)).then((()=>this._store.dispatch(this._paymentActionCreator.submitPayment(Object.assign(Object.assign({},n),{paymentData:r})))))}finalize(){return Promise.reject(new Sm)}_createMasterpassPayload(){const e=this._store.getState(),t=e.checkout.getCheckout(),n=e.config.getStoreConfig();if(!t)throw new ne(K.MissingCheckout);if(!n)throw new ne(K.MissingCheckoutConfig);if(!this._paymentMethod||!this._paymentMethod.initializationData)throw new ne(K.MissingPaymentMethod);return{checkoutId:this._paymentMethod.initializationData.checkoutId,allowedCardTypes:this._paymentMethod.initializationData.allowedCardTypes,amount:t.subtotal.toFixed(2),currency:n.currency.code,cartId:t.cart.id,callbackUrl:Tt("checkout")}}_handleWalletButtonClick(e){if(e.preventDefault(),!this._masterpassClient)return;const t=this._createMasterpassPayload();this._masterpassClient.checkout(t)}}!function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);o>3&&a&&Object.defineProperty(t,n,a)}([Zt],Sy.prototype,"_handleWalletButtonClick",null);class Cy{constructor(e,t,n,i=window){this._store=e,this._orderActionCreator=t,this._scriptLoader=n,this._window=i,this._useRedirectFlow=!1}initialize(e){const t=this._store.getState();return this._paymentMethod=t.paymentMethods.getPaymentMethod(e.methodId),this._useRedirectFlow=!0===(e.paypalexpress&&e.paypalexpress.useRedirectFlow),this._isInContextEnabled()?this._scriptLoader.loadPaypal().then((e=>{if(this._paypalSdk=e,!this._paymentMethod||!this._paymentMethod.config.merchantId)throw new ne(K.MissingPaymentMethod);this._paypalSdk.checkout.setup(this._paymentMethod.config.merchantId,{button:"paypal-button",environment:this._paymentMethod.config.testMode?"sandbox":"production"})})).then((()=>this._store.getState())):Promise.resolve(this._store.getState())}deinitialize(){return this._isInContextEnabled()&&this._paypalSdk&&(this._paypalSdk.checkout.closeFlow(),this._paypalSdk=void 0),Promise.resolve(this._store.getState())}execute(e,t){const n=this._paypalSdk;if(this._isAcknowledgedOrFinalized())return this._store.dispatch(this._orderActionCreator.submitOrder(e,t));if(!this._isInContextEnabled()||this._useRedirectFlow)return this._store.dispatch(this._orderActionCreator.submitOrder(e,t)).then((e=>{const t=e.payment.getPaymentRedirectUrl();return t&&this._window.top&&(this._window.top.location.href=t),new Promise(c.noop)}));if(!n)throw new wt(ft.PaymentNotInitialized);return n.checkout.initXO(),this._store.dispatch(this._orderActionCreator.submitOrder(e,t)).then((e=>{const t=e.payment.getPaymentRedirectUrl();return t&&n.checkout.startFlow(t),new Promise(c.noop)})).catch((e=>(n.checkout.closeFlow(),Promise.reject(e))))}finalize(e){const t=this._store.getState().order.getOrder();return t&&this._isAcknowledgedOrFinalized()?this._store.dispatch(this._orderActionCreator.finalizeOrder(t.orderId,e)):Promise.reject(new Sm)}_isAcknowledgedOrFinalized(){const e=this._store.getState();return e.payment.getPaymentStatus()===py||e.payment.getPaymentStatus()===yy}_isInContextEnabled(){return!(!this._paymentMethod||!this._paymentMethod.config.merchantId)}}class wy{constructor(e){this._scriptLoader=e,this._window=window}loadPaypal(e=""){return t=this,i=function*(){const t="//www.paypalobjects.com/api/checkout.min.js",n={async:!0,attributes:{"data-merchant-id":e}};if(e?yield this._scriptLoader.loadScript(t,n):yield this._scriptLoader.loadScript(t),!this._window.paypal)throw new lt;return this._window.paypal},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}}class _y extends te{constructor(e){super(e||"Payment process was cancelled."),this.name="PaymentMethodCancelledError",this.type="payment_cancelled"}}const Iy="redirecting";class Py{constructor(){this._isRedirecting=this.currentUrlHasRedirectingParam()}isRedirecting(){return this._isRedirecting}setRedirecting(e){e?this.setRedirectingParamOnUrl():this.removeRedirectingParamFromUrl(),this._isRedirecting=e}currentUrlHasRedirectingParam(){return Iy in this.getCurrentUrl().query}getCurrentUrl(){return(0,F.parseUrl)(window.location.href)}replaceCurrentUrl(e){window.history.replaceState(null,"",e)}setRedirectingParamOnUrl(){if(this.currentUrlHasRedirectingParam())return;const e=this.getCurrentUrl(),t=Object.assign(Object.assign({},e),{query:Object.assign(Object.assign({},e.query),{[Iy]:"true"})});this.replaceCurrentUrl((0,F.stringifyUrl)(t))}removeRedirectingParamFromUrl(){this.currentUrlHasRedirectingParam()&&this.replaceCurrentUrl((0,F.exclude)(window.location.href,[Iy]))}}const Ey=(0,c.overSome)([e=>"continue"===(0,c.get)(e,"type")&&"redirect"===(0,c.get)(e,"code")&&(e=>{const t=(0,c.get)(e,"form_fields");return(0,c.isString)((0,c.get)(e,"url"))&&((0,c.isUndefined)(t)||(0,c.isObject)(t))})((0,c.get)(e,"parameters")),e=>"continue"===(0,c.get)(e,"type")&&"resubmit_with_human_verification"===(0,c.get)(e,"code")&&(e=>{const t=(0,c.get)(e,"available_methods");return(0,c.isArray)(t)})((0,c.get)(e,"parameters"))]);class Oy{constructor(e,t){this._formPoster=e,this._humanVerificationHandler=t}handle(e,t){switch(e.code){case"redirect":return(({url:e,form_fields:t},n)=>{const i=new Py;return i.isRedirecting()?(i.setRedirecting(!1),Promise.reject(new _y)):(i.setRedirecting(!0),t?n.postForm(e,t):window.location.assign(e),new Promise(c.noop))})(e.parameters,this._formPoster);case"resubmit_with_human_verification":return(({available_methods:e},t,n)=>{return r=function*(){if(!n)throw new Error("PPSDK human verification callback function is missing.");if(!t)throw new Error("PPSDK human verification handler is missing.");if(0===e.length)throw Error("Human verification method is missing.");const{id:i,parameters:r}=e[0],o=yield t.handle(i,r.key);return n(o)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{a(r.next(e))}catch(e){t(e)}}function o(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,o)}a((r=r.apply(undefined,[])).next())}));var i,r})(e.parameters,this._humanVerificationHandler,null==t?void 0:t.humanVerification)}}}class Ay{constructor(e){this._continueHandler=e}handle(e,t){const{body:n}=e;return(e=>"success"===(0,c.get)(e,"type"))(n)?Promise.resolve():(e=>Ey(e))(n)?this._continueHandler.handle(n,null==t?void 0:t.continue):(e=>"failure"===(0,c.get)(e.body,"type")&&(0,c.isString)((0,c.get)(e.body,"code")))(e)?(e=>{return Promise.reject(new Ie((t=e,Object.assign(Object.assign({},t),{body:{errors:[{code:t.body.code}]}}))));var t})(e):((e=>{(0,c.get)(e.body,"type")})(e),(e=>Promise.reject(new Ie(e)))(e))}}const ky="completed-payments";class Ty{constructor(e){this._browserStorage=e}isCompleted(e){return this.getCompletedPayments().indexOf(e)>=0}setCompleted(e){const t=this.getCompletedPayments();t.push(e),this.setCompletedPayments(t)}getCompletedPayments(){return this._browserStorage.getItem(ky)||[]}setCompletedPayments(e){this._browserStorage.setItem(ky,e)}}var Ny,My=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class xy{constructor(e,t,n,i,r){this._store=e,this._orderActionCreator=t,this._subStrategyRegistry=n,this._paymentResumer=i,this._completedPayments=new Ty(r)}execute(e,t){var n;return My(this,void 0,void 0,(function*(){const{bigpayBaseUrl:i}=this._store.getState().config.getStoreConfigOrThrow().paymentSettings;if(!(null==t?void 0:t.methodId))throw new $e('Unable to submit payment because "options.methodId" argument is not provided.');const{methodId:r}=t,{payment:o}=e,a=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["payment"]),{_subStrategy:s}=this;if(!s)throw new wt(ft.PaymentNotInitialized);yield this._store.dispatch(this._orderActionCreator.submitOrder(a,t));const d=null===(n=this._store.getState().order.getOrderMeta())||void 0===n?void 0:n.token;if(!d)throw new ne(K.MissingOrder);return yield s.execute({methodId:r,payment:o,bigpayBaseUrl:i,token:d}),this._store.getState()}))}finalize(e){return My(this,void 0,void 0,(function*(){const t=this._store.getState().order.getOrderOrThrow();if(t.isComplete)return this._store.getState();const{bigpayBaseUrl:n}=this._store.getState().config.getStoreConfigOrThrow().paymentSettings;if(!(null==e?void 0:e.methodId))throw new $e('Unable to submit payment because "options.methodId" argument is not provided.');const i=this._store.getState().order.getPaymentId(e.methodId);if(!i||!t||this._completedPayments.isCompleted(i))throw new Sm;const{orderId:r}=t;return yield this._paymentResumer.resume({paymentId:i,bigpayBaseUrl:n,orderId:r}).catch((e=>{throw this._completedPayments.setCompleted(i),e})),this._store.getState()}))}initialize(e){return My(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.methodId))throw new $e('Unable to submit payment because "options.methodId" argument is not provided.');const t=((e,t)=>{const n=e.getState().paymentMethods.getPaymentMethod(t);if(n&&Up(n))return n})(this._store,e.methodId);if(!t)throw new wt(ft.PaymentNotInitialized);if(this._subStrategy=this._subStrategyRegistry.getByMethod(t),!this._subStrategy)throw new wt(ft.PaymentNotInitialized);return yield this._subStrategy.initialize(e),this._store.getState()}))}deinitialize(e){var t;return My(this,void 0,void 0,(function*(){return null===(t=this._subStrategy)||void 0===t||t.deinitialize(),this._store.getState()}))}}!function(e){e.CARD="card_ui",e.NONE="none",e.UNSUPPORTED="unsupported"}(Ny||(Ny={}));const Dy=(0,c.cond)([[e=>"card_ui"===e.type,(0,c.constant)(Ny.CARD)],[e=>"none"===e.type,(0,c.constant)(Ny.NONE)],[c.stubTrue,(0,c.constant)(Ny.UNSUPPORTED)]]);class zy extends We{getByMethod(e){const t=Dy(e.initializationStrategy);return this.get(t)}}var Fy=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class By{constructor(e,t,n,i){this._store=e,this._orderActionCreator=t,this._hostedFormFactory=n,this._ppsdkStepHandler=i}execute(e){return Fy(this,void 0,void 0,(function*(){const t=this._hostedForm;if(!t)throw new wt(ft.PaymentNotInitialized);const{additionalAction:n,payment:i}=e;if(!i||!i.methodId)throw new qp(["payment.methodId"]);yield t.validate();const{payload:r}=yield t.submit(i,n),{response:o}=r;yield this._ppsdkStepHandler.handle(o,{continue:{humanVerification:t=>Fy(this,void 0,void 0,(function*(){return this.execute(Object.assign({additionalAction:t},e))}))}}),yield this._store.dispatch(this._orderActionCreator.loadCurrentOrder())}))}initialize(e){return Fy(this,void 0,void 0,(function*(){const t=e&&e.creditCard&&e.creditCard.form,{config:n,checkout:i}=this._store.getState(),{paymentSettings:{bigpayBaseUrl:r=""}={}}=n.getStoreConfig()||{},o=i.getCheckoutOrThrow().id;if(!t)throw new $e;const a=t&&this._hostedFormFactory.create(r,t,o);yield a.attach(),this._hostedForm=a}))}deinitialize(){this._hostedForm&&this._hostedForm.detach()}}class Ry{constructor(e,t){this._requestSender=e,this._stepHandler=t}execute({methodId:e,bigpayBaseUrl:t,token:n}){const i={credentials:!1,body:{payment_method_id:e},headers:{authorization:n,"X-XSRF-TOKEN":null}};return this._requestSender.post(`${t}/payments`,i).then((e=>this._stepHandler.handle(e)))}initialize(){return Promise.resolve()}deinitialize(){}}var Ly,jy=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Uy{constructor(e,t){this._requestSender=e,this._stepHandler=t}resume({paymentId:e,bigpayBaseUrl:t,orderId:n}){return jy(this,void 0,void 0,(function*(){const i={credentials:!1,headers:{authorization:yield this._getToken(n).catch((()=>{throw new Sm})),"X-XSRF-TOKEN":null}};return this._requestSender.get(`${t}/payments/${e}`,i).then((e=>this._stepHandler.handle(e)))}))}_getToken(e){return jy(this,void 0,void 0,(function*(){const t={params:{order_id:e}};return this._requestSender.get("/api/storefront/payments/auth-token",t).then((({body:e})=>e.auth_token))}))}}class Vy extends Gp{constructor(e,t,n,i,r){super(e,t,n,i),this._wepayRiskClient=r}initialize(e){return this._wepayRiskClient.initialize(),super.initialize(e)}execute(e,t){const n=this._wepayRiskClient.getRiskToken(),i=(0,c.merge)({},e,{payment:{paymentData:{deviceSessionId:n}}});return super.execute(i,t)}}class qy{constructor(e){this._scriptLoader=e}initialize(){return this._scriptLoader.loadScript("//static.wepay.com/min/js/risk.1.latest.js").then((()=>this._riskClient=window.WePay.risk)).then((()=>this))}getRiskToken(){if(!this._riskClient)throw new wt(ft.PaymentNotInitialized);return this._riskClient.generate_risk_token(),this._riskClient.get_risk_token()}}!function(e){e.LoadInstrumentsRequested="LOAD_INSTRUMENTS_REQUESTED",e.LoadInstrumentsSucceeded="LOAD_INSTRUMENTS_SUCCEEDED",e.LoadInstrumentsFailed="LOAD_INSTRUMENTS_FAILED",e.DeleteInstrumentRequested="DELETE_INSTRUMENT_REQUESTED",e.DeleteInstrumentSucceeded="DELETE_INSTRUMENT_SUCCEEDED",e.DeleteInstrumentFailed="DELETE_INSTRUMENT_FAILED"}(Ly||(Ly={}));class Hy{constructor(e){this._instrumentRequestSender=e}loadInstruments(){return e=>l.c.create((t=>{t.next((0,d.VP)(Ly.LoadInstrumentsRequested));const n=this._getSessionContext(e),i=this._getCurrentAccessToken(e),r=this._getShippingAddress(e);return this._getValidAccessToken(i).then((e=>this._instrumentRequestSender.loadInstruments(Object.assign(Object.assign({},n),{authToken:e.vaultAccessToken}),r).then((({body:n})=>{t.next((0,d.VP)(Ly.LoadInstrumentsSucceeded,n,e)),t.complete()})))).catch((e=>{t.error((0,d.fQ)(Ly.LoadInstrumentsFailed,e))}))}))}deleteInstrument(e){return t=>l.c.create((n=>{n.next((0,d.VP)(Ly.DeleteInstrumentRequested,void 0,{instrumentId:e}));const i=this._getSessionContext(t),r=this._getCurrentAccessToken(t);return this._getValidAccessToken(r).then((t=>this._instrumentRequestSender.deleteInstrument(Object.assign(Object.assign({},i),{authToken:t.vaultAccessToken}),e).then((({body:i})=>{n.next((0,d.VP)(Ly.DeleteInstrumentSucceeded,i,Object.assign({instrumentId:e},t))),n.complete()})))).catch((t=>{n.error((0,d.fQ)(Ly.DeleteInstrumentFailed,t,{instrumentId:e}))}))}))}_isValidVaultAccessToken(e){return!(!e||!e.vaultAccessToken)&&function(e){const t=new Date(e.getTime());return t.setMinutes(e.getMinutes()+2),t}(new Date(e.vaultAccessExpiry)).valueOf()>Date.now()}_getCurrentAccessToken(e){const{instruments:t}=e.getState(),n=t.getInstrumentsMeta();if(n)return{vaultAccessToken:n.vaultAccessToken,vaultAccessExpiry:n.vaultAccessExpiry}}_getValidAccessToken(e){return e&&this._isValidVaultAccessToken(e)?Promise.resolve(e):this._instrumentRequestSender.getVaultAccessToken().then((({body:e})=>e))}_getShippingAddress(e){const t=e.getState(),n=t.shippingAddress.getShippingAddresses();return n.length>1?n:t.shippingAddress.getShippingAddress()}_getSessionContext(e){const t=e.getState(),n=t.config.getStoreConfig(),i=t.cart.getCart();if(!n)throw new ne(K.MissingCheckoutConfig);if(!i)throw new ne(K.MissingCart);const{customerId:r}=i,{storeId:o}=n.storeProfile,{code:a}=n.shopperCurrency.isTransactional?n.shopperCurrency:n.currency;return{customerId:r,storeId:o,currencyCode:a}}}var Gy,$y,Wy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};class Yy{transformResponse(e){const t=this._transformResponse(e),{body:n}=t,i=Wy(t,["body"]);return Object.assign(Object.assign({},i),{body:{vaultedInstruments:this._transformVaultedInstruments(n.vaulted_instruments)}})}transformErrorResponse(e){return this._transformResponse(e)}transformVaultAccessResponse(e){return Object.assign(Object.assign({},e),{body:{vaultAccessToken:e.body.data.token,vaultAccessExpiry:e.body.data.expires_at}})}_transformVaultedInstruments(e=[]){return e.map((e=>this._isPayPalInstrument(e)?function(e){return{bigpayToken:e.bigpay_token,defaultInstrument:e.default_instrument,provider:e.provider,externalId:e.external_id,trustedShippingAddress:e.trusted_shipping_address,method:"paypal",type:"account"}}(e):this._isBankInstrument(e)?function(e){return{bigpayToken:e.bigpay_token,defaultInstrument:e.default_instrument,provider:e.provider,trustedShippingAddress:e.trusted_shipping_address,accountNumber:e.account_number,issuer:e.issuer,iban:e.iban,method:e.method,type:"bank"}}(e):function(e){return{bigpayToken:e.bigpay_token,defaultInstrument:e.default_instrument,provider:e.provider,iin:e.iin,last4:e.last_4,expiryMonth:e.expiry_month,expiryYear:e.expiry_year,brand:e.brand,trustedShippingAddress:e.trusted_shipping_address,untrustedShippingCardVerificationMode:e.untrusted_shipping_address_card_verification_mode,method:e.method,type:"card"}}(e)))}_isPayPalInstrument(e){return"paypal"===e.method_type}_isBankInstrument(e){return"bank"===e.method_type}_transformResponse(e){const{data:t}=e,n=Wy(e,["data"]);return Object.assign(Object.assign({},n),{body:t})}}class Ky{constructor(e,t){this._client=e,this._requestSender=t,this._transformer=new Yy}getVaultAccessToken({timeout:e}={}){return this._requestSender.get("/internalapi/v1/checkout/payments/vault-access-token",{timeout:e}).then((e=>Object.assign(Object.assign({},e),{body:{vaultAccessToken:e.body.data.token,vaultAccessExpiry:e.body.data.expires_at}})))}loadInstruments(e,t){return t?this._loadInstrumentsWithAddress(e,t):this._loadInstruments(e)}deleteInstrument(e,t){const n=Object.assign(Object.assign({},e),{instrumentId:t});return new Promise(((e,t)=>{this._client.deleteShopperInstrument(n,((n,i)=>n?t(this._transformer.transformErrorResponse(n)):e(this._transformer.transformResponse(i))))}))}_loadInstruments(e){return new Promise(((t,n)=>{this._client.loadInstruments(e,((e,i)=>e?n(this._transformer.transformErrorResponse(e)):t(this._transformer.transformResponse(i))))}))}_loadInstrumentsWithAddress(e,t){const n=Object.assign(Object.assign({},e),{shippingAddress:Array.isArray(t)?t.map((e=>Qm(e))):Qm(t)});return new Promise(((e,t)=>{this._client.loadInstrumentsWithAddress(n,((n,i)=>n?t(this._transformer.transformErrorResponse(n)):e(this._transformer.transformResponse(i))))}))}}!function(e){e.LoadPickupOptionsRequested="LOAD_PICKUP_OPTIONS_REQUESTED",e.LoadPickupOptionsSucceeded="LOAD_PICKUP_OPTIONS_SUCCEEDED",e.LoadPickupOptionsFailed="LOAD_PICKUP_OPTIONS_FAILED"}(Gy||(Gy={}));class Qy{constructor(e){this._pickupOptionRequestSender=e}loadPickupOptions(e){return t=>new l.c((n=>{const i=this._hydrateApiQuery(t,e);n.next((0,d.VP)(Gy.LoadPickupOptionsRequested)),this._pickupOptionRequestSender.fetchPickupOptions(i).then((t=>{n.next((0,d.VP)(Gy.LoadPickupOptionsSucceeded,t.body.results,e)),n.complete()})).catch((e=>{n.error((0,d.fQ)(Gy.LoadPickupOptionsFailed,e))}))}))}_hydrateApiQuery(e,t){const n=e.getState(),i=n.cart.getCartOrThrow();if(!i)throw new ne(K.MissingCart);const r=n.consignments.getConsignmentById(t.consignmentId);if(!r)throw new ne(K.MissingConsignments);const o=r.lineItemIds,a=i.lineItems.physicalItems.filter((e=>(0,c.includes)(o,e.id))).map((e=>({variantId:e.variantId,quantity:e.quantity})));return{searchArea:t.searchArea,items:a}}}class Jy{constructor(e){this._requestSender=e}fetchPickupOptions(e){return this._requestSender.post("/api/storefront/pickup-options",{headers:Object.assign({Accept:ae.Json},se),body:e})}}!function(e){e.UpdateAddressFailed="SHIPPING_STRATEGY_UPDATE_ADDRESS_FAILED",e.UpdateAddressRequested="SHIPPING_STRATEGY_UPDATE_ADDRESS_REQUESTED",e.UpdateAddressSucceeded="SHIPPING_STRATEGY_UPDATE_ADDRESS_SUCCEEDED",e.SelectOptionFailed="SHIPPING_STRATEGY_SELECT_OPTION_FAILED",e.SelectOptionRequested="SHIPPING_STRATEGY_SELECT_OPTION_REQUESTED",e.SelectOptionSucceeded="SHIPPING_STRATEGY_SELECT_OPTION_SUCCEEDED",e.InitializeFailed="SHIPPING_STRATEGY_INITIALIZE_FAILED",e.InitializeRequested="SHIPPING_STRATEGY_INITIALIZE_REQUESTED",e.InitializeSucceeded="SHIPPING_STRATEGY_INITIALIZE_SUCCEEDED",e.DeinitializeFailed="SHIPPING_STRATEGY_DEINITIALIZE_FAILED",e.DeinitializeRequested="SHIPPING_STRATEGY_DEINITIALIZE_REQUESTED",e.DeinitializeSucceeded="SHIPPING_STRATEGY_DEINITIALIZE_SUCCEEDED",e.WidgetInteractionStarted="SHIPPING_STRATEGY_WIDGET_INTERACTION_STARTED",e.WidgetInteractionFinished="SHIPPING_STRATEGY_WIDGET_INTERACTION_FINISHED",e.WidgetInteractionFailed="SHIPPING_STRATEGY_WIDGET_INTERACTION_FAILED"}($y||($y={}));class Zy{constructor(e){this._strategyRegistry=e}updateAddress(e,t){return n=>l.c.create((i=>{const r=n.getState().payment.getPaymentId(),o=t&&t.methodId||r&&r.providerId;i.next((0,d.VP)($y.UpdateAddressRequested,void 0,{methodId:o})),this._strategyRegistry.get(o).updateAddress(e,Object.assign(Object.assign({},t),{methodId:o})).then((()=>{i.next((0,d.VP)($y.UpdateAddressSucceeded,void 0,{methodId:o})),i.complete()})).catch((e=>{i.error((0,d.fQ)($y.UpdateAddressFailed,e,{methodId:o}))}))}))}selectOption(e,t){return n=>l.c.create((i=>{const r=n.getState().payment.getPaymentId(),o=t&&t.methodId||r&&r.providerId;i.next((0,d.VP)($y.SelectOptionRequested,void 0,{methodId:o})),this._strategyRegistry.get(o).selectOption(e,Object.assign(Object.assign({},t),{methodId:o})).then((()=>{i.next((0,d.VP)($y.SelectOptionSucceeded,void 0,{methodId:o})),i.complete()})).catch((e=>{i.error((0,d.fQ)($y.SelectOptionFailed,e,{methodId:o}))}))}))}initialize(e){return t=>l.c.create((n=>{const i=t.getState(),r=i.payment.getPaymentId(),o=e&&e.methodId||r&&r.providerId,a=Object.assign(Object.assign({},e),{methodId:o});if(o&&i.shippingStrategies.isInitialized(o))return n.complete();n.next((0,d.VP)($y.InitializeRequested,void 0,{methodId:o})),this._strategyRegistry.get(o).initialize(a).then((()=>{n.next((0,d.VP)($y.InitializeSucceeded,void 0,{methodId:o})),n.complete()})).catch((e=>{n.error((0,d.fQ)($y.InitializeFailed,e,{methodId:o}))}))}))}deinitialize(e){return t=>l.c.create((n=>{const i=t.getState(),r=i.payment.getPaymentId(),o=e&&e.methodId||r&&r.providerId;if(o&&!i.shippingStrategies.isInitialized(o))return n.complete();n.next((0,d.VP)($y.DeinitializeRequested,void 0,{methodId:o})),this._strategyRegistry.get(o).deinitialize(Object.assign(Object.assign({},e),{methodId:o})).then((()=>{n.next((0,d.VP)($y.DeinitializeSucceeded,void 0,{methodId:o})),n.complete()})).catch((e=>{n.error((0,d.fQ)($y.DeinitializeFailed,e,{methodId:o}))}))}))}widgetInteraction(e,t){return l.c.create((n=>{const i={methodId:t&&t.methodId};n.next((0,d.VP)($y.WidgetInteractionStarted,void 0,i)),e().then((()=>{n.next((0,d.VP)($y.WidgetInteractionFinished,void 0,i)),n.complete()})).catch((e=>{n.error((0,d.fQ)($y.WidgetInteractionFailed,e,i))}))}))}}var Xy=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class eg{constructor(e,t=window){this._scriptLoader=e,this._window=t}getStripeClient(e,t,n){return Xy(this,void 0,void 0,(function*(){let i=this._window.bcStripeClient;return i||(i=(yield this.load())(e,{stripeAccount:t,locale:n,betas:["payment_element_beta_2","alipay_pm_beta_1","link_default_integration_beta_1","shipping_address_element_beta_1","address_element_beta_1"],apiVersion:"2020-03-02;alipay_beta=v1;link_beta=v1"}),Object.assign(this._window,{bcStripeClient:i})),i}))}getElements(e,t){let n=this._window.bcStripeElements;return n?(n.fetchUpdates(),n.update(t)):(n=e.elements(t),Object.assign(this._window,{bcStripeElements:n})),n}load(){return Xy(this,void 0,void 0,(function*(){if(yield this._scriptLoader.loadScript("https://js.stripe.com/v3/"),!this._window.Stripe)throw new lt;return this._window.Stripe}))}}var tg,ng=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class ig{constructor(e,t,n,i,r){this._store=e,this._consignmentActionCreator=t,this._paymentMethodActionCreator=n,this._amazonPayV2PaymentProcessor=i,this._shippingStrategyActionCreator=r}updateAddress(e,t){const n=this._store.getState().shippingAddress.getShippingAddress();if(!n)throw new ne(K.MissingShippingAddress);const i=Object.assign(Object.assign({},n),{customFields:e.customFields});return this._store.dispatch(this._consignmentActionCreator.updateAddress(i,t))}selectOption(e,t){return this._store.dispatch(this._consignmentActionCreator.selectShippingOption(e,t))}initialize(e){return ng(this,void 0,void 0,(function*(){const{amazonpay:t,methodId:n}=e;if(!t||!n)throw new $e('Unable to proceed because "options.amazonpay" argument is not provided.');const i=(yield this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(n))).paymentMethods.getPaymentMethodOrThrow(n);yield this._amazonPayV2PaymentProcessor.initialize(i);const{paymentToken:r,region:o}=i.initializationData,a=t.editAddressButtonId;if(r&&a){const e=this._shouldShowLoadingSpinner(o);this._bindEditButton(a,r,"changeAddress",e)}return this._store.getState()}))}deinitialize(){return ng(this,void 0,void 0,(function*(){return yield this._amazonPayV2PaymentProcessor.deinitialize(),Promise.resolve(this._store.getState())}))}_bindEditButton(e,t,n,i){const r=document.getElementById(e);if(r&&r.parentNode){if(i){const e=r.cloneNode(!0);r.parentNode.replaceChild(e,r),e.addEventListener("click",(()=>this._showLoadingSpinner()))}this._amazonPayV2PaymentProcessor.bindButton(e,t,n)}}_showLoadingSpinner(){return this._store.dispatch(this._shippingStrategyActionCreator.widgetInteraction((()=>new Promise(h.l))),{queueId:"widgetInteraction"})}_shouldShowLoadingSpinner(e){return"us"!==e}}!function(e){e.CVV="cvv",e.PAN="pan"}(tg||(tg={}));var rg=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class og{constructor(e,t,n,i,r,o){this._store=e,this._billingAddressActionCreator=t,this._consignmentActionCreator=n,this._paymentMethodActionCreator=i,this._paymentProviderCustomerActionCreator=r,this._braintreeIntegrationService=o}updateAddress(e,t){return this._store.dispatch(this._consignmentActionCreator.updateAddress(e,t))}selectOption(e,t){return this._store.dispatch(this._consignmentActionCreator.selectShippingOption(e,t))}deinitialize(){return Promise.resolve(this._store.getState())}initialize(e){var t;return rg(this,void 0,void 0,(function*(){const{methodId:n,braintreefastlane:i}=e||{},{onPayPalFastlaneAddressChange:r}=i||{};if(!n)throw new $e('Unable to proceed because "methodId" argument is not provided.');const o=this._store.getState();if(!o.customer.getCustomerOrThrow().isGuest)return Promise.resolve(this._store.getState());try{if(this._shouldRunAuthenticationFlow()){const e=o.paymentMethods.getPaymentMethod(n),{clientToken:r,isFastlaneStylingEnabled:a}=(null==e?void 0:e.initializationData)||{};r||(yield this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(n)));const s=Lr(a?null===(t=null==e?void 0:e.initializationData)||void 0===t?void 0:t.fastlaneStyles:void 0,null==i?void 0:i.styles);yield this._runAuthenticationFlowOrThrow(n,s)}"function"==typeof r&&(yield this._shouldUseBraintreeFastlaneShippingComponent(n))&&r((()=>this._handleBraintreeFastlaneShippingAddressChange()))}catch(e){}return Promise.resolve(this._store.getState())}))}_shouldRunAuthenticationFlow(){var e;const t=this._store.getState(),n=null===(e=t.cart.getCart())||void 0===e?void 0:e.id,i=Qi.get("bc-fastlane-sessionId")||"",r=t.paymentProviderCustomer.getPaymentProviderCustomer(),o=Pc(r)?r:{};return(null==o?void 0:o.authenticationState)!==$n.CANCELED&&!(null==o?void 0:o.authenticationState)&&i===n}_runAuthenticationFlowOrThrow(e,t){var n,i;return rg(this,void 0,void 0,(function*(){const r=this._store.getState(),o=r.cart.getCartOrThrow(),a=r.countries.getCountries()||[],s=r.paymentMethods.getPaymentMethodOrThrow(e),{clientToken:d,config:c}=s;if(!d)throw new ne(K.MissingPaymentMethod);this._braintreeIntegrationService.initialize(d);const l=yield this._braintreeIntegrationService.getBraintreeFastlane(null==o?void 0:o.id,null==c?void 0:c.testMode,t),u=(null===(n=r.customer.getCustomer())||void 0===n?void 0:n.email)||(null===(i=r.billingAddress.getBillingAddress())||void 0===i?void 0:i.email);if(!u)return;const{lookupCustomerByEmail:h,triggerAuthenticationFlow:m}=l.identity,{customerContextId:p}=yield h(u);if(!p)return;const{authenticationState:y,profileData:g}=yield m(p);if(y===$n.CANCELED)return yield this._store.dispatch(this._paymentProviderCustomerActionCreator.updatePaymentProviderCustomer({authenticationState:y,addresses:[],instruments:[]})),void Qi.remove("bc-fastlane-sessionId");const v=this._getPayPalBillingAddress(g),f=g.shippingAddress,b=g.shippingAddress.phoneNumber,S=this._mapPayPalToBcAddress(f,a,b),C=this._mapPayPalToBcAddress(v,a,b);if(C&&S){const t=this._mergeShippingAndBillingAddresses(S,C),n=this._mapPayPalToBcInstrument(e,g.card),i=n?[n]:[];yield this._store.dispatch(this._paymentProviderCustomerActionCreator.updatePaymentProviderCustomer({authenticationState:y,addresses:t,instruments:i})),C&&(yield this._store.dispatch(this._billingAddressActionCreator.updateAddress(Object.assign(Object.assign({},C),{id:String(C.id)})))),S&&o.lineItems.physicalItems.length>0&&(yield this._store.dispatch(this._consignmentActionCreator.updateAddress(S)))}}))}_getPayPalBillingAddress(e){const{name:t,card:n}=e,i=n.paymentSource.card.billingAddress;return Object.assign(Object.assign({},i),{firstName:i.firstName||(null==t?void 0:t.firstName),lastName:i.lastName||(null==t?void 0:t.lastName)})}_getCountryNameByCountryCode(e,t){const n=t.find((t=>t.code===e));return(null==n?void 0:n.name)||""}_mapPayPalToBcAddress(e,t,n,i){return{id:Number(Date.now()),type:"paypal-address",firstName:e.firstName||"",lastName:e.lastName||"",company:e.company||"",address1:e.streetAddress,address2:e.extendedAddress||"",city:e.locality,stateOrProvince:e.region,stateOrProvinceCode:e.region,country:this._getCountryNameByCountryCode(e.countryCodeAlpha2,t),countryCode:e.countryCodeAlpha2,postalCode:e.postalCode,phone:n||"",customFields:i||[]}}_normalizeAddress(e){return(0,c.omit)(e,["id"])}_mergeShippingAndBillingAddresses(e,t){return(0,c.isEqual)(this._normalizeAddress(e),this._normalizeAddress(t))?[e]:[e,t]}_mapPayPalToBcInstrument(e,t){if(!t)return;const{id:n,paymentSource:i}=t,{brand:r,expiry:o,lastDigits:a}=i.card,[s,d]=o.split("-");return{bigpayToken:n,brand:r,defaultInstrument:!1,expiryMonth:d,expiryYear:s,iin:"",last4:a,method:e,provider:e,trustedShippingAddress:!1,untrustedShippingCardVerificationMode:tg.CVV,type:"card"}}_handleBraintreeFastlaneShippingAddressChange(){var e;return rg(this,void 0,void 0,(function*(){const t=this._store.getState().countries.getCountries()||[],n=yield this._braintreeIntegrationService.getBraintreeFastlane(),{selectionChanged:i,selectedAddress:r}=yield n.profile.showShippingAddressSelector();if(i){const n=this._store.getState(),i=n.shippingAddress.getShippingAddressesOrThrow(),o=n.paymentProviderCustomer.getPaymentProviderCustomer(),a=Pc(o)?o:{},s=this._mapPayPalToBcAddress(r,t,r.phoneNumber,null===(e=i[0])||void 0===e?void 0:e.customFields);if(s){const e=this._filterAddresses([s,...a.addresses||[]]);return yield this._store.dispatch(this._paymentProviderCustomerActionCreator.updatePaymentProviderCustomer(Object.assign(Object.assign({},a),{addresses:e}))),yield this._store.dispatch(this._consignmentActionCreator.updateAddress(s)),s}}}))}_filterAddresses(e){return e.reduce(((e,t)=>t?e.some((e=>this._isEqualAddresses(e,t)))?e:[...e,t]:e),[])}_isEqualAddresses(e,t){return(0,c.isEqual)(this._normalizeAddress(e),this._normalizeAddress(t))}_shouldUseBraintreeFastlaneShippingComponent(e){var t;return rg(this,void 0,void 0,(function*(){const n=this._store.getState().paymentProviderCustomer.getPaymentProviderCustomer(),i=Pc(n)?n:{};if(i&&i!==$n.CANCELED){const n=yield this._getBraintreePaymentMethodOrThrow(e);return!!(null===(t=null==n?void 0:n.initializationData)||void 0===t?void 0:t.isFastlaneEnabled)}return!1}))}_getBraintreePaymentMethodOrThrow(e){return rg(this,void 0,void 0,(function*(){return this._store.getState().paymentMethods.getPaymentMethod(e)||(yield this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(e))).paymentMethods.getPaymentMethodOrThrow(e)}))}}class ag{constructor(e,t){this._store=e,this._consignmentActionCreator=t}updateAddress(e,t){return this._store.dispatch(this._consignmentActionCreator.updateAddress(e,t))}selectOption(e,t){return this._store.dispatch(this._consignmentActionCreator.selectShippingOption(e,t))}initialize(){return Promise.resolve(this._store.getState())}deinitialize(){return Promise.resolve(this._store.getState())}}var sg,dg,cg,lg,ug,hg,mg,pg=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class yg{constructor(e,t,n,i,r,o,a){this._store=e,this._billingAddressActionCreator=t,this._consignmentActionCreator=n,this._paymentMethodActionCreator=i,this._paymentProviderCustomerActionCreator=r,this._paypalCommerceSdk=o,this._paypalCommerceFastlaneUtils=a}updateAddress(e,t){return this._store.dispatch(this._consignmentActionCreator.updateAddress(e,t))}selectOption(e,t){return this._store.dispatch(this._consignmentActionCreator.selectShippingOption(e,t))}deinitialize(){return Promise.resolve(this._store.getState())}initialize(e){return pg(this,void 0,void 0,(function*(){const{methodId:t,paypalcommercefastlane:n}=e||{},{onPayPalFastlaneAddressChange:i,styles:r}=n||{};if(!t)throw new $e('Unable to proceed because "methodId" argument is not provided.');const o=this._store.getState().customer.getCustomerOrThrow();if(!(null==o?void 0:o.isGuest))return Promise.resolve(this._store.getState());try{this._shouldAuthenticateUserWithFastlane()&&(yield this._initializePayPalSdk(t,r),yield this._authenticateUserWithFastlaneOtp(t)),"function"==typeof i&&this._shouldUsePayPalFastlaneShippingComponent()&&(yield this._initializePayPalSdk(t,r),i((()=>this._handlePayPalShippingAddressChange())))}catch(e){}return Promise.resolve(this._store.getState())}))}_getPayPalPaymentMethodOrThrow(e){return pg(this,void 0,void 0,(function*(){return this._store.getState().paymentMethods.getPaymentMethod(e)||(yield this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(e))).paymentMethods.getPaymentMethodOrThrow(e)}))}_getPayPalCustomerAuthenticationState(){const e=this._store.getState().paymentProviderCustomer.getPaymentProviderCustomerOrThrow();return(th(e)?e:{}).authenticationState}_shouldAuthenticateUserWithFastlane(){const e=this._store.getState().cart.getCartOrThrow(),t=this._paypalCommerceFastlaneUtils.getStorageSessionId();return!this._getPayPalCustomerAuthenticationState()&&t===e.id}_shouldUsePayPalFastlaneShippingComponent(){const e=this._getPayPalCustomerAuthenticationState();return!!e&&e!==za.CANCELED}_initializePayPalSdk(e,t){var n;return pg(this,void 0,void 0,(function*(){const i=this._store.getState().cart.getCartOrThrow(),r=yield this._getPayPalPaymentMethodOrThrow(e),{isDeveloperModeApplicable:o,isFastlaneStylingEnabled:a}=(null==r?void 0:r.initializationData)||{},s=!!o,d=ja(a?null===(n=null==r?void 0:r.initializationData)||void 0===n?void 0:n.fastlaneStyles:{},t),c=yield this._paypalCommerceSdk.getPayPalFastlaneSdk(r,i.currency.code,i.id);yield this._paypalCommerceFastlaneUtils.initializePayPalFastlane(c,s,d)}))}_authenticateUserWithFastlaneOtp(e){var t,n;return pg(this,void 0,void 0,(function*(){const i=this._store.getState(),r=i.cart.getCartOrThrow(),o=null===(t=i.customer.getCustomer())||void 0===t?void 0:t.email,a=null===(n=i.billingAddress.getBillingAddress())||void 0===n?void 0:n.email,s=o||a||"",{customerContextId:d}=yield this._paypalCommerceFastlaneUtils.lookupCustomerOrThrow(s),c=yield this._paypalCommerceFastlaneUtils.triggerAuthenticationFlowOrThrow(d),{authenticationState:l,addresses:u,billingAddress:h,shippingAddress:m,instruments:p}=this._paypalCommerceFastlaneUtils.mapPayPalFastlaneProfileToBcCustomerData(e,c);yield this._store.dispatch(this._paymentProviderCustomerActionCreator.updatePaymentProviderCustomer({authenticationState:l,addresses:u,instruments:p})),c.authenticationState===za.CANCELED?this._paypalCommerceFastlaneUtils.removeStorageSessionId():this._paypalCommerceFastlaneUtils.updateStorageSessionId(r.id),h&&(yield this._store.dispatch(this._billingAddressActionCreator.updateAddress(Object.assign(Object.assign({},h),{id:String(h.id)})))),m&&r.lineItems.physicalItems.length>0&&(yield this._store.dispatch(this._consignmentActionCreator.updateAddress(m)))}))}_handlePayPalShippingAddressChange(){var e;return pg(this,void 0,void 0,(function*(){const t=this._paypalCommerceFastlaneUtils.getPayPalFastlaneOrThrow(),{selectionChanged:n,selectedAddress:i}=yield t.profile.showShippingAddressSelector();if(n){const t=this._store.getState(),n=t.shippingAddress.getShippingAddressesOrThrow(),r=t.paymentProviderCustomer.getPaymentProviderCustomer(),o=dh(r)?r:{},a=this._paypalCommerceFastlaneUtils.mapPayPalToBcAddress(i.address,i.name,i.phoneNumber,null===(e=n[0])||void 0===e?void 0:e.customFields),s=this._paypalCommerceFastlaneUtils.filterAddresses([a,...o.addresses||[]]);return yield this._store.dispatch(this._paymentProviderCustomerActionCreator.updatePaymentProviderCustomer(Object.assign(Object.assign({},o),{addresses:s}))),yield this._store.dispatch(this._consignmentActionCreator.updateAddress(a)),a}}))}}!function(e){e.SHIPPING="shipping",e.BILLING="billing"}(sg||(sg={})),function(e){e.SPLIT="split",e.FULL="full",e.ORGANIZATION="organization"}(dg||(dg={})),function(e){e.CreditCard="card",e.SOFORT="sofort",e.EPS="eps",e.GRABPAY="grabpay",e.BANCONTACT="bancontact",e.IDEAL="ideal",e.GIROPAY="giropay",e.ALIPAY="alipay",e.KLARNA="klarna"}(cg||(cg={})),function(e){e.NEVER="never",e.AUTO="auto",e.ALWAYS="always",e.PAYMENT="payment",e.IF_REQUIRED="if_required"}(lg||(lg={})),function(e){e.PAYMENT="payment",e.AUTHENTICATION="linkAuthentication",e.SHIPPING="address"}(ug||(ug={})),function(e){e.REQUIRES_PAYMENT_METHOD="requires_payment_method",e.REQUIRES_CONFIRMATION="requires_confirmation",e.REQUIRES_ACTION="requires_action",e.PROCESSING="processing",e.SUCCEEDED="succeeded",e.CANCELED="canceled"}(hg||(hg={}));class gg{constructor(e,t,n,i){this._store=e,this._stripeUPEScriptLoader=t,this._consignmentActionCreator=n,this._paymentMethodActionCreator=i}updateAddress(e,t){return this._store.dispatch(this._consignmentActionCreator.updateAddress(e,t))}selectOption(e,t){return this._store.dispatch(this._consignmentActionCreator.selectShippingOption(e,t))}initialize(e){return t=this,i=function*(){if(!e.stripeupe)throw new $e('Unable to proceed because "options" argument is not provided.');const{container:t,gatewayId:n,methodId:i,onChangeShipping:r,getStyles:o,availableCountries:a,getStripeState:s}=e.stripeupe;Object.entries(e.stripeupe).forEach((([e,t])=>{if(!t)throw new $e(`Unable to proceed because "${e}" argument is not provided.`)}));const d=(yield this._store.dispatch(this._paymentMethodActionCreator.loadPaymentMethod(n,{params:{method:i}}))).paymentMethods.getPaymentMethodOrThrow(i,n),{initializationData:{stripePublishableKey:c,stripeConnectedAccount:l}}=d;if(!d||!d.initializationData.stripePublishableKey||!d.clientToken)throw new ne(K.MissingPaymentMethod);let u;this._stripeUPEClient=yield this._stripeUPEScriptLoader.getStripeClient(c,l);const h=o&&o(),{form:{getShippingAddressFields:m},shippingAddress:{getShippingAddress:p}}=this._store.getState(),y=m([],"");u=h?{variables:{colorPrimary:h.fieldInnerShadow,colorBackground:h.fieldBackground,colorText:h.labelText,colorDanger:h.fieldErrorText,colorTextSecondary:h.labelText,colorTextPlaceholder:h.fieldPlaceholderText,spacingUnit:"4px",borderRadius:"4px"},rules:{".Input":{borderColor:h.fieldBorder,color:h.fieldText,boxShadow:h.fieldInnerShadow}}}:{variables:{spacingUnit:"4px",borderRadius:"4px"}},this._stripeElements=this._stripeUPEScriptLoader.getElements(this._stripeUPEClient,{clientSecret:d.clientToken,appearance:u});const g=p(),v=y.find((e=>"phone"===e.name));let f={mode:sg.SHIPPING,allowedCountries:[a],fields:{phone:"always"},validation:{phone:{required:v&&v.required?"always":"never"}},display:{name:dg.SPLIT}};if(g){const{stateOrProvinceCode:e,countryCode:t,lastName:n,firstName:i,phone:r,address1:o,address2:a,city:d,postalCode:c}=g,l=e&&t?s(t,e):e;f=Object.assign(Object.assign({},f),{defaultValues:{firstName:i,lastName:n,phone:r,address:{line1:o,line2:a,city:d,state:l,postal_code:c,country:t}}})}let b=this._stripeElements.getElement(ug.SHIPPING);return b&&b.destroy(),b=this._stripeElements.create(ug.SHIPPING,f),b.on("change",(e=>{if(!("isNewAddress"in e))throw new ne(K.MissingShippingAddress);(e.complete||e.isNewAddress)&&(this.sendData&&clearTimeout(this.sendData),this.sendData=setTimeout((()=>{r(Object.assign(Object.assign({},e),{phoneFieldRequired:!!v&&v.required}))}),1e3))})),b.mount(`#${t}`),Promise.resolve(this._store.getState())},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}deinitialize(){return Promise.resolve(this._store.getState())}}!function(e){e.SendSignInEmailRequested="SEND_SIGNIN_EMAIL_REQUESTED",e.SendSignInEmailSucceeded="SEND_SIGNIN_EMAIL_SUCCEEDED",e.SendSignInEmailFailed="SEND_SIGNIN_EMAIL_FAILED"}(mg||(mg={}));class vg{constructor(e){this._requestSender=e}sendSignInEmail(e,t){return(0,m.x)((0,b.of)((0,d.VP)(mg.SendSignInEmailRequested)),(0,p.v)((()=>{return n=this,r=function*(){const{body:n}=yield this._requestSender.sendSignInEmail(e,t);return(0,d.VP)(mg.SendSignInEmailSucceeded,n)},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}))).pipe((0,C.W)((e=>ee(mg.SendSignInEmailFailed,e))))}}class fg{constructor(e){this._requestSender=e}sendSignInEmail({email:e,redirectUrl:t},{timeout:n}={}){const i=Object.assign({Accept:ae.JsonV1},se);return this._requestSender.post("/login.php?action=passwordless_login",{body:{email:e,redirect_url:t||zt(window.top?window.top.location.href:"").pathname},headers:i,timeout:n})}}class bg{constructor(e){this._messageCustomizer=e}transform(e){var t;return e.message=(t=this._messageCustomizer(e))?t.split(/(?:\r\n|\n|\r)/).map((e=>e.replace(/^\s+/gm,""))).join(" ").trim():"",e}}let Sg=class{constructor(e,t,n,i,r,o,a,s,d,c,l,u,h,m,p,y,g,v,f,b,S,C,w,_,I,P,E,O){this._store=e,this._storeProjection=t,this._extensionMessenger=n,this._extensionEventBroadcaster=i,this._billingAddressActionCreator=r,this._checkoutActionCreator=o,this._configActionCreator=a,this._customerActionCreator=s,this._consignmentActionCreator=d,this._countryActionCreator=c,this._couponActionCreator=l,this._customerStrategyActionCreator=u,this._errorActionCreator=h,this._giftCertificateActionCreator=m,this._instrumentActionCreator=p,this._orderActionCreator=y,this._paymentMethodActionCreator=g,this._paymentStrategyActionCreator=v,this._pickupOptionActionCreator=f,this._shippingCountryActionCreator=b,this._shippingStrategyActionCreator=S,this._signInEmailActionCreator=C,this._spamProtectionActionCreator=w,this._storeCreditActionCreator=_,this._subscriptionsActionCreator=I,this._formFieldsActionCreator=P,this._extensionActionCreator=E,this._workerExtensionMessenger=O,this._errorTransformer=function(e="development"===ye()){return new bg((t=>{if(!e||!function(e){return!(!e.subtype&&!e.type)}(t))return t.message;switch(t.subtype||t.type){case K.MissingConsignments:return`\n                ${t.message}\n                The data could be unavailable because no shipping address has been provided.\n                To fix this, create a consignment or update the shipping address before performing\n                the same action again.\n            `;case K.MissingCart:case K.MissingCheckout:return`\n                ${t.message}\n                The data could be unavailable because it has not loaded from the server yet.\n                To fix this issue, you can try calling \`CheckoutService#loadCheckout\`\n                before performing the same action again.\n            `;case K.MissingCheckoutConfig:return`\n                ${t.message}\n                The data could be unavailable because it has not loaded from the server yet.\n                To fix this issue, you need to make sure \`CheckoutService\` is initialized\n                properly by calling \`CheckoutService#loadCheckout\` before performing any\n                other actions.\n            `;case K.MissingOrder:return`\n                ${t.message}\n                The data could be unavailable because it has not loaded from the server yet.\n                To fix this issue, you can try calling \`CheckoutService#loadOrder\`\n                before performing the same action again.\n            `;case K.MissingOrderId:return`\n                ${t.message}\n                The data could be unavailable because no order has been created yet. You have\n                to first create the order before you can perform the action.\n            `;case K.MissingPaymentMethod:return`\n                ${t.message}\n                The data could be unavailable because it has not loaded from the server, or\n                configured by the merchant yet. To fix the former issue, you can try calling\n                \`CheckoutService#loadPaymentMethods\` before performing the same action again.\n            `;case ft.CustomerNotInitialized:return"\n                In order to initialize the customer step of checkout, you need to call\n                `CheckoutService#initializeCustomer`. Afterwards, you should be able to\n                submit customer details.\n            ";case ft.PaymentNotInitialized:return`\n                ${t.message}\n                In order to initialize the payment step of checkout, you need to call\n                \`CheckoutService#initializePayment\`. Afterwards, you should be able to\n                submit payment details.\n            `;case ft.ShippingNotInitialized:return`\n                ${t.message}\n                In order to initialize the shipping step of checkout, you need to call\n                \`CheckoutService#initializeShipping\`. Afterwards, you should be able to\n                submit shipping details.\n            `;default:return t.message}}))}()}getState(){return this._storeProjection.getState()}notifyState(){this._storeProjection.notifyState()}subscribe(e,...t){return this._storeProjection.subscribe(e,...t)}hydrateInitialState(e){return this._dispatch(this._checkoutActionCreator.hydrateInitialState(e))}loadCheckout(e,t){return this._dispatch(e?this._checkoutActionCreator.loadCheckout(e,t):this._checkoutActionCreator.loadDefaultCheckout(t))}updateCheckout(e,t){const n=this._checkoutActionCreator.updateCheckout(e,t);return this._dispatch(n)}loadOrder(e,t){const n=this._orderActionCreator.loadOrder(e,t),i=this._formFieldsActionCreator.loadFormFields(t),r=this._configActionCreator.loadConfig(t);return Promise.all([this._dispatch(n),this._dispatch(r,{queueId:"config"}),this._dispatch(i,{queueId:"formFields"})]).then((()=>this.getState()))}submitOrder(e,t){const n=this._paymentStrategyActionCreator.execute(e,t);return this._dispatch(n,{queueId:"paymentStrategy"})}finalizeOrderIfNeeded(e){const t=this._paymentStrategyActionCreator.finalize(e);return this._dispatch(t,{queueId:"paymentStrategy"})}loadPaymentMethods(e){const t=this._paymentMethodActionCreator.loadPaymentMethods(e);return this._dispatch(t,{queueId:"paymentMethods"})}loadPaymentMethodByIds(e,t){const n=this._paymentMethodActionCreator.loadPaymentMethodsById(e,t);return this._dispatch(n,{queueId:"paymentMethods"})}loadPaymentMethod(e,t){const n=this._paymentMethodActionCreator.loadPaymentMethod(e,t);return this._dispatch(n,{queueId:"paymentMethods"})}initializePayment(e){const t=this._paymentStrategyActionCreator.initialize(e);return this._dispatch(t,{queueId:"paymentStrategy"})}deinitializePayment(e){const t=this._paymentStrategyActionCreator.deinitialize(e);return this._dispatch(t,{queueId:"paymentStrategy"})}loadBillingCountries(e){const t=this._countryActionCreator.loadCountries(e);return this._dispatch(t,{queueId:"billingCountries"})}loadShippingCountries(e){const t=this._shippingCountryActionCreator.loadCountries(e);return this._dispatch(t,{queueId:"shippingCountries"})}loadPickupOptions(e){const t=this._pickupOptionActionCreator.loadPickupOptions(e);return this._dispatch(t,{queueId:"pickupOptions"})}loadBillingAddressFields(e){return this.loadBillingCountries(e)}loadShippingAddressFields(e){return this.loadShippingCountries(e)}initializeCustomer(e){const t=this._customerStrategyActionCreator.initialize(e);return this._dispatch(t,{queueId:"customerStrategy"})}deinitializeCustomer(e){const t=this._customerStrategyActionCreator.deinitialize(e);return this._dispatch(t,{queueId:"customerStrategy"})}sendSignInEmail(e,t){const n=this._signInEmailActionCreator.sendSignInEmail(e,t);return this._dispatch(n,{queueId:"signInEmail"})}createCustomerAccount(e,t){const n=this._customerActionCreator.createCustomer(e,t);return this._dispatch(n)}createCustomerAddress(e,t){const n=this._customerActionCreator.createAddress(e,t);return this._dispatch(n)}updateSubscriptions(e,t){const n=this._subscriptionsActionCreator.updateSubscriptions(e,t);return this._dispatch(n,{queueId:"subscriptions"})}continueAsGuest(e,t){const n=this._billingAddressActionCreator.continueAsGuest(e,t);return this._dispatch(n)}signInCustomer(e,t){const n=this._customerStrategyActionCreator.signIn(e,t);return this._dispatch(n,{queueId:"customerStrategy"})}signOutCustomer(e){const t=this._customerStrategyActionCreator.signOut(e);return this._dispatch(t,{queueId:"customerStrategy"})}executePaymentMethodCheckout(e){const t=this._customerStrategyActionCreator.executePaymentMethodCheckout(e);return this._dispatch(t,{queueId:"customerStrategy"})}loadShippingOptions(e){const t=this._consignmentActionCreator.loadShippingOptions(e);return this._dispatch(t)}initializeShipping(e){const t=this._shippingStrategyActionCreator.initialize(e);return this._dispatch(t,{queueId:"shippingStrategy"})}deinitializeShipping(e){const t=this._shippingStrategyActionCreator.deinitialize(e);return this._dispatch(t,{queueId:"shippingStrategy"})}selectShippingOption(e,t){const n=this._shippingStrategyActionCreator.selectOption(e,t);return this._dispatch(n,{queueId:"shippingStrategy"})}updateShippingAddress(e,t){const n=this._shippingStrategyActionCreator.updateAddress(e,t);return this._dispatch(n,{queueId:"shippingStrategy"})}createConsignments(e,t){const n=this._consignmentActionCreator.createConsignments(e,t);return this._dispatch(n,{queueId:"shippingStrategy"})}deleteConsignment(e,t){const n=this._consignmentActionCreator.deleteConsignment(e,t);return this._dispatch(n,{queueId:"shippingStrategy"})}updateConsignment(e,t){const n=this._consignmentActionCreator.updateConsignment(e,t);return this._dispatch(n,{queueId:"shippingStrategy"})}assignItemsToAddress(e,t){const n=this._consignmentActionCreator.assignItemsByAddress(e,t);return this._dispatch(n,{queueId:"shippingStrategy"})}unassignItemsToAddress(e,t){const n=this._consignmentActionCreator.unassignItemsByAddress(e,t);return this._dispatch(n,{queueId:"shippingStrategy"})}selectConsignmentShippingOption(e,t,n){const i=this._consignmentActionCreator.updateShippingOption({id:e,shippingOptionId:t},n);return this._dispatch(i,{queueId:"shippingStrategy"})}updateBillingAddress(e,t={}){const n=this._billingAddressActionCreator.updateAddress(e,t);return this._dispatch(n)}applyStoreCredit(e,t){const n=this._storeCreditActionCreator.applyStoreCredit(e,t);return this._dispatch(n)}applyCoupon(e,t){const n=this._couponActionCreator.applyCoupon(e,t);return this._dispatch(n)}removeCoupon(e,t){const n=this._couponActionCreator.removeCoupon(e,t);return this._dispatch(n)}applyGiftCertificate(e,t){const n=this._giftCertificateActionCreator.applyGiftCertificate(e,t);return this._dispatch(n)}removeGiftCertificate(e,t){const n=this._giftCertificateActionCreator.removeGiftCertificate(e,t);return this._dispatch(n)}loadInstruments(){const e=this._instrumentActionCreator.loadInstruments();return this._dispatch(e)}deleteInstrument(e){const t=this._instrumentActionCreator.deleteInstrument(e);return this._dispatch(t).then((()=>this.loadInstruments()))}clearError(e){const t=this._errorActionCreator.clearError(e);return this._dispatch(t)}initializeSpamProtection(e){const t=this._spamProtectionActionCreator.initialize(e);return this._dispatch(t,{queueId:"spamProtection"})}executeSpamCheck(){const e=this._spamProtectionActionCreator.verifyCheckoutSpamProtection();return this._dispatch(e,{queueId:"spamProtection"})}loadExtensions(e){const t=this._extensionActionCreator.loadExtensions(e);return this._dispatch(t,{queueId:"extensions"})}renderExtension(e,t){return n=this,r=function*(){const n=this._extensionActionCreator.renderExtension(e,t,this._workerExtensionMessenger),i=yield this._dispatch(n,{queueId:"extensions"});return this._extensionEventBroadcaster.listen(),i},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{s(r.next(e))}catch(e){t(e)}}function a(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}s((r=r.apply(n,[])).next())}));var n,i,r}clearExtensionCache(e){this._extensionMessenger.clearCacheByRegion(e)}postMessageToExtension(e,t){this._extensionMessenger.post(e,t)}handleExtensionCommand(e,t,n){return this._extensionMessenger.listenForCommand(e,t,n)}handleExtensionQuery(e,t,n){return this._extensionMessenger.listenForQuery(e,t,n)}_dispatch(e,t){return this._store.dispatch(e,t).then((()=>this.getState())).catch((e=>{throw this._errorTransformer.transform(e)}))}};Sg=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([Zt],Sg);const Cg=Sg;function wg(e){return(...t)=>{const n=t.pop();return e(...t,((...e)=>{const t=n(...e);return"function"==typeof t?(0,T.Bj)(t):t}))}}const _g=wg(B.Mz),Ig=wg((0,B.Ad)(R.UI,((e,t)=>j()(e,t))));class Pg extends Ie{constructor(e,t){super(e,{message:t||"An unexpected error has occurred. The checkout process cannot continue as a result."}),this.name="UnrecoverableError",this.type="unrecoverable"}}function Eg(e){return e.reduce(((e,t)=>t?[...e,t]:e),[]).join(" ")}class Og extends Ie{constructor(e){super(e,{message:"The request has timed out or aborted."}),this.name="TimeoutError",this.type="timeout"}}class Ag{constructor(){this._factoryMethods={},this.register("default",((e,t)=>new Ie(e,{message:t}))),this.register("internal",((e,t)=>function(e,t){const{body:n}=e,{errors:i=[]}=n;return new Ie(e,{message:Eg(i)||n.detail||n.title||t,errors:i.length?i.map((e=>({code:n.type,message:e}))):[{code:n.type,message:n.detail||n.title}]})}(e,t))),this.register("storefront",((e,t)=>function(e,t){const{body:n}=e;return new Ie(e,{message:t||n.detail||n.title,errors:[{code:n.code||n.type,message:n.detail||n.title}]})}(e,t))),this.register("payment",((e,t)=>Dm(e,t))),this.register("timeout",(e=>new Og(e)))}register(e,t){this._factoryMethods[e]=t}createError(e,t){return(this._factoryMethods[this._getType(e)]||this._factoryMethods.default)(e,t)}_getType(e){if(0===e.status)return"timeout";if(this._isStorefrontErrorResponseBody(e.body))return"storefront";if(this._isInternalErrorResponseBody(e.body)){const t=(0,c.last)(e.body.type.split("/"));return t&&this._factoryMethods[t]?t:"internal"}const t=(0,c.last)(e.body&&e.body.errors);return t&&t.code&&this._factoryMethods[t.code]?t.code:"payment"}_isStorefrontErrorResponseBody(e){const t=e;return!this._isInternalErrorResponseBody(e)&&"string"==typeof t.title&&"string"==typeof t.type&&"number"==typeof t.status&&"string"==typeof t.detail}_isInternalErrorResponseBody(e){const t=e;return"object"==typeof t.errors&&"string"==typeof t.title&&"string"==typeof t.type&&"number"==typeof t.status}}function kg(e,t){return Array.isArray(e)?e.map((e=>kg(e,t))):(0,c.isPlainObject)(e)?(0,c.transform)((0,c.omitBy)(e,t),((e,n,i)=>{e[i]=kg(n,t)}),{}):e}function Tg(e,t){return function(e){return e.type===ue.ClearError}(t)?kg(e,(e=>e===t.payload)):e}function Ng(e,t,n){return e===t||(e&&t&&"object"==typeof e&&"object"==typeof t?Array.isArray(e)&&Array.isArray(t)?function(e,t,n){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(!Ng(e[i],t[i],n))return!1;return!0}(e,t,n):!Array.isArray(e)&&!Array.isArray(t)&&(e instanceof Date&&t instanceof Date?function(e,t){return e.getTime()===t.getTime()}(e,t):!(e instanceof Date||t instanceof Date)&&(e instanceof RegExp&&t instanceof RegExp?function(e,t){return e.toString()===t.toString()}(e,t):!(e instanceof RegExp||t instanceof RegExp)&&function(e,t,n){const i=n&&n.keyFilter,r=i?Object.keys(e).filter(i):Object.keys(e),o=i?Object.keys(t).filter(i):Object.keys(t);if(r.length!==o.length)return!1;for(let i=0,o=r.length;i<o;i++){const o=r[i];if(!Object.prototype.hasOwnProperty.call(t,o))return!1;if(!Ng(e[o],t[o],n))return!1}return!0}(e,t,n))):e===t)}function Mg(e,t){return void 0===t||Ng(e,t)?e:t}function xg(e,t,n){return e&&Object.prototype.hasOwnProperty.call(e,t)&&Ng(e[t],n)?e:Object.assign(Object.assign({},e),{[t]:n})}const Dg={errors:{},statuses:{}};function zg(e=Dg,t){return(0,d.HY)({data:Fg,errors:(0,d.om)(Bg,Tg),statuses:Rg})(e,t)}function Fg(e,t){var n,i;switch(t.type){case Q.UpdateBillingAddressSucceeded:case Q.ContinueAsGuestSucceeded:case Fe.LoadCheckoutSucceeded:return Mg(e,t.payload&&t.payload.billingAddress);case Be.HydrateInitialState:return Mg(e,null===(i=null===(n=t.payload)||void 0===n?void 0:n.checkout)||void 0===i?void 0:i.billingAddress);default:return e}}function Bg(e=Dg.errors,t){switch(t.type){case Fe.LoadCheckoutRequested:case Fe.LoadCheckoutSucceeded:return xg(e,"loadError",void 0);case Fe.LoadCheckoutFailed:return xg(e,"loadError",t.payload);case Q.UpdateBillingAddressRequested:case Q.UpdateBillingAddressSucceeded:return xg(e,"updateError",void 0);case Q.UpdateBillingAddressFailed:return xg(e,"updateError",t.payload);case Ip.UpdateSubscriptionsRequested:case Ip.UpdateSubscriptionsSucceeded:case Q.ContinueAsGuestRequested:case Q.ContinueAsGuestSucceeded:return xg(e,"continueAsGuestError",void 0);case Ip.UpdateSubscriptionsFailed:case Q.ContinueAsGuestFailed:return xg(e,"continueAsGuestError",t.payload);default:return e}}function Rg(e=Dg.statuses,t){switch(t.type){case Fe.LoadCheckoutRequested:return xg(e,"isLoading",!0);case Fe.LoadCheckoutSucceeded:case Fe.LoadCheckoutFailed:return xg(e,"isLoading",!1);case Q.UpdateBillingAddressRequested:return xg(e,"isUpdating",!0);case Q.UpdateBillingAddressFailed:case Q.UpdateBillingAddressSucceeded:return xg(e,"isUpdating",!1);case Q.ContinueAsGuestRequested:case Ip.UpdateSubscriptionsRequested:return xg(e,"isContinuingAsGuest",!0);case Ip.UpdateSubscriptionsSucceeded:case Ip.UpdateSubscriptionsFailed:case Q.ContinueAsGuestFailed:case Q.ContinueAsGuestSucceeded:return xg(e,"isContinuingAsGuest",!1);default:return e}}const Lg=function e(t,n,i){const{matchObject:r=(e,t)=>void 0!==e.id&&e.id===t.id}=i||{};if(!t)return n;if(!n||t===n)return t;let o=0,a=0;const s=(e,t,n)=>(o+=e===t?1:0,a+=e===n?1:0,e),d=n.map(((n,i)=>{const o=t&&t[i];return Mp(o)&&Mp(n)?r(o,n)?s(jg(o,n),o,n):s(Mg(o,n),o,n):(0,c.isArray)(o)&&(0,c.isArray)(n)?s(e(o,n),o,n):s(Mg(o,n),o,n)}));return o===n.length&&t&&t.length===n.length?t:a===n.length?n:d},jg=function e(t,n){return t?n&&t!==n?Object.keys(n).reduce(((t,i)=>{const r=t[i],o=n[i];return Mp(r)&&Mp(o)?xg(t,i,e(r,o)):(0,c.isArray)(r)&&(0,c.isArray)(o)?xg(t,i,Lg(r,o)):xg(t,i,o)}),t):t:n},Ug={errors:{},statuses:{}};function Vg(e=Ug,t){return(0,d.HY)({data:qg,errors:(0,d.om)(Gg,Tg),statuses:Hg})(e,t)}function qg(e,t){var n,i;switch(t.type){case Q.UpdateBillingAddressSucceeded:case Fe.LoadCheckoutSucceeded:case vp.CreateConsignmentsSucceeded:case vp.DeleteConsignmentSucceeded:case vp.UpdateConsignmentSucceeded:case vp.UpdateShippingOptionSucceeded:case vp.LoadShippingOptionsSucceeded:case Ae.ApplyCouponSucceeded:case Ae.RemoveCouponSucceeded:case Me.ApplyGiftCertificateSucceeded:case Me.RemoveGiftCertificateSucceeded:return jg(e,t.payload&&t.payload.cart);case Be.HydrateInitialState:return jg(e,null===(i=null===(n=t.payload)||void 0===n?void 0:n.checkout)||void 0===i?void 0:i.cart);default:return e}}function Hg(e=Ug.statuses,t){switch(t.type){case Fe.LoadCheckoutRequested:return xg(e,"isLoading",!0);case Fe.LoadCheckoutFailed:case Fe.LoadCheckoutSucceeded:return xg(e,"isLoading",!1);default:return e}}function Gg(e=Ug.errors,t){switch(t.type){case Fe.LoadCheckoutRequested:case Fe.LoadCheckoutSucceeded:return xg(e,"loadError",void 0);case Fe.LoadCheckoutFailed:return xg(e,"loadError",t.payload);default:return e}}var $g;!function(e){e.InitializeButtonFailed="INITIALIZE_BUTTON_FAILED",e.InitializeButtonRequested="INITIALIZE_BUTTON_REQUESTED",e.InitializeButtonSucceeded="INITIALIZE_BUTTON_SUCCEEDED",e.DeinitializeButtonFailed="DEINITIALIZE_BUTTON_FAILED",e.DeinitializeButtonRequested="DEINITIALIZE_BUTTON_REQUESTED",e.DeinitializeButtonSucceeded="DEINITIALIZE_BUTTON_SUCCEEDED"}($g||($g={}));const Wg={data:{},errors:{},statuses:{}},Yg={initializedContainers:{}},Kg={},Qg={};function Jg(e=Wg,t){return t.meta&&t.meta.methodId?(0,d.HY)({data:(0,d.HY)({[t.meta.methodId]:Zg}),errors:(0,d.HY)({[t.meta.methodId]:Xg}),statuses:(0,d.HY)({[t.meta.methodId]:ev})})(e,t):e}function Zg(e=Yg,t){switch(t.type){case $g.InitializeButtonSucceeded:return t.meta&&t.meta.containerId?jg(e,{initializedContainers:{[t.meta.containerId]:!0}}):e;case $g.DeinitializeButtonSucceeded:return xg(e,"initializedContainers",{})}return e}function Xg(e=Kg,t){switch(t.type){case $g.InitializeButtonRequested:case $g.InitializeButtonSucceeded:return xg(e,"initializeError",void 0);case $g.InitializeButtonFailed:return xg(e,"initializeError",t.payload);case $g.DeinitializeButtonRequested:case $g.DeinitializeButtonSucceeded:return xg(e,"deinitializeError",void 0);case $g.DeinitializeButtonFailed:return xg(e,"deinitializeError",t.payload);default:return e}}function ev(e=Qg,t){switch(t.type){case $g.InitializeButtonRequested:return xg(e,"isInitializing",!0);case $g.InitializeButtonFailed:case $g.InitializeButtonSucceeded:return xg(e,"isInitializing",!1);case $g.DeinitializeButtonRequested:return xg(e,"isDeinitializing",!0);case $g.DeinitializeButtonFailed:case $g.DeinitializeButtonSucceeded:return xg(e,"isDeinitializing",!1);default:return e}}const tv={meta:{},errors:{},statuses:{}};function nv(e=tv,t){return(0,d.HY)({data:iv,errors:(0,d.om)(rv,Tg),statuses:ov})(e,t)}function iv(e,t){var n;switch(t.type){case Ce.LoadConfigSucceeded:return jg(e,t.payload);case Be.HydrateInitialState:return jg(e,null===(n=t.payload)||void 0===n?void 0:n.config);default:return e}}function rv(e=tv.errors,t){switch(t.type){case Ce.LoadConfigSucceeded:return xg(e,"loadError",void 0);case Ce.LoadConfigFailed:return xg(e,"loadError",t.payload);default:return e}}function ov(e=tv.statuses,t){switch(t.type){case Ce.LoadConfigRequested:return xg(e,"isLoading",!0);case Ce.LoadConfigSucceeded:case Ce.LoadConfigFailed:return xg(e,"isLoading",!1);default:return e}}const av={errors:{},statuses:{}};function sv(e=av,t){return(0,d.HY)({data:dv,errors:(0,d.om)(cv,Tg),statuses:lv})(e,t)}function dv(e,t){var n,i;switch(t.type){case Fe.LoadCheckoutSucceeded:case Ae.ApplyCouponSucceeded:case vp.UpdateShippingOptionSucceeded:case Ae.RemoveCouponSucceeded:case am.LoadOrderSucceeded:return Lg(e,t.payload&&t.payload.coupons);case Be.HydrateInitialState:return Lg(e,null===(i=null===(n=t.payload)||void 0===n?void 0:n.checkout)||void 0===i?void 0:i.coupons);default:return e}}function cv(e={},t){switch(t.type){case Ae.ApplyCouponRequested:case Ae.ApplyCouponSucceeded:return xg(e,"applyCouponError",void 0);case Ae.ApplyCouponFailed:return xg(e,"applyCouponError",t.payload);case Ae.RemoveCouponRequested:case Ae.RemoveCouponSucceeded:return xg(e,"removeCouponError",void 0);case Ae.RemoveCouponFailed:return xg(e,"removeCouponError",t.payload);default:return e}}function lv(e={},t){switch(t.type){case Ae.ApplyCouponRequested:return xg(e,"isApplyingCoupon",!0);case Ae.ApplyCouponSucceeded:case Ae.ApplyCouponFailed:return xg(e,"isApplyingCoupon",!1);case Ae.RemoveCouponRequested:return xg(e,"isRemovingCoupon",!0);case Ae.RemoveCouponSucceeded:case Ae.RemoveCouponFailed:return xg(e,"isRemovingCoupon",!1);default:return e}}const uv={errors:{},statuses:{}};function hv(e=uv,t){return(0,d.HY)({data:mv,errors:(0,d.om)(pv,Tg),statuses:yv})(e,t)}function mv(e,t){var n,i;switch(t.type){case Fe.LoadCheckoutSucceeded:case vp.CreateConsignmentsSucceeded:case vp.UpdateConsignmentSucceeded:case vp.DeleteConsignmentSucceeded:case vp.UpdateShippingOptionSucceeded:case Ae.ApplyCouponSucceeded:case Ae.RemoveCouponSucceeded:case Me.ApplyGiftCertificateSucceeded:case Me.RemoveGiftCertificateSucceeded:return Lg(e,t.payload&&t.payload.giftCertificates);case Be.HydrateInitialState:return Lg(e,null===(i=null===(n=t.payload)||void 0===n?void 0:n.checkout)||void 0===i?void 0:i.giftCertificates);default:return e}}function pv(e=uv.errors,t){switch(t.type){case Me.ApplyGiftCertificateRequested:case Me.ApplyGiftCertificateSucceeded:return xg(e,"applyGiftCertificateError",void 0);case Me.ApplyGiftCertificateFailed:return xg(e,"applyGiftCertificateError",t.payload);case Me.RemoveGiftCertificateRequested:case Me.RemoveGiftCertificateSucceeded:return xg(e,"removeGiftCertificateError",void 0);case Me.RemoveGiftCertificateFailed:return xg(e,"removeGiftCertificateError",t.payload);default:return e}}function yv(e=uv.statuses,t){switch(t.type){case Me.ApplyGiftCertificateRequested:return xg(e,"isApplyingGiftCertificate",!0);case Me.ApplyGiftCertificateSucceeded:case Me.ApplyGiftCertificateFailed:return xg(e,"isApplyingGiftCertificate",!1);case Me.RemoveGiftCertificateRequested:return xg(e,"isRemovingGiftCertificate",!0);case Me.RemoveGiftCertificateSucceeded:case Me.RemoveGiftCertificateFailed:return xg(e,"isRemovingGiftCertificate",!1);default:return e}}const gv={errors:{},statuses:{}};function vv(e=gv,t){return(0,d.HY)({data:fv,errors:(0,d.om)(bv,Tg),statuses:Sv})(e,t)}function fv(e,t){var n,i;switch(t.type){case Q.ContinueAsGuestSucceeded:case Fe.LoadCheckoutSucceeded:return jg(e,t.payload&&t.payload.customer);case De.CreateCustomerAddressSucceeded:return jg(e,t.payload);case Be.HydrateInitialState:return jg(e,null===(i=null===(n=t.payload)||void 0===n?void 0:n.checkout)||void 0===i?void 0:i.customer);default:return e}}function bv(e=gv.errors,t){switch(t.type){case De.CreateCustomerRequested:case De.CreateCustomerSucceeded:return xg(e,"createError",void 0);case De.CreateCustomerFailed:return xg(e,"createError",t.payload);case De.CreateCustomerAddressRequested:case De.CreateCustomerAddressSucceeded:return xg(e,"createAddressError",void 0);case De.CreateCustomerAddressFailed:return xg(e,"createAddressError",t.payload);default:return e}}function Sv(e=gv.statuses,t){switch(t.type){case De.CreateCustomerRequested:return xg(e,"isCreating",!0);case De.CreateCustomerFailed:case De.CreateCustomerSucceeded:return xg(e,"isCreating",!1);case De.CreateCustomerAddressRequested:return xg(e,"isCreatingAddress",!0);case De.CreateCustomerAddressFailed:case De.CreateCustomerAddressSucceeded:return xg(e,"isCreatingAddress",!1);default:return e}}const Cv={data:{},errors:{},statuses:{}};function wv(e=Cv,t){return(0,d.HY)({data:_v,errors:(0,d.om)(Iv,Tg),statuses:Pv})(e,t)}function _v(e=Cv.data,t){switch(t.type){case ze.InitializeSucceeded:return jg(e,{[t.meta&&t.meta.methodId]:{isInitialized:!0}});case ze.DeinitializeSucceeded:return jg(e,{[t.meta&&t.meta.methodId]:{isInitialized:!1}})}return e}function Iv(e=Cv.errors,t){switch(t.type){case ze.InitializeRequested:case ze.InitializeSucceeded:return jg(e,{initializeErrors:Object.assign({},e.initializeErrors),initializeMethodId:e.initializeMethodId?e.initializeMethodId:void 0});case ze.InitializeFailed:return jg(e,{initializeErrors:Object.assign(Object.assign({},e.initializeErrors),{[t.meta&&t.meta.methodId]:t.payload}),initializeMethodId:t.meta&&t.meta.methodId});case ze.DeinitializeRequested:case ze.DeinitializeSucceeded:return jg(e,{deinitializeError:void 0,deinitializeMethodId:void 0});case ze.DeinitializeFailed:return jg(e,{deinitializeError:t.payload,deinitializeMethodId:t.meta&&t.meta.methodId});case ze.SignInRequested:case ze.SignInSucceeded:return jg(e,{signInError:void 0,signInMethodId:void 0});case ze.SignInFailed:return jg(e,{signInError:t.payload,signInMethodId:t.meta&&t.meta.methodId});case ze.SignOutRequested:case ze.SignOutSucceeded:return jg(e,{signOutError:void 0,signOutMethodId:void 0});case ze.SignOutFailed:return jg(e,{signOutError:t.payload,signOutMethodId:t.meta&&t.meta.methodId});case ze.ExecutePaymentMethodCheckoutRequested:case ze.ExecutePaymentMethodCheckoutSucceeded:return jg(e,{executePaymentMethodCheckoutError:void 0,executePaymentMethodCheckoutMethodId:void 0});case ze.ExecutePaymentMethodCheckoutFailed:return jg(e,{executePaymentMethodCheckoutError:t.payload,executePaymentMethodCheckoutMethodId:t.meta&&t.meta.methodId});case ze.WidgetInteractionStarted:case ze.WidgetInteractionFinished:return jg(e,{widgetInteractionError:void 0,widgetInteractionMethodId:void 0});case ze.WidgetInteractionFailed:return jg(e,{widgetInteractionError:t.payload,widgetInteractionMethodId:t.meta.methodId});default:return e}}function Pv(e=Cv.statuses,t){switch(t.type){case ze.InitializeRequested:return jg(e,{isInitializing:!0,initializeMethodId:t.meta&&t.meta.methodId});case ze.InitializeFailed:case ze.InitializeSucceeded:return jg(e,{isInitializing:!1,initializeMethodId:void 0});case ze.DeinitializeRequested:return jg(e,{isDeinitializing:!0,deinitializeMethodId:t.meta&&t.meta.methodId});case ze.DeinitializeFailed:case ze.DeinitializeSucceeded:return jg(e,{isDeinitializing:!1,deinitializeMethodId:void 0});case ze.SignInRequested:return jg(e,{isSigningIn:!0,signInMethodId:t.meta&&t.meta.methodId});case ze.SignInFailed:case ze.SignInSucceeded:return jg(e,{isSigningIn:!1,signInMethodId:void 0});case ze.SignOutRequested:return jg(e,{isSigningOut:!0,signOutMethodId:t.meta&&t.meta.methodId});case ze.SignOutFailed:case ze.SignOutSucceeded:return jg(e,{isSigningOut:!1,signOutMethodId:void 0});case ze.ExecutePaymentMethodCheckoutRequested:return jg(e,{isExecutingPaymentMethodCheckout:!0,executePaymentMethodCheckoutMethodId:t.meta&&t.meta.methodId});case ze.ExecutePaymentMethodCheckoutFailed:case ze.ExecutePaymentMethodCheckoutSucceeded:return jg(e,{isExecutingPaymentMethodCheckout:!1,executePaymentMethodCheckoutMethodId:void 0});case ze.WidgetInteractionStarted:return jg(e,{isWidgetInteracting:!0,widgetInteractionMethodId:t.meta.methodId});case ze.WidgetInteractionFinished:case ze.WidgetInteractionFailed:return jg(e,{isWidgetInteracting:!1,widgetInteractionMethodId:void 0});default:return e}}const Ev={errors:{},statuses:{}};function Ov(e=Ev,t){return(0,d.HY)({data:Av,errors:(0,d.om)(kv,Tg),statuses:Tv})(e,t)}function Av(e,t){var n;return t.type===Bt.LoadExtensionsSucceeded?Lg(e,t.payload):t.type===Be.HydrateInitialState?Lg(e,null===(n=t.payload)||void 0===n?void 0:n.extensions):e}function kv(e=Ev.errors,t){switch(t.type){case Bt.LoadExtensionsRequested:case Bt.LoadExtensionsSucceeded:return xg(e,"loadError",void 0);case Bt.RenderExtensionRequested:case Bt.RenderExtensionSucceeded:return xg(e,"renderError",void 0);case Bt.LoadExtensionsFailed:return xg(e,"loadError",t.payload);case Bt.RenderExtensionFailed:return xg(e,"renderError",t.payload);default:return e}}function Tv(e=Ev.statuses,t){switch(t.type){case Bt.LoadExtensionsRequested:return xg(e,"isLoading",!0);case Bt.LoadExtensionsSucceeded:case Bt.LoadExtensionsFailed:return xg(e,"isLoading",!1);default:return e}}const Nv={errors:{},statuses:{}};function Mv(e=Nv,t){return(0,d.HY)({data:xv,errors:(0,d.om)(Dv,Tg),statuses:zv})(e,t)}function xv(e,t){var n;switch(t.type){case Re.LoadFormFieldsSucceeded:return jg(e,t.payload);case Be.HydrateInitialState:return jg(e,null===(n=t.payload)||void 0===n?void 0:n.formFields);default:return e}}function Dv(e=Nv.errors,t){switch(t.type){case Re.LoadFormFieldsSucceeded:return xg(e,"loadError",void 0);case Re.LoadFormFieldsFailed:return xg(e,"loadError",t.payload);default:return e}}function zv(e=Nv.statuses,t){switch(t.type){case Re.LoadFormFieldsRequested:return xg(e,"isLoading",!0);case Re.LoadFormFieldsSucceeded:case Re.LoadFormFieldsFailed:return xg(e,"isLoading",!1);default:return e}}const Fv={errors:{},statuses:{}};function Bv(e=Fv,t){return(0,d.HY)({data:Rv,errors:(0,d.om)(Lv,Tg),statuses:jv})(e,t)}function Rv(e,t){return t.type===om.LoadCountriesSucceeded?Lg(e,t.payload):e}function Lv(e=Fv.errors,t){switch(t.type){case om.LoadCountriesRequested:case om.LoadCountriesSucceeded:return xg(e,"loadError",void 0);case om.LoadCountriesFailed:return xg(e,"loadError",t.payload);default:return e}}function jv(e=Fv.statuses,t){switch(t.type){case om.LoadCountriesRequested:return xg(e,"isLoading",!0);case om.LoadCountriesSucceeded:case om.LoadCountriesFailed:return xg(e,"isLoading",!1);default:return e}}const Uv={errors:{},meta:{},statuses:{}};function Vv(e=Uv,t){return(0,d.HY)({data:qv,errors:(0,d.om)(Gv,Tg),meta:Hv,statuses:$v})(e,t)}function qv(e,t){switch(t.type){case am.LoadOrderSucceeded:case am.LoadOrderPaymentsSucceeded:return jg(e,(0,c.omit)(t.payload,["billingAddress","coupons"]));default:return e}}function Hv(e,t){switch(t.type){case am.FinalizeOrderSucceeded:case am.SubmitOrderSucceeded:return jg(e,Object.assign(Object.assign({},t.meta),{callbackUrl:t.payload&&t.payload.order.callbackUrl,orderToken:t.payload&&t.payload.order.token,payment:t.payload&&t.payload.order&&t.payload.order.payment}));default:return e}}function Gv(e=Uv.errors,t){switch(t.type){case am.LoadOrderRequested:case am.LoadOrderSucceeded:case am.LoadOrderPaymentsSucceeded:case am.LoadOrderPaymentsRequested:return xg(e,"loadError",void 0);case am.LoadOrderFailed:case am.LoadOrderPaymentsFailed:return xg(e,"loadError",t.payload);default:return e}}function $v(e=Uv.statuses,t){switch(t.type){case am.LoadOrderRequested:case am.LoadOrderPaymentsRequested:return xg(e,"isLoading",!0);case am.LoadOrderSucceeded:case am.LoadOrderFailed:case am.LoadOrderPaymentsSucceeded:case am.LoadOrderPaymentsFailed:return xg(e,"isLoading",!1);default:return e}}const Wv={};function Yv(e=Wv,t){return(0,d.HY)({data:Kv})(e,t)}function Kv(e,t){switch(t.type){case am.LoadOrderPaymentsSucceeded:case am.LoadOrderSucceeded:return Mg(e,t.payload&&t.payload.billingAddress);default:return e}}function Qv(e={},t){return(0,d.HY)({data:Jv})(e,t)}function Jv(e,t){return t.type===Um.SubmitPaymentSucceeded?t.payload:e}const Zv={errors:{},statuses:{}};function Xv(e=Zv,t){return(0,d.HY)({data:ef,errors:(0,d.om)(nf,Tg),meta:tf,statuses:rf})(e,t)}function ef(e,t){switch(t.type){case Le.LoadPaymentMethodSucceeded:return function(e,t,n){if(!t)return e;const i=(0,c.pick)(t,"id"),r="object"==typeof n?(0,c.pickBy)(n):n||i,o=(0,c.findIndex)(e,r),a=[...e];if(-1===o)a.push(t);else{const n=e[o];a[o]=Mp(n)&&Mp(t)?jg(n,t):t}return a}(e||[],t.payload,t.payload&&{id:t.payload.id,gateway:t.payload.gateway});case Le.LoadPaymentMethodsSucceeded:return Lg(e,t.payload,{matchObject:(e,t)=>e.id===t.id&&e.gateway===t.gateway});default:return e}}function tf(e,t){return t.type===Le.LoadPaymentMethodsSucceeded?jg(e,t.meta):e}function nf(e=Zv.errors,t){switch(t.type){case Le.LoadPaymentMethodsRequested:case Le.LoadPaymentMethodsSucceeded:return xg(e,"loadError",void 0);case Le.LoadPaymentMethodsFailed:return xg(e,"loadError",t.payload);case Le.LoadPaymentMethodRequested:case Le.LoadPaymentMethodSucceeded:return jg(e,{loadMethodId:void 0,loadMethodError:void 0});case Le.LoadPaymentMethodFailed:return jg(e,{loadMethodId:t.meta.methodId,loadMethodError:t.payload});default:return e}}function rf(e=Zv.statuses,t){switch(t.type){case Le.LoadPaymentMethodsRequested:return xg(e,"isLoading",!0);case Le.LoadPaymentMethodsSucceeded:case Le.LoadPaymentMethodsFailed:return xg(e,"isLoading",!1);case Le.LoadPaymentMethodRequested:return jg(e,{isLoadingMethod:!0,loadMethodId:t.meta.methodId});case Le.LoadPaymentMethodSucceeded:case Le.LoadPaymentMethodFailed:return jg(e,{isLoadingMethod:!1,loadMethodId:void 0});default:return e}}const of={data:{},errors:{},statuses:{}};function af(e=of,t){return(0,d.HY)({data:sf,errors:(0,d.om)(df,Tg),statuses:cf})(e,t)}function sf(e=of.data,t){switch(t.type){case sm.InitializeSucceeded:if(t.meta){const{methodId:n,gatewayId:i}=t.meta,r=i?`${n}.${i}`:n;return jg(e,{[r]:{isInitialized:!0}})}break;case sm.DeinitializeSucceeded:if(t.meta){const{methodId:n,gatewayId:i}=t.meta,r=i?`${n}.${i}`:n;return jg(e,{[r]:{isInitialized:!1}})}}return e}function df(e=of.errors,t){switch(t.type){case sm.InitializeRequested:case sm.InitializeSucceeded:return jg(e,{initializeError:void 0,initializeMethodId:void 0});case sm.InitializeFailed:{let n=t.meta&&t.meta.methodId;if(t.meta){const{methodId:e,gatewayId:i}=t.meta;n=i?`${e}.${i}`:e}return jg(e,{initializeError:t.payload,initializeMethodId:n})}case sm.DeinitializeRequested:case sm.DeinitializeSucceeded:return jg(e,{deinitializeError:void 0,deinitializeMethodId:void 0});case sm.DeinitializeFailed:{let n=t.meta&&t.meta.methodId;if(t.meta){const{methodId:e,gatewayId:i}=t.meta;n=i?`${e}.${i}`:e}return jg(e,{deinitializeError:t.payload,deinitializeMethodId:n})}case sm.ExecuteRequested:case sm.ExecuteSucceeded:return jg(e,{executeError:void 0,executeMethodId:void 0});case sm.ExecuteFailed:return jg(e,{executeError:t.payload,executeMethodId:t.meta&&t.meta.methodId});case sm.FinalizeRequested:case sm.FinalizeSucceeded:return jg(e,{finalizeError:void 0,finalizeMethodId:void 0});case sm.FinalizeFailed:return jg(e,{finalizeError:t.payload,finalizeMethodId:t.meta&&t.meta.methodId});case sm.WidgetInteractionStarted:case sm.WidgetInteractionFinished:return jg(e,{widgetInteractionError:void 0,widgetInteractionMethodId:void 0});case sm.WidgetInteractionFailed:return jg(e,{widgetInteractionError:t.payload,widgetInteractionMethodId:t.meta.methodId});default:return e}}function cf(e=of.statuses,t){switch(t.type){case sm.InitializeRequested:{let n=t.meta&&t.meta.methodId;if(t.meta){const{methodId:e,gatewayId:i}=t.meta;n=i?`${e}.${i}`:e}return jg(e,{isInitializing:!0,initializeMethodId:n})}case sm.InitializeFailed:case sm.InitializeSucceeded:return jg(e,{isInitializing:!1,initializeMethodId:void 0});case sm.DeinitializeRequested:{let n=t.meta&&t.meta.methodId;if(t.meta){const{methodId:e,gatewayId:i}=t.meta;n=i?`${e}.${i}`:e}return jg(e,{isDeinitializing:!0,deinitializeMethodId:n})}case sm.DeinitializeFailed:case sm.DeinitializeSucceeded:return jg(e,{isDeinitializing:!1,deinitializeMethodId:void 0});case sm.ExecuteRequested:return jg(e,{isExecuting:!0,executeMethodId:t.meta&&t.meta.methodId});case sm.ExecuteFailed:case sm.ExecuteSucceeded:return jg(e,{isExecuting:!1,executeMethodId:void 0});case sm.FinalizeRequested:return jg(e,{isFinalizing:!0,finalizeMethodId:t.meta&&t.meta.methodId});case sm.FinalizeFailed:case sm.FinalizeSucceeded:return jg(e,{isFinalizing:!1,finalizeMethodId:void 0});case sm.WidgetInteractionStarted:return jg(e,{isWidgetInteracting:!0,widgetInteractionMethodId:t.meta.methodId});case sm.WidgetInteractionFinished:case sm.WidgetInteractionFailed:return jg(e,{isWidgetInteracting:!1,widgetInteractionMethodId:void 0});default:return e}}const lf={data:{}};function uf(e=lf,t){return(0,d.HY)({data:hf})(e,t)}function hf(e=lf.data,t){return t.type===gp.UpdatePaymentProviderCustomer?jg(e,t.payload):e}const mf={data:[],errors:{},statuses:{}};function pf(e=mf,t){return(0,d.HY)({data:yf,errors:(0,d.om)(vf,Tg),meta:gf,statuses:ff})(e,t)}function yf(e=mf.data,t){return t.type===Ly.LoadInstrumentsSucceeded?Lg(e,t.payload&&t.payload.vaultedInstruments||[]):e}function gf(e,t){switch(t.type){case Ly.LoadInstrumentsSucceeded:case Ly.DeleteInstrumentSucceeded:return jg(e,t.meta);default:return e}}function vf(e=mf.errors,t){switch(t.type){case Ly.LoadInstrumentsRequested:case Ly.LoadInstrumentsSucceeded:return xg(e,"loadError",void 0);case Ly.DeleteInstrumentRequested:case Ly.DeleteInstrumentSucceeded:return jg(e,{deleteError:void 0,failedInstrument:void 0});case Ly.LoadInstrumentsFailed:return xg(e,"loadError",t.payload);case Ly.DeleteInstrumentFailed:return jg(e,{deleteError:t.payload,failedInstrument:t.meta.instrumentId});default:return e}}function ff(e=mf.statuses,t){switch(t.type){case Ly.LoadInstrumentsRequested:return xg(e,"isLoading",!0);case Ly.DeleteInstrumentRequested:return jg(e,{isDeleting:!0,deletingInstrument:t.meta.instrumentId});case Ly.LoadInstrumentsSucceeded:case Ly.LoadInstrumentsFailed:return xg(e,"isLoading",!1);case Ly.DeleteInstrumentSucceeded:case Ly.DeleteInstrumentFailed:return jg(e,{isDeleting:!1,deletingInstrument:void 0});default:return e}}const bf={data:{}};function Sf(e=bf,t){return t.meta&&t.meta.methodId?(0,d.HY)({data:(0,d.HY)({[t.meta.methodId]:Cf})})(e,t):e}function Cf(e,t){switch(t.type){case ut.InitializeRemoteBillingSucceeded:return xg(e,"billing",t.payload&&t.payload.billing);case ut.InitializeRemoteShippingSucceeded:return xg(e,"shipping",t.payload&&t.payload.shipping);case ut.LoadRemoteSettingsSucceeded:return xg(e,"settings",t.payload);case ut.UpdateRemoteCheckout:return jg(e,t.payload);default:return e}}const wf={errors:{updateShippingOptionError:{},updateError:{},deleteError:{}},statuses:{isUpdating:{},isUpdatingShippingOption:{},isDeleting:{}}};function _f(e=wf,t){return(0,d.HY)({data:If,errors:(0,d.om)(Pf,Tg),statuses:Ef})(e,t)}function If(e,t){var n,i;switch(t.type){case Fe.LoadCheckoutSucceeded:case vp.LoadShippingOptionsSucceeded:case vp.CreateConsignmentsSucceeded:case vp.UpdateConsignmentSucceeded:case vp.DeleteConsignmentSucceeded:case vp.UpdateShippingOptionSucceeded:case Ae.ApplyCouponSucceeded:case Ae.RemoveCouponSucceeded:return Lg(e,t.payload&&t.payload.consignments);case De.SignOutCustomerSucceeded:return Lg(e,[]);case Be.HydrateInitialState:return Lg(e,null===(i=null===(n=t.payload)||void 0===n?void 0:n.checkout)||void 0===i?void 0:i.consignments);default:return e}}function Pf(e=wf.errors,t){switch(t.type){case Fe.LoadCheckoutRequested:case Fe.LoadCheckoutSucceeded:case vp.LoadShippingOptionsSucceeded:case vp.LoadShippingOptionsRequested:return xg(e,"loadError",void 0);case Fe.LoadCheckoutFailed:case vp.LoadShippingOptionsFailed:return xg(e,"loadError",t.payload);case vp.CreateConsignmentsRequested:case vp.CreateConsignmentsSucceeded:return xg(e,"createError",void 0);case vp.CreateConsignmentsFailed:return xg(e,"createError",t.payload);case vp.UpdateConsignmentSucceeded:case vp.UpdateConsignmentRequested:return t.meta?jg(e,{updateError:{[t.meta.id]:void 0}}):e;case vp.UpdateConsignmentFailed:return t.meta?jg(e,{updateError:{[t.meta.id]:t.payload}}):e;case vp.DeleteConsignmentSucceeded:case vp.DeleteConsignmentRequested:return t.meta?jg(e,{deleteError:{[t.meta.id]:void 0}}):e;case vp.DeleteConsignmentFailed:return t.meta?jg(e,{deleteError:{[t.meta.id]:t.payload}}):e;case vp.UpdateShippingOptionRequested:case vp.UpdateShippingOptionSucceeded:return t.meta?jg(e,{updateShippingOptionError:{[t.meta.id]:void 0}}):e;case vp.UpdateShippingOptionFailed:return t.meta?jg(e,{updateShippingOptionError:{[t.meta.id]:t.payload}}):e;default:return e}}function Ef(e=wf.statuses,t){switch(t.type){case Fe.LoadCheckoutRequested:return xg(e,"isLoading",!0);case vp.LoadShippingOptionsRequested:return xg(e,"isLoadingShippingOptions",!0);case Fe.LoadCheckoutSucceeded:case Fe.LoadCheckoutFailed:return xg(e,"isLoading",!1);case vp.LoadShippingOptionsSucceeded:case vp.LoadShippingOptionsFailed:return xg(e,"isLoadingShippingOptions",!1);case vp.CreateConsignmentsRequested:return xg(e,"isCreating",!0);case vp.CreateConsignmentsSucceeded:case vp.CreateConsignmentsFailed:return xg(e,"isCreating",!1);case vp.UpdateConsignmentRequested:return t.meta?jg(e,{isUpdating:{[t.meta.id]:!0}}):e;case vp.UpdateConsignmentSucceeded:case vp.UpdateConsignmentFailed:return t.meta?jg(e,{isUpdating:{[t.meta.id]:!1}}):e;case vp.DeleteConsignmentRequested:return t.meta?jg(e,{isDeleting:{[t.meta.id]:!0}}):e;case vp.DeleteConsignmentSucceeded:case vp.DeleteConsignmentFailed:return t.meta?jg(e,{isDeleting:{[t.meta.id]:!1}}):e;case vp.UpdateShippingOptionRequested:return t.meta?jg(e,{isUpdatingShippingOption:{[t.meta.id]:!0}}):e;case vp.UpdateShippingOptionSucceeded:case vp.UpdateShippingOptionFailed:return t.meta?jg(e,{isUpdatingShippingOption:{[t.meta.id]:!1}}):e;default:return e}}function Of(e,t){const n={};return Object.keys(e).forEach((i=>{const r=e[i],o=t?`${t}.${i}`:i;"object"==typeof r?Object.assign(n,Of(r,o)):n[o]=r})),n}function Af(e){return Object.keys(e).sort().reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:e[n]})),{})}const kf={errors:{},statuses:{}};function Tf(e=kf,t){return(0,d.HY)({data:Nf,errors:(0,d.om)(Mf,Tg),statuses:xf})(e,t)}function Nf(e,t){if(t.type!==Gy.LoadPickupOptionsSucceeded)return e;if(t.meta){const n=Af(Of({consignmentId:t.meta.consignmentId,searchArea:t.meta.searchArea}));return xg(e,btoa(`${JSON.stringify(n)}`),t.payload)}}function Mf(e=kf.errors,t){switch(t.type){case Gy.LoadPickupOptionsRequested:case Gy.LoadPickupOptionsSucceeded:return xg(e,"loadError",void 0);case Gy.LoadPickupOptionsFailed:return xg(e,"loadError",t.payload);default:return e}}function xf(e=kf.statuses,t){switch(t.type){case Gy.LoadPickupOptionsRequested:return xg(e,"isLoading",!0);case Gy.LoadPickupOptionsSucceeded:case Gy.LoadPickupOptionsFailed:return xg(e,"isLoading",!1);default:return e}}const Df={errors:{},statuses:{}};function zf(e=Df,t){return(0,d.HY)({data:Ff,errors:(0,d.om)(Bf,Tg),statuses:Rf})(e,t)}function Ff(e,t){return t.type===wp.LoadShippingCountriesSucceeded?Lg(e,t.payload):e}function Bf(e=Df.errors,t){switch(t.type){case wp.LoadShippingCountriesRequested:case wp.LoadShippingCountriesSucceeded:return xg(e,"loadError",void 0);case wp.LoadShippingCountriesFailed:return xg(e,"loadError",t.payload);default:return e}}function Rf(e=Df.statuses,t){switch(t.type){case wp.LoadShippingCountriesRequested:return xg(e,"isLoading",!0);case wp.LoadShippingCountriesSucceeded:case wp.LoadShippingCountriesFailed:return xg(e,"isLoading",!1);default:return e}}const Lf={data:{},errors:{},statuses:{}};function jf(e=Lf,t){return(0,d.HY)({data:Uf,errors:(0,d.om)(Vf,Tg),statuses:qf})(e,t)}function Uf(e=Lf.data,t){switch(t.type){case $y.InitializeSucceeded:return jg(e,{[t.meta&&t.meta.methodId]:{isInitialized:!0}});case $y.DeinitializeSucceeded:return jg(e,{[t.meta&&t.meta.methodId]:{isInitialized:!1}})}return e}function Vf(e=Lf.errors,t){switch(t.type){case $y.InitializeRequested:case $y.InitializeSucceeded:return jg(e,{initializeError:void 0,initializeMethodId:void 0});case $y.InitializeFailed:return jg(e,{initializeError:t.payload,initializeMethodId:t.meta&&t.meta.methodId});case $y.DeinitializeRequested:case $y.DeinitializeSucceeded:return jg(e,{deinitializeError:void 0,deinitializeMethodId:void 0});case $y.DeinitializeFailed:return jg(e,{deinitializeError:t.payload,deinitializeMethodId:t.meta&&t.meta.methodId});case $y.UpdateAddressRequested:case $y.UpdateAddressSucceeded:return jg(e,{updateAddressError:void 0,updateAddressMethodId:void 0});case $y.UpdateAddressFailed:return jg(e,{updateAddressError:t.payload,updateAddressMethodId:t.meta&&t.meta.methodId});case $y.SelectOptionRequested:case $y.SelectOptionSucceeded:return jg(e,{selectOptionError:void 0,selectOptionMethodId:void 0});case $y.SelectOptionFailed:return jg(e,{selectOptionError:t.payload,selectOptionMethodId:t.meta&&t.meta.methodId});case $y.WidgetInteractionStarted:case $y.WidgetInteractionFinished:return jg(e,{widgetInteractionError:void 0,widgetInteractionMethodId:void 0});case $y.WidgetInteractionFailed:return jg(e,{widgetInteractionError:t.payload,widgetInteractionMethodId:t.meta&&t.meta.methodId});default:return e}}function qf(e=Lf.statuses,t){switch(t.type){case $y.InitializeRequested:return jg(e,{isInitializing:!0,initializeMethodId:t.meta&&t.meta.methodId});case $y.InitializeFailed:case $y.InitializeSucceeded:return jg(e,{isInitializing:!1,initializeMethodId:void 0});case $y.DeinitializeRequested:return jg(e,{isDeinitializing:!0,deinitializeMethodId:t.meta&&t.meta.methodId});case $y.DeinitializeFailed:case $y.DeinitializeSucceeded:return jg(e,{isDeinitializing:!1,deinitializeMethodId:void 0});case $y.UpdateAddressRequested:return jg(e,{isUpdatingAddress:!0,updateAddressMethodId:t.meta&&t.meta.methodId});case $y.UpdateAddressFailed:case $y.UpdateAddressSucceeded:return jg(e,{isUpdatingAddress:!1,updateAddressMethodId:void 0});case $y.SelectOptionRequested:return jg(e,{isSelectingOption:!0,selectOptionMethodId:t.meta&&t.meta.methodId});case $y.SelectOptionFailed:case $y.SelectOptionSucceeded:return jg(e,{isSelectingOption:!1,selectOptionMethodId:void 0});case $y.WidgetInteractionStarted:return jg(e,{isWidgetInteracting:!0,widgetInteractionMethodId:t.meta&&t.meta.methodId});case $y.WidgetInteractionFinished:case $y.WidgetInteractionFailed:return jg(e,{isWidgetInteracting:!1,widgetInteractionMethodId:void 0});default:return e}}const Hf={errors:{},statuses:{}};function Gf(e=Hf,t){return(0,d.HY)({data:$f,errors:(0,d.om)(Wf,Tg),statuses:Yf})(e,t)}function $f(e,t){return t.type===mg.SendSignInEmailSucceeded?jg(e,t.payload):e}function Wf(e=Hf.errors,t){switch(t.type){case mg.SendSignInEmailRequested:case mg.SendSignInEmailSucceeded:return xg(e,"sendError",void 0);case mg.SendSignInEmailFailed:return xg(e,"sendError",t.payload);default:return e}}function Yf(e=Hf.statuses,t){switch(t.type){case mg.SendSignInEmailRequested:return xg(e,"isSending",!0);case mg.SendSignInEmailFailed:case mg.SendSignInEmailSucceeded:return xg(e,"isSending",!1);default:return e}}const Kf={errors:{},statuses:{}};function Qf(e=Kf,t){return(0,d.HY)({errors:(0,d.om)(Jf,Tg),statuses:Zf})(e,t)}function Jf(e=Kf.errors,t){switch(t.type){case _p.ApplyStoreCreditRequested:case _p.ApplyStoreCreditSucceeded:return xg(e,"applyError",void 0);case _p.ApplyStoreCreditFailed:return xg(e,"applyError",t.payload);default:return e}}function Zf(e=Kf.statuses,t){switch(t.type){case _p.ApplyStoreCreditRequested:return xg(e,"isApplying",!0);case _p.ApplyStoreCreditSucceeded:case _p.ApplyStoreCreditFailed:return xg(e,"isApplying",!1);default:return e}}const Xf={errors:{},statuses:{}};function eb(e=Xf,t){return(0,d.HY)({errors:(0,d.om)(tb,Tg),statuses:nb})(e,t)}function tb(e=Xf.errors,t){switch(t.type){case Ip.UpdateSubscriptionsRequested:case Ip.UpdateSubscriptionsSucceeded:return xg(e,"updateError",void 0);case Ip.UpdateSubscriptionsFailed:return xg(e,"updateError",t.payload);default:return e}}function nb(e=Xf.statuses,t){switch(t.type){case Ip.UpdateSubscriptionsRequested:return xg(e,"isUpdating",!0);case Ip.UpdateSubscriptionsFailed:case Ip.UpdateSubscriptionsSucceeded:return xg(e,"isUpdating",!1);default:return e}}const ib={errors:{},statuses:{}};function rb(e=ib,t){return(0,d.HY)({data:ob,errors:(0,d.om)(ab,Tg),statuses:sb})(e,t)}function ob(e,t){var n;switch(t.type){case Fe.LoadCheckoutSucceeded:case Fe.UpdateCheckoutSucceeded:case _p.ApplyStoreCreditSucceeded:case Q.UpdateBillingAddressSucceeded:case Ae.ApplyCouponSucceeded:case Ae.RemoveCouponSucceeded:case vp.CreateConsignmentsSucceeded:case vp.UpdateConsignmentSucceeded:case vp.DeleteConsignmentSucceeded:case vp.UpdateShippingOptionSucceeded:case vp.LoadShippingOptionsSucceeded:case Me.ApplyGiftCertificateSucceeded:case Me.RemoveGiftCertificateSucceeded:case ht.VerifyCheckoutSucceeded:return jg(e,(0,c.omit)(t.payload,["billingAddress","cart","consignments","customer","coupons","giftCertificates"]));case am.SubmitOrderSucceeded:return xg(e,"orderId",t.payload&&t.payload.order.orderId);case Be.HydrateInitialState:return jg(e,(0,c.omit)(null===(n=t.payload)||void 0===n?void 0:n.checkout,["billingAddress","cart","consignments","customer","coupons","giftCertificates"]));default:return e}}function ab(e=ib.errors,t){switch(t.type){case Fe.LoadCheckoutRequested:case Fe.LoadCheckoutSucceeded:return xg(e,"loadError",void 0);case Fe.LoadCheckoutFailed:return xg(e,"loadError",t.payload);case Fe.UpdateCheckoutRequested:case Fe.UpdateCheckoutSucceeded:return xg(e,"updateError",void 0);case Fe.UpdateCheckoutFailed:return xg(e,"updateError",t.payload);default:return e}}function sb(e=ib.statuses,t){switch(t.type){case Fe.LoadCheckoutRequested:return xg(e,"isLoading",!0);case Fe.LoadCheckoutFailed:case Fe.LoadCheckoutSucceeded:return xg(e,"isLoading",!1);case Fe.UpdateCheckoutRequested:return xg(e,"isUpdating",!0);case Fe.UpdateCheckoutFailed:case Fe.UpdateCheckoutSucceeded:return xg(e,"isUpdating",!1);case ht.ExecuteRequested:return xg(e,"isExecutingSpamCheck",!0);case ht.ExecuteFailed:case ht.ExecuteSucceeded:return xg(e,"isExecutingSpamCheck",!1);default:return e}}function db(e,t){if(null==e)throw t?t():new Error("An unexpected error has occurred.");return e}const cb={"mollie.credit_card":{provider:"mollie",method:"credit_card"},"adyenv2.scheme":{provider:"adyenv2",method:"scheme"},"adyenv3.scheme":{provider:"adyenv3",method:"scheme"},"adyenv2.bcmc":{provider:"adyenv2",method:"bcmc"},"adyenv2.ideal":{provider:"adyenv2",method:"ideal"},"adyenv2.sepadirectdebit":{provider:"adyenv2",method:"sepadirectdebit"},"adyenv2.directEbanking":{provider:"adyenv2",method:"directEbanking"},"adyenv2.giropay":{provider:"adyenv2",method:"giropay"},barclays:{provider:"barclays",method:"credit_card"},braintree:{provider:"braintree",method:"credit_card"},braintreepaypal:{provider:"braintree",method:"paypal"},braintreeach:{provider:"braintree",method:"ach"},authorizenet:{provider:"authorizenet",method:"credit_card"},elavon:{provider:"elavon",method:"credit_card"},checkoutcom:{provider:"checkoutcom",method:"credit_card"},"checkoutcom.credit_card":{provider:"checkoutcom",method:"credit_card"},"checkoutcom.card":{provider:"checkoutcom",method:"card"},sagepay:{provider:"sagepay",method:"credit_card"},stripe:{provider:"stripe",method:"credit_card"},"stripev3.card":{provider:"stripev3",method:"card"},"stripeupe.card":{provider:"stripeupe",method:"card"},cybersource:{provider:"cybersource",method:"credit_card"},cybersourcev2:{provider:"cybersourcev2",method:"credit_card"},bnz:{provider:"bnz",method:"credit_card"},converge:{provider:"converge",method:"credit_card"},bluesnapv2:{provider:"bluesnapv2",method:"credit_card"},"bluesnapdirect.credit_card":{provider:"bluesnapdirect",method:"credit_card"},"bluesnapdirect.ecp":{provider:"bluesnapdirect",method:"ecp"},"bluesnapdirect.sepa_direct_debit":{provider:"bluesnapdirect",method:"sepa_direct_debit"},orbital:{provider:"orbital",method:"credit_card"},paymetric:{provider:"paymetric",method:"credit_card"},bolt:{provider:"bolt",method:"credit_card"},"barclaycard.credit_card":{provider:"barclaycard",method:"credit_card"},moneris:{provider:"moneris",method:"credit_card"},cba_mpgs:{provider:"cba_mpgs",method:"credit_card"},worldpayaccess:{provider:"worldpayaccess",method:"credit_card"},squarev2:{provider:"squarev2",method:"credit_card"},paypalcommercecreditcards:{provider:"paypalcommerce",method:"credit_card"},paypalcommerce:{provider:"paypalcommerce",method:"paypal"},bigcommerce_payments_creditcards:{provider:"bigcommerce_payments",method:"credit_card"},bigcommerce_payments:{provider:"bigcommerce_payments",method:"paypal"},tdonlinemart:{provider:"tdonlinemart",method:"credit_card"}};function lb(e){return(0,c.pickBy)({firstName:e.firstName,lastName:e.lastName,company:e.company,address1:e.address1,address2:e.address2,city:e.city,stateOrProvince:e.stateOrProvince,countryCode:e.countryCode,postalCode:e.postalCode,phone:e.phone,customFields:e.customFields},c.identity)}const ub={errors:{},statuses:{}};function hb(){const e=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g(e,(e=>()=>db(e(),(()=>new ne(K.MissingBillingAddress))))),n=_g((e=>e.errors.updateError),(e=>()=>e)),i=_g((e=>e.errors.continueAsGuestError),(e=>()=>e)),r=_g((e=>e.errors.loadError),(e=>()=>e)),o=_g((e=>!!e.statuses.isUpdating),(e=>()=>e)),a=_g((e=>!!e.statuses.isContinuingAsGuest),(e=>()=>e)),s=_g((e=>!!e.statuses.isLoading),(e=>()=>e));return(0,T.B4)(((d=Dg)=>({getBillingAddress:e(d),getBillingAddressOrThrow:t(d),getUpdateError:n(d),getContinueAsGuestError:i(d),getLoadError:r(d),isUpdating:o(d),isContinuingAsGuest:a(d),isLoading:s(d)})))}(),t=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g(e,(e=>()=>db(e(),(()=>new ne(K.MissingCart))))),n=_g((e=>e.errors.loadError),(e=>()=>e)),i=_g((e=>!!e.statuses.isLoading),(e=>()=>e));return(0,T.B4)(((r=Ug)=>({getCart:e(r),getCartOrThrow:t(r),getLoadError:n(r),isLoading:i(r)})))}(),n=function(){const e=_g((e=>e),(e=>()=>e)),t=_g((e=>e.statuses),(e=>(0,T.Bj)((t=>{if(t){const n=e[t];return!0===(n&&n.isInitializing)}return(0,c.some)(e,{isInitializing:!0})})))),n=_g((e=>e.data),(e=>(0,T.Bj)(((t,n)=>{const i=e[t];return!!i&&(n?!0===i.initializedContainers[n]:(0,c.some)(i.initializedContainers,(e=>!0===e)))})))),i=_g((e=>e.statuses),(e=>(0,T.Bj)((t=>{if(t){const n=e[t];return!0===(n&&n.isDeinitializing)}return(0,c.some)(e,{isDeinitializing:!0})})))),r=_g((e=>e.errors),(e=>(0,T.Bj)((t=>{const n=t?e[t]:(0,c.find)((0,c.values)(e),(e=>!(!e||!e.initializeError)));return n&&n.initializeError})))),o=_g((e=>e.errors),(e=>(0,T.Bj)((t=>{const n=t?e[t]:(0,c.find)((0,c.values)(e),(e=>!(!e||!e.deinitializeError)));return n&&n.deinitializeError}))));return(0,T.B4)(((a=Wg)=>({getState:e(a),isInitializing:t(a),isInitialized:n(a),isDeinitializing:i(a),getInitializeError:r(a),getDeinitializeError:o(a)})))}(),i=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g((e=>e.data),(e=>t=>{if(!e)return;const{flashMessages:n}=e.context;return n?void 0!==t?n.filter((({type:e})=>t===e)):n:void 0})),n=_g((e=>e.data),((e,{formState:t})=>t&&t.data),((e,t={customerAccount:[],shippingAddress:[],billingAddress:[]})=>()=>e?Object.assign(Object.assign({},e.storeConfig),{formFields:t}):void 0)),i=_g(n,(e=>()=>db(e(),(()=>new ne(K.MissingCheckoutConfig))))),r=_g((e=>e.data&&e.data.context),(e=>()=>e)),o=_g((e=>e.meta&&e.meta.externalSource),(e=>()=>e)),a=_g((e=>{var t;return null===(t=e.meta)||void 0===t?void 0:t.host}),(e=>()=>e)),s=_g((e=>{var t;return null===(t=e.meta)||void 0===t?void 0:t.locale}),(e=>()=>e)),d=_g((e=>e.meta&&e.meta.variantIdentificationToken),(e=>()=>e)),c=_g((e=>e.errors.loadError),(e=>()=>e)),l=_g((e=>!!e.statuses.isLoading),(e=>()=>e));return(0,T.B4)(((u=tv,h)=>({getConfig:e(u),getFlashMessages:t(u),getStoreConfig:n(u,{formState:h}),getStoreConfigOrThrow:i(u,{formState:h}),getContextConfig:r(u),getExternalSource:o(u),getHost:a(u),getLocale:s(u),getVariantIdentificationToken:d(u),getLoadError:c(u),isLoading:l(u)})))}(),r=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g((e=>e.errors.loadError),(e=>()=>e)),n=_g((e=>!!e.statuses.isLoading),(e=>()=>e));return(0,T.B4)(((i=Fv)=>({getCountries:e(i),getLoadError:t(i),isLoading:n(i)})))}(),o=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g((e=>e.errors.removeCouponError),(e=>()=>e)),n=_g((e=>e.errors.applyCouponError),(e=>()=>e)),i=_g((e=>!!e.statuses.isApplyingCoupon),(e=>()=>e)),r=_g((e=>!!e.statuses.isRemovingCoupon),(e=>()=>e));return(0,T.B4)(((o=av)=>({getCoupons:e(o),getRemoveError:t(o),getApplyError:n(o),isApplying:i(o),isRemoving:r(o)})))}(),a=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g(e,(e=>()=>db(e(),(()=>new ne(K.MissingCustomer))))),n=_g((e=>e.errors.createError),(e=>()=>e)),i=_g((e=>!!e.statuses.isCreating),(e=>()=>e)),r=_g((e=>e.errors.createAddressError),(e=>()=>e)),o=_g((e=>!!e.statuses.isCreatingAddress),(e=>()=>e));return(0,T.B4)(((a=gv)=>({getCustomer:e(a),getCustomerOrThrow:t(a),getCreateAccountError:n(a),isCreatingCustomerAccount:i(a),getCreateAddressError:r(a),isCreatingCustomerAddress:o(a)})))}(),s=function(){const e=_g((e=>e.errors.signInMethodId),(e=>e.errors.signInError),((e,t)=>n=>{if(!n||e===n)return t})),t=_g((e=>e.errors.signOutMethodId),(e=>e.errors.signOutError),((e,t)=>n=>{if(!n||e===n)return t})),n=_g((e=>e.errors.executePaymentMethodCheckoutMethodId),(e=>e.errors.executePaymentMethodCheckoutError),((e,t)=>n=>{if(!n||e===n)return t})),i=_g((e=>e.errors.initializeMethodId),(e=>e.errors.initializeErrors),((e,t)=>n=>{if(e&&t)return n?t[n]:t[e]})),r=_g((e=>e.errors.widgetInteractionMethodId),(e=>e.errors.widgetInteractionError),((e,t)=>n=>{if(!n||e===n)return t})),o=_g((e=>e.statuses.signInMethodId),(e=>e.statuses.isSigningIn),((e,t)=>n=>!(n&&e!==n||!t))),a=_g((e=>e.statuses.signOutMethodId),(e=>e.statuses.isSigningOut),((e,t)=>n=>!(n&&e!==n||!t))),s=_g((e=>e.statuses.executePaymentMethodCheckoutMethodId),(e=>e.statuses.isExecutingPaymentMethodCheckout),((e,t)=>n=>!(n&&e!==n||!t))),d=_g((e=>e.statuses.initializeMethodId),(e=>e.statuses.isInitializing),((e,t)=>n=>!(n&&e!==n||!t))),c=_g((e=>e.data),(e=>t=>!(!e[t]||!e[t].isInitialized))),l=_g((e=>e.statuses.widgetInteractionMethodId),(e=>e.statuses.isWidgetInteracting),((e,t)=>n=>!(n&&e!==n||!t)));return(0,T.B4)(((u=Cv)=>({getSignInError:e(u),getSignOutError:t(u),getExecutePaymentMethodCheckoutError:n(u),getInitializeError:i(u),getWidgetInteractionError:r(u),isSigningIn:o(u),isSigningOut:a(u),isExecutingPaymentMethodCheckout:s(u),isInitializing:d(u),isInitialized:c(u),isWidgetInteracting:l(u)})))}(),l=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g((e=>e.errors.removeGiftCertificateError),(e=>()=>e)),n=_g((e=>e.errors.applyGiftCertificateError),(e=>()=>e)),i=_g((e=>!!e.statuses.isApplyingGiftCertificate),(e=>()=>e)),r=_g((e=>!!e.statuses.isRemovingGiftCertificate),(e=>()=>e));return(0,T.B4)(((o=uv)=>({getGiftCertificates:e(o),getRemoveError:t(o),getApplyError:n(o),isApplying:i(o),isRemoving:r(o)})))}(),u=function(){const e=_g((e=>e.data),(e=>t=>{if(!e)return;const n=t.gateway?`${t.gateway}.${t.id}`:t.id,i=cb[n];return i?(0,c.filter)(e,i):[]})),t=_g((e=>e.data),((e=[])=>t=>{const n=(0,c.values)(cb);return e.find((e=>e.bigpayToken===t&&"card"===e.type&&n.some((t=>(0,c.isMatch)(e,t)))))})),n=_g(t,(e=>t=>db(e(t),(()=>new ne(K.MissingPaymentInstrument))))),i=_g((e=>e.data),(e=>()=>{if(e)return(0,c.flatMap)(cb,(t=>(0,c.filter)(e,(e=>(0,c.isMatch)(e,t)))))})),r=_g((e=>e.meta),(e=>()=>e)),o=_g((e=>e.errors.loadError),(e=>()=>e)),a=_g((e=>e.errors.failedInstrument),(e=>e.errors.deleteError),((e,t)=>n=>{if(!n||e===n)return t})),s=_g((e=>e.statuses.isLoading),(e=>()=>!!e)),d=_g((e=>e.statuses.deletingInstrument),(e=>e.statuses.isDeleting),((e,t)=>n=>!(n&&e!==n||!t)));return(0,T.B4)(((c=mf)=>({getCardInstrument:t(c),getCardInstrumentOrThrow:n(c),getInstruments:i(c),getInstrumentsByPaymentMethod:e(c),getInstrumentsMeta:r(c),getLoadError:o(c),getDeleteError:a(c),isLoading:s(c),isDeleting:d(c)})))}(),h=function(){const e=_g((e=>e.data),(e=>(t=[],n)=>{const i=(0,c.find)(t,{code:n});return(e?e.shippingAddress:[]).map((e=>o(e,t,i)))})),t=_g((e=>e.data),(e=>(t=[],n)=>{const i=(0,c.find)(t,{code:n});return(e?e.billingAddress:[]).map((e=>o(e,t,i)))})),n=_g((e=>e.data),(e=>()=>e?e.customerAccount:[])),i=_g((e=>e.errors.loadError),(e=>()=>e)),r=_g((e=>!!e.statuses.isLoading),(e=>()=>e));function o(e,t,n){return"countryCode"===e.name?function(e,t=[],n){if(!t.length)return e;const{code:i=""}=n||{},r=t.map((({code:e,name:t})=>({value:e,label:t})));return Object.assign(Object.assign({},e),{options:{items:r},default:i,type:"array",fieldType:"dropdown",itemtype:"string"})}(e,t,n):"stateOrProvince"===e.name?function(e,t){const{subdivisions:n=[],requiresState:i}=t||{};if(!n.length)return Object.assign(Object.assign({},e),{required:null!=i&&i});const r=n.map((({code:e,name:t})=>({value:e,label:t})));return Object.assign(Object.assign({},e),{name:"stateOrProvinceCode",options:{items:r},required:null==i||i,type:"array",fieldType:"dropdown",itemtype:"string"})}(e,n):"postalCode"===e.name?function(e,t){const{hasPostalCodes:n=[]}=t||{};return void 0===n?e:Object.assign(Object.assign({},e),{required:Boolean(n)})}(e,n):e}return(0,T.B4)(((o=Nv)=>({getShippingAddressFields:e(o),getBillingAddressFields:t(o),getCustomerAccountFields:n(o),getLoadError:i(o),isLoading:r(o)})))}(),m=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g((e=>e.meta),(e=>()=>e)),n=_g((e=>e.data),(e=>(t,n)=>(0,c.find)(e,n?{id:t,gateway:n}:{id:t}))),i=_g(n,(e=>(t,n)=>db(e(t,n),(()=>new ne(K.MissingPaymentMethod))))),r=_g((e=>e.errors.loadError),(e=>()=>e)),o=_g((e=>e.errors.loadMethodId),(e=>e.errors.loadMethodError),((e,t)=>n=>{if(!n||e===n)return t})),a=_g((e=>e.statuses.isLoading),(e=>()=>!!e)),s=_g((e=>e.statuses.loadMethodId),(e=>e.statuses.isLoadingMethod),((e,t)=>n=>!(n&&e!==n||!t)));return(0,T.B4)(((d=Zv)=>({getPaymentMethods:e(d),getPaymentMethodsMeta:t(d),getPaymentMethod:n(d),getPaymentMethodOrThrow:i(d),getLoadError:r(d),getLoadMethodError:o(d),isLoading:a(d),isLoadingMethod:s(d)})))}(),p=function(){const e=_g((e=>e.errors.initializeMethodId),(e=>e.errors.initializeError),((e,t)=>n=>{if(!n||e===n)return t})),t=_g((e=>e.errors.executeMethodId),(e=>e.errors.executeError),((e,t)=>n=>{if(!n||e===n)return t})),n=_g((e=>e.errors.finalizeMethodId),(e=>e.errors.finalizeError),((e,t)=>n=>{if(!n||e===n)return t})),i=_g((e=>e.errors.widgetInteractionMethodId),(e=>e.errors.widgetInteractionError),((e,t)=>n=>{if(!n||e===n)return t})),r=_g((e=>e.statuses.initializeMethodId),(e=>e.statuses.isInitializing),((e,t)=>n=>!(n&&e!==n||!t))),o=_g((e=>e.data),(e=>t=>{const n=t.gatewayId?`${t.methodId}.${t.gatewayId}`:t.methodId;return!(!e[n]||!e[n].isInitialized)})),a=_g((e=>e.statuses.executeMethodId),(e=>e.statuses.isExecuting),((e,t)=>n=>!(n&&e!==n||!t))),s=_g((e=>e.statuses.finalizeMethodId),(e=>e.statuses.isFinalizing),((e,t)=>n=>!(n&&e!==n||!t))),d=_g((e=>e.statuses.widgetInteractionMethodId),(e=>e.statuses.isWidgetInteracting),((e,t)=>n=>!(n&&e!==n||!t)));return(0,T.B4)(((c=of)=>({getInitializeError:e(c),getExecuteError:t(c),getFinalizeError:n(c),getWidgetInteractingError:i(c),isInitializing:r(c),isInitialized:o(c),isExecuting:a(c),isFinalizing:s(c),isWidgetInteracting:d(c)})))}(),y=function(){const e=_g((e=>e.data),(e=>(t,n)=>{if(!e)return;const i=Af(Of({consignmentId:t,searchArea:n})),r=btoa(`${JSON.stringify(i)}`);return e[r]})),t=_g((e=>e.errors.loadError),(e=>()=>e)),n=_g((e=>!!e.statuses.isLoading),(e=>()=>e));return(0,T.B4)(((i=kf)=>({getPickupOptions:e(i),getLoadError:t(i),isLoading:n(i)})))}(),g=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g(e,(e=>()=>db(e(),(()=>new ne(K.MissingPaymentProviderCustomer)))));return(0,T.B4)(((n=lf)=>({getPaymentProviderCustomer:e(n),getPaymentProviderCustomerOrThrow:t(n)})))}(),v=function(){const e=_g((e=>e.data),(e=>t=>e[t]));return(0,T.B4)(((t=bf)=>({getCheckout:e(t)})))}(),f=function(){const e=_g((e=>e.data),(e=>()=>{const t=null==e?void 0:e.find((e=>!e.selectedPickupOption));return null==t?void 0:t.shippingAddress})),t=_g(e,(e=>()=>db(e(),(()=>new ne(K.MissingShippingAddress))))),n=_g((e=>e.data),(e=>()=>{const t=null==e?void 0:e.filter((e=>!e.selectedPickupOption));return t?t.map((e=>e.shippingAddress)):[]})),i=_g(n,(e=>()=>db(e(),(()=>new ne(K.MissingShippingAddress)))));return(0,T.B4)(((r=wf)=>({getShippingAddress:e(r),getShippingAddressOrThrow:t(r),getShippingAddresses:n(r),getShippingAddressesOrThrow:i(r)})))}(),b=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g((e=>e.errors.loadError),(e=>()=>e)),n=_g((e=>e.statuses.isLoading),(e=>()=>!!e));return(0,T.B4)(((i=Df)=>({getShippingCountries:e(i),getLoadError:t(i),isLoading:n(i)})))}(),S=function(){const e=_g((e=>e.errors.updateAddressMethodId),(e=>e.errors.updateAddressError),((e,t)=>n=>{if(!n||e===n)return t})),t=_g((e=>e.errors.selectOptionMethodId),(e=>e.errors.selectOptionError),((e,t)=>n=>{if(!n||e===n)return t})),n=_g((e=>e.errors.initializeMethodId),(e=>e.errors.initializeError),((e,t)=>n=>{if(!n||e===n)return t})),i=_g((e=>e.errors.widgetInteractionMethodId),(e=>e.errors.widgetInteractionError),((e,t)=>n=>{if(!n||e===n)return t})),r=_g((e=>e.statuses.updateAddressMethodId),(e=>e.statuses.isUpdatingAddress),((e,t)=>n=>!(n&&e!==n||!t))),o=_g((e=>e.statuses.selectOptionMethodId),(e=>e.statuses.isSelectingOption),((e,t)=>n=>!(n&&e!==n||!t))),a=_g((e=>e.statuses.initializeMethodId),(e=>e.statuses.isInitializing),((e,t)=>n=>!(n&&e!==n||!t))),s=_g((e=>e.data),(e=>t=>!(!e[t]||!e[t].isInitialized))),d=_g((e=>e.statuses.widgetInteractionMethodId),(e=>e.statuses.isWidgetInteracting),((e,t)=>n=>!(n&&e!==n||!t)));return(0,T.B4)(((c=Lf)=>({getUpdateAddressError:e(c),getSelectOptionError:t(c),getInitializeError:n(c),getWidgetInteractionError:i(c),isUpdatingAddress:r(c),isSelectingOption:o(c),isInitializing:a(c),isInitialized:s(c),isWidgetInteracting:d(c)})))}(),C=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g(e,(e=>()=>db(e(),(()=>new ne(K.MissingConsignments))))),n=_g((e=>e.data),(e=>t=>{if(e&&e.length)return(0,c.find)(e,{id:t})})),i=_g((e=>e.data),(e=>t=>{if(e&&e.length)return(0,c.find)(e,(e=>{return n=e.shippingAddress,i=t,(0,c.isEqual)(lb(n),lb(i));var n,i}))})),r=_g((e=>e.data),(e=>()=>{if(e&&e.length)return e[0].selectedShippingOption})),o=_g((e=>e.errors.loadError),(e=>()=>e)),a=_g((e=>e.errors.createError),(e=>()=>e)),s=_g((e=>e.errors.loadShippingOptionsError),(e=>()=>e)),d=_g(e,((e,{cart:t})=>t.getCart),((e,t)=>()=>{const n=t();if(!n)return[];const i=(e()||[]).reduce(((e,t)=>e.concat(t.lineItemIds)),[]);return(n.lineItems.physicalItems||[]).filter((e=>i.indexOf(e.id)<0))})),l=_g((e=>e.errors.updateError),(e=>t=>t?e[t]:(0,c.find)(e))),u=_g((e=>e.errors.deleteError),(e=>t=>t?e[t]:(0,c.find)(e))),h=_g(i,l,a,((e,t,n)=>i=>{const r=e(i);return r?t(r.id):n()})),m=_g((e=>e.errors.updateShippingOptionError),(e=>t=>t?e[t]:(0,c.find)(e))),p=_g((e=>e.statuses.isLoading),(e=>()=>!0===e)),y=_g((e=>e.statuses.isLoadingShippingOptions),(e=>()=>!0===e)),g=_g((e=>e.statuses.isCreating),(e=>()=>!0===e)),v=_g((e=>e.statuses.isUpdating),(e=>t=>t?!0===e[t]:!0===(0,c.find)(e))),f=_g((e=>e.statuses.isDeleting),(e=>t=>t?!0===e[t]:!0===(0,c.find)(e))),b=_g(i,v,g,((e,t,n)=>i=>{const r=e(i);return r?t(r.id):n()})),S=_g((e=>e.statuses.isUpdatingShippingOption),(e=>t=>t?!0===e[t]:!0===(0,c.find)(e)));return(0,T.B4)(((c=wf,C)=>({getConsignments:e(c),getConsignmentsOrThrow:t(c),getConsignmentById:n(c),getConsignmentByAddress:i(c),getShippingOption:r(c),getLoadError:o(c),getCreateError:a(c),getLoadShippingOptionsError:s(c),getUnassignedItems:d(c,{cart:C}),getUpdateError:l(c),getDeleteError:u(c),getItemAssignmentError:h(c),getUpdateShippingOptionError:m(c),isLoading:p(c),isLoadingShippingOptions:y(c),isCreating:g(c),isUpdating:v(c),isDeleting:f(c),isAssigningItems:b(c),isUpdatingShippingOption:S(c)})))}(),w=function(){const e=_g((e=>e.data),((e,{billingAddress:t})=>t.getBillingAddress),((e,{cart:t})=>t.getCart),((e,{customer:t})=>t.getCustomer),((e,{consignments:t})=>t.getConsignments),((e,{coupons:t})=>t.getCoupons),((e,{giftCertificates:t})=>t.getGiftCertificates),((e,t,n,i,r,o,a)=>()=>{const s=t(),d=n(),c=i(),l=r()||[],u=o()||[],h=a()||[];if(e&&d&&c)return Object.assign(Object.assign({},e),{billingAddress:s,cart:d,customer:c,consignments:l,coupons:u,giftCertificates:h})})),t=_g(e,(e=>()=>db(e(),(()=>new ne(K.MissingCheckout))))),n=_g(e,(e=>t=>{const n=e();if(!n)return;const i=n.grandTotal||0,r=n.customer.storeCredit||0;return t?Math.max(i-r,0):n.outstandingBalance})),i=_g((e=>e.errors.loadError),(e=>()=>e)),r=_g((e=>e.errors.updateError),(e=>()=>e)),o=_g((e=>e.statuses.isExecutingSpamCheck),(e=>()=>!0===e)),a=_g((e=>e.statuses.isLoading),(e=>()=>!0===e)),s=_g((e=>e.statuses.isUpdating),(e=>()=>!0===e));return(0,T.B4)(((d=ib,c,l,u,h,m,p)=>({getCheckout:e(d,{billingAddress:c,cart:l,consignments:u,coupons:h,customer:m,giftCertificates:p}),getCheckoutOrThrow:t(d,{billingAddress:c,cart:l,consignments:u,coupons:h,customer:m,giftCertificates:p}),getOutstandingBalance:n(d,{billingAddress:c,cart:l,consignments:u,coupons:h,customer:m,giftCertificates:p}),getLoadError:i(d),getUpdateError:r(d),isExecutingSpamCheck:o(d),isLoading:a(d),isUpdating:s(d)})))}(),_=function(){const e=_g((e=>e.data),((e,{billingAddress:t})=>t.getOrderBillingAddress()),((e,{coupons:t})=>t.getCoupons()),((e,t,n=[])=>()=>{if(e&&t)return Object.assign(Object.assign({},e),{billingAddress:t,coupons:n})})),t=_g(e,(e=>()=>db(e(),(()=>new ne(K.MissingOrder))))),n=_g((e=>e.meta),(e=>()=>e)),i=_g((e=>e.errors.loadError),(e=>()=>e)),r=_g((e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.payments}),((e=[])=>t=>{const n=e.find((({providerId:e})=>e===t));return null==n?void 0:n.paymentId})),o=_g((e=>!!e.statuses.isLoading),(e=>()=>e));return(0,T.B4)(((a=Uv,s,d)=>({getOrder:e(a,{billingAddress:s,coupons:d}),getOrderOrThrow:t(a,{billingAddress:s,coupons:d}),getOrderMeta:n(a),getLoadError:i(a),getPaymentId:r(a),isLoading:o(a)})))}(),I=function(){const e=_g((e=>e.data),(e=>()=>e));return(0,T.B4)(((t=Wv)=>({getOrderBillingAddress:e(t)})))}(),P=function(){const e=_g((({order:e})=>e.getOrderMeta),(e=>()=>{const t=e();return t&&t.payment})),t=_g((({order:e})=>e.getOrder),(e=>()=>{const t=e();return(0,c.find)(t&&t.payments,(({providerId:e})=>"giftcertificate"!==e&&"storecredit"!==e))})),n=_g((({checkout:e})=>e.getCheckout),(e=>()=>{const t=e();return(0,c.find)(t&&t.payments,(({providerType:e})=>"PAYMENT_TYPE_HOSTED"===e))})),i=_g(e,n,t,((e,t,n)=>()=>{const i=e();if(i&&i.id)return{providerId:i.id,gatewayId:i.gateway};const r=t()||n();return r&&r.providerId?{providerId:r.providerId,gatewayId:r.gatewayId}:void 0})),r=_g(i,(e=>()=>db(e(),(()=>new ne(K.MissingPaymentId))))),o=_g(e,n,t,((e,t,n)=>()=>{const i=e();if(i&&i.status)return i.status.replace("PAYMENT_STATUS_","");const r=t()||n();return r?r.detail.step:void 0})),a=_g(o,(e=>()=>db(e(),(()=>new ne(K.MissingPaymentStatus))))),s=_g((({order:e})=>e.getOrderMeta),(e=>()=>{const t=e();return t&&t.token})),d=_g(s,(e=>()=>db(e(),(()=>new ne(K.MissingPaymentToken))))),l=_g(e,(e=>()=>{const t=e();return t&&t.redirectUrl})),u=_g(l,(e=>()=>db(e(),(()=>new ne(K.MissingPaymentRedirectUrl))))),h=_g((({checkout:e})=>e.getOutstandingBalance),(e=>(t=!1)=>{const n=e(t);return!!n&&n>0})),m=_g(o,(e=>t=>!(!t||!t.nonce)||e()===py||e()===yy));return(0,T.B4)(((e,t)=>({getPaymentId:i({checkout:e,order:t}),getPaymentIdOrThrow:r({checkout:e,order:t}),getPaymentStatus:o({checkout:e,order:t}),getPaymentStatusOrThrow:a({checkout:e,order:t}),getPaymentToken:s({checkout:e,order:t}),getPaymentTokenOrThrow:d({checkout:e,order:t}),getPaymentRedirectUrl:l({checkout:e,order:t}),getPaymentRedirectUrlOrThrow:u({checkout:e,order:t}),isPaymentDataRequired:h({checkout:e,order:t}),isPaymentDataSubmitted:m({checkout:e,order:t})})))}(),E=function(){const e=_g((e=>e.errors.applyError),(e=>()=>e)),t=_g((e=>!!e.statuses.isApplying),(e=>()=>e));return(0,T.B4)(((n=ub)=>({getApplyError:e(n),isApplying:t(n)})))}(),O=function(){const e=_g((e=>e.errors.updateError),(e=>()=>e)),t=_g((e=>!!e.statuses.isUpdating),(e=>()=>e));return(0,T.B4)(((n=Xf)=>({getUpdateError:e(n),isUpdating:t(n)})))}(),A=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g((e=>e.errors.sendError),(e=>()=>e)),n=_g((e=>!!e.statuses.isSending),(e=>()=>e));return(0,T.B4)(((i=Hf)=>({getEmail:e(i),getSendError:t(i),isSending:n(i)})))}(),k=function(){const e=_g((e=>e.data),(e=>()=>e)),t=_g((e=>e.data),(e=>t=>null==e?void 0:e.find((e=>e.region===t)))),n=_g((e=>e.errors.loadError),(e=>()=>e)),i=_g((e=>e.statuses.isLoading),(e=>()=>!!e));return(0,T.B4)(((r=Ev)=>({getExtensions:e(r),getExtensionByRegion:t(r),getLoadError:n(r),isLoading:i(r)})))}();return(c,T={})=>{const N=e(c.billingAddress),M=t(c.cart),x=n(c.checkoutButton),D=r(c.countries),z=o(c.coupons),F=a(c.customer),B=s(c.customerStrategies),R=k(c.extensions),L=h(c.formFields),j=l(c.giftCertificates),U=u(c.instruments),V=I(c.orderBillingAddress),q=m(c.paymentMethods),H=g(c.paymentProviderCustomer),G=p(c.paymentStrategies),$=y(c.pickupOptions),W=v(c.remoteCheckout),Y=f(c.consignments),K=b(c.shippingCountries),Q=S(c.shippingStrategies),J=O(c.subscriptions),Z=E(c.storeCredit),X=A(c.signInEmail),ee=C(c.consignments,M),te=w(c.checkout,N,M,ee,z,F,j),ne=_(c.order,V,z),ie=P(te,ne),re={billingAddress:N,cart:M,checkout:te,checkoutButton:x,config:i(c.config,c.formFields),consignments:ee,countries:D,coupons:z,customer:F,customerStrategies:B,extensions:R,form:L,giftCertificates:j,instruments:U,order:ne,orderBillingAddress:V,payment:ie,paymentMethods:q,paymentProviderCustomer:H,paymentStrategies:G,pickupOptions:$,remoteCheckout:W,shippingAddress:Y,shippingCountries:K,shippingStrategies:Q,signInEmail:X,subscriptions:J,storeCredit:Z};return T.shouldWarnMutation?function(e){return Object.keys(e).reduce(((t,n)=>(t[n]=function(e){return function(e){const t=Object.create(e);return function(e,t){let n=Object.getPrototypeOf(e);for(;n;)t(n),n=Object.getPrototypeOf(n)}(e,(n=>{Object.getOwnPropertyNames(n).forEach((n=>{"constructor"!==n&&"function"==typeof t[n]&&"_"!==n.charAt(0)&&(t[n]=((e,t)=>(...n)=>(0,d.ol)(e[t].call(e,...n)))(e,n))}))})),t}(e)}(e[n]),t)),{})}(re):re}}function mb(e={},t){const n=(o=function(){const e=new Ag;return["catalog_only","empty_cart","invalid_order_id","invalid_order_token","missing_order_token","missing_provider_token","missing_shipping_method","order_completion_error","order_could_not_be_finalized_error","order_create_failed","provider_fatal_error","provider_setup_error","stock_too_low"].forEach((t=>{e.register(t,((e,t)=>new Pg(e,t)))})),e.register("invalid_payment_provider",(e=>new hr(e))),e.register("payment_config_not_found",(e=>new hr(e))),e}(),e=>(0,g.H)(e).pipe((0,C.W)((e=>{if(e instanceof Error||e.payload instanceof Error)throw e;if((t=e.payload)&&"object"==typeof t&&["body","headers","status","statusText"].every((e=>Object.prototype.hasOwnProperty.call(t,e)))){const t=e.payload.body&&e.payload.body.detail;throw Object.assign(Object.assign({},e),{payload:o.createError(e.payload,t)})}var t;throw e})))),i=hb(),r=(0,d.HY)({billingAddress:zg,cart:Vg,checkout:rb,checkoutButton:Jg,config:nv,consignments:_f,countries:Bv,coupons:sv,customer:vv,customerStrategies:wv,extensions:Ov,formFields:Mv,giftCertificates:hv,instruments:pf,orderBillingAddress:Yv,order:Vv,payment:Qv,paymentMethods:Xv,paymentStrategies:af,pickupOptions:Tf,paymentProviderCustomer:uf,remoteCheckout:Sf,shippingCountries:zf,shippingStrategies:jf,signInEmail:Gf,subscriptions:eb,storeCredit:Qf});var o;return(0,d.iN)(r,e,Object.assign({actionTransformer:n,stateTransformer:e=>i(e)},t))}function pb(e){"https:"!==document.location.protocol&&be().warn("The BigCommerce Checkout SDK should not be used on a non-HTTPS page"),"production"!==ye()&&be().warn("Note that the development build is not optimized. To create a production build, set process​.env.NODE_ENV to `production`.");const t={meta:{externalSource:e&&e.externalSource,host:null==e?void 0:e.host,locale:null==e?void 0:e.locale,variantIdentificationToken:window.checkoutVariantIdentificationToken},errors:{},statuses:{}},{locale:n="",shouldWarnMutation:i=!0,errorLogger:r=new me}=e||{},o=(0,a.createRequestSender)({host:e&&e.host}),d=mb({config:t},{shouldWarnMutation:i}),l=fm(d),u=new ym(o),h=new it(o),m=new we(new Oe(o)),p=Et((0,s.Hb)()),y=new Ot(o),g=new St(p,y),v=new vm(u,new Em(h)),f=new Tp(new Np(o)),b=new ot(new at(o)),S=new rt(h,m,b),C=jp(d),w=bm(C,Y,{useFallback:!0}),_=function(e,t){const n=new Ye;for(const[,i]of Object.entries(t))if(He(i))for(const t of i.resolveIds){const r=Ge((()=>i(e)),i.resolveIds);n.register(t,r)}return n}(C,W),I=new Qt(new Jt(o)),P=new dn,E=new un(d,P),O=he(d,function(){const e=function(){const e=_g((({checkout:e})=>e.getCheckout),(e=>zp(e))),t=_g((({order:e})=>e.getOrder),(e=>zp(e))),n=_g((({config:e})=>e.getStoreConfig),(e=>zp(e))),i=_g((({shippingAddress:e})=>e.getShippingAddress),(({config:e})=>e.getContextConfig),((e,t)=>zp((()=>{const n=e(),i=t();if(!n){if(!i||!i.geoCountryCode)return;return{firstName:"",lastName:"",company:"",address1:"",address2:"",city:"",stateOrProvince:"",stateOrProvinceCode:"",postalCode:"",country:"",phone:"",customFields:[],countryCode:i.geoCountryCode}}return n})))),r=_g((({consignments:e})=>e.getConsignments),(e=>zp((()=>{const t=e(),n=null==t?void 0:t.find((e=>!e.selectedPickupOption));return null==n?void 0:n.availableShippingOptions})))),o=_g((({consignments:e})=>e.getConsignments),(e=>zp(e))),a=_g((({consignments:e})=>e.getConsignments),(e=>zp((()=>{const t=e(),n=null==t?void 0:t.find((e=>!e.selectedPickupOption));return null==n?void 0:n.selectedShippingOption})))),s=_g((({shippingCountries:e})=>e.getShippingCountries),(e=>zp(e))),d=_g((({billingAddress:e})=>e.getBillingAddress),(({config:e})=>e.getContextConfig),((e,t)=>zp((()=>{const n=e(),i=t();return(!n||(0,c.values)((0,c.omit)(n,"shouldSaveAddress","email","id")).every((e=>!e||!e.length)))&&i&&i.geoCountryCode?{id:n?n.id:"",firstName:"",lastName:"",company:"",address1:"",address2:"",city:"",email:n?n.email:"",stateOrProvince:"",stateOrProvinceCode:"",postalCode:"",country:"",phone:"",customFields:[],countryCode:i.geoCountryCode}:n})))),l=_g((({countries:e})=>e.getCountries),(e=>zp(e))),u=_g((({paymentMethods:e})=>e.getPaymentMethods),(e=>zp(e))),h=_g((({paymentMethods:e})=>e.getPaymentMethod),(e=>zp(e))),m=_g((({payment:e})=>e.getPaymentId),(({paymentMethods:e})=>e.getPaymentMethod),((e,t)=>zp((()=>{const n=e();return n&&t(n.providerId,n.gatewayId)})))),p=_g((({cart:e})=>e.getCart),(e=>zp(e))),y=_g((({coupons:e})=>e.getCoupons),(e=>zp(e))),g=_g((({giftCertificates:e})=>e.getGiftCertificates),(e=>zp(e))),v=_g((({customer:e})=>e.getCustomer),(e=>zp(e))),f=_g((({signInEmail:e})=>e.getEmail),(e=>zp(e))),b=_g((({payment:e})=>e.isPaymentDataRequired),(e=>zp(e))),S=_g((({payment:e})=>e.isPaymentDataSubmitted),(({paymentMethods:e})=>e.getPaymentMethod),((e,t)=>zp(((n,i)=>e(t(n,i)))))),C=_g((({instruments:e})=>e.getInstruments),(({instruments:e})=>e.getInstrumentsByPaymentMethod),((e,t)=>zp((function(n){return n?t(n):e()})))),w=_g((({form:e})=>e.getCustomerAccountFields),(e=>zp(e))),_=_g((({form:e})=>e.getBillingAddressFields),(({countries:e})=>e.getCountries),((e,t)=>zp((n=>e(t(),n))))),I=_g((({form:e})=>e.getShippingAddressFields),(({shippingCountries:e})=>e.getShippingCountries),((e,t)=>zp((n=>e(t(),n))))),P=_g((({config:e})=>e.getFlashMessages),(e=>zp(e))),E=_g((({pickupOptions:e})=>e.getPickupOptions),(e=>zp(e))),O=_g((({config:e})=>e.getStoreConfig),(e=>zp((()=>{const t=e();if(t)return t.checkoutSettings.checkoutUserExperienceSettings})))),A=_g((({extensions:e})=>e.getExtensions),(e=>zp(e))),k=_g((({paymentProviderCustomer:e})=>e.getPaymentProviderCustomer),(e=>zp(e))),N=_g((({extensions:e})=>e.getExtensionByRegion),(e=>zp(e)));return(0,T.B4)((c=>({getCheckout:e(c),getOrder:t(c),getConfig:n(c),getExtensions:A(c),getExtensionByRegion:N(c),getFlashMessages:P(c),getShippingAddress:i(c),getShippingOptions:r(c),getConsignments:o(c),getSelectedShippingOption:a(c),getShippingCountries:s(c),getBillingAddress:d(c),getBillingCountries:l(c),getPaymentMethods:u(c),getPaymentMethod:h(c),getSelectedPaymentMethod:m(c),getCart:p(c),getCoupons:y(c),getGiftCertificates:g(c),getCustomer:v(c),isPaymentDataRequired:b(c),isPaymentDataSubmitted:S(c),getSignInEmail:f(c),getInstruments:C(c),getCustomerAccountFields:w(c),getBillingAddressFields:_(c),getShippingAddressFields:I(c),getPickupOptions:E(c),getUserExperienceSettings:O(c),getPaymentProviderCustomer:k(c)})))}(),t=function(){const e=Ig((e=>e),(e=>()=>{for(const t of Object.keys(e)){const n=e[t]();if(n)return n}})),t=_g((({shippingStrategies:e})=>e.getSelectOptionError),(({consignments:e})=>e.getUpdateShippingOptionError),((e,t)=>n=>e()||t(n)));return(0,T.B4)((n=>{const i={getLoadCheckoutError:n.checkout.getLoadError,getUpdateCheckoutError:n.checkout.getUpdateError,getSubmitOrderError:n.paymentStrategies.getExecuteError,getFinalizeOrderError:n.paymentStrategies.getFinalizeError,getLoadOrderError:n.order.getLoadError,getLoadCartError:n.cart.getLoadError,getLoadBillingCountriesError:n.countries.getLoadError,getLoadShippingCountriesError:n.shippingCountries.getLoadError,getLoadPaymentMethodsError:n.paymentMethods.getLoadError,getLoadPaymentMethodError:n.paymentMethods.getLoadMethodError,getInitializePaymentError:n.paymentStrategies.getInitializeError,getSignInError:n.customerStrategies.getSignInError,getSignOutError:n.customerStrategies.getSignOutError,getInitializeCustomerError:n.customerStrategies.getInitializeError,getLoadShippingOptionsError:n.consignments.getLoadShippingOptionsError,getSelectShippingOptionError:t(n),getContinueAsGuestError:n.billingAddress.getContinueAsGuestError,getUpdateBillingAddressError:n.billingAddress.getUpdateError,getUpdateSubscriptionsError:n.subscriptions.getUpdateError,getUpdateShippingAddressError:n.shippingStrategies.getUpdateAddressError,getDeleteConsignmentError:n.consignments.getDeleteError,getUpdateConsignmentError:n.consignments.getUpdateError,getCreateConsignmentsError:n.consignments.getCreateError,getInitializeShippingError:n.shippingStrategies.getInitializeError,getApplyStoreCreditError:n.storeCredit.getApplyError,getApplyCouponError:n.coupons.getApplyError,getRemoveCouponError:n.coupons.getRemoveError,getApplyGiftCertificateError:n.giftCertificates.getApplyError,getRemoveGiftCertificateError:n.giftCertificates.getRemoveError,getLoadInstrumentsError:n.instruments.getLoadError,getDeleteInstrumentError:n.instruments.getDeleteError,getLoadConfigError:n.config.getLoadError,getSignInEmailError:n.signInEmail.getSendError,getCreateCustomerAccountError:n.customer.getCreateAccountError,getCreateCustomerAddressError:n.customer.getCreateAddressError,getPickupOptionsError:n.pickupOptions.getLoadError,getLoadExtensionsError:n.extensions.getLoadError};return Object.assign({getError:e(i)},i)}))}(),n=function(){const e=Ig((e=>e),(e=>()=>Object.keys(e).some((t=>e[t]())))),t=_g((({shippingStrategies:e})=>e.isSelectingOption),(({consignments:e})=>e.isUpdatingShippingOption),((e,t)=>n=>e()||t(n))),n=_g((({customerStrategies:e})=>e.isInitializing),(({customerStrategies:e})=>e.isSigningIn),(({customerStrategies:e})=>e.isSigningOut),(({customerStrategies:e})=>e.isExecutingPaymentMethodCheckout),(({customerStrategies:e})=>e.isWidgetInteracting),((e,t,n,i,r)=>o=>e(o)||t(o)||n(o)||i(o)||r(o))),i=_g((({shippingStrategies:e})=>e.isInitializing),(({shippingStrategies:e})=>e.isUpdatingAddress),(({shippingStrategies:e})=>e.isSelectingOption),(({shippingStrategies:e})=>e.isWidgetInteracting),((e,t,n,i)=>r=>e(r)||t(r)||n(r)||i(r))),r=_g((({paymentStrategies:e})=>e.isInitializing),(({paymentStrategies:e})=>e.isExecuting),(({paymentStrategies:e})=>e.isFinalizing),(({paymentStrategies:e})=>e.isWidgetInteracting),((e,t,n,i)=>r=>e(r)||t(r)||n(r)||i(r))),o=_g((({paymentStrategies:e})=>e.isExecuting),(({checkout:e})=>e.isExecutingSpamCheck),((e,t)=>n=>e(n)||t()));return(0,T.B4)((a=>{const s={isLoadingCheckout:a.checkout.isLoading,isUpdatingCheckout:a.checkout.isUpdating,isExecutingSpamCheck:a.checkout.isExecutingSpamCheck,isSubmittingOrder:o(a),isFinalizingOrder:a.paymentStrategies.isFinalizing,isLoadingOrder:a.order.isLoading,isLoadingCart:a.cart.isLoading,isLoadingBillingCountries:a.countries.isLoading,isLoadingShippingCountries:a.shippingCountries.isLoading,isLoadingPaymentMethods:a.paymentMethods.isLoading,isLoadingPaymentMethod:a.paymentMethods.isLoadingMethod,isInitializingPayment:a.paymentStrategies.isInitializing,isSigningIn:a.customerStrategies.isSigningIn,isSigningOut:a.customerStrategies.isSigningOut,isExecutingPaymentMethodCheckout:a.customerStrategies.isExecutingPaymentMethodCheckout,isInitializingCustomer:a.customerStrategies.isInitializing,isInitializedCustomer:a.customerStrategies.isInitialized,isLoadingShippingOptions:a.consignments.isLoadingShippingOptions,isSelectingShippingOption:t(a),isUpdatingBillingAddress:a.billingAddress.isUpdating,isUpdatingSubscriptions:a.subscriptions.isUpdating,isCreatingCustomerAccount:a.customer.isCreatingCustomerAccount,isCreatingCustomerAddress:a.customer.isCreatingCustomerAddress,isContinuingAsGuest:a.billingAddress.isContinuingAsGuest,isUpdatingShippingAddress:a.shippingStrategies.isUpdatingAddress,isUpdatingConsignment:a.consignments.isUpdating,isDeletingConsignment:a.consignments.isDeleting,isCreatingConsignments:a.consignments.isCreating,isInitializingShipping:a.shippingStrategies.isInitializing,isApplyingStoreCredit:a.storeCredit.isApplying,isApplyingCoupon:a.coupons.isApplying,isRemovingCoupon:a.coupons.isRemoving,isApplyingGiftCertificate:a.giftCertificates.isApplying,isRemovingGiftCertificate:a.giftCertificates.isRemoving,isLoadingInstruments:a.instruments.isLoading,isDeletingInstrument:a.instruments.isDeleting,isLoadingConfig:a.config.isLoading,isSendingSignInEmail:a.signInEmail.isSending,isCustomerStepPending:n(a),isShippingStepPending:i(a),isPaymentStepPending:r(a),isLoadingPickupOptions:a.pickupOptions.isLoading};return Object.assign({isPending:e(s)},s)}))}();return i=>({data:e(i),errors:t(i),statuses:n(i)})}());return new Cg(d,O,E,function(e,t){const n={[nn.ConsignmentsChanged]:mn};return new hn(e,t,n)}(O,E),new re(new ce(o),f),S,m,new Qe(new Je(o),S,g),new bp(new Cp(o),h),new cm(new lm(o,{locale:n})),new ke(new Ue(o)),new tt(function(e,t,n){const i=new We,r=(0,s.vQ)(),o=new it(t),a=new rt(o,new we(new Oe(t)),new ot(new at(t))),d=new dt(new ct(t)),c=new pt(t),l=new yt(c,a),u=new St(Et(r),new Ot(t)),h=new Qe(new Je(t),a,u);return i.register("squarev2",(()=>new Dt(e,new yt(c,a)))),i.register("masterpass",(()=>new xt(e,d,l,new mt(r),n))),i.register("default",(()=>new At(e,h))),i}(d,o,n),_,C,r),new pe,new Ve(new qe(o)),new Hy(new Ky(l,o)),v,new dt(new ct(o)),new _m(function(e,t,n,i,r,o){const a=new Vp({defaultToken:Cm.CREDIT_CARD}),d=(0,s.vQ)(),c=new yp,l=new Km(t),u=jp(e),h=bm(u,Y),m=new it(n),p=new Em(m),y=new St(i,new Ot(n)),g=new vm(new ym(n),p),v=new xm(Et((0,s.Hb)())),f=new Ym(l,g,c,v),b=new dt(new ct(n)),S=new we(new Oe(n)),C=new ot(new at(n)),w=new rt(m,S,C),_=new _m(a,h,g,y,u,o),I=(0,N.createFormPoster)(),P=((e,t)=>new Ay(new Oy(e,t)))(I,v),E=new $m(e);return a.register(Cm.BARCLAYS,(()=>new Wp(e,g,f,E,new ny(e,f,new uy(new hy(d)))))),a.register(Cm.BRAINTREE_VISA_CHECKOUT,(()=>new Qp(e,w,b,_,f,g,function(e,t,n){const i=new Un(n),r=new oi(e,window,i),o=new Zp(r);return new Xp(o,t)}(d,n,u),new ey(d)))),a.register(Cm.CBA_MPGS,(()=>new vy(e,g,f,E,b,new fy(d),r))),a.register(Cm.CONVERGE,(()=>new by(e,g,f,E,I))),a.register(Cm.BNZ,(()=>new Kp(e,g,f,E,new ny(e,f,new uy(new hy(d)))))),a.register(Cm.MASTERPASS,(()=>new Sy(e,g,f,new mt(d),r))),a.register(Cm.PAYPAL_EXPRESS,(()=>new Cy(e,g,new wy(d)))),a.register(Cm.PAYPAL_EXPRESS_CREDIT,(()=>new Cy(e,g,new wy(d)))),a.register(Cm.PPSDK,(()=>new xy(e,g,((e,t,n,i,r)=>{const o=new zy;return o.register(Ny.CARD,(()=>new By(e,t,r,i))),o.register(Ny.NONE,(()=>new Ry(n,i))),o.register(Ny.UNSUPPORTED,(()=>{})),o})(e,g,n,P,E),new Uy(n,P),new Om("PPSDK")))),a.register(Cm.WE_PAY,(()=>new Vy(e,g,f,E,new qy(d)))),a}(d,l,o,p,n,r),w,v,g,C,r),new Qy(new Jy(o)),new Pp(new Ep(o,{locale:n}),d),new Zy(function(e,t){const n=new We,i=jp(e),r=new it(t),o=new Cp(t),a=new bp(o,r),d=new dt(new ct(t)),c=(0,s.vQ)(),l=new Tp(new Np(t)),u=new re(new ce(t),l),h=window,m=new Un(i);return n.register("amazonpay",(()=>new ig(e,a,new dt(new ct(t)),Mn(),new Zy(n)))),n.register("stripeupe",(()=>new gg(e,new eg(c),a,d))),n.register("braintreeacceleratedcheckout",(()=>new og(e,u,a,d,new fp,new Nr(new oi((0,s.vQ)(),h,m),h)))),n.register("paypalcommerceacceleratedcheckout",(()=>new yg(e,u,a,d,new fp,Aa(),Ra()))),n.register("default",(()=>new ag(e,a))),n}(d,o)),new vg(new fg(o)),g,new Op(new Ap(o)),f,b,I,P)}class yb extends pn{constructor(e){super(e||"An unexpected error has occurred during config creation process. Please try again later."),this.name="AmazonPayV2ConfigCreationError",this.type="amazon_pay_v2_config_creation_error"}}function gb(e){return e instanceof Object&&"buyNowInitializeOptions"in e}var vb=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class fb{constructor(e,t,n){this.paymentIntegrationService=e,this.amazonPayV2PaymentProcessor=t,this.amazonPayV2ConfigRequestSender=n}initialize(e){var t;return vb(this,void 0,void 0,(function*(){const{methodId:n,containerId:i,amazonpay:r}=e,{buttonColor:o}=r||{};if(!n||!i)throw new xn('Unable to proceed because "methodId" or "containerId" argument is not provided.');const{getPaymentMethodOrThrow:a}=this.paymentIntegrationService.getState(),s=a(n),{initializationData:d}=s;yield this.amazonPayV2PaymentProcessor.initialize(s),r||(yield this.paymentIntegrationService.loadDefaultCheckout());const c=gb(r)?void 0:r;gb(r)&&"function"==typeof(null===(t=r.buyNowInitializeOptions)||void 0===t?void 0:t.getBuyNowCartRequestBody)&&(this._buyNowInitializeOptions=r.buyNowInitializeOptions,this.amazonPayV2PaymentProcessor.updateBuyNowFlowFlag(!0)),this.amazonPayV2PaymentProcessor.renderAmazonPayButton({checkoutState:this.paymentIntegrationService.getState(),containerId:i,methodId:n,options:c,placement:_n.Cart,buttonColor:o,isButtonMicroTextDisabled:null==d?void 0:d.isButtonMicroTextDisabled}),this._buyNowInitializeOptions&&this.amazonPayV2PaymentProcessor.prepareCheckoutWithCreationRequestConfig(this._getCheckoutCreationRequestConfig.bind(this))}))}deinitialize(){return this.amazonPayV2PaymentProcessor.deinitialize()}_createBuyNowCartOrThrow(){var e,t;return vb(this,void 0,void 0,(function*(){const n=null===(t=null===(e=this._buyNowInitializeOptions)||void 0===e?void 0:e.getBuyNowCartRequestBody)||void 0===t?void 0:t.call(e);if(!n)throw new vn(yn.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(n)}catch(e){throw new pi}}))}_createCheckoutConfig(e){return vb(this,void 0,void 0,(function*(){try{const t=(yield this.amazonPayV2ConfigRequestSender.createCheckoutConfig(e)).body,{payload:n,public_key:i}=t,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["payload","public_key"]);return Object.assign({payloadJSON:n,publicKeyId:i},r)}catch(e){throw new yb}}))}_getCheckoutCreationRequestConfig(){return vb(this,void 0,void 0,(function*(){const e=yield this._createBuyNowCartOrThrow(),t={amount:String(e.baseAmount),currencyCode:e.currency.code};return{createCheckoutSessionConfig:yield this._createCheckoutConfig(e.id),estimatedOrderAmount:t,productType:0===fn(e)?Pn.PayOnly:Pn.PayAndShip}}))}}class bb{constructor(e){this._requestSender=e}createCheckoutConfig(e){const t={cartId:e},n=Object.assign({"X-API-INTERNAL":Ei,"Content-Type":Ai.Json},ki);return this._requestSender.post("/api/storefront/payment/amazonpay",{headers:n,body:t})}}const Sb=Ge((e=>{const t=(0,a.createRequestSender)(),n=new bb(t),i=Mn();return new fb(e,i,n)}),[{id:"amazonpay"}]);var Cb,wb,_b=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};!function(e){e.Subtotal="Subtotal",e.Shipping="Shipping"}(Cb||(Cb={})),function(e){e.Black="black",e.White="white",e.WhiteBorder="white-border"}(wb||(wb={}));class Ib{constructor(e,t,n,i,r){this._requestSender=e,this._paymentIntegrationService=t,this._sessionFactory=n,this._braintreeSdk=i,this._applePayScriptLoader=r,this._onAuthorizeCallback=c.noop,this._subTotalLabel=Cb.Subtotal,this._shippingLabel=Cb.Shipping}initialize(e){var t,n;return _b(this,void 0,void 0,(function*(){const{methodId:i,containerId:r,applepay:o}=e;if(!i||!o)throw new vn(yn.MissingPaymentMethod);yield this._applePayScriptLoader.loadSdk();const{onPaymentAuthorize:a,buyNowInitializeOptions:s,requiresShipping:d}=o;this._requiresShipping=d,this._buyNowInitializeOptions=s,this._onAuthorizeCallback=a,s||(yield this._paymentIntegrationService.loadDefaultCheckout()),yield this._paymentIntegrationService.loadPaymentMethod(i);const c=this._paymentIntegrationService.getState();return this._paymentMethod=c.getPaymentMethodOrThrow(i),c.getCart()&&(yield this._paymentIntegrationService.verifyCheckoutSpamProtection()),(null===(t=this._paymentMethod.initializationData)||void 0===t?void 0:t.gateway)===ii.BRAINTREE&&(yield this._initializeBraintreeSdk()),this._applePayButton=this._createButton(r,null===(n=this._paymentMethod.initializationData)||void 0===n?void 0:n.styleOption),this._applePayButton.addEventListener("click",this._handleWalletButtonClick.bind(this)),Promise.resolve()}))}deinitialize(){return Promise.resolve()}_createButton(e,t){const n=document.getElementById(e);if(!n)throw new xn("Unable to create wallet button without valid container ID.");const i=this._createApplePayButtonElement(t);return n.appendChild(i),i}_createApplePayButtonElement(e){const t=document.createElement("apple-pay-button");return t.setAttribute("buttonstyle",(e=>{switch(e){case wb.White:return"white";case wb.WhiteBorder:return"white-outline";case wb.Black:default:return"black"}})(e)),t.setAttribute("type","plain"),t.setAttribute("style","--apple-pay-button-width: 100%; --apple-pay-button-height: 40px; --apple-pay-button-border-radius: 4px;"),t}_handleWalletButtonClick(e){var t;return _b(this,void 0,void 0,(function*(){if(e.preventDefault(),!this._paymentMethod||!this._paymentMethod.initializationData)throw new vn(yn.MissingPaymentMethod);if(this._buyNowInitializeOptions&&"function"==typeof this._buyNowInitializeOptions.getBuyNowCartRequestBody){const{countryCode:e,currencyCode:n,merchantCapabilities:i,supportedNetworks:r,storeName:o}=this._paymentMethod.initializationData,a=this._getRequestWithEmptyTotal(e,n,r,i);this._requiresShipping&&(null===(t=a.requiredShippingContactFields)||void 0===t||t.push("postalAddress"));const s=this._sessionFactory.create(a);this._handleApplePayEvents(s,this._paymentMethod,o),s.begin()}else{const e=this._paymentIntegrationService.getState(),t=e.getCartOrThrow(),n=e.getStoreConfigOrThrow(),i=e.getCheckoutOrThrow(),r=this._getBaseRequest(t,i,n,this._paymentMethod),o=this._sessionFactory.create(r);this._handleApplePayEvents(o,this._paymentMethod,n.storeProfile.storeName),o.begin()}}))}_getRequestWithEmptyTotal(e,t,n,i){return{countryCode:e,currencyCode:t,supportedNetworks:n,merchantCapabilities:i,total:{label:"",amount:"0",type:"pending"},requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:["email","phone"]}}_getBaseRequest(e,t,n,i){var r;const{storeProfile:{storeCountryCode:o,storeName:a}}=n,{currency:{code:s,decimalPlaces:d}}=e,{initializationData:{merchantCapabilities:c,supportedNetworks:l}}=i,u=e.lineItems.physicalItems.length>0,h={requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:["email","phone"],countryCode:o,currencyCode:s,merchantCapabilities:c,supportedNetworks:l,lineItems:[],total:u?{label:a,amount:`${t.grandTotal.toFixed(d)}`,type:"pending"}:{label:a,amount:`${t.grandTotal.toFixed(d)}`,type:"final"}};if(u)null===(r=h.requiredShippingContactFields)||void 0===r||r.push("postalAddress");else{const e=[{label:this._subTotalLabel,amount:`${t.subtotal.toFixed(d)}`}];t.taxes.forEach((t=>e.push({label:t.name,amount:`${t.amount.toFixed(d)}`}))),h.lineItems=e}return h}_handleApplePayEvents(e,t,n){e.onvalidatemerchant=n=>_b(this,void 0,void 0,(function*(){try{const{body:i}=yield this._onValidateMerchant(t,n);e.completeMerchantValidation(i)}catch(e){throw new Error("Merchant validation failed")}})),this._buyNowInitializeOptions&&!this._requiresShipping&&(e.onpaymentmethodselected=()=>_b(this,void 0,void 0,(function*(){yield this._createBuyNowCart(),this._handlePaymentMethodSelected(e)}))),e.onshippingcontactselected=t=>_b(this,void 0,void 0,(function*(){this._buyNowInitializeOptions&&this._requiresShipping&&(yield this._createBuyNowCart()),yield this._handleShippingContactSelected(e,n,t)})),e.onshippingmethodselected=t=>_b(this,void 0,void 0,(function*(){yield this._handleShippingMethodSelected(e,n,t)})),e.oncancel=()=>_b(this,void 0,void 0,(function*(){try{const e=`/remote-checkout/${t.id}/signout`;return yield this._requestSender.get(e),yield this._paymentIntegrationService.loadCheckout()}catch(e){throw new ai}})),e.onpaymentauthorized=n=>_b(this,void 0,void 0,(function*(){return this._onPaymentAuthorized(n,e,t)}))}_createBuyNowCart(){var e,t;return _b(this,void 0,void 0,(function*(){try{const n=null===(t=null===(e=this._buyNowInitializeOptions)||void 0===e?void 0:e.getBuyNowCartRequestBody)||void 0===t?void 0:t.call(e);if(!n)throw new vn(yn.MissingCart);const i=yield this._paymentIntegrationService.createBuyNowCart(n);yield this._paymentIntegrationService.loadCheckout(i.id);const r=this._paymentIntegrationService.getState(),{shouldExecuteSpamCheck:o}=r.getCheckoutOrThrow();o&&(yield this._paymentIntegrationService.verifyCheckoutSpamProtection())}catch(e){throw new pi}}))}_handlePaymentMethodSelected(e){const t=this._paymentIntegrationService.getState(),n=t.getCartOrThrow(),i=t.getStoreConfigOrThrow(),r=t.getCheckoutOrThrow();if(!this._paymentMethod||!this._paymentMethod.initializationData)throw new vn(yn.MissingPaymentMethod);const o=this._getBaseRequest(n,r,i,this._paymentMethod);delete o.total.type,e.completePaymentMethodSelection({newTotal:o.total,newLineItems:o.lineItems})}_handleShippingContactSelected(e,t,n){var i;return _b(this,void 0,void 0,(function*(){const r=this._transformContactToAddress(n.shippingContact);try{yield this._paymentIntegrationService.updateShippingAddress(r)}catch(t){throw e.abort(),new Error("Shipping address update failed")}let o=this._paymentIntegrationService.getState();const{currency:{decimalPlaces:a}}=o.getCartOrThrow();let s=o.getCheckoutOrThrow();const d=null===(i=s.consignments[0].selectedShippingOption)||void 0===i?void 0:i.id,c=s.consignments[0].availableShippingOptions,l=null==c?void 0:c.find((({id:e})=>e===d)),u=null==c?void 0:c.filter((e=>e.id!==d)),h=l?[{label:l.description,amount:`${l.cost.toFixed(a)}`,detail:l.additionalDescription,identifier:l.id}]:[];if(u&&[...u.filter((e=>e.isRecommended)),...u.filter((e=>!e.isRecommended))].forEach((e=>h.push({label:e.description,amount:`${e.cost.toFixed(a)}`,detail:e.additionalDescription,identifier:e.id}))),!(c instanceof Array))throw new Error("Shipping options not available.");if(0===c.length)return void e.completeShippingContactSelection(ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS,[],{type:"pending",label:t,amount:`${s.grandTotal.toFixed(a)}`},[]);const m=c.find((e=>e.isRecommended)),p=m?m.id:c[0].id,y=l?l.id:p;try{yield this._updateShippingOption(y)}catch(e){throw new Error("Shipping options update failed")}o=this._paymentIntegrationService.getState(),s=o.getCheckoutOrThrow(),e.completeShippingContactSelection({newShippingMethods:h,newTotal:{type:"final",label:t,amount:`${s.grandTotal.toFixed(a)}`},newLineItems:this._getUpdatedLineItems(s,a)})}))}_handleShippingMethodSelected(e,t,n){return _b(this,void 0,void 0,(function*(){const{shippingMethod:{identifier:i}}=n;try{yield this._updateShippingOption(i)}catch(t){throw e.abort(),new Error("Shipping option selection update failed.")}const r=this._paymentIntegrationService.getState(),{currency:{decimalPlaces:o}}=r.getCartOrThrow(),a=r.getCheckoutOrThrow();e.completeShippingMethodSelection({newTotal:{type:"final",label:t,amount:`${a.grandTotal.toFixed(o)}`},newLineItems:this._getUpdatedLineItems(a,o)})}))}_getUpdatedLineItems(e,t){const n=[{label:this._subTotalLabel,amount:`${e.subtotal.toFixed(t)}`}];return e.taxes.forEach((e=>n.push({label:e.name,amount:`${e.amount.toFixed(t)}`}))),n.push({label:this._shippingLabel,amount:`${e.shippingCostTotal.toFixed(t)}`}),n}_updateShippingOption(e){return _b(this,void 0,void 0,(function*(){return this._paymentIntegrationService.selectShippingOption(e)}))}_onValidateMerchant(e,t){return _b(this,void 0,void 0,(function*(){const n=[`validationUrl=${t.validationURL}`,`merchantIdentifier=${e.initializationData.merchantId}`,`displayName=${e.initializationData.storeName}`,`domainName=${window.location.hostname}`].join("&");return this._requestSender.post(`${e.initializationData.paymentsUrl}/api/public/v1/payments/applepay/validate_merchant`,{credentials:!1,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded","X-XSRF-TOKEN":null},body:n})}))}_onPaymentAuthorized(e,t,n){var i;return _b(this,void 0,void 0,(function*(){const{token:r,billingContact:o,shippingContact:a}=e.payment,s=this._paymentIntegrationService.getState().getCartOrThrow().lineItems.physicalItems.length>0;let d;(null===(i=n.initializationData)||void 0===i?void 0:i.gateway)===ii.BRAINTREE&&(d=yield this._getBraintreeDeviceData());const c={methodId:n.id,paymentData:{deviceSessionId:d,formattedPayload:{apple_pay_token:{payment_data:r.paymentData,payment_method:r.paymentMethod,transaction_id:r.transactionIdentifier}}}},l=this._transformContactToAddress(o),u=this._transformContactToAddress(a),h=null==a?void 0:a.emailAddress,m=(null==a?void 0:a.phoneNumber)||"";try{return yield this._paymentIntegrationService.updateBillingAddress(Object.assign(Object.assign({},l),{email:h,phone:m})),s&&(yield this._paymentIntegrationService.updateShippingAddress(u)),yield this._paymentIntegrationService.submitOrder({useStoreCredit:!1}),yield this._paymentIntegrationService.submitPayment(c),t.completePayment(ApplePaySession.STATUS_SUCCESS),this._onAuthorizeCallback()}catch(e){throw t.completePayment(ApplePaySession.STATUS_FAILURE),new Error("Payment cannot complete")}}))}_transformContactToAddress(e){return{firstName:(null==e?void 0:e.givenName)||"",lastName:(null==e?void 0:e.familyName)||"",city:(null==e?void 0:e.locality)||"",company:"",address1:(null==e?void 0:e.addressLines)&&e.addressLines[0]||"",address2:(null==e?void 0:e.addressLines)&&e.addressLines[1]||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCode:(null==e?void 0:e.countryCode)||"",phone:(null==e?void 0:e.phoneNumber)||"",stateOrProvince:(null==e?void 0:e.administrativeArea)||"",stateOrProvinceCode:(null==e?void 0:e.administrativeArea)||"",customFields:[]}}_getBraintreeDeviceData(){return _b(this,void 0,void 0,(function*(){try{const{deviceData:e}=yield this._braintreeSdk.getDataCollectorOrThrow();return e}catch(e){}}))}_initializeBraintreeSdk(){return _b(this,void 0,void 0,(function*(){yield this._paymentIntegrationService.loadPaymentMethod(ii.BRAINTREE);const e=this._paymentIntegrationService.getState().getPaymentMethod(ii.BRAINTREE);e&&e.clientToken&&e.initializationData&&this._braintreeSdk.initialize(e.clientToken)}))}}const Pb=Ge((e=>{const{getHost:t}=e.getState(),n=new Un(e);return new Ib((0,a.createRequestSender)({host:t()}),e,new ui,new ti(new oi((0,s.vQ)(),window,n)),new hi(new s.B2))}),[{id:"applepay"}]);var Eb=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Ob{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t}initialize(e){var t;return Eb(this,void 0,void 0,(function*(){const{bigcommerce_payments:n,containerId:i,methodId:r}=e,o=Boolean(null==n?void 0:n.buyNowInitializeOptions);if(!r)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.bigcommerce_payments" argument is not provided.');if(o&&!n.currencyCode)throw new xn('Unable to initialize payment because "options.bigcommerce_payments.currencyCode" argument is not provided.');if(o&&"function"!=typeof(null===(t=n.buyNowInitializeOptions)||void 0===t?void 0:t.getBuyNowCartRequestBody))throw new xn('Unable to initialize payment because "options.bigcommerce_payments.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');o||(yield this.paymentIntegrationService.loadDefaultCheckout());const a=o?n.currencyCode:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(r,a,!1),this.renderButton(i,r,n)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onComplete:o,onEligibilityFailure:a}=n,s=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),d=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{isHostedCheckoutEnabled:c}=d.initializationData||{},l={createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments"),onApprove:({orderID:e})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(t,e)},u={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},h={onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e),onApprove:(e,n)=>this.onHostedCheckoutApprove(e,n,t,o)},m=Object.assign(Object.assign(Object.assign({fundingSource:s.FUNDING.PAYPAL,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(r)},l),i&&u),c&&h),p=s.Buttons(m);p.isEligible()?p.render(`#${e}`):a&&"function"==typeof a?a():this.bigCommercePaymentsIntegrationService.removeElement(e)}handleClick(e){return Eb(this,void 0,void 0,(function*(){if(e){const t=yield this.bigCommercePaymentsIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}onHostedCheckoutApprove(e,t,n,i){return Eb(this,void 0,void 0,(function*(){if(!e.orderID)throw new vn(yn.MissingOrderId);const r=this.paymentIntegrationService.getState().getCartOrThrow(),o=yield t.order.get();try{const t=this.bigCommercePaymentsIntegrationService.getBillingAddressFromOrderDetails(o);if(yield this.paymentIntegrationService.updateBillingAddress(t),r.lineItems.physicalItems.length>0){const e=this.bigCommercePaymentsIntegrationService.getShippingAddressFromOrderDetails(o);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.bigCommercePaymentsIntegrationService.updateOrder()}return yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.bigCommercePaymentsIntegrationService.submitPayment(n,e.orderID),i&&"function"==typeof i&&i(),!0}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingAddressChange(e){return Eb(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingOptionsChange(e){return Eb(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}}const Ab=Ge((e=>new Ob(e,Di(e))),[{id:"bigcommerce_payments"}]);var kb=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Tb{constructor(e,t,n){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t,this.payPalSdkHelper=n}initialize(e){return kb(this,void 0,void 0,(function*(){const{bigcommerce_payments_paylater:t,containerId:n,methodId:i}=e,{buyNowInitializeOptions:r,currencyCode:o,messagingContainerId:a}=t||{},s=!!r;if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_paylater" argument is not provided.');if(s&&!o)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_paylater.currencyCode" argument is not provided.');if(s&&"function"!=typeof(null==r?void 0:r.getBuyNowCartRequestBody))throw new xn('Unable to initialize payment because "options.bigcommerce_payments_paylater.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');s||(yield this.paymentIntegrationService.loadDefaultCheckout());const d=this.paymentIntegrationService.getState(),c=s?o:d.getCartOrThrow().currency.code;yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i,c,!1),this.renderButton(n,i,t);const l=a&&document.getElementById(a);if(c&&l){const e=d.getPaymentMethodOrThrow(i),{paypalBNPLConfiguration:t=[]}=e.initializationData||{},n=t&&t.find((({id:e})=>"cart"===e));if(!(null==n?void 0:n.status))return;l.removeAttribute("data-pp-style-logo-type"),l.removeAttribute("data-pp-style-logo-position"),l.removeAttribute("data-pp-style-text-color"),l.removeAttribute("data-pp-style-text-size");const r=yield this.payPalSdkHelper.getPayPalMessages(e,c);this.renderMessages(r,a,n)}}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onComplete:o,onEligibilityFailure:a}=n,s=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),d=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{isHostedCheckoutEnabled:c}=d.initializationData||{},l={createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_paylater"),onApprove:({orderID:e})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(t,e)},u={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},h={onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e),onApprove:(e,n)=>this.onHostedCheckoutApprove(e,n,t,o)},m=[s.FUNDING.PAYLATER,s.FUNDING.CREDIT];let p=!1;m.forEach((t=>{if(!p){const n=Object.assign(Object.assign(Object.assign({fundingSource:t,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(r)},l),i&&u),c&&h),o=s.Buttons(n);o.isEligible()?(o.render(`#${e}`),p=!0):a&&"function"==typeof a&&a()}})),p||this.bigCommercePaymentsIntegrationService.removeElement(e)}handleClick(e){return kb(this,void 0,void 0,(function*(){if(e){const t=yield this.bigCommercePaymentsIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}onHostedCheckoutApprove(e,t,n,i){return kb(this,void 0,void 0,(function*(){if(!e.orderID)throw new vn(yn.MissingOrderId);const r=this.paymentIntegrationService.getState().getCartOrThrow(),o=yield t.order.get();try{const t=this.bigCommercePaymentsIntegrationService.getBillingAddressFromOrderDetails(o);if(yield this.paymentIntegrationService.updateBillingAddress(t),r.lineItems.physicalItems.length>0){const e=this.bigCommercePaymentsIntegrationService.getShippingAddressFromOrderDetails(o);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.bigCommercePaymentsIntegrationService.updateOrder()}return yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.bigCommercePaymentsIntegrationService.submitPayment(n,e.orderID),i&&"function"==typeof i&&i(),!0}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingAddressChange(e){return kb(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingOptionsChange(e){return kb(this,void 0,void 0,(function*(){const t=this.bigCommercePaymentsIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.bigCommercePaymentsIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"cart",style:ld(n)};e.Messages(i).render(`#${t}`)}}const Nb=Ge((e=>new Tb(e,Di(e),Ki())),[{id:"bigcommerce_payments_paylater"}]);var Mb=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class xb{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t}initialize(e){return Mb(this,void 0,void 0,(function*(){const{bigcommerce_payments_apms:t,containerId:n,methodId:i}=e,{apm:r,buyNowInitializeOptions:o,currencyCode:a}=t||{},s=!!o;if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_apms" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_apms.apm" argument is not provided.');if(s&&!a)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_apms.currencyCode" argument is not provided.');if(s&&"function"!=typeof(null==o?void 0:o.getBuyNowCartRequestBody))throw new xn('Unable to initialize payment because "options.bigcommerce_payments_apms.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');s||(yield this.paymentIntegrationService.loadDefaultCheckout());const d=s?a:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i,d,!1),this.renderButton(n,i,t)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{apm:i,buyNowInitializeOptions:r,style:o,onEligibilityFailure:a}=n,s=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow();if(!Object.values(s.FUNDING).includes(i))throw new xn('Unable to initialize PayPal button because "options.bigcommerce_payments_apms.apm" argument is not valid funding source.');const d={createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_apms"),onApprove:({orderID:e})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(t,e)},c={onClick:()=>this.handleClick(r),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},l=Object.assign(Object.assign({fundingSource:i,style:this.bigCommercePaymentsIntegrationService.getValidButtonStyle(o)},d),r&&c),u=s.Buttons(l);u.isEligible()?u.render(`#${e}`):a&&"function"==typeof a?a():this.bigCommercePaymentsIntegrationService.removeElement(e)}handleClick(e){return Mb(this,void 0,void 0,(function*(){if(e){const t=yield this.bigCommercePaymentsIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}}const Db=Ge((e=>new xb(e,Di(e))),[{id:"bigcommerce_payments_apms"}]);var zb=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Fb{constructor(e,t){this.paymentIntegrationService=e,this.bigCommercePaymentsIntegrationService=t}initialize(e){return zb(this,void 0,void 0,(function*(){const{bigcommerce_payments_venmo:t,containerId:n,methodId:i}=e,{buyNowInitializeOptions:r,currencyCode:o}=t||{},a=!!r;if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_venmo" argument is not provided.');if(a&&!o)throw new xn('Unable to initialize payment because "options.bigcommerce_payments_venmo.currencyCode" argument is not provided.');if(a&&"function"!=typeof(null==r?void 0:r.getBuyNowCartRequestBody))throw new xn('Unable to initialize payment because "options.bigcommerce_payments_venmo.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');a||(yield this.paymentIntegrationService.loadDefaultCheckout());const s=a?o:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.bigCommercePaymentsIntegrationService.loadPayPalSdk(i,s,!1),this.renderButton(n,i,t)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onEligibilityFailure:o}=n,a=this.bigCommercePaymentsIntegrationService.getPayPalSdkOrThrow(),s=a.FUNDING.VENMO,d={createOrder:()=>this.bigCommercePaymentsIntegrationService.createOrder("bigcommerce_payments_venmo"),onApprove:({orderID:e})=>this.bigCommercePaymentsIntegrationService.tokenizePayment(t,e)},c={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},l=Object.assign(Object.assign({fundingSource:s,style:this.getValidVenmoButtonStyles(r)},d),i&&c),u=a.Buttons(l);u.isEligible()?u.render(`#${e}`):o&&"function"==typeof o?o():this.bigCommercePaymentsIntegrationService.removeElement(e)}getValidVenmoButtonStyles(e){const t=this.bigCommercePaymentsIntegrationService.getValidButtonStyle(e);return t.color===Si.gold?Object.assign(Object.assign({},t),{color:void 0}):t}handleClick(e){return zb(this,void 0,void 0,(function*(){if(e){const t=yield this.bigCommercePaymentsIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}}const Bb=Ge((e=>new Fb(e,Di(e))),[{id:"bigcommerce_payments_venmo"}]);class Rb{constructor(e,t,n=window){this.paymentIntegrationService=e,this.boltScriptLoader=t,this.boltHostWindow=n}initialize(e){return t=this,i=function*(){const{bolt:t,containerId:n,methodId:i}=e,{buyNowInitializeOptions:r,style:o}=t||{};if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.bolt" argument is not provided.');if(!Boolean(r))throw new Dn("Only buy now flow is implemented for Bolt button");if(!(null==r?void 0:r.storefrontApiToken)||"string"!=typeof r.storefrontApiToken)throw new xn('Unable to initialize payment because "options.storefrontApiToken" argument is not provided.');const a=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i),{initializationData:s,config:d}=a,{publishableKey:c,developerConfig:l}=s||{};yield this.boltScriptLoader.loadBoltClient(c,d.testMode,l,"BigCommerce",r.storefrontApiToken),this.renderButton(n,a,o)},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}deinitialize(){return Promise.resolve()}renderButton(e,t,n){var i;"function"==typeof(null===(i=this.boltHostWindow.BoltConnect)||void 0===i?void 0:i.setupProductPageCheckout)&&(this.addButtonContainer(e,t,n),this.boltHostWindow.BoltConnect.setupProductPageCheckout())}addButtonContainer(e,t,n){const i=document.getElementById(e);if(!i)return;const r=document.createElement("div"),o=document.createElement("object");r.setAttribute("id","product-page-checkout-wrapper"),r.setAttribute("class","bolt-button-wrapper"),r.setAttribute("style","display:none"),r.setAttribute("data-tid","product-page-checkout-wrapper"),o.setAttribute("data",this.getBoltObjectData(t,n)),o.setAttribute("class","bolt-product-checkout-button"),r.append(o),i.innerHTML="",i.append(r)}getBoltObjectData(e,t){const{initializationData:n,config:i}=e,{publishableKey:r,developerConfig:o}=n||{},a=this.boltScriptLoader.getDomainURL(!!i.testMode,o),s=this.getButtonHeight(null==t?void 0:t.size),d=this.getButtonBorderRadius(null==t?void 0:t.shape,s);return(0,F.stringifyUrl)({url:`https://${a}/v1/checkout_button`,query:{publishable_key:r,variant:"ppc",height:s,border_radius:d}})}getButtonHeight(e){if(e)switch(e){case pr.Small:return 25;case pr.Large:return 45;case pr.Medium:default:return 40}}getButtonBorderRadius(e,t){if(e)switch(e){case yr.Pill:return t?Math.round(t/2):void 0;case yr.Rect:default:return 4}}}const Lb=Ge((e=>new Rb(e,new br((0,s.vQ)()))),[{id:"bolt"}]);function jb(e){const{color:t,fundingicons:n,height:i=40,layout:r,shape:o,size:a,tagline:s}=e||{},d={color:t,fundingicons:n,height:Ub(i),layout:r,shape:o||"rect",size:a,tagline:s};return(0,c.omitBy)(d,c.isNil)}function Ub(e){const t=Number(e);return!t||Number.isNaN(t)?40:t>55?55:t<25?25:t}var Vb=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class qb{constructor(e,t,n,i){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeIntegrationService=n,this.braintreeHostWindow=i}initialize(e){return Vb(this,void 0,void 0,(function*(){const{braintreepaypal:t,containerId:n,methodId:i}=e;if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.braintreepaypal" argument is not provided.');let r,o=this.paymentIntegrationService.getState();if(t.buyNowInitializeOptions){if(!t.currencyCode)throw new xn('Unable to initialize payment because "options.braintreepaypalcredit.currencyCode" argument is not provided.');r=t.currencyCode}else yield this.paymentIntegrationService.loadDefaultCheckout(),o=this.paymentIntegrationService.getState(),r=o.getCartOrThrow().currency.code;const a=o.getPaymentMethodOrThrow(i),{clientToken:s,config:d,initializationData:c}=a;if(!s||!c)throw new vn(yn.MissingPaymentMethod);const l={currency:r,intent:c.intent,isCreditEnabled:c.isCreditEnabled};this.braintreeIntegrationService.initialize(s),yield this.braintreeIntegrationService.getPaypalCheckout(l,(e=>{this.renderPayPalButton(e,t,n,i,!!d.testMode)}),(e=>this.handleError(e,n,t.onError)))}))}deinitialize(){return Vb(this,void 0,void 0,(function*(){yield this.braintreeIntegrationService.teardown()}))}renderPayPalButton(e,t,n,i,r){const{style:o,shouldProcessPayment:a,onAuthorizeError:s,onEligibilityFailure:d}=t,{paypal:c}=this.braintreeHostWindow;if(c){const l=c.Buttons({env:r?"sandbox":"production",fundingSource:c.FUNDING.PAYPAL,style:jb(o),createOrder:()=>this.setupPayment(e,t,i),onApprove:t=>this.tokenizePayment(t,e,i,a,s)});l.isEligible()?l.render(`#${n}`):d&&"function"==typeof d&&d()}else this.braintreeIntegrationService.removeElement(n)}setupPayment(e,t,n){var i;return Vb(this,void 0,void 0,(function*(){const{onPaymentError:r,shippingAddress:o,buyNowInitializeOptions:a}=t;try{const r="function"==typeof(null==a?void 0:a.getBuyNowCartRequestBody)?yield this.createBuyNowCart(a.getBuyNowCartRequestBody()):void 0;this.buyNowCartId=null==r?void 0:r.id;const s=this.paymentIntegrationService.getState(),d=s.getCustomer(),c=s.getPaymentMethodOrThrow(n),l=r?r.cartAmount:s.getCartOrThrow().cartAmount,u=r?t.currencyCode:s.getCartOrThrow().currency.code,h=o||(null==d?void 0:d.addresses[0]),m=h?vc(h):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:m,amount:l,currency:u,offerCredit:!1,intent:null===(i=c.initializationData)||void 0===i?void 0:i.intent})}catch(e){throw r&&(Qn(e)||e instanceof pn)&&r(e),e}}))}tokenizePayment(e,t,n,i,r){return Vb(this,void 0,void 0,(function*(){try{const{deviceData:r}=yield this.braintreeIntegrationService.getDataCollector({paypal:!0}),o=yield t.tokenizePayment(e),{details:a,nonce:s}=o,d=this.braintreeIntegrationService.mapToLegacyBillingAddress(a),c=this.braintreeIntegrationService.mapToLegacyShippingAddress(a);return this.formPoster.postForm("/checkout.php",Object.assign({payment_type:"paypal",provider:n,action:i?"process_payment":"set_external_checkout",nonce:s,device_data:r,billing_address:JSON.stringify(d),shipping_address:JSON.stringify(c)},this.buyNowCartId&&{cart_id:this.buyNowCartId})),o}catch(e){throw r&&(Qn(e)||e instanceof pn)&&r(e),e}}))}createBuyNowCart(e){return Vb(this,void 0,void 0,(function*(){if(!e)throw new vn(yn.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(e)}catch(e){throw new pi}}))}handleError(e,t,n){if(this.braintreeIntegrationService.removeElement(t),!n||!Qn(e))throw e;n(e)}}const Hb=Ge((e=>{const t=window,n=new Un(e),i=new Nr(new oi((0,s.vQ)(),t,n),t);return new qb(e,(0,N.createFormPoster)(),i,t)}),[{id:"braintreepaypal"}]);var Gb=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class $b{constructor(e,t,n,i,r){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeIntegrationService=n,this.braintreeMessages=i,this.braintreeHostWindow=r}initialize(e){var t,n;return Gb(this,void 0,void 0,(function*(){const{braintreepaypalcredit:i,containerId:r,methodId:o}=e;if(!o)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.braintreepaypalcredit" argument is not provided.');let a,s=this.paymentIntegrationService.getState();if(i.buyNowInitializeOptions){if(!i.currencyCode)throw new xn('Unable to initialize payment because "options.braintreepaypalcredit.currencyCode" argument is not provided.');a=i.currencyCode}else yield this.paymentIntegrationService.loadDefaultCheckout(),s=this.paymentIntegrationService.getState(),a=s.getCartOrThrow().currency.code;const d=s.getPaymentMethodOrThrow(o),{clientToken:c,config:l,initializationData:u}=d;if(!c||!u)throw new vn(yn.MissingPaymentMethod);const h={currency:a,intent:u.intent,isCreditEnabled:u.isCreditEnabled},m=Ze(null!==(n=null===(t=s.getStoreConfig())||void 0===t?void 0:t.checkoutSettings.features)&&void 0!==n?n:{},"PAYPAL-5663.hide_braintree_card_banner_implementation_in_checkout_sdk");this.braintreeIntegrationService.initialize(c),yield this.braintreeIntegrationService.getPaypalCheckout(h,(e=>{!m&&i.messagingContainerId&&this.renderPayPalMessages(o,i.messagingContainerId),this.renderPayPalButton(e,i,r,o,!!l.testMode)}),(e=>this.handleError(e,r,i.onError)))}))}deinitialize(){return Gb(this,void 0,void 0,(function*(){yield this.braintreeIntegrationService.teardown()}))}renderPayPalMessages(e,t){this.braintreeMessages.render(e,t,kr.CART)}renderPayPalButton(e,t,n,i,r){const{style:o,shouldProcessPayment:a,onAuthorizeError:s,onEligibilityFailure:d}=t,{paypal:c}=this.braintreeHostWindow;let l=!1;c&&[c.FUNDING.PAYLATER,c.FUNDING.CREDIT].forEach((u=>{const h=u===c.FUNDING.CREDIT?Object.assign({label:Or.CREDIT},jb(o)):jb(o);if(!l){const o=c.Buttons({env:r?"sandbox":"production",fundingSource:u,style:h,createOrder:()=>this.setupPayment(e,t,i),onApprove:t=>this.tokenizePayment(t,e,i,a,s)});o.isEligible()?(o.render(`#${n}`),l=!0):c.FUNDING.CREDIT&&d&&"function"==typeof d&&d()}})),c&&l||this.braintreeIntegrationService.removeElement(n)}setupPayment(e,t,n){var i;return Gb(this,void 0,void 0,(function*(){const{onPaymentError:r,shippingAddress:o,buyNowInitializeOptions:a}=t;try{const r="function"==typeof(null==a?void 0:a.getBuyNowCartRequestBody)?yield this.createBuyNowCart(a.getBuyNowCartRequestBody()):void 0;this.buyNowCartId=null==r?void 0:r.id;const s=this.paymentIntegrationService.getState(),d=s.getCustomer(),c=s.getPaymentMethodOrThrow(n),l=r?r.cartAmount:s.getCartOrThrow().cartAmount,u=r?t.currencyCode:s.getCartOrThrow().currency.code,h=o||(null==d?void 0:d.addresses[0]),m=h?vc(h):void 0;return yield e.createPayment({flow:"checkout",enableShippingAddress:!0,shippingAddressEditable:!1,shippingAddressOverride:m,amount:l,currency:u,offerCredit:!0,intent:null===(i=c.initializationData)||void 0===i?void 0:i.intent})}catch(e){throw r&&(Qn(e)||e instanceof pn)&&r(e),e}}))}tokenizePayment(e,t,n,i,r){return Gb(this,void 0,void 0,(function*(){try{const{deviceData:r}=yield this.braintreeIntegrationService.getDataCollector({paypal:!0}),o=yield t.tokenizePayment(e),{details:a,nonce:s}=o,d=this.braintreeIntegrationService.mapToLegacyBillingAddress(a),c=this.braintreeIntegrationService.mapToLegacyShippingAddress(a);return this.formPoster.postForm("/checkout.php",Object.assign({payment_type:"paypal",provider:n,action:i?"process_payment":"set_external_checkout",nonce:s,device_data:r,billing_address:JSON.stringify(d),shipping_address:JSON.stringify(c)},this.buyNowCartId&&{cart_id:this.buyNowCartId})),o}catch(e){throw r&&(Qn(e)||e instanceof pn)&&r(e),e}}))}createBuyNowCart(e){return Gb(this,void 0,void 0,(function*(){if(!e)throw new vn(yn.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(e)}catch(e){throw new pi}}))}handleError(e,t,n){if(this.braintreeIntegrationService.removeElement(t),!n||!Qn(e))throw e;n(e)}}const Wb=Ge((e=>{const t=window,n=new Un(e),i=new Nr(new oi((0,s.vQ)(),t,n),t),r=new mc(e);return new $b(e,(0,N.createFormPoster)(),i,r,t)}),[{id:"braintreepaypalcredit"}]);var Yb=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class Kb{constructor(e,t,n){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeSdk=n}initialize(e){return Yb(this,void 0,void 0,(function*(){const{containerId:t,methodId:n}=e;if(!n)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');yield this.paymentIntegrationService.loadPaymentMethod(n);const i=this.paymentIntegrationService.getState(),{clientToken:r,initializationData:o,config:a}=i.getPaymentMethodOrThrow(n);if(!r||!o)throw new vn(yn.MissingPaymentMethod);this.braintreeSdk.initialize(r);const s=yield this.braintreeSdk.getBraintreeVisaCheckout(),{currency:{code:d},cartAmount:c}=i.getCartOrThrow(),l=yield this.braintreeSdk.getVisaCheckoutSdk(a.testMode),u=s.createInitOptions({paymentRequest:{currencyCode:d,subtotal:String(c)},settings:{shipping:{collectShipping:!0}}});this.createSignInButton(t),yield l.init(u),l.on("payment.success",(e=>Yb(this,void 0,void 0,(function*(){yield this.paymentSuccess(s,e)}))))}))}deinitialize(){return Promise.resolve()}paymentSuccess(e,t){return Yb(this,void 0,void 0,(function*(){return Promise.all([e.tokenize(t),this.braintreeSdk.getDataCollectorOrThrow()]).then((([e,t])=>{const n=this.paymentIntegrationService.getState(),i=n.getShippingAddress(),r=n.getBillingAddress(),{shippingAddress:o=this.toVisaCheckoutAddress(i),billingAddress:a=this.toVisaCheckoutAddress(r)}=e;return this.postForm(Object.assign(Object.assign({},e),{shippingAddress:o,billingAddress:a}),t)}))}))}postForm(e,t){const{userData:n,billingAddress:i,shippingAddress:r,details:o}=e,{userEmail:a}=n,{deviceData:s}=t;return this.formPoster.postForm("/checkout.php",{payment_type:e.type,nonce:e.nonce,provider:"braintreevisacheckout",action:"set_external_checkout",device_data:s,card_information:JSON.stringify({type:o.cardType,number:o.lastTwo}),billing_address:JSON.stringify(this.getAddress(a,i)),shipping_address:JSON.stringify(this.getAddress(a,r))})}toVisaCheckoutAddress(e){return e?{firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phone,streetAddress:e.address1,extendedAddress:e.address2,locality:e.city,region:e.stateOrProvinceCode,countryCode:e.countryCode,postalCode:e.postalCode}:{}}getAddress(e,t={}){return{email:e,first_name:t.firstName,last_name:t.lastName,phone_number:t.phoneNumber,address_line_1:t.streetAddress,address_line_2:t.extendedAddress,city:t.locality,state:t.region,country_code:t.countryCode,postal_code:t.postalCode}}createSignInButton(e){const t=document.querySelector(`#${e}`);if(!t)throw new Error("Need a container to place the button");return this.insertVisaCheckoutButton(t)}insertVisaCheckoutButton(e){const t=document.createElement("div");return t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-end",t.innerHTML='\n            <img\n                alt="Visa Checkout"\n                class="v-button"\n                role="button"\n                src="https://secure.checkout.visa.com/wallet-services-web/xo/button.png?acceptCanadianVisaDebit=false&cobrand=true&height=34&width=178"\n                />\n            <a class="v-learn v-learn-default" style="text-align: right; display: block; font-size: 10px; color: #003366;" href="#" data-locale="en_US">Tell Me More</a>',e.appendChild(t),t}}const Qb=Ge((e=>{const t=window,n=new Un(e),i=new ti(new oi((0,s.vQ)(),t,n));return new Kb(e,(0,N.createFormPoster)(),i)}),[{id:"braintreevisacheckout"}]);function Jb(e){const{billingAddress:t,email:n,firstName:i,lastName:r,phone:o,shippingAddress:a}=e,s=t||a;return{email:n,first_name:i,last_name:r,phone_number:o,address_line_1:null==s?void 0:s.line1,address_line_2:null==s?void 0:s.line2,city:null==s?void 0:s.city,state:null==s?void 0:s.state,country_code:null==s?void 0:s.countryCode,postal_code:null==s?void 0:s.postalCode}}function Zb(e){const{email:t,phone:n,shippingAddress:i}=e,r=(null==i?void 0:i.recipientName)||"",[o,a]=r.split(" ");return{email:t,first_name:o||"",last_name:a||"",phone_number:n,address_line_1:null==i?void 0:i.line1,address_line_2:null==i?void 0:i.line2,city:null==i?void 0:i.city,state:null==i?void 0:i.state,country_code:null==i?void 0:i.countryCode,postal_code:null==i?void 0:i.postalCode}}var Xb=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};const eS=e=>{const{color:t,height:n}=e;return{backgroundColor:(i=t||"",i===Er.WHITE?"#FFFFFF":"#3D95CE"),backgroundPosition:"50% 50%",backgroundSize:"80px auto",backgroundImage:`url("/app/assets/img/payment-providers/venmo-logo-${t===Er.WHITE?Er.BLUE:Er.WHITE}.svg")`,backgroundRepeat:"no-repeat",borderRadius:"4px",cursor:"pointer",transition:"0.2s ease",minHeight:`${n||40}px`,minWidth:"150px",height:"100%",width:"100%",border:t===Er.WHITE?"1px solid black":"none"};var i};class tS{constructor(e,t,n){this.paymentIntegrationService=e,this.formPoster=t,this.braintreeSdk=n,this.onError=c.noop}initialize(e){return Xb(this,void 0,void 0,(function*(){const{braintreevenmo:t,containerId:n,methodId:i}=e;if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');const r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i),{clientToken:o,initializationData:a}=r,{paymentButtonStyles:s}=a,{cartButtonStyles:d}=s||{},c=(null==t?void 0:t.style)||d;if(!o||!a)throw new vn(yn.MissingPaymentMethod);if(!n)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');yield this.paymentIntegrationService.loadDefaultCheckout(),this.onError=(null==t?void 0:t.onError)||this.handleError,this.braintreeSdk.initialize(o);try{const e=yield this.braintreeSdk.getVenmoCheckoutOrThrow();this.renderVenmoButton(e,n,null==t?void 0:t.buyNowInitializeOptions,c)}catch(e){(gc(e)||function(e){return e instanceof Vn}(e))&&this.handleInitializationVenmoError(e,n)}}))}deinitialize(){return Xb(this,void 0,void 0,(function*(){return yield this.braintreeSdk.deinitialize(),Promise.resolve()}))}handleError(e){throw new Error(e.message)}createBuyNowCart(e){return Xb(this,void 0,void 0,(function*(){if("function"==typeof(null==e?void 0:e.getBuyNowCartRequestBody)){const t=null==e?void 0:e.getBuyNowCartRequestBody();if(!t)throw new vn(yn.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(t)}catch(e){throw new pi}}}))}handleInitializationVenmoError(e,t){return this.removeVenmoContainer(t),this.onError(e)}removeVenmoContainer(e){const t=document.getElementById(e);t&&t.remove()}renderVenmoButton(e,t,n,i){const r=document.getElementById(t),{color:o}=i||{};if(!r)throw new xn("Unable to create wallet button without valid container ID.");r.setAttribute("aria-label","Venmo"),Object.assign(r.style,eS(i||{})),r.addEventListener("click",(()=>Xb(this,void 0,void 0,(function*(){r.setAttribute("disabled","true");const t=yield this.createBuyNowCart(n);e.tokenize&&e.tokenize(((e,n)=>Xb(this,void 0,void 0,(function*(){r.removeAttribute("disabled"),e&&this.onError(e),yield this.handlePostForm(n,null==t?void 0:t.id)}))))})))),o===Er.BLUE&&(r.addEventListener("mouseenter",(()=>{r.style.backgroundColor="#0a7fc2"})),r.addEventListener("mouseleave",(()=>{r.style.backgroundColor=eS(i||{}).backgroundColor})))}handlePostForm(e,t){return Xb(this,void 0,void 0,(function*(){const{deviceData:n}=yield this.braintreeSdk.getDataCollectorOrThrow(),{nonce:i,details:r}=e;this.formPoster.postForm("/checkout.php",Object.assign({nonce:i,provider:"braintreevenmo",payment_type:"paypal",device_data:n,action:"set_external_checkout",billing_address:JSON.stringify(Jb(r)),shipping_address:JSON.stringify(Zb(r))},t&&{cart_id:t}))}))}}const nS=Ge((e=>{const t=window,n=(0,s.vQ)(),i=new Un(e),r=new oi(n,t,i),o=new ti(r);return new tS(e,(0,N.createFormPoster)(),o)}),[{id:"braintreevenmo"}]);var iS=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class rS{constructor(e,t){this._paymentIntegrationService=e,this._googlePayPaymentProcessor=t}initialize(e){var t,n;return iS(this,void 0,void 0,(function*(){if(!e.methodId||!mo(e.methodId))throw new xn('Unable to proceed because "methodId" is not a valid key.');if(this._methodId=e.methodId,!e.containerId)throw new xn('Unable to proceed because "containerId" is not a valid key.');const i=e[this._getMethodOrThrow()];if(!i)throw new xn("Unable to proceed without valid options.");const{buyNowInitializeOptions:r,currencyCode:o,buttonColor:a,buttonType:s,onError:d}=i;let c,l=this._paymentIntegrationService.getState();try{c=l.getPaymentMethodOrThrow(this._getMethodOrThrow())}catch(e){l=yield this._paymentIntegrationService.loadPaymentMethod(this._getMethodOrThrow()),c=l.getPaymentMethodOrThrow(this._getMethodOrThrow())}if(this._countryCode=null===(t=c.initializationData)||void 0===t?void 0:t.storeCountry,r){if(!o)throw new xn('Unable to initialize payment because "options.currencyCode" argument is not provided.');this._currencyCode=o,this._buyNowInitializeOptions=r,yield this._googlePayPaymentProcessor.initialize((()=>c),this._getGooglePayClientOptions(),!!r,o)}else yield this._paymentIntegrationService.loadDefaultCheckout(),yield this._googlePayPaymentProcessor.initialize((()=>c),this._getGooglePayClientOptions());this._paymentButton=null!==(n=this._paymentButton)&&void 0!==n?n:this._googlePayPaymentProcessor.addPaymentButton(e.containerId,{buttonColor:null!=a?a:"default",buttonType:null!=s?s:"plain",onClick:this._handleClick(d)})}))}deinitialize(){var e;return null===(e=this._paymentButton)||void 0===e||e.remove(),this._paymentButton=void 0,this._methodId=void 0,Promise.resolve()}_handleClick(e){return t=>iS(this,void 0,void 0,(function*(){t.preventDefault();try{this._buyNowInitializeOptions?yield this._createBuyNowCartOrThrow(this._buyNowInitializeOptions):yield this._paymentIntegrationService.loadDefaultCheckout(),yield this._googlePayPaymentProcessor.initializeWidget(),yield this._interactWithPaymentSheet()}catch(t){let n=t;if(ho(t)){if("CANCELED"===t.statusCode)throw new ai;n=new ur(JSON.stringify(t))}throw null==e||e(new ur("An error occurred while requesting your Google Pay payment details.")),n}}))}_interactWithPaymentSheet(){var e;return iS(this,void 0,void 0,(function*(){const t=yield this._googlePayPaymentProcessor.showPaymentSheet(),n=this._googlePayPaymentProcessor.mapToBillingAddressRequestBody(t),i=this._googlePayPaymentProcessor.mapToShippingAddressRequestBody(t),r="/embedded-checkout"===window.location.pathname?this._paymentIntegrationService.getState().getStoreConfigOrThrow().links.siteLink:void 0;n&&(yield this._paymentIntegrationService.updateBillingAddress(n)),i&&!(null===(e=this._buyNowCart)||void 0===e?void 0:e.lineItems.digitalItems.length)&&(yield this._paymentIntegrationService.updateShippingAddress(i)),yield this._googlePayPaymentProcessor.setExternalCheckoutForm(this._getMethodOrThrow(),t,r)}))}_getGooglePayClientOptions(){return{paymentDataCallbacks:{onPaymentDataChanged:({callbackTrigger:e,shippingAddress:t,shippingOptionData:n,offerData:i})=>iS(this,void 0,void 0,(function*(){const{availableTriggers:r,addressChangeTriggers:o,shippingOptionsChangeTriggers:a,offerChangeTriggers:s}=this._googlePayPaymentProcessor.getCallbackTriggers();if(!r.includes(e))return;const d=o.includes(e)?yield this._googlePayPaymentProcessor.handleShippingAddressChange(t):void 0;a.includes(e)&&(yield this._googlePayPaymentProcessor.handleShippingOptionChange(n.id));const{newOfferInfo:c,error:l}=s.includes(e)?yield this._googlePayPaymentProcessor.handleCoupons(i):{},u=l;return this._buyNowInitializeOptions?this._getBuyNowTransactionInfo(d,c,u):this._getTransactionInfo(d,c,u)}))}}}_createBuyNowCartOrThrow(e){return iS(this,void 0,void 0,(function*(){if("function"==typeof(null==e?void 0:e.getBuyNowCartRequestBody)){const t=e.getBuyNowCartRequestBody();try{this._buyNowCart=yield this._paymentIntegrationService.createBuyNowCart(t),yield this._paymentIntegrationService.loadCheckout(this._buyNowCart.id)}catch(e){if("string"==typeof e)throw new pi(e);throw e}}}))}_getBuyNowTransactionInfo(e,t,n){if(!this._buyNowCart)return;const{cartAmount:i}=this._buyNowCart,r=this._googlePayPaymentProcessor.getTotalPrice();return Object.assign(Object.assign(Object.assign({newTransactionInfo:Object.assign(Object.assign({},this._countryCode&&{countryCode:this._countryCode}),{currencyCode:this._getCurrencyCodeOrThrow(),totalPrice:r||String(i),totalPriceStatus:no.FINAL})},e&&{newShippingOptionParameters:e}),t&&{newOfferInfo:t}),n&&{error:n})}_getTransactionInfo(e,t,n){return iS(this,void 0,void 0,(function*(){yield this._paymentIntegrationService.loadCheckout();const i=this._googlePayPaymentProcessor.getTotalPrice(),{code:r}=this._paymentIntegrationService.getState().getCartOrThrow().currency;return Object.assign(Object.assign(Object.assign({newTransactionInfo:Object.assign(Object.assign({},this._countryCode&&{countryCode:this._countryCode}),{currencyCode:r,totalPriceStatus:no.FINAL,totalPrice:i})},e&&{newShippingOptionParameters:e}),t&&{newOfferInfo:t}),n&&{error:n})}))}_getMethodOrThrow(){return bn(this._methodId,(()=>new Sn(gn.PaymentNotInitialized)))}_getCurrencyCodeOrThrow(){return bn(this._currencyCode,(()=>new xn('Unable to initialize payment because "options.currencyCode" argument is not provided.')))}}const oS=Ge((e=>{const t=(0,a.createRequestSender)(),n=window,i=new Un(e),r=new ti(new oi((0,s.vQ)(),n,i));return new rS(e,new vo(bo(),new Ho(e,r),t,(0,N.createFormPoster)()))}),[{id:"googlepaybraintree"}]),aS=Ge((e=>new rS(e,new vo(bo(),new Qo(e,new Wo((0,s.vQ)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaypaypalcommerce"}]),sS=Ge((e=>new rS(e,new vo(bo(),new Xo(e,new Yi((0,s.vQ)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepay_bigcommerce_payments"}]),dS=Ge((e=>{const t=(0,a.createRequestSender)();return new rS(e,new vo(bo(),new uo("adyen",e),t,(0,N.createFormPoster)()))}),[{id:"googlepayadyenv2"}]),cS=Ge((e=>{const t=(0,a.createRequestSender)();return new rS(e,new vo(bo(),new uo("adyen",e),t,(0,N.createFormPoster)()))}),[{id:"googlepayadyenv3"}]),lS=Ge((e=>new rS(e,new vo(bo(),new wo(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayauthorizenet"}]),uS=Ge((e=>{const t=(0,a.createRequestSender)();return new rS(e,new vo(bo(),new Oo(e,t),t,(0,N.createFormPoster)()))}),[{id:"googlepaycheckoutcom"}]),hS=Ge((e=>new rS(e,new vo(bo(),new ko(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaycybersourcev2"},{id:"googlepaybnz"}]),mS=Ge((e=>new rS(e,new vo(bo(),new Mo(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayorbital"}]),pS=Ge((e=>new rS(e,new vo(bo(),new Fo(e,new Ro((0,s.vQ)())),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaystripe"},{id:"googlepaystripeupe"},{id:"googlepaystripeocs"}]),yS=Ge((e=>new rS(e,new vo(bo(),new Uo(e),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepayworldpayaccess"}]),gS=Ge((e=>new rS(e,new vo(bo(),new ia(e,(0,N.createFormPoster)()),(0,a.createRequestSender)(),(0,N.createFormPoster)()))),[{id:"googlepaytdonlinemart"}]);var vS=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class fS{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t}initialize(e){var t;return vS(this,void 0,void 0,(function*(){const{paypalcommerce:n,containerId:i,methodId:r}=e,o=Boolean(null==n?void 0:n.buyNowInitializeOptions);if(!r)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.paypalcommerce" argument is not provided.');if(o&&!n.currencyCode)throw new xn('Unable to initialize payment because "options.paypalcommerce.currencyCode" argument is not provided.');if(o&&"function"!=typeof(null===(t=n.buyNowInitializeOptions)||void 0===t?void 0:t.getBuyNowCartRequestBody))throw new xn('Unable to initialize payment because "options.paypalcommerce.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');o||(yield this.paymentIntegrationService.loadDefaultCheckout());const a=o?n.currencyCode:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.paypalCommerceIntegrationService.loadPayPalSdk(r,a,!1),this.renderButton(i,r,n,o)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n,i){var r,o;const{buyNowInitializeOptions:a,style:s,onComplete:d,onEligibilityFailure:c}=n,l=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),u=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{isHostedCheckoutEnabled:h,isAppSwitchEnabled:m}=u.initializationData||{},p=Object.assign(Object.assign({},!i&&this.isPaypalCommerceAppSwitchEnabled(t)&&{appSwitchWhenAvailable:!0}),{createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommerce"),onApprove:({orderID:e})=>this.paypalCommerceIntegrationService.tokenizePayment(t,e)}),y={onClick:()=>this.handleClick(a),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},g=Object.assign(Object.assign({},!m&&{onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e)}),{onApprove:(e,n)=>this.onHostedCheckoutApprove(e,n,t,d)}),v=Object.assign(Object.assign(Object.assign({fundingSource:l.FUNDING.PAYPAL,style:this.paypalCommerceIntegrationService.getValidButtonStyle(s)},p),a&&y),h&&g),f=l.Buttons(v);f.isEligible()?(null===(r=f.hasReturned)||void 0===r?void 0:r.call(f))&&this.isPaypalCommerceAppSwitchEnabled(t)?null===(o=f.resume)||void 0===o||o.call(f):f.render(`#${e}`):c&&"function"==typeof c?c():this.paypalCommerceIntegrationService.removeElement(e)}handleClick(e){return vS(this,void 0,void 0,(function*(){if(e){const t=yield this.paypalCommerceIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}onHostedCheckoutApprove(e,t,n,i){return vS(this,void 0,void 0,(function*(){if(!e.orderID)throw new vn(yn.MissingOrderId);const r=this.paymentIntegrationService.getState().getCartOrThrow(),o=yield t.order.get();try{const t=this.paypalCommerceIntegrationService.getBillingAddressFromOrderDetails(o);if(yield this.paymentIntegrationService.updateBillingAddress(t),r.lineItems.physicalItems.length>0){const e=this.paypalCommerceIntegrationService.getShippingAddressFromOrderDetails(o);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.paypalCommerceIntegrationService.updateOrder()}return yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.paypalCommerceIntegrationService.submitPayment(n,e.orderID),i&&"function"==typeof i&&i(),!0}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingAddressChange(e){return vS(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.paypalCommerceIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingOptionsChange(e){return vS(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}isPaypalCommerceAppSwitchEnabled(e){var t;return(null===(t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e).initializationData)||void 0===t?void 0:t.isAppSwitchEnabled)||!1}}const bS=Ge((e=>new fS(e,fa(e))),[{id:"paypalcommerce"}]);var SS=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class CS{constructor(e,t,n){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t,this.paypalCommerceSdk=n}initialize(e){var t;return SS(this,void 0,void 0,(function*(){const{paypalcommercecredit:n,containerId:i,methodId:r}=e,{buyNowInitializeOptions:o,currencyCode:a,messagingContainerId:s}=n||{},d=!!o;if(!r)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!i)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.paypalcommercecredit" argument is not provided.');if(d&&!a)throw new xn('Unable to initialize payment because "options.paypalcommercecredit.currencyCode" argument is not provided.');if(d&&"function"!=typeof(null==o?void 0:o.getBuyNowCartRequestBody))throw new xn('Unable to initialize payment because "options.paypalcommercecredit.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');d||(yield this.paymentIntegrationService.loadDefaultCheckout());const c=this.paymentIntegrationService.getState(),l=d?a:c.getCartOrThrow().currency.code;yield this.paypalCommerceIntegrationService.loadPayPalSdk(r,l,!1),this.renderButton(i,r,n);const u=c.getStoreConfigOrThrow().checkoutSettings.features;if(null!==(t=u["PAYPAL-5557.Hide_ppc_banner_implementation"])&&void 0!==t&&t)return;const h=s&&document.getElementById(s);if(l&&h){const e=c.getPaymentMethodOrThrow(r),{paypalBNPLConfiguration:t=[]}=e.initializationData||{},n=t&&t.find((({id:e})=>"cart"===e));if(!(null==n?void 0:n.status))return;h.removeAttribute("data-pp-style-logo-type"),h.removeAttribute("data-pp-style-logo-position"),h.removeAttribute("data-pp-style-text-color"),h.removeAttribute("data-pp-style-text-size");const i=yield this.paypalCommerceSdk.getPayPalMessages(e,l);this.renderMessages(i,s,n)}}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onComplete:o,onEligibilityFailure:a}=n,s=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),d=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),{isHostedCheckoutEnabled:c,isAppSwitchEnabled:l}=d.initializationData||{},u={createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercecredit"),onApprove:({orderID:e})=>this.paypalCommerceIntegrationService.tokenizePayment(t,e)},h={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},m=Object.assign(Object.assign({},!l&&{onShippingAddressChange:e=>this.onShippingAddressChange(e),onShippingOptionsChange:e=>this.onShippingOptionsChange(e)}),{onApprove:(e,n)=>this.onHostedCheckoutApprove(e,n,t,o)}),p=[s.FUNDING.PAYLATER,s.FUNDING.CREDIT];let y=!1;p.forEach((t=>{if(!y){const n=Object.assign(Object.assign(Object.assign({fundingSource:t,style:this.paypalCommerceIntegrationService.getValidButtonStyle(r)},u),i&&h),c&&m),o=s.Buttons(n);o.isEligible()?(o.render(`#${e}`),y=!0):a&&"function"==typeof a&&a()}})),y||this.paypalCommerceIntegrationService.removeElement(e)}handleClick(e){return SS(this,void 0,void 0,(function*(){if(e){const t=yield this.paypalCommerceIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}onHostedCheckoutApprove(e,t,n,i){return SS(this,void 0,void 0,(function*(){if(!e.orderID)throw new vn(yn.MissingOrderId);const r=this.paymentIntegrationService.getState().getCartOrThrow(),o=yield t.order.get();try{const t=this.paypalCommerceIntegrationService.getBillingAddressFromOrderDetails(o);if(yield this.paymentIntegrationService.updateBillingAddress(t),r.lineItems.physicalItems.length>0){const e=this.paypalCommerceIntegrationService.getShippingAddressFromOrderDetails(o);yield this.paymentIntegrationService.updateShippingAddress(e),yield this.paypalCommerceIntegrationService.updateOrder()}return yield this.paymentIntegrationService.submitOrder({},{params:{methodId:n}}),yield this.paypalCommerceIntegrationService.submitPayment(n,e.orderID),i&&"function"==typeof i&&i(),!0}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingAddressChange(e){return SS(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getAddress({city:e.shippingAddress.city,countryCode:e.shippingAddress.countryCode,postalCode:e.shippingAddress.postalCode,stateOrProvinceCode:e.shippingAddress.state});try{yield this.paymentIntegrationService.updateBillingAddress(t),yield this.paymentIntegrationService.updateShippingAddress(t);const e=this.paypalCommerceIntegrationService.getShippingOptionOrThrow();yield this.paymentIntegrationService.selectShippingOption(e.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}onShippingOptionsChange(e){return SS(this,void 0,void 0,(function*(){const t=this.paypalCommerceIntegrationService.getShippingOptionOrThrow(e.selectedShippingOption.id);try{yield this.paymentIntegrationService.selectShippingOption(t.id),yield this.paypalCommerceIntegrationService.updateOrder()}catch(e){if("string"==typeof e)throw new Error(e);throw e}}))}renderMessages(e,t,n){const i={amount:this.paymentIntegrationService.getState().getCheckoutOrThrow().outstandingBalance,placement:"cart",style:Vu(n)};e.Messages(i).render(`#${t}`)}}const wS=Ge((e=>new CS(e,fa(e),Aa())),[{id:"paypalcommercecredit"}]);var _S=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class IS{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t}initialize(e){return _S(this,void 0,void 0,(function*(){const{paypalcommercevenmo:t,containerId:n,methodId:i}=e,{buyNowInitializeOptions:r,currencyCode:o}=t||{},a=!!r;if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.paypalcommercevenmo" argument is not provided.');if(a&&!o)throw new xn('Unable to initialize payment because "options.paypalcommercevenmo.currencyCode" argument is not provided.');if(a&&"function"!=typeof(null==r?void 0:r.getBuyNowCartRequestBody))throw new xn('Unable to initialize payment because "options.paypalcommercevenmo.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');a||(yield this.paymentIntegrationService.loadDefaultCheckout());const s=a?o:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.paypalCommerceIntegrationService.loadPayPalSdk(i,s,!1),this.renderButton(n,i,t)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{buyNowInitializeOptions:i,style:r,onEligibilityFailure:o}=n,a=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow(),s=a.FUNDING.VENMO,d={createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercevenmo"),onApprove:({orderID:e})=>this.paypalCommerceIntegrationService.tokenizePayment(t,e)},c={onClick:()=>this.handleClick(i),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},l=Object.assign(Object.assign({fundingSource:s,style:this.getValidVenmoButtonStyles(r)},d),i&&c),u=a.Buttons(l);u.isEligible()?u.render(`#${e}`):o&&"function"==typeof o?o():this.paypalCommerceIntegrationService.removeElement(e)}getValidVenmoButtonStyles(e){const t=this.paypalCommerceIntegrationService.getValidButtonStyle(e);return t.color===da.gold?Object.assign(Object.assign({},t),{color:void 0}):t}handleClick(e){return _S(this,void 0,void 0,(function*(){if(e){const t=yield this.paypalCommerceIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}}const PS=Ge((e=>new IS(e,fa(e))),[{id:"paypalcommercevenmo"}]);var ES=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class OS{constructor(e,t){this.paymentIntegrationService=e,this.paypalCommerceIntegrationService=t}initialize(e){return ES(this,void 0,void 0,(function*(){const{paypalcommercealternativemethods:t,containerId:n,methodId:i}=e,{apm:r,buyNowInitializeOptions:o,currencyCode:a}=t||{},s=!!o;if(!i)throw new xn('Unable to initialize payment because "options.methodId" argument is not provided.');if(!n)throw new xn('Unable to initialize payment because "options.containerId" argument is not provided.');if(!t)throw new xn('Unable to initialize payment because "options.paypalcommercealternativemethods" argument is not provided.');if(!r)throw new xn('Unable to initialize payment because "options.paypalcommercealternativemethods.apm" argument is not provided.');if(s&&!a)throw new xn('Unable to initialize payment because "options.paypalcommercealternativemethods.currencyCode" argument is not provided.');if(s&&"function"!=typeof(null==o?void 0:o.getBuyNowCartRequestBody))throw new xn('Unable to initialize payment because "options.paypalcommercealternativemethods.buyNowInitializeOptions.getBuyNowCartRequestBody" argument is not provided or it is not a function.');s||(yield this.paymentIntegrationService.loadDefaultCheckout());const d=s?a:this.paymentIntegrationService.getState().getCartOrThrow().currency.code;yield this.paypalCommerceIntegrationService.loadPayPalSdk(i,d,!1),this.renderButton(n,i,t)}))}deinitialize(){return Promise.resolve()}renderButton(e,t,n){const{apm:i,buyNowInitializeOptions:r,style:o,onEligibilityFailure:a}=n,s=this.paypalCommerceIntegrationService.getPayPalSdkOrThrow();if(!Object.values(s.FUNDING).includes(i))throw new xn('Unable to initialize PayPal button because "options.paypalcommercealternativemethods.apm" argument is not valid funding source.');const d={createOrder:()=>this.paypalCommerceIntegrationService.createOrder("paypalcommercealternativemethod"),onApprove:({orderID:e})=>this.paypalCommerceIntegrationService.tokenizePayment(t,e)},c={onClick:()=>this.handleClick(r),onCancel:()=>this.paymentIntegrationService.loadDefaultCheckout()},l=Object.assign(Object.assign({fundingSource:i,style:this.paypalCommerceIntegrationService.getValidButtonStyle(o)},d),r&&c),u=s.Buttons(l);u.isEligible()?u.render(`#${e}`):a&&"function"==typeof a?a():this.paypalCommerceIntegrationService.removeElement(e)}handleClick(e){return ES(this,void 0,void 0,(function*(){if(e){const t=yield this.paypalCommerceIntegrationService.createBuyNowCartOrThrow(e);yield this.paymentIntegrationService.loadCheckout(t.id)}}))}}const AS=Ge((e=>new OS(e,fa(e))),[{id:"paypalcommercealternativemethods"}]);var kS,TS,NS,MS,xS;!function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(kS||(kS={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.RESPONSIVE="responsive"}(TS||(TS={})),function(e){e.GOLD="gold",e.BLUE="blue",e.SIlVER="silver",e.BLACK="black"}(NS||(NS={})),function(e){e.CHECKOUT="checkout",e.PAY="pay",e.BUYNOW="buynow",e.PAYPAL="paypal",e.CREDIT="credit"}(MS||(MS={})),function(e){e.PILL="pill",e.RECT="rect"}(xS||(xS={}));var DS=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((i=i.apply(e,t||[])).next())}))};class zS{constructor(e,t,n){this.paymentIntegrationService=e,this.paypalExpressScriptLoader=t,this.formPoster=n}initialize(e){return DS(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId);if(!e.paypal)throw new xn;if(!t.config.merchantId)throw new vn(yn.MissingPaymentMethod);const n=yield this.paypalExpressScriptLoader.loadPaypalSDK(t.config.merchantId);this.renderButton(e,n)}))}deinitialize(){return Promise.resolve()}renderButton(e,t){const{containerId:n,methodId:i,paypal:r}=e,{allowCredit:o,clientId:a,onPaymentError:s,shouldProcessPayment:d,style:c}=r,l=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId);if(!l.config.merchantId)throw new vn(yn.MissingPaymentMethod);const u=l.config.merchantId,h=l.config.testMode?"sandbox":"production",m={[h]:a},p=t.FUNDING.CREDIT||"credit",y=o?[p]:[],g=o?[]:[p];return t.Button.render({env:h,client:m,commit:d,funding:{allowed:y,disallowed:g},style:this.getStyle(c),payment:(e,t)=>this.setupPayment(u,t,s),onAuthorize:(e,t)=>this.tokenizePayment(e,i,t,d)},n)}getStyle(e){const{color:t,fundingicons:n,label:i,layout:r,shape:o,size:a,tagline:s}=e||{};return{color:t,fundingicons:n,label:i,layout:r,shape:o||xS.RECT,size:"small"===a?TS.RESPONSIVE:a,tagline:s}}setupPayment(e,t,n){return DS(this,void 0,void 0,(function*(){if(!t)throw new Sn(gn.CheckoutButtonNotInitialized);try{const n=yield this.paymentIntegrationService.loadDefaultCheckout(),{id:i}=n.getCartOrThrow(),r=n.getHost()||"";return(yield t.request.post(`${r}/api/storefront/payment/paypalexpress`,{merchantId:e,cartId:i},{headers:Object.assign({"X-API-INTERNAL":Ei},ki)})).id}catch(e){throw n&&e instanceof pn&&n(e),e}}))}tokenizePayment(e,t,n,i){return DS(this,void 0,void 0,(function*(){if(!n)throw new Sn(gn.CheckoutButtonNotInitialized);if(!e.paymentID||!e.payerID)throw new vn(yn.MissingPayment);const r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),o=yield n.payment.get(e.paymentID);return this.formPoster.postForm("/checkout.php",{payment_type:"paypal",provider:r.id,action:i?"process_payment":"set_external_checkout",paymentId:e.paymentID,payerId:e.payerID,payerInfo:JSON.stringify(o.payer.payer_info)})}))}}class FS{constructor(e){this.scriptLoader=e,this.window=window}loadPaypalSDK(e=""){return t=this,i=function*(){const t=Object.assign({async:!0,attributes:{"data-merchant-id":e}},e&&{attributes:{"data-merchant-id":e}});if(yield this.scriptLoader.loadScript("//www.paypalobjects.com/api/checkout.min.js",t),!this.window.paypal)throw new Tn;return this.window.paypal},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}s((i=i.apply(t,[])).next())}));var t,n,i}}const BS=Ge((e=>new zS(e,new FS((0,s.vQ)()),(0,N.createFormPoster)())),[{id:"paypalexpress"}]),RS=e=>{const t=(0,c.uniqueId)(e);return document.getElementById(t)?RS(e):t};function LS(e){return Object.prototype.hasOwnProperty.call(e,"cacheKey")}class jS{constructor(e){this._lastId=0,this._map={maps:[]},this._usedMaps=[],this._options=Object.assign({maxSize:0,isEqual:j(),onExpire:c.noop},e)}getKey(...e){const t=this._resolveMap(...e),{index:n,parentMap:i}=t;let{map:r}=t;return r&&r.cacheKey?r.usedCount++:r=this._generateMap(i,e.slice(n)),this._removeLeastUsedMap(r),r.cacheKey}getUsedCount(...e){const{map:t}=this._resolveMap(...e);return t?t.usedCount:0}_resolveMap(...e){let t=0,n=this._map;for(;n.maps.length;){let i=!1;for(let r=0;r<n.maps.length;r++){const o=n.maps[r];if(this._options.isEqual(o.value,e[t])){if(n.maps.unshift(...n.maps.splice(r,1)),(0===e.length||t===e.length-1)&&LS(o))return{index:t,map:o,parentMap:n};i=!0,n=o,t++;break}}if(!i)break}return{index:t,parentMap:n}}_generateMap(e,t){let n,i=0,r=e;do{n={maps:[],parentMap:r,usedCount:1,value:t[i]},r.maps.unshift(n),r=n,i++}while(i<t.length);const o=n;return o.cacheKey=""+ ++this._lastId,o}_removeLeastUsedMap(e){if(!this._options.maxSize)return;const t=this._usedMaps.indexOf(e);if(this._usedMaps.splice(-1===t?0:t,-1===t?0:1,e),this._usedMaps.length<=this._options.maxSize)return;const n=this._usedMaps.pop();n&&(this._removeMap(n),this._options.onExpire(n.cacheKey))}_removeMap(e){e.parentMap&&(e.parentMap.maps.splice(e.parentMap.maps.indexOf(e),1),function(e){return Object.prototype.hasOwnProperty.call(e,"parentMap")}(e.parentMap)||this._removeMap(e.parentMap))}}function US(e){const t=class extends e{};return Object.getOwnPropertyNames(e.prototype).forEach((n=>{const i=Object.getOwnPropertyDescriptor(e.prototype,n);i&&"constructor"!==n&&Object.defineProperty(t.prototype,n,function(e,t,n){if("function"!=typeof n.value)return n;let i=new jS,r=n.value,o=(0,T.Bj)(r);return Zt(e,t,{get(){const e=(...e)=>{const t=o.call(this,...e);if(1===i.getUsedCount(...e))return t;const n=r.call(this,...e);return Ng(n,t,{keyFilter:e=>!function(e){return 0===`${e}`.indexOf("$$")||0===`${e}`.indexOf("_")}(e)})?t:(o.cache.set(i.getKey(...e),n),n)};return Object.defineProperty(this,t,Object.assign(Object.assign({},n),{value:e})),e},set(e){i=new jS,r=e,o=(0,T.Bj)(r)}})}(e.prototype,n,i))})),t}let VS=class{constructor(e){this._checkoutButton=e.checkoutButton}getInitializeButtonError(e){return this._checkoutButton.getInitializeError(e)}getDeinitializeButtonError(e){return this._checkoutButton.getDeinitializeError(e)}};VS=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([US],VS);const qS=VS;let HS=class{constructor(e){this._checkoutButton=e.checkoutButton}isInitializingButton(e){return this._checkoutButton.isInitializing(e)}isDeinitializingButton(e){return this._checkoutButton.isDeinitializing(e)}};HS=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([US],HS);const GS=HS;function $S(e){return{errors:new qS(e),statuses:new GS(e)}}let WS=class{constructor(e,t){this._store=e,this._buttonStrategyActionCreator=t,this._state=$S(this._store.getState()),this._store.subscribe((e=>{this._state=$S(e)}))}getState(){return this._state}subscribe(e,...t){return this._store.subscribe((()=>e(this.getState())),(e=>e.checkoutButton.getState()),...t.map((e=>t=>e($S(t)))))}initializeButton(e){const t=(n=e.containerId,/^\w[\w\-\:\.]*$/.test(n)?[e.containerId]:function(e,t){const n=document.querySelectorAll(e);if(!n.length)throw new $e(`Unable to find any element with the specified selector: ${e}`);return Array.prototype.slice.call(n).map((e=>(e.id||(e.id=RS(t)),e.id)))}(e.containerId,`${e.methodId}-container`));var n;return Promise.all(t.map((t=>{const n=this._buttonStrategyActionCreator.initialize(Object.assign(Object.assign({},e),{containerId:t})),i=`checkoutButtonStrategy:${e.methodId}:${t}`;return this._store.dispatch(n,{queueId:i})}))).then((()=>this.getState()))}deinitializeButton(e){const t=this._buttonStrategyActionCreator.deinitialize(e),n=`checkoutButtonStrategy:${e.methodId}`;return this._store.dispatch(t,{queueId:n}).then((()=>this.getState()))}};WS=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([Zt],WS);var YS,KS,QS,JS,ZS,XS,eC,tC;class nC{constructor(e,t,n,i){this._store=e,this._checkoutActionCreator=t,this._masterpassScriptLoader=n,this._locale=i}initialize(e){const{containerId:t,methodId:n}=e;if(!t||!n)throw new $e('Unable to proceed because "containerId" argument is not provided.');return this._methodId=n,this._store.dispatch(this._checkoutActionCreator.loadDefaultCheckout()).then((e=>{const t=e.paymentMethods.getPaymentMethod(n);if(!t||!t.initializationData.checkoutId)throw new ne(K.MissingPaymentMethod);const i={useMasterpassSrc:t.initializationData.isMasterpassSrcEnabled,language:Mt(this._locale),testMode:t.config.testMode,checkoutId:t.initializationData.checkoutId};return this._masterpassScriptLoader.load(i)})).then((e=>{this._masterpassClient=e,this._signInButton=this._createSignInButton(t)}))}deinitialize(){return this._signInButton&&this._signInButton.parentNode&&(this._signInButton.removeEventListener("click",this._handleWalletButtonClick),this._signInButton.parentNode.removeChild(this._signInButton),this._signInButton=void 0),Promise.resolve()}_createSignInButton(e){const t=document.getElementById(e),n=this._store.getState(),i=this._methodId?n.paymentMethods.getPaymentMethod(this._methodId):null,r=n.config.getStoreConfig();if(!t)throw new Error("Need a container to place the button");if(!i)throw new ne(K.MissingPaymentMethod);if(!r)throw new $e("Unable to retrieve store configuration");const o=document.createElement("input");if(o.type="image",i.initializationData.isMasterpassSrcEnabled){const e=i.config.testMode?"sandbox.":"",{checkoutId:t}=i.initializationData,n=[`locale=${Mt(this._locale)}`,"paymentmethod=master,visa,amex,discover",`checkoutid=${t}`];o.src=[`https://${e}src.mastercard.com/assets/img/btn/src_chk_btn_126x030px.svg`,n.join("&")].join("?")}else o.src="https://static.masterpass.com/dyn/img/btn/global/mp_chk_btn_160x037px.svg";return t.appendChild(o),o.addEventListener("click",this._handleWalletButtonClick),o}_createMasterpassPayload(){const e=this._store.getState(),t=e.checkout.getCheckout(),n=this._methodId?e.paymentMethods.getPaymentMethod(this._methodId):null;if(!t)throw new ne(K.MissingCheckout);if(!n)throw new ne(K.MissingPaymentMethod);return{checkoutId:n.initializationData.checkoutId,allowedCardTypes:n.initializationData.allowedCardTypes,amount:t.cart.cartAmount.toString(),currency:t.cart.currency.code,cartId:t.cart.id,callbackUrl:Tt("cart")}}_handleWalletButtonClick(){if(!this._masterpassClient)throw new wt(ft.CheckoutButtonNotInitialized);this._masterpassClient.checkout(this._createMasterpassPayload())}}(function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);o>3&&a&&Object.defineProperty(t,n,a)})([Zt],nC.prototype,"_handleWalletButtonClick",null),function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(YS||(YS={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.RESPONSIVE="responsive"}(KS||(KS={})),function(e){e.GOLD="gold",e.BLUE="blue",e.SIlVER="silver",e.BLACK="black",e.WHITE="white"}(QS||(QS={})),function(e){e.CHECKOUT="checkout",e.PAY="pay",e.BUYNOW="buynow",e.PAYPAL="paypal",e.CREDIT="credit"}(JS||(JS={})),function(e){e.PILL="pill",e.RECT="rect"}(ZS||(ZS={}));!function(e){e.CheckoutComplete="CHECKOUT_COMPLETE",e.CheckoutError="CHECKOUT_ERROR",e.CheckoutLoaded="CHECKOUT_LOADED",e.FrameError="FRAME_ERROR",e.FrameLoaded="FRAME_LOADED",e.SignedOut="SIGNED_OUT"}(XS||(XS={}));class iC extends Ie{constructor(e){super(e,{message:e.body.title}),this.name="InvalidLoginTokenError",this.type="invalid_login_token"}}!function(e){e.MissingContainer="missing_container",e.MissingContent="missing_content",e.UnknownError="unknown_error"}(eC||(eC={}));class rC extends te{constructor(e,t=eC.UnknownError){super(e||"Unable to embed the checkout form."),this.subtype=t,this.name="NotEmbeddableError",this.type="not_embeddable"}}!function(e){e.StyleConfigured="STYLE_CONFIGURED"}(tC||(tC={}));const oC="isCookieAllowed",aC="lastAllowCookieAttempt";let sC=class{constructor(e,t,n,i,r,o,a,s){this._iframeCreator=e,this._messageListener=t,this._messagePoster=n,this._loadingIndicator=i,this._requestSender=r,this._storage=o,this._location=a,this._options=s,this._isAttached=!1,this._options.onComplete&&this._messageListener.addListener(XS.CheckoutComplete,this._options.onComplete),this._options.onError&&this._messageListener.addListener(XS.CheckoutError,this._options.onError),this._options.onLoad&&this._messageListener.addListener(XS.CheckoutLoaded,this._options.onLoad),this._options.onFrameLoad&&this._messageListener.addListener(XS.FrameLoaded,this._options.onFrameLoad),this._options.onSignOut&&this._messageListener.addListener(XS.SignedOut,this._options.onSignOut),this._messageListener.addListener(XS.FrameLoaded,(()=>this._configureStyles()))}attach(){return this._isAttached?Promise.resolve(this):(this._isAttached=!0,this._messageListener.listen(),this._loadingIndicator.show(this._options.containerId),this._allowCookie().then((()=>this._attemptLogin())).then((e=>this._iframeCreator.createFrame(e,this._options.containerId))).then((e=>{this._iframe=e,this._configureStyles(),this._loadingIndicator.hide()})).catch((e=>(this._isAttached=!1,this._retryAllowCookie(e).catch((()=>{throw this._messageListener.trigger({type:XS.FrameError,payload:e}),this._loadingIndicator.hide(),e}))))).then((()=>this)))}detach(){this._isAttached&&(this._isAttached=!1,this._messageListener.stopListen(),this._iframe&&this._iframe.parentNode&&(this._iframe.parentNode.removeChild(this._iframe),this._iframe.iFrameResizer.close()))}_configureStyles(){this._iframe&&this._iframe.contentWindow&&this._options.styles&&(this._messagePoster.setTarget(this._iframe.contentWindow),this._messagePoster.post({type:tC.StyleConfigured,payload:this._options.styles}))}_attemptLogin(){return/^\/login\/token/.test(zt(this._options.url).pathname)?this._requestSender.post(this._options.url).then((({body:{redirectUrl:e}})=>e)).catch((e=>Promise.reject(new iC(e)))):Promise.resolve(this._options.url)}_allowCookie(){if(this._storage.getItem(oC))return Promise.resolve();this._storage.setItem(oC,!0),this._storage.setItem(aC,Date.now());const{origin:e}=zt(this._options.url),t=`${e}/embedded-checkout/allow-cookie?returnUrl=${encodeURIComponent(this._location.href)}`;return document.body.style.visibility="hidden",this._location.replace(t),new Promise((()=>{}))}_retryAllowCookie(e){const t=Number(this._storage.getItem(aC));return(!t||Date.now()-t>6e5)&&e instanceof rC&&e.subtype===eC.MissingContent?(this._storage.removeItem(aC),this._storage.removeItem(oC),this._allowCookie()):Promise.reject()}};sC=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([Zt],sC);function dC(e){if(!e.payload||!e.payload.contentId)return;const t=document.getElementById(e.payload.contentId);t&&!t.hasAttribute("data-iframe-height")&&t.setAttribute("data-iframe-height","")}function cC(e){return"object"==typeof e&&null!==e&&"message"in e&&"type"in e}let lC=class{constructor(e,t,n,i={}){this._messageListener=e,this._messagePoster=t,this._untargetedMessagePoster=n,this._messageHandlers=i,this._messageListener.listen()}postComplete(){const e={type:XS.CheckoutComplete};this._postMessage(e)}postError(e){const t={type:XS.CheckoutError,payload:this._transformError(e)};this._postMessage(t)}postFrameError(e){const t={type:XS.FrameError,payload:this._transformError(e)};this._postMessage(t,{untargeted:!0})}postFrameLoaded(e){const t={type:XS.FrameLoaded,payload:e};this._postMessage(t)}postLoaded(){const e={type:XS.CheckoutLoaded};this._postMessage(e)}postSignedOut(){const e={type:XS.SignedOut};this._postMessage(e)}receiveStyles(e){this._messageListener.addListener(tC.StyleConfigured,(({payload:t})=>{e(t)}))}_postMessage(e,t){if(this._notifyMessageHandlers(e),t&&t.untargeted)return this._untargetedMessagePoster.post(e);this._messagePoster.post(e)}_notifyMessageHandlers(e){Object.keys(this._messageHandlers).forEach((t=>{if(e.type!==t)return;const n=this._messageHandlers[t];n&&n.call(null,e)}))}_transformError(e){return{message:e.message,type:cC(e)?e.type:void 0,subtype:cC(e)?e.subtype:void 0}}};lC=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([Zt],lC);const uC=lC;let hC=class{postComplete(){}postError(){}postFrameError(){}postFrameLoaded(){}postLoaded(){}postSignedOut(){}receiveStyles(){}};hC=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([Zt],hC);const mC=hC;function pC(e){$(939);const t=e.parentWindow||window.parent;return window===t?new mC:new uC(new ln(e.parentOrigin),new Ut(e.parentOrigin,t),new Ut("*",t),{[XS.FrameLoaded]:dC})}const yC="en",gC="optimized_checkout";let vC=class{constructor(e,t){var n;this._logger=t;const{locale:i,locales:r,translations:o}=this._transformConfig(e);this._locale=i,this._locales=r,this._translations=o,this._formatters={},this._isCspNonceExperimentEnabled=null===(n=e.isCspNonceExperimentEnabled)||void 0===n||n}mapKeys(e){Object.keys(e).forEach((t=>{const n=`${gC}.${e[t]}`;this._translations[`${gC}.${t}`]=this._translations[n]}))}getLocale(){return this._hasTranslations()?this._locale:yC}translate(e,t={}){var n;const i=`${gC}.${e}`;if("string"!=typeof this._translations[i])return this._logger.warn(`Translation key "${i}" is missing`),i;if(this._isCspNonceExperimentEnabled){this._formatters[i]||(this._formatters[i]=new U.S(this._escapeSpecialCharacters(this._translations[i]||""),this._locales[i],void 0,{ignoreTag:!0}));try{return this._formatters[i].format(this._transformData(t))}catch(e){if(this._isFormatError(e))return null!==(n=e.originalMessage)&&void 0!==n?n:"";throw e}}if(!this._formatters[i]){const e=new(q())(this._locales[i]);this._formatters[i]=e.compile(this._translations[i]||"")}return this._formatters[i](this._transformData(t))}_transformConfig(e={}){const t={defaultLocale:"",defaultTranslations:{},translations:{},locales:{},locale:e.locale||yC},n=e.locales||{},i=this._flattenObject(e.translations||{}),r=this._flattenObject(e.defaultTranslations||{}),o=this._flattenObject(e.fallbackTranslations||{});return(0,c.union)(Object.keys(o),Object.keys(r),Object.keys(i)).forEach((a=>{var s,d;i&&i[a]?(t.translations[a]=i[a],t.locales[a]=n[a]||t.locale):r[a]?(t.translations[a]=r[a],t.locales[a]=null!==(s=e.defaultLocale)&&void 0!==s?s:yC):(t.translations[a]=o[a],t.locales[a]=null!==(d=e.fallbackLocale)&&void 0!==d?d:yC)})),t}_flattenObject(e,t={},n=""){try{Object.keys(e).forEach((i=>{const r=e[i],o=n?`${n}.${i}`:i;if((0,c.isObject)(r))return this._flattenObject(r,t,o);t[o]=r}))}catch(e){this._logger.warn(`Unable to parse object: ${e}`)}return t}_transformData(e){return Object.keys(e).reduce(((t,n)=>{const i=e[n];return t[n]=null==i?"":i,t}),{})}_hasTranslations(){return Object.keys(this._locales).map((e=>this._locales[e])).filter((e=>e.split("-")[0]===this._locale.split("-")[0])).length>0}_isFormatError(e){return"object"==typeof e&&null!==e&&"originalMessage"in e}_escapeSpecialCharacters(e){return e.replace(/(\w+)='([^']*)'/g,"$1=''$2''")}};vC=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([Zt],vC);const fC=vC;function bC(e={}){return new fC(e,be())}let SC=class{constructor(e){this._storeConfig=e,this._customerFormatter=new Yr(this._storeConfig.shopperCurrency),this._storeFormatter=new Yr(this._storeConfig.currency)}toCustomerCurrency(e){const t=this._storeConfig.shopperCurrency.exchangeRate;return this._customerFormatter.format(e*t)}toStoreCurrency(e){return this._storeFormatter.format(e)}};SC=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}([Zt],SC);const CC=SC;function wC(e){return new CC(e)}function _C(e){return e&&"ga"in e&&"function"==typeof e.ga}function IC(e,t){_C(window)&&window.ga("send",e,Object.assign(Object.assign({},t),{nonInteraction:!1}))}function PC(e){return EC(e).length>=8096}function EC(e){return Object.keys(e).reduce(((t,n)=>{const i=typeof e[n];return"string"===i||"number"===i?[...t,`${n}=${e[n]}`]:"object"===i&&null!==e[n]?[...t,EC(e[n])]:t}),[]).join("&")}var OC;!function(e){e[e.CUSTOMER=1]="CUSTOMER",e[e.SHIPPING=2]="SHIPPING",e[e.BILLING=3]="BILLING",e[e.PAYMENT=4]="PAYMENT"}(OC||(OC={}));const AC={customer:OC.CUSTOMER,shipping:OC.SHIPPING,billing:OC.BILLING,payment:OC.PAYMENT};class kC{constructor(e,t,n,{checkoutSteps:i}={}){if(this.checkoutService=e,this.analyticsExtraItemsManager=t,this.analytics=n,this._checkoutStarted=!1,this._completedSteps={},this._viewedSteps={},this._analyticStepOrder=["customer","shipping","billing","payment"],void 0!==i){if(i.some((e=>!(e in AC))))throw new $e(`Invalid checkout steps provided. Valid values are: ${(0,c.keys)(AC).join(", ")}.`);this._analyticStepOrder=i}}trackCheckoutStarted(){if(this._checkoutStarted)return;const e=this.getCheckout();if(!e)return;const{coupons:t,grandTotal:n,shippingCostTotal:i,taxTotal:r,cart:{lineItems:o,discountAmount:a,id:s}}=e,d=this.analyticsExtraItemsManager.saveExtraItemsData(s,o);this.analytics.track("Checkout Started",this.getTrackingPayload({revenue:n,shipping:i,tax:r,discount:a,coupons:t,lineItems:o,extraItemsData:d})),this._checkoutStarted=!0}trackOrderComplete(){var e;const t=this.getOrder();if(!t)return;const{isComplete:n,orderId:i,orderAmount:r,shippingCostTotal:o,taxTotal:a,discountAmount:s,coupons:d,lineItems:c,cartId:l}=t;if(!n)return;const u=this.analyticsExtraItemsManager.readExtraItemsData(l);if(null===u)return;const h=null===(e=this.checkoutService.getState().data.getConfig())||void 0===e?void 0:e.checkoutSettings.features["DATA-6891.missing_orders_within_GA"],m=this.getTrackingPayload({orderId:i,revenue:r,shipping:o,tax:a,discount:s,coupons:d,extraItemsData:u,lineItems:c});if(h&&ic(window)&&_C(window)&&PC(m))return IC("transaction",{"&ti":m.order_id,"&ta":m.affiliation,"&tr":m.revenue,"&ts":m.shipping,"&tt":m.tax,"&tcc":m.coupon,"&cu":m.currency}),m.products.forEach((e=>{IC("item",{"&ti":m.order_id,"&in":e.name,"&ic":e.sku,"&iv":`${e.category}`,"&ip":e.price,"&iq":e.quantity})})),this.analyticsExtraItemsManager.clearExtraItemData(l);this.analytics.track("Order Completed",m),this.analyticsExtraItemsManager.clearExtraItemData(l)}trackStepViewed(e){const t=this.getIdFromStep(e);t&&!this.hasStepViewed(t)&&(this.trackViewed(t),this.backfill(t))}trackStepCompleted(e){const t=this.getIdFromStep(e);t&&!this.hasStepCompleted(t)&&(this.backfill(t),this.trackCompleted(t))}backfill(e){for(const t of this._analyticStepOrder){const n=this.getIdFromStep(t);if(!n)break;if(this.hasStepViewed(n)||this.trackViewed(n),n===e)break;this.hasStepCompleted(n)||this.trackCompleted(n)}}trackCompleted(e){const t=this.getSelectedShippingOption(),{code:n=""}=this.getShopperCurrency()||{},i=this.getPaymentMethodName(),r={step:e,currency:n};t&&(r.shipping_method=t.description),i&&(r.payment_method=i),r.shipping_method||r.payment_method||(r.shipping_method=" "),this.analytics.track("Checkout Step Completed",r);const o=t?t.id:"",a=e===OC.SHIPPING?`${e}-${o}`:e;this._completedSteps[a]=!0}getTrackingPayload({orderId:e,revenue:t,shipping:n,tax:i,discount:r,coupons:o,extraItemsData:a,lineItems:s}){const{code:d=""}=this.getShopperCurrency()||{},{storeName:c=""}=this.getStoreProfile()||{};return{order_id:String(e),affiliation:c,revenue:this.toShopperCurrency(t),shipping:this.toShopperCurrency(n),tax:this.toShopperCurrency(i),discount:this.toShopperCurrency(r),coupon:(o||[]).map((e=>e.code.toUpperCase())).join(","),currency:d,products:this.getProducts(a,s)}}hasStepCompleted(e){const t=this.getSelectedShippingOption(),n=t?t.id:"";return Object.prototype.hasOwnProperty.call(this._completedSteps,e)||e===OC.SHIPPING&&Object.prototype.hasOwnProperty.call(this._completedSteps,`${e}-${n}`)}hasStepViewed(e){return!!this._viewedSteps[e]}getIdFromStep(e){const t=e.split(".");return AC[t[0]]||null}trackViewed(e){const t=this.getShopperCurrency();this.analytics.track("Checkout Step Viewed",{step:e,currency:t?t.code:""}),this._viewedSteps[e]=!0}getOrder(){const{data:{getOrder:e}}=this.checkoutService.getState();return e()}getCheckout(){const{data:{getCheckout:e}}=this.checkoutService.getState();return e()}getShopperCurrency(){const{data:{getConfig:e}}=this.checkoutService.getState(),t=e();return t&&t.shopperCurrency}getStoreProfile(){const{data:{getConfig:e}}=this.checkoutService.getState(),t=e();return t&&t.storeProfile}toShopperCurrency(e){const{exchangeRate:t=1}=this.getShopperCurrency()||{};return Math.round(e*t*100)/100}getSelectedShippingOption(){const{data:e}=this.checkoutService.getState(),t=e.getSelectedShippingOption();return t&&t.id&&t.description?t:null}getPaymentMethodName(){const{data:e}=this.checkoutService.getState(),t=e.getSelectedPaymentMethod();return t&&t.config&&t.config.displayName||""}getProducts(e,t){const n=(t.customItems||[]).map((e=>({product_id:e.id,sku:e.sku,price:e.listPrice,quantity:e.quantity,name:e.name}))),i=t.giftCertificates.map((e=>({product_id:e.id,price:this.toShopperCurrency(e.amount),name:e.name,quantity:1})));return[...n,...[...t.physicalItems,...t.digitalItems].map((t=>{let n;t.options&&t.options.length&&(n=t.options.map((e=>`${e.name}:${e.value}`)),n.sort());const i=Array.isArray(n)&&n.length?n.join(", "):"single-product-option",r=e[t.productId]&&e[t.productId].brand;return Object.assign({product_id:String(t.productId),sku:t.sku,price:t.salePrice,image_url:t.imageUrl,name:t.name,quantity:t.quantity,category:e[t.productId]?e[t.productId].category:"",variant:i},r&&{brand:r})})),...i]}}class TC{trackCheckoutStarted(){}trackOrderComplete(){}trackStepViewed(){}trackStepCompleted(){}}function NC(e,t){const{data:n}=e.getState(),i=n.getConfig();if(!i)throw new ne(K.MissingCheckoutConfig);const{isAnalyticsEnabled:r}=i.checkoutSettings;return r&&ic(window)?new kC(e,new nc(x.Ay),window.analytics,t):new TC}function MC(e){return Boolean(e.hasOwnProperty("braintreeFastlane"))}class xC{constructor(e){this.checkoutService=e,this._selectedPaymentMethodId=""}customerPaymentMethodExecuted(){this._shouldTrackFastlaneEvent()&&this._trackEmailSubmitted()}paymentComplete(){this._shouldTrackFastlaneEvent()&&this._trackOrderPlaced(this._selectedPaymentMethodId)}selectedPaymentMethod(e){this._shouldTrackFastlaneEvent()&&e&&(this._selectedPaymentMethodId=e,this._trackApmSelected(e,!1))}walletButtonClick(e){this._shouldTrackFastlaneEvent()&&e&&(this._selectedPaymentMethodId=e,this._trackApmSelected(e,!0))}_shouldTrackFastlaneEvent(){const e=this.checkoutService.getState(),t=e.data.getPaymentMethod("braintree")||e.data.getPaymentMethod("braintreeacceleratedcheckout"),n=null==t?void 0:t.initializationData.isBraintreeAnalyticsV2Enabled,i=MC(window)&&window.braintreeFastlane.events;return n&&i}_getBraintreeEventsOrThrow(){if(MC(window))return window.braintreeFastlane.events;throw new Tn}_trackEmailSubmitted(){const{emailSubmitted:e}=this._getBraintreeEventsOrThrow();e(this._getEmailSubmittedEventOptions())}_trackApmSelected(e,t){const{apmSelected:n}=this._getBraintreeEventsOrThrow();n(this._getApmSelectedEventOptions(e,t))}_trackOrderPlaced(e){const{orderPlaced:t}=this._getBraintreeEventsOrThrow();t(this._getOrderPlacedEventOptions(e))}_getEventCommonOptions(){var e,t;const n=this.checkoutService.getState(),i=n.data.getCart(),r=null===(e=n.data.getConfig())||void 0===e?void 0:e.storeProfile,o=null===(t=n.data.getCustomer())||void 0===t?void 0:t.isGuest,a=n.data.getPaymentMethod("braintreeacceleratedcheckout"),s=[{treatment_group:!n.errors.getLoadPaymentMethodError("braintreeacceleratedcheckout")&&(null==a?void 0:a.initializationData.shouldRunAcceleratedCheckout)?"test":"control"}];return{context_type:"cs_id",context_id:(null==i?void 0:i.id)||"",page_type:"checkout_page",page_name:window.document.title,partner_name:"bigc",user_type:o?"store_guest":"store_member",store_id:(null==r?void 0:r.storeId)||"",merchant_name:(null==r?void 0:r.storeName)||"",experiment:JSON.stringify(s)}}_getEmailSubmittedEventOptions(){const e=(this.checkoutService.getState().data.getPaymentMethods()||[]).map((({id:e})=>e));return Object.assign(Object.assign({},this._getEventCommonOptions()),{user_email_saved:!1,apm_shown:e.length>1?"1":"0",apm_list:e.join(",")})}_getApmSelectedEventOptions(e,t){const n=(this.checkoutService.getState().data.getPaymentMethods()||[]).map((({id:e})=>e));return Object.assign(Object.assign({},this._getEventCommonOptions()),{apm_shown:n.length>1?"1":"0",apm_list:n.join(","),apm_selected:e,apm_location:t?"pre-email section":"payment section"})}_getOrderPlacedEventOptions(e){const t=this.checkoutService.getState().data.getCart();return Object.assign(Object.assign({},this._getEventCommonOptions()),{selected_payment_method:e,currency_code:(null==t?void 0:t.currency.code)||""})}}function DC(e){return new xC(e)}class zC{constructor(e){this._checkoutService=e,this._selectedPaymentMethodId=""}customerPaymentMethodExecuted(){this._shouldTrackFastlaneEvent()&&this._trackEmailSubmitted()}paymentComplete(){this._shouldTrackFastlaneEvent()&&this._trackOrderPlaced(this._selectedPaymentMethodId)}selectedPaymentMethod(e){this._shouldTrackFastlaneEvent()&&e&&(this._selectedPaymentMethodId=e,this._trackApmSelected(e,!1))}walletButtonClick(e){this._shouldTrackFastlaneEvent()&&e&&(this._selectedPaymentMethodId=e,this._trackApmSelected(e,!0))}_shouldTrackFastlaneEvent(){const e=this._checkoutService.getState().data.getPaymentMethod("paypalcommerce"),t=((null==e?void 0:e.initializationData)||{}).isPayPalCommerceAnalyticsV2Enabled,n=window,i=!!n.paypalFastlane&&!!n.paypalFastlane.events;return t&&i}_getPayPalEventsOrThrow(){const e=window;if(e.paypalFastlane&&e.paypalFastlane.events)return e.paypalFastlane.events;throw new Tn}_trackEmailSubmitted(){const{emailSubmitted:e}=this._getPayPalEventsOrThrow();e(this._getEmailSubmittedEventOptions())}_trackApmSelected(e,t){const{apmSelected:n}=this._getPayPalEventsOrThrow();n(this._getApmSelectedEventOptions(e,t))}_trackOrderPlaced(e){const{orderPlaced:t}=this._getPayPalEventsOrThrow();t(this._getOrderPlacedEventOptions(e))}_getEventCommonOptions(){var e,t;const n=this._checkoutService.getState(),i=n.data.getCart(),r=null===(e=n.data.getConfig())||void 0===e?void 0:e.storeProfile,o=null===(t=n.data.getCustomer())||void 0===t?void 0:t.isGuest,a="paypalcommerceacceleratedcheckout",s=n.data.getPaymentMethod(a),d=[{treatment_group:!n.errors.getLoadPaymentMethodError(a)&&(null==s?void 0:s.initializationData.shouldRunAcceleratedCheckout)?"test":"control"}];return{context_type:"cs_id",context_id:(null==i?void 0:i.id.replace(/-/g,""))||"",page_type:"checkout_page",page_name:window.document.title,partner_name:"bigc",user_type:o?"store_guest":"store_member",store_id:(null==r?void 0:r.storeId)||"",merchant_name:(null==r?void 0:r.storeName)||"",experiment:JSON.stringify(d)}}_getEmailSubmittedEventOptions(){const e=(this._checkoutService.getState().data.getPaymentMethods()||[]).map((({id:e})=>e));return Object.assign(Object.assign({},this._getEventCommonOptions()),{user_email_saved:!1,apm_shown:e.length>1?"1":"0",apm_list:e.join(",")})}_getApmSelectedEventOptions(e,t){const n=(this._checkoutService.getState().data.getPaymentMethods()||[]).map((({id:e})=>e));return Object.assign(Object.assign({},this._getEventCommonOptions()),{apm_shown:n.length>1?"1":"0",apm_list:n.join(","),apm_selected:e,apm_location:t?"pre-email section":"payment section"})}_getOrderPlacedEventOptions(e){const t=this._checkoutService.getState().data.getCart();return Object.assign(Object.assign({},this._getEventCommonOptions()),{selected_payment_method:e,currency_code:(null==t?void 0:t.currency.code)||""})}}function FC(e){return new zC(e)}var BC;!function(e){e.CUSTOMER="customer",e.SHIPPING="shipping",e.BILLING="billing",e.PAYMENT="payment"}(BC||(BC={}));const RC=[BC.CUSTOMER,BC.SHIPPING,BC.BILLING,BC.PAYMENT];class LC{constructor(e,t){this.subscribe=e,this.bodlEvents=t,this._checkoutStarted=!1,this._emailEntryBegan=!1,this._shippingOptionsShown=!1,this._completedSteps={},this.subscribe((e=>{var t;if(this.setState(e.data),!(null===(t=this.state)||void 0===t?void 0:t.getConfig()))throw new ne(K.MissingCheckoutConfig)}))}setState(e){this.state=e}checkoutBegin(){const e=this._getCommonCheckoutData();!this._checkoutStarted&&e&&(this.bodlEvents.emitCheckoutBeginEvent(e),this._checkoutStarted=!0)}orderPurchased(){var e;const t=null===(e=this.state)||void 0===e?void 0:e.getOrder();if(!t)return;const{currency:n,isComplete:i,orderId:r,orderAmount:o,shippingCostTotal:a,lineItems:s,cartId:d,coupons:c,channelId:l,taxTotal:u}=t;i&&this.bodlEvents.emitOrderPurchasedEvent({event_id:d,currency:n.code,order_id:r,tax:u,channel_id:l,cart_value:o,coupon_codes:c.map((e=>e.code.toUpperCase())),shipping_cost:a,line_items:this._getProducts(s,n.code)})}stepCompleted(e){e&&RC.some((t=>(this._hasStepCompleted(t)||this._trackCompletedStep(t),t===e)))}customerEmailEntry(e){!this._emailEntryBegan&&(null==e?void 0:e.length)&&(this._emailEntryBegan=!0,this.bodlEvents.emit("bodl_checkout_email_entry_began"))}customerSuggestionInit(e){this.bodlEvents.emit("bodl_checkout_customer_suggestion_initialization",e)}customerSuggestionExecute(){this.bodlEvents.emit("bodl_checkout_customer_suggestion_execute")}customerPaymentMethodExecuted(e){this.bodlEvents.emit("bodl_checkout_customer_payment_method_executed",e)}showShippingMethods(){this._shippingOptionsShown||(this._shippingOptionsShown=!0,this.bodlEvents.emit("bodl_checkout_show_shipping_options"))}selectedPaymentMethod(e){const t=this._getCommonCheckoutData();t&&e&&this.bodlEvents.emitPaymentDetailsProvidedEvent(Object.assign(Object.assign({},t),{payment_type:e}))}clickPayButton(e){this.bodlEvents.emit("bodl_checkout_click_pay_button",e)}paymentRejected(){this.bodlEvents.emit("bodl_checkout_payment_rejected")}paymentComplete(){this.bodlEvents.emit("bodl_checkout_payment_complete")}exitCheckout(){this.bodlEvents.emit("bodl_checkout_exit")}_trackCompletedStep(e){this._completedSteps[e]=!0;const t={[BC.SHIPPING]:this._trackShippingStepCompleted.bind(this)}[e];t?t():this.bodlEvents.emit("bodl_checkout_step_completed",{step:e})}_trackShippingStepCompleted(){var e,t;const n=null===(t=null===(e=this.state)||void 0===e?void 0:e.getSelectedShippingOption())||void 0===t?void 0:t.description,i=this._getCommonCheckoutData();i&&n&&this.bodlEvents.emitShippingDetailsProvidedEvent(Object.assign(Object.assign({},i),{shipping_method:n}))}_getCommonCheckoutData(){var e;const t=null===(e=this.state)||void 0===e?void 0:e.getCheckout();if(!t)return null;const{cart:{cartAmount:n,currency:i,lineItems:r,id:o,coupons:a},channelId:s}=t;return{event_id:o,currency:i.code,cart_value:n,coupon_codes:a.map((e=>e.code.toUpperCase())),line_items:this._getProducts(r,i.code),channel_id:s}}_getProducts(e,t){const n=(e.customItems||[]).map((e=>({product_id:e.id,sku:e.sku,base_price:e.listPrice,sale_price:e.listPrice,purchase_price:e.listPrice,quantity:e.quantity,product_name:e.name,currency:t}))),i=e.giftCertificates.map((e=>({product_id:e.id,gift_certificate_id:e.id,base_price:e.amount,sale_price:e.amount,purchase_price:e.amount,product_name:e.name,gift_certificate_name:e.name,gift_certificate_theme:e.theme,quantity:1,currency:t})));return[...n,...[...e.physicalItems,...e.digitalItems].map((e=>{let n;return e.options&&e.options.length&&(n=e.options.map((e=>`${e.name}:${e.value}`)),n.sort()),{product_id:e.productId,quantity:e.quantity,product_name:e.name,base_price:e.listPrice,sale_price:e.salePrice,purchase_price:e.salePrice>0?e.salePrice:e.listPrice,sku:e.sku,variant_id:e.variantId,discount:e.discountAmount,coupon_amount:e.couponAmount,brand_name:e.brand,currency:t,category_names:(i=e,Array.isArray(i.categoryNames)?i.categoryNames:Array.isArray(i.categories)?(0,c.flatten)(i.categories).map((({name:e})=>e)):[]),retail_price:e.retailPrice};var i})),...i].map((e=>Object.assign(Object.assign({},e),{product_id:String(e.product_id)})))}_hasStepCompleted(e){return this._completedSteps[e]}}class jC{checkoutBegin(){}orderPurchased(){}stepCompleted(){}customerEmailEntry(){}customerSuggestionInit(){}customerSuggestionExecute(){}customerPaymentMethodExecuted(){}showShippingMethods(){}selectedPaymentMethod(){}clickPayButton(){}paymentRejected(){}paymentComplete(){}exitCheckout(){}}function UC(e){return"bodlEvents"in window?new LC(e,window.bodlEvents.checkout):new jC}},98610:(e,t,n)=>{n.d(t,{A:()=>i});const i=n(28058).A},99838:(e,t,n)=>{n.d(t,{W:()=>r});var i=n(70355);const r=()=>i.createElement("aside",{className:"layout-cart"},i.createElement("article",{className:"cart optimizedCheckout-orderSummary checkout-page-skeleton checkout-page-skeleton--cart"},i.createElement("div",{className:"item--first"},i.createElement("div",null),i.createElement("div",null)),i.createElement("div",{className:"item"},i.createElement("div",null)),i.createElement("div",{className:"item--product"},i.createElement("div",{className:"figure"}),i.createElement("div",{className:"name"}),i.createElement("div",null)),i.createElement("div",{className:"item"},i.createElement("div",null),i.createElement("div",null)),i.createElement("div",{className:"item"},i.createElement("div",null),i.createElement("div",null)),i.createElement("div",{className:"item--coupon"},i.createElement("div",null)),i.createElement("div",{className:"item--total"},i.createElement("div",null),i.createElement("div",null)),i.createElement("div",{className:"item--tax"},i.createElement("div",null)),i.createElement("div",{className:"item--last"},i.createElement("div",null),i.createElement("div",null))))}},e=>{var t=t=>e(e.s=t);e.O(0,[5534,9506],(()=>(t(17850),t(82897))));var n=e.O();checkout=n}]);
//# sourceMappingURL=checkout-a434cca2.js.map