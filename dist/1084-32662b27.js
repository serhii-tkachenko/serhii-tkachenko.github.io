"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[1084],{31084:(e,t,n)=>{n.d(t,{BigCommercePaymentsAPMsPaymentMethod:()=>C,BigCommercePaymentsButton:()=>s,BigCommercePaymentsCreditCardsPaymentMethod:()=>B,BigCommercePaymentsFastlanePaymentMethod:()=>q,BigCommercePaymentsPayLaterPaymentMethod:()=>Y,BigCommercePaymentsPaymentMethod:()=>_,BigCommercePaymentsRatePayPaymentMethod:()=>ne,BigCommercePaymentsVenmoPaymentMethod:()=>$,BigcommercePaymentsPayLaterButton:()=>K});var a=n(14900),r=n(70355),i=n(63582),o=n(19285),c=n(4907);const s=(0,o.A)((e=>{const t={onComplete:c.A,onError:e.onUnhandledError};return r.createElement(i.A,Object.assign({additionalInitializationOptions:t,integrations:[a.ae]},e))}),[{id:"bigcommerce_payments"}]);var d=n(31635),m=n(11474),l=n(40646),u=n(48447),y=n(91182);const p=({method:e,checkoutService:t,paymentForm:n,onUnhandledError:i,providerOptionsKey:o,providerOptionsData:c,children:s,currentInstrument:m,language:l,shouldConfirmInstrument:u})=>{const y=(0,r.useRef)(null),p=(0,r.useRef)(null),g=(0,r.useRef)(null),h=(0,r.useRef)(!1),b=n.getFieldValue("terms"),f=n.getFieldValue("shouldSaveInstrument"),v=()=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){const e=yield n.validateForm();return Object.keys(e)})),_=()=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){if(!y.current)return;(yield v()).length?y.current.disable():y.current.enable()})),E=(0,r.useCallback)((()=>{m&&!u?(n.hidePaymentSubmitButton(e,!1),h.current=!1):!h.current&&g.current&&(n.hidePaymentSubmitButton(e,!0),setTimeout((()=>{var e;null===(e=g.current)||void 0===e||e.call(g),h.current=!0}),0))}),[m]);(0,r.useEffect)((()=>{E()}),[E,g.current]),(0,r.useEffect)((()=>{_()}),[b]),(0,r.useEffect)((()=>{p.current={shouldSaveInstrument:u||Boolean(f)}}),[f,u]);return(0,r.useEffect)((()=>((0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,integrations:[a.Y9,a.v1,a.EF,a.BA],[o]:Object.assign({container:"#checkout-payment-continue",shouldRenderPayPalButtonOnInitialization:!1,onRenderButton:()=>{n.hidePaymentSubmitButton(e,!0)},onInit:e=>{g.current=e},submitForm:()=>{n.setSubmitted(!0),n.submitForm()},onError:t=>{n.disableSubmit(e,!0),"INSTRUMENT_DECLINED"===t.message?i(new Error(l.translate("payment.errors.instrument_declined"))):i(t)},onValidate:(e,t)=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){const a=yield v();return a.length?(n.setSubmitted(!0),a.forEach((e=>n.setFieldTouched(e))),t()):e()})),onInitButton:e=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){y.current=e,yield _()})),getFieldsValues:()=>p.current},c||{})})}catch(e){e instanceof Error&&i(e)}})),()=>{(0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&i(e)}}))})),[]),s?r.createElement(r.Fragment,null,s):r.createElement(r.Fragment,null)};var g=n(69440),h=n(65685),b=n(39981),f=n(66960);const v=e=>{const[t,n]=(0,r.useState)(),{checkoutState:a}=(0,b.Q)(),i=a.data.getCustomer(),o=a.data.getInstruments(e)||[],{paymentForm:c}=(0,f.N)(),{setFieldValue:s}=c,d=(0,r.useMemo)((()=>o.filter(h.A)),[o]),m=(0,r.useMemo)((()=>d.filter((e=>e.trustedShippingAddress))),[d]),l=d.length>0,u=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled)&&!e.initializationData.isComplete,y=u&&l,p=y&&!t,v=y&&!!t&&!m.length;(0,r.useEffect)((()=>{n(u?(()=>{if(!m.length)return;return m.filter((({defaultInstrument:e})=>e))[0]||m[0]})():void 0)}),[u,m]),(0,r.useEffect)((()=>{y||s("instrumentId","")}),[s,y]);const _=(0,r.useCallback)((e=>{n((0,g.find)(m,{bigpayToken:e})),s("instrumentId",e),s("shouldSetAsDefaultInstrument",!1)}),[m,s]),E=(0,r.useCallback)((()=>{n(void 0),s("instrumentId",""),s("shouldSaveInstrument",!1),s("shouldSetAsDefaultInstrument",!1)}),[s]);return{trustedAccountInstruments:m,currentInstrument:t,handleSelectInstrument:_,handleUseNewInstrument:E,isInstrumentFeatureAvailable:u,shouldShowInstrumentFieldset:y,shouldCreateNewInstrument:p,shouldConfirmInstrument:v}},_=(0,o.A)((e=>{const{checkoutState:{data:{isPaymentDataRequired:t,getCustomer:n,getInstruments:a},statuses:{isLoadingInstruments:i,isLoadingPaymentMethod:o}}}=e,c=e.method,{config:{isVaultingEnabled:s}}=c,g=(0,d.__rest)(c.initializationData,[]),{method:h,checkoutService:b,onUnhandledError:f}=e,{trustedAccountInstruments:_,currentInstrument:E,handleSelectInstrument:C,handleUseNewInstrument:I,isInstrumentFeatureAvailable:P,shouldShowInstrumentFieldset:S,shouldConfirmInstrument:A}=v(h);if((0,r.useEffect)((()=>{const{isGuest:e}=n()||{};!e&&s&&!g&&(0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield b.loadInstruments()}catch(e){e instanceof Error&&f(e)}}))})),!t())return null;const w=i()||o(h.id),F=a()||[];return r.createElement(y.A,{hideContentWhenLoading:!0,isLoading:w},r.createElement(p,Object.assign({currentInstrument:E,providerOptionsKey:"bigcommerce_payments",shouldConfirmInstrument:A},e),S&&r.createElement(m.A,{instruments:_,onSelectInstrument:C,onUseNewInstrument:I,selectedInstrument:E}),A&&r.createElement("div",null,r.createElement(u.A,{id:"payment.account_instrument_new_shipping_address"})),P&&r.createElement(l.A,{instrumentId:null==E?void 0:E.bigpayToken,instruments:F,isAccountInstrument:!0})))}),[{id:"bigcommerce_payments"}]);var E=n(29345);const C=(0,o.A)((e=>{const{method:t,checkoutState:n}=e;if(!n.data.isPaymentDataRequired())return null;const a=(0,E.A)(t.id,t.gateway),i={apmFieldsContainer:`#${a}`,apmFieldsStyles:{variables:{fontFamily:"Open Sans, Helvetica Neue, Arial, sans-serif",colorBackground:"transparent",textColor:"black",fontSizeBase:"16px",spacingUnit:"1rem",borderColor:"#d9d9d9",borderRadius:"4px",borderWidth:"1px"},rules:{".Input":{backgroundColor:"white",color:"#333",fontSize:"1rem"},".Input:active":{color:"#4496f6"},".Input--invalid":{color:"#ed6a6a"}}}};return r.createElement(p,Object.assign({providerOptionsData:i,providerOptionsKey:"bigcommerce_payments_apms"},e),r.createElement("div",{className:`widget widget--${t.id} payment-widget`,id:a}))}),[{gateway:"bigcommerce_payments_apms"}]);var I=n(17077),P=n(98363),S=n(27883),A=n(35781),w=n(66833),F=n(48407),k=n(31448),N=n(82804),T=n(53783);const B=(0,o.A)((e=>{const{checkoutService:t,checkoutState:n,paymentForm:i,language:o,method:c}=e,{cardCode:s,showCardHolderName:m,isHostedFormEnabled:l,requireCustomerCode:u}=c.config,[y,p]=(0,r.useState)(),{setFieldTouched:h,setFieldValue:b,setSubmitted:f,submitForm:v}=i,_=(0,F.A)(n),E=(0,k.A)(n),C=s||null===s,B=null==m||m,O=(0,r.useCallback)((e=>`${(0,g.compact)([c.gateway,c.id]).join("-")}-${e}`),[c]),R=(0,r.useCallback)((e=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){const t=["color","fontFamily","fontSize","fontWeight"],n=!!e&&E(e,c),a=!!e&&_(e,c),r=n||a;let i;return e&&r&&(i=O("ccCvv")),e||(i=O("ccNumber")),{fields:e?{cardCodeVerification:r?{accessibilityLabel:o.translate("payment.credit_card_cvv_label"),containerId:O("ccCvv"),instrumentId:e.bigpayToken}:void 0,cardNumberVerification:r?{accessibilityLabel:o.translate("payment.credit_card_number_label"),containerId:O("ccNumber"),instrumentId:e.bigpayToken}:void 0,cardExpiryVerification:r?{accessibilityLabel:o.translate("payment.credit_card_expiry_label"),containerId:O("ccExpiry"),instrumentId:e.bigpayToken}:void 0}:{cardCode:C?{accessibilityLabel:o.translate("payment.credit_card_cvv_label"),containerId:O("ccCvv")}:void 0,cardExpiry:{accessibilityLabel:o.translate("payment.credit_card_expiration_label"),containerId:O("ccExpiry"),placeholder:o.translate("payment.credit_card_expiration_placeholder_text")},cardName:{accessibilityLabel:o.translate("payment.credit_card_name_label"),containerId:O("ccName")},cardNumber:{accessibilityLabel:o.translate("payment.credit_card_number_label"),containerId:O("ccNumber")}},styles:i?{default:yield(0,N.A)(i,t),error:yield(0,N.A)(i,t,N.S.Error),focus:yield(0,N.A)(i,t,N.S.Focus)}:{},onBlur:({fieldType:e})=>{y===e&&p(void 0)},onCardTypeChange:({cardType:e})=>{b("hostedForm.cardType",e)},onEnter:()=>{f(!0),v()},onFocus:({fieldType:e})=>{p(e)},onValidate:({errors:e={}})=>{(0,g.forIn)(e,((e,t)=>{const n=`hostedForm.errors.${t}`;b(n,e&&e[0].type?e[0].type:""),e&&e[0]&&h(n)}))}}}))),[y,O,C,B,_,E,o,c,b,h,p,f,v]),D=(0,r.useCallback)((e=>{const t=!!e&&E(e,c),n=!!e&&_(e,c),a=t||n;return r.createElement(P.A,{cardCodeId:n?O("ccCvv"):void 0,cardExpiryId:a?O("ccExpiry"):void 0,cardNumberId:t?O("ccNumber"):void 0,focusedFieldType:y})}),[y,O,_,E,c]),x=t.initializePayment,M=(0,r.useCallback)(((e,t)=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){return x(Object.assign(Object.assign({},e),{integrations:[a.On],bigcommerce_payments_creditcards:{form:l?yield R(t):void 0}}))}))),[R,x]);return l?r.createElement(I.A,Object.assign({},e,{cardFieldset:r.createElement(S.A,{additionalFields:u&&r.createElement(T.A,{name:"ccCustomerCode"}),cardCodeId:C?O("ccCvv"):void 0,cardExpiryId:O("ccExpiry"),cardNameId:O("ccName"),cardNumberId:O("ccNumber"),focusedFieldType:y}),cardValidationSchema:(0,A.A)({language:o}),deinitializePayment:t.deinitializePayment,getHostedFormOptions:R,getStoredCardValidationFieldset:D,initializePayment:M,storedCardValidationSchema:(0,w.A)({language:o,isCardExpiryRequired:!0})})):r.createElement(I.A,Object.assign({},e,{deinitializePayment:t.deinitializePayment,initializePayment:M}))}),[{id:"bigcommerce_payments_creditcards"}]);var O=n(94027),R=n(9343),D=n(56943);const x=({renderPayPalCardComponent:e})=>((0,r.useEffect)((()=>{"function"==typeof e&&e("#big-commerce-payments-fastlane-cc-form-container")}),[e]),r.createElement("div",{className:"big-commerce-payments-fastlane-cc-form-container","data-test":"big-commerce-payments-fastlane-cc-form-container",id:"big-commerce-payments-fastlane-cc-form-container"}));var M=n(49655),z=n(35172),V=n(86516),L=n(63163);const j=({onChange:e,handleSelectInstrument:t,selectedInstrument:n})=>{const a=function(e){switch(e.toLowerCase()){case"amex":case"american_express":return"american-express";case"diners":return"diners-club";case"master_card":return"mastercard";default:return e}}(n.brand).toLowerCase();return r.createElement("div",{className:"big-commerce-payments-fastlane-instrument","data-test":"big-commerce-payments-fastlane-instrument-form"},r.createElement("div",null,r.createElement("div",{className:"big-commerce-payments-fastlane-instrument-details"},r.createElement(V.A,{cardType:a}),r.createElement("div",{className:"instrumentSelect-card","data-test":"big-commerce-fastlane-instrument-last4"},r.createElement("span",null,"●●●● ",n.last4))),r.createElement("div",{className:"big-commerce-payments-fastlane-instrument-branding"},r.createElement(z.A,null))),r.createElement("div",{className:"big-commerce-payments-fastlane-instrument-change-action"},r.createElement(L.Ay,{onClick:()=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof e){const n=yield e();n&&t(n)}})),size:L.Mp.Tiny,testId:"big-commerce-payments-fastlane-instrument-change",variant:L.Ak.Secondary},r.createElement(M.A,{id:"common.change_action"}))))},U=({renderPayPalCardComponent:e,showPayPalCardSelector:t})=>{const{instruments:n,handleSelectInstrument:a,selectedInstrument:i}=(()=>{const[e,t]=(0,r.useState)(),{getPaymentProviderCustomer:n}=(0,b.Q)().checkoutState.data,a=n(),i=(0,D.A)(a)?a:{},{paymentForm:o}=(0,f.N)();return{instruments:i.instruments||[],handleSelectInstrument:e=>{t(e),o.setFieldValue("instrumentId",e.bigpayToken)},selectedInstrument:e}})(),o=n.length>0;return(0,r.useEffect)((()=>{!i&&n.length>0&&a(n[0])}),[n,i,a]),r.createElement("div",{className:"paymentMethod paymentMethod--creditCard"},o&&r.createElement(j,{handleSelectInstrument:a,onChange:t,selectedInstrument:i||n[0]}),!o&&r.createElement(x,{renderPayPalCardComponent:e}))};const q=(0,o.A)((({method:e,checkoutService:t,checkoutState:n,onUnhandledError:i,paymentForm:o,language:c})=>{const s=(0,r.useRef)({}),{isLoadingPaymentMethod:m,isInitializingPayment:l}=n.statuses;(0,r.useEffect)((()=>((0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({methodId:e.id,integrations:[a.g3],bigcommerce_payments_fastlane:{onInit:e=>{s.current.renderPayPalCardComponent=e},onChange:e=>{s.current.showPayPalCardSelector=e},onError:e=>{let t;return t=function(e){return"object"==typeof e&&null!==e&&"translationKey"in e}(e)?new Error(c.translate(e.translationKey)):e instanceof Error?e:new Error(c.translate("payment.errors.general_error")),i(t)}}})}catch(e){e instanceof Error&&i(e)}})),()=>{(0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({methodId:e.id})}catch(e){e instanceof Error&&i(e)}}))})),[]);const u=l()||m(e.id),p={isSubmitted:o.isSubmitted(),setSubmitted:o.setSubmitted};return r.createElement(R.Ay.Provider,{value:p},r.createElement(b.A.Provider,{value:{checkoutState:n,checkoutService:t}},r.createElement(O.A,{checkoutService:t},r.createElement(f.i.Provider,{value:{paymentForm:o}},r.createElement(y.A,{hideContentWhenLoading:!0,isLoading:u},r.createElement(U,{renderPayPalCardComponent:s.current.renderPayPalCardComponent,showPayPalCardSelector:s.current.showPayPalCardSelector}))))))}),[{id:"bigcommerce_payments_fastlane"}]),K=(0,o.A)((e=>{const t={onComplete:c.A,onError:e.onUnhandledError};return r.createElement(i.A,Object.assign({additionalInitializationOptions:t,integrations:[a.MF]},e))}),[{id:"bigcommerce_payments_paylater"}]),Y=(0,o.A)((e=>{const{checkoutState:t}=e;return t.data.isPaymentDataRequired()?r.createElement(p,Object.assign({providerOptionsKey:"bigcommerce_payments_paylater"},e)):null}),[{id:"bigcommerce_payments_paylater"}]),$=(0,o.A)((e=>e.checkoutState.data.isPaymentDataRequired()?r.createElement(p,Object.assign({providerOptionsKey:"bigcommerce_payments_venmo"},e)):null),[{id:"bigcommerce_payments_venmo"}]);var H=n(20874),G=n(25657),W=n(33740),J=n(41410),Q=n(44218),X=n(94202);const Z=(0,Q.Bj)((function({formFieldData:e,language:t}){const n={ratepayPhoneCountryCode:"payment.ratepay.phone_country_code",ratepayPhoneNumber:"payment.ratepay.phone_number",ratepayBirthDate:"payment.ratepay.birth_date"};return(0,X.Ik)(e.reduce(((e,{id:a,required:r})=>(r&&n[a]&&(e[a]=(0,X.Yj)().nullable().required(t.translate("payment.ratepay.errors.isRequired",{fieldName:t.translate(n[a])})),"ratepayPhoneCountryCode"===a&&(e[a]=e[a].matches(/^\+\d{2,}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_country_code")}))),"ratepayPhoneNumber"===a&&(e[a]=e[a].matches(/^\d{7,11}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_number")})))),e)),{}))})),ee="ITEM_CATEGORY_NOT_SUPPORTED_BY_PAYMENT_SOURCE",te=[{name:"ratepayBirthDate",custom:!1,id:"ratepayBirthDate",label:"payment.ratepay.birth_date",required:!0,fieldType:W.A.DATE,inputDateFormat:"dd.MM.yyyy"},{name:"ratepayPhoneCountryCode",custom:!1,id:"ratepayPhoneCountryCode",label:"payment.ratepay.phone_country_code",required:!0,fieldType:W.A.TEXT,type:"string"},{name:"ratepayPhoneNumber",custom:!1,id:"ratepayPhoneNumber",label:"payment.ratepay.phone_number",required:!0,fieldType:W.A.TEXT}],ne=(0,o.A)((({method:e,checkoutService:t,onUnhandledError:n,paymentForm:{isSubmitted:i,setFieldValue:o,setValidationSchema:c,setSubmitted:s},language:m,checkoutState:l})=>{const u=(0,r.useRef)({}),y=l.data.isPaymentDataRequired();if(!y)return null;(0,r.useEffect)((()=>((0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,integrations:[a.Gd],bigcommerce_payments_ratepay:{container:"#checkout-payment-continue",legalTextContainer:"legal-text-container",loadingContainerId:"checkout-page-container",getFieldsValues:()=>u.current,onError:e=>{var t,a;const r=null===(t=e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error));if(null==r?void 0:r.length){let e,t;const i=null===(a=r[0].provider_error)||void 0===a?void 0:a.code;switch(i){case"PAYMENT_SOURCE_DECLINED_BY_PROCESSOR":e="payment.ratepay.errors.paymentSourceDeclinedByProcessor";break;case"PAYMENT_SOURCE_INFO_CANNOT_BE_VERIFIED":e="payment.ratepay.errors.paymentSourceInfoCannotBeVerified";break;case ee:e="payment.ratepay.errors.itemCategoryNotSupportedByPaymentSource";break;default:e="common.error_heading"}return t=i!==ee?new G.A({data:{shouldBeTranslatedAsHtml:!0,translationKey:e}}):new Error(m.translate(e)),n(t)}n(e)}}})}catch(e){e instanceof Error&&n(e)}})),()=>{(0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&n(e)}}))})),[]);const p=(0,r.useCallback)((e=>t=>{var n;o(e,t),n={[e]:t},u.current=Object.assign(Object.assign({},u.current),n)}),[o]),g=(0,r.useMemo)((()=>Z({formFieldData:te,language:m})),[m,te]);return(0,r.useEffect)((()=>{s(!1),c(e,g)}),[g,e,c,s]),(0,r.useEffect)((()=>{o("ratepayPhoneCountryCode",(()=>{const e=l.data.getBillingAddress();return(0,H.B)(e.country)[0]||""})().dialCode)}),[]),r.createElement("div",{style:{marginBottom:"20px"}},r.createElement(R.Ay.Provider,{value:{isSubmitted:i,setSubmitted:s}},te.map((e=>r.createElement(J.A,{extraClass:`dynamic-form-field--${e.id}`,field:e,key:e.id,label:m.translate(e.label),onChange:p(e.id)})))))}),[{gateway:"bigcommerce_payments_apms",id:"ratepay"}])}}]);
//# sourceMappingURL=1084-32662b27.js.map