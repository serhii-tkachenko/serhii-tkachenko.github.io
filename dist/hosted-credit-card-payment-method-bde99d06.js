"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[4960,9154],{26314:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(70355),r=n(19285),a=n(5003);const s=(0,r.A)((({method:e,checkoutService:t,checkoutState:n,paymentForm:r,language:s,onUnhandledError:o})=>i.createElement(a.A,{checkoutService:t,checkoutState:n,language:s,method:e,onUnhandledError:o,paymentForm:r})),[{id:"hosted-credit-card"},{id:"credit_card",gateway:"bluesnapdirect"},{id:"credit_card",gateway:"checkoutcom"},{id:"tdonlinemart"}])},60713:(e,t,n)=>{n.d(t,{HostedCreditCardPaymentMethod:()=>i.A});var i=n(26314)},97861:(e,t,n)=>{n.r(t),n.d(t,{default:()=>me});var i=n(31635),r=n(94365),a=n(38589),s=n(58002),o={};function d(e){return Boolean(e.instrumentId)}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const c=e=>"object"==typeof e&&null!==e&&"body"in e;var u,l,h,m=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{d(i.next(e))}catch(e){a(e)}}function o(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))};class p{constructor(e,t){this._paymentIntegrationService=e,this._cardinalClient=t}prepare(e){return m(this,void 0,void 0,(function*(){yield this._cardinalClient.load(e.id,e.config.testMode),yield this._cardinalClient.configure(yield this._getClientToken(e))}))}start(e,t,n,i){return m(this,void 0,void 0,(function*(){const{getCardInstrument:r,getPaymentMethodOrThrow:a}=this._paymentIntegrationService.getState(),{payment:{methodId:o="",paymentData:u={}}={}}=t,l=d(u)&&r(u.instrumentId),h=l?l.iin:i&&i.getBin();h&&(yield this._cardinalClient.runBinProcess(h));try{return yield e((0,s.merge)(t,{payment:{paymentData:{threeDSecure:{token:a(o).clientToken}}}}),n)}catch(e){if(!c(e)||!(0,s.some)(e.body.errors,{code:"three_d_secure_required"}))throw e;const n=yield this._cardinalClient.getThreeDSecureData(e.body.three_ds_result,this._getOrderData());if(!i)return void(yield this._paymentIntegrationService.submitPayment((0,s.merge)(t.payment,{paymentData:{threeDSecure:n}})));yield i.submit((0,s.merge)(t.payment,{paymentData:{threeDSecure:n}}))}}))}_getClientToken(e){return m(this,void 0,void 0,(function*(){return e.clientToken?e.clientToken:(yield this._paymentIntegrationService.loadPaymentMethod(e.id),this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e.id).clientToken||"")}))}_getOrderData(){const e=this._paymentIntegrationService.getState(),t=e.getBillingAddressOrThrow(),n=e.getShippingAddress(),i=e.getCheckoutOrThrow(),r=e.getOrderOrThrow();return{billingAddress:t,shippingAddress:n,currencyCode:i.cart.currency.code,id:r.orderId.toString(),amount:i.cart.cartAmount}}}class g extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}(h=u||(u={}))[h.MissingBillingAddress=0]="MissingBillingAddress",h[h.MissingCart=1]="MissingCart",h[h.MissingCheckout=2]="MissingCheckout",h[h.MissingConsignments=3]="MissingConsignments",h[h.MissingCustomer=4]="MissingCustomer",h[h.MissingCheckoutConfig=5]="MissingCheckoutConfig",h[h.MissingOrder=6]="MissingOrder",h[h.MissingOrderConfig=7]="MissingOrderConfig",h[h.MissingOrderId=8]="MissingOrderId",h[h.MissingPayment=9]="MissingPayment",h[h.MissingPaymentId=10]="MissingPaymentId",h[h.MissingPaymentInstrument=11]="MissingPaymentInstrument",h[h.MissingPaymentMethod=12]="MissingPaymentMethod",h[h.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",h[h.MissingPaymentStatus=14]="MissingPaymentStatus",h[h.MissingPaymentToken=15]="MissingPaymentToken",h[h.MissingShippingAddress=16]="MissingShippingAddress";class y extends g{constructor(e){super(function(e){switch(e){case u.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case u.MissingCart:return"Unable to proceed because cart data is unavailable.";case u.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case u.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case u.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case u.MissingCheckoutConfig:case u.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case u.MissingOrder:return"Unable to proceed because order data is unavailable.";case u.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case u.MissingPayment:return"Unable to proceed because payment data is unavailable.";case u.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case u.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case u.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}class b extends g{constructor(e){super(e||"Unable to proceed because the client library of a payment method has thrown an unexpected error."),this.name="PaymentMethodFailedError",this.type="payment_method_client_invalid"}}!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(l||(l={}));class f extends g{constructor(e){super(function(e){switch(e){case l.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case l.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case l.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case l.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}const _=[100004,1010,1011,1020];var v,w,C,S,I,P,M;!function(e){e.SetupCompleted="payments.setupComplete",e.Validated="payments.validated"}(v||(v={})),function(e){e.Init="init",e.Complete="complete",e.Confirm="confirm"}(w||(w={})),function(e){e.Success="SUCCESS",e.NoAction="NOACTION",e.Failure="FAILURE",e.Error="ERROR"}(C||(C={})),function(e){e.CCA="CCA",e.Paypal="Paypal",e.Wallet="Wallet",e.VisaCheckout="VisaCheckout",e.ApplePay="ApplePay",e.DiscoverWallet="DiscoverWallet"}(S||(S={})),function(e){e.BinProcess="bin.process"}(I||(I={})),function(e){e.CCA="cca"}(P||(P={})),function(e){e.Yes="Y",e.No="N"}(M||(M={}));class O{constructor(e){this._scriptLoader=e,this._provider="",this._testMode=!1,this._configurationToken=""}load(e,t=!1){return this._provider=e,this._testMode=t,this._sdk||(this._sdk=this._scriptLoader.load(e,t)),this._sdk.then(s.noop)}configure(e){if(this._configurationToken){if(this._configurationToken===e)return Promise.resolve();this._sdk=this._scriptLoader.load(`${this._provider}.${Date.now()}`,this._testMode)}return this._getClientSDK().then((t=>new Promise(((n,i)=>{t.on(v.SetupCompleted,(()=>{t.off(v.SetupCompleted),t.off(v.Validated),this._configurationToken=e,n()})),t.on(v.Validated,(e=>{t.off(v.SetupCompleted),t.off(v.Validated),e.ActionCode===C.Error&&((0,s.includes)(_,e.ErrorNumber)&&i(new y(u.MissingPaymentMethod)),i(new b(e.ErrorDescription)))})),t.setup(w.Init,{jwt:e})}))))}runBinProcess(e){return this._getClientSDK().then((t=>t.trigger(I.BinProcess,e).catch(s.noop))).then((e=>{if(!e||!e.Status)throw new f(l.PaymentNotInitialized)}))}getThreeDSecureData(e,t){return this._getClientSDK().then((n=>new Promise(((i,r)=>{n.on(v.Validated,((e,t)=>{if(n.off(v.Validated),!t)return r(new b(e.ErrorDescription?e.ErrorDescription:"An error was encountered while processing the transaction."));if(!e.ActionCode)return i({token:t});switch(e.ActionCode){case C.Success:return i({token:t});case C.NoAction:return e.ErrorNumber>0?r(new b(e.ErrorDescription)):e.Payment&&e.Payment.ExtendedData&&e.Payment.ExtendedData.SignatureVerification===M.Yes?i({token:t}):r(new b("Transaction signature could not be validated."));case C.Failure:return r(new b("User failed authentication or an error was encountered while processing the transaction."));case C.Error:return r(new b(e.ErrorDescription))}}));const a={AcsUrl:e.acs_url,Payload:e.merchant_data},s=this._mapToPartialOrder(t,e.payer_auth_request);n.continue(P.CCA,a,s)}))))}_mapToPartialOrder(e,t){const n={BillingAddress:this._mapToCardinalAddress(e.billingAddress)};return e.paymentData&&(n.Account=this._mapToCardinalAccount(e.paymentData)),e.billingAddress.email&&(n.Email1=e.billingAddress.email),e.shippingAddress&&(n.ShippingAddress=this._mapToCardinalAddress(e.shippingAddress)),{Consumer:n,OrderDetails:{OrderNumber:e.id,Amount:e.amount,CurrencyCode:e.currencyCode,OrderChannel:"S",TransactionId:t}}}_mapToCardinalAccount(e){return{AccountNumber:Number(e.ccNumber),ExpirationMonth:Number(e.ccExpiry.month),ExpirationYear:Number(e.ccExpiry.year),NameOnAccount:e.ccName,CardCode:Number(e.ccCvv)}}_mapToCardinalAddress(e){const t={FirstName:e.firstName,LastName:e.lastName,Address1:e.address1,City:e.city,State:e.stateOrProvince,PostalCode:e.postalCode,CountryCode:e.countryCode};return e.address2&&(t.Address2=e.address2),e.phone&&(t.Phone1=e.phone),t}_getClientSDK(){if(!this._sdk)throw new f(l.PaymentNotInitialized);return this._sdk}}class k extends g{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}class A{constructor(e,t=window){this._scriptLoader=e,this._window=t}load(e,t){const n=t?"https://songbirdstag.cardinalcommerce.com/edge/v1/songbird.js":"https://songbird.cardinalcommerce.com/edge/v1/songbird.js";return this._scriptLoader.loadScript(`${n}?v=${e}`).then((()=>{if(!this._window.Cardinal)throw new k;return this._window.Cardinal}))}}function E(e,t){return Object.assign(e,{resolveIds:t})}class z extends g{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class x extends g{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}class N extends z{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}var F=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{d(i.next(e))}catch(e){a(e)}}function o(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))},D=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};class T{constructor(e){this._paymentIntegrationService=e}execute(e,t){var n,i;return this._isHostedPaymentFormEnabled(null===(n=e.payment)||void 0===n?void 0:n.methodId,null===(i=e.payment)||void 0===i?void 0:i.gatewayId)&&this._shouldRenderHostedForm?this._executeWithHostedForm(e,t):this._executeWithoutHostedForm(e,t)}initialize(e){if(!this._isHostedPaymentFormEnabled(null==e?void 0:e.methodId,null==e?void 0:e.gatewayId)||!this._isHostedFieldAvailable(e))return this._shouldRenderHostedForm=!1,Promise.resolve();const t=e&&e.creditCard&&e.creditCard.form,n=this._paymentIntegrationService.getState(),{paymentSettings:{bigpayBaseUrl:i=""}={}}=n.getStoreConfigOrThrow();if(!t)throw new z;const r=this._paymentIntegrationService.createHostedForm(i,t);return r.attach().then((()=>(this._shouldRenderHostedForm=!0,this._hostedForm=r,Promise.resolve())))}deinitialize(){return this._hostedForm&&this._hostedForm.detach(),Promise.resolve()}finalize(){return Promise.reject(new x)}_executeWithoutHostedForm(e,t){return F(this,void 0,void 0,(function*(){const{payment:n}=e,i=D(e,["payment"]),r=n&&n.paymentData;if(!n||!r)throw new N(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(i,t),yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:r}))}))}_executeWithHostedForm(e,t){return F(this,void 0,void 0,(function*(){const{payment:n}=e,i=D(e,["payment"]),r=this._hostedForm;if(!r)throw new f(l.PaymentNotInitialized);if(!n||!n.methodId)throw new N(["payment.methodId"]);yield this._paymentIntegrationService.submitOrder(i,t),yield r.validate().then((()=>r.submit(n)))}))}_isHostedPaymentFormEnabled(e,t){return!!e&&!0===this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t).config.isHostedFormEnabled}_isHostedFieldAvailable(e){return!(0,s.values)(e&&e.creditCard&&e.creditCard.form.fields).every(s.isNil)}}var U=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{d(i.next(e))}catch(e){a(e)}}function o(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))};class j extends T{constructor(e,t){super(e),this._threeDSecureFlow=t}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return U(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const{getPaymentMethodOrThrow:n}=this._paymentIntegrationService.getState(),i=n(e.methodId);i.config.is3dsEnabled&&(yield this._threeDSecureFlow.prepare(i))}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return U(this,void 0,void 0,(function*(){const{payment:{methodId:i=""}={}}=e,{getPaymentMethodOrThrow:r}=this._paymentIntegrationService.getState();return r(i).config.is3dsEnabled?this._threeDSecureFlow.start(n.execute.bind(this),e,t,this._hostedForm):n.execute.call(this,e,t)}))}}const H=E((e=>new j(e,new p(e,new O(new A((0,a.vQ)()))))),[{id:"cybersource"}]);var B=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{d(i.next(e))}catch(e){a(e)}}function o(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))};class q{constructor(e,t){this._paymentIntegrationService=e,this._cardinalClient=t}prepare(e){return B(this,void 0,void 0,(function*(){yield this._cardinalClient.load(e.id,e.config.testMode)}))}start(e,t,n,i){var r,a,o,d;return B(this,void 0,void 0,(function*(){const{getCardInstrument:u}=this._paymentIntegrationService.getState(),{payment:l={methodId:""}}=t,{paymentData:h={}}=l;try{return yield e(t,n)}catch(e){if(c(e)&&"additional_action_required"===(null===(r=e.body)||void 0===r?void 0:r.status)){const t=null===(o=null===(a=e.body.additional_action_required)||void 0===a?void 0:a.data)||void 0===o?void 0:o.token,n=null===(d=e.body.three_ds_result)||void 0===d?void 0:d.payer_auth_request;yield this._cardinalClient.configure(t);const r=this._getBin(h,u,i);r&&(yield this._cardinalClient.runBinProcess(r));try{return yield this._submitPayment(l,{xid:n},i)}catch(e){if(c(e)&&(0,s.some)(e.body.errors,{code:"three_d_secure_required"})){const t=e.body.three_ds_result,n=null==t?void 0:t.payer_auth_request;return yield this._cardinalClient.getThreeDSecureData(t,this._getOrderData()),this._submitPayment(l,{token:n},i)}throw e}}throw e}}))}_getOrderData(){const e=this._paymentIntegrationService.getState(),t=e.getBillingAddressOrThrow(),n=e.getShippingAddress(),{cart:{currency:{code:i},cartAmount:r}}=e.getCheckoutOrThrow();return{billingAddress:t,shippingAddress:n,currencyCode:i,id:e.getOrderOrThrow().orderId.toString(),amount:r}}_submitPayment(e,t,n){return B(this,void 0,void 0,(function*(){const i=(0,s.merge)({},e,{paymentData:{threeDSecure:t}});n||(yield this._paymentIntegrationService.submitPayment(i)),yield null==n?void 0:n.submit(i)}))}_getBin(e,t,n){const i=d(e)&&t(e.instrumentId),r=function(e){const t=e;return!d(t)&&"string"==typeof t.ccName&&"string"==typeof t.ccNumber&&"object"==typeof t.ccExpiry&&"string"==typeof t.ccExpiry.month&&"string"==typeof t.ccExpiry.year}(e)&&e.ccNumber,a=n?n.getBin():r;return(i?i.iin:a)||""}}var V=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{d(i.next(e))}catch(e){a(e)}}function o(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))};class R extends T{constructor(e,t){super(e),this._threeDSecureFlow=t}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return V(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const{getPaymentMethodOrThrow:n}=this._paymentIntegrationService.getState(),i=n(e.methodId);i.config.is3dsEnabled&&(yield this._threeDSecureFlow.prepare(i))}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return V(this,void 0,void 0,(function*(){const{payment:{methodId:i=""}={}}=e,{getPaymentMethodOrThrow:r}=this._paymentIntegrationService.getState();return r(i).config.is3dsEnabled?this._threeDSecureFlow.start(n.execute.bind(this),e,t,this._hostedForm):n.execute.call(this,e,t)}))}}const L=E((e=>new R(e,new q(e,new O(new A((0,a.vQ)()))))),[{id:"cybersourcev2"}]);var W,$=n(58636);class K extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class Z extends K{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class Y extends K{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}class G extends Z{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(W||(W={}));class J extends K{constructor(e){super(function(e){switch(e){case W.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case W.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case W.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case W.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}var Q,X,ee=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{d(i.next(e))}catch(e){a(e)}}function o(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))},te=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};class ne{constructor(e){this._paymentIntegrationService=e}execute(e,t){var n,i;return this._isHostedPaymentFormEnabled(null===(n=e.payment)||void 0===n?void 0:n.methodId,null===(i=e.payment)||void 0===i?void 0:i.gatewayId)&&this._shouldRenderHostedForm?this._executeWithHostedForm(e,t):this._executeWithoutHostedForm(e,t)}initialize(e){if(!this._isHostedPaymentFormEnabled(null==e?void 0:e.methodId,null==e?void 0:e.gatewayId)||!this._isHostedFieldAvailable(e))return this._shouldRenderHostedForm=!1,Promise.resolve();const t=e&&e.creditCard&&e.creditCard.form,n=this._paymentIntegrationService.getState(),{paymentSettings:{bigpayBaseUrl:i=""}={}}=n.getStoreConfigOrThrow();if(!t)throw new Z;const r=this._paymentIntegrationService.createHostedForm(i,t);return r.attach().then((()=>(this._shouldRenderHostedForm=!0,this._hostedForm=r,Promise.resolve())))}deinitialize(){return this._hostedForm&&this._hostedForm.detach(),Promise.resolve()}finalize(){return Promise.reject(new Y)}_executeWithoutHostedForm(e,t){return ee(this,void 0,void 0,(function*(){const{payment:n}=e,i=te(e,["payment"]),r=n&&n.paymentData;if(!n||!r)throw new G(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(i,t),yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:r}))}))}_executeWithHostedForm(e,t){return ee(this,void 0,void 0,(function*(){const{payment:n}=e,i=te(e,["payment"]),r=this._hostedForm;if(!r)throw new J(W.PaymentNotInitialized);if(!n||!n.methodId)throw new G(["payment.methodId"]);yield this._paymentIntegrationService.submitOrder(i,t),yield r.validate().then((()=>r.submit(n)))}))}_isHostedPaymentFormEnabled(e,t){return!!e&&!0===this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t).config.isHostedFormEnabled}_isHostedFieldAvailable(e){return!(0,s.values)(e&&e.creditCard&&e.creditCard.form.fields).every(s.isNil)}}!function(e){e[e.MissingBillingAddress=0]="MissingBillingAddress",e[e.MissingCart=1]="MissingCart",e[e.MissingCheckout=2]="MissingCheckout",e[e.MissingConsignments=3]="MissingConsignments",e[e.MissingCustomer=4]="MissingCustomer",e[e.MissingCheckoutConfig=5]="MissingCheckoutConfig",e[e.MissingOrder=6]="MissingOrder",e[e.MissingOrderConfig=7]="MissingOrderConfig",e[e.MissingOrderId=8]="MissingOrderId",e[e.MissingPayment=9]="MissingPayment",e[e.MissingPaymentId=10]="MissingPaymentId",e[e.MissingPaymentInstrument=11]="MissingPaymentInstrument",e[e.MissingPaymentMethod=12]="MissingPaymentMethod",e[e.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",e[e.MissingPaymentStatus=14]="MissingPaymentStatus",e[e.MissingPaymentToken=15]="MissingPaymentToken",e[e.MissingShippingAddress=16]="MissingShippingAddress"}(Q||(Q={}));class ie extends K{constructor(e){super(function(e){switch(e){case Q.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case Q.MissingCart:return"Unable to proceed because cart data is unavailable.";case Q.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case Q.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case Q.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case Q.MissingCheckoutConfig:case Q.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case Q.MissingOrder:return"Unable to proceed because order data is unavailable.";case Q.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case Q.MissingPayment:return"Unable to proceed because payment data is unavailable.";case Q.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case Q.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case Q.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}function re(){const{navigator:e}=window;let t;return t=e.language?e.language:e.userLanguage,{color_depth:window.screen.colorDepth||24,java_enabled:"function"==typeof e.javaEnabled&&e.javaEnabled(),language:t,screen_height:window.screen.height,screen_width:window.screen.width,time_zone_offset:(new Date).getTimezoneOffset().toString()}}!function(e){e.ACKNOWLEDGE="ACKNOWLEDGE",e.FINALIZE="FINALIZE",e.INITIALIZE="INITIALIZE"}(X||(X={}));const ae=X;class se extends ne{constructor(e,t){super(e),this.paymentIntegrationService=e,this._formPoster=t}execute(e,t){const{payment:n}=e;if(!n)throw new J(W.PaymentNotInitialized);const{paymentData:i}=n;if(!i)throw new ie(Q.MissingPayment);if(this._isThreeDSTwoExperimentOn()){const t=Object.assign(Object.assign({},i),{browser_info:re()});e.payment&&(e.payment.paymentData=t)}return super.execute(e,t).catch((e=>(e=>"object"==typeof e&&null!==e&&"body"in e)(e)&&(0,s.some)(e.body.errors,{code:"three_d_secure_required"})?new Promise((()=>{let t;t=this._isThreeDSTwoExperimentOn()&&!e.body.three_ds_result.merchant_data?{creq:e.body.three_ds_result.payer_auth_request}:{PaReq:e.body.three_ds_result.payer_auth_request,TermUrl:e.body.three_ds_result.callback_url,MD:e.body.three_ds_result.merchant_data},this._formPoster.postForm(e.body.three_ds_result.acs_url,t,void 0,"_top")})):Promise.reject(e)))}finalize(e){const t=this.paymentIntegrationService.getState();return t.getOrder()&&t.getPaymentStatus()===ae.FINALIZE&&this.paymentIntegrationService.finalizeOrder(e),super.finalize()}_isThreeDSTwoExperimentOn(){return!0===this.paymentIntegrationService.getState().getStoreConfigOrThrow().checkoutSettings.features["INT-4994.Opayo_3DS2"]}}const oe=(de=e=>new se(e,(0,$.createFormPoster)()),ce=[{id:"sagepay"}],Object.assign(de,{resolveIds:ce}));var de,ce,ue=n(70355),le=n(28887),he=n(46928);const me=(0,le.A)((e=>{var{getHostedFormOptions:t,getHostedStoredCardValidationFieldset:n,hostedFieldset:a,hostedStoredCardValidationSchema:s,hostedValidationSchema:o,initializePayment:d}=e,c=(0,i.__rest)(e,["getHostedFormOptions","getHostedStoredCardValidationFieldset","hostedFieldset","hostedStoredCardValidationSchema","hostedValidationSchema","initializePayment"]);const u=(0,ue.useCallback)(((e,n)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){var i;return d(Object.assign(Object.assign({},e),{integrations:[...null!==(i=e.integrations)&&void 0!==i?i:[],r.p,H,L,oe],creditCard:t&&{form:yield t(n)}}))}))),[t,d]);return ue.createElement(he.A,Object.assign({},c,{cardFieldset:a,cardValidationSchema:o,getStoredCardValidationFieldset:n,initializePayment:u,storedCardValidationSchema:s}))}))}}]);
//# sourceMappingURL=hosted-credit-card-payment-method-bde99d06.js.map