"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[3380],{29905:(e,t,n)=>{function i(e){switch(e){case"amex":case"american_express":return"american-express";case"diners":case"diners_club":return"diners-club";default:return e}}n.d(t,{A:()=>i})},31448:(e,t,n)=>{n.d(t,{A:()=>i});const i=(0,n(12077).Mz)((({data:e})=>{const t=e.getCart();return t&&t.lineItems}),(e=>(t,n)=>!!e&&function({lineItems:e,instrument:t,paymentMethod:n}){const{isVaultingCardNumberValidationAvailable:i=!0}=(null==n?void 0:n.initializationData)||{};return!(0===e.physicalItems.length||!i||t.trustedShippingAddress)}({lineItems:e,instrument:t,paymentMethod:n})))},38767:(e,t,n)=>{n.d(t,{AmazonPayV2Button:()=>ie,AmazonPayV2PaymentMethod:()=>ee});var i,o,a,r=n(31635),s=n(91195),d=n(38589),c=n(58002);class u extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}(a=i||(i={}))[a.MissingBillingAddress=0]="MissingBillingAddress",a[a.MissingCart=1]="MissingCart",a[a.MissingCheckout=2]="MissingCheckout",a[a.MissingConsignments=3]="MissingConsignments",a[a.MissingCustomer=4]="MissingCustomer",a[a.MissingCheckoutConfig=5]="MissingCheckoutConfig",a[a.MissingOrder=6]="MissingOrder",a[a.MissingOrderConfig=7]="MissingOrderConfig",a[a.MissingOrderId=8]="MissingOrderId",a[a.MissingPayment=9]="MissingPayment",a[a.MissingPaymentId=10]="MissingPaymentId",a[a.MissingPaymentInstrument=11]="MissingPaymentInstrument",a[a.MissingPaymentMethod=12]="MissingPaymentMethod",a[a.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",a[a.MissingPaymentStatus=14]="MissingPaymentStatus",a[a.MissingPaymentToken=15]="MissingPaymentToken",a[a.MissingShippingAddress=16]="MissingShippingAddress";class l extends u{constructor(e){super(function(e){switch(e){case i.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case i.MissingCart:return"Unable to proceed because cart data is unavailable.";case i.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case i.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case i.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case i.MissingCheckoutConfig:case i.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case i.MissingOrder:return"Unable to proceed because order data is unavailable.";case i.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case i.MissingPayment:return"Unable to proceed because payment data is unavailable.";case i.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case i.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case i.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}function m(e){return t=e.lineItems.physicalItems.filter((e=>!e.addedByPromotion)),(0,c.reduce)(t,((e,t)=>e+t.quantity),0);var t}function h(e,t){if(null==e)throw t?t():new Error("An unexpected error has occurred.");return e}!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(o||(o={}));class y extends u{constructor(e){super(function(e){switch(e){case o.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case o.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case o.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case o.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}const p={de:"eu",jp:"fe",uk:"eu",us:"na"};var g,f,b,v,C,I;!function(e){e.en_US="en_US",e.en_GB="en_GB",e.de_DE="de_DE",e.fr_FR="fr_FR",e.it_IT="it_IT",e.es_ES="es_ES",e.ja_JP="ja_JP"}(g||(g={})),function(e){e.Home="Home",e.Product="Product",e.Cart="Cart",e.Checkout="Checkout",e.Other="Other"}(f||(f={})),function(e){e.USD="USD",e.EUR="EUR",e.GBP="GBP",e.JPY="JPY"}(b||(b={})),function(e){e.PayAndShip="PayAndShip",e.PayOnly="PayOnly"}(v||(v={})),function(e){e.Gold="Gold",e.LightGray="LightGray",e.DarkGray="DarkGray"}(C||(C={})),function(e){e.C0001="C0001"}(I||(I={}));var P=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class w{constructor(e){this.amazonPayV2ScriptLoader=e}initialize(e){return P(this,void 0,void 0,(function*(){this.amazonPayV2SDK=yield this.amazonPayV2ScriptLoader.load(e),this.buttonParentContainer=this.buttonParentContainer||this.createAmazonPayButtonParentContainer()}))}deinitialize(){var e;return this.amazonPayV2Button=void 0,null===(e=this.buttonParentContainer)||void 0===e||e.remove(),this.buttonParentContainer=void 0,this.amazonPayV2SDK=void 0,Promise.resolve()}bindButton(e,t,n){this.getAmazonPayV2SDK().Pay.bindChangeAction(`#${e}`,{amazonCheckoutSessionId:t,changeAction:n})}createButton(e,t){this.amazonPayV2Button=this.getAmazonPayV2SDK().Pay.renderButton(`#${e}`,t)}prepareCheckout(e){const t=this.prepareRequestConfig(e);this.getAmazonPayV2Button().onClick((()=>{this.getAmazonPayV2Button().initCheckout(t)}))}prepareCheckoutWithCreationRequestConfig(e){this.getAmazonPayV2Button().onClick((()=>P(this,void 0,void 0,(function*(){const t=yield e();if(t){const e=this.prepareRequestConfig(t.createCheckoutSessionConfig,t.estimatedOrderAmount,t.productType);this.getAmazonPayV2Button().initCheckout(e)}}))))}signout(){return P(this,void 0,void 0,(function*(){return this.amazonPayV2SDK&&this.amazonPayV2SDK.Pay.signout(),Promise.resolve()}))}renderAmazonPayButton({buttonColor:e,checkoutState:t,containerId:n,decoupleCheckoutInitiation:i=!1,methodId:o,options:a,placement:r,isButtonMicroTextDisabled:s=!1}){const d=document.querySelector(`#${n}`);if(!d)return;const{id:c}=d.appendChild(this.getButtonParentContainer());a&&s&&(a.design=I.C0001);const u=null!=a?a:this.getAmazonPayV2ButtonOptions(t,o,r,i,e);return this.createButton(c,u),this.getButtonParentContainer()}updateBuyNowFlowFlag(e){this.isBuyNowFlow=Boolean(e)}isPh4Enabled(e,t){const n=!!e["PROJECT-3483.amazon_pay_ph4"],i=!!e["INT-6885.amazon_pay_ph4_us_only"];return n&&i?"US"===t:n}prepareRequestConfig(e,t,n){const{publicKeyId:i}=e,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n}(e,["publicKeyId"]);return Object.assign(Object.assign({createCheckoutSessionConfig:this.isEnvironmentSpecific(i)?o:e},t&&{estimatedOrderAmount:t}),n&&{productType:n})}createAmazonPayButtonParentContainer(){const e=Math.random().toString(16).substr(-4),t=document.createElement("div");return t.id=`amazonpay_button_parent_container_${e}`,t}getAmazonPayV2ButtonOptions(e,t,n,o=!1,a=C.Gold){var r;const{getCart:s,getCheckout:d,getStoreConfigOrThrow:c,getPaymentMethodOrThrow:u}=this.getCheckoutState(e),{config:{merchantId:h,testMode:y},initializationData:p}=u(t);if(!p)throw new l(i.MissingPaymentMethod);const{checkoutLanguage:g,checkoutSessionMethod:f,createCheckoutSessionConfig:b,extractAmazonCheckoutSessionId:P,ledgerCurrency:w,publicKeyId:S="",isButtonMicroTextDisabled:z}=p;if(!h||!w)throw new l(i.MissingPaymentMethod);const k=Object.assign({merchantId:h,ledgerCurrency:w,checkoutLanguage:g,placement:n,buttonColor:a},z?{design:I.C0001}:{});if(this.isBuyNowFlow)return Object.assign(Object.assign({},k),{sandbox:!!y});const _=s();k.productType=_&&0===m(_)?v.PayOnly:v.PayAndShip;const{checkoutSettings:{features:E},storeProfile:{shopPath:O,storeCountryCode:A}}=c();if(this.isPh4Enabled(E,A)){if(!b)throw new l(i.MissingPaymentMethod);const e=null===(r=d())||void 0===r?void 0:r.outstandingBalance.toString(),t=null==_?void 0:_.currency.code,n=Object.assign({},k);let a;return this.isEnvironmentSpecific(S)?(n.publicKeyId=S,a=b):(n.sandbox=!!y,a=Object.assign(Object.assign({},b),{publicKeyId:S})),o||(n.createCheckoutSessionConfig=a),e&&t&&(n.estimatedOrderAmount={amount:e,currencyCode:t}),n}const M={method:f,url:`${O}/remote-checkout/${t}/payment-session`,extractAmazonCheckoutSessionId:P};return Object.assign(Object.assign({},k),{createCheckoutSession:M,sandbox:!!y})}isEnvironmentSpecific(e){return/^(SANDBOX|LIVE)/.test(e)}getAmazonPayV2SDK(){return this.getOrThrow(this.amazonPayV2SDK)}getButtonParentContainer(){return this.getOrThrow(this.buttonParentContainer)}getAmazonPayV2Button(){return this.getOrThrow(this.amazonPayV2Button)}getOrThrow(e){return h(e,(()=>new y(o.PaymentNotInitialized)))}getCheckoutState(e){return"object"==typeof(t=e)&&null!==t&&"cart"in t&&"checkout"in t&&"config"in t&&"paymentMethods"in t?{getCart:e.cart.getCart,getCheckout:e.checkout.getCheckout,getStoreConfigOrThrow:e.config.getStoreConfigOrThrow,getPaymentMethodOrThrow:t=>e.paymentMethods.getPaymentMethodOrThrow(t)}:e;var t}}class S extends u{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}class z{constructor(e,t=window){this.scriptLoader=e,this.windowWithAmazonPay=t}load(e){return t=this,i=function*(){const{initializationData:t}=e,n=(null==t?void 0:t.region)||"us",i=p[n];if(yield this.scriptLoader.loadScript(`https://static-${i}.payments-amazon.com/checkout.js`),!this.windowWithAmazonPay.amazon)throw new S;return this.windowWithAmazonPay.amazon},new((n=void 0)||(n=Promise))((function(e,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function r(e){try{s(i.throw(e))}catch(e){o(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(a,r)}s((i=i.apply(t,[])).next())}));var t,n,i}}function k(){return new w(new z((0,d.vQ)()))}function _(e,t){return Object.assign(e,{resolveIds:t})}class E extends u{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class O extends u{constructor(e){super(e||"An unexpected error has occurred during buy now cart creation process. Please try again later."),this.name="BuyNowCartCreationError",this.type="buy_now_cart_creation_error"}}class A extends u{constructor(e){super(e||"An unexpected error has occurred during config creation process. Please try again later."),this.name="AmazonPayV2ConfigCreationError",this.type="amazon_pay_v2_config_creation_error"}}function M(e){return e instanceof Object&&"buyNowInitializeOptions"in e}var N,B=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class x{constructor(e,t,n){this.paymentIntegrationService=e,this.amazonPayV2PaymentProcessor=t,this.amazonPayV2ConfigRequestSender=n}initialize(e){var t;return B(this,void 0,void 0,(function*(){const{methodId:n,containerId:i,amazonpay:o}=e,{buttonColor:a}=o||{};if(!n||!i)throw new E('Unable to proceed because "methodId" or "containerId" argument is not provided.');const{getPaymentMethodOrThrow:r}=this.paymentIntegrationService.getState(),s=r(n),{initializationData:d}=s;yield this.amazonPayV2PaymentProcessor.initialize(s),o||(yield this.paymentIntegrationService.loadDefaultCheckout());const c=M(o)?void 0:o;M(o)&&"function"==typeof(null===(t=o.buyNowInitializeOptions)||void 0===t?void 0:t.getBuyNowCartRequestBody)&&(this._buyNowInitializeOptions=o.buyNowInitializeOptions,this.amazonPayV2PaymentProcessor.updateBuyNowFlowFlag(!0)),this.amazonPayV2PaymentProcessor.renderAmazonPayButton({checkoutState:this.paymentIntegrationService.getState(),containerId:i,methodId:n,options:c,placement:f.Cart,buttonColor:a,isButtonMicroTextDisabled:null==d?void 0:d.isButtonMicroTextDisabled}),this._buyNowInitializeOptions&&this.amazonPayV2PaymentProcessor.prepareCheckoutWithCreationRequestConfig(this._getCheckoutCreationRequestConfig.bind(this))}))}deinitialize(){return this.amazonPayV2PaymentProcessor.deinitialize()}_createBuyNowCartOrThrow(){var e,t;return B(this,void 0,void 0,(function*(){const n=null===(t=null===(e=this._buyNowInitializeOptions)||void 0===e?void 0:e.getBuyNowCartRequestBody)||void 0===t?void 0:t.call(e);if(!n)throw new l(i.MissingCart);try{return yield this.paymentIntegrationService.createBuyNowCart(n)}catch(e){throw new O}}))}_createCheckoutConfig(e){return B(this,void 0,void 0,(function*(){try{const t=(yield this.amazonPayV2ConfigRequestSender.createCheckoutConfig(e)).body,{payload:n,public_key:i}=t,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n}(t,["payload","public_key"]);return Object.assign({payloadJSON:n,publicKeyId:i},o)}catch(e){throw new A}}))}_getCheckoutCreationRequestConfig(){return B(this,void 0,void 0,(function*(){const e=yield this._createBuyNowCartOrThrow(),t={amount:String(e.baseAmount),currencyCode:e.currency.code};return{createCheckoutSessionConfig:yield this._createCheckoutConfig(e.id),estimatedOrderAmount:t,productType:0===m(e)?v.PayOnly:v.PayAndShip}}))}}!function(e){e.Json="application/json",e.JsonV1="application/vnd.bc.v1+json"}(N||(N={}));const T=N,D={"X-Checkout-SDK-Version":"1.808.0"};class V{constructor(e){this._requestSender=e}createCheckoutConfig(e){const t={cartId:e},n=Object.assign({"X-API-INTERNAL":"This API endpoint is for internal use only and may change in the future","Content-Type":T.Json},D);return this._requestSender.post("/api/storefront/payment/amazonpay",{headers:n,body:t})}}_((e=>{const t=(0,s.createRequestSender)(),n=new V(t),i=k();return new x(e,i,n)}),[{id:"amazonpay"}]);class U extends E{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}class R extends u{constructor(e){super(e||"Payment process was cancelled."),this.name="PaymentMethodCancelledError",this.type="payment_cancelled"}}class j extends u{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}var q=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class F{constructor(e,t){this.paymentIntegrationService=e,this.amazonPayV2PaymentProcessor=t}initialize(e){return q(this,void 0,void 0,(function*(){const{methodId:t,amazonpay:n}=e;if(!t)throw new E('Unable to proceed because "methodId" argument is not provided.');const i=this.paymentIntegrationService.getState(),{features:o}=i.getStoreConfigOrThrow().checkoutSettings,a=i.getPaymentMethodOrThrow(t),r=a.initializationData||{},{paymentToken:s="",region:d="",isButtonMicroTextDisabled:c}=r;if(yield this.amazonPayV2PaymentProcessor.initialize(a),this._isReadyToPay(s))(null==n?void 0:n.editButtonId)&&this._bindEditButton(n.editButtonId,s,"changePayment",this._isModalFlow(d));else{const{id:e}=this._createContainer();if(this._amazonPayButton=this.amazonPayV2PaymentProcessor.renderAmazonPayButton({checkoutState:i,containerId:e,decoupleCheckoutInitiation:this._isOneTimeTransaction(o,d.toUpperCase()),methodId:t,placement:f.Checkout,isButtonMicroTextDisabled:c}),!this._amazonPayButton)throw new E("Unable to render the Amazon Pay button to an invalid HTML container element.")}}))}execute(e,t){return q(this,void 0,void 0,(function*(){const{payment:n}=e;if(!n)throw new U(["payment"]);const{methodId:i}=n,o=this.paymentIntegrationService.getState(),{features:a}=o.getStoreConfigOrThrow().checkoutSettings,r=o.getPaymentMethodOrThrow(i).initializationData||{},{paymentToken:s="",region:d=""}=r;if(this._isReadyToPay(s)||this._isOneTimeTransaction(a,d.toUpperCase())){const n={methodId:i,paymentData:{nonce:s||"apb"}};yield this.paymentIntegrationService.submitOrder(e,t);try{return void(yield this.paymentIntegrationService.submitPayment(n))}catch(e){if(!((e=>"object"==typeof e&&null!==e&&"body"in e)(e)&&(u=e.body,"object"==typeof u&&null!==u&&"status"in u&&"additional_action_required"in u&&"additional_action_required"===u.status&&"data"in u.additional_action_required&&"redirect_url"in u.additional_action_required.data&&"string"==typeof u.additional_action_required.data.redirect_url)))throw e;const{additional_action_required:t}=e.body,{redirect_url:n}=t.data;if(s)return new Promise((()=>window.location.assign(n)));this.amazonPayV2PaymentProcessor.prepareCheckout(JSON.parse(n))}}var u;return this._getAmazonPayButton().click(),this._isModalFlow(d)?new Promise(((e,t)=>{const n=()=>{window.removeEventListener("focus",n),t(new R("Shopper needs to login to Amazonpay to continue"))};window.addEventListener("focus",n)})):new Promise(c.noop)}))}finalize(){return Promise.reject(new j)}deinitialize(){return q(this,void 0,void 0,(function*(){yield this.amazonPayV2PaymentProcessor.deinitialize(),this._amazonPayButton=void 0}))}_bindEditButton(e,t,n,i){const o=document.getElementById(e);if(o&&o.parentNode){if(!i){const e=o.cloneNode(!0);o.parentNode.replaceChild(e,o),e.addEventListener("click",(()=>{this._showLoadingSpinner()}))}this.amazonPayV2PaymentProcessor.bindButton(e,t,n)}}_isModalFlow(e){return"us"===e}_showLoadingSpinner(){return q(this,void 0,void 0,(function*(){yield this.paymentIntegrationService.widgetInteraction((()=>new Promise(c.noop)))}))}_createContainer(){let e=document.getElementById("AmazonPayButton");return e||(e=document.createElement("div"),e.id="AmazonPayButton",e.style.display="none",document.body.appendChild(e))}_getAmazonPayButton(){return h(this._amazonPayButton,(()=>new y(o.PaymentNotInitialized)))}_isOneTimeTransaction(e,t){return this.amazonPayV2PaymentProcessor.isPh4Enabled(e,t)&&e["INT-6399.amazon_pay_apb"]}_isReadyToPay(e){return!!e}}const L=_((e=>new F(e,k())),[{id:"amazonpay"}]);class H extends u{constructor(e){super(e||"Not implemented."),this.name="NotImplementedError",this.type="not_implemented"}}var W=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class ${constructor(e,t){this.paymentIntegrationService=e,this.amazonPayV2PaymentProcessor=t}initialize(e){return W(this,void 0,void 0,(function*(){const{methodId:t,amazonpay:n}=e;if(!t||!(null==n?void 0:n.container))throw new E('Unable to proceed because "methodId" or "containerId" argument is not provided.');let i;try{i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t)}catch(e){yield this.paymentIntegrationService.loadPaymentMethod(t),i=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t)}yield this.amazonPayV2PaymentProcessor.initialize(i),this.amazonPayV2PaymentProcessor.renderAmazonPayButton({checkoutState:this.paymentIntegrationService.getState(),containerId:n.container,methodId:t,placement:f.Checkout})}))}deinitialize(){return W(this,void 0,void 0,(function*(){yield this.amazonPayV2PaymentProcessor.deinitialize()}))}signIn(){throw new H('In order to sign in via Amazon, the shopper must click on "Amazon Pay" button.')}signOut(e){return W(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getPaymentId();t&&(yield this.amazonPayV2PaymentProcessor.signout(),yield this.paymentIntegrationService.remoteCheckoutSignOut(t.providerId,e))}))}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}}const K=_((e=>new $(e,k())),[{id:"amazonpay"}]);var G=n(69440),J=n(70355),Y=n(89799),X=n(48407),Q=n(31448),Z=n(19285);const ee=(0,Z.A)((e=>{var{checkoutService:t,checkoutState:n,paymentForm:i,method:o,method:{initializationData:{paymentDescriptor:a,paymentToken:s}}}=e,d=(0,r.__rest)(e,["checkoutService","checkoutState","paymentForm","method","method"]);const c=(0,J.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{integrations:[L],amazonpay:{editButtonId:"editButtonId"}}))),[t]),u=(0,J.useCallback)((()=>window.location.reload()),[]),{hidePaymentSubmitButton:l,disableSubmit:m,setFieldValue:h,setSubmit:y,setValidationSchema:p}=i,{data:{getCheckout:g,isPaymentDataRequired:f},statuses:{isLoadingInstruments:b}}=n,v=g(),C=n.data.getCustomer(),I=!(null==C?void 0:C.isGuest)&&Boolean(o.config.isVaultingEnabled),P=n.data.getInstruments(o)||[];return J.createElement(Y.A,Object.assign({},d,{buttonId:"editButtonId",containerId:"paymentWidget",deinitializePayment:t.deinitializePayment,disableSubmit:m,hidePaymentSubmitButton:l,hideWidget:!0,initializePayment:c,instruments:P,isInstrumentCardCodeRequired:(0,X.A)(n),isInstrumentCardNumberRequired:(0,Q.A)(n),isInstrumentFeatureAvailable:I,isLoadingInstruments:b(),isPaymentDataRequired:f(),isSignInRequired:!1,isSignedIn:(0,G.some)(null==v?void 0:v.payments,{providerId:o.id}),loadInstruments:t.loadInstruments,method:o,onSignOut:u,paymentDescriptor:a,setFieldValue:h,setSubmit:y,setValidationSchema:p,shouldShow:!!s,shouldShowDescriptor:!!s,shouldShowEditButton:!!s,signOut:t.signOutCustomer}))}),[{id:"amazonpay"}]);var te=n(63582);const ne=()=>{var e;if(!document.querySelector(".checkout-button-container"))return;const t=document.querySelector("#amazonpayCheckoutButton > div");if(t){const n=null===(e=t.shadowRoot)||void 0===e?void 0:e.querySelector(".amazonpay-button-view1");if(n instanceof HTMLElement)return void(n.style.height="36px")}setTimeout(ne,10)},ie=(0,Z.A)((e=>((0,J.useEffect)((()=>{ne()}),[]),J.createElement("div",{className:"AmazonPayContainer"},J.createElement(te.A,Object.assign({integrations:[K]},e))))),[{id:"amazonpay"}])},48407:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(12077);const o=["bluesnapdirect"];const a=(0,i.Mz)((({data:e})=>{const t=e.getCart();return t&&t.lineItems}),(e=>(t,n)=>!!e&&function({instrument:e,lineItems:t,paymentMethod:n}){const{config:{isVaultingCvvEnabled:i,cardCode:a},initializationData:r}=n,{isVaultingCardCodeValidationAvailable:s=!0}=r||{};return!(o.includes(e.provider)||!s||!(t.digitalItems.length>0||t.giftCertificates.length>0)&&(e.trustedShippingAddress?!i:!i&&!a))}({instrument:t,lineItems:e,paymentMethod:n})))},62677:(e,t,n)=>{n.d(t,{A:()=>z});var i=n(70355),o=n(49655),a=n(24750),r=n(40052),s=n(35393),d=n(97834),c=n(22437),u=n(3375),l=n.n(u),m=n(52921),h=n.n(m),y=n(69440),p=n(86516),g=n(47237),f=n(29905);const b=({className:e,instrument:t,testId:n,shouldHideExpiryDate:a=!1,onClick:r})=>{var s;const d=(0,f.A)(t.brand),u=h().getTypeInfo(d),m=!(0,c.expirationDate)({month:t.expiryMonth,year:t.expiryYear}).isValid;return i.createElement("button",{className:e,"data-test":n,onClick:r,type:"button"},i.createElement("div",{className:l()("instrumentSelect-details",{"instrumentSelect-details--expired":m})},i.createElement(p.A,{cardType:d}),i.createElement("div",{className:"instrumentSelect-card","data-test":`${null!=n?n:""}-last4`},u?i.createElement(o.A,{data:{cardTitle:null!==(s=u.niceType)&&void 0!==s?s:"",endingIn:t.last4},id:"payment.instrument_ending_in_text"}):i.createElement(o.A,{data:{endingIn:t.last4},id:"payment.instrument_default_ending_in_text"})),!a&&i.createElement("div",{className:l()("instrumentSelect-expiry",{"instrumentSelect-expiry--expired":m}),"data-test":`${n||""}-expiry`},m?i.createElement(o.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expired_text"}):i.createElement(o.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expires_text"}))))},v=({instrument:e,shouldHideExpiryDate:t=!1,onClick:n=y.noop})=>{const o=(0,i.useCallback)((()=>{n(e.bigpayToken)}),[n,e]);return i.createElement(b,{instrument:e,onClick:o,shouldHideExpiryDate:t,testId:"instrument-select-option"})},C=({className:e,testId:t,onClick:n=y.noop})=>i.createElement("button",{className:e,"data-test":t,onClick:n,type:"button"},i.createElement("div",{className:"instrumentSelect-details instrumentSelect-details--addNew"},i.createElement(p.A,null),i.createElement("div",{className:"instrumentSelect-card"},i.createElement(o.A,{id:"payment.instrument_add_card_action"})))),I=({instruments:e,selectedInstrumentId:t,shouldHideExpiryDate:n=!1,onSelectInstrument:o,onUseNewInstrument:a})=>i.createElement("ul",{className:"instrumentSelect-dropdownMenu instrumentSelect-dropdownMenuNext dropdown-menu","data-test":"instrument-select-menu"},e.map((e=>i.createElement("li",{className:l()("instrumentSelect-option dropdown-menu-item",{"instrumentSelect-option--selected":e.bigpayToken===t}),key:e.bigpayToken},i.createElement(v,{instrument:e,onClick:o,shouldHideExpiryDate:n,testId:"instrument-select-option"})))),i.createElement("li",{className:"instrumentSelect-option instrumentSelect-option--addNew dropdown-menu-item"},i.createElement(C,{onClick:a,testId:"instrument-select-option-use-new"}))),P=({instrument:e,shouldHideExpiryDate:t=!1,testId:n,onClick:o})=>e?i.createElement(b,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",instrument:e,onClick:o,shouldHideExpiryDate:t,testId:n}):i.createElement(C,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",testId:n}),w=({field:e,form:t,instruments:n,onSelectInstrument:o,onUseNewInstrument:a,selectedInstrumentId:r,shouldHideExpiryDate:s=!1})=>{const d=(0,i.useRef)(r),c=(0,i.useCallback)(((n="")=>{t.setFieldValue(e.name,n)}),[t,e.name]);(0,i.useEffect)((()=>(setTimeout((()=>c(r))),()=>{""===e.value&&void 0!==r&&c()})),[]),(0,i.useEffect)((()=>{d.current!==r&&setTimeout((()=>c(r))),d.current=r}),[r,c]);const u=(0,y.find)(n,{bigpayToken:r});return i.createElement("div",{className:"instrumentSelect"},i.createElement(g.A,{dropdown:i.createElement(I,{instruments:n,onSelectInstrument:o,onUseNewInstrument:a,selectedInstrumentId:r,shouldHideExpiryDate:s})},i.createElement(P,{instrument:u,shouldHideExpiryDate:s,testId:"instrument-select"}),i.createElement("input",Object.assign({type:"hidden"},e))))};var S=n(3701);const z=(0,i.memo)((({instruments:e,onDeleteInstrument:t,onSelectInstrument:n,onUseNewInstrument:c,selectedInstrumentId:u,shouldHideExpiryDate:l=!1,validateInstrument:m=null})=>{const h=(0,i.useCallback)((t=>i.createElement(w,Object.assign({},t,{instruments:e,onSelectInstrument:n,onUseNewInstrument:c,selectedInstrumentId:u,shouldHideExpiryDate:l}))),[e,n,c,u,l]),y=(0,i.useCallback)((n=>i.createElement(S.A,Object.assign({instruments:e,onDeleteInstrument:t},n))),[e,t]);return i.createElement(a.A,{additionalClassName:"instrumentFieldset",legend:i.createElement(r.A,{hidden:!0},i.createElement(o.A,{id:"payment.instrument_text"}))},i.createElement(s.A,{modal:y},(({onClick:e})=>i.createElement("button",{className:"instrumentModal-trigger",onClick:e,type:"button"},i.createElement(o.A,{id:"payment.instrument_manage_button"})))),i.createElement(d.A,{name:"instrumentId",render:h}),i.createElement("div",{style:{display:u?void 0:"none"}},m))}))},63582:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(31635),o=n(70355);const a=(0,n(19285).A)((({checkoutService:{deinitializeCustomer:e,initializeCustomer:t},checkoutButtonContainerClass:n,containerId:a,methodId:r,onUnhandledError:s,onWalletButtonClick:d,additionalInitializationOptions:c,integrations:u})=>((0,o.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t({methodId:r,integrations:u,[r]:Object.assign({container:a,onUnhandledError:s,onClick:()=>d(r)},c)})}catch(e){"function"==typeof s&&e instanceof Error&&s(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield e({methodId:r})}catch(e){"function"==typeof s&&e instanceof Error&&s(e)}}))})),[]),o.createElement("div",{className:n,"data-test":a,id:a}))),[])},89799:(e,t,n)=>{n.d(t,{A:()=>v});var i=n(31635),o=n(69440),a=n(70355),r=n(52137),s=n(43125),d=n(11474),c=n(62677),u=n(40646),l=n(91182),m=n(3375),h=n.n(m),y=n(72769),p=n(49655);const g=({buttonId:e,shouldShowEditButton:t})=>{if(t){const t=a.createElement(p.A,{id:"remote.select_different_card_action"});return a.createElement("p",null,a.createElement("button",{className:h()("stepHeader","widget-link-amazonpay"),id:e,onClick:(0,y.A)(),type:"button"},t))}return null},f=({shouldShowDescriptor:e,paymentDescriptor:t})=>e&&t?a.createElement("div",{className:"payment-descriptor"},t):null,b=({additionalContainerClassName:e,containerId:t,hideContentWhenSignedOut:n,hideWidget:i,isSignInRequired:o,isSignedIn:r,method:s,renderCustomPaymentForm:d,shouldRenderCustomInstrument:c,shouldShowCreditCardFieldset:u})=>a.createElement("div",{className:h()("widget",`widget--${s.id}`,"payment-widget",c?"":e),id:t,style:{display:n&&o&&!r||!u||i?"none":void 0},tabIndex:-1},c&&d&&d()),v=({instruments:e,hideWidget:t=!1,isInitializing:n=!1,isAccountInstrument:m,isInstrumentFeatureAvailable:h,isLoadingInstruments:y,shouldHideInstrumentExpiryDate:p=!1,shouldShow:v=!0,hideVerificationFields:C,method:I,storedCardValidationSchema:P,isPaymentDataRequired:w,setValidationSchema:S,loadInstruments:z,onUnhandledError:k=o.noop,deinitializeCustomer:_,deinitializePayment:E,setSubmit:O,initializeCustomer:A,initializePayment:M,signInCustomer:N,isSignedIn:B,isSignInRequired:x,isInstrumentCardNumberRequired:T,validateInstrument:D,containerId:V,hideContentWhenSignedOut:U=!1,renderCustomPaymentForm:R,additionalContainerClassName:j,shouldRenderCustomInstrument:q=!1,paymentDescriptor:F,shouldShowDescriptor:L,shouldShowEditButton:H,buttonId:W,setFieldValue:$})=>{const[K,G]=(0,a.useState)(!1),[J,Y]=(0,a.useState)(void 0),X=(0,a.useRef)(e);(0,a.useEffect)((()=>{X.current=e}),[e]);const Q=(0,a.useCallback)((()=>{if(K)return;const e=X.current.find((e=>e.defaultInstrument))||X.current[0];return e?e.bigpayToken:void 0}),[K]),Z=(0,a.useCallback)((()=>{const e=J||Q();return(0,o.find)(X.current,{bigpayToken:e})}),[J,Q]),ee=(0,a.useCallback)((()=>{if(!w)return null;const e=Z();return h&&e&&P||null}),[Z,h,w,P]),te=(0,a.useCallback)(((e,t)=>!e&&(0,r.T)(t)?t:void 0),[]),ne=(0,a.useCallback)((t=>{if(0===e.length)return G(!0),Y(void 0),void $("instrumentId","");if(J===t){const e=Q();Y(e),$("instrumentId",e)}}),[e,J,Q]),ie=(0,a.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){G(!0),Y(void 0),E&&(yield E({gatewayId:I.gateway,methodId:I.id})),M&&(yield M({gatewayId:I.gateway,methodId:I.id}))}))),[I,E,M]),oe=(0,a.useCallback)((e=>{G(!1),Y(e)}),[]),ae=(0,a.useCallback)((()=>{const t=J||Q(),n=(0,o.find)(e,{bigpayToken:t});if(n){(0,s.A)(n);const e=T(n,I);if(C)return;if(D)return D(e,n)}}),[J,Q,e,I,C,D]),re=()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){const e=X.current;if(!w)return void O(I,null);if(x&&!B)return O(I,N||null),A?A({methodId:I.id}):void 0;let t;if(O(I,null),!K){const n=J||Q(),i=e.find((e=>e.bigpayToken===n))||e[0];i&&(0,s.a)(i)&&(t=i)}return M?M({gatewayId:I.gateway,methodId:I.id},t):void 0})),se=J||Q(),de=se&&e.find((e=>e.bigpayToken===se))||e[0],ce=e.filter((e=>!(0,r.T)(e))),ue=e.filter((e=>(0,r.T)(e))),le=h&&e.length>0,me=!le||K,he=(n||y)&&!t,ye=de?te(K,de):void 0,pe=e[0]&&(0,r.T)(e[0]);(0,a.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){S(I,ee());try{h&&(yield null==z?void 0:z()),yield re()}catch(e){e instanceof Error&&k(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){S(I,null),O(I,null);try{E&&(yield E({gatewayId:I.gateway,methodId:I.id})),_&&(yield _({methodId:I.id}))}catch(e){e instanceof Error&&k(e)}}))})),[]);const ge=(0,a.useRef)(!0),fe=(0,a.useRef)(e.length),be=(0,a.useRef)(w),ve=(0,a.useRef)(J);return(0,a.useEffect)((()=>{if(ge.current)return void(ge.current=!1);S(I,ee());(ve.current!==J||Number(fe.current)>0&&0===e.length||be.current!==w)&&(ve.current=J,fe.current=e.length,be.current=w,(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{E&&(yield E({gatewayId:I.gateway,methodId:I.id})),yield re()}catch(e){e instanceof Error&&k(e)}})))}),[J,e,w]),v?a.createElement(l.A,{hideContentWhenLoading:!0,isLoading:he},a.createElement("div",{className:"paymentMethod--hosted"},pe&&le&&a.createElement(d.A,{instruments:ue,onSelectInstrument:oe,onUseNewInstrument:ie,selectedInstrument:ye}),!pe&&le&&a.createElement(c.A,{instruments:ce,onDeleteInstrument:ne,onSelectInstrument:oe,onUseNewInstrument:ie,selectedInstrumentId:se,shouldHideExpiryDate:p,validateInstrument:ae()}),a.createElement(f,{paymentDescriptor:F,shouldShowDescriptor:L}),a.createElement(b,{additionalContainerClassName:j,containerId:V,hideContentWhenSignedOut:U,hideWidget:t,isSignInRequired:x,isSignedIn:B,method:I,renderCustomPaymentForm:R,shouldRenderCustomInstrument:q,shouldShowCreditCardFieldset:me}),h&&a.createElement(u.A,{instrumentId:se,instruments:e,isAccountInstrument:Boolean(m||pe)}),a.createElement(g,{buttonId:W,shouldShowEditButton:H}))):a.createElement("div",{style:{display:"none"}})}}}]);
//# sourceMappingURL=amazon-pay-v2-payment-method-a21998fc.js.map